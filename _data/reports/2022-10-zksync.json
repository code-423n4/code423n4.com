{
  "circa": {
    "title": "zkSync v2 contest",
    "sponsor": "zkSync",
    "slug": "2022-10-zksync",
    "date": "2023-01-04",
    "findings": "https://github.com/code-423n4/2022-10-zksync-findings/issues",
    "contest": 177
  },
  "html": "<h1 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h1>\n<h2 id=\"about-c4\" style=\"position:relative;\"><a href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>About C4</h2>\n<p>Code4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.</p>\n<p>A C4 audit contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.</p>\n<p>During the audit contest outlined in this document, C4 conducted an analysis of the zkSync v2 smart contract system written in Solidity. The audit contest took place between October 28—November 9 2022.</p>\n<h2 id=\"wardens\" style=\"position:relative;\"><a href=\"#wardens\" aria-label=\"wardens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wardens</h2>\n<p>24 Wardens contributed reports to the zkSync v2 contest:</p>\n<ol>\n<li>0x1f8b</li>\n<li><a href=\"https://twitter.com/0xSmartContract\">0xSmartContract</a></li>\n<li><a href=\"https://github.com/Aymen1001\">Aymen0909</a></li>\n<li>HE1M</li>\n<li>HardlyCodeMan</li>\n<li>IllIllI</li>\n<li>ReyAdmirado</li>\n<li>Rolezn</li>\n<li>Soosh</li>\n<li><a href=\"https://mobile.twitter.com/tomj_bb\">TomJ</a></li>\n<li><a href=\"https://tom-sol.notion.site/Who-am-I-3b4dc28e77b647eb90794735a94dd38e\">Tomo</a></li>\n<li>brgltd</li>\n<li><a href=\"https://twitter.com/c3ph_\">c3phas</a></li>\n<li>cccz</li>\n<li>chaduke</li>\n<li>codehacker</li>\n<li>ctf_sec</li>\n<li>datapunk</li>\n<li><a href=\"https://www.linkedin.com/in/georgi-nikolaev-georgiev-978253219\">gogo</a></li>\n<li>jayjonah8</li>\n<li>ladboy233</li>\n<li>mcwildy</li>\n<li>pashov</li>\n<li>rbserver</li>\n</ol>\n<p>This contest was judged by <a href=\"https://twitter.com/GalloDaSballo\">Alex the Entreprenerd</a>.</p>\n<p>Final report assembled by <a href=\"https://twitter.com/liveactionllama\">liveactionllama</a>.</p>\n<h1 id=\"summary\" style=\"position:relative;\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h1>\n<p>The C4 analysis yielded an aggregated total of 2 unique vulnerabilities. Of these vulnerabilities, 0 received a risk rating in the category of HIGH severity and 2 received a risk rating in the category of MEDIUM severity.</p>\n<p>Additionally, C4 analysis included 13 reports detailing issues with a risk rating of LOW severity or non-critical. There were also 10 reports recommending gas optimizations.</p>\n<p>All of the issues presented here are linked back to their original finding.</p>\n<h1 id=\"scope\" style=\"position:relative;\"><a href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scope</h1>\n<p>The code under review can be found within the <a href=\"https://github.com/code-423n4/2022-10-zksync\">C4 zkSync v2 contest repository</a>, and is composed of 39 smart contracts written in the Solidity programming language and includes 3,727 lines of Solidity code.</p>\n<h1 id=\"severity-criteria\" style=\"position:relative;\"><a href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Severity Criteria</h1>\n<p>C4 assesses the severity of disclosed vulnerabilities according to a methodology based on <a href=\"https://owasp.org/www-community/OWASP_Risk_Rating_Methodology\">OWASP standards</a>.</p>\n<p>Vulnerabilities are divided into three primary risk categories: high, medium, and low/non-critical.</p>\n<p>High-level considerations for vulnerabilities span the following key areas when conducting assessments:</p>\n<ul>\n<li>Malicious Input Handling</li>\n<li>Escalation of privileges</li>\n<li>Arithmetic</li>\n<li>Gas use</li>\n</ul>\n<p>Further information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on <a href=\"https://code4rena.com\">the C4 website</a>.</p>\n<h1 id=\"medium-risk-findings-2\" style=\"position:relative;\"><a href=\"#medium-risk-findings-2\" aria-label=\"medium risk findings 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Medium Risk Findings (2)</h1>\n<h2 id=\"m-01-diamondcut-is-not-protected-in-case-of-governors-key-leakage\" style=\"position:relative;\"><a href=\"#m-01-diamondcut-is-not-protected-in-case-of-governors-key-leakage\" aria-label=\"m 01 diamondcut is not protected in case of governors key leakage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/46\">[M-01] <code>diamondCut</code> is not protected in case of governor’s key leakage</a></h2>\n<p><em>Submitted by <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/46\">HE1M</a>, also found by <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/315\">codehacker</a></em></p>\n<p>When the governor proposes a diamondCut, governor must wait for <code>upgradeNoticePeriod</code> to be passed, or security council members have to approve the proposal to bypass the notice period, so that the governor can execute the proposal.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">   require(approvedBySecurityCouncil || upgradeNoticePeriodPassed, &quot;a6&quot;); // notice period should expire</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">   require(approvedBySecurityCouncil || !diamondStorage.isFrozen, &quot;f3&quot;);</span></span></code></pre>\n<p>If the governor’s key is leaked and noticed by zkSync, the attacker must wait for the notice period to execute the already proposed diamondCut with the malicious <code>_calldata</code> based on the note below from zkSync, or to propose a new malicious diamondCut. For, both cases, the attacker loses time.</p>\n<blockquote>\n<p>NOTE: proposeDiamondCut - commits data associated with an upgrade but does not execute it. While the upgrade is associated with facetCuts and (address _initAddress, bytes _calldata) the upgrade will be committed to the facetCuts and _initAddress. This is done on purpose, to leave some freedom to the governor to change calldata for the upgrade between proposing and executing it.</p>\n</blockquote>\n<p>Since, there is a notice period (as zkSync noticed the key leakage, security council member will not approve the proposal, so bypassing the notice period is not possible), there is enough time for zkSync to apply security measures (pausing any deposit/withdraw, reporting in media to not execute any transaction in zkSync, and so on).</p>\n<p>But, the attacker can be smarter, just before the proposal be executed by the governor (i.e. the notice period is passed or security council members approved it), the attacker executes the proposal earlier than governor with the malicious <code>_calldata</code>. In other words, the attacker front runs the governor.</p>\n<p>Therefore, if zkSync notices the governor’s key leakage beforehand, there is enough time to protect the project. But, if zkSync does not notice the governor’s key leakage, the attacker can change the <code>_calldata</code> into a malicious one in the last moment so that it is not possible to protect the project.</p>\n<h3 id=\"proof-of-concept\" style=\"position:relative;\"><a href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/libraries/Diamond.sol#L277\">Diamond.sol#L277</a><br>\n<a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/facets/DiamondCut.sol#L46\">DiamondCut.sol#L46</a></p>\n<h3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p><code>_calldata</code> should be included in the proposed diamondCut:<a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/facets/DiamondCut.sol#L27\">DiamondCut.sol#L27</a>.</p>\n<p>Or, at least one of the security council members should approve the <code>_calldata</code> during execution of the proposal.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/46#issuecomment-1324267775\">miladpiri (zkSync) confirmed and commented</a>:</strong></p>\n<blockquote>\n<p>It is a valid issue, and the fix is going to be implemented, so we confirm the issue as medium! Thanks.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/46#issuecomment-1335849634\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>In contrast to other reports, this shows how a malicious proposal could be injected, bypassing the timelock protection, for this reason (after consulting with a second Judge), I agree with marking it as a distinct finding and agree with Medium Severity.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-02-block_period-is-incorrect\" style=\"position:relative;\"><a href=\"#m-02-block_period-is-incorrect\" aria-label=\"m 02 block_period is incorrect permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/259\">[M-02] <code>BLOCK_PERIOD</code> is incorrect</a></h2>\n<p><em>Submitted by <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/259\">Soosh</a></em></p>\n<p><a href=\"https://github.com/code-423n4/2022-10-zksync/blob/456078b53a6d09636b84522ac8f3e8049e4e3af5/ethereum/contracts/zksync/Config.sol#L47\">Config.sol#L47</a><br></p>\n<p>The <code>BLOCK_PERIOD</code> is set to 13 seconds in <code>Config.sol</code>.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"sol\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">constant</span><span class=\"mtk1\"> </span><span class=\"mtk12\">BLOCK_PERIOD</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">13</span><span class=\"mtk1\"> </span><span class=\"mtk12\">seconds</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p>Since moving to Proof-of-Stake (PoS) after the Merge, block times on ethereum are fixed at 12 seconds per block (slots).\n<a href=\"https://ethereum.org/en/developers/docs/consensus-mechanisms/pos/#:~:text=Whereas%20under%20proof%2Dof%2Dwork,block%20proposer%20in%20every%20slot\">https://ethereum.org/en/developers/docs/consensus-mechanisms/pos/#:~:text=Whereas%20under%20proof%2Dof%2Dwork,block%20proposer%20in%20every%20slot</a>.</p>\n<h3 id=\"impact\" style=\"position:relative;\"><a href=\"#impact\" aria-label=\"impact permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>This results in incorrect calculation of <code>PRIORITY_EXPIRATION</code> which is used to determine when a transaction in the Priority Queue should be considered expired.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"sol\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">constant</span><span class=\"mtk1\"> </span><span class=\"mtk12\">PRIORITY_EXPIRATION_PERIOD</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">3</span><span class=\"mtk1\"> </span><span class=\"mtk12\">days</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @dev Expiration delta for priority request to be satisfied (in ETH blocks)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">constant</span><span class=\"mtk1\"> </span><span class=\"mtk12\">PRIORITY_EXPIRATION</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">PRIORITY_EXPIRATION_PERIOD</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BLOCK_PERIOD</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p>The time difference can be calulated</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"python\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&gt;&gt;&gt; </span><span class=\"mtk7\">3</span><span class=\"mtk1\">*</span><span class=\"mtk7\">24</span><span class=\"mtk1\">*</span><span class=\"mtk7\">60</span><span class=\"mtk1\">*</span><span class=\"mtk7\">60</span><span class=\"mtk1\"> / </span><span class=\"mtk7\">13</span><span class=\"mtk1\">    </span><span class=\"mtk3\"># 3 days / 13 sec block period</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">19938.46153846154</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&gt;&gt;&gt; </span><span class=\"mtk7\">3</span><span class=\"mtk1\">*</span><span class=\"mtk7\">24</span><span class=\"mtk1\">*</span><span class=\"mtk7\">60</span><span class=\"mtk1\">*</span><span class=\"mtk7\">60</span><span class=\"mtk1\"> / </span><span class=\"mtk7\">12</span><span class=\"mtk1\">    </span><span class=\"mtk3\"># 3 days / 12 sec block period</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">21600.0</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&gt;&gt;&gt; </span><span class=\"mtk7\">21600</span><span class=\"mtk1\"> - </span><span class=\"mtk7\">19938</span><span class=\"mtk1\">      </span><span class=\"mtk3\"># difference in blocks</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">1662</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&gt;&gt;&gt; </span><span class=\"mtk7\">1662</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">12</span><span class=\"mtk1\"> / (</span><span class=\"mtk7\">60</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">60</span><span class=\"mtk1\">) </span><span class=\"mtk3\"># difference in hours</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">5.54</span></span></span></code></pre>\n<p>By using block time of 13 seconds, a transaction in the Priority Queue incorrectly expires 5.5 hours earlier than is expected.</p>\n<p>5.5 hours is a significant amount of time difference so I believe this issue to be Medium severity.</p>\n<h3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Change the block period to be 12 seconds</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"sol\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">constant</span><span class=\"mtk1\"> </span><span class=\"mtk12\">BLOCK_PERIOD</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">12</span><span class=\"mtk1\"> </span><span class=\"mtk12\">seconds</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/259#issuecomment-1324171828\">miladpiri (zkSync) confirmed and commented</a>:</strong></p>\n<blockquote>\n<p>This is a valid medium issue! Thanks!</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/259#issuecomment-1329983294\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how, due to an incorrect configuration, L2Transactions will expire earlier than intended.</p>\n<p>The value would normally be rated a Low Severity, however, because the Warden has shown a more specific impact, I agree with Medium Severity.</p>\n</blockquote>\n<hr>\n<h1 id=\"low-risk-and-non-critical-issues\" style=\"position:relative;\"><a href=\"#low-risk-and-non-critical-issues\" aria-label=\"low risk and non critical issues permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Low Risk and Non-Critical Issues</h1>\n<p>For this contest, 13 reports were submitted by wardens detailing low risk and non-critical issues. The <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/49\">report highlighted below</a> by <strong>HE1M</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/361\">brgltd</a>, <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/348\">rbserver</a>, <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/346\">pashov</a>, <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/239\">ladboy233</a>, <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/227\">0xSmartContract</a>, <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/212\">datapunk</a>, <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/186\">cccz</a>, <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/172\">ctf_sec</a>, <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/158\">Tomo</a>, <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/110\">Rolezn</a>, <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/77\">jayjonah8</a>, and <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/13\">chaduke</a>.</em></p>\n<h2 id=\"01\" style=\"position:relative;\"><a href=\"#01\" aria-label=\"01 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[01]</h2>\n<p>The critical parameters in <code>initialize(...)</code> are not set safely:</p>\n<ul>\n<li><code>s.governor</code> should be set to <code>msg.sender</code>, because a wrong governor address will result in loss of access to all other parts, and later changing the governor to the correct address.</li>\n<li><code>_l2BootloaderBytecodeHash</code> should be validated like <code>L2ContractHelper.validateBytecodeHash(_l2BootloaderBytecodeHash)</code> as in <code>GovernanceFacet</code></li>\n<li><code>_l2DefaultAccountBytecodeHash</code> should be validated like <code>L2ContractHelper.validateBytecodeHash(_l2DefaultAccountBytecodeHash)</code> as in <code>GovernanceFacet</code></li>\n</ul>\n<p><a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/DiamondInit.sol#L39\">DiamondInit.sol#L39</a><br>\n<a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/DiamondInit.sol#L58\">DiamondInit.sol#L58</a><br>\n<a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/DiamondInit.sol#L59\">DiamondInit.sol#L59</a><br></p>\n<h2 id=\"02\" style=\"position:relative;\"><a href=\"#02\" aria-label=\"02 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[02]</h2>\n<p>Better to have also <code>approveEmergencyDiamondCutAsSecurityCouncilMemberBySignature</code>, in case the security council members do not have access to ethereum blockchain or in case it is needed to approve just in one transaction by batch of signatures (to bypass the notice period).</p>\n<h2 id=\"03\" style=\"position:relative;\"><a href=\"#03\" aria-label=\"03 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[03]</h2>\n<p>Better to have config facet, in case some update is needed in the <code>config.sol</code>. Therefore, it is not necessary to redeploy the facets that imported config (like <code>Executor</code> and <code>Mailbox</code>).</p>\n<h2 id=\"04\" style=\"position:relative;\"><a href=\"#04\" aria-label=\"04 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[04]</h2>\n<p><code>L2_LOG_BYTES</code> is not correct, it should be <code>L2_TO_L1_LOG_SERIALIZE_SIZE</code><br>\n<a href=\"https://github.com/code-423n4/2022-10-zksync/blob/456078b53a6d09636b84522ac8f3e8049e4e3af5/ethereum/contracts/zksync/Config.sol#L19\">Config.sol#L19</a></p>\n<h2 id=\"05\" style=\"position:relative;\"><a href=\"#05\" aria-label=\"05 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[05]</h2>\n<p>It is not needed to have modifier <code>senderCanCallFunction</code> for the function <code>deposit</code> in both <code>L1ERC20Bridge</code> and <code>L1ETHBridge</code>, because they call the function <code>requestL2Transaction</code> in the <code>MailBox</code> that has already such modifier.<br>\n<a href=\"https://github.com/code-423n4/2022-10-zksync/blob/358f38736351a8a27e325dfcb665eeba5ec02bd5/ethereum/contracts/bridge/L1EthBridge.sol#L92\">L1EthBridge.sol#L92</a><br>\n<a href=\"https://github.com/code-423n4/2022-10-zksync/blob/358f38736351a8a27e325dfcb665eeba5ec02bd5/ethereum/contracts/zksync/facets/Mailbox.sol#L112\">Mailbox.sol#L112</a><br></p>\n<h2 id=\"06\" style=\"position:relative;\"><a href=\"#06\" aria-label=\"06 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[06]</h2>\n<p>For each deposit of an ERC20 token, the information of the token is read and packed and sent to L2. Even if this token is used before for deposit, again this information is sent to L2, which is waste of gas.<br>\n<a href=\"https://github.com/code-423n4/2022-10-zksync/blob/456078b53a6d09636b84522ac8f3e8049e4e3af5/ethereum/contracts/bridge/L1ERC20Bridge.sol#L164-L169\">L1ERC20Bridge.sol#L164-L169</a><br>\n<a href=\"https://github.com/code-423n4/2022-10-zksync/blob/456078b53a6d09636b84522ac8f3e8049e4e3af5/ethereum/contracts/bridge/L1ERC20Bridge.sol#L155\">L1ERC20Bridge.sol#L155</a><br></p>\n<h2 id=\"07\" style=\"position:relative;\"><a href=\"#07\" aria-label=\"07 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[07]</h2>\n<p>When a block is committed, its hash will be stored in <code>storedBlockHashes</code>:<br>\n<a href=\"https://github.com/code-423n4/2022-10-zksync/blob/358f38736351a8a27e325dfcb665eeba5ec02bd5/ethereum/contracts/zksync/facets/Executor.sol#L164\">Executor.sol#L164</a><br></p>\n<p>If this block is reverted, it is not removed from <code>storedBlockHashes</code>:<br>\n<a href=\"https://github.com/code-423n4/2022-10-zksync/blob/358f38736351a8a27e325dfcb665eeba5ec02bd5/ethereum/contracts/zksync/facets/Executor.sol#L336\">Executor.sol#L336</a><br></p>\n<p>The vulnerability is that in the <code>GettersFacet</code>, the function <code>storedBlockHash(...)</code> will return the hash of a reverted block if this block number is given as its parameter, while it should return 0.<br>\n<a href=\"https://github.com/code-423n4/2022-10-zksync/blob/358f38736351a8a27e325dfcb665eeba5ec02bd5/ethereum/contracts/zksync/facets/Getters.sol#L86\">Getters.sol#L86</a><br></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/49#issuecomment-1325835625\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p><strong>The critical parameters in initialize(…) are not set safely:</strong><br></p>\n<p>Logically equivalent to address(0) check, Low</p>\n<p><strong>approveEmergencyDiamondCutAsSecurityCouncilMemberBySignature</strong><br></p>\n<p>Not sure what this means, but if it means one caller gets to approve emerengency cuts, this is a glaring security risk.</p>\n<p><strong>Better to have config facet, in case some update is needed in the config.sol</strong><br></p>\n<p>Not convinced by this one either, ultimately it’s called config but it’s just a bunch of contact / base contract</p>\n<p><strong>L2<em>LOG</em>BYTES is not correct, it should be <code>L2_TO_L1_LOG_SERIALIZE_SIZE</code></strong><br></p>\n<p>Non-Critical</p>\n<p><strong>It is not needed to have modifier senderCanCallFunction for the function deposit in both L1ERC20Bridge and L1ETHBridge, because they call the function requestL2Transaction in the MailBox that has already such modifier.</strong><br></p>\n<p>Not convinced in lack of detail, if you call contract X and contract X calls contract Y, then the check is necessary on both contracts</p>\n<p><strong>For each deposit of an ERC20 token, the information</strong><br></p>\n<p>Unclear what you’d do and where the savings would be.</p>\n<p><strong>When a block is committed, its hash will be stored in storedBlockHashes:</strong></p>\n<p>See <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/204\"><code>#204</code></a>, Low</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/49#issuecomment-1335920135\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>2 Low, 1 Non-Critical</p>\n<p>Report was pretty good, but the downgraded findings add a lot of points to this QA.</p>\n<p>While the Warden has sent a few false positives, I think the value they offered for this contest warrants them winning the best QA report.</p>\n</blockquote>\n<p><em>(Note: please see warden’s <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/49\">original submission</a> for links to the referenced downgraded findings)</em></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/49#issuecomment-1336268291\">miladpiri (zkSync) commented</a>:</strong></p>\n<blockquote>\n<p> Thanks, @Alex the Entreprenerd for your comment, that we are now looking at this report more seriously.<br></p>\n<p>IMO, No.2 “approveEmergencyDiamondCutAsSecurityCouncilMemberBySignature“ can be a security issue. This is what we are now implementing to make security council members be able to approve the proposal by signature.<br></p>\n<p>The security issue is that in case the security council members do not have access to approve on-chain, the governor must wait for their approval to bypass the notice period. In case the proposal should be executed instantly (in case of a critical bug in our protocol), this delay can be dangerous to our protocol.<br></p>\n<p>By having approval by signature, the security members can approve a proposal off-chain, and the governor can execute the instant upgrade on behalf of them by using their signatures, so all-time access to the chain is not necessary for security council members.<br></p>\n<p>Moreover, in case a critical proposal should be executed silently, it is necessary to be able to approve by signature. Because, the governor, in one batch transaction, proposes the proposal, and approves the upgrade on behalf of the security council members by using their signatures, and then executes the proposal. Since all the above actions are done in one transaction, there is no security risk of vulnerability leak. But, in the current structure, when the governor proposes the proposal, should wait for security members’ approval, this delay can be transparent to a malicious user to investigate the governor’s proposal, and gets a clue what the vulnerability is and then exploits the protocol.<br></p>\n<p>This report worths to be upgraded in terms of severity!\nThanks.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/49#issuecomment-1340174006\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Thank you for your insight, I have sent the contest to triage, took note of your feedback and am sharing with other Judges and Wardens.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/49#issuecomment-1343557528\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Similarly to <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/48\"><code>#48</code></a>, I have shared this finding with 2 Judges and a Top warden and we all agree that this is effectively the same finding, with similar impact.</p>\n<p>As such Low Severity is the most appropriate.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/49#issuecomment-1343993682\">miladpiri (zkSync) commented</a>:</strong></p>\n<blockquote>\n<p>Thanks for the follow-up!</p>\n</blockquote>\n<hr>\n<h1 id=\"gas-optimizations\" style=\"position:relative;\"><a href=\"#gas-optimizations\" aria-label=\"gas optimizations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gas Optimizations</h1>\n<p>For this contest, 10 reports were submitted by wardens detailing gas optimizations. The <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/35\">report highlighted below</a> by <strong>0x1f8b</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/341\">Aymen0909</a>, <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/337\">c3phas</a>, <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/282\">TomJ</a>, <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/233\">gogo</a>, <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/224\">IllIllI</a>, <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/124\">ReyAdmirado</a>, <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/117\">mcwildy</a>, <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/111\">Rolezn</a>, and <a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/80\">HardlyCodeMan</a>.</em></p>\n<p><strong>Disclosure Note from 0x1f8b:</strong></p>\n<p><em>First of all, please note that there are “known issues” that were not referenced in the <a href=\"https://gist.github.com/Picodes/1f87a82e954cc749dea9d9961d5f4dff\">report</a>, these lines were included in this report because they were not present in the public one.</em></p>\n<h2 id=\"g-01-use-require-instead-of-assert\" style=\"position:relative;\"><a href=\"#g-01-use-require-instead-of-assert\" aria-label=\"g 01 use require instead of assert permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-01] Use <code>require</code> instead of <code>assert</code></h2>\n<p>The <code>assert()</code> and <code>require()</code> functions are a part of the error handling aspect in Solidity. Solidity makes use of state-reverting error handling exceptions. This means all changes made to the contract on that call or any sub-calls are undone if an error is thrown. It also flags an error.</p>\n<p>They are quite similar as both check for conditions and if they are not met, would throw an error.</p>\n<p>The big difference between the two is that the <code>assert()</code> function when false, <strong>uses up all the remaining gas and reverts all the changes made.</strong></p>\n<p>Meanwhile, a <code>require()</code> function when false, also reverts back all the changes made to the contract but <strong>does refund all the remaining gas fees we offered to pay</strong>. This is the most common Solidity function used by developers for debugging and error handling.</p>\n<p><strong>Affected source code:</strong></p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/facets/DiamondCut.sol#L16\">DiamondCut.sol:16</a></li>\n</ul>\n<h2 id=\"g-02-avoid-compound-assignment-operator-in-state-variables\" style=\"position:relative;\"><a href=\"#g-02-avoid-compound-assignment-operator-in-state-variables\" aria-label=\"g 02 avoid compound assignment operator in state variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-02] Avoid compound assignment operator in state variables</h2>\n<p>Using compound assignment operators for state variables (like <code>State += X</code> or <code>State -= X</code> …) it’s more expensive than using operator assignment (like <code>State = State + X</code> or <code>State = State - X</code> …).</p>\n<p><strong>Proof of concept (<em>without optimizations</em>):</strong></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">pragma</span><span class=\"mtk1\"> </span><span class=\"mtk12\">solidity</span><span class=\"mtk1\"> </span><span class=\"mtk7\">0.8</span><span class=\"mtk1\">.</span><span class=\"mtk7\">15</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">TesterA</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">private</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_a</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">testShort</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">_a</span><span class=\"mtk1\"> += </span><span class=\"mtk7\">1</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">TesterB</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">private</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_a</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">testLong</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">_a</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_a</span><span class=\"mtk1\"> + </span><span class=\"mtk7\">1</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>Gas saving executing: <strong>13 per entry</strong></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TesterA.testShort: 43507</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TesterB.testLong:  43494</span></span></code></pre>\n<p><strong>Affected source code:</strong></p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/facets/DiamondCut.sol#L29\">DiamondCut.sol:29</a></li>\n</ul>\n<h3 id=\"total-gas-saved-13--1--13\" style=\"position:relative;\"><a href=\"#total-gas-saved-13--1--13\" aria-label=\"total gas saved 13  1  13 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Total gas saved: <strong>13 * 1 = 13</strong></h3>\n<h2 id=\"g-03-use-calldata-instead-of-memory\" style=\"position:relative;\"><a href=\"#g-03-use-calldata-instead-of-memory\" aria-label=\"g 03 use calldata instead of memory permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-03] Use <code>calldata</code> instead of <code>memory</code></h2>\n<p>Some methods are declared as <code>external</code> but the arguments are defined as <code>memory</code> instead of as <code>calldata</code>.</p>\n<p>By marking the function as <code>external</code> it is possible to use <code>calldata</code> in the arguments shown below and save significant gas.</p>\n<p><strong>Recommended change:</strong></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-   function decodeString(bytes memory _input) external pure returns (string memory result) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+   function decodeString(bytes calldata _input) external pure returns (string memory result) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        (result) = abi.decode(_input, (string));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><strong>Affected source code:</strong></p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/zksync/contracts/ExternalDecoder.sol#L10-L12\">ExternalDecoder.sol:10-12</a></li>\n<li><a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/zksync/contracts/ExternalDecoder.sol#L15-L17\">ExternalDecoder.sol:15-17</a></li>\n</ul>\n<h2 id=\"g-04-shift-right-or-left-instead-of-dividing-or-multiply-by-2\" style=\"position:relative;\"><a href=\"#g-04-shift-right-or-left-instead-of-dividing-or-multiply-by-2\" aria-label=\"g 04 shift right or left instead of dividing or multiply by 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-04] Shift right or left instead of dividing or multiply by 2</h2>\n<p>Shifting one to the right will calculate a division by two.</p>\n<p>he <code>SHR</code> opcode only requires 3 gas, compared to the <code>DIV</code> opcode’s consumption of 5. Additionally, shifting is used to get around Solidity’s division operation’s division-by-0 prohibition.</p>\n<p><strong>Proof of concept (<em>without optimizations</em>):</strong></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">pragma</span><span class=\"mtk1\"> </span><span class=\"mtk12\">solidity</span><span class=\"mtk1\"> </span><span class=\"mtk7\">0.8</span><span class=\"mtk1\">.</span><span class=\"mtk7\">16</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">TesterA</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">testDiv</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">a</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint</span><span class=\"mtk1\">) { </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">a</span><span class=\"mtk1\"> / </span><span class=\"mtk7\">2</span><span class=\"mtk1\">; }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">TesterB</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">testShift</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">a</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint</span><span class=\"mtk1\">) { </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">a</span><span class=\"mtk1\"> &gt;&gt; </span><span class=\"mtk7\">1</span><span class=\"mtk1\">; }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>Gas saving executing: <strong>172 per entry</strong></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TesterA.testDiv:    21965 </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TesterB.testShift:  21793   </span></span></code></pre>\n<p>The same optimization can be used to multiply by 2, using the left shift.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">pragma</span><span class=\"mtk1\"> </span><span class=\"mtk12\">solidity</span><span class=\"mtk1\"> </span><span class=\"mtk7\">0.8</span><span class=\"mtk1\">.</span><span class=\"mtk7\">16</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">TesterA</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">testMul</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">a</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint</span><span class=\"mtk1\">) { </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">a</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">2</span><span class=\"mtk1\">; }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">TesterB</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">testShift</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">a</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint</span><span class=\"mtk1\">) { </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">a</span><span class=\"mtk1\"> &lt;&lt; </span><span class=\"mtk7\">1</span><span class=\"mtk1\">; }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>Gas saving executing: <strong>201 per entry</strong></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TesterA.testMul:    21994</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TesterB.testShift:  21793    </span></span></code></pre>\n<p><strong>Affected source code:</strong></p>\n<p><code>/</code>:</p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/libraries/Merkle.sol#L34\">Merkle.sol:34</a></li>\n</ul>\n<h3 id=\"total-gas-saved-172--1--172\" style=\"position:relative;\"><a href=\"#total-gas-saved-172--1--172\" aria-label=\"total gas saved 172  1  172 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Total gas saved: <strong>(172 * 1) = 172</strong></h3>\n<h2 id=\"g-05-theres-no-need-to-set-default-values-for-variables\" style=\"position:relative;\"><a href=\"#g-05-theres-no-need-to-set-default-values-for-variables\" aria-label=\"g 05 theres no need to set default values for variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-05] There’s no need to set default values for variables</h2>\n<p>If a variable is not set/initialized, the default value is assumed (0, <code>false</code>, 0x0 … depending on the data type). You are simply wasting gas if you directly initialize it with its default value.</p>\n<p><strong>Proof of concept (<em>without optimizations</em>):</strong></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">pragma</span><span class=\"mtk1\"> </span><span class=\"mtk12\">solidity</span><span class=\"mtk1\"> </span><span class=\"mtk7\">0.8</span><span class=\"mtk1\">.</span><span class=\"mtk7\">15</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">TesterA</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">testInit</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint</span><span class=\"mtk1\">) { </span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">a</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">0</span><span class=\"mtk1\">; </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">a</span><span class=\"mtk1\">; }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">TesterB</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">testNoInit</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint</span><span class=\"mtk1\">) { </span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">a</span><span class=\"mtk1\">; </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">a</span><span class=\"mtk1\">; }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>Gas saving executing: <strong>8 per entry</strong></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TesterA.testInit:   21392</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TesterB.testNoInit: 21384</span></span></code></pre>\n<p><strong>Affected source code:</strong></p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/bridge/L1EthBridge.sol#L33\">L1EthBridge.sol:33</a></li>\n<li><a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/zksync/contracts/bridge/L2ETHBridge.sol#L28\">L2ETHBridge.sol:28</a></li>\n</ul>\n<h3 id=\"total-gas-saved-8--2--16\" style=\"position:relative;\"><a href=\"#total-gas-saved-8--2--16\" aria-label=\"total gas saved 8  2  16 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Total gas saved: <strong>8 * 2 = 16</strong></h3>\n<h2 id=\"g-06-unnecessary-cast-in-mailboxserializel2transaction\" style=\"position:relative;\"><a href=\"#g-06-unnecessary-cast-in-mailboxserializel2transaction\" aria-label=\"g 06 unnecessary cast in mailboxserializel2transaction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-06] Unnecessary cast in <code>Mailbox.serializeL2Transaction</code></h2>\n<p>It’s possible to remove the following casts:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    function serializeL2Transaction(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        uint256 _txId,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        uint256 _l2Value,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        address _sender,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        address _contractAddressL2,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        bytes calldata _calldata,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        uint256 _ergsLimit,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        bytes[] calldata _factoryDeps</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ) public pure returns (L2CanonicalTransaction memory) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        return</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            L2CanonicalTransaction({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                txType: PRIORITY_OPERATION_L2_TX_TYPE,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                from: uint256(uint160(_sender)),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                to: uint256(uint160(_contractAddressL2)),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                ergsLimit: _ergsLimit,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                ergsPerPubdataByteLimit: uint256(1),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                maxFeePerErg: uint256(0),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                maxPriorityFeePerErg: uint256(0),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                paymaster: uint256(0),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-               reserved: [uint256(_txId), _l2Value, 0, 0, 0, 0],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+               reserved: [_txId, _l2Value, 0, 0, 0, 0],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                data: _calldata,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                signature: new bytes(0),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                factoryDeps: _hashFactoryDeps(_factoryDeps),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                paymasterInput: new bytes(0),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                reservedDynamic: new bytes(0)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><strong>Affected source code:</strong></p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/facets/Mailbox.sol#L206\">Mailbox.sol:206</a></li>\n</ul>\n<h2 id=\"g-07-gas-saving-using-immutable\" style=\"position:relative;\"><a href=\"#g-07-gas-saving-using-immutable\" aria-label=\"g 07 gas saving using immutable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-07] Gas saving using <code>immutable</code></h2>\n<p>It’s possible to avoid storage access a save gas using <code>immutable</code> keyword for the following variables:</p>\n<p>It’s also better to remove the initial values, because they will be set during the constructor.</p>\n<p><strong>Affected source code:</strong></p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/zksync/contracts/bridge/L2ERC20Bridge.sol#L19\">L2ERC20Bridge.sol:19</a></li>\n<li><a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/zksync/contracts/bridge/L2ERC20Bridge.sol#L23\">L2ERC20Bridge.sol:23</a></li>\n<li><a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/zksync/contracts/bridge/L2ERC20Bridge.sol#L26\">L2ERC20Bridge.sol:26</a></li>\n<li><a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/zksync/contracts/bridge/L2ETHBridge.sol#L22\">L2ETHBridge.sol:22</a></li>\n</ul>\n<h2 id=\"g-08-reorder-structure-layout\" style=\"position:relative;\"><a href=\"#g-08-reorder-structure-layout\" aria-label=\"g 08 reorder structure layout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-08] Reorder structure layout</h2>\n<p>The following structs could be optimized moving the position of certains values in order to save slot storages:</p>\n<p><code>StoredBlockInfo</code> in <a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/interfaces/IExecutor.sol#L15-L24\">IExecutor.sol#L15-L24</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    struct StoredBlockInfo {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        uint64 blockNumber;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       uint64 indexRepeatedStorageChanges;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        bytes32 blockHash;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-       uint64 indexRepeatedStorageChanges;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        uint256 numberOfLayer1Txs;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        bytes32 priorityOperationsHash;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        bytes32 l2LogsTreeRoot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        uint256 timestamp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        bytes32 commitment;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><code>AppStorage</code> in <a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/Storage.sol#L69-L106\">Storage.sol:69-106</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">struct AppStorage {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @dev Storage of variables needed for diamond cut facet</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    DiamondCutStorage diamondCutStorage;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @notice Address which will exercise governance over the network i.e. change validator set, conduct upgrades</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    address governor;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk7\">+   bool zkPorterIsAvailable;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @notice Address that governor proposed as one that will replace it</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    address pendingGovernor;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @notice List of permitted validators</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    mapping(address =&gt; bool) validators;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @dev Verifier contract. Used to verify aggregated proof for blocks</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    Verifier verifier;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @notice Total number of executed blocks i.e. blocks[totalBlocksExecuted] points at the latest executed block (block 0 is genesis)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    uint256 totalBlocksExecuted;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @notice Total number of proved blocks i.e. blocks[totalBlocksProved] points at the latest proved block</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    uint256 totalBlocksVerified;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @notice Total number of committed blocks i.e. blocks[totalBlocksCommitted] points at the latest committed block</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    uint256 totalBlocksCommitted;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @dev Stored hashed StoredBlock for block number</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    mapping(uint256 =&gt; bytes32) storedBlockHashes;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @dev Stored root hashes of L2 -&gt; L1 logs</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter\" aria-hidden=\"true\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    mapping(uint256 =&gt; bytes32) l2LogsRootHashes;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"1\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"2\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    PriorityQueue.Queue priorityQueue;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"3\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @dev The smart contract that manages the list with permission to call contract functions</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"4\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    IAllowList allowList;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"5\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @notice Part of the configuration parameters of ZKP circuits. Used as an input for the verifier smart contract</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"6\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    VerifierParams verifierParams;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"7\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @notice Bytecode hash of bootloader program.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"8\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @dev Used as an input to zkp-circuit.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"9\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    bytes32 l2BootloaderBytecodeHash;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"10\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @notice Bytecode hash of default account (bytecode for EOA).</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"11\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @dev Used as an input to zkp-circuit.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"12\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    bytes32 l2DefaultAccountBytecodeHash;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"13\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @dev Indicates that the porter may be touched on L2 transactions.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"14\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">    /// @dev Used as an input to zkp-circuit.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"15\"></span><span class=\"grvsc-source\"><span class=\"mtk8\">-   bool zkPorterIsAvailable;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-gutter-pad\"></span><span class=\"grvsc-gutter grvsc-line-number\" aria-hidden=\"true\" data-content=\"16\"></span><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h2 id=\"g-09-use-require-instead-of-assert\" style=\"position:relative;\"><a href=\"#g-09-use-require-instead-of-assert\" aria-label=\"g 09 use require instead of assert permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-09] Use <code>require</code> instead of <code>assert</code></h2>\n<p>The <code>assert()</code> and <code>require()</code> functions are a part of the error handling aspect in Solidity. Solidity makes use of state-reverting error handling exceptions. This means all changes made to the contract on that call or any sub-calls are undone if an error is thrown. It also flags an error.</p>\n<p>They are quite similar as both check for conditions and if they are not met, would throw an error.</p>\n<p>The big difference between the two is that the <code>assert()</code> function when false, <strong>uses up all the remaining gas and reverts all the changes made.</strong></p>\n<p>Meanwhile, a <code>require()</code> function when false, also reverts back all the changes made to the contract but <strong>does refund all the remaining gas fees we offered to pay</strong>. This is the most common Solidity function used by developers for debugging and error handling.</p>\n<p><strong>Affected source code:</strong></p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/facets/DiamondCut.sol#L16\">DiamondCut.sol:16</a></li>\n</ul>\n<p><strong><a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/35#issuecomment-1326853179\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p><strong>[G-01] Use require instead of assert</strong><br>\nValid but will only run in constructor so ignoring</p>\n<p><strong>[G-02] Avoid compound assignment operator in state variables</strong><br>\nAwarding 34 as that’s what I get when changing the in-scope tests</p>\n<p><strong>[G-03] Use calldata instead of memory</strong><br>\nCannot test the benchmark, but it’s roughly in the hundreds, let’s say 200 gas</p>\n<p><strong>[G-04] Shift right or left instead of dividing or multiply by 2</strong><br>\nThis mostly saves gas because of the unchecked, let’s say 100 gas</p>\n<p><strong>[G-05] There’s no need to set default values for variables</strong><br>\nThose are constants, will be inlined by the compiler</p>\n<p><strong>[G-06] Unnecessary cast in Mailbox.serializeL2Transaction</strong><br>\nThe cast should be optimized away by the compiler as no supporting variable is declared</p>\n<p><strong>[G-07] Gas saving using immutable</strong><br>\n2.1k per var<br>\n8.4k<br></p>\n<p><strong>[G-08] Reorder structure layout</strong><br>\n2k each as it will save one extra cold Slot Load<br>\n4k</p>\n<p>Pretty good, but would benefit by using benchmarks from the codebase in-scope.</p>\n<p>10734</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-10-zksync-findings/issues/35#issuecomment-1336220069\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Ultimately offered the strongest savings via immutables and did not offer false positives vs other reports, also found the packing refactoring which will offer great savings to end users.</p>\n</blockquote>\n<hr>\n<h1 id=\"disclosures\" style=\"position:relative;\"><a href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Disclosures</h1>\n<p>C4 is an open organization governed by participants in the community.</p>\n<p>C4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.</p>\n<p>C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>",
  "toc": "<ul>\n<li>\n<p><a href=\"#overview\">Overview</a></p>\n<ul>\n<li><a href=\"#about-c4\">About C4</a></li>\n<li><a href=\"#wardens\">Wardens</a></li>\n</ul>\n</li>\n<li><a href=\"#summary\">Summary</a></li>\n<li><a href=\"#scope\">Scope</a></li>\n<li><a href=\"#severity-criteria\">Severity Criteria</a></li>\n<li>\n<p><a href=\"#medium-risk-findings-2\">Medium Risk Findings (2)</a></p>\n<ul>\n<li><a href=\"#m-01-diamondcut-is-not-protected-in-case-of-governors-key-leakage\">[M-01] <code>diamondCut</code> is not protected in case of governor’s key leakage</a></li>\n<li><a href=\"#m-02-block_period-is-incorrect\">[M-02] <code>BLOCK_PERIOD</code> is incorrect</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#low-risk-and-non-critical-issues\">Low Risk and Non-Critical Issues</a></p>\n<ul>\n<li><a href=\"#01\">01</a></li>\n<li><a href=\"#02\">02</a></li>\n<li><a href=\"#03\">03</a></li>\n<li><a href=\"#04\">04</a></li>\n<li><a href=\"#05\">05</a></li>\n<li><a href=\"#06\">06</a></li>\n<li><a href=\"#07\">07</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#gas-optimizations\">Gas Optimizations</a></p>\n<ul>\n<li><a href=\"#g-01-use-require-instead-of-assert\">G-01 Use <code>require</code> instead of <code>assert</code></a></li>\n<li><a href=\"#g-02-avoid-compound-assignment-operator-in-state-variables\">G-02 Avoid compound assignment operator in state variables</a></li>\n<li><a href=\"#g-03-use-calldata-instead-of-memory\">G-03 Use <code>calldata</code> instead of <code>memory</code></a></li>\n<li><a href=\"#g-04-shift-right-or-left-instead-of-dividing-or-multiply-by-2\">G-04 Shift right or left instead of dividing or multiply by 2</a></li>\n<li><a href=\"#g-05-theres-no-need-to-set-default-values-for-variables\">G-05 There’s no need to set default values for variables</a></li>\n<li><a href=\"#g-06-unnecessary-cast-in-mailboxserializel2transaction\">G-06 Unnecessary cast in <code>Mailbox.serializeL2Transaction</code></a></li>\n<li><a href=\"#g-07-gas-saving-using-immutable\">G-07 Gas saving using <code>immutable</code></a></li>\n<li><a href=\"#g-08-reorder-structure-layout\">G-08 Reorder structure layout</a></li>\n<li><a href=\"#g-09-use-require-instead-of-assert\">G-09 Use <code>require</code> instead of <code>assert</code></a></li>\n</ul>\n</li>\n<li><a href=\"#disclosures\">Disclosures</a></li>\n</ul>",
  "md": "\n# Overview\n\n## About C4\n\nCode4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.\n\nA C4 audit contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.\n\nDuring the audit contest outlined in this document, C4 conducted an analysis of the zkSync v2 smart contract system written in Solidity. The audit contest took place between October 28—November 9 2022.\n\n## Wardens\n\n24 Wardens contributed reports to the zkSync v2 contest:\n\n  1. 0x1f8b\n  2. [0xSmartContract](https://twitter.com/0xSmartContract)\n  3. [Aymen0909](https://github.com/Aymen1001)\n  4. HE1M\n  5. HardlyCodeMan\n  6. IllIllI\n  7. ReyAdmirado\n  8. Rolezn\n  9. Soosh\n  10. [TomJ](https://mobile.twitter.com/tomj_bb)\n  11. [Tomo](https://tom-sol.notion.site/Who-am-I-3b4dc28e77b647eb90794735a94dd38e)\n  12. brgltd\n  13. [c3phas](https://twitter.com/c3ph_)\n  14. cccz\n  15. chaduke\n  16. codehacker\n  17. ctf\\_sec\n  18. datapunk\n  19. [gogo](https://www.linkedin.com/in/georgi-nikolaev-georgiev-978253219)\n  20. jayjonah8\n  21. ladboy233\n  22. mcwildy\n  23. pashov\n  24. rbserver\n\nThis contest was judged by [Alex the Entreprenerd](https://twitter.com/GalloDaSballo).\n\nFinal report assembled by [liveactionllama](https://twitter.com/liveactionllama).\n\n# Summary\n\nThe C4 analysis yielded an aggregated total of 2 unique vulnerabilities. Of these vulnerabilities, 0 received a risk rating in the category of HIGH severity and 2 received a risk rating in the category of MEDIUM severity.\n\nAdditionally, C4 analysis included 13 reports detailing issues with a risk rating of LOW severity or non-critical. There were also 10 reports recommending gas optimizations.\n\nAll of the issues presented here are linked back to their original finding.\n\n# Scope\n\nThe code under review can be found within the [C4 zkSync v2 contest repository](https://github.com/code-423n4/2022-10-zksync), and is composed of 39 smart contracts written in the Solidity programming language and includes 3,727 lines of Solidity code.\n\n# Severity Criteria\n\nC4 assesses the severity of disclosed vulnerabilities according to a methodology based on [OWASP standards](https://owasp.org/www-community/OWASP_Risk_Rating_Methodology).\n\nVulnerabilities are divided into three primary risk categories: high, medium, and low/non-critical.\n\nHigh-level considerations for vulnerabilities span the following key areas when conducting assessments:\n\n- Malicious Input Handling\n- Escalation of privileges\n- Arithmetic\n- Gas use\n\nFurther information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on [the C4 website](https://code4rena.com).\n\n# Medium Risk Findings (2)\n## [[M-01] `diamondCut` is not protected in case of governor's key leakage](https://github.com/code-423n4/2022-10-zksync-findings/issues/46)\n*Submitted by [HE1M](https://github.com/code-423n4/2022-10-zksync-findings/issues/46), also found by [codehacker](https://github.com/code-423n4/2022-10-zksync-findings/issues/315)*\n\nWhen the governor proposes a diamondCut, governor must wait for `upgradeNoticePeriod` to be passed, or security council members have to approve the proposal to bypass the notice period, so that the governor can execute the proposal.\n\n       require(approvedBySecurityCouncil || upgradeNoticePeriodPassed, \"a6\"); // notice period should expire\n       require(approvedBySecurityCouncil || !diamondStorage.isFrozen, \"f3\");\n\nIf the governor's key is leaked and noticed by zkSync, the attacker must wait for the notice period to execute the already proposed diamondCut with the malicious `_calldata` based on the note below from zkSync, or to propose a new malicious diamondCut. For, both cases, the attacker loses time.\n\n> NOTE: proposeDiamondCut - commits data associated with an upgrade but does not execute it. While the upgrade is associated with facetCuts and (address \\_initAddress, bytes \\_calldata) the upgrade will be committed to the facetCuts and \\_initAddress. This is done on purpose, to leave some freedom to the governor to change calldata for the upgrade between proposing and executing it.\n\nSince, there is a notice period (as zkSync noticed the key leakage, security council member will not approve the proposal, so bypassing the notice period is not possible), there is enough time for zkSync to apply security measures (pausing any deposit/withdraw, reporting in media to not execute any transaction in zkSync, and so on).\n\nBut, the attacker can be smarter, just before the proposal be executed by the governor (i.e. the notice period is passed or security council members approved it), the attacker executes the proposal earlier than governor with the malicious `_calldata`. In other words, the attacker front runs the governor.\n\nTherefore, if zkSync notices the governor's key leakage beforehand, there is enough time to protect the project. But, if zkSync does not notice the governor's key leakage, the attacker can change the `_calldata` into a malicious one in the last moment so that it is not possible to protect the project.\n\n### Proof of Concept\n\n[Diamond.sol#L277](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/libraries/Diamond.sol#L277)<br>\n[DiamondCut.sol#L46](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/facets/DiamondCut.sol#L46)\n\n### Recommended Mitigation Steps\n\n`_calldata` should be included in the proposed diamondCut:[DiamondCut.sol#L27](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/facets/DiamondCut.sol#L27).\n\nOr, at least one of the security council members should approve the `_calldata` during execution of the proposal.\n\n**[miladpiri (zkSync) confirmed and commented](https://github.com/code-423n4/2022-10-zksync-findings/issues/46#issuecomment-1324267775):**\n > It is a valid issue, and the fix is going to be implemented, so we confirm the issue as medium! Thanks.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-10-zksync-findings/issues/46#issuecomment-1335849634):**\n > In contrast to other reports, this shows how a malicious proposal could be injected, bypassing the timelock protection, for this reason (after consulting with a second Judge), I agree with marking it as a distinct finding and agree with Medium Severity.\n\n\n\n***\n\n## [[M-02] `BLOCK_PERIOD` is incorrect](https://github.com/code-423n4/2022-10-zksync-findings/issues/259)\n*Submitted by [Soosh](https://github.com/code-423n4/2022-10-zksync-findings/issues/259)*\n\n[Config.sol#L47](https://github.com/code-423n4/2022-10-zksync/blob/456078b53a6d09636b84522ac8f3e8049e4e3af5/ethereum/contracts/zksync/Config.sol#L47)<br>\n\nThe `BLOCK_PERIOD` is set to 13 seconds in `Config.sol`.\n\n```sol\nuint256 constant BLOCK_PERIOD = 13 seconds;\n```\n\nSince moving to Proof-of-Stake (PoS) after the Merge, block times on ethereum are fixed at 12 seconds per block (slots).\n<https://ethereum.org/en/developers/docs/consensus-mechanisms/pos/#:~:text=Whereas%20under%20proof%2Dof%2Dwork,block%20proposer%20in%20every%20slot>.\n\n### Impact\n\nThis results in incorrect calculation of `PRIORITY_EXPIRATION` which is used to determine when a transaction in the Priority Queue should be considered expired.\n\n```sol\nuint256 constant PRIORITY_EXPIRATION_PERIOD = 3 days;\n/// @dev Expiration delta for priority request to be satisfied (in ETH blocks)\nuint256 constant PRIORITY_EXPIRATION = PRIORITY_EXPIRATION_PERIOD/BLOCK_PERIOD;\n```\n\nThe time difference can be calulated\n\n```python\n>>> 3*24*60*60 / 13    # 3 days / 13 sec block period\n19938.46153846154\n>>> 3*24*60*60 / 12    # 3 days / 12 sec block period\n21600.0\n>>> 21600 - 19938      # difference in blocks\n1662\n>>> 1662 * 12 / (60 * 60) # difference in hours\n5.54\n```\n\nBy using block time of 13 seconds, a transaction in the Priority Queue incorrectly expires 5.5 hours earlier than is expected.\n\n5.5 hours is a significant amount of time difference so I believe this issue to be Medium severity.\n\n### Recommended Mitigation Steps\n\nChange the block period to be 12 seconds\n\n```sol\nuint256 constant BLOCK_PERIOD = 12 seconds;\n```\n\n**[miladpiri (zkSync) confirmed and commented](https://github.com/code-423n4/2022-10-zksync-findings/issues/259#issuecomment-1324171828):**\n > This is a valid medium issue! Thanks!\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-10-zksync-findings/issues/259#issuecomment-1329983294):**\n > The warden has shown how, due to an incorrect configuration, L2Transactions will expire earlier than intended.\n> \n> The value would normally be rated a Low Severity, however, because the Warden has shown a more specific impact, I agree with Medium Severity.\n\n\n\n***\n\n# Low Risk and Non-Critical Issues\n\nFor this contest, 13 reports were submitted by wardens detailing low risk and non-critical issues. The [report highlighted below](https://github.com/code-423n4/2022-10-zksync-findings/issues/49) by **HE1M** received the top score from the judge.\n\n*The following wardens also submitted reports: [brgltd](https://github.com/code-423n4/2022-10-zksync-findings/issues/361), [rbserver](https://github.com/code-423n4/2022-10-zksync-findings/issues/348), [pashov](https://github.com/code-423n4/2022-10-zksync-findings/issues/346), [ladboy233](https://github.com/code-423n4/2022-10-zksync-findings/issues/239), [0xSmartContract](https://github.com/code-423n4/2022-10-zksync-findings/issues/227), [datapunk](https://github.com/code-423n4/2022-10-zksync-findings/issues/212), [cccz](https://github.com/code-423n4/2022-10-zksync-findings/issues/186), [ctf\\_sec](https://github.com/code-423n4/2022-10-zksync-findings/issues/172), [Tomo](https://github.com/code-423n4/2022-10-zksync-findings/issues/158), [Rolezn](https://github.com/code-423n4/2022-10-zksync-findings/issues/110), [jayjonah8](https://github.com/code-423n4/2022-10-zksync-findings/issues/77), and [chaduke](https://github.com/code-423n4/2022-10-zksync-findings/issues/13).*\n\n## [01]\n\nThe critical parameters in `initialize(...)` are not set safely:\n\n*   `s.governor` should be set to `msg.sender`, because a wrong governor address will result in loss of access to all other parts, and later changing the governor to the correct address.\n*   `_l2BootloaderBytecodeHash` should be validated like `L2ContractHelper.validateBytecodeHash(_l2BootloaderBytecodeHash)` as in `GovernanceFacet`\n*   `_l2DefaultAccountBytecodeHash` should be validated like `L2ContractHelper.validateBytecodeHash(_l2DefaultAccountBytecodeHash)` as in `GovernanceFacet`\n\n[DiamondInit.sol#L39](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/DiamondInit.sol#L39)<br>\n[DiamondInit.sol#L58](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/DiamondInit.sol#L58)<br>\n[DiamondInit.sol#L59](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/DiamondInit.sol#L59)<br>\n\n## [02]\n\nBetter to have also `approveEmergencyDiamondCutAsSecurityCouncilMemberBySignature`, in case the security council members do not have access to ethereum blockchain or in case it is needed to approve just in one transaction by batch of signatures (to bypass the notice period).\n\n## [03]\n\nBetter to have config facet, in case some update is needed in the `config.sol`. Therefore, it is not necessary to redeploy the facets that imported config (like `Executor` and `Mailbox`).\n\n## [04]\n\n`L2_LOG_BYTES` is not correct, it should be `L2_TO_L1_LOG_SERIALIZE_SIZE`<br>\n[Config.sol#L19](https://github.com/code-423n4/2022-10-zksync/blob/456078b53a6d09636b84522ac8f3e8049e4e3af5/ethereum/contracts/zksync/Config.sol#L19)\n\n## [05]\n\nIt is not needed to have modifier `senderCanCallFunction` for the function `deposit` in both `L1ERC20Bridge` and `L1ETHBridge`, because they call the function `requestL2Transaction` in the `MailBox` that has already such modifier.<br>\n[L1EthBridge.sol#L92](https://github.com/code-423n4/2022-10-zksync/blob/358f38736351a8a27e325dfcb665eeba5ec02bd5/ethereum/contracts/bridge/L1EthBridge.sol#L92)<br>\n[Mailbox.sol#L112](https://github.com/code-423n4/2022-10-zksync/blob/358f38736351a8a27e325dfcb665eeba5ec02bd5/ethereum/contracts/zksync/facets/Mailbox.sol#L112)<br>\n\n## [06]\n\nFor each deposit of an ERC20 token, the information of the token is read and packed and sent to L2. Even if this token is used before for deposit, again this information is sent to L2, which is waste of gas.<br>\n[L1ERC20Bridge.sol#L164-L169](https://github.com/code-423n4/2022-10-zksync/blob/456078b53a6d09636b84522ac8f3e8049e4e3af5/ethereum/contracts/bridge/L1ERC20Bridge.sol#L164-L169)<br>\n[L1ERC20Bridge.sol#L155](https://github.com/code-423n4/2022-10-zksync/blob/456078b53a6d09636b84522ac8f3e8049e4e3af5/ethereum/contracts/bridge/L1ERC20Bridge.sol#L155)<br>\n\n## [07]\n\nWhen a block is committed, its hash will be stored in `storedBlockHashes`:<br>\n[Executor.sol#L164](https://github.com/code-423n4/2022-10-zksync/blob/358f38736351a8a27e325dfcb665eeba5ec02bd5/ethereum/contracts/zksync/facets/Executor.sol#L164)<br>\n\nIf this block is reverted, it is not removed from `storedBlockHashes`:<br>\n[Executor.sol#L336](https://github.com/code-423n4/2022-10-zksync/blob/358f38736351a8a27e325dfcb665eeba5ec02bd5/ethereum/contracts/zksync/facets/Executor.sol#L336)<br>\n\nThe vulnerability is that in the `GettersFacet`, the function `storedBlockHash(...)` will return the hash of a reverted block if this block number is given as its parameter, while it should return 0.<br>\n[Getters.sol#L86](https://github.com/code-423n4/2022-10-zksync/blob/358f38736351a8a27e325dfcb665eeba5ec02bd5/ethereum/contracts/zksync/facets/Getters.sol#L86)<br>\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-10-zksync-findings/issues/49#issuecomment-1325835625):**\n > **The critical parameters in initialize(...) are not set safely:**<br>\n> \n> Logically equivalent to address(0) check, Low\n> \n> **approveEmergencyDiamondCutAsSecurityCouncilMemberBySignature**<br>\n>\n> Not sure what this means, but if it means one caller gets to approve emerengency cuts, this is a glaring security risk.\n> \n> **Better to have config facet, in case some update is needed in the config.sol**<br>\n>\n> Not convinced by this one either, ultimately it's called config but it's just a bunch of contact / base contract\n> \n> **L2_LOG_BYTES is not correct, it should be `L2_TO_L1_LOG_SERIALIZE_SIZE`**<br>\n>\n> Non-Critical\n> \n> **It is not needed to have modifier senderCanCallFunction for the function deposit in both L1ERC20Bridge and L1ETHBridge, because they call the function requestL2Transaction in the MailBox that has already such modifier.**<br>\n>\n> Not convinced in lack of detail, if you call contract X and contract X calls contract Y, then the check is necessary on both contracts\n> \n> **For each deposit of an ERC20 token, the information**<br>\n>\n> Unclear what you'd do and where the savings would be.\n> \n> **When a block is committed, its hash will be stored in storedBlockHashes:**\n>\n> See [`#204`](https://github.com/code-423n4/2022-10-zksync-findings/issues/204), Low\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-10-zksync-findings/issues/49#issuecomment-1335920135):**\n > 2 Low, 1 Non-Critical\n>\n > Report was pretty good, but the downgraded findings add a lot of points to this QA.\n> \n> While the Warden has sent a few false positives, I think the value they offered for this contest warrants them winning the best QA report.\n\n*(Note: please see warden's [original submission](https://github.com/code-423n4/2022-10-zksync-findings/issues/49) for links to the referenced downgraded findings)*\n\n**[miladpiri (zkSync) commented](https://github.com/code-423n4/2022-10-zksync-findings/issues/49#issuecomment-1336268291):**\n >  Thanks, @Alex the Entreprenerd for your comment, that we are now looking at this report more seriously.<br>\n>\n> IMO, No.2 “approveEmergencyDiamondCutAsSecurityCouncilMemberBySignature“ can be a security issue. This is what we are now implementing to make security council members be able to approve the proposal by signature.<br>\n>\n> The security issue is that in case the security council members do not have access to approve on-chain, the governor must wait for their approval to bypass the notice period. In case the proposal should be executed instantly (in case of a critical bug in our protocol), this delay can be dangerous to our protocol.<br>\n>\n> By having approval by signature, the security members can approve a proposal off-chain, and the governor can execute the instant upgrade on behalf of them by using their signatures, so all-time access to the chain is not necessary for security council members.<br>\n>\n> Moreover, in case a critical proposal should be executed silently, it is necessary to be able to approve by signature. Because, the governor, in one batch transaction, proposes the proposal, and approves the upgrade on behalf of the security council members by using their signatures, and then executes the proposal. Since all the above actions are done in one transaction, there is no security risk of vulnerability leak. But, in the current structure, when the governor proposes the proposal, should wait for security members’ approval, this delay can be transparent to a malicious user to investigate the governor’s proposal, and gets a clue what the vulnerability is and then exploits the protocol.<br>\n>\n> This report worths to be upgraded in terms of severity!\n> Thanks.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-10-zksync-findings/issues/49#issuecomment-1340174006):**\n> Thank you for your insight, I have sent the contest to triage, took note of your feedback and am sharing with other Judges and Wardens.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-10-zksync-findings/issues/49#issuecomment-1343557528):**\n > Similarly to [`#48`](https://github.com/code-423n4/2022-10-zksync-findings/issues/48), I have shared this finding with 2 Judges and a Top warden and we all agree that this is effectively the same finding, with similar impact.\n> \n> As such Low Severity is the most appropriate.\n\n**[miladpiri (zkSync) commented](https://github.com/code-423n4/2022-10-zksync-findings/issues/49#issuecomment-1343993682):**\n > Thanks for the follow-up!\n\n\n\n***\n\n# Gas Optimizations\n\nFor this contest, 10 reports were submitted by wardens detailing gas optimizations. The [report highlighted below](https://github.com/code-423n4/2022-10-zksync-findings/issues/35) by **0x1f8b** received the top score from the judge.\n\n*The following wardens also submitted reports: [Aymen0909](https://github.com/code-423n4/2022-10-zksync-findings/issues/341), [c3phas](https://github.com/code-423n4/2022-10-zksync-findings/issues/337), [TomJ](https://github.com/code-423n4/2022-10-zksync-findings/issues/282), [gogo](https://github.com/code-423n4/2022-10-zksync-findings/issues/233), [IllIllI](https://github.com/code-423n4/2022-10-zksync-findings/issues/224), [ReyAdmirado](https://github.com/code-423n4/2022-10-zksync-findings/issues/124), [mcwildy](https://github.com/code-423n4/2022-10-zksync-findings/issues/117), [Rolezn](https://github.com/code-423n4/2022-10-zksync-findings/issues/111), and [HardlyCodeMan](https://github.com/code-423n4/2022-10-zksync-findings/issues/80).*\n\n**Disclosure Note from 0x1f8b:**\n\n*First of all, please note that there are \"known issues\" that were not referenced in the [report](https://gist.github.com/Picodes/1f87a82e954cc749dea9d9961d5f4dff), these lines were included in this report because they were not present in the public one.*\n\n## [G-01] Use `require` instead of `assert`\n\nThe `assert()` and `require()` functions are a part of the error handling aspect in Solidity. Solidity makes use of state-reverting error handling exceptions. This means all changes made to the contract on that call or any sub-calls are undone if an error is thrown. It also flags an error.\n\nThey are quite similar as both check for conditions and if they are not met, would throw an error.\n\nThe big difference between the two is that the `assert()` function when false, **uses up all the remaining gas and reverts all the changes made.**\n\nMeanwhile, a `require()` function when false, also reverts back all the changes made to the contract but **does refund all the remaining gas fees we offered to pay**. This is the most common Solidity function used by developers for debugging and error handling.\n\n**Affected source code:**\n\n*   [DiamondCut.sol:16](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/facets/DiamondCut.sol#L16)\n\n## [G-02] Avoid compound assignment operator in state variables\n\nUsing compound assignment operators for state variables (like `State += X` or `State -= X` ...) it's more expensive than using operator assignment (like `State = State + X` or `State = State - X` ...).\n\n**Proof of concept (*without optimizations*):**\n\n```javascript\npragma solidity 0.8.15;\n\ncontract TesterA {\nuint private _a;\nfunction testShort() public {\n_a += 1;\n}\n}\n\ncontract TesterB {\nuint private _a;\nfunction testLong() public {\n_a = _a + 1;\n}\n}\n```\n\nGas saving executing: **13 per entry**\n\n    TesterA.testShort: 43507\n    TesterB.testLong:  43494\n\n**Affected source code:**\n\n*   [DiamondCut.sol:29](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/facets/DiamondCut.sol#L29)\n\n### Total gas saved: **13 &ast; 1 = 13**\n\n## [G-03] Use `calldata` instead of `memory`\n\nSome methods are declared as `external` but the arguments are defined as `memory` instead of as `calldata`.\n\nBy marking the function as `external` it is possible to use `calldata` in the arguments shown below and save significant gas.\n\n**Recommended change:**\n\n```diff\n-   function decodeString(bytes memory _input) external pure returns (string memory result) {\n+   function decodeString(bytes calldata _input) external pure returns (string memory result) {\n        (result) = abi.decode(_input, (string));\n    }\n```\n\n**Affected source code:**\n\n*   [ExternalDecoder.sol:10-12](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/zksync/contracts/ExternalDecoder.sol#L10-L12)\n*   [ExternalDecoder.sol:15-17](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/zksync/contracts/ExternalDecoder.sol#L15-L17)\n\n## [G-04] Shift right or left instead of dividing or multiply by 2\n\nShifting one to the right will calculate a division by two.\n\nhe `SHR` opcode only requires 3 gas, compared to the `DIV` opcode's consumption of 5. Additionally, shifting is used to get around Solidity's division operation's division-by-0 prohibition.\n\n**Proof of concept (*without optimizations*):**\n\n```javascript\npragma solidity 0.8.16;\n\ncontract TesterA {\nfunction testDiv(uint a) public returns (uint) { return a / 2; }\n}\n\ncontract TesterB {\nfunction testShift(uint a) public returns (uint) { return a >> 1; }\n}\n```\n\nGas saving executing: **172 per entry**\n\n    TesterA.testDiv:    21965 \n    TesterB.testShift:  21793   \n\nThe same optimization can be used to multiply by 2, using the left shift.\n\n```javascript\npragma solidity 0.8.16;\n\ncontract TesterA {\nfunction testMul(uint a) public returns (uint) { return a * 2; }\n}\n\ncontract TesterB {\nfunction testShift(uint a) public returns (uint) { return a << 1; }\n}\n```\n\nGas saving executing: **201 per entry**\n\n    TesterA.testMul:    21994\n    TesterB.testShift:  21793    \n\n**Affected source code:**\n\n`/`:\n\n*   [Merkle.sol:34](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/libraries/Merkle.sol#L34)\n\n### Total gas saved: **(172 &ast; 1) = 172**\n\n## [G-05] There's no need to set default values for variables\n\nIf a variable is not set/initialized, the default value is assumed (0, `false`, 0x0 ... depending on the data type). You are simply wasting gas if you directly initialize it with its default value.\n\n**Proof of concept (*without optimizations*):**\n\n```javascript\npragma solidity 0.8.15;\n\ncontract TesterA {\nfunction testInit() public view returns (uint) { uint a = 0; return a; }\n}\n\ncontract TesterB {\nfunction testNoInit() public view returns (uint) { uint a; return a; }\n}\n```\n\nGas saving executing: **8 per entry**\n\n    TesterA.testInit:   21392\n    TesterB.testNoInit: 21384\n\n**Affected source code:**\n\n*   [L1EthBridge.sol:33](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/bridge/L1EthBridge.sol#L33)\n*   [L2ETHBridge.sol:28](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/zksync/contracts/bridge/L2ETHBridge.sol#L28)\n\n### Total gas saved: **8 &ast; 2 = 16**\n\n## [G-06] Unnecessary cast in `Mailbox.serializeL2Transaction`\n\nIt's possible to remove the following casts:\n\n```diff\n    function serializeL2Transaction(\n        uint256 _txId,\n        uint256 _l2Value,\n        address _sender,\n        address _contractAddressL2,\n        bytes calldata _calldata,\n        uint256 _ergsLimit,\n        bytes[] calldata _factoryDeps\n    ) public pure returns (L2CanonicalTransaction memory) {\n        return\n            L2CanonicalTransaction({\n                txType: PRIORITY_OPERATION_L2_TX_TYPE,\n                from: uint256(uint160(_sender)),\n                to: uint256(uint160(_contractAddressL2)),\n                ergsLimit: _ergsLimit,\n                ergsPerPubdataByteLimit: uint256(1),\n                maxFeePerErg: uint256(0),\n                maxPriorityFeePerErg: uint256(0),\n                paymaster: uint256(0),\n-               reserved: [uint256(_txId), _l2Value, 0, 0, 0, 0],\n+               reserved: [_txId, _l2Value, 0, 0, 0, 0],\n                data: _calldata,\n                signature: new bytes(0),\n                factoryDeps: _hashFactoryDeps(_factoryDeps),\n                paymasterInput: new bytes(0),\n                reservedDynamic: new bytes(0)\n            });\n    }\n```\n\n**Affected source code:**\n\n*   [Mailbox.sol:206](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/facets/Mailbox.sol#L206)\n\n## [G-07] Gas saving using `immutable`\n\nIt's possible to avoid storage access a save gas using `immutable` keyword for the following variables:\n\nIt's also better to remove the initial values, because they will be set during the constructor.\n\n**Affected source code:**\n\n*   [L2ERC20Bridge.sol:19](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/zksync/contracts/bridge/L2ERC20Bridge.sol#L19)\n*   [L2ERC20Bridge.sol:23](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/zksync/contracts/bridge/L2ERC20Bridge.sol#L23)\n*   [L2ERC20Bridge.sol:26](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/zksync/contracts/bridge/L2ERC20Bridge.sol#L26)\n*   [L2ETHBridge.sol:22](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/zksync/contracts/bridge/L2ETHBridge.sol#L22)\n\n## [G-08] Reorder structure layout\n\nThe following structs could be optimized moving the position of certains values in order to save slot storages:\n\n`StoredBlockInfo` in [IExecutor.sol#L15-L24](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/interfaces/IExecutor.sol#L15-L24)\n\n```diff\n    struct StoredBlockInfo {\n        uint64 blockNumber;\n+       uint64 indexRepeatedStorageChanges;\n        bytes32 blockHash;\n-       uint64 indexRepeatedStorageChanges;\n        uint256 numberOfLayer1Txs;\n        bytes32 priorityOperationsHash;\n        bytes32 l2LogsTreeRoot;\n        uint256 timestamp;\n        bytes32 commitment;\n    }\n```\n\n`AppStorage` in [Storage.sol:69-106](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/Storage.sol#L69-L106)\n\n```diff\nstruct AppStorage {\n    /// @dev Storage of variables needed for diamond cut facet\n    DiamondCutStorage diamondCutStorage;\n    /// @notice Address which will exercise governance over the network i.e. change validator set, conduct upgrades\n    address governor;\n+   bool zkPorterIsAvailable;\n    /// @notice Address that governor proposed as one that will replace it\n    address pendingGovernor;\n    /// @notice List of permitted validators\n    mapping(address => bool) validators;\n    /// @dev Verifier contract. Used to verify aggregated proof for blocks\n    Verifier verifier;\n    /// @notice Total number of executed blocks i.e. blocks[totalBlocksExecuted] points at the latest executed block (block 0 is genesis)\n    uint256 totalBlocksExecuted;\n    /// @notice Total number of proved blocks i.e. blocks[totalBlocksProved] points at the latest proved block\n    uint256 totalBlocksVerified;\n    /// @notice Total number of committed blocks i.e. blocks[totalBlocksCommitted] points at the latest committed block\n    uint256 totalBlocksCommitted;\n    /// @dev Stored hashed StoredBlock for block number\n    mapping(uint256 => bytes32) storedBlockHashes;\n    /// @dev Stored root hashes of L2 -> L1 logs\n    mapping(uint256 => bytes32) l2LogsRootHashes;\n    /// @dev Container that stores transactions requested from L1\n    PriorityQueue.Queue priorityQueue;\n    /// @dev The smart contract that manages the list with permission to call contract functions\n    IAllowList allowList;\n    /// @notice Part of the configuration parameters of ZKP circuits. Used as an input for the verifier smart contract\n    VerifierParams verifierParams;\n    /// @notice Bytecode hash of bootloader program.\n    /// @dev Used as an input to zkp-circuit.\n    bytes32 l2BootloaderBytecodeHash;\n    /// @notice Bytecode hash of default account (bytecode for EOA).\n    /// @dev Used as an input to zkp-circuit.\n    bytes32 l2DefaultAccountBytecodeHash;\n    /// @dev Indicates that the porter may be touched on L2 transactions.\n    /// @dev Used as an input to zkp-circuit.\n-   bool zkPorterIsAvailable;\n}\n```\n\n## [G-09] Use `require` instead of `assert`\n\nThe `assert()` and `require()` functions are a part of the error handling aspect in Solidity. Solidity makes use of state-reverting error handling exceptions. This means all changes made to the contract on that call or any sub-calls are undone if an error is thrown. It also flags an error.\n\nThey are quite similar as both check for conditions and if they are not met, would throw an error.\n\nThe big difference between the two is that the `assert()` function when false, **uses up all the remaining gas and reverts all the changes made.**\n\nMeanwhile, a `require()` function when false, also reverts back all the changes made to the contract but **does refund all the remaining gas fees we offered to pay**. This is the most common Solidity function used by developers for debugging and error handling.\n\n**Affected source code:**\n\n*   [DiamondCut.sol:16](https://github.com/code-423n4/2022-10-zksync/blob/4db6c596931a291b17a4e0e2929adf810a4a0eed/ethereum/contracts/zksync/facets/DiamondCut.sol#L16)\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-10-zksync-findings/issues/35#issuecomment-1326853179):**\n > **[G-01] Use require instead of assert**<br>\n> Valid but will only run in constructor so ignoring\n> \n> **[G-02] Avoid compound assignment operator in state variables**<br>\n> Awarding 34 as that's what I get when changing the in-scope tests\n> \n> **[G-03] Use calldata instead of memory**<br>\n> Cannot test the benchmark, but it's roughly in the hundreds, let's say 200 gas\n> \n> **[G-04] Shift right or left instead of dividing or multiply by 2**<br>\n> This mostly saves gas because of the unchecked, let's say 100 gas\n> \n> **[G-05] There's no need to set default values for variables**<br>\n> Those are constants, will be inlined by the compiler\n> \n> **[G-06] Unnecessary cast in Mailbox.serializeL2Transaction**<br>\n> The cast should be optimized away by the compiler as no supporting variable is declared\n> \n> **[G-07] Gas saving using immutable**<br>\n> 2.1k per var<br>\n> 8.4k<br>\n> \n> **[G-08] Reorder structure layout**<br>\n> 2k each as it will save one extra cold Slot Load<br>\n> 4k\n> \n> Pretty good, but would benefit by using benchmarks from the codebase in-scope.\n>\n > 10734\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-10-zksync-findings/issues/35#issuecomment-1336220069):**\n > Ultimately offered the strongest savings via immutables and did not offer false positives vs other reports, also found the packing refactoring which will offer great savings to end users.\n\n\n\n***\n\n# Disclosures\n\nC4 is an open organization governed by participants in the community.\n\nC4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.\n\nC4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.\n"
}