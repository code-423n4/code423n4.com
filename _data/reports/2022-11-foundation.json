{
  "circa": {
    "title": "Foundation Exhibition, Scheduling & Early Access Solo Audit by Lambda",
    "sponsor": "Foundation",
    "slug": "2022-11-foundation",
    "date": "2022-12-14",
    "findings": "",
    "contest": 197
  },
  "html": "<h1 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h1>\n<h2 id=\"about-c4\" style=\"position:relative;\"><a href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>About C4</h2>\n<p>Code4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts. </p>\n<p>A C4 Solo Audit is an event where a top Code4rena contributor, commonly referred to as a warden or a team, reviews, audits and analyzes smart contract logic in exchange for a bounty provided by sponsoring projects.</p>\n<p>During the Solo Audit outlined in this document, C4 conducted an analysis of the Foundation code. The audit took place between November 21-28, 2022.</p>\n<h2 id=\"wardens\" style=\"position:relative;\"><a href=\"#wardens\" aria-label=\"wardens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wardens</h2>\n<p>Audit completed by Lambda.</p>\n<p>Final report assembled by <a href=\"https://twitter.com/itsmetechjay\">itsmetechjay</a>.</p>\n<h1 id=\"summary\" style=\"position:relative;\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h1>\n<p>The Foundation Exhibition, Scheduling &#x26; Early Access Solo Audit yielded 3 MEDIUM vulnerabilities. There were also 7 informational findings and 1 gas optimization reported.</p>\n<p>The codebase in question had already undergone two prior Code4rena contests. Since the last audit, exhibitions (listing NFTs with a curator that gets part of the final sale price) and the possibility to set early access periods for drop markets were added.</p>\n<h1 id=\"scope\" style=\"position:relative;\"><a href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scope</h1>\n<p>Code reviewed consisted of the following contracts:</p>\n<table>\n<thead>\n<tr>\n<th>Contract Name</th>\n<th>SLOC</th>\n<th>Purpose</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/NFTDropMarket.sol\">NFTDropMarket</a></td>\n<td>63</td>\n<td>The main / top-level contract for all drop market tools on Foundation.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/shared/FoundationTreasuryNode.sol\">FoundationTreasuryNode</a></td>\n<td>34</td>\n<td>A wrapper for communicating with the treasury contract which collects Foundation fees and defines the central roles.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/shared/FETHNode.sol\">FETHNode</a></td>\n<td>35</td>\n<td>A wrapper for communicating with the FETH contract.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/shared/MarketSharedCore.sol\">MarketSharedCore</a></td>\n<td>7</td>\n<td>A base class for Foundation market contracts to define functions that other market contract may implement or extend.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/nftDropMarket/NFTDropMarketCore.sol\">NFTDropMarketCore</a></td>\n<td>4</td>\n<td>A base class for the drop specific market contract to define functions that other mixins may implement or extend.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/shared/SendValueWithFallbackWithdraw.sol\">SendValueWithFallbackWithdraw</a></td>\n<td>19</td>\n<td>A helper function to handle funds transfers.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/shared/MarketFees.sol\">MarketFees</a></td>\n<td>331</td>\n<td>Distributes revenue from sales.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/shared/Gap500.sol\">Gap500</a></td>\n<td>4</td>\n<td>A placeholder contract leaving room for new mixins to be added to the future in an upgrade safe fashion.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/shared/Gap10000.sol\">Gap10000</a></td>\n<td>4</td>\n<td>A placeholder contract leaving room for new mixins to be added to the future in an upgrade safe fashion.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/nftDropMarket/NFTDropMarketFixedPriceSale.sol\">NFTDropMarketFixedPriceSale</a></td>\n<td>253</td>\n<td>Allows creators to list a drop collection for sale at a fixed price point.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/libraries/ArrayLibrary.sol\">ArrayLibrary</a></td>\n<td>17</td>\n<td>Helper functions for resizing arrays.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/shared/Constants.sol\">Constants</a></td>\n<td>10</td>\n<td>Shared constant values used by various mixins.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/libraries/MerkleAddressLibrary.sol\">MerkleAddressLibrary</a></td>\n<td>9</td>\n<td>A wrapper for validating merkle proofs for a tree containing a list of addresses.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/libraries/TimeLibrary.sol\">TimeLibrary</a></td>\n<td>9</td>\n<td>Simple time checks to improve code readability &#x26; ensure consistency.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/ExhibitionMarketMock.sol\">ExhibitionMarketMock </a></td>\n<td>63</td>\n<td>A subset of the NFTMarket contract including auctions &#x26; exhibitions.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/nftMarket/NFTMarketCore.sol\">NFTMarketCore</a></td>\n<td>44</td>\n<td>A base class for the market contract to define functions that other mixins may implement or extend.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/nftMarket/NFTMarketExhibition.sol\">NFTMarketExhibition</a></td>\n<td>127</td>\n<td>Adds exhibitions to the marketplace.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/nftMarket/NFTMarketAuction.sol\">NFTMarketAuction</a></td>\n<td>14</td>\n<td>A base for reserve auctions which may be shared with other auction types in the future.</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/nftMarket/NFTMarketReserveAuction.sol\">NFTMarketReserveAuction</a></td>\n<td>319</td>\n<td>Adds support for reserve auctions to the marketplace.</td>\n</tr>\n<tr>\n<td><strong>Total</strong> 19 files</td>\n<td>1,366</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"severity-criteria\" style=\"position:relative;\"><a href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Severity Criteria</h1>\n<p>C4 assesses the severity of disclosed vulnerabilities according to a methodology based on <a href=\"https://owasp.org/www-community/OWASP_Risk_Rating_Methodology\">OWASP standards</a>.</p>\n<p>Vulnerabilities are divided into three primary risk categories: high, medium, and low/non-critical.</p>\n<p>High-level considerations for vulnerabilities span the following key areas when conducting assessments:</p>\n<ul>\n<li>Malicious Input Handling</li>\n<li>Escalation of privileges</li>\n<li>Arithmetic</li>\n<li>Gas use</li>\n</ul>\n<p>Further information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on <a href=\"https://code4rena.com\">the C4 website</a>.</p>\n<h1 id=\"medium-risk-findings-3\" style=\"position:relative;\"><a href=\"#medium-risk-findings-3\" aria-label=\"medium risk findings 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Medium Risk Findings (3)</h1>\n<h2 id=\"m-01-marketfees-seller-referrer-fee-not-paid-when-no-creator-royalty-recipients-exist-for-a-sale\" style=\"position:relative;\"><a href=\"#m-01-marketfees-seller-referrer-fee-not-paid-when-no-creator-royalty-recipients-exist-for-a-sale\" aria-label=\"m 01 marketfees seller referrer fee not paid when no creator royalty recipients exist for a sale permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[M-01] <code>MarketFees</code>: Seller referrer fee not paid when no creator royalty recipients exist for a sale</h2>\n<p>The logic to calculate the seller referrer fee is within the following <code>if</code> block:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">creatorRecipients</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> != </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">assumePrimarySale</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>When <code>creatorRecipients.length == 0</code> and <code>assumePrimarySale == false</code> (which is the case for <code>ExhibitionMarketMock</code>), the returned <code>sellerReferrerFee</code> will always be zero, no matter which value is passed for <code>sellerReferrerTakeRateInBasisPoints</code>. Therefore, the exhibition curator will not get the configured fee in such a scenario, although the seller referral fee should not depend on the existence of creator royalty recipients.</p>\n<h3 id=\"link-to-affected-code\" style=\"position:relative;\"><a href=\"#link-to-affected-code\" aria-label=\"link to affected code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Link To Affected Code</h3>\n<p><a href=\"https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/shared/MarketFees.sol#L530\">https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/shared/MarketFees.sol#L530</a></p>\n<h3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Calculate the seller referrer fee also when no creator royalty recipients are defined (like it is done for the buyer referrer fee).</p>\n<h2 id=\"m-02-marketfees-primary-sales-not-detected-in-some-scenarios\" style=\"position:relative;\"><a href=\"#m-02-marketfees-primary-sales-not-detected-in-some-scenarios\" aria-label=\"m 02 marketfees primary sales not detected in some scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[M-02] <code>MarketFees</code>: Primary sales not detected in some scenarios</h2>\n<p>When the seller is also a recipient of the creator royalties, a primary sale is assumed and <code>sellerRev</code> is set to 0:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">creatorRecipients</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">] == </span><span class=\"mtk12\">seller</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk3\">// If the seller is any of the recipients defined, assume a primary sale</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk12\">creatorRev</span><span class=\"mtk1\"> += </span><span class=\"mtk12\">sellerRev</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk12\">sellerRev</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span></code></pre>\n<p>However, this loop is exited prematurely when one of the <code>creatorShares</code> entries is greater than <code>BASIS_POINTS</code>:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">creatorShares</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">] &gt; </span><span class=\"mtk12\">BASIS_POINTS</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk3\">// If the numbers are &gt;100% we ignore the fee recipients and pay just the first instead</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk12\">totalShares</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk15\">break</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span></code></pre>\n<p>Therefore, there can be scenarios where it is not detected that the seller is a recipient of the creator royalties and a secondary sale is assumed. For instance, if <code>creatorRecipients</code> is <code>[address(Bob), address(Alice), seller]</code> and <code>creatorShares</code> is <code>[100, 10_001, 100]</code>, the loop will <code>break</code> in the second iteration and <code>sellerRev</code> will not be set to 0.</p>\n<h3 id=\"link-to-affected-code-1\" style=\"position:relative;\"><a href=\"#link-to-affected-code-1\" aria-label=\"link to affected code 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Link To Affected Code</h3>\n<p><a href=\"https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/shared/MarketFees.sol#L555\">https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/shared/MarketFees.sol#L555</a></p>\n<h3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Continue looping to detect if the seller is a creator royalty recipient, even if one <code>creatorShares</code> entry was invalid.</p>\n<h2 id=\"m-03-marketfees-seller-referrer-fee-can-underflow\" style=\"position:relative;\"><a href=\"#m-03-marketfees-seller-referrer-fee-can-underflow\" aria-label=\"m 03 marketfees seller referrer fee can underflow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[M-03] <code>MarketFees</code>: Seller referrer fee can underflow</h2>\n<p>In <code>MarketFees._getFees</code>, the <code>sellerReferrerFee</code> is deducted from <code>creatorRev</code> or <code>sellerRev</code> (depending on if the sale is primary / secondary):</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">sellerReferrerTakeRateInBasisPoints</span><span class=\"mtk1\"> != </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">sellerReferrerFee</span><span class=\"mtk1\"> = (</span><span class=\"mtk12\">price</span><span class=\"mtk1\"> * </span><span class=\"mtk12\">sellerReferrerTakeRateInBasisPoints</span><span class=\"mtk1\">) / </span><span class=\"mtk12\">BASIS_POINTS</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Subtract the seller referrer fee from the seller revenue so we do not double pay.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">sellerRev</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk3\">// If the seller revenue is 0, this is a primary sale where all seller revenue is attributed to the &quot;creator&quot;.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">creatorRev</span><span class=\"mtk1\"> -= </span><span class=\"mtk12\">sellerReferrerFee</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">sellerRev</span><span class=\"mtk1\"> -= </span><span class=\"mtk12\">sellerReferrerFee</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      }</span></span></span></code></pre>\n<p><code>sellerReferrerTakeRateInBasisPoints</code> can be up to 5,000 (50%), because the exhibition take rate (which is the only case when a non-zero value is passed) needs to be smaller than <code>MAX_TAKE_RATE</code>. On the other hand, it is only enforced that the protocol fee plus the creator royalty percentage is smaller than 100%:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">protocolFeeInBasisPoints</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">BASIS_POINTS</span><span class=\"mtk1\"> / </span><span class=\"mtk12\">BUY_REFERRER_FEE_DENOMINATOR</span><span class=\"mtk1\"> ||</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">protocolFeeInBasisPoints</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">BASIS_POINTS</span><span class=\"mtk1\"> / </span><span class=\"mtk12\">CREATOR_ROYALTY_DENOMINATOR</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">BASIS_POINTS</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\">/* If the protocol fee is invalid, revert:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">       * Protocol fee must be greater than the buy referrer fee since referrer fees are deducted from the protocol fee.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">       * The protocol fee must leave room for the creator royalties.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">       */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">NFTMarketFees_Invalid_Protocol_Fee</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>Because of that, there are valid settings where the calculation will underflow, leading to sales that do not succeed. For instance, we can have a protocol fee of 20% and creator royalties of 35%, in which case <code>sellerRev</code> would be 45% of the overall price. If the exhibition take rate is then >45%, the calculation will underflow.</p>\n<h3 id=\"link-to-affected-code-2\" style=\"position:relative;\"><a href=\"#link-to-affected-code-2\" aria-label=\"link to affected code 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Link To Affected Code</h3>\n<p><a href=\"https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/shared/MarketFees.sol#L534\">https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/shared/MarketFees.sol#L534</a></p>\n<h3 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>There are two options to solve the problem:</p>\n<ul>\n<li>Enforce that the protocol fee plus the creator royalty percentage is less than 50%.</li>\n<li>Handle the underflow case explicitly and for instance cap the seller referrer fee if it would exceed the seller revenue.</li>\n</ul>\n<h1 id=\"informational-findings-7\" style=\"position:relative;\"><a href=\"#informational-findings-7\" aria-label=\"informational findings 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Informational Findings (7)</h1>\n<h2 id=\"info-01-nftmarketexhibition-_getandremovenftfromexhibition-does-not-emit-nftremovedfromexhibition\" style=\"position:relative;\"><a href=\"#info-01-nftmarketexhibition-_getandremovenftfromexhibition-does-not-emit-nftremovedfromexhibition\" aria-label=\"info 01 nftmarketexhibition _getandremovenftfromexhibition does not emit nftremovedfromexhibition permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[Info-01] <code>NFTMarketExhibition</code>: <code>_getAndRemoveNftFromExhibition</code> does not emit <code>NftRemovedFromExhibition</code></h2>\n<p>Unlike the function <code>_removeNftFromExhibition</code>, <code>_getAndRemoveNftFromExhibition</code> does not emit the event <code>NftRemovedFromExhibition</code> when an NFT is removed from an exhibition. This can be problematic for blockchain indexing solutions that rely on events (for instance, to track which NFTs are listed in which exhibition), as they will not detect the removal when an NFT is sold via a reserve auction.</p>\n<h3 id=\"link-to-affected-code-3\" style=\"position:relative;\"><a href=\"#link-to-affected-code-3\" aria-label=\"link to affected code 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Link To Affected Code</h3>\n<p><a href=\"https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftMarket/NFTMarketExhibition.sol#L199\">https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftMarket/NFTMarketExhibition.sol#L199</a></p>\n<h3 id=\"recommended-mitigation-steps-3\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-3\" aria-label=\"recommended mitigation steps 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Also emit the event in <code>_getAndRemoveNftFromExhibition</code></p>\n<h2 id=\"info-02-nftmarketexhibition-behavior-of-getexhibition-for-non-existing-exhibition-ids\" style=\"position:relative;\"><a href=\"#info-02-nftmarketexhibition-behavior-of-getexhibition-for-non-existing-exhibition-ids\" aria-label=\"info 02 nftmarketexhibition behavior of getexhibition for non existing exhibition ids permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[Info-02] <code>NFTMarketExhibition</code>: Behavior of <code>getExhibition</code> for non-existing exhibition IDs</h2>\n<p>When a non-existing exhibition ID is passed to <code>getExhibition</code>, the default values (empty string, <code>address(0)</code>, and 0) will be returned for all parameters. Because of that, it may not be clear for integrators how to check the existence of an exhibition. As an empty string is a valid value for the name and the take rate can be 0, the only reliable way is to check if the curator is equal to <code>address(0)</code>. If an integrator decides to use another value, the check will be unreliable. </p>\n<h3 id=\"link-to-affected-code-4\" style=\"position:relative;\"><a href=\"#link-to-affected-code-4\" aria-label=\"link to affected code 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Link To Affected Code</h3>\n<p><a href=\"https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftMarket/NFTMarketExhibition.sol#L224\">https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftMarket/NFTMarketExhibition.sol#L224</a></p>\n<h3 id=\"recommended-mitigation-steps-4\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-4\" aria-label=\"recommended mitigation steps 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Either revert for non-existing exhibitions or document clearly how a non-existing exhibition will be returned.</p>\n<h2 id=\"info-03-nftmarketreserveauction-event-reserveauctioncreated-does-not-include-exhibition-id\" style=\"position:relative;\"><a href=\"#info-03-nftmarketreserveauction-event-reserveauctioncreated-does-not-include-exhibition-id\" aria-label=\"info 03 nftmarketreserveauction event reserveauctioncreated does not include exhibition id permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[Info-03] <code>NFTMarketReserveAuction</code>: Event <code>ReserveAuctionCreated</code> does not include exhibition ID</h2>\n<p>The event <code>ReserveAuctionCreated</code> that is emitted within <code>createReserveAuctionV2</code> does not include the exhibition ID. Because the exhibition ID determines the seller referrer fee, this information may be important for blockchain indexing solutions or other applications that consume these events.</p>\n<h3 id=\"link-to-affected-code-5\" style=\"position:relative;\"><a href=\"#link-to-affected-code-5\" aria-label=\"link to affected code 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Link To Affected Code</h3>\n<p><a href=\"https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftMarket/NFTMarketReserveAuction.sol#L309\">https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftMarket/NFTMarketReserveAuction.sol#L309</a></p>\n<h3 id=\"recommended-mitigation-steps-5\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-5\" aria-label=\"recommended mitigation steps 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Consider adding the exhibition ID to the event.</p>\n<h2 id=\"info-04-nftdropmarketfixedpricesale-provided-start-times-can-be-arbitrarily-far-in-the-future\" style=\"position:relative;\"><a href=\"#info-04-nftdropmarketfixedpricesale-provided-start-times-can-be-arbitrarily-far-in-the-future\" aria-label=\"info 04 nftdropmarketfixedpricesale provided start times can be arbitrarily far in the future permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[Info-04] <code>NFTDropMarketFixedPriceSale</code>: Provided start times can be arbitrarily far in the future</h2>\n<p>While <code>_createFixedPriceSale</code> validates that the provided start times (early access and general availability) are not in the past, they can be arbitrarily far (up to February 2106) in the future. Therefore, when a user submits a completely wrong timestamp by mistake, the sale will still be created.</p>\n<h3 id=\"link-to-affected-code-6\" style=\"position:relative;\"><a href=\"#link-to-affected-code-6\" aria-label=\"link to affected code 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Link To Affected Code</h3>\n<p><a href=\"https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftDropMarket/NFTDropMarketFixedPriceSale.sol#L295\">https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftDropMarket/NFTDropMarketFixedPriceSale.sol#L295</a></p>\n<h3 id=\"recommended-mitigation-steps-6\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-6\" aria-label=\"recommended mitigation steps 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>To catch user errors, consider adding an upper limit on the time delta (for instance 4 years).</p>\n<h2 id=\"info-05-nftdropmarketfixedpricesale-getfixedpricesale-may-return-0-for-generalavailabilitystarttime-of-valid-sale\" style=\"position:relative;\"><a href=\"#info-05-nftdropmarketfixedpricesale-getfixedpricesale-may-return-0-for-generalavailabilitystarttime-of-valid-sale\" aria-label=\"info 05 nftdropmarketfixedpricesale getfixedpricesale may return 0 for generalavailabilitystarttime of valid sale permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[Info-05] <code>NFTDropMarketFixedPriceSale</code>: <code>getFixedPriceSale</code> may return 0 for <code>generalAvailabilityStartTime</code> of valid sale</h2>\n<p>As an optimization, <code>_createFixedPriceSale</code> does not store the <code>generalAvailabilityStartTime</code> when it is equal to the current block timestamp (because the business logic does not need the value then):</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">generalAvailabilityStartTime</span><span class=\"mtk1\"> != </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\">// If starting now we don&#39;t need to write to storage</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">saleConfig</span><span class=\"mtk1\">.</span><span class=\"mtk12\">generalAvailabilityStartTime</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">generalAvailabilityStartTime</span><span class=\"mtk1\">.</span><span class=\"mtk11\">toUint32</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>However, this also means that <code>getFixedPriceSale</code> will set <code>generalAvailabilityStartTime</code> to 0 for such sales. Therefore, there is for instance no way to figure out the time that has passed since the general availability start time (which applications that build on top of Foundation might want to do) in these scenarios.</p>\n<h3 id=\"link-to-affected-code-7\" style=\"position:relative;\"><a href=\"#link-to-affected-code-7\" aria-label=\"link to affected code 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Link To Affected Code</h3>\n<p><a href=\"https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftDropMarket/NFTDropMarketFixedPriceSale.sol#L361\">https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftDropMarket/NFTDropMarketFixedPriceSale.sol#L361</a></p>\n<h3 id=\"recommended-mitigation-steps-7\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-7\" aria-label=\"recommended mitigation steps 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Consider still setting <code>generalAvailabilityStartTime</code> in these cases, even if gas usage increases slightly.</p>\n<h2 id=\"info-06-nftdropmarketfixedpricesale-fixed-merkle-root-per-sale-may-be-restricting\" style=\"position:relative;\"><a href=\"#info-06-nftdropmarketfixedpricesale-fixed-merkle-root-per-sale-may-be-restricting\" aria-label=\"info 06 nftdropmarketfixedpricesale fixed merkle root per sale may be restricting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[Info-06] <code>NFTDropMarketFixedPriceSale</code>: Fixed merkle root per sale may be restricting</h2>\n<p>The creator of a sale cannot add a new merkle root for a sale or change the current one. This may be very restricting in some scenarios. For instance, it could happen that an error occurred during the calculation of the root or that one address needs to be changed (for instance, because a user lost his private key).</p>\n<h3 id=\"link-to-affected-code-8\" style=\"position:relative;\"><a href=\"#link-to-affected-code-8\" aria-label=\"link to affected code 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Link To Affected Code</h3>\n<p><a href=\"https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftDropMarket/NFTDropMarketFixedPriceSale.sol#L367\">https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftDropMarket/NFTDropMarketFixedPriceSale.sol#L367</a></p>\n<h3 id=\"recommended-mitigation-steps-8\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-8\" aria-label=\"recommended mitigation steps 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>According to a comment in <code>NFTDropMarketFixedPriceSale</code>, multiple merkle roots per sale are planned as a future feature. However, as a temporary solution, the possibility to at least replace the current one (e.g., where the seller has to provide the old one and the new one) could help in the described situations.</p>\n<h2 id=\"info-07-undocumented-parameters\" style=\"position:relative;\"><a href=\"#info-07-undocumented-parameters\" aria-label=\"info 07 undocumented parameters permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[Info-07] Undocumented parameters</h2>\n<p>In a two places, a parameter is missing in the documentation:</p>\n<ul>\n<li><a href=\"https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftMarket/NFTMarketExhibition.sol#L84\">NFTMarketExhibition</a>: <code>exhibitionId</code> within the event <code>NftRemovedFromExhibition</code></li>\n<li><a href=\"https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftMarket/NFTMarketReserveAuction.sol#L348\">NFTMarketReserveAuction</a>: The parameter <code>referrer</code> of <code>placeBidV2</code> is not documented.</li>\n</ul>\n<h1 id=\"gas-optimizations-1\" style=\"position:relative;\"><a href=\"#gas-optimizations-1\" aria-label=\"gas optimizations 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gas Optimizations (1)</h1>\n<h2 id=\"g-01-nftmarketexhibitioncreateexhibition-unnecessary-storage-read\" style=\"position:relative;\"><a href=\"#g-01-nftmarketexhibitioncreateexhibition-unnecessary-storage-read\" aria-label=\"g 01 nftmarketexhibitioncreateexhibition unnecessary storage read permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-01] <code>NFTMarketExhibition.createExhibition</code>: Unnecessary storage read</h2>\n<p>In line 138 of <code>NFTMarketExhibition</code>, instead of reading <code>idToExhibition[exhibitionId].curator</code>, <code>curator</code> can be set to <code>msg.sender</code>, resulting in the following reduction of gas usage when creating exhibitions:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">7,10c7,10</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">&lt;     108’739 - w/ 1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">&lt;     132’430 - w/ 2</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">&lt;     203’497 - w/ 5</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">&lt;     1’269’704 - w/ 50</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">---</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">&gt;     108’924 - w/ 1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">&gt;     132’615 - w/ 2</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">&gt;     203’682 - w/ 5</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">&gt;     1’269’889 - w/ 50</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">50c50</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">&lt;     125’699 - createFixedPriceSaleWithEarlyAccessAllowlist</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">---</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">&gt;     125’711 - createFixedPriceSaleWithEarlyAccessAllowlist</span></span></code></pre>\n<h1 id=\"disclosures\" style=\"position:relative;\"><a href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Disclosures</h1>\n<p>C4 is an open organization governed by participants in the community.</p>\n<p>C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>",
  "toc": "<ul>\n<li>\n<p><a href=\"#overview\">Overview</a></p>\n<ul>\n<li><a href=\"#about-c4\">About C4</a></li>\n<li><a href=\"#wardens\">Wardens</a></li>\n</ul>\n</li>\n<li><a href=\"#summary\">Summary</a></li>\n<li><a href=\"#scope\">Scope</a></li>\n<li><a href=\"#severity-criteria\">Severity Criteria</a></li>\n<li>\n<p><a href=\"#medium-risk-findings-3\">Medium Risk Findings (3)</a></p>\n<ul>\n<li><a href=\"#m-01-marketfees-seller-referrer-fee-not-paid-when-no-creator-royalty-recipients-exist-for-a-sale\">M-01 <code>MarketFees</code>: Seller referrer fee not paid when no creator royalty recipients exist for a sale</a></li>\n<li><a href=\"#m-02-marketfees-primary-sales-not-detected-in-some-scenarios\">M-02 <code>MarketFees</code>: Primary sales not detected in some scenarios</a></li>\n<li><a href=\"#m-03-marketfees-seller-referrer-fee-can-underflow\">M-03 <code>MarketFees</code>: Seller referrer fee can underflow</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#informational-findings-7\">Informational Findings (7)</a></p>\n<ul>\n<li><a href=\"#info-01-nftmarketexhibition-_getandremovenftfromexhibition-does-not-emit-nftremovedfromexhibition\">Info-01 <code>NFTMarketExhibition</code>: <code>_getAndRemoveNftFromExhibition</code> does not emit <code>NftRemovedFromExhibition</code></a></li>\n<li><a href=\"#info-02-nftmarketexhibition-behavior-of-getexhibition-for-non-existing-exhibition-ids\">Info-02 <code>NFTMarketExhibition</code>: Behavior of <code>getExhibition</code> for non-existing exhibition IDs</a></li>\n<li><a href=\"#info-03-nftmarketreserveauction-event-reserveauctioncreated-does-not-include-exhibition-id\">Info-03 <code>NFTMarketReserveAuction</code>: Event <code>ReserveAuctionCreated</code> does not include exhibition ID</a></li>\n<li><a href=\"#info-04-nftdropmarketfixedpricesale-provided-start-times-can-be-arbitrarily-far-in-the-future\">Info-04 <code>NFTDropMarketFixedPriceSale</code>: Provided start times can be arbitrarily far in the future</a></li>\n<li><a href=\"#info-05-nftdropmarketfixedpricesale-getfixedpricesale-may-return-0-for-generalavailabilitystarttime-of-valid-sale\">Info-05 <code>NFTDropMarketFixedPriceSale</code>: <code>getFixedPriceSale</code> may return 0 for <code>generalAvailabilityStartTime</code> of valid sale</a></li>\n<li><a href=\"#info-06-nftdropmarketfixedpricesale-fixed-merkle-root-per-sale-may-be-restricting\">Info-06 <code>NFTDropMarketFixedPriceSale</code>: Fixed merkle root per sale may be restricting</a></li>\n<li><a href=\"#info-07-undocumented-parameters\">Info-07 Undocumented parameters</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#gas-optimizations-1\">Gas Optimizations (1)</a></p>\n<ul>\n<li><a href=\"#g-01-nftmarketexhibitioncreateexhibition-unnecessary-storage-read\">G-01 <code>NFTMarketExhibition.createExhibition</code>: Unnecessary storage read</a></li>\n</ul>\n</li>\n<li><a href=\"#disclosures\">Disclosures</a></li>\n</ul>",
  "md": "# Overview\n\n## About C4\n\nCode4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts. \n\nA C4 Solo Audit is an event where a top Code4rena contributor, commonly referred to as a warden or a team, reviews, audits and analyzes smart contract logic in exchange for a bounty provided by sponsoring projects.\n\nDuring the Solo Audit outlined in this document, C4 conducted an analysis of the Foundation code. The audit took place between November 21-28, 2022.\n\n## Wardens\n\nAudit completed by Lambda.\n\nFinal report assembled by [itsmetechjay](https://twitter.com/itsmetechjay).\n\n# Summary\n\nThe Foundation Exhibition, Scheduling & Early Access Solo Audit yielded 3 MEDIUM vulnerabilities. There were also 7 informational findings and 1 gas optimization reported.\n\nThe codebase in question had already undergone two prior Code4rena contests. Since the last audit, exhibitions (listing NFTs with a curator that gets part of the final sale price) and the possibility to set early access periods for drop markets were added.\n\n# Scope\n\nCode reviewed consisted of the following contracts:\n\n| Contract Name                                                                                                                                          | SLOC  | Purpose                                                                                                              |\n| ------------------------------------------------------------------------------------------------------------------------------------------------------ | ----- | -------------------------------------------------------------------------------------------------------------------- |\n| [NFTDropMarket](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/NFTDropMarket.sol)                                              | 63    | The main / top-level contract for all drop market tools on Foundation.                                               |\n| [FoundationTreasuryNode](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/shared/FoundationTreasuryNode.sol)                  | 34    | A wrapper for communicating with the treasury contract which collects Foundation fees and defines the central roles. |\n| [FETHNode](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/shared/FETHNode.sol)                                              | 35    | A wrapper for communicating with the FETH contract.                                                                  |\n| [MarketSharedCore](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/shared/MarketSharedCore.sol)                              | 7     | A base class for Foundation market contracts to define functions that other market contract may implement or extend. |\n| [NFTDropMarketCore](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/nftDropMarket/NFTDropMarketCore.sol)                     | 4     | A base class for the drop specific market contract to define functions that other mixins may implement or extend.    |\n| [SendValueWithFallbackWithdraw](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/shared/SendValueWithFallbackWithdraw.sol)    | 19    | A helper function to handle funds transfers.                                                                         |\n| [MarketFees](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/shared/MarketFees.sol)                                          | 331   | Distributes revenue from sales.                                                                                      |\n| [Gap500](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/shared/Gap500.sol)                                                  | 4     | A placeholder contract leaving room for new mixins to be added to the future in an upgrade safe fashion.             |\n| [Gap10000](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/shared/Gap10000.sol)                                              | 4     | A placeholder contract leaving room for new mixins to be added to the future in an upgrade safe fashion.             |\n| [NFTDropMarketFixedPriceSale](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/nftDropMarket/NFTDropMarketFixedPriceSale.sol) | 253   | Allows creators to list a drop collection for sale at a fixed price point.                                           |\n| [ArrayLibrary](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/libraries/ArrayLibrary.sol)                                          | 17    | Helper functions for resizing arrays.                                                                                |\n| [Constants](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/shared/Constants.sol)                                            | 10    | Shared constant values used by various mixins.                                                                       |\n| [MerkleAddressLibrary](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/libraries/MerkleAddressLibrary.sol)                          | 9     | A wrapper for validating merkle proofs for a tree containing a list of addresses.                                    |\n| [TimeLibrary](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/libraries/TimeLibrary.sol)                                            | 9     | Simple time checks to improve code readability & ensure consistency.                                                 |\n| [ExhibitionMarketMock ](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/ExhibitionMarketMock.sol)                               | 63    | A subset of the NFTMarket contract including auctions & exhibitions.                                                 |\n| [NFTMarketCore](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/nftMarket/NFTMarketCore.sol)                                 | 44    | A base class for the market contract to define functions that other mixins may implement or extend.                  |\n| [NFTMarketExhibition](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/nftMarket/NFTMarketExhibition.sol)                     | 127   | Adds exhibitions to the marketplace.                                                                                 |\n| [NFTMarketAuction](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/nftMarket/NFTMarketAuction.sol)                           | 14    | A base for reserve auctions which may be shared with other auction types in the future.                              |\n| [NFTMarketReserveAuction](https://github.com/f8n/fnd-contracts-staging/tree/master/contracts/mixins/nftMarket/NFTMarketReserveAuction.sol)             | 319   | Adds support for reserve auctions to the marketplace.                                                                |\n| **Total** 19 files                                                                                                                                     | 1,366 |\n\n# Severity Criteria\n\nC4 assesses the severity of disclosed vulnerabilities according to a methodology based on [OWASP standards](https://owasp.org/www-community/OWASP_Risk_Rating_Methodology).\n\nVulnerabilities are divided into three primary risk categories: high, medium, and low/non-critical.\n\nHigh-level considerations for vulnerabilities span the following key areas when conducting assessments:\n\n- Malicious Input Handling\n- Escalation of privileges\n- Arithmetic\n- Gas use\n\nFurther information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on [the C4 website](https://code4rena.com).\n\n# Medium Risk Findings (3)\n\n## [M-01] `MarketFees`: Seller referrer fee not paid when no creator royalty recipients exist for a sale\n\nThe logic to calculate the seller referrer fee is within the following `if` block:\n```solidity\n    if (creatorRecipients.length != 0 || assumePrimarySale) {\n      ...\n    }\n```\nWhen `creatorRecipients.length == 0` and `assumePrimarySale == false` (which is the case for `ExhibitionMarketMock`), the returned `sellerReferrerFee` will always be zero, no matter which value is passed for `sellerReferrerTakeRateInBasisPoints`. Therefore, the exhibition curator will not get the configured fee in such a scenario, although the seller referral fee should not depend on the existence of creator royalty recipients.\n\n### Link To Affected Code\n\nhttps://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/shared/MarketFees.sol#L530\n\n### Recommended Mitigation Steps\n\nCalculate the seller referrer fee also when no creator royalty recipients are defined (like it is done for the buyer referrer fee).\n\n## [M-02] `MarketFees`: Primary sales not detected in some scenarios\n\nWhen the seller is also a recipient of the creator royalties, a primary sale is assumed and `sellerRev` is set to 0:\n```solidity\n            if (creatorRecipients[i] == seller) {\n              // If the seller is any of the recipients defined, assume a primary sale\n              creatorRev += sellerRev;\n              sellerRev = 0;\n            }\n```\n\nHowever, this loop is exited prematurely when one of the `creatorShares` entries is greater than `BASIS_POINTS`:\n```solidity\n            if (creatorShares[i] > BASIS_POINTS) {\n              // If the numbers are >100% we ignore the fee recipients and pay just the first instead\n              totalShares = 0;\n              break;\n            }\n```\nTherefore, there can be scenarios where it is not detected that the seller is a recipient of the creator royalties and a secondary sale is assumed. For instance, if `creatorRecipients` is `[address(Bob), address(Alice), seller]` and `creatorShares` is `[100, 10_001, 100]`, the loop will `break` in the second iteration and `sellerRev` will not be set to 0.\n\n### Link To Affected Code\n\nhttps://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/shared/MarketFees.sol#L555\n\n### Recommended Mitigation Steps\n\nContinue looping to detect if the seller is a creator royalty recipient, even if one `creatorShares` entry was invalid.\n\n## [M-03] `MarketFees`: Seller referrer fee can underflow\nIn `MarketFees._getFees`, the `sellerReferrerFee` is deducted from `creatorRev` or `sellerRev` (depending on if the sale is primary / secondary):\n```solidity\n      if (sellerReferrerTakeRateInBasisPoints != 0) {\n        sellerReferrerFee = (price * sellerReferrerTakeRateInBasisPoints) / BASIS_POINTS;\n\n        // Subtract the seller referrer fee from the seller revenue so we do not double pay.\n        if (sellerRev == 0) {\n          // If the seller revenue is 0, this is a primary sale where all seller revenue is attributed to the \"creator\".\n          creatorRev -= sellerReferrerFee;\n        } else {\n          sellerRev -= sellerReferrerFee;\n        }\n      }\n```\n`sellerReferrerTakeRateInBasisPoints` can be up to 5,000 (50%), because the exhibition take rate (which is the only case when a non-zero value is passed) needs to be smaller than `MAX_TAKE_RATE`. On the other hand, it is only enforced that the protocol fee plus the creator royalty percentage is smaller than 100%:\n```solidity\n    if (\n      protocolFeeInBasisPoints < BASIS_POINTS / BUY_REFERRER_FEE_DENOMINATOR ||\n      protocolFeeInBasisPoints + BASIS_POINTS / CREATOR_ROYALTY_DENOMINATOR >= BASIS_POINTS\n    ) {\n      /* If the protocol fee is invalid, revert:\n       * Protocol fee must be greater than the buy referrer fee since referrer fees are deducted from the protocol fee.\n       * The protocol fee must leave room for the creator royalties.\n       */\n      revert NFTMarketFees_Invalid_Protocol_Fee();\n    }\n```\nBecause of that, there are valid settings where the calculation will underflow, leading to sales that do not succeed. For instance, we can have a protocol fee of 20% and creator royalties of 35%, in which case `sellerRev` would be 45% of the overall price. If the exhibition take rate is then >45%, the calculation will underflow.\n\n### Link To Affected Code\n\nhttps://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/shared/MarketFees.sol#L534\n\n### Recommended Mitigation Steps\n\nThere are two options to solve the problem:\n- Enforce that the protocol fee plus the creator royalty percentage is less than 50%.\n- Handle the underflow case explicitly and for instance cap the seller referrer fee if it would exceed the seller revenue.\n\n# Informational Findings (7)\n\n## [Info-01] `NFTMarketExhibition`: `_getAndRemoveNftFromExhibition` does not emit `NftRemovedFromExhibition`\n\nUnlike the function `_removeNftFromExhibition`, `_getAndRemoveNftFromExhibition` does not emit the event `NftRemovedFromExhibition` when an NFT is removed from an exhibition. This can be problematic for blockchain indexing solutions that rely on events (for instance, to track which NFTs are listed in which exhibition), as they will not detect the removal when an NFT is sold via a reserve auction.\n\n### Link To Affected Code\n\nhttps://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftMarket/NFTMarketExhibition.sol#L199\n\n### Recommended Mitigation Steps\n\nAlso emit the event in `_getAndRemoveNftFromExhibition`\n\n## [Info-02] `NFTMarketExhibition`: Behavior of `getExhibition` for non-existing exhibition IDs\n\nWhen a non-existing exhibition ID is passed to `getExhibition`, the default values (empty string, `address(0)`, and 0) will be returned for all parameters. Because of that, it may not be clear for integrators how to check the existence of an exhibition. As an empty string is a valid value for the name and the take rate can be 0, the only reliable way is to check if the curator is equal to `address(0)`. If an integrator decides to use another value, the check will be unreliable. \n\n### Link To Affected Code\n\nhttps://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftMarket/NFTMarketExhibition.sol#L224\n\n### Recommended Mitigation Steps\n\nEither revert for non-existing exhibitions or document clearly how a non-existing exhibition will be returned.\n\n## [Info-03] `NFTMarketReserveAuction`: Event `ReserveAuctionCreated` does not include exhibition ID\n\nThe event `ReserveAuctionCreated` that is emitted within `createReserveAuctionV2` does not include the exhibition ID. Because the exhibition ID determines the seller referrer fee, this information may be important for blockchain indexing solutions or other applications that consume these events.\n\n### Link To Affected Code\n\nhttps://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftMarket/NFTMarketReserveAuction.sol#L309\n\n### Recommended Mitigation Steps\n\nConsider adding the exhibition ID to the event.\n\n## [Info-04] `NFTDropMarketFixedPriceSale`: Provided start times can be arbitrarily far in the future\n\nWhile `_createFixedPriceSale` validates that the provided start times (early access and general availability) are not in the past, they can be arbitrarily far (up to February 2106) in the future. Therefore, when a user submits a completely wrong timestamp by mistake, the sale will still be created.\n\n### Link To Affected Code\n\nhttps://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftDropMarket/NFTDropMarketFixedPriceSale.sol#L295\n\n### Recommended Mitigation Steps\n\nTo catch user errors, consider adding an upper limit on the time delta (for instance 4 years).\n\n## [Info-05] `NFTDropMarketFixedPriceSale`: `getFixedPriceSale` may return 0 for `generalAvailabilityStartTime` of valid sale\n\nAs an optimization, `_createFixedPriceSale` does not store the `generalAvailabilityStartTime` when it is equal to the current block timestamp (because the business logic does not need the value then):\n```solidity\n    if (generalAvailabilityStartTime != block.timestamp) {\n      // If starting now we don't need to write to storage\n      saleConfig.generalAvailabilityStartTime = generalAvailabilityStartTime.toUint32();\n    }\n```\nHowever, this also means that `getFixedPriceSale` will set `generalAvailabilityStartTime` to 0 for such sales. Therefore, there is for instance no way to figure out the time that has passed since the general availability start time (which applications that build on top of Foundation might want to do) in these scenarios.\n\n### Link To Affected Code\n\nhttps://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftDropMarket/NFTDropMarketFixedPriceSale.sol#L361\n\n### Recommended Mitigation Steps\n\nConsider still setting `generalAvailabilityStartTime` in these cases, even if gas usage increases slightly.\n\n## [Info-06] `NFTDropMarketFixedPriceSale`: Fixed merkle root per sale may be restricting\n\nThe creator of a sale cannot add a new merkle root for a sale or change the current one. This may be very restricting in some scenarios. For instance, it could happen that an error occurred during the calculation of the root or that one address needs to be changed (for instance, because a user lost his private key).\n\n### Link To Affected Code\n\nhttps://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftDropMarket/NFTDropMarketFixedPriceSale.sol#L367\n\n### Recommended Mitigation Steps\n\nAccording to a comment in `NFTDropMarketFixedPriceSale`, multiple merkle roots per sale are planned as a future feature. However, as a temporary solution, the possibility to at least replace the current one (e.g., where the seller has to provide the old one and the new one) could help in the described situations.\n\n## [Info-07] Undocumented parameters\nIn a two places, a parameter is missing in the documentation:\n- [NFTMarketExhibition](https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftMarket/NFTMarketExhibition.sol#L84): `exhibitionId` within the event `NftRemovedFromExhibition`\n- [NFTMarketReserveAuction](https://github.com/f8n/fnd-contracts-staging/blob/c5ca7eb50e3fe3221bda49168cae8b4bbd98f4ac/contracts/mixins/nftMarket/NFTMarketReserveAuction.sol#L348): The parameter `referrer` of `placeBidV2` is not documented.\n\n\n# Gas Optimizations (1)\n\n## [G-01] `NFTMarketExhibition.createExhibition`: Unnecessary storage read\n\nIn line 138 of `NFTMarketExhibition`, instead of reading `idToExhibition[exhibitionId].curator`, `curator` can be set to `msg.sender`, resulting in the following reduction of gas usage when creating exhibitions:\n\n```\n7,10c7,10\n<     108’739 - w/ 1\n<     132’430 - w/ 2\n<     203’497 - w/ 5\n<     1’269’704 - w/ 50\n---\n>     108’924 - w/ 1\n>     132’615 - w/ 2\n>     203’682 - w/ 5\n>     1’269’889 - w/ 50\n50c50\n<     125’699 - createFixedPriceSaleWithEarlyAccessAllowlist\n---\n>     125’711 - createFixedPriceSaleWithEarlyAccessAllowlist\n```\n\n\n# Disclosures\n\nC4 is an open organization governed by participants in the community.\n\nC4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.\n"
}