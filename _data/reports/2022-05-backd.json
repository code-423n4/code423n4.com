{
  "circa": {
    "title": "Backd Tokenomics contest",
    "sponsor": "Backd",
    "slug": "2022-05-backd",
    "date": "2022-07-19",
    "findings": "https://github.com/code-423n4/2022-05-backd-findings/issues",
    "contest": 131
  },
  "html": "<h1 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h1>\n<h2 id=\"about-c4\" style=\"position:relative;\"><a href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>About C4</h2>\n<p>Code4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.</p>\n<p>A C4 audit contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.</p>\n<p>During the audit contest outlined in this document, C4 conducted an analysis of the Backd Tokenomics smart contract system written in Solidity. The audit contest took place between May 27—June 3 2022.</p>\n<h2 id=\"wardens\" style=\"position:relative;\"><a href=\"#wardens\" aria-label=\"wardens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wardens</h2>\n<p>66 Wardens contributed reports to the Backd Tokenomics contest:</p>\n<ol>\n<li><a href=\"https://twitter.com/WatchPug_\">WatchPug</a> (<a href=\"https://github.com/jack-the-pug\">jtp</a> and <a href=\"https://github.com/mingwatch\">ming</a>)</li>\n<li>scaraven</li>\n<li><a href=\"https://twitter.com/thePicodes\">Picodes</a></li>\n<li>0x52</li>\n<li><a href=\"https://twitter.com/hansfriese\">hansfriese</a></li>\n<li>0xNineDec</li>\n<li><a href=\"https://twitter.com/csanuragjain\">csanuragjain</a></li>\n<li>SmartSek (0xDjango and hake)</li>\n<li><a href=\"https://twitter.com/father0fBl0cks\">fatherOfBlocks</a></li>\n<li>IllIllI</li>\n<li><a href=\"https://twitter.com/0xruhum\">Ruhum</a></li>\n<li><a href=\"https://twitter.com/shenwilly_\">shenwilly</a></li>\n<li>0x1f8b</li>\n<li>unforgiven</li>\n<li>StyxRave</li>\n<li><a href=\"https://twitter.com/sm4rtcontr4ct\">JC</a></li>\n<li>peritoflores</li>\n<li>BowTiedWardens (BowTiedHeron, BowTiedPickle, <a href=\"BowTiedETHernal\">m4rio_eth</a>, <a href=\"https://twitter.com/JustDravee\">Dravee</a> and BowTiedFirefox)</li>\n<li><a href=\"https://milotruck.github.io/\">MiloTruck</a></li>\n<li>SecureZeroX</li>\n<li><a href=\"https://twitter.com/berndartmueller\">berndartmueller</a></li>\n<li><a href=\"https://twitter.com/defsec_\">defsec</a></li>\n<li>cccz</li>\n<li>sashik_eth</li>\n<li><a href=\"https://twitter.com/c3ph_\">c3phas</a></li>\n<li><a href=\"https://chom.dev\">Chom</a></li>\n<li>0x29A (0x4non and rotcivegaf)</li>\n<li><a href=\"https://instagram.com/vanensurya\">Funen</a></li>\n<li><a href=\"https://twitter.com/0xNazgul\">0xNazgul</a></li>\n<li><a href=\"https://twitter.com/Sm4rty_\">Sm4rty</a></li>\n<li>0xf15ers (remora and twojoy)</li>\n<li>asutorufos</li>\n<li>delfin454000</li>\n<li><a href=\"https://twitter.com/gzeon\">gzeon</a></li>\n<li>hake</li>\n<li>sach1r0</li>\n<li>simon135</li>\n<li>oyc_109</li>\n<li><a href=\"https://twitter.com/catchup22\">catchup</a></li>\n<li>Kaiziron</li>\n<li>Waze</li>\n<li>robee</li>\n<li>cryptphi</li>\n<li>dipp</li>\n<li>codexploder</li>\n<li>bardamu</li>\n<li>masterchief</li>\n<li>Kumpa</li>\n<li><a href=\"https://twitter.com/0xhyh\">hyh</a></li>\n<li><a href=\"https://github.com/0xKitsune\">0xKitsune</a></li>\n<li><a href=\"https://github.com/htadashi\">Tadashi</a></li>\n<li><a href=\"https://twitter.com/JustDravee\">Dravee</a></li>\n<li>djxploit</li>\n<li><a href=\"https://twitter.com/meidhiwirara\">Tomio</a></li>\n<li>0xkatana</li>\n<li><a href=\"https://twitter.com/fitraldys\">Fitraldys</a></li>\n<li><a href=\"https://twitter.com/randyyramadhan\">Randyyy</a></li>\n<li>RoiEvenHaim</li>\n</ol>\n<p>This contest was judged by <a href=\"https://twitter.com/GalloDaSballo\">Alex the Entreprenerd</a>.</p>\n<p>Final report assembled by <a href=\"https://twitter.com/itsmetechjay\">itsmetechjay</a>.</p>\n<h1 id=\"summary\" style=\"position:relative;\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h1>\n<p>The C4 analysis yielded an aggregated total of 20 unique vulnerabilities. Of these vulnerabilities, 2 received a risk rating in the category of HIGH severity and 18 received a risk rating in the category of MEDIUM severity.</p>\n<p>Additionally, C4 analysis included 42 reports detailing issues with a risk rating of LOW severity or non-critical. There were also 41 reports recommending gas optimizations.</p>\n<p>All of the issues presented here are linked back to their original finding.</p>\n<h1 id=\"scope\" style=\"position:relative;\"><a href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scope</h1>\n<p>The code under review can be found within the <a href=\"https://github.com/code-423n4/2022-05-backd\">C4 Backd Tokenomics contest repository</a>, and is composed of 22 smart contracts written in the Solidity programming language and includes 2,507 lines of Solidity code.</p>\n<h1 id=\"severity-criteria\" style=\"position:relative;\"><a href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Severity Criteria</h1>\n<p>C4 assesses the severity of disclosed vulnerabilities according to a methodology based on <a href=\"https://owasp.org/www-community/OWASP_Risk_Rating_Methodology\">OWASP standards</a>.</p>\n<p>Vulnerabilities are divided into three primary risk categories: high, medium, and low/non-critical.</p>\n<p>High-level considerations for vulnerabilities span the following key areas when conducting assessments:</p>\n<ul>\n<li>Malicious Input Handling</li>\n<li>Escalation of privileges</li>\n<li>Arithmetic</li>\n<li>Gas use</li>\n</ul>\n<p>Further information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on <a href=\"https://code4rena.com\">the C4 website</a>.</p>\n<h1 id=\"high-risk-findings-2\" style=\"position:relative;\"><a href=\"#high-risk-findings-2\" aria-label=\"high risk findings 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>High Risk Findings (2)</h1>\n<h2 id=\"h-01-mintersolstartinflation-can-be-bypassed\" style=\"position:relative;\"><a href=\"#h-01-mintersolstartinflation-can-be-bypassed\" aria-label=\"h 01 mintersolstartinflation can be bypassed permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/99\">[H-01] <code>Minter.sol#startInflation()</code> can be bypassed.</a></h2>\n<p><em>Submitted by WatchPug, also found by 0x52</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L104-L108\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L104-L108</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">startInflation</span><span class=\"mtk1\">() </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyGovernance</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">lastEvent</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Inflation has already started.&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">lastEvent</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">lastInflationDecay</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>As <code>lastEvent</code> and <code>lastInflationDecay</code> are not initialized in the <code>constructor()</code>, they will remain to the default value of <code>0</code>.</p>\n<p>However, the permissionless <code>executeInflationRateUpdate()</code> method does not check the value of <code>lastEvent</code> and <code>lastInflationDecay</code> and used them directly.</p>\n<p>As a result, if <code>executeInflationRateUpdate()</code> is called before <code>startInflation()</code>:</p>\n<ol>\n<li>L190, the check of if <code>_INFLATION_DECAY_PERIOD</code> has passed since <code>lastInflationDecay</code> will be <code>true</code>, and <code>initialPeriodEnded</code> will be set to <code>true</code> right away;</li>\n<li>L188, since the <code>lastEvent</code> in <code>totalAvailableToNow += (currentTotalInflation * (block.timestamp - lastEvent));</code> is <code>0</code>, the <code>totalAvailableToNow</code> will be set to <code>totalAvailableToNow ≈ currentTotalInflation * 52 years</code>, which renders the constrains of <code>totalAvailableToNow</code> incorrect and useless.</li>\n</ol>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L115-L117\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L115-L117</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">executeInflationRateUpdate</span><span class=\"mtk1\">() </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_executeInflationRateUpdate</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L187-L215\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L187-L215</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_executeInflationRateUpdate</span><span class=\"mtk1\">() </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">totalAvailableToNow</span><span class=\"mtk1\"> += (</span><span class=\"mtk12\">currentTotalInflation</span><span class=\"mtk1\"> * (</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">lastEvent</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">lastEvent</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">lastInflationDecay</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">_INFLATION_DECAY_PERIOD</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">currentInflationAmountLp</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">currentInflationAmountLp</span><span class=\"mtk1\">.</span><span class=\"mtk11\">scaledMul</span><span class=\"mtk1\">(</span><span class=\"mtk12\">annualInflationDecayLp</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">initialPeriodEnded</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">currentInflationAmountKeeper</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">currentInflationAmountKeeper</span><span class=\"mtk1\">.</span><span class=\"mtk11\">scaledMul</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">annualInflationDecayKeeper</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">currentInflationAmountAmm</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">currentInflationAmountAmm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">scaledMul</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">annualInflationDecayAmm</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">currentInflationAmountKeeper</span><span class=\"mtk1\"> =</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">initialAnnualInflationRateKeeper</span><span class=\"mtk1\"> /</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">_INFLATION_DECAY_PERIOD</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">currentInflationAmountAmm</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">initialAnnualInflationRateAmm</span><span class=\"mtk1\"> / </span><span class=\"mtk12\">_INFLATION_DECAY_PERIOD</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">initialPeriodEnded</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">currentTotalInflation</span><span class=\"mtk1\"> =</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">currentInflationAmountLp</span><span class=\"mtk1\"> +</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">currentInflationAmountKeeper</span><span class=\"mtk1\"> +</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">currentInflationAmountAmm</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">controller</span><span class=\"mtk1\">.</span><span class=\"mtk11\">inflationManager</span><span class=\"mtk1\">().</span><span class=\"mtk11\">checkpointAllGauges</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">lastInflationDecay</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L50-L51\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L50-L51</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Used for final safety check to ensure inflation is not exceeded</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">totalAvailableToNow</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L217-L227\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L217-L227</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_mint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">beneficiary</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">totalAvailableToNow</span><span class=\"mtk1\"> += ((</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">lastEvent</span><span class=\"mtk1\">) * </span><span class=\"mtk12\">currentTotalInflation</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newTotalMintedToNow</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">totalMintedToNow</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">newTotalMintedToNow</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk12\">totalAvailableToNow</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Mintable amount exceeded&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">totalMintedToNow</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">newTotalMintedToNow</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">lastEvent</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">mint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">beneficiary</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">_executeInflationRateUpdate</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">TokensMinted</span><span class=\"mtk1\">(</span><span class=\"mtk12\">beneficiary</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<h3 id=\"recommendation\" style=\"position:relative;\"><a href=\"#recommendation\" aria-label=\"recommendation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommendation</h3>\n<p>Consider initializing <code>lastEvent</code>, <code>lastInflationDecay</code> in <code>constructor()</code>.</p>\n<p>or</p>\n<p>Consider adding <code>require(lastEvent != 0 &#x26;&#x26; lastInflationDecay != 0, \"...\")</code> to <code>executeInflationRateUpdate()</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/99\">danhper (Backd) confirmed</a></strong> </p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/99#issuecomment-1159582144\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how <code>startInflation</code> can be bypassed, breaking the Access Control as well as the Sponsor Goal for Emissions.</p>\n<p>Because of this I believe High Severity to be appropriate.</p>\n<p>The sponsor has mitigated in a subsequent PR</p>\n</blockquote>\n<hr>\n<h2 id=\"h-02-total-supply-is-not-guaranteed-and-is-not-deterministic\" style=\"position:relative;\"><a href=\"#h-02-total-supply-is-not-guaranteed-and-is-not-deterministic\" aria-label=\"h 02 total supply is not guaranteed and is not deterministic permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/46\">[H-02] Total Supply is not guaranteed and is not deterministic.</a></h2>\n<p><em>Submitted by Picodes, also found by scaraven</em></p>\n<p>The actual total supply of the token is random and depends on when <code>_executeInflationRateUpdate</code> is executed.</p>\n<h3 id=\"proof-of-concept\" style=\"position:relative;\"><a href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>The <code>README</code> and tokenomic documentation clearly states that “The token supply is limited to a total of 268435456 tokens.” However when executing <a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/tokenomics/Minter.sol#L181\"><code>_executeInflationRateUpdate</code></a>, it first uses the current inflation rate to update the total available before checking if it needs to be reduced.</p>\n<p>Therefore if no one mints or calls <code>executeInflationRateUpdate</code> for some time around the decay point, the inflation will be updated using the previous rate so the  <code>totalAvailableToNow</code> will grow too much.</p>\n<h3 id=\"mitigation-steps\" style=\"position:relative;\"><a href=\"#mitigation-steps\" aria-label=\"mitigation steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mitigation Steps</h3>\n<p>You should do</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"js\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">totalAvailableToNow</span><span class=\"mtk1\"> += (</span><span class=\"mtk12\">currentTotalInflation</span><span class=\"mtk1\"> * (</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">lastEvent</span><span class=\"mtk1\">));</span></span></span></code></pre>\n<p>Only if the condition <code>block.timestamp >= lastInflationDecay + _INFLATION_DECAY_PERIOD</code> is false.</p>\n<p>Otherwise you should do</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"js\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">totalAvailableToNow</span><span class=\"mtk1\"> += (</span><span class=\"mtk12\">currentTotalInflation</span><span class=\"mtk1\"> * (</span><span class=\"mtk12\">lastInflationDecay</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">_INFLATION_DECAY_PERIOD</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">lastEvent</span><span class=\"mtk1\">));</span></span></span></code></pre>\n<p>Then update the rates, then complete with</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"js\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">totalAvailableToNow</span><span class=\"mtk1\"> += (</span><span class=\"mtk12\">currentTotalInflation</span><span class=\"mtk1\"> * (</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">lastInflationDecay</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">_INFLATION_DECAY_PERIOD</span><span class=\"mtk1\">));</span></span></span></code></pre>\n<p>Note that as all these variables are either constants either already loaded in memory this is super cheap to do.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/46#issuecomment-1147565918\">danhper (Backd) confirmed, but disagreed with severity and commented</a>:</strong></p>\n<blockquote>\n<p>I believe this should actually be high severity</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/46#issuecomment-1159775172\">Alex the Entreprenerd (judge) increased severity to High and commented</a>:</strong></p>\n<blockquote>\n<p>The warden has identified the lack of an upper bound on the inflation math which would make it so that more than the expected supply cap of the token could be minted.</p>\n<p>The sponsor agrees that this should be of High Severity.</p>\n<p>Because this breaks the protocol stated invariant of a specific cap of <code>268435456</code> tokens, I agree with High Severity.</p>\n</blockquote>\n<hr>\n<h1 id=\"medium-risk-findings-18\" style=\"position:relative;\"><a href=\"#medium-risk-findings-18\" aria-label=\"medium risk findings 18 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Medium Risk Findings (18)</h1>\n<h2 id=\"m-01-dos-on-keepergauge-due-to-division-by-zero\" style=\"position:relative;\"><a href=\"#m-01-dos-on-keepergauge-due-to-division-by-zero\" aria-label=\"m 01 dos on keepergauge due to division by zero permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/35\">[M-01] DoS on KeeperGauge due to division by zero</a></h2>\n<p><em>Submitted by fatherOfBlocks</em></p>\n<p>In the <strong>_calcTotalClaimable()</strong> function it should be validated that perPeriodTotalFees[i] != 0 since otherwise it would generate a DoS in <strong>claimableRewards()</strong> and <strong>claimRewards()</strong>.<br>\nThis would be possible since if <strong>advanceEpoch()</strong> or <strong>kill()</strong> is executed by the InflationManager address, the epoch will go up without perPeriodTotalFees[newIndexEpoch] is 0.<br>\nThe negative of this is that every time the <strong>InflationManager</strong> executes these two methods (<strong>kill() and advanceEpoch()</strong>) DoS is generated until you run <strong>reportFees()</strong>.<br>\nAnother possible case is that <strong>kill()</strong> or <strong>advanceEpoch()</strong> are executed 2 times in a row and there is no way of a perPeriodTotalFees[epoch-1] updating its value, therefore it would be an irreversible DoS.<br></p>\n<h3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Generate a behavior for the case that perPeriodTotalFees[i] == 0.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/35\">samwerner (Backd) confirmed, but disagreed with severity</a></strong> </p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/35#issuecomment-1159318667\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The finding at face value is valid and it’s impact is a DOS.</p>\n<p>A division by zero in <code>keeperRecords[beneficiary].feesInPeriod[i].scaledDiv(perPeriodTotalFees[i])</code>, will cause an instantaneous revert making it impossible to claim fees.</p>\n<p>After more reading I believe that the finding is valid and can cause issues if there’s one epoch without fees, if for any reason the protocol skips one epoch via <code>advanceEpoch</code>, while no <a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L88\"><code>perPeriodTotalFees</code></a> are increased, then, because <a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L136%60\"><code>keeperRecords[beneficiary].nextEpochToClaim</code></a> will include the empty epoch, the <code>beneficiary</code> will not be able to receive fees.</p>\n<p>Given that setup is necessary for this to happen, I believe Medium Severity to be more appropriate.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-02-the-first-amm-staker-will-have-control-over-how-the-shares-are-calculated\" style=\"position:relative;\"><a href=\"#m-02-the-first-amm-staker-will-have-control-over-how-the-shares-are-calculated\" aria-label=\"m 02 the first amm staker will have control over how the shares are calculated permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/100\">[M-02] The first AMM Staker will have control over how the shares are calculated.</a></h2>\n<p><em>Submitted by 0xNineDec</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L147\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L147</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L154\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L154</a></p>\n<h3 id=\"impact\" style=\"position:relative;\"><a href=\"#impact\" aria-label=\"impact permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>The first staker can take control of how the subsequent shares are going to be distributed by simply staking 1wei amount of the token and frontrunning future stakers. The reasons of this are related on how the variables are updated and with the amounts that the Gauge allows users to stake (anything but zero). The origin of this vulnerability relies on the evaluation of the <code>totalStaked</code> variable on its inception.</p>\n<h3 id=\"proof-of-concept-1\" style=\"position:relative;\"><a href=\"#proof-of-concept-1\" aria-label=\"proof of concept 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>To illustrate this attack, an environment of testing was made in order to track the token flows and how the variables are being updated and read.</p>\n<p>The initial or border conditions taken into account are the same as the ones used by the team to perform the tests and just a few assumptions and simplifications were taken.</p>\n<ol>\n<li>The inflation rate is fixed for simplicity (<code>0.001</code>). This is valid within a short period of time because it is not a function of how the tokens are distributed or their flows. By tracking how the inflation rate is calculated an updated, we see that it is managed by the <code>currentInflationAmountAmm</code> within the <a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L184\"><code>Minter.sol</code> contract</a>, which value is modified by <code>_executeInflationRateUpdate()</code> three lines below the last code permalink. Its value depends on non-token balance related parameters (such as inflation decays and annual rates).</li>\n<li>For the testing environment performed by the team, a DummyERC20 was used as testing token. The same is done on the exploit environment.</li>\n<li>The controller is not used because it is used to retrieve the inflation rate and it is now fixed because of 1).</li>\n</ol>\n<p>Each user state is updated whenever he calls either <code>stake</code>, <code>unstake</code> or <code>claimRewards</code>.</p>\n<p>Steps:</p>\n<ul>\n<li>Alice is the first staker and deposits 1wei worth of DummyERC20.</li>\n<li>Bob takes one day to find out this new protocol and decides to stake 10 ETH amount of tokens (<code>10 * 10**decimals()</code>).</li>\n<li>Alice, who was scanning the mempool, frontruns Bob with the same amount he was willing to stake. Her txn is mined first.</li>\n<li>Then Bobs’ transaction is mined for the 10 ETH worth.</li>\n<li>Sometime after this, the pool is checkpointed.</li>\n<li>A few days pass, and Bob wants to stake even more tokens. The same amount as before.</li>\n<li>Alice frontruns him again updating her shares.</li>\n<li>Bobs’ transaction is mined and his shares are also updated.</li>\n<li>The pool is checkpointed again. And Alice managed to increase considerably her amount of shares.</li>\n</ul>\n<p>Both cases were evaluated (with and without staking 1 wei first). The attack scenario outputs a 100% more shares to Alice than Bob in comparison with the ethical/non-attack situation.</p>\n<p>The code used to perform this test is the following:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">it(&quot;First Depositer Exploit&quot;, async function () {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        let userShares = []</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        let userIntegral = []</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        let userBalance = []</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        let globalIntegral, totalStaked;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        let aliceBob = [alice, bob];</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        // Starting Checkpoint</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        await this.ammgauge.poolCheckpoint();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        await ethers.provider.send(&quot;evm_increaseTime&quot;, [1 * 24 * 60 * 60]); // 10 days</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        const updateStates = async () =&gt; { </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            userShares = []</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            userIntegral = []</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            userBalance = []</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            for (const user of aliceBob) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                let balances = ethers.utils.formatEther(await this.ammgauge.balances(user.address));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                let currentShare = ethers.utils.formatEther(await this.ammgauge.perUserShare(user.address));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                let currentStakedIntegral = ethers.utils.formatEther(await this.ammgauge.perUserStakedIntegral(user.address));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                userShares.push(currentShare);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                userIntegral.push(currentStakedIntegral);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                userBalance.push(balances);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            globalIntegral = await this.ammgauge.ammStakedIntegral()</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            totalStaked = await this.ammgauge.totalStaked()</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot;  &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot;         ALICE / BOB&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(`Shares: ${userShares}`);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(`Integr: ${userIntegral}`);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(`Balanc: ${userBalance}`);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot;  &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot;Global&quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(`Integral: ${ethers.utils.formatEther(globalIntegral)}, TotalStaked: ${ethers.utils.formatEther(totalStaked)}`)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        const stake = async (to, amount) =&gt; {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await updateStates()</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot; &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            // Balance before</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            let balanceBefore = await this.ammgauge.balances(to.address);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            // Stake</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await this.ammgauge.connect(to).stake(amount);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            expect(await this.ammgauge.balances(to.address)).to.be.eq(balanceBefore.add(amount));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            // await updateStates();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot; &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        const unstake = async (to, amount) =&gt; {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await updateStates()</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot; &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            // Balance before</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            let balanceBefore = await this.ammgauge.balances(to.address);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            // Stake</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await this.ammgauge.connect(to).unstake(amount);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            expect(await this.ammgauge.balances(to.address)).to.be.eq(balanceBefore.sub(amount));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await updateStates();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot; &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        // HERE IS WHERE THE SIMULATION IS PERFORMED</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        let simulationTimes = 2;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        let withOneWeiDeposit = true;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        if (withOneWeiDeposit) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            // Alice deposits first</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot;Alice Deposits 1wei&quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            let firstUserDeposit = ethers.utils.parseEther(&quot;1&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await stake(alice, 1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        for (let index = 1; index &lt;= simulationTimes; index++) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot; &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(`Loop number ${index}`);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot; &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot;A day passes until Bob decides to deposit&quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await ethers.provider.send(&quot;evm_increaseTime&quot;, [1 * 24 * 60 * 60]); // 1 days</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot; &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot;She scans that Bob is about to stake 10. So decides to frontrun him.&quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot;Alice Frontruns&quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            let frontrunAmount = ethers.utils.parseEther(&quot;10&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await stake(alice, frontrunAmount);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot; &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot;Bob stakes 10 tokens&quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await stake(bob, frontrunAmount)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            // A few days pass</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await ethers.provider.send(&quot;evm_increaseTime&quot;, [1 * 24 * 60 * 60]); // 2 days</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            // The pool is checkpointed</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await this.ammgauge.poolCheckpoint();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot;After 1 day the pool is checkpointed&quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await updateStates()</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    })</span></span></code></pre>\n<p>The simulation was both made for the attacked and non attacked situations.\nThe values that are shown represent how the contract updates them (the <code>totalStaked</code> variable is 0 when first Alice calls the stake function after <code>_userCheckpoint()</code> rans)</p>\n<h4 id=\"with-1wei-stake-attack\" style=\"position:relative;\"><a href=\"#with-1wei-stake-attack\" aria-label=\"with 1wei stake attack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WITH 1WEI STAKE (ATTACK)</h4>\n<table>\n<thead>\n<tr>\n<th align=\"center\">time</th>\n<th align=\"center\">Situation</th>\n<th align=\"center\">totalStaked</th>\n<th align=\"center\">Alice Shares</th>\n<th align=\"center\">Bob Shares</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">0-</td>\n<td align=\"center\">First poolCheckpoint</td>\n<td align=\"center\">0</td>\n<td align=\"center\">0</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">0+</td>\n<td align=\"center\">Alice Deposits 1wei</td>\n<td align=\"center\">0</td>\n<td align=\"center\">0</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">1</td>\n<td align=\"center\">Alice frontruns Bob @ 10eth</td>\n<td align=\"center\">1wei</td>\n<td align=\"center\">0</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">2</td>\n<td align=\"center\">Bob 10eth txn is mined</td>\n<td align=\"center\">10eth + 1wei</td>\n<td align=\"center\">86.4</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">3</td>\n<td align=\"center\">1 day later poolCheckpoint() is called</td>\n<td align=\"center\">20eth + 1 wei</td>\n<td align=\"center\">86.4</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">4</td>\n<td align=\"center\">Alice frontruns Bob again</td>\n<td align=\"center\">20eth + 1 wei</td>\n<td align=\"center\">86.4</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">5</td>\n<td align=\"center\">Bob 10eth txn is mined</td>\n<td align=\"center\">30eth + 1wei</td>\n<td align=\"center\">172.8</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">6</td>\n<td align=\"center\">1 day later poolCheckpoint() is called</td>\n<td align=\"center\">40eth + 1wei</td>\n<td align=\"center\">172.8</td>\n<td align=\"center\">86.4</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"without-the-1wei-stake-no-first-staker-hijack\" style=\"position:relative;\"><a href=\"#without-the-1wei-stake-no-first-staker-hijack\" aria-label=\"without the 1wei stake no first staker hijack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WITHOUT THE 1WEI STAKE (No “first staker hijack”)</h4>\n<table>\n<thead>\n<tr>\n<th align=\"center\">time</th>\n<th align=\"center\">Situation</th>\n<th align=\"center\">totalStaked</th>\n<th align=\"center\">Alice Shares</th>\n<th align=\"center\">Bob Shares</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">0-</td>\n<td align=\"center\">First poolCheckpoint</td>\n<td align=\"center\">0</td>\n<td align=\"center\">0</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">0+</td>\n<td align=\"center\">Alice stakes 10eth</td>\n<td align=\"center\">0</td>\n<td align=\"center\">0</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">1</td>\n<td align=\"center\">Bob stakes 10eth</td>\n<td align=\"center\">10eth</td>\n<td align=\"center\">0</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">2</td>\n<td align=\"center\">1 day later poolCheckpoint() is called</td>\n<td align=\"center\">20eth</td>\n<td align=\"center\">0</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">3</td>\n<td align=\"center\">Alice stakes 10eth</td>\n<td align=\"center\">20eth</td>\n<td align=\"center\">0</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">4</td>\n<td align=\"center\">Bob stakes 10eth</td>\n<td align=\"center\">30eth</td>\n<td align=\"center\">86.4</td>\n<td align=\"center\">0</td>\n</tr>\n<tr>\n<td align=\"center\">5</td>\n<td align=\"center\">1 day later poolCheckpoint() is called</td>\n<td align=\"center\">40eth</td>\n<td align=\"center\">86.4</td>\n<td align=\"center\">86.4</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Further evaluation on how the variables are updated and how does the <code>Integral</code> (both each users and global one) is calculated on the pool inception is needed to patch this issue.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/100\">danhper (Backd) confirmed, but disagreed with severity</a></strong> </p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/100#issuecomment-1159746279\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>The warden has identified a way for the <code>rewardsShares</code> to be improperly assigned.</p>\n<p>The exploit is based on the fact that if <code>totalStaked</code> is zero we effectively will skip the first loop of points.</p>\n<p>This can create situations where certain users are rewarded unfairly in comparison to their initial deposit.</p>\n<p>However, this only applies when we go from zero to non-zero for <code>totalStaked</code> henced the scenario proposed by the warden (1 day of free rewards for first depositor) is actually the worst case scenario.</p>\n<p>Having the deployer do 2 or 3 initial deposits should mitigate this attack, which ultimately is limited to a leak of value to the first user depositing.</p>\n<p>For those reasons, I believe the finding to be valid and of Medium Severity.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-03-the-first-amm-staker-may-not-receive-according-rewards-because-of-poor-checkpoints\" style=\"position:relative;\"><a href=\"#m-03-the-first-amm-staker-may-not-receive-according-rewards-because-of-poor-checkpoints\" aria-label=\"m 03 the first amm staker may not receive according rewards because of poor checkpoints permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/111\">[M-03] THE first AMM Staker may not receive according rewards because of poor checkpoints</a></h2>\n<p><em>Submitted by 0xNineDec</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L56\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L56</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L140\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L140</a></p>\n<h3 id=\"impact-1\" style=\"position:relative;\"><a href=\"#impact-1\" aria-label=\"impact 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>The first staker within the <code>AmmGauge</code> may not get the rewards if the pool is not checkpointed right after he stakes and before he wants to claim the rewards.</p>\n<h3 id=\"proof-of-concept-2\" style=\"position:relative;\"><a href=\"#proof-of-concept-2\" aria-label=\"proof of concept 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>A testing environment that reproduces how the protocol is going to be deployed and managed is used to evaluate this case under the following assumptions and simplifications.</p>\n<ol>\n<li>The inflation rate is fixed for simplicity (<code>0.001</code>).</li>\n<li>For the testing environment performed by the team, a DummyERC20 was used as testing token. The same is done on the exploit environment.</li>\n<li>The minting of tokens impact both on the inflation calculation and their balance. But this test evaluates the states just before minting (claimable balances). Following how the pools are updated, they are checkpointed in the end of the <code>_executeInflationRateUpdate</code> call. Not while staking.</li>\n</ol>\n<p>In order to illustrate this scenario we will show both the vulnerable and non vulnerable situations.</p>\n<p>Vulnerable Situation:</p>\n<ol>\n<li>Alice, Bob, Charlie and David are future users of the pool. They all notice the inception of this project and decide to stake.</li>\n<li>They all stake the same amount. Their transactions are mined with 1min of difference starting from Alice and finishing with David.</li>\n<li>There is no external pool checkpoint between Alice and Bob (besides the one that is triggered when Bob stakes).</li>\n<li>Sometime happens and they all want to check their accumulated reward balance. Alice accumulated much less than the others.</li>\n</ol>\n<p>Non Vulnerable Situation:</p>\n<ul>\n<li>The same as before but calling externally <code>_poolCheckpoint()</code> between Alice stake call and Bobs’ and before checking the accumulated rewards.</li>\n</ul>\n<p>The code to show this has a <code>secureCheckpoints</code> toggle that can be set as true or false to trigger (or not) the intermediate poolCheckpoints.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">    it(&#39;First Staker Rewards Calculation&#39;, async function () { </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        let secureCheckpoints = false;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        let currentShare, currentStakedIntegral, balances;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        await this.ammgauge.poolCheckpoint();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        await ethers.provider.send(&quot;evm_increaseTime&quot;, [1 * 24 * 60 * 60]); // 10 days</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        const updateStates = async (from) =&gt; { </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            currentShare = await this.ammgauge.perUserShare(from.address);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            currentStakedIntegral = await this.ammgauge.perUserStakedIntegral(from.address);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            balances = await this.ammgauge.balances(from.address);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        const stake = async (to, amount) =&gt; {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await updateStates(to)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot; &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            // Balance before</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            let balanceBefore = await this.ammgauge.balances(to.address);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            // Stake</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await this.ammgauge.connect(to).stake(amount);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            expect(await this.ammgauge.balances(to.address)).to.be.eq(balanceBefore.add(amount));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await updateStates(to);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot; &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        const unstake = async (to, amount) =&gt; {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await updateStates(to)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot; &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            // Balance before</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            let balanceBefore = await this.ammgauge.balances(to.address);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            // Stake</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await this.ammgauge.connect(to).unstake(amount);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            expect(await this.ammgauge.balances(to.address)).to.be.eq(balanceBefore.sub(amount));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            await updateStates(to);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            console.log(&quot; &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        // Each user stakes tokens</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        let initialStaking = ethers.utils.parseEther(&quot;10&quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(&quot; &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(&quot;USERS STAKE&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        for (const user of users) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        await stake(user, initialStaking)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        if(secureCheckpoints){await this.ammgauge.poolCheckpoint()};</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        await ethers.provider.send(&quot;evm_increaseTime&quot;, [60 * 60]); // 1hr between stakes</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(&quot; &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        await ethers.provider.send(&quot;evm_increaseTime&quot;, [ 5 * 24 * 60 * 60]); // 5 days</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        if(secureCheckpoints){await this.ammgauge.poolCheckpoint()};</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        let claimableRewards = [];</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        let claimedRewards = [];</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(&quot; &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(&quot;USERS CLAIMABLE REWARDS AFTER 5 days&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(&quot; &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        for (const user of users) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            let stepClaimable = await this.ammgauge.claimableRewards(user.address);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            claimableRewards.push(ethers.utils.formatEther(stepClaimable))</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            let rewardsClaim = await (await this.ammgauge.claimRewards(user.address)).wait()</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            claimedRewards.push(ethers.utils.formatEther(rewardsClaim.logs[0][&quot;data&quot;]))</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(&quot;Claimable calculated&quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(&quot;   ALICE - BOB -  CHARLIE - DAVID&quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(claimableRewards)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(&quot; &quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(&quot;Effectively Claimed&quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(&quot;   ALICE - BOB -  CHARLIE - DAVID&quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        console.log(claimableRewards)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    })</span></span></code></pre>\n<p>The outputs for both cases are shown on the following chart. The initial staking amount is 10eth amount of the DummyERC20 token.</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\"></th>\n<th align=\"center\">Without Checkpoints</th>\n<th align=\"center\">With Checkpoints</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">Alice</td>\n<td align=\"center\">6.6</td>\n<td align=\"center\">115.5</td>\n</tr>\n<tr>\n<td align=\"center\">Bob</td>\n<td align=\"center\">111.9</td>\n<td align=\"center\">111.9</td>\n</tr>\n<tr>\n<td align=\"center\">Charlie</td>\n<td align=\"center\">110.1</td>\n<td align=\"center\">110.1</td>\n</tr>\n<tr>\n<td align=\"center\">David</td>\n<td align=\"center\">108.9</td>\n<td align=\"center\">108.9</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<ul>\n<li>Check how is calculated the staking variables while the pool has no tokens staked and also how the updates and checkpoints are performed.</li>\n</ul>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/111#issuecomment-1148642951\">chase-manning (Backd) confirmed, but disagreed with severity and commented</a>:</strong></p>\n<blockquote>\n<p>This can only impact one user and only in an edge case so should be Medium severity.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/111#issuecomment-1159748160\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how the first depositor may end up not getting the correct amount of points due to how zero is handled in <code>poolCheckpoint</code></p>\n<p>Am not fully confident this should be kept separate from <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/100\">M-02</a>.</p>\n<p>However at this time, I believe the finding to be of Medium Severity.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/111#issuecomment-1172523467\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>At this time, while the underlying solution may be the same, I believe this finding and <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/100\">M-02</a> to be distinct.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-04-amount-distributed-can-be-inaccurate-when-updating-weights-\" style=\"position:relative;\"><a href=\"#m-04-amount-distributed-can-be-inaccurate-when-updating-weights-\" aria-label=\"m 04 amount distributed can be inaccurate when updating weights  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/47\">[M-04] Amount distributed can be inaccurate when updating weights </a></h2>\n<p><em>Submitted by Picodes</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L220\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L220</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/tokenomics/InflationManager.sol#L559\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/tokenomics/InflationManager.sol#L559</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/tokenomics/InflationManager.sol#L572\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/tokenomics/InflationManager.sol#L572</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/tokenomics/InflationManager.sol#L586\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/tokenomics/InflationManager.sol#L586</a></p>\n<h3 id=\"impact-2\" style=\"position:relative;\"><a href=\"#impact-2\" aria-label=\"impact 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>When updating pool inflation rates, other pools see their <code>currentRate</code> being modified without having <code>poolCheckpoint</code> called, which leads to false computations.</p>\n<p>This will lead to either users losing a part of their claims, but can also lead to too many tokens could be distributed, preventing some users from claiming due to the <code>totalAvailableToNow</code> requirement in <code>Minter</code>.</p>\n<h3 id=\"proof-of-concept-3\" style=\"position:relative;\"><a href=\"#proof-of-concept-3\" aria-label=\"proof of concept 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Imagine you have 2 AMM pools A and B, both with an <code>ammPoolWeight</code> of 100, where <code>poolCheckpoint</code> has not been called for a moment. Then, imagine calling <a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/tokenomics/InflationManager.sol#L318\"><code>executeAmmTokenWeight</code></a> to reduce the weight of A to 0.</p>\n<p>Only A is checkpointed <a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/tokenomics/InflationManager.sol#L591\">here</a>, so when B will be checkpointed it will call <code>getAmmRateForToken</code>, which will see a pool weight of 100 and a total weight of 100 over the whole period since the last checkpoint of B, which is false, therefore it will distribute too many tokens. This is critical has the minter expects an exact or lower than expected distribution due to the requirement of <code>totalAvailableToNow</code>.</p>\n<p>In the opposite direction, when increasing weights, it will lead to less tokens being distributed in some pools than planned, leading to a loss for users.</p>\n<h3 id=\"mitigation-steps-1\" style=\"position:relative;\"><a href=\"#mitigation-steps-1\" aria-label=\"mitigation steps 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mitigation Steps</h3>\n<p>Checkpoint every <code>LpStakerVault</code>, <code>KeeperGauge</code> or <code>AmmGauge</code> when updating the weights of one of them.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/47#issuecomment-1148656219\">chase-manning (Backd) confirmed, but disagreed with severity and commented</a>:</strong></p>\n<blockquote>\n<p>We think this should be Medium as impact is quite minor.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/47#issuecomment-1159759010\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>Because <a href=\"%60https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/tokenomics/InflationManager.sol#L518%60\"><code>getAmmRateForToken</code></a> uses the <code>totalAmmTokenWeight</code>, then all Gauges will need to be <code>poolCheckpoint</code>ed at the time the weight is changed-</p>\n<p>This is because for systems that accrue points over time, any time the multiplier changes, the growth of points has changed, and as such a new accrual needs to be performed.</p>\n<p>I believe there are 3 ways to judge this finding:</p>\n<ul>\n<li>It’s Medium as the Admin is using their privilege to change the points, potentially to their favour or to someones detriment.</li>\n<li>It’s High because the math is wrong and the code fails (by a way of lack of approximation) to properly allocate the resources.</li>\n<li>It’s Medium because while the finding is correct in a vacuum, anyone can call <code>poolCheckpoint</code>, as such if a true concern for fairness is made, anyone can front-run and back-run the update of weights with the goal of offering the most accurate math possible.</li>\n</ul>\n<p>Given those considerations, I want to emphasize that not calling <code>poolCheckpoint</code> can cause potentially drastic leaks of value, in a way similar to the original Sushi MasterChef’s lack of <code>massUpdatePools</code> could.</p>\n<p>That said, I believe the finding is of medium severity as any individual could setup a bot to monitor and prevent this and it would require the weights to be changed by governance and impact can be quite minor as long as the pools are used.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-05-bkdlockerdepositfees-can-be-front-run-to-steal-the-newly-added-rewardtoken\" style=\"position:relative;\"><a href=\"#m-05-bkdlockerdepositfees-can-be-front-run-to-steal-the-newly-added-rewardtoken\" aria-label=\"m 05 bkdlockerdepositfees can be front run to steal the newly added rewardtoken permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/95\">[M-05] <code>BkdLocker#depositFees()</code> can be front run to steal the newly added rewardToken</a></h2>\n<p><em>Submitted by WatchPug</em></p>\n<p>Every time the <code>BkdLocker#depositFees()</code> gets called, there will be a surge of rewards per locked token for the existing stakeholders.</p>\n<p>This enables a well-known attack vector, in which the attacker will take a large portion of the shares before the surge, then claim the rewards and exit immediately.</p>\n<p>While the <code>_WITHDRAW_DELAY</code> can be set longer to mitigate this issue in the current implementation, it is possible for the admin to configure it to a very short period of time or even <code>0</code>.</p>\n<p>In which case, the attack will be very practical and effectively steal the major part of the newly added rewards.</p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L90-L100\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L90-L100</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">depositFees</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">INVALID_AMOUNT</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">totalLockedBoosted</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">NOT_ENOUGH_FUNDS</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">rewardToken</span><span class=\"mtk1\">).</span><span class=\"mtk11\">safeTransferFrom</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">), </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">RewardTokenData</span><span class=\"mtk1\"> </span><span class=\"mtk12\">storage</span><span class=\"mtk1\"> </span><span class=\"mtk12\">curRewardTokenData</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">rewardTokenData</span><span class=\"mtk1\">[</span><span class=\"mtk12\">rewardToken</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">curRewardTokenData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">feeIntegral</span><span class=\"mtk1\"> += </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">.</span><span class=\"mtk11\">scaledDiv</span><span class=\"mtk1\">(</span><span class=\"mtk12\">totalLockedBoosted</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">curRewardTokenData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">feeBalance</span><span class=\"mtk1\"> += </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">FeesDeposited</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h3 id=\"proof-of-concept-4\" style=\"position:relative;\"><a href=\"#proof-of-concept-4\" aria-label=\"proof of concept 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Given:</p>\n<ul>\n<li>Current <code>totalLockedBoosted()</code> is <code>100,000 govToken</code>;</li>\n<li>Pending distribution fees amount is <code>1,000 rewardToken</code>;</li>\n<li><code>depositFees()</code> is called to add <code>1,000 rewardToken</code>;</li>\n<li>The attacker frontrun the 1st transaction with a <code>lock()</code> transaction to deposit <code>100,000 govToken</code>, taking 50% of the pool;</li>\n<li>After the transaction in step 1 is mined, the attacker calls <code>claimFees()</code> and received <code>500 rewardToken</code>.</li>\n</ul>\n<p>As a result, the attacker has stolen half of the pending fees which belong to the old users.</p>\n<h3 id=\"recommendation-1\" style=\"position:relative;\"><a href=\"#recommendation-1\" aria-label=\"recommendation 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommendation</h3>\n<p>Consider switching the reward to a <code>rewardRate</code>-based gradual release model, such as Synthetix’s StakingRewards contract.</p>\n<p>See: <a href=\"https://github.com/Synthetixio/synthetix/blob/develop/contracts/StakingRewards.sol#L113-L132\">https://github.com/Synthetixio/synthetix/blob/develop/contracts/StakingRewards.sol#L113-L132</a></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/95#issuecomment-1147355483\">chase-manning (Backd) disputed and commented</a>:</strong></p>\n<blockquote>\n<p>The withdrawal delay prevents this attack.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/95#issuecomment-1159760706\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>Given the need for:</p>\n<ul>\n<li>Withdrawal delay set to 0 or small</li>\n<li>Need for front-running which causes leak of value</li>\n</ul>\n<p>I believe High Severity to be out of the question.</p>\n<p>That said, because the rewards are given out at the time of <code>depositFees</code>, and they are not linearly vested, I do believe that a front-run MEV attack can be executed, being able to immediately claim the reward tokens, at the cost / risk of having to lock the tokens.</p>\n<p>The shorter the withdrawal delay, the lower the risk for the attack..</p>\n<p>Because this is contingent on configuration, and at best it’s a loss of yield for the lockers, I believe Medium Severity to be more appropriat.</p>\n</blockquote>\n<blockquote>\n<p>As an additional note, please consider the fact that if the potential value gained is high enough, an attacker could just hedge the risk of locking by shorting the tokens, effectively being delta neutral while using the rewards for profit.</p>\n<p>This means that if your token becomes liquid enough (a goal for any protocol), you would expect the withdrawal delay to become ineffective as hedging options become available.</p>\n<p>Forcing the rewards to linearly vest will prevent the front-run from being effective and will reward long term lockers.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-06-mintersol_executeinflationrateupdate-inflationmanagercheckpointallgauges-is-called-after-inflationrate-is-updated-causing-users-to-lose-rewards\" style=\"position:relative;\"><a href=\"#m-06-mintersol_executeinflationrateupdate-inflationmanagercheckpointallgauges-is-called-after-inflationrate-is-updated-causing-users-to-lose-rewards\" aria-label=\"m 06 mintersol_executeinflationrateupdate inflationmanagercheckpointallgauges is called after inflationrate is updated causing users to lose rewards permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/98\">[M-06] <code>Minter.sol#_executeInflationRateUpdate()</code> <code>inflationManager().checkpointAllGauges()</code> is called after InflationRate is updated, causing users to lose rewards</a></h2>\n<p><em>Submitted by WatchPug</em></p>\n<p>When <code>Minter.sol#_executeInflationRateUpdate()</code> is called, if an <code>_INFLATION_DECAY_PERIOD</code> has past since <code>lastInflationDecay</code>, it will update the InflationRate for all of the gauges.</p>\n<p>However, in the current implementation, the rates will be updated first, followed by the rewards being settled using the new rates on the gauges using <code>inflationManager().checkpointAllGauges()</code>.</p>\n<p>If the <code>_INFLATION_DECAY_PERIOD</code> has passed for a long time before <code>Minter.sol#executeInflationRateUpdate()</code> is called, the users may lose a significant amount of rewards.</p>\n<p>On a side note, <code>totalAvailableToNow</code> is updated correctly.</p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L187-L215\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L187-L215</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_executeInflationRateUpdate</span><span class=\"mtk1\">() </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">totalAvailableToNow</span><span class=\"mtk1\"> += (</span><span class=\"mtk12\">currentTotalInflation</span><span class=\"mtk1\"> * (</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">lastEvent</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">lastEvent</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">lastInflationDecay</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">_INFLATION_DECAY_PERIOD</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">currentInflationAmountLp</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">currentInflationAmountLp</span><span class=\"mtk1\">.</span><span class=\"mtk11\">scaledMul</span><span class=\"mtk1\">(</span><span class=\"mtk12\">annualInflationDecayLp</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">initialPeriodEnded</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">currentInflationAmountKeeper</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">currentInflationAmountKeeper</span><span class=\"mtk1\">.</span><span class=\"mtk11\">scaledMul</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">annualInflationDecayKeeper</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">currentInflationAmountAmm</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">currentInflationAmountAmm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">scaledMul</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">annualInflationDecayAmm</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">currentInflationAmountKeeper</span><span class=\"mtk1\"> =</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">initialAnnualInflationRateKeeper</span><span class=\"mtk1\"> /</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">_INFLATION_DECAY_PERIOD</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">currentInflationAmountAmm</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">initialAnnualInflationRateAmm</span><span class=\"mtk1\"> / </span><span class=\"mtk12\">_INFLATION_DECAY_PERIOD</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">initialPeriodEnded</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">currentTotalInflation</span><span class=\"mtk1\"> =</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">currentInflationAmountLp</span><span class=\"mtk1\"> +</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">currentInflationAmountKeeper</span><span class=\"mtk1\"> +</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">currentInflationAmountAmm</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">controller</span><span class=\"mtk1\">.</span><span class=\"mtk11\">inflationManager</span><span class=\"mtk1\">().</span><span class=\"mtk11\">checkpointAllGauges</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">lastInflationDecay</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L110-L125\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L110-L125</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">checkpointAllGauges</span><span class=\"mtk1\">() </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">length</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_keeperGauges</span><span class=\"mtk1\">.</span><span class=\"mtk11\">length</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">length</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">i</span><span class=\"mtk1\">.</span><span class=\"mtk11\">uncheckedInc</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">IKeeperGauge</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_keeperGauges</span><span class=\"mtk1\">.</span><span class=\"mtk11\">valueAt</span><span class=\"mtk1\">(</span><span class=\"mtk12\">i</span><span class=\"mtk1\">)).</span><span class=\"mtk11\">poolCheckpoint</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">stakerVaults</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">addressProvider</span><span class=\"mtk1\">.</span><span class=\"mtk11\">allStakerVaults</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">stakerVaults</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">i</span><span class=\"mtk1\">.</span><span class=\"mtk11\">uncheckedInc</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">IStakerVault</span><span class=\"mtk1\">(</span><span class=\"mtk12\">stakerVaults</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">]).</span><span class=\"mtk11\">poolCheckpoint</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">length</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_ammGauges</span><span class=\"mtk1\">.</span><span class=\"mtk11\">length</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">length</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">i</span><span class=\"mtk1\">.</span><span class=\"mtk11\">uncheckedInc</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">IAmmGauge</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_ammGauges</span><span class=\"mtk1\">.</span><span class=\"mtk11\">valueAt</span><span class=\"mtk1\">(</span><span class=\"mtk12\">i</span><span class=\"mtk1\">)).</span><span class=\"mtk11\">poolCheckpoint</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L110-L117\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L110-L117</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">poolCheckpoint</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">killed</span><span class=\"mtk1\">) </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">false</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">timeElapsed</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">lastUpdated</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">currentRate</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">IController</span><span class=\"mtk1\">(</span><span class=\"mtk12\">controller</span><span class=\"mtk1\">).</span><span class=\"mtk11\">inflationManager</span><span class=\"mtk1\">().</span><span class=\"mtk11\">getKeeperRateForPool</span><span class=\"mtk1\">(</span><span class=\"mtk12\">pool</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">perPeriodTotalInflation</span><span class=\"mtk1\">[</span><span class=\"mtk12\">epoch</span><span class=\"mtk1\">] += </span><span class=\"mtk12\">currentRate</span><span class=\"mtk1\"> * </span><span class=\"mtk12\">timeElapsed</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">lastUpdated</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">uint48</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L507-L519\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L507-L519</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">getKeeperRateForPool</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">pool</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">minter</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">keeperInflationRate</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">Minter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">minter</span><span class=\"mtk1\">).</span><span class=\"mtk11\">getKeeperInflationRate</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// After deactivation of weight based dist, KeeperGauge handles the splitting</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">weightBasedKeeperDistributionDeactivated</span><span class=\"mtk1\">) </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">keeperInflationRate</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">totalKeeperPoolWeight</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">_getKeeperGaugeKey</span><span class=\"mtk1\">(</span><span class=\"mtk12\">pool</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">poolInflationRate</span><span class=\"mtk1\"> = (</span><span class=\"mtk12\">currentUInts256</span><span class=\"mtk1\">[</span><span class=\"mtk12\">key</span><span class=\"mtk1\">] * </span><span class=\"mtk12\">keeperInflationRate</span><span class=\"mtk1\">) /</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">totalKeeperPoolWeight</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">poolInflationRate</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L173-L176\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L173-L176</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">getKeeperInflationRate</span><span class=\"mtk1\">() </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">lastEvent</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">currentInflationAmountKeeper</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<h3 id=\"proof-of-concept-5\" style=\"position:relative;\"><a href=\"#proof-of-concept-5\" aria-label=\"proof of concept 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Given:</p>\n<ul>\n<li>currentInflationAmountAmm: 12,000 Bkd (1000 per month)</li>\n<li>annualInflationDecayAmm: 50%</li>\n<li>initialPeriodEnded: true</li>\n<li>lastInflationDecay: 11 months ago</li>\n<li>_INFLATION<em>DECAY</em>PERIOD: 1 year</li>\n<li>Alice deposited as the one and only staker in the <code>AmmGauge</code> pool;</li>\n<li>1 month later;</li>\n<li><code>Minter.sol#_executeInflationRateUpdate()</code> is called;</li>\n<li>Alice <code>claimableRewards()</code> and received <code>500</code> Bkd tokens.</li>\n</ul>\n<p>Expected Results:</p>\n<ul>\n<li>Alice to receive <code>1000</code> Bkd tokens as rewards.</li>\n</ul>\n<p>Actual Results:</p>\n<ul>\n<li>Alice received <code>500</code> Bkd tokens as rewards.</li>\n</ul>\n<h3 id=\"recommendation-2\" style=\"position:relative;\"><a href=\"#recommendation-2\" aria-label=\"recommendation 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommendation</h3>\n<p>Consider moving the call to <code>checkpointAllGauges()</code> to before the <code>currentInflationAmountKeeper</code> is updated.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_executeInflationRateUpdate</span><span class=\"mtk1\">() </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">totalAvailableToNow</span><span class=\"mtk1\"> += (</span><span class=\"mtk12\">currentTotalInflation</span><span class=\"mtk1\"> * (</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">lastEvent</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">lastEvent</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">lastInflationDecay</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">_INFLATION_DECAY_PERIOD</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">controller</span><span class=\"mtk1\">.</span><span class=\"mtk11\">inflationManager</span><span class=\"mtk1\">().</span><span class=\"mtk11\">checkpointAllGauges</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">currentInflationAmountLp</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">currentInflationAmountLp</span><span class=\"mtk1\">.</span><span class=\"mtk11\">scaledMul</span><span class=\"mtk1\">(</span><span class=\"mtk12\">annualInflationDecayLp</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">initialPeriodEnded</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">currentInflationAmountKeeper</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">currentInflationAmountKeeper</span><span class=\"mtk1\">.</span><span class=\"mtk11\">scaledMul</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">annualInflationDecayKeeper</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">currentInflationAmountAmm</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">currentInflationAmountAmm</span><span class=\"mtk1\">.</span><span class=\"mtk11\">scaledMul</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">annualInflationDecayAmm</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">currentInflationAmountKeeper</span><span class=\"mtk1\"> =</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">initialAnnualInflationRateKeeper</span><span class=\"mtk1\"> /</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">_INFLATION_DECAY_PERIOD</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">currentInflationAmountAmm</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">initialAnnualInflationRateAmm</span><span class=\"mtk1\"> / </span><span class=\"mtk12\">_INFLATION_DECAY_PERIOD</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">initialPeriodEnded</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">currentTotalInflation</span><span class=\"mtk1\"> =</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">currentInflationAmountLp</span><span class=\"mtk1\"> +</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">currentInflationAmountKeeper</span><span class=\"mtk1\"> +</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">currentInflationAmountAmm</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">lastInflationDecay</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/98#issuecomment-1148627407\">chase-manning (Backd) confirmed, but disagreed with severity and commented</a>:</strong></p>\n<blockquote>\n<p>This should be medium risk, as should only have a minor impact on users getting less rewards and no over-minting can occur.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/98#issuecomment-1159764863\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how, due to an incorrect order of operations, rates for new rewards can be enacted before the old rewards are distributed, causing a loss of rewards for end users.</p>\n<p>There are 2 ways to judge this finding:</p>\n<ul>\n<li>The system is failing at distributing the proper amount of rewards, hence the finding is of High Severity</li>\n<li>End users can risk a loss of value if these functions are not called often enough as the difference between the old rates and the new rates will cause a loss of reward for the end users.</li>\n</ul>\n<p>Ultimately the impact is a loss of value, further minimized by the fact that anyone can call <code>poolCheckpoint</code> as well as <code>executeInflationRateUpdate</code> meaning the losses can be minimized.</p>\n<p>So from a coding standpoint I believe the bug should be fixed before deployment, but from a impact point of view the impact can be minimized to make “loss of yield” mostly rounding errors.</p>\n<p>Given the impact I believe the finding to be of Medium Severity. </p>\n</blockquote>\n<hr>\n<h2 id=\"m-07-feeburner-initiates-swap-without-any-slippage-checks-if-chainlink-oracle-fails-\" style=\"position:relative;\"><a href=\"#m-07-feeburner-initiates-swap-without-any-slippage-checks-if-chainlink-oracle-fails-\" aria-label=\"m 07 feeburner initiates swap without any slippage checks if chainlink oracle fails  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/44\">[M-07] FeeBurner initiates swap without any slippage checks if Chainlink oracle fails </a></h2>\n<p><em>Submitted by Ruhum</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/main/protocol/contracts/tokenomics/FeeBurner.sol#L43-L88\">https://github.com/code-423n4/2022-05-backd/blob/main/protocol/contracts/tokenomics/FeeBurner.sol#L43-L88</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/main/protocol/contracts/swappers/SwapperRouter.sol#L414-L425\">https://github.com/code-423n4/2022-05-backd/blob/main/protocol/contracts/swappers/SwapperRouter.sol#L414-L425</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/main/protocol/contracts/swappers/SwapperRouter.sol#L439\">https://github.com/code-423n4/2022-05-backd/blob/main/protocol/contracts/swappers/SwapperRouter.sol#L439</a></p>\n<h3 id=\"impact-3\" style=\"position:relative;\"><a href=\"#impact-3\" aria-label=\"impact 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>While the SwapperRouter contract isn’t explicitly in scope, it’s a dependency of the FeeBurner contract which <em>is</em> in scope. So I think it’s valid to make this submission.</p>\n<p>The SwapperRouter contract uses the chainlink oracle to compute the minimum amount of tokens it should expect from the swap. The value is then used for the slippage check. But, if the chainlink oracle fails, for whatever reason, the contract uses <code>0</code> for the slippage check instead. Thus there’s a scenario where swaps initiated by the FeeBurner contract can be sandwiched.</p>\n<h3 id=\"proof-of-concept-6\" style=\"position:relative;\"><a href=\"#proof-of-concept-6\" aria-label=\"proof of concept 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<ol>\n<li>multiple swaps initiated through <a href=\"https://github.com/code-423n4/2022-05-backd/blob/main/protocol/contracts/tokenomics/FeeBurner.sol#L43-L88\"><code>FeeBurner.burnToTarget()</code></a></li>\n<li>SwapperRouter calls <a href=\"https://github.com/code-423n4/2022-05-backd/blob/main/protocol/contracts/swappers/SwapperRouter.sol#L220\"><code>_minTokenAmountOut()</code></a> to determine <code>min_out</code> parameter.</li>\n<li><a href=\"https://github.com/code-423n4/2022-05-backd/blob/main/protocol/contracts/swappers/SwapperRouter.sol#L414-L425\"><code>minTokenAmountOut()</code></a> returns <code>0</code> when Chainlink oracle fails</li>\n</ol>\n<h3 id=\"recommended-mitigation-steps-3\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-3\" aria-label=\"recommended mitigation steps 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Either revert the transaction or initiate the transaction with a default slippage of 99%. In the case of Curve, you can get the expected amount through <code>get_dy()</code> and then multiply the value by 0.99. Use that as the <code>min_out</code> value and you don’t have to worry about chainlink</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/44#issuecomment-1147362714\">chase-manning (Backd) disputed and commented</a>:</strong></p>\n<blockquote>\n<p>This is intended functionality. If there is no oracle for a token, we still want to swap it, even if this presents a possible sandwich attack. It should be rare for a token to not have an oracle, and when it does we would rather accept slippage as opposed to not being able to swap it at all.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/44#issuecomment-1159775547\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>I acknowledge the sponsor reply that they want to offer a service to the end user in allowing any swappable token to be used.</p>\n<p>While I believe the intent of the sponsor is respectable, the reality of the code is that it indeed allows for price manipulation and extraction of value, personally I would recommend end users to perform their own swaps to ensure a more reliable outcome.</p>\n<p>That said, because the code can be subject to leak of value, I believe Medium Severity to be appropriate.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-08-users-can-claim-extremely-large-rewards-or-lock-rewards-from-lpgauge-due-to-uninitialised-poollastupdate-variable\" style=\"position:relative;\"><a href=\"#m-08-users-can-claim-extremely-large-rewards-or-lock-rewards-from-lpgauge-due-to-uninitialised-poollastupdate-variable\" aria-label=\"m 08 users can claim extremely large rewards or lock rewards from lpgauge due to uninitialised poollastupdate variable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/141\">[M-08] Users can claim extremely large rewards or lock rewards from LpGauge due to uninitialised <code>poolLastUpdate</code> variable</a></h2>\n<p><em>Submitted by scaraven</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/LpGauge.sol#L115-L119\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/LpGauge.sol#L115-L119</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L326-L328\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L326-L328</a></p>\n<h3 id=\"impact-4\" style=\"position:relative;\"><a href=\"#impact-4\" aria-label=\"impact 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>A user can claim all of the available governance tokens or prevent any rewards from being claimed in <code>LpGauge.sol</code> if sufficient time is left between deploying the contract and initialising it in the <code>StakerVault.sol</code> contract by calling <code>initalizeLPGauge()</code> OR if a new <code>LPGauge</code> contract is deployed and added to <code>StakerVault</code> using <code>prepareLPGauge</code>.</p>\n<p>Inside <code>LPGauge.sol</code> when calling <code>_poolCheckPoint()</code>, the <code>lastUpdated</code> variable is not initalised so defaults to a value of <code>0</code>, therefore if the user has managed to stake tokens in the <code>StakerVault</code> then the calculated <code>poolStakedIntegral</code> will be very large (as block.timestamp is very large). Therefore a user can mint most current available governance tokens for themselves when they claim their rewards (or prevent any governance tokens from being claimed).</p>\n<h3 id=\"proof-of-concept-7\" style=\"position:relative;\"><a href=\"#proof-of-concept-7\" aria-label=\"proof of concept 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<ol>\n<li>LP Gauge and StakerVault contracts are deployed</li>\n<li>Before the <code>initializeLpGauge()</code>, user A will stake 1 token with <code>stakeFor()</code> thereby increasing <code>_poolTotalStaked</code> by 1.\nAs the <code>lpgauge</code> address is equal to the zero address, <code>_userCheckPoint()</code> will not be called and <code>poolLastUpdate</code> will remain at 0.</li>\n<li>The user can then directly call <code>_userCheckPoint()</code> and be allocated a very large number of shares. This works because <code>poolLastUpdate</code> is 0 but the staked amount in the vault is larger than 0</li>\n<li>Once <code>initializeLPGauge()</code> is called, the user can then call <code>claimRewards()</code> and receive a very large portion of tokens or if <code>poolStakedIntegral</code> exceeds the mint limit set by <code>Minter.sol</code> then no one else can claim governance tokens from the lpGauge.<br></li>\n</ol>\n<p>OR</p>\n<ol start=\"5\">\n<li>A new LP Gauge contract is deployed and added to the vault using <code>prepareGauge()</code>.\nFollow steps 2 to 4.</li>\n</ol>\n<h3 id=\"recommended-mitigation-steps-4\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-4\" aria-label=\"recommended mitigation steps 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Initialise <code>poolLastUpdate</code> in the constructor</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/141\">danhper (Backd) confirmed</a></strong> </p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/141#issuecomment-1159776886\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>The warden has identified a way to exploit the uninitialized value for the variable <code>poolLastUpdate</code></p>\n<p>Because this is contingent on setup, and the impact is theft of rewards, I believe Medium Severity to be more appropriate.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/141#issuecomment-1168392303\">scaraven (warden) commented</a>:</strong></p>\n<blockquote>\n<p>Hi, correct me if I am wrong but there is a second scenario where this situation can be exploited as outlined in my report. If governance deploy a new LPGauge they must do it through <code>prepareLPGauge()</code> as <code>initializeLpGauge()</code> will revert. This introduces a significant delay (3 days if I’m correct) before the LPGauge can actually be initialised with <code>executeLPGauge()</code>. Therefore a user can easily monitor this contract and call <code>poolCheckpoint()</code> as soon as soon as <code>prepareLPGauge()</code> is called and the contract has no way to prevent this.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/141#issuecomment-1168798516\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>@scaraven </p>\n<p>I don’t see any enforced delay in <code>initializeLpGauge</code>\n<img width=\"746\" alt=\"Screenshot 2022-06-28 at 15 58 48\" src=\"https://user-images.githubusercontent.com/13383782/176197515-5c8fbd11-94dd-4a81-9f7f-47e91917e40c.png\"></p>\n<p><code>_setConfig</code> bypasses the need for a <code>MIN_DELAY</code></p>\n<p>Meaning the exploit is not practical for the first gauge</p>\n<hr>\n<p>For Gauge that needs to be substituted, that will indeed require a 3 day wait period, <code>_poolCheckpoint</code> can only be effective after the first deposit has happened as well, see: <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/100\">https://github.com/code-423n4/2022-05-backd-findings/issues/100</a><br>\nWhich effects how initial rewards are calculated.</p>\n<p>Due to the math being off it may be necessary to influence <code>uint256 currentRate = inflationManager.getLpRateForStakerVault(address(stakerVault));</code></p>\n<p>This, the need for a second gauge, and the race condition between the first depositor and other depositors are external conditions, leading me to believe that Medium Severity is appropriate</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/141#issuecomment-1168877923\">scaraven (warden) commented</a>:</strong></p>\n<blockquote>\n<p>Cool, thanks for taking the time to explain</p>\n</blockquote>\n<hr>\n<h2 id=\"m-09-bkdlocker-depositfees-can-be-blocked\" style=\"position:relative;\"><a href=\"#m-09-bkdlocker-depositfees-can-be-blocked\" aria-label=\"m 09 bkdlocker depositfees can be blocked permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/8\">[M-09] BkdLocker depositFees can be blocked</a></h2>\n<p><em>Submitted by csanuragjain</em></p>\n<p>burnFees will fail if none of the pool tokens have underlying token as native ETH token. This is shown below. Since burnFees fails so no fees is deposited in BKDLocker.</p>\n<h3 id=\"proof-of-concept-8\" style=\"position:relative;\"><a href=\"#proof-of-concept-8\" aria-label=\"proof of concept 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<ol>\n<li>Assume RewardHandler.sol has currently amount 5 as address(this).balance (ethBalance) (even attacker can send a small balance to this contract to do this dos attack)</li>\n<li>None of the pools have underlying as address(0) so no ETH tokens and only ERC20 tokens are present</li>\n<li>Now feeBurner.burnToTarget is called passing current ETH balance of amount 5 with all pool tokens</li>\n<li>feeBurner loops through all tokens and swap them to WETH. Since none of the token is ETH so burningEth_ variable is false</li>\n<li>Now the below require condition fails since burningEth_ is false</li>\n</ol>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">require(burningEth_ || msg.value == 0, Error.INVALID_VALUE);</span></span></code></pre>\n<ol start=\"6\">\n<li>This fails the burnFees function.</li>\n</ol>\n<h3 id=\"recommended-mitigation-steps-5\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-5\" aria-label=\"recommended mitigation steps 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>ETH should not be sent if none of pool underlying token is ETH. Change it to something like below:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">bool ethFound=false;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">for (uint256 i; i &lt; pools.length; i = i.uncheckedInc()) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            ILiquidityPool pool = ILiquidityPool(pools[i]);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            address underlying = pool.getUnderlying();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            if (underlying != address(0)) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                _approve(underlying, address(feeBurner));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            } else</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">{</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ethFound=true;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            tokens[i] = underlying;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">if(ethFound){</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        feeBurner.burnToTarget{value: ethBalance}(tokens, targetLpToken);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">} else {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">feeBurner.burnToTarget(tokens, targetLpToken);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}</span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/8\">samwerner (Backd) confirmed</a></strong> </p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/8#issuecomment-1159797384\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how, due to a flaw in the logic, if ETH is present in the contract and no pool is denominated in ETH, then the contract will revert.</p>\n<p>This can be done as a DOS attack or for griefing.</p>\n<p>However, remediation would simply require adding a pool denominated in ETH, to ensure that the logic goes through</p>\n<p>For this reason, I believe Medium Severity to be more appropriate</p>\n</blockquote>\n<hr>\n<h2 id=\"m-10-there-are-multiple-ways-for-adminsgovernance-to-rug-users\" style=\"position:relative;\"><a href=\"#m-10-there-are-multiple-ways-for-adminsgovernance-to-rug-users\" aria-label=\"m 10 there are multiple ways for adminsgovernance to rug users permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/113\">[M-10] There are multiple ways for admins/governance to rug users</a></h2>\n<p><em>Submitted by IllIllI, also found by 0x1f8b</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L61\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L61</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L70-L75\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L70-L75</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L50\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L50</a></p>\n<h3 id=\"impact-5\" style=\"position:relative;\"><a href=\"#impact-5\" aria-label=\"impact 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>A malicious admin can steal user funds or lock their balances forever.</p>\n<p>Even if the user is benevolent the fact that there is a rug vector available may <a href=\"https://twitter.com/RugDocIO/status/1411732108029181960\">negatively impact the protocol’s reputation</a>.</p>\n<h3 id=\"proof-of-concept-9\" style=\"position:relative;\"><a href=\"#proof-of-concept-9\" aria-label=\"proof of concept 9 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Unlike the original Convex code that goes to great lengths to prevent users having the ability to transfer funds/mint things, this project introduces multiple roles and new abilities that require users to place more trust in governance:</p>\n<ol>\n<li>Admins can initiate migrations and set the <code>newPool_</code> to be a contract that forwards funds to accounts they control</li>\n</ol>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"19\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">zaps</span><span class=\"mtk1\">/</span><span class=\"mtk12\">PoolMigrationZap</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">61</span><span class=\"mtk1\">           </span><span class=\"mtk12\">ILiquidityPool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newPool_</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_underlyingNewPools</span><span class=\"mtk1\">[</span><span class=\"mtk12\">underlying_</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">62</span><span class=\"mtk1\">           </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ethValue_</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">underlying_</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">) ? </span><span class=\"mtk12\">underlyingAmount_</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">63</span><span class=\"mtk1\">           </span><span class=\"mtk12\">newPool_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">depositFor</span><span class=\"mtk1\">{value: </span><span class=\"mtk12\">ethValue_</span><span class=\"mtk1\">}(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">underlyingAmount_</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L61-L63\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L61-L63</a></p>\n<ol start=\"2\">\n<li>Admins can add infinite <code>newRewardToken</code>s:</li>\n</ol>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"20\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BkdLocker</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">70</span><span class=\"mtk1\">       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">migrate</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newRewardToken</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyGovernance</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">71</span><span class=\"mtk1\">           </span><span class=\"mtk12\">_replacedRewardTokens</span><span class=\"mtk1\">.</span><span class=\"mtk11\">remove</span><span class=\"mtk1\">(</span><span class=\"mtk12\">newRewardToken</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">72</span><span class=\"mtk1\">           </span><span class=\"mtk12\">_replacedRewardTokens</span><span class=\"mtk1\">.</span><span class=\"mtk11\">set</span><span class=\"mtk1\">(</span><span class=\"mtk12\">rewardToken</span><span class=\"mtk1\">, </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">73</span><span class=\"mtk1\">           </span><span class=\"mtk12\">lastMigrationEvent</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">74</span><span class=\"mtk1\">           </span><span class=\"mtk12\">rewardToken</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">newRewardToken</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">75</span><span class=\"mtk1\">       }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L70-L75\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L70-L75</a></p>\n<p>so that <code>_userCheckpoint()</code>s, which are required to withdraw funds, revert because they run out of gas iterating over the tokens:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"21\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BkdLocker</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">292</span><span class=\"mtk1\">       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_userCheckpoint</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">293           </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">user</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">294           </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amountAdded</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">295           </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newTotal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">296       ) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">297</span><span class=\"mtk1\">           </span><span class=\"mtk12\">RewardTokenData</span><span class=\"mtk1\"> </span><span class=\"mtk12\">storage</span><span class=\"mtk1\"> </span><span class=\"mtk12\">curRewardTokenData</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">rewardTokenData</span><span class=\"mtk1\">[</span><span class=\"mtk12\">rewardToken</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">298</span><span class=\"mtk1\">   </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">299</span><span class=\"mtk1\">           </span><span class=\"mtk3\">// Compute the share earned by the user since they last updated</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">300</span><span class=\"mtk1\">           </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">userBalance</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">balances</span><span class=\"mtk1\">[</span><span class=\"mtk12\">user</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">301</span><span class=\"mtk1\">           </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">userBalance</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">302</span><span class=\"mtk1\">               </span><span class=\"mtk12\">curRewardTokenData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">userShares</span><span class=\"mtk1\">[</span><span class=\"mtk12\">user</span><span class=\"mtk1\">] += (</span><span class=\"mtk12\">curRewardTokenData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">feeIntegral</span><span class=\"mtk1\"> -</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">303</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">curRewardTokenData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">userFeeIntegrals</span><span class=\"mtk1\">[</span><span class=\"mtk12\">user</span><span class=\"mtk1\">]).</span><span class=\"mtk11\">scaledMul</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">304</span><span class=\"mtk1\">                       </span><span class=\"mtk12\">userBalance</span><span class=\"mtk1\">.</span><span class=\"mtk11\">scaledMul</span><span class=\"mtk1\">(</span><span class=\"mtk12\">boostFactors</span><span class=\"mtk1\">[</span><span class=\"mtk12\">user</span><span class=\"mtk1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">305</span><span class=\"mtk1\">                   );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">306</span><span class=\"mtk1\">   </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">307</span><span class=\"mtk1\">               </span><span class=\"mtk3\">// Update values for previous rewardTokens</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">308</span><span class=\"mtk1\">               </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">lastUpdated</span><span class=\"mtk1\">[</span><span class=\"mtk12\">user</span><span class=\"mtk1\">] &lt; </span><span class=\"mtk12\">lastMigrationEvent</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">309</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">length</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_replacedRewardTokens</span><span class=\"mtk1\">.</span><span class=\"mtk11\">length</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">310</span><span class=\"mtk1\">                   </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">length</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">i</span><span class=\"mtk1\">.</span><span class=\"mtk11\">uncheckedInc</span><span class=\"mtk1\">()) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L292-L310\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L292-L310</a></p>\n<ol start=\"3\">\n<li>Admins can set a malicious <code>feeBurner</code>, via the addressProvider, which just takes the fees for itself</li>\n</ol>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"22\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">RewardHandler</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">4</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">35</span><span class=\"mtk1\">       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">burnFees</span><span class=\"mtk1\">() </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">36</span><span class=\"mtk1\">           </span><span class=\"mtk12\">IBkdLocker</span><span class=\"mtk1\"> </span><span class=\"mtk12\">bkdLocker</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">IBkdLocker</span><span class=\"mtk1\">(</span><span class=\"mtk12\">addressProvider</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getBKDLocker</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">37</span><span class=\"mtk1\">           </span><span class=\"mtk12\">IFeeBurner</span><span class=\"mtk1\"> </span><span class=\"mtk12\">feeBurner</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">addressProvider</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getFeeBurner</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">38</span><span class=\"mtk1\">           </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">targetLpToken</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">bkdLocker</span><span class=\"mtk1\">.</span><span class=\"mtk11\">rewardToken</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">39</span><span class=\"mtk1\">           </span><span class=\"mtk12\">address</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">pools</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">addressProvider</span><span class=\"mtk1\">.</span><span class=\"mtk11\">allPools</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">40</span><span class=\"mtk1\">           </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ethBalance</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">).</span><span class=\"mtk12\">balance</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">41</span><span class=\"mtk1\">           </span><span class=\"mtk12\">address</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tokens</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">address</span><span class=\"mtk1\">[](</span><span class=\"mtk12\">pools</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">42</span><span class=\"mtk1\">           </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">pools</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">i</span><span class=\"mtk1\">.</span><span class=\"mtk11\">uncheckedInc</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">43</span><span class=\"mtk1\">               </span><span class=\"mtk12\">ILiquidityPool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">pool</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">ILiquidityPool</span><span class=\"mtk1\">(</span><span class=\"mtk12\">pools</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">44</span><span class=\"mtk1\">               </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">underlying</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">pool</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getUnderlying</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">45</span><span class=\"mtk1\">               </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">underlying</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">46</span><span class=\"mtk1\">                   </span><span class=\"mtk11\">_approve</span><span class=\"mtk1\">(</span><span class=\"mtk12\">underlying</span><span class=\"mtk1\">, </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">feeBurner</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">47</span><span class=\"mtk1\">               }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">48</span><span class=\"mtk1\">               </span><span class=\"mtk12\">tokens</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">underlying</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">49</span><span class=\"mtk1\">           }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">50</span><span class=\"mtk1\">           </span><span class=\"mtk12\">feeBurner</span><span class=\"mtk1\">.</span><span class=\"mtk12\">burnToTarget</span><span class=\"mtk1\">{value: </span><span class=\"mtk12\">ethBalance</span><span class=\"mtk1\">}(</span><span class=\"mtk12\">tokens</span><span class=\"mtk1\">, </span><span class=\"mtk12\">targetLpToken</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L35-L50\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L35-L50</a></p>\n<ol start=\"4\">\n<li>Admins can set an oracle that provides the wrong answers:</li>\n</ol>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"23\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">swappers</span><span class=\"mtk1\">/</span><span class=\"mtk12\">SwapperRouter</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">5</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">452</span><span class=\"mtk1\">           </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_addressProvider</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getOracleProvider</span><span class=\"mtk1\">().</span><span class=\"mtk11\">getPriceETH</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token_</span><span class=\"mtk1\">) </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">price_</span><span class=\"mtk1\">) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/swappers/SwapperRouter.sol#L452\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/swappers/SwapperRouter.sol#L452</a></p>\n<h3 id=\"recommended-mitigation-steps-6\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-6\" aria-label=\"recommended mitigation steps 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>The trust-minimizing approach that Convex took was to not allow admins to change addresses. In order for things to change, an admin is allowed to completely shut everything down, and during the shut down state, users are still able to withdraw their funds. Later, the admins spin up a whole new set of contracts, and let users migrate things themselves. Something similar can be done here by having the DAO accept proposals to spawn specific contracts, and hook up specific addresses in certain ways in the new deployment.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/113#issuecomment-1147384553\">danhper (Backd) disputed and commented</a>:</strong></p>\n<blockquote>\n<p>This is a design decision. Many protocols are fully upgradeable (Compound, Aave, Maker) and some decide to be fully immutable (Convex, Curve). The governance process will be formalized a little later and have safeguards in place but we are not planning on following Convex’s approach nor think that it is the “correct” way to design a protocol.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/113#issuecomment-1159809027\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has listed multiple ways in which Admin Privilege can be used against users of the protocol.</p>\n<p>While the sponsor may be fully aware of these mechanics, it is very important that these type of risks are clearly explained to end-users as they can ultimately bear the consequences of those risks.</p>\n<p>Because the findings are contingent on a malicious admin, I believe Medium Severity to be appropriate.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-11-usage-of-deprecated-transfer-to-send-eth\" style=\"position:relative;\"><a href=\"#m-11-usage-of-deprecated-transfer-to-send-eth\" aria-label=\"m 11 usage of deprecated transfer to send eth permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/180\">[M-11] Usage of deprecated transfer to send ETH</a></h2>\n<p><em>Submitted by peritoflores, also found by JC and StyxRave</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/swappers/SwapperRouter.sol#L140\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/swappers/SwapperRouter.sol#L140</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/swappers/SwapperRouter.sol#L280\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/swappers/SwapperRouter.sol#L280</a></p>\n<h3 id=\"impact-6\" style=\"position:relative;\"><a href=\"#impact-6\" aria-label=\"impact 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>Usage of deprecated transfer Swap can revert.</p>\n<h3 id=\"proof-of-concept-10\" style=\"position:relative;\"><a href=\"#proof-of-concept-10\" aria-label=\"proof of concept 10 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>The original <code>transfer</code> used to send eth uses a fixed stipend 2300 gas.   This was used to prevent reentrancy.   However this limit your protocol to interact with others contracts that need more than that to process the transaction.</p>\n<p>A good article about that:\n<a href=\"https://consensys.net/diligence/blog/2019/09/stop-using-soliditys-transfer-now/\">https://consensys.net/diligence/blog/2019/09/stop-using-soliditys-transfer-now/</a>.</p>\n<h3 id=\"recommended-mitigation-steps-7\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-7\" aria-label=\"recommended mitigation steps 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Used call instead.  For example</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"24\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">    (bool success, ) = msg.sender.call{amount}(&quot;&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    require(success, &quot;Transfer failed.&quot;);</span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/180\">chase-manning (Backd) confirmed</a></strong> </p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/180#issuecomment-1159810449\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>While submission is lazy in that it doesn’t show the ways in which it could revert, (for example most of the times even a transfer to a gnosis-safe will not revert as the gas stipend is sufficient)</p>\n<p>It’s true that <code>transfer</code>s gas stipend may run out, causing reverts</p>\n<p>For this reason I agree with Med Severity.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-12-users-can-claim-more-fees-than-expected-if-governance-migrates-current-rewardtoken-again-by-fault\" style=\"position:relative;\"><a href=\"#m-12-users-can-claim-more-fees-than-expected-if-governance-migrates-current-rewardtoken-again-by-fault\" aria-label=\"m 12 users can claim more fees than expected if governance migrates current rewardtoken again by fault permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/86\">[M-12] Users can claim more fees than expected if governance migrates current rewardToken again by fault.</a></h2>\n<p><em>Submitted by hansfriese, also found by csanuragjain and unforgiven</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/BkdLocker.sol#L70-L75\">https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/BkdLocker.sol#L70-L75</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/BkdLocker.sol#L302-L322\">https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/BkdLocker.sol#L302-L322</a></p>\n<h3 id=\"impact-7\" style=\"position:relative;\"><a href=\"#impact-7\" aria-label=\"impact 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>Users can claim more fees than expected if governance migrates current rewardToken again by fault.</p>\n<h3 id=\"proof-of-concept-11\" style=\"position:relative;\"><a href=\"#proof-of-concept-11\" aria-label=\"proof of concept 11 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>In the migrate() function, there is no requirement newRewardToken != rewardToken.\nIf this function is called with the same “rewardToken” parameter, ”_replacedRewardTokens” will contain the current “rewardToken” also.\nThen when the user claims fees, “userShares” will be added two times for the same token at L302-L305, L314-L317.</p>\n<p>It’s because “curRewardTokenData.userFeeIntegrals[user]” is updated at L332 after the “userShares” calculation for past rewardTokens.\nSo the user can get paid more fees than he should.</p>\n<h3 id=\"tools-used\" style=\"position:relative;\"><a href=\"#tools-used\" aria-label=\"tools used permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>Solidity Visual Developer of VSCode</p>\n<h3 id=\"recommended-mitigation-steps-8\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-8\" aria-label=\"recommended mitigation steps 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>You need to add this require() at L71.</p>\n<p>require(newRewardToken != rewardToken, Error.SAME<em>AS</em>CURRENT);</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/86\">danhper (Backd) confirmed</a></strong> </p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/86#issuecomment-1160995252\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has identified how a governance migration from and to the same token can cause the rewards to be double-counted.</p>\n<p>Because the exploit is contingent on:</p>\n<ul>\n<li>Admin Privilege</li>\n<li>Would cause issues with Yield</li>\n</ul>\n<p>I believe Medium Severity to be appropriate.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-13-inconsistency-in-view-functions-can-lead-to-users-believing-theyre-due-for-more-bkd-rewards\" style=\"position:relative;\"><a href=\"#m-13-inconsistency-in-view-functions-can-lead-to-users-believing-theyre-due-for-more-bkd-rewards\" aria-label=\"m 13 inconsistency in view functions can lead to users believing theyre due for more bkd rewards permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/150\">[M-13] Inconsistency in view functions can lead to users believing they’re due for more BKD rewards</a></h2>\n<p><em>Submitted by SmartSek</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmConvexGauge.sol#L107-L111\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmConvexGauge.sol#L107-L111</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmConvexGauge.sol#L129-L134\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmConvexGauge.sol#L129-L134</a></p>\n<h3 id=\"impact-8\" style=\"position:relative;\"><a href=\"#impact-8\" aria-label=\"impact 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>The view functions used for a user to check their claimable rewards vary in their implementation. This can cause users to believe they are due X amount but will receive Y.</p>\n<h3 id=\"proof-of-concept-12\" style=\"position:relative;\"><a href=\"#proof-of-concept-12\" aria-label=\"proof of concept 12 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>If the <code>inflationRecipient</code> is set, then <code>poolStakedIntegral</code> will be incremented in <code>claimableRewards()</code> but not in any other function like <code>allClaimableRewards()</code> or <code>poolCheckpoint()</code>.</p>\n<p>If a user calls <code>claimableRewards()</code> after the <code>inflationRepient</code> has been set, <code>claimableRewards()</code> will return a larger value than <code>allClaimableRewards()</code> or the amount actually returned by <code>claimRewards()</code>.</p>\n<h3 id=\"recommended-mitigation-steps-9\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-9\" aria-label=\"recommended mitigation steps 9 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>To make the logic consistent, <code>claimableRewards()</code> needs <code>if (inflationRecipient == address(0))</code> added to it.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/150\">chase-manning (Backd) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/150#issuecomment-1161070065\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has identified an incorrect implementation in how rewards are shown, while no assets are at risk, the issue identified is a programming mistake that could cause further issues.</p>\n<p>For this reason I agree with Medium Severity</p>\n</blockquote>\n<blockquote>\n<p>I’m still fairly conflicted on severity as the impact is going to be quite small, however at this time, because the “code is wrong”, I still think Medium Severity to be valid.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-14-stakervaultunstake-stakervaultunstakefor-would-revert-with-a-uint-underflow-error-of-stakervaultstrategiestotalstaked-stakervault_pooltotalstaked\" style=\"position:relative;\"><a href=\"#m-14-stakervaultunstake-stakervaultunstakefor-would-revert-with-a-uint-underflow-error-of-stakervaultstrategiestotalstaked-stakervault_pooltotalstaked\" aria-label=\"m 14 stakervaultunstake stakervaultunstakefor would revert with a uint underflow error of stakervaultstrategiestotalstaked stakervault_pooltotalstaked permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/87\">[M-14] StakerVault.unstake(), StakerVault.unstakeFor() would revert with a uint underflow error of StakerVault.strategiesTotalStaked, StakerVault._poolTotalStaked.</a></h2>\n<p><em>Submitted by hansfriese</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/StakerVault.sol#L98-L102\">https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/StakerVault.sol#L98-L102</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/StakerVault.sol#L342-L346\">https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/StakerVault.sol#L342-L346</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/StakerVault.sol#L391-L395\">https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/StakerVault.sol#L391-L395</a></p>\n<h3 id=\"impact-9\" style=\"position:relative;\"><a href=\"#impact-9\" aria-label=\"impact 9 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>StakerVault.unstake(), StakerVault.unstakeFor() would revert with a uint underflow error of StakerVault.strategiesTotalStaked, StakerVault._poolTotalStaked.</p>\n<h3 id=\"proof-of-concept-13\" style=\"position:relative;\"><a href=\"#proof-of-concept-13\" aria-label=\"proof of concept 13 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Currently it saves totalStaked for strategies and non-strategies separately.</p>\n<p>uint underflow error could occur in these cases.</p>\n<p>Scenario 1.</p>\n<ol>\n<li>Address A(non-strategy) stakes some amount x and it will be added to StakerVault_poolTotalStaked.</li>\n<li>This address A is approved as a strategy by StakerVault.inflationManager.</li>\n<li>Address A tries to unstake amount x, it will be deducted from StakerVault.strategiesTotalStaked because this address is a strategy already.</li>\n</ol>\n<p>Even if it would succeed for this strategy but it will revert for other strategies because StakerVault.strategiesTotalStaked is less than correct staked amount for strategies.</p>\n<p>Scenario 2.\nThere is a transfer between strategy and non-strategy using StakerVault.transfer(), StakerVault.transferFrom() functions.\nIn this case, StakerVault.strategiesTotalStaked and StakerVault._poolTotalStaked must be changed accordingly but there is no such logic.</p>\n<h3 id=\"tools-used-1\" style=\"position:relative;\"><a href=\"#tools-used-1\" aria-label=\"tools used 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>Solidity Visual Developer of VSCode</p>\n<h3 id=\"recommended-mitigation-steps-10\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-10\" aria-label=\"recommended mitigation steps 10 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>You need to modify 3 functions. StakerVault.addStrategy(), StakerVault.transfer(), StakerVault.transferFrom().</p>\n<ol>\n<li>\n<p>You need to move staked amount from StakerVault._poolTotalStaked to StakerVault.strategiesTotalStaked every time when StakerVault.inflationManager approves a new strategy.</p>\n<p>You can modify addStrategy() at L98-L102 like this.</p>\n<p>function addStrategy(address strategy) external override returns (bool) {\nrequire(msg.sender == address(inflationManager), Error.UNAUTHORIZED<em>ACCESS);\nrequire(!strategies[strategy], Error.ADDRESS</em>ALREADY_SET);</p>\n<p>strategies[strategy] = true;\n_poolTotalStaked -= balances[strategy];\nstrategiesTotalStaked += balances[strategy];</p>\n<p>return true;\n}</p>\n</li>\n<li>\n<p>You need to add below code at L126 of transfer() function.</p>\n<p>if(strategies[msg.sender] != strategies[account]) {\nif(strategies[msg.sender]) { // from strategy to non-strategy\n_poolTotalStaked += amount;\nstrategiesTotalStaked -= amount;\n}\nelse { // from non-strategy to strategy\n_poolTotalStaked -= amount;\nstrategiesTotalStaked += amount;\n}\n}</p>\n</li>\n<li>\n<p>You need to add below code at L170 of transferFrom() function.</p>\n<p>if(strategies[src] != strategies[dst]) {\nif(strategies[src]) { // from strategy to non-strategy\n_poolTotalStaked += amount;\nstrategiesTotalStaked -= amount;\n}\nelse { // from non-strategy to strategy\n_poolTotalStaked -= amount;\nstrategiesTotalStaked += amount;\n}\n}</p>\n</li>\n</ol>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/87\">danhper (Backd) confirmed</a></strong> </p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/87#issuecomment-1161075516\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has identified a way for funds to be stuck due to underflow.</p>\n<p>While the odds of this happening are fairly low, the grief can be executed by frontrunning the <code>addStrategy</code> call, as well as by mistake.</p>\n<p>Additionally, a strategy doesn’t seem to be removable making the loss of those hypothetical tokens permanent.</p>\n<p>For those reasons I believe Medium Severity to be appropriate.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-15-potential-dos-when-removing-keeper-gauge\" style=\"position:relative;\"><a href=\"#m-15-potential-dos-when-removing-keeper-gauge\" aria-label=\"m 15 potential dos when removing keeper gauge permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/71\">[M-15] Potential DoS when removing keeper gauge</a></h2>\n<p><em>Submitted by shenwilly</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L609-L618\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L609-L618</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L82\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L82</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/actions/topup/TopUpActionFeeHandler.sol#L95-L98\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/actions/topup/TopUpActionFeeHandler.sol#L95-L98</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/actions/topup/TopUpAction.sol#L807\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/actions/topup/TopUpAction.sol#L807</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/actions/topup/TopUpAction.sol#L653\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/actions/topup/TopUpAction.sol#L653</a></p>\n<h3 id=\"impact-10\" style=\"position:relative;\"><a href=\"#impact-10\" aria-label=\"impact 10 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>When <code>_removeKeeperGauge</code> is called, there is no guarantee that the keeper gauge isn’t currently in use by any <code>TopUpActionFeeHandler</code>. If it’s still in use, any top up action executions will be disabled as reporting fees in <code>KeeperGauge.sol</code> will revert:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"25\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">function reportFees(</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    address beneficiary,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    uint256 amount,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    address lpTokenAddress</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">) external override returns (bool) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    ...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    require(!killed, Error.CONTRACT_PAUSED); // gauge is killed by InflationManager</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    ...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    return true;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}</span></span></code></pre>\n<p>If this happened during extreme market movements, some positions that require a top up will not be executed and be in risk of being liquidated.</p>\n<h3 id=\"proof-of-concept-14\" style=\"position:relative;\"><a href=\"#proof-of-concept-14\" aria-label=\"proof of concept 14 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<ul>\n<li>Alice registers a top up action.</li>\n<li>Governance calls <code>InflationManager.removeKeeperGauge</code>, replacing an old keeper gauge. However, governance forgot to call <code>TopUpActionFeeHandler.prepareKeeperGauge</code> so <code>TopUpActionFeeHandler.getKeeperGauge</code> still points to the killed gauge.</li>\n<li>Market moved and Alice’s position should now be executed by keepers, however any attempt to execute will revert:\n> Keeper calls TopUpAction.execute();\n> _payFees();\n> IActionFeeHandler(feeHandler).payFees();\n> IKeeperGauge(keeperGauge).reportFees();\n> reverts as gauge is already killed</li>\n<li>Governance noticed and calls <code>prepareKeeperGauge</code>  with a 3 days delay.</li>\n<li>Alice’s position got liquidated before the change is executed.</li>\n</ul>\n<h3 id=\"recommended-mitigation-steps-11\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-11\" aria-label=\"recommended mitigation steps 11 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Consider adding an on-chain check to ensure that the keeper gauge is not in use before removing them.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/71\">danhper (Backd) confirmed</a></strong> </p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/71#issuecomment-1163180483\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>I believe the warden has shown a situation in which calling <code>_removeKeeperGauge</code> can cause <code>payFees</code> to revert, making it impossible (for a time) for fees to be paid.</p>\n<p>I do not believe the impact will extend beyond: </p>\n<ul>\n<li>Potential loss of yield (or delay)</li>\n<li>Need for governance to set a new gauge</li>\n</ul>\n<p>I disagree with the statement: <code>Alice's position got liquidated before the change is executed.</code> as no liquidation should be contingent on fees being paid from this function.</p>\n<p>Because the finding shows how the system for fees can be stopped due to external conditions, I agree with Medium Seveirty</p>\n</blockquote>\n<hr>\n<h2 id=\"m-16-its-possible-to-initialize-contract-bkdlocker-for-multiple-times-by-sending-startboost0-and-each-time-different-values-for-other-parameters\" style=\"position:relative;\"><a href=\"#m-16-its-possible-to-initialize-contract-bkdlocker-for-multiple-times-by-sending-startboost0-and-each-time-different-values-for-other-parameters\" aria-label=\"m 16 its possible to initialize contract bkdlocker for multiple times by sending startboost0 and each time different values for other parameters permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/136\">[M-16] it’s possible to initialize contract BkdLocker for multiple times by sending startBoost=0 and each time different values for other parameters</a></h2>\n<p><em>Submitted by unforgiven, also found by 0x1f8b and scaraven</em></p>\n<p>function <code>initialize()</code> of <code>BkdLocker</code> suppose to be called one time and contract initialize one time. but if it’s called by <code>startBoost=0</code> then it’s possible to call it again with different values for other parameters. there are some logics based on the values function <code>initilize()</code> sets which is in calculating boost and withdraw delay. by initializing multiple times different users get different values for those logics and because rewards are distributed based on boosts so those logics will be wrong too.</p>\n<h3 id=\"proof-of-concept-15\" style=\"position:relative;\"><a href=\"#proof-of-concept-15\" aria-label=\"proof of concept 15 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>This is <code>initiliaze()</code> code in <code>BkdLocker</code>:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"26\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">    function initialize(</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        uint256 startBoost,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        uint256 maxBoost,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        uint256 increasePeriod,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        uint256 withdrawDelay</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    ) external override onlyGovernance {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        require(currentUInts256[_START_BOOST] == 0, Error.CONTRACT_INITIALIZED);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _setConfig(_START_BOOST, startBoost);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _setConfig(_MAX_BOOST, maxBoost);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _setConfig(_INCREASE_PERIOD, increasePeriod);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _setConfig(_WITHDRAW_DELAY, withdrawDelay);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span></code></pre>\n<p>As you can see it checks the initialization statue by <code>currentUInts256[_START_BOOST]</code>’s value but it’s not correct way to do and initializer can set <code>currentUInts256[_START_BOOST]</code> value as <code>0</code> and set other parameters values and call this function multiple times with different values for <code>_MAX_BOOST</code> and <code>_INCREASE_PERIOD</code> and <code>_WITHDRAW_DELAY</code>. setting different values for those parameters can cause different calculation in <code>computeNewBoost()</code> and <code>prepareUnlock()</code>. function <code>computeNewBoost()</code> is used to calculate users boost parameters which is used on reward distribution. so by changing <code>_MAX_BOOST</code> the rewards will be distributed wrongly between old users and new users.</p>\n<h3 id=\"tools-used-2\" style=\"position:relative;\"><a href=\"#tools-used-2\" aria-label=\"tools used 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>VIM</p>\n<h3 id=\"recommended-mitigation-steps-12\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-12\" aria-label=\"recommended mitigation steps 12 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Add some other variable to check the status of initialization of contract.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/136\">danhper (Backd) confirmed, but disagreed with severity</a></strong> </p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/136#issuecomment-1163189343\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how, under specific circumstances, the <code>BkdLocker</code> contact can be initialized multiple times, with the specific goal of changing configuration parameters.</p>\n<p>From my understanding these configs are meant to be set only once (there are no available external setters that governance can call), effectively sidestepping the “perceived immutability” that the locker seems to be offering.</p>\n<p>The attack is contingent on malicious Governance, for that reason I believe Medium Severity to be appropriate.</p>\n<p>The impact of the attack can cause:</p>\n<ul>\n<li>Loss of Yield</li>\n<li>Unfair distribution of rewards</li>\n<li>Abuse of rewards math for governance advantage</li>\n</ul>\n<p>End users can verify that the exploit is not applicable by ensuring that <code>startBoost</code> is greater than 0.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-17-strategy-in-stakervaultsol-can-steal-more-rewards-even-though-its-designed-strategies-shouldnt-get-rewards\" style=\"position:relative;\"><a href=\"#m-17-strategy-in-stakervaultsol-can-steal-more-rewards-even-though-its-designed-strategies-shouldnt-get-rewards\" aria-label=\"m 17 strategy in stakervaultsol can steal more rewards even though its designed strategies shouldnt get rewards permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/85\">[M-17] Strategy in StakerVault.sol can steal more rewards even though it’s designed strategies shouldn’t get rewards.</a></h2>\n<p><em>Submitted by hansfriese</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/StakerVault.sol#L95\">https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/StakerVault.sol#L95</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/tokenomics/LpGauge.sol#L52-L63\">https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/tokenomics/LpGauge.sol#L52-L63</a></p>\n<h3 id=\"impact-11\" style=\"position:relative;\"><a href=\"#impact-11\" aria-label=\"impact 11 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>Strategy in StakerVault.sol can steal more rewards even though it’s designed strategies shouldn’t get rewards.</p>\n<p>Also there will be a problem with a rewarding system in LpGauge.sol so that some normal users wouldn’t get rewards properly.</p>\n<h3 id=\"proof-of-concept-16\" style=\"position:relative;\"><a href=\"#proof-of-concept-16\" aria-label=\"proof of concept 16 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<ol>\n<li>\n<p>Strategy A staked amount x and x will be added to StakerVault.strategiesTotalStaked.</p>\n<p>contracts\\StakerVault.sol#L312</p>\n</li>\n<li>Strategy A transferred the amount x to non-strategy B and StakerVault.strategiesTotalStaked, StakerVault.\n_poolTotalStaked won’t be updated.\ncontracts\\StakerVault.sol#L111</li>\n<li>\n<p>After some time for the larger LpGauge.poolStakedIntegral, B claims rewards using the LpGauge.claimRewards() function.\ncontracts\\tokenomics\\LpGauge.sol#L52</p>\n<p>Inside LpGauge.userCheckPoint(), it’s designed not to calculate LpGauge.perUserShare for strategy, but it will pass this condition because B is not a strategy.\ncontracts\\tokenomics\\LpGauge.sol#L90</p>\n<p>Furthermore, when calculate rewards, LpGauge.poolStakedIntegral will be calculated larger than a normal user stakes same amount.\nIt’s because StakerVault._poolTotalStaked wasn’t updated when A transfers x amount to B so LpGauge.poolTotalStaked is less than correct value.\ncontracts\\tokenomics\\LpGauge.sol#L113-L117</p>\n<p>Finally B can get more rewards than he should and the reward system will pay more rewards than it’s designed.</p>\n</li>\n</ol>\n<h3 id=\"tools-used-3\" style=\"position:relative;\"><a href=\"#tools-used-3\" aria-label=\"tools used 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>Solidity Visual Developer of VSCode</p>\n<h3 id=\"recommended-mitigation-steps-13\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-13\" aria-label=\"recommended mitigation steps 13 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>I think there will be two methods to fix.</p>\n<p>Method 1 is to forbid a transfer between strategy and non-strategy so that strategy can’t move funds to non-strategy.</p>\n<p>Method 2 is to update StakerVault.strategiesTotalStaked and StakerVault._poolTotalStaked correctly so that strategy won’t claim more rewards than he should even though he claims rewards using non-strategy.</p>\n<p>Method 1.\nYou need to modify two functions. StakerVault.transfer(), StakerVault.transferFrom().</p>\n<ol>\n<li>\n<p>You need to add this require() at L112 for transfer().</p>\n<p>require(strategies[msg.sender] == strategies[account], Error.FAILED_TRANSFER);</p>\n</li>\n<li>\n<p>You need to add this require() at L144 for transferFrom().</p>\n<p>require(strategies[src] == strategies[dst], Error.FAILED_TRANSFER);</p>\n</li>\n</ol>\n<p>Method 2.\nI’ve explained about this method in my medium risk report “StakerVault.unstake(), StakerVault.unstakeFor() would revert with a uint underflow error of StakerVault.strategiesTotalStaked, StakerVault._poolTotalStaked”\nI will copy the same code for your convenience.</p>\n<p>You need to modify 3 functions. StakerVault.addStrategy(), StakerVault.transfer(), StakerVault.transferFrom().</p>\n<ol>\n<li>\n<p>You need to move staked amount from StakerVault._poolTotalStaked to StakerVault.strategiesTotalStaked every time when StakerVault.inflationManager approves a new strategy.</p>\n<p>You can modify addStrategy() at L98-L102 like this.</p>\n<p>function addStrategy(address strategy) external override returns (bool) {\nrequire(msg.sender == address(inflationManager), Error.UNAUTHORIZED<em>ACCESS);\nrequire(!strategies[strategy], Error.ADDRESS</em>ALREADY_SET);</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"27\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">strategies\\[strategy] = true;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">\\_poolTotalStaked -= balances\\[strategy];</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">strategiesTotalStaked += balances\\[strategy];</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">return true;</span></span></code></pre>\n<p>}</p>\n</li>\n<li>\n<p>You need to add below code at L126 of transfer() function.</p>\n<p>if(strategies[msg.sender] != strategies[account]) {\nif(strategies[msg.sender]) { // from strategy to non-strategy\n_poolTotalStaked += amount;\nstrategiesTotalStaked -= amount;\n}\nelse { // from non-strategy to strategy\n_poolTotalStaked -= amount;\nstrategiesTotalStaked += amount;\n}\n}</p>\n</li>\n<li>\n<p>You need to add below code at L170 of transferFrom() function.</p>\n<p>if(strategies[src] != strategies[dst]) {\nif(strategies[src]) { // from strategy to non-strategy\n_poolTotalStaked += amount;\nstrategiesTotalStaked -= amount;\n}\nelse { // from non-strategy to strategy\n_poolTotalStaked -= amount;\nstrategiesTotalStaked += amount;\n}\n}</p>\n</li>\n</ol>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/85#issuecomment-1148616366\">chase-manning (Backd) confirmed, but disagreed with severity and commented</a>:</strong></p>\n<blockquote>\n<p>We think this is a medium risk.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/85#issuecomment-1163371868\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>I believe there’s validity to the finding but at the same time I believe the impact is a loss of yield more so than an unfair gain of yield for a strategy.</p>\n<p>Specifically the POC is reliant on Depositing as a user, then transferring tokens to a strategy.</p>\n<p>I believe this will break the accounting per the POC shown (<code>strategiesTotalStaked</code> will be incorrect).</p>\n<p>Then the rewards will be claimable to the strategy as if it were a user, meaning that the extra checks to prevent strategies from gaining staking rewards will be sidestepped.</p>\n<p>I believe those tokens will be lost unless all strategies have a way to sweep non-protected tokens.</p>\n<p>Because the warden showed how to break accounting, I believe Medium Severity to be valid, that said I don’t believe the warden has shown any meaningful economic attack beside end-users losing their own tokens and the rewards attached to them.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-18-fees-from-delisted-pool-still-in-reward-handler-will-become-stuck-after-delisting\" style=\"position:relative;\"><a href=\"#m-18-fees-from-delisted-pool-still-in-reward-handler-will-become-stuck-after-delisting\" aria-label=\"m 18 fees from delisted pool still in reward handler will become stuck after delisting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/135\">[M-18] Fees from delisted pool still in reward handler will become stuck after delisting</a></h2>\n<p><em>Submitted by 0x52</em></p>\n<p>Unclaimed fees from pool will be stuck.</p>\n<h3 id=\"proof-of-concept-17\" style=\"position:relative;\"><a href=\"#proof-of-concept-17\" aria-label=\"proof of concept 17 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>When delisting a pool the pool’s reference is removed from address provider:</p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/Controller.sol#L63\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/Controller.sol#L63</a></p>\n<p>Burning fees calls a dynamic list of all pools which no longer contains the delisted pool:</p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L39\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L39</a></p>\n<p>Since the list no longer contains the pool those fees will not be processed and will remain stuck in the contract</p>\n<h3 id=\"recommended-mitigation-steps-14\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-14\" aria-label=\"recommended mitigation steps 14 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Call burnFees() before delisting a pool.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/135\">danhper (Backd) confirmed</a></strong> </p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/135#issuecomment-1163376879\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how, by removing a pool before calling <code>burnFees</code>, the removed pool will not receive the portion of fees that it should.</p>\n<p>Because this finding related to loss of yield, I believe Medium Severity to be appropriate.</p>\n</blockquote>\n<hr>\n<h1 id=\"low-risk-and-non-critical-issues\" style=\"position:relative;\"><a href=\"#low-risk-and-non-critical-issues\" aria-label=\"low risk and non critical issues permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Low Risk and Non-Critical Issues</h1>\n<p>For this contest, 42 reports were submitted by wardens detailing low risk and non-critical issues. The <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/109\">report highlighted below</a> by <strong>IllIllI</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/153\">SmartSek</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/174\">BowTiedWardens</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/74\">SecureZeroX</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/133\">berndartmueller</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/51\">cccz</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/45\">Ruhum</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/159\">cryptphi</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/134\">defsec</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/155\">dipp</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/34\">fatherOfBlocks</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/166\">unforgiven</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/12\">codexploder</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/172\">Chom</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/56\">bardamu</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/176\">masterchief</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/67\">Kumpa</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/94\">0x29A</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/142\">c3phas</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/173\">Funen</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/89\">hansfriese</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/49\">Picodes</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/72\">shenwilly</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/96\">WatchPug</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/25\">0xNazgul</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/18\">0x1f8b</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/91\">Sm4rty</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/123\">0xf15ers</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/60\">asutorufos</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/126\">delfin454000</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/171\">gzeon</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/121\">hake</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/42\">sach1r0</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/149\">simon135</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/58\">StyxRave</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/3\">oyc_109</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/62\">hyh</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/78\">catchup</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/106\">Kaiziron</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/105\">MiloTruck</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/146\">sashik_eth</a>, and <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/130\">Waze</a>.</em></p>\n<h2 id=\"low-risk-issues\" style=\"position:relative;\"><a href=\"#low-risk-issues\" aria-label=\"low risk issues permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Low Risk Issues</h2>\n<table>\n<thead>\n<tr>\n<th></th>\n<th align=\"left\">Issue</th>\n<th align=\"center\">Instances</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td align=\"left\"><code>migrate()</code> still does transfers when the transfer is to the same pool, and this can be done multiple times</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td>2</td>\n<td align=\"left\">Non-exploitable reentrancy</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td>3</td>\n<td align=\"left\">Users can DOS themselves by executing <code>prepareUnlock(0)</code> many times</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td>4</td>\n<td align=\"left\">Unused/empty <code>receive()</code>/<code>fallback()</code> function</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td>5</td>\n<td align=\"left\"><code>safeApprove()</code> is deprecated</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td>6</td>\n<td align=\"left\">Missing checks for <code>address(0x0)</code> when assigning values to <code>address</code> state variables</td>\n<td align=\"center\">8</td>\n</tr>\n<tr>\n<td>7</td>\n<td align=\"left\"><code>_prepareDeadline()</code>, <code>_setConfig()</code>, and <code>_executeDeadline()</code> should be <code>private</code></td>\n<td align=\"center\">1</td>\n</tr>\n</tbody>\n</table>\n<p>Total: 19 instances over 7 issues</p>\n<h2 id=\"l-01-migrate-still-does-transfers-when-the-transfer-is-to-the-same-pool-and-this-can-be-done-multiple-times\" style=\"position:relative;\"><a href=\"#l-01-migrate-still-does-transfers-when-the-transfer-is-to-the-same-pool-and-this-can-be-done-multiple-times\" aria-label=\"l 01 migrate still does transfers when the transfer is to the same pool and this can be done multiple times permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-01] <code>migrate()</code> still does transfers when the transfer is to the same pool, and this can be done multiple times</h2>\n<p>There’s no check that the old address isn’t the same as the new address, and there’s no check that the migration has already happened</p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"28\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">zaps</span><span class=\"mtk1\">/</span><span class=\"mtk12\">PoolMigrationZap</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">52</span><span class=\"mtk1\">       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">migrate</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oldPoolAddress_</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">53</span><span class=\"mtk1\">           </span><span class=\"mtk12\">ILiquidityPool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oldPool_</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">ILiquidityPool</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oldPoolAddress_</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">54</span><span class=\"mtk1\">           </span><span class=\"mtk12\">IERC20</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lpToken_</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oldPool_</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getLpToken</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">55</span><span class=\"mtk1\">           </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lpTokenAmount_</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">lpToken_</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">56</span><span class=\"mtk1\">           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">lpTokenAmount_</span><span class=\"mtk1\"> != </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;No LP Tokens&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">57</span><span class=\"mtk1\">           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oldPool_</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getWithdrawalFee</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">lpTokenAmount_</span><span class=\"mtk1\">) == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;withdrawal fee not 0&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">58</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">lpToken_</span><span class=\"mtk1\">.</span><span class=\"mtk11\">safeTransferFrom</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">), </span><span class=\"mtk12\">lpTokenAmount_</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L52-L58\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L52-L58</a></p>\n<h2 id=\"l-02-non-exploitable-reentrancy\" style=\"position:relative;\"><a href=\"#l-02-non-exploitable-reentrancy\" aria-label=\"l 02 non exploitable reentrancy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-02] Non-exploitable reentrancy</h2>\n<p>There is no reentrancy guard in this function, and if used with a token that has transfer callbacks, such as an ERC777, the caller can reenter before <code>balances</code> is updated. I don’t currently see a way to exploit this</p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"29\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AmmGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">130</span><span class=\"mtk1\">          </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oldBal</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ammToken</span><span class=\"mtk1\">).</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">131</span><span class=\"mtk1\">          </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ammToken</span><span class=\"mtk1\">).</span><span class=\"mtk11\">safeTransfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">dst</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">132</span><span class=\"mtk1\">          </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newBal</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ammToken</span><span class=\"mtk1\">).</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">133</span><span class=\"mtk1\">          </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">unstaked</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oldBal</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">newBal</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">134</span><span class=\"mtk1\">          </span><span class=\"mtk12\">balances</span><span class=\"mtk1\">[</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">] -= </span><span class=\"mtk12\">unstaked</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">135</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">totalStaked</span><span class=\"mtk1\"> -= </span><span class=\"mtk12\">unstaked</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L130-L135\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L130-L135</a></p>\n<h2 id=\"l-03-users-can-dos-themselves-by-executing-prepareunlock0-many-times\" style=\"position:relative;\"><a href=\"#l-03-users-can-dos-themselves-by-executing-prepareunlock0-many-times\" aria-label=\"l 03 users can dos themselves by executing prepareunlock0 many times permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-03] Users can DOS themselves by executing <code>prepareUnlock(0)</code> many times</h2>\n<p>There’s no check on the amount, and every call add another entry to an array. When the user finally calls <code>executeUnlocks()</code> they’ll run out of gas</p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"30\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BkdLocker</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">118</span><span class=\"mtk1\">      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">prepareUnlock</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">119</span><span class=\"mtk1\">          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">120</span><span class=\"mtk1\">              </span><span class=\"mtk12\">totalStashed</span><span class=\"mtk1\">[</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">] + </span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk12\">balances</span><span class=\"mtk1\">[</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">121</span><span class=\"mtk1\">              </span><span class=\"mtk8\">&quot;Amount exceeds locked balance&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">122</span><span class=\"mtk1\">:         );</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L118-L122\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L118-L122</a></p>\n<h2 id=\"l-04-unusedempty-receivefallback-function\" style=\"position:relative;\"><a href=\"#l-04-unusedempty-receivefallback-function\" aria-label=\"l 04 unusedempty receivefallback function permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-04] Unused/empty <code>receive()</code>/<code>fallback()</code> function</h2>\n<p>If the intention is for the Ether to be used, the function should call another function, otherwise it should revert (e.g. <code>require(msg.sender == address(weth))</code>)</p>\n<p><em>There are 3 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"31\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">zaps</span><span class=\"mtk1\">/</span><span class=\"mtk12\">PoolMigrationZap</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">31</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">receive</span><span class=\"mtk1\">() </span><span class=\"mtk12\">external</span><span class=\"mtk1\"> </span><span class=\"mtk12\">payable</span><span class=\"mtk1\"> {}</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L31\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L31</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"32\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">RewardHandler</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">30</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">receive</span><span class=\"mtk1\">() </span><span class=\"mtk12\">external</span><span class=\"mtk1\"> </span><span class=\"mtk12\">payable</span><span class=\"mtk1\"> {}</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L30\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L30</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"33\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">FeeBurner</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">35</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">receive</span><span class=\"mtk1\">() </span><span class=\"mtk12\">external</span><span class=\"mtk1\"> </span><span class=\"mtk12\">payable</span><span class=\"mtk1\"> {} </span><span class=\"mtk3\">// Recieve function for withdrawing from Backd ETH Pool</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L35\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L35</a></p>\n<h2 id=\"l-05-safeapprove-is-deprecated\" style=\"position:relative;\"><a href=\"#l-05-safeapprove-is-deprecated\" aria-label=\"l 05 safeapprove is deprecated permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-05] <code>safeApprove()</code> is deprecated</h2>\n<p><a href=\"https://github.com/OpenZeppelin/openzeppelin-contracts/blob/bfff03c0d2a59bcd8e2ead1da9aed9edf0080d05/contracts/token/ERC20/utils/SafeERC20.sol#L38-L45\">Deprecated</a> in favor of <code>safeIncreaseAllowance()</code> and <code>safeDecreaseAllowance()</code>. If only setting the initial allowance to the value that means infinite, <code>safeIncreaseAllowance()</code> can be used instead</p>\n<p><em>There are 4 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"34\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">zaps</span><span class=\"mtk1\">/</span><span class=\"mtk12\">PoolMigrationZap</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">27</span><span class=\"mtk1\">:               </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">underlying_</span><span class=\"mtk1\">).</span><span class=\"mtk11\">safeApprove</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">newPool_</span><span class=\"mtk1\">), </span><span class=\"mtk11\">type</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">).</span><span class=\"mtk12\">max</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L27\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L27</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"35\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">RewardHandler</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">52</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">targetLpToken</span><span class=\"mtk1\">).</span><span class=\"mtk11\">safeApprove</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bkdLocker</span><span class=\"mtk1\">), </span><span class=\"mtk12\">burnedAmount</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L52\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L52</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"36\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">RewardHandler</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">64</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">).</span><span class=\"mtk11\">safeApprove</span><span class=\"mtk1\">(</span><span class=\"mtk12\">spender</span><span class=\"mtk1\">, </span><span class=\"mtk11\">type</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">).</span><span class=\"mtk12\">max</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L64\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L64</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"37\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">FeeBurner</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">4</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">118</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token_</span><span class=\"mtk1\">).</span><span class=\"mtk11\">safeApprove</span><span class=\"mtk1\">(</span><span class=\"mtk12\">spender_</span><span class=\"mtk1\">, </span><span class=\"mtk11\">type</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">).</span><span class=\"mtk12\">max</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L118\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L118</a></p>\n<h2 id=\"l-06-missing-checks-for-address0x0-when-assigning-values-to-address-state-variables\" style=\"position:relative;\"><a href=\"#l-06-missing-checks-for-address0x0-when-assigning-values-to-address-state-variables\" aria-label=\"l 06 missing checks for address0x0 when assigning values to address state variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-06] Missing checks for <code>address(0x0)</code> when assigning values to <code>address</code> state variables</h2>\n<p><em>There are 8 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"38\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">StakerVault</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">72</span><span class=\"mtk1\">:           </span><span class=\"mtk12\">token</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_token</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L72\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L72</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"39\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BkdLocker</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">49</span><span class=\"mtk1\">:           </span><span class=\"mtk12\">rewardToken</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_rewardToken</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">74</span><span class=\"mtk1\">:           </span><span class=\"mtk12\">rewardToken</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">newRewardToken</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L49\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L49</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"40\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrowRevocable</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">43</span><span class=\"mtk1\">:           </span><span class=\"mtk12\">treasury</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">treasury_</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrowRevocable.sol#L43\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrowRevocable.sol#L43</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"41\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AmmGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">39</span><span class=\"mtk1\">:           </span><span class=\"mtk12\">ammToken</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_ammToken</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L39\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L39</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"42\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrow</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">65</span><span class=\"mtk1\">:           </span><span class=\"mtk12\">fundAdmin</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">fundAdmin_</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L65\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L65</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"43\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">KeeperGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">48</span><span class=\"mtk1\">:           </span><span class=\"mtk12\">pool</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_pool</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L48\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L48</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"44\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BkdToken</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">21</span><span class=\"mtk1\">:           </span><span class=\"mtk12\">minter</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_minter</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/BkdToken.sol#L21\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/BkdToken.sol#L21</a></p>\n<h2 id=\"l-07-_preparedeadline-_setconfig-and-_executedeadline-should-be-private\" style=\"position:relative;\"><a href=\"#l-07-_preparedeadline-_setconfig-and-_executedeadline-should-be-private\" aria-label=\"l 07 _preparedeadline _setconfig and _executedeadline should be private permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-07] <code>_prepareDeadline()</code>, <code>_setConfig()</code>, and <code>_executeDeadline()</code> should be <code>private</code></h2>\n<p>I flagged this in the last Backd contest, but it doesn’t seem to have been addressed, so bringing it up again: These functions have the ability to bypass the timelocks of every setting. No contract besides the <code>Preparable</code> contract itself should need to call these functions, and having them available will lead to exploits. The contracts that currently call <code>_setConfig()</code> in their constructors should be given a new function <code>_initConfig()</code> for this purpose. The <code>Vault</code> <a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/Vault.sol#L222\">calls</a> some of these functions as well, and should be changed to manually inspect the deadline rather than mucking with the internals, which is error-prone. The mappings should also be made <code>private</code>, and there should be public getters to read their values</p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"45\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">utils</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Preparable</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">115</span><span class=\"mtk1\">      </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">116       * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Execute uint256 config update (with time delay enforced).</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">117       * </span><span class=\"mtk4\">@dev</span><span class=\"mtk3\"> Needs to be called after the update was prepared. Fails if called before time delay is met.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">118       * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> New value.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">119       */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">120</span><span class=\"mtk1\">      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_executeUInt256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">121</span><span class=\"mtk1\">          </span><span class=\"mtk11\">_executeDeadline</span><span class=\"mtk1\">(</span><span class=\"mtk12\">key</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">122</span><span class=\"mtk1\">          </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newValue</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">pendingUInts256</span><span class=\"mtk1\">[</span><span class=\"mtk12\">key</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">123</span><span class=\"mtk1\">          </span><span class=\"mtk11\">_setConfig</span><span class=\"mtk1\">(</span><span class=\"mtk12\">key</span><span class=\"mtk1\">, </span><span class=\"mtk12\">newValue</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">124</span><span class=\"mtk1\">          </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newValue</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">125</span><span class=\"mtk1\">      }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">126</span><span class=\"mtk1\">  </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">127</span><span class=\"mtk1\">      </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">128       * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Execute address config update (with time delay enforced).</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">129       * </span><span class=\"mtk4\">@dev</span><span class=\"mtk3\"> Needs to be called after the update was prepared. Fails if called before time delay is met.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">130       * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> New value.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">131       */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">132</span><span class=\"mtk1\">      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_executeAddress</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">address</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">133</span><span class=\"mtk1\">          </span><span class=\"mtk11\">_executeDeadline</span><span class=\"mtk1\">(</span><span class=\"mtk12\">key</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">134</span><span class=\"mtk1\">          </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newValue</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">pendingAddresses</span><span class=\"mtk1\">[</span><span class=\"mtk12\">key</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">135</span><span class=\"mtk1\">          </span><span class=\"mtk11\">_setConfig</span><span class=\"mtk1\">(</span><span class=\"mtk12\">key</span><span class=\"mtk1\">, </span><span class=\"mtk12\">newValue</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">136</span><span class=\"mtk1\">          </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newValue</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">137</span><span class=\"mtk1\">:     }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/Preparable.sol#L115-L137\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/Preparable.sol#L115-L137</a></p>\n<h2 id=\"non-critical-issues\" style=\"position:relative;\"><a href=\"#non-critical-issues\" aria-label=\"non critical issues permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Non-Critical Issues</h2>\n<table>\n<thead>\n<tr>\n<th></th>\n<th align=\"left\">Issue</th>\n<th align=\"center\">Instances</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td align=\"left\">Unneeded import</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td>2</td>\n<td align=\"left\">Return values of <code>approve()</code> not checked</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td>3</td>\n<td align=\"left\">Large multiples of ten should use scientific notation (e.g. <code>1e6</code>) rather than decimal literals (e.g. <code>1000000</code>), for readability</td>\n<td align=\"center\">2</td>\n</tr>\n<tr>\n<td>4</td>\n<td align=\"left\">Missing event for critical parameter change</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td>5</td>\n<td align=\"left\">Use a more recent version of solidity</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td>6</td>\n<td align=\"left\">Use a more recent version of solidity</td>\n<td align=\"center\">16</td>\n</tr>\n<tr>\n<td>7</td>\n<td align=\"left\">Constant redefined elsewhere</td>\n<td align=\"center\">10</td>\n</tr>\n<tr>\n<td>8</td>\n<td align=\"left\">Inconsistent spacing in comments</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td>9</td>\n<td align=\"left\">File is missing NatSpec</td>\n<td align=\"center\">5</td>\n</tr>\n<tr>\n<td>10</td>\n<td align=\"left\">NatSpec is incomplete</td>\n<td align=\"center\">17</td>\n</tr>\n<tr>\n<td>11</td>\n<td align=\"left\">Event is missing <code>indexed</code> fields</td>\n<td align=\"center\">10</td>\n</tr>\n<tr>\n<td>12</td>\n<td align=\"left\">Not using the named return variables anywhere in the function is confusing</td>\n<td align=\"center\">2</td>\n</tr>\n<tr>\n<td>9</td>\n<td align=\"left\">Typos</td>\n<td align=\"center\">6</td>\n</tr>\n</tbody>\n</table>\n<p>Total: 80 instances over 13 issues</p>\n<h2 id=\"n-01-unneeded-import\" style=\"position:relative;\"><a href=\"#n-01-unneeded-import\" aria-label=\"n 01 unneeded import permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-01] Unneeded import</h2>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"46\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BkdToken</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">8</span><span class=\"mtk1\">:   </span><span class=\"mtk15\">import</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;../../libraries/ScaledMath.sol&quot;</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/BkdToken.sol#L8\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/BkdToken.sol#L8</a></p>\n<h2 id=\"n-02-return-values-of-approve-not-checked\" style=\"position:relative;\"><a href=\"#n-02-return-values-of-approve-not-checked\" aria-label=\"n 02 return values of approve not checked permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-02] Return values of <code>approve()</code> not checked</h2>\n<p>Not all <code>IERC20</code> implementations <code>revert()</code> when there’s a failure in <code>approve()</code>. The function signature has a <code>boolean</code> return value and they indicate errors that way instead. By not checking the return value, operations that should have marked as failed, may potentially go through without actually approving anything</p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"47\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrow</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">25</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">rewardToken_</span><span class=\"mtk1\">).</span><span class=\"mtk11\">approve</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk11\">type</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">).</span><span class=\"mtk12\">max</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L25\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L25</a></p>\n<h2 id=\"n-03-large-multiples-of-ten-should-use-scientific-notation-eg-1e6-rather-than-decimal-literals-eg-1000000-for-readability\" style=\"position:relative;\"><a href=\"#n-03-large-multiples-of-ten-should-use-scientific-notation-eg-1e6-rather-than-decimal-literals-eg-1000000-for-readability\" aria-label=\"n 03 large multiples of ten should use scientific notation eg 1e6 rather than decimal literals eg 1000000 for readability permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-03] Large multiples of ten should use scientific notation (e.g. <code>1e6</code>) rather than decimal literals (e.g. <code>1000000</code>), for readability</h2>\n<p><em>There are 2 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"48\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">utils</span><span class=\"mtk1\">/</span><span class=\"mtk12\">CvxMintAmount</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">10</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">private</span><span class=\"mtk1\"> </span><span class=\"mtk12\">constant</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_CLIFF_SIZE</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">100000</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">1e18</span><span class=\"mtk1\">; </span><span class=\"mtk3\">//new cliff every 100,000 tokens</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/CvxMintAmount.sol#L10\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/CvxMintAmount.sol#L10</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"49\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">utils</span><span class=\"mtk1\">/</span><span class=\"mtk12\">CvxMintAmount</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">12</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">private</span><span class=\"mtk1\"> </span><span class=\"mtk12\">constant</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_MAX_SUPPLY</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">100000000</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">1e18</span><span class=\"mtk1\">; </span><span class=\"mtk3\">//100 mil max supply</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/CvxMintAmount.sol#L12\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/CvxMintAmount.sol#L12</a></p>\n<h2 id=\"n-04-missing-event-for-critical-parameter-change\" style=\"position:relative;\"><a href=\"#n-04-missing-event-for-critical-parameter-change\" aria-label=\"n 04 missing event for critical parameter change permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-04] Missing event for critical parameter change</h2>\n<p><em>There are 3 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"50\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">InflationManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">58</span><span class=\"mtk1\">        </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setMinter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_minter</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyGovernance</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">59</span><span class=\"mtk1\">            </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">minter</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">), </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">ADDRESS_ALREADY_SET</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">60</span><span class=\"mtk1\">            </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_minter</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">), </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">INVALID_MINTER</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">61</span><span class=\"mtk1\">            </span><span class=\"mtk12\">minter</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_minter</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">62</span><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">63</span><span class=\"mtk1\">:       }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L58-L63\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L58-L63</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"51\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrow</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">68</span><span class=\"mtk1\">        </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setAdmin</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_admin</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">69</span><span class=\"mtk1\">            </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_admin</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">), </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">ZERO_ADDRESS_NOT_ALLOWED</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">70</span><span class=\"mtk1\">            </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">admin</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">UNAUTHORIZED_ACCESS</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">71</span><span class=\"mtk1\">            </span><span class=\"mtk12\">admin</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_admin</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">72</span><span class=\"mtk1\">:       }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L68-L72\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L68-L72</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"52\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrow</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">74</span><span class=\"mtk1\">        </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setFundAdmin</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_fundadmin</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">75</span><span class=\"mtk1\">            </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_fundadmin</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">), </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">ZERO_ADDRESS_NOT_ALLOWED</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">76</span><span class=\"mtk1\">            </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">admin</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">UNAUTHORIZED_ACCESS</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">77</span><span class=\"mtk1\">            </span><span class=\"mtk12\">fundAdmin</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_fundadmin</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">78</span><span class=\"mtk1\">:       }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L74-L78\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L74-L78</a></p>\n<h2 id=\"n-05-use-a-more-recent-version-of-solidity\" style=\"position:relative;\"><a href=\"#n-05-use-a-more-recent-version-of-solidity\" aria-label=\"n 05 use a more recent version of solidity permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-05] Use a more recent version of solidity</h2>\n<p>Use a solidity version of at least 0.8.12 to get <code>string.concat()</code> to be used instead of <code>abi.encodePacked(&#x3C;str>,&#x3C;str>)</code></p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"53\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">InflationManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">2</span><span class=\"mtk1\">:    </span><span class=\"mtk12\">pragma</span><span class=\"mtk1\"> </span><span class=\"mtk12\">solidity</span><span class=\"mtk1\"> </span><span class=\"mtk7\">0.8</span><span class=\"mtk1\">.</span><span class=\"mtk7\">10</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L2\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L2</a></p>\n<h2 id=\"n-06-use-a-more-recent-version-of-solidity\" style=\"position:relative;\"><a href=\"#n-06-use-a-more-recent-version-of-solidity\" aria-label=\"n 06 use a more recent version of solidity permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-06] Use a more recent version of solidity</h2>\n<p>Use a solidity version of at least 0.8.13 to get the ability to use <code>using for</code> with a list of free functions</p>\n<p><em>There are 16 instances of this issue:</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/109\">See original submission</a> for details.</p>\n<h2 id=\"n-07-constant-redefined-elsewhere\" style=\"position:relative;\"><a href=\"#n-07-constant-redefined-elsewhere\" aria-label=\"n 07 constant redefined elsewhere permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-07] Constant redefined elsewhere</h2>\n<p>Consider defining in only one contract so that values cannot become out of sync when only one location is updated. A <a href=\"https://medium.com/coinmonks/gas-cost-of-solidity-library-functions-dbe0cedd4678\">cheap way</a> to store constants in a single location is to create an <code>internal constant</code> in a <code>library</code>. If the variable is a local cache of another contract’s value, consider making the cache variable internal or private, which will require external users to query the contract with the source of truth, so that callers don’t get out of sync.</p>\n<p><em>There are 10 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"54\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Controller</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit seen in protocol/contracts/StakerVault.sol </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">21</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">IAddressProvider</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">override</span><span class=\"mtk1\"> </span><span class=\"mtk12\">addressProvider</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/Controller.sol#L21\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/Controller.sol#L21</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"55\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">RewardHandler</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit seen in protocol/contracts/StakerVault.sol </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">20</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">IController</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">controller</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit seen in protocol/contracts/Controller.sol </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">21</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">IAddressProvider</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">addressProvider</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L20\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L20</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"56\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Minter</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit seen in protocol/contracts/RewardHandler.sol </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">55</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">IController</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">controller</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L55\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L55</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"57\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">InflationManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit seen in protocol/contracts/RewardHandler.sol </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">24</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">IAddressProvider</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">addressProvider</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L24\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L24</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"58\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AmmGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit seen in protocol/contracts/tokenomics/Minter.sol </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">20</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">IController</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">controller</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L20\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L20</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"59\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">KeeperGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit seen in protocol/contracts/tokenomics/AmmGauge.sol </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">30</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">IController</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">controller</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L30\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L30</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"60\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">LpGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit seen in protocol/contracts/tokenomics/KeeperGauge.sol </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">19</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">IController</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">controller</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit seen in protocol/contracts/StakerVault.sol </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">21</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">IInflationManager</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">inflationManager</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/LpGauge.sol#L19\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/LpGauge.sol#L19</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"61\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">access</span><span class=\"mtk1\">/</span><span class=\"mtk12\">RoleManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit seen in protocol/contracts/tokenomics/InflationManager.sol </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">25</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">IAddressProvider</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">addressProvider</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/RoleManager.sol#L25\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/RoleManager.sol#L25</a></p>\n<h2 id=\"n-08-inconsistent-spacing-in-comments\" style=\"position:relative;\"><a href=\"#n-08-inconsistent-spacing-in-comments\" aria-label=\"n 08 inconsistent spacing in comments permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-08] Inconsistent spacing in comments</h2>\n<p>Some lines use <code>// x</code> and some use <code>//x</code>. The instances below point out the usages that don’t follow the majority, within each file</p>\n<p><em>There are 3 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"62\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">utils</span><span class=\"mtk1\">/</span><span class=\"mtk12\">CvxMintAmount</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">11</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">private</span><span class=\"mtk1\"> </span><span class=\"mtk12\">constant</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_CLIFF_COUNT</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">1000</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// 1,000 cliffs</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/CvxMintAmount.sol#L11\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/CvxMintAmount.sol#L11</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"63\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">utils</span><span class=\"mtk1\">/</span><span class=\"mtk12\">CvxMintAmount</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">14</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0x4e3FBD56CD56c3e72c1403e103b45Db9da5B9D2B</span><span class=\"mtk1\">)); </span><span class=\"mtk3\">// CVX Token</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/CvxMintAmount.sol#L14\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/CvxMintAmount.sol#L14</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"64\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">InflationManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">532</span><span class=\"mtk1\">:      </span><span class=\"mtk3\">//TOOD: See if this is still needed somewhere</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L532\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L532</a></p>\n<h2 id=\"n-09-file-is-missing-natspec\" style=\"position:relative;\"><a href=\"#n-09-file-is-missing-natspec\" aria-label=\"n 09 file is missing natspec permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-09] File is missing NatSpec</h2>\n<p><em>There are 5 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"65\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">utils</span><span class=\"mtk1\">/</span><span class=\"mtk12\">CvxMintAmount</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/CvxMintAmount.sol\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/CvxMintAmount.sol</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"66\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrowRevocable</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrowRevocable.sol\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrowRevocable.sol</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"67\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrow</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"68\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">access</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Authorization</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/Authorization.sol\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/Authorization.sol</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"69\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">access</span><span class=\"mtk1\">/</span><span class=\"mtk12\">RoleManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/RoleManager.sol\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/RoleManager.sol</a></p>\n<h2 id=\"n-10-natspec-is-incomplete\" style=\"position:relative;\"><a href=\"#n-10-natspec-is-incomplete\" aria-label=\"n 10 natspec is incomplete permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-10] NatSpec is incomplete</h2>\n<p><em>There are 17 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"70\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">StakerVault</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Missing: &#39;@param strategy&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">93</span><span class=\"mtk1\">        </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">94         * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Registers an address as a strategy to be excluded from token accumulation.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">95         * </span><span class=\"mtk4\">@dev</span><span class=\"mtk3\"> This should be used if a strategy deposits into a stakerVault and should not get gov. tokens.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">96         * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> `true` if success.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">97         */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">98</span><span class=\"mtk1\">:       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">addStrategy</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">strategy</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L93-L98\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L93-L98</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"71\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Controller</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Missing: &#39;@param payer&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">117</span><span class=\"mtk1\">       </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">118        * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> the total amount of ETH require by `payer` to cover the fees for</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">119        * positions registered in all actions</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">120        */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">121</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">getTotalEthRequiredForGas</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">payer</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/Controller.sol#L117-L121\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/Controller.sol#L117-L121</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"72\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">utils</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Preparable</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Missing: &#39;@param key&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">33</span><span class=\"mtk1\">        </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">34         * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Prepares an uint256 that should be committed to the contract</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">35         * after `_MIN_DELAY` elapsed</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">36         * </span><span class=\"mtk4\">@param</span><span class=\"mtk3\"> </span><span class=\"mtk12\">value</span><span class=\"mtk3\"> The value to prepare</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">37         * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> `true` if success.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">38         */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">39</span><span class=\"mtk1\">        </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_prepare</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">40            </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">41            </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">value</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">42            </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">delay</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">43:       ) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Missing: &#39;@param delay&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">33</span><span class=\"mtk1\">        </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">34         * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Prepares an uint256 that should be committed to the contract</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">35         * after `_MIN_DELAY` elapsed</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">36         * </span><span class=\"mtk4\">@param</span><span class=\"mtk3\"> </span><span class=\"mtk12\">value</span><span class=\"mtk3\"> The value to prepare</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">37         * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> `true` if success.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">38         */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">39</span><span class=\"mtk1\">        </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_prepare</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">40            </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">41            </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">value</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">42            </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">delay</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">43:       ) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Missing: &#39;@param key&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">57</span><span class=\"mtk1\">        </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">58         * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Prepares an address that should be committed to the contract</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">59         * after `_MIN_DELAY` elapsed</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">60         * </span><span class=\"mtk4\">@param</span><span class=\"mtk3\"> </span><span class=\"mtk12\">value</span><span class=\"mtk3\"> The value to prepare</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">61         * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> `true` if success.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">62         */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">63</span><span class=\"mtk1\">        </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_prepare</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">64            </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">65            </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">value</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">66            </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">delay</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">67:       ) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Missing: &#39;@param delay&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">57</span><span class=\"mtk1\">        </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">58         * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Prepares an address that should be committed to the contract</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">59         * after `_MIN_DELAY` elapsed</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">60         * </span><span class=\"mtk4\">@param</span><span class=\"mtk3\"> </span><span class=\"mtk12\">value</span><span class=\"mtk3\"> The value to prepare</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">61         * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> `true` if success.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">62         */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">63</span><span class=\"mtk1\">        </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_prepare</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">64            </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">65            </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">value</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">66            </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">delay</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">67:       ) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Missing: &#39;@param key&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">81</span><span class=\"mtk1\">        </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">82         * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Reset a uint256 key</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">83         * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> `true` if success.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">84         */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">85</span><span class=\"mtk1\">:       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_resetUInt256Config</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Missing: &#39;@param key&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">93</span><span class=\"mtk1\">        </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">94         * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Reset an address key</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">95         * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> `true` if success.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">96         */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">97</span><span class=\"mtk1\">:       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_resetAddressConfig</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Missing: &#39;@param key&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">115</span><span class=\"mtk1\">       </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">116        * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Execute uint256 config update (with time delay enforced).</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">117        * </span><span class=\"mtk4\">@dev</span><span class=\"mtk3\"> Needs to be called after the update was prepared. Fails if called before time delay is met.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">118        * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> New value.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">119        */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">120</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_executeUInt256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Missing: &#39;@param key&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">127</span><span class=\"mtk1\">       </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">128        * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Execute address config update (with time delay enforced).</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">129        * </span><span class=\"mtk4\">@dev</span><span class=\"mtk3\"> Needs to be called after the update was prepared. Fails if called before time delay is met.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">130        * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> New value.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">131        */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">132</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_executeAddress</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">address</span><span class=\"mtk1\">) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/Preparable.sol#L33-L43\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/Preparable.sol#L33-L43</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"73\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AddressProvider</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Missing: &#39;@return&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">79</span><span class=\"mtk1\">         * @</span><span class=\"mtk12\">param</span><span class=\"mtk1\"> </span><span class=\"mtk12\">action</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">of</span><span class=\"mtk1\"> </span><span class=\"mtk12\">action</span><span class=\"mtk1\"> </span><span class=\"mtk12\">to</span><span class=\"mtk1\"> </span><span class=\"mtk12\">add</span><span class=\"mtk1\">.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">80</span><span class=\"mtk1\">         */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">81</span><span class=\"mtk1\">:       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">addAction</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">action</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyGovernance</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Missing: &#39;@param freezable&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">207</span><span class=\"mtk1\">       </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">208        * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Initializes an address</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">209        * </span><span class=\"mtk4\">@param</span><span class=\"mtk3\"> </span><span class=\"mtk12\">key</span><span class=\"mtk3\"> Key to initialize</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">210        * </span><span class=\"mtk4\">@param</span><span class=\"mtk3\"> </span><span class=\"mtk12\">initialAddress</span><span class=\"mtk3\"> Address for `key`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">211        */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">212</span><span class=\"mtk1\">       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">initializeAddress</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">213           </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">214           </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initialAddress</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">215           </span><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">freezable</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">216:      ) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyGovernance</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Missing: &#39;@param key&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">264</span><span class=\"mtk1\">       </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">265        * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Execute update of `key`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">266        * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> New address.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">267        */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">268</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">executeAddress</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">address</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Missing: &#39;@param key&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">274</span><span class=\"mtk1\">       </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">275        * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Reset `key`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">276        * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> true if it was reset</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">277        */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">278</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">resetAddress</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyGovernance</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Missing: &#39;@param token&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">396</span><span class=\"mtk1\">       </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">397        * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Tries to get the staker vault for a given token but does not throw if it does not exist</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">398        * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> A boolean set to true if the vault exists and the vault address.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">399        */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">400</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">tryGetStakerVault</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">token</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\">) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/AddressProvider.sol#L79-L81\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/AddressProvider.sol#L79-L81</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"74\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">InflationManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Missing: &#39;@param lpToken&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">236</span><span class=\"mtk1\">       </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">237        * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Execute update of lp pool weight (with time delay enforced).</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">238        * </span><span class=\"mtk4\">@dev</span><span class=\"mtk3\"> Needs to be called after the update was prepared. Fails if called before time delay is met.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">239        * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> New lp pool weight.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">240        */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">241</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">executeLpPoolWeight</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lpToken</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Missing: &#39;@param token&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">321</span><span class=\"mtk1\">       </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">322        * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Execute update of lp pool weight (with time delay enforced).</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">323        * </span><span class=\"mtk4\">@dev</span><span class=\"mtk3\"> Needs to be called after the update was prepared. Fails if called before time delay is met.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">324        * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> New lp pool weight.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">325        */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">326</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">executeAmmTokenWeight</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">token</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L236-L241\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L236-L241</a></p>\n<h2 id=\"n-11-event-is-missing-indexed-fields\" style=\"position:relative;\"><a href=\"#n-11-event-is-missing-indexed-fields\" aria-label=\"n 11 event is missing indexed fields permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-11] Event is missing <code>indexed</code> fields</h2>\n<p>Each <code>event</code> should use three <code>indexed</code> fields if there are three or more fields</p>\n<p><em>There are 10 instances of this issue:</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/109\">See original submission</a> for details.</p>\n<h2 id=\"n-12-not-using-the-named-return-variables-anywhere-in-the-function-is-confusing\" style=\"position:relative;\"><a href=\"#n-12-not-using-the-named-return-variables-anywhere-in-the-function-is-confusing\" aria-label=\"n 12 not using the named return variables anywhere in the function is confusing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-12] Not using the named return variables anywhere in the function is confusing</h2>\n<p>Consider changing the variable to be an unnamed one</p>\n<p><em>There are 2 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"75\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">FeeBurner</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit received</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">43</span><span class=\"mtk1\">        </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">burnToTarget</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tokens_</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">targetLpToken_</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">44            </span><span class=\"mtk11\">public</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">45            </span><span class=\"mtk11\">payable</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">46            </span><span class=\"mtk11\">override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">47:           </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">received</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L43-L47\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L43-L47</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"76\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">FeeBurner</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit received</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">96</span><span class=\"mtk1\">        </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_depositInPool</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">underlying_</span><span class=\"mtk1\">, </span><span class=\"mtk12\">ILiquidityPool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">pool_</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">97            </span><span class=\"mtk11\">internal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">98:           </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">received</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L96-L98\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L96-L98</a></p>\n<h2 id=\"n-13-typos\" style=\"position:relative;\"><a href=\"#n-13-typos\" aria-label=\"n 13 typos permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-13] Typos</h2>\n<p><em>There are 6 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"77\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BkdLocker</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit invlude</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">173</span><span class=\"mtk1\">:       * @</span><span class=\"mtk12\">dev</span><span class=\"mtk1\"> </span><span class=\"mtk12\">This</span><span class=\"mtk1\"> </span><span class=\"mtk12\">does</span><span class=\"mtk1\"> </span><span class=\"mtk12\">not</span><span class=\"mtk1\"> </span><span class=\"mtk12\">invlude</span><span class=\"mtk1\"> </span><span class=\"mtk12\">the</span><span class=\"mtk1\"> </span><span class=\"mtk12\">gov</span><span class=\"mtk1\">. </span><span class=\"mtk12\">tokens</span><span class=\"mtk1\"> </span><span class=\"mtk12\">queued</span><span class=\"mtk1\"> </span><span class=\"mtk12\">for</span><span class=\"mtk1\"> </span><span class=\"mtk12\">withdrawal</span><span class=\"mtk1\">.</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L173\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L173</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"78\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">InflationManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit TOOD</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">532</span><span class=\"mtk1\">:      </span><span class=\"mtk3\">//TOOD: See if this is still needed somewhere</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L532\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L532</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"79\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">FeeBurner</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Emmited</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">29</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">event</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Burned</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">targetLpToken</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amountBurned</span><span class=\"mtk1\">); </span><span class=\"mtk3\">// Emmited after a successfull burn to target lp token</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit successfull</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">29</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">event</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Burned</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">targetLpToken</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amountBurned</span><span class=\"mtk1\">); </span><span class=\"mtk3\">// Emmited after a successfull burn to target lp token</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Recieve</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">35</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">receive</span><span class=\"mtk1\">() </span><span class=\"mtk12\">external</span><span class=\"mtk1\"> </span><span class=\"mtk12\">payable</span><span class=\"mtk1\"> {} </span><span class=\"mtk3\">// Recieve function for withdrawing from Backd ETH Pool</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Transfering</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">84</span><span class=\"mtk1\">:           </span><span class=\"mtk3\">// Transfering LP tokens back to sender</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L29\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L29</a></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/109#issuecomment-1159843872\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p><strong>1. migrate() still does transfers when the transfer is to the same pool, and this can be done multiple times</strong><br>\nInteresting finding, also wonder if this could cause issues with fees, but in lack of POC, I think this is a valid Low Severity finding</p>\n</blockquote>\n<blockquote>\n<p><strong>2. Non-exploitable reentrancy</strong><br>\nAgree with severity and finding, would rephrase to “code doesn’t conform to CEI”</p>\n</blockquote>\n<blockquote>\n<p><strong>3. Users can DOS themselves by executing prepareUnlock(0) many times</strong><br>\nThis should be downgraded to non-critical because it probably requires tens of thousands of calls, that said the finding is valid</p>\n</blockquote>\n<blockquote>\n<p><strong>4. Unused/empty receive()/fallback() function</strong><br>\nI fail to see the need for the extra checks given that the contracts are meant to handle ETH</p>\n</blockquote>\n<blockquote>\n<p><strong>5. safeApprove() is deprecated</strong><br>\nTechnically valid, however the code is using <code>safeApprove</code> correctly, only once, from zero to X</p>\n</blockquote>\n<blockquote>\n<p><strong>6. Missing checks for address(0x0) when assigning values to address state variables</strong><br>\nValid</p>\n</blockquote>\n<blockquote>\n<p><strong>7. _prepareDeadline(), _setConfig(), and _executeDeadline() should be private</strong><br>\nDisagree with the alarmist side, but there’s validity to this finding.</p>\n</blockquote>\n<blockquote>\n<p><strong>Non-critical Issues</strong><br>\nAgree with the findings although it feels like a bot wrote this.</p>\n</blockquote>\n<blockquote>\n<p>Overall a really exhaustive report, 3 findings are interesting the rest doesn’t stand out, however the thoroughness of the report does.</p>\n</blockquote>\n<hr>\n<h1 id=\"gas-optimizations\" style=\"position:relative;\"><a href=\"#gas-optimizations\" aria-label=\"gas optimizations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gas Optimizations</h1>\n<p>For this contest, 41 reports were submitted by wardens detailing gas optimizations. The <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/108\">report highlighted below</a> by <strong>IllIllI</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/104\">MiloTruck</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/48\">Picodes</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/14\">robee</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/129\">defsec</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/27\">0xKitsune</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/148\">sashik_eth</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/32\">fatherOfBlocks</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/131\">berndartmueller</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/154\">SmartSek</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/22\">Tadashi</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/70\">Dravee</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/138\">djxploit</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/5\">csanuragjain</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/128\">scaraven</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/140\">c3phas</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/107\">Tomio</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/16\">0xkatana</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/17\">0x1f8b</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/75\">SecureZeroX</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/178\">Chom</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/103\">Fitraldys</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/92\">Sm4rty</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/61\">asutorufos</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/122\">hake</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/164\">Randyyy</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/77\">RoiEvenHaim</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/168\">Funen</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/59\">StyxRave</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/127\">Waze</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/2\">oyc_109</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/124\">0xf15ers</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/151\">simon135</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/40\">sach1r0</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/24\">0xNazgul</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/102\">Kaiziron</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/170\">gzeon</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/79\">catchup</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/90\">hansfriese</a>, <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/93\">0x29A</a>, and <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/125\">delfin454000</a>.</em></p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th align=\"left\">Issue</th>\n<th align=\"center\">Instances</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td align=\"left\">Multiple <code>address</code> mappings can be combined into a single <code>mapping</code> of an <code>address</code> to a <code>struct</code>, where appropriate</td>\n<td align=\"center\">5</td>\n</tr>\n<tr>\n<td>2</td>\n<td align=\"left\">State variables only set in the constructor should be declared <code>immutable</code></td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td>3</td>\n<td align=\"left\">State variables can be packed into fewer storage slots</td>\n<td align=\"center\">2</td>\n</tr>\n<tr>\n<td>4</td>\n<td align=\"left\">State variables should be cached in stack variables rather than re-reading them from storage</td>\n<td align=\"center\">32</td>\n</tr>\n<tr>\n<td>5</td>\n<td align=\"left\">Multiple accesses of a mapping/array should use a local variable cache</td>\n<td align=\"center\">7</td>\n</tr>\n<tr>\n<td>6</td>\n<td align=\"left\">The result of external function calls should be cached rather than re-calling the function</td>\n<td align=\"center\">2</td>\n</tr>\n<tr>\n<td>7</td>\n<td align=\"left\"><code>&#x3C;x> += &#x3C;y></code> costs more gas than <code>&#x3C;x> = &#x3C;x> + &#x3C;y></code> for state variables</td>\n<td align=\"center\">14</td>\n</tr>\n<tr>\n<td>8</td>\n<td align=\"left\"><code>internal</code> functions only called once can be inlined to save gas</td>\n<td align=\"center\">6</td>\n</tr>\n<tr>\n<td>9</td>\n<td align=\"left\">Add <code>unchecked {}</code> for subtractions where the operands cannot underflow because of a previous <code>require()</code></td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td>10</td>\n<td align=\"left\"><code>&#x3C;array>.length</code> should not be looked up in every loop of a <code>for</code>-loop</td>\n<td align=\"center\">8</td>\n</tr>\n<tr>\n<td>11</td>\n<td align=\"left\"><code>++i</code>/<code>i++</code> should be <code>unchecked{++i}</code>/<code>unchecked{i++}</code> when it is not possible for them to overflow, as is the case when used in <code>for</code>- and <code>while</code>-loops</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td>12</td>\n<td align=\"left\"><code>require()</code>/<code>revert()</code> strings longer than 32 bytes cost extra gas</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td>13</td>\n<td align=\"left\">Using <code>bool</code>s for storage incurs overhead</td>\n<td align=\"center\">7</td>\n</tr>\n<tr>\n<td>14</td>\n<td align=\"left\">Using <code>> 0</code> costs more gas than <code>!= 0</code> when used on a <code>uint</code> in a <code>require()</code> statement</td>\n<td align=\"center\">7</td>\n</tr>\n<tr>\n<td>15</td>\n<td align=\"left\">Usage of <code>uints</code>/<code>ints</code> smaller than 32 bytes (256 bits) incurs overhead</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td>16</td>\n<td align=\"left\">Using <code>private</code> rather than <code>public</code> for constants, saves gas</td>\n<td align=\"center\">11</td>\n</tr>\n<tr>\n<td>17</td>\n<td align=\"left\">Duplicated <code>require()</code>/<code>revert()</code> checks should be refactored to a modifier or function</td>\n<td align=\"center\">7</td>\n</tr>\n<tr>\n<td>18</td>\n<td align=\"left\"><code>require()</code> or <code>revert()</code> statements that check input arguments should be at the top of the function</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td>19</td>\n<td align=\"left\">Empty blocks should be removed or emit something</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td>20</td>\n<td align=\"left\">Use custom errors rather than <code>revert()</code>/<code>require()</code> strings to save deployment gas</td>\n<td align=\"center\">109</td>\n</tr>\n<tr>\n<td>21</td>\n<td align=\"left\">Functions guaranteed to revert when called by normal users can be marked <code>payable</code></td>\n<td align=\"center\">53</td>\n</tr>\n</tbody>\n</table>\n<p>Total: 283 instances over 21 issues</p>\n<h2 id=\"1-multiple-address-mappings-can-be-combined-into-a-single-mapping-of-an-address-to-a-struct-where-appropriate\" style=\"position:relative;\"><a href=\"#1-multiple-address-mappings-can-be-combined-into-a-single-mapping-of-an-address-to-a-struct-where-appropriate\" aria-label=\"1 multiple address mappings can be combined into a single mapping of an address to a struct where appropriate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[1] Multiple <code>address</code> mappings can be combined into a single <code>mapping</code> of an <code>address</code> to a <code>struct</code>, where appropriate</h2>\n<p>Saves a storage slot for the mapping. Depending on the circumstances and sizes of types, can avoid a Gsset (<strong>20000 gas</strong>) per mapping combined. Reads and subsequent writes can also be cheaper when a function requires both values and they both fit in the same storage slot. Finally, if both fields are accessed in the same function, can save <strong>~42 gas per access</strong> due to <a href=\"https://gist.github.com/IllIllI000/ec23a57daa30a8f8ca8b9681c8ccefb0\">not having to recalculate the key’s keccak256 hash</a> (Gkeccak256 - <strong>30 gas</strong>) and that calculation’s associated stack operations.</p>\n<p><em>There are 5 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"80\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">StakerVault</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">50</span><span class=\"mtk1\">        </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">balances</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">51</span><span class=\"mtk1\">        </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">actionLockedBalances</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">52</span><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">53</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">)) </span><span class=\"mtk12\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_allowances</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L50-L53\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L50-L53</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"81\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BkdLocker</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">27</span><span class=\"mtk1\">        </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">balances</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">28</span><span class=\"mtk1\">        </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">boostFactors</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">29</span><span class=\"mtk1\">        </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lastUpdated</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">30</span><span class=\"mtk1\">        </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">WithdrawStash</span><span class=\"mtk1\">[]) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">stashedGovTokens</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">31</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">totalStashed</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L27-L31\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L27-L31</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"82\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AmmGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">27</span><span class=\"mtk1\">        </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">perUserStakedIntegral</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">28</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">perUserShare</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L27-L28\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L27-L28</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"83\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrow</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">44</span><span class=\"mtk1\">        </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initialLocked</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">45</span><span class=\"mtk1\">        </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">totalClaimed</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">46</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">address</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">holdingContract</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L44-L46\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L44-L46</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"84\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">LpGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">25</span><span class=\"mtk1\">        </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">perUserStakedIntegral</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">26</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">perUserShare</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/LpGauge.sol#L25-L26\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/LpGauge.sol#L25-L26</a></p>\n<h2 id=\"2-state-variables-only-set-in-the-constructor-should-be-declared-immutable\" style=\"position:relative;\"><a href=\"#2-state-variables-only-set-in-the-constructor-should-be-declared-immutable\" aria-label=\"2 state variables only set in the constructor should be declared immutable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[2] State variables only set in the constructor should be declared <code>immutable</code></h2>\n<p>Avoids a Gsset (<strong>20000 gas</strong>) in the constructor, and replaces each Gwarmacces (<strong>100 gas</strong>) with a <code>PUSH32</code> (<strong>3 gas</strong>).</p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"85\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrow</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">39</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">totalTime</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L39\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L39</a></p>\n<h2 id=\"3-state-variables-can-be-packed-into-fewer-storage-slots\" style=\"position:relative;\"><a href=\"#3-state-variables-can-be-packed-into-fewer-storage-slots\" aria-label=\"3 state variables can be packed into fewer storage slots permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[3] State variables can be packed into fewer storage slots</h2>\n<p>If variables occupying the same slot are both written the same function or by the constructor, avoids a separate Gsset (<strong>20000 gas</strong>). Reads of the variables can also be cheaper</p>\n<p><em>There are 2 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"86\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrow</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Variable ordering with 8 slots instead of the current 9:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit  uint256(32):totalTime, uint256(32):initialLockedSupply, uint256(32):unallocatedSupply, mapping(32):initialLocked, mapping(32):totalClaimed, mapping(32):holdingContract, address(20):admin, bool(1):initializedSupply, address(20):fundAdmin</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">34</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">admin</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L34\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L34</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"87\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">KeeperGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit Variable ordering with 5 slots instead of the current 6:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit  mapping(32):keeperRecords, mapping(32):perPeriodTotalFees, uint256(32):epoch, mapping(32):perPeriodTotalInflation, uint48(6):lastUpdated, bool(1):killed</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">27</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">KeeperRecord</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">keeperRecords</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L27\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L27</a></p>\n<h2 id=\"4-state-variables-should-be-cached-in-stack-variables-rather-than-re-reading-them-from-storage\" style=\"position:relative;\"><a href=\"#4-state-variables-should-be-cached-in-stack-variables-rather-than-re-reading-them-from-storage\" aria-label=\"4 state variables should be cached in stack variables rather than re reading them from storage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[4] State variables should be cached in stack variables rather than re-reading them from storage</h2>\n<p>The instances below point to the second+ access of a state variable within a function. Caching of a state variable replace each Gwarmaccess (<strong>100 gas</strong>) with a much cheaper stack read. Other less obvious fixes/optimizations include having local memory caches of state variable structs, or having local caches of state variable contracts/addresses.</p>\n<p><em>There are 32 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"88\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">StakerVault</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit token</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">330</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oldBal</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">).</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit token</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">333</span><span class=\"mtk1\">:              </span><span class=\"mtk12\">ILiquidityPool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">pool</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">addressProvider</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getPoolForToken</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit token</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">337</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">).</span><span class=\"mtk11\">safeTransferFrom</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">), </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit token</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">338</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">staked</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">).</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">)) - </span><span class=\"mtk12\">oldBal</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit token</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">375</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oldBal</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">).</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit token</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">381</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">).</span><span class=\"mtk11\">safeTransfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">dst</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit token</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">383</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">unstaked</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">oldBal</span><span class=\"mtk1\">.</span><span class=\"mtk11\">uncheckedSub</span><span class=\"mtk1\">(</span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">).</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">)));</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L330\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L330</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"89\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BkdLocker</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit totalLockedBoosted</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">97</span><span class=\"mtk1\">:           </span><span class=\"mtk12\">curRewardTokenData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">feeIntegral</span><span class=\"mtk1\"> += </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">.</span><span class=\"mtk11\">scaledDiv</span><span class=\"mtk1\">(</span><span class=\"mtk12\">totalLockedBoosted</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L97\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L97</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"90\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Minter</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit currentInflationAmountLp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">91</span><span class=\"mtk1\">:               </span><span class=\"mtk12\">currentInflationAmountLp</span><span class=\"mtk1\"> +</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit currentInflationAmountLp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">208</span><span class=\"mtk1\">:                  </span><span class=\"mtk12\">currentInflationAmountLp</span><span class=\"mtk1\"> +</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit currentInflationAmountKeeper</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">92</span><span class=\"mtk1\">:               </span><span class=\"mtk12\">currentInflationAmountKeeper</span><span class=\"mtk1\"> +</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit currentInflationAmountKeeper</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">209</span><span class=\"mtk1\">:                  </span><span class=\"mtk12\">currentInflationAmountKeeper</span><span class=\"mtk1\"> +</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit currentInflationAmountAmm</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">93</span><span class=\"mtk1\">:               </span><span class=\"mtk12\">currentInflationAmountAmm</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit currentInflationAmountAmm</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">210</span><span class=\"mtk1\">:                  </span><span class=\"mtk12\">currentInflationAmountAmm</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit totalAvailableToNow</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">220</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">newTotalMintedToNow</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk12\">totalAvailableToNow</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Mintable amount exceeded&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L91\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L91</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"91\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">InflationManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit minter</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">501</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lpInflationRate</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">Minter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">minter</span><span class=\"mtk1\">).</span><span class=\"mtk11\">getLpInflationRate</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit minter</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">511</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">keeperInflationRate</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">Minter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">minter</span><span class=\"mtk1\">).</span><span class=\"mtk11\">getKeeperInflationRate</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit minter</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">526</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ammInflationRate</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">Minter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">minter</span><span class=\"mtk1\">).</span><span class=\"mtk11\">getAmmInflationRate</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit totalKeeperPoolWeight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">517</span><span class=\"mtk1\">:              </span><span class=\"mtk12\">totalKeeperPoolWeight</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit totalKeeperPoolWeight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">575</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">totalKeeperPoolWeight</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">totalKeeperPoolWeight</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> ? </span><span class=\"mtk12\">totalKeeperPoolWeight</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit totalLpPoolWeight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">502</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">poolInflationRate</span><span class=\"mtk1\"> = (</span><span class=\"mtk12\">currentUInts256</span><span class=\"mtk1\">[</span><span class=\"mtk12\">key</span><span class=\"mtk1\">] * </span><span class=\"mtk12\">lpInflationRate</span><span class=\"mtk1\">) / </span><span class=\"mtk12\">totalLpPoolWeight</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit totalLpPoolWeight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">589</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">totalLpPoolWeight</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">totalLpPoolWeight</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> ? </span><span class=\"mtk12\">totalLpPoolWeight</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit totalAmmTokenWeight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">528</span><span class=\"mtk1\">:              </span><span class=\"mtk12\">totalAmmTokenWeight</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit totalAmmTokenWeight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">602</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">totalAmmTokenWeight</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">totalAmmTokenWeight</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> ? </span><span class=\"mtk12\">totalAmmTokenWeight</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L501\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L501</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"92\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AmmGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit ammStakedIntegral</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">159</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">perUserStakedIntegral</span><span class=\"mtk1\">[</span><span class=\"mtk12\">user</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">ammStakedIntegral</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit totalStaked</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">90</span><span class=\"mtk1\">:                   (</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ammLastUpdated</span><span class=\"mtk1\">))).</span><span class=\"mtk11\">scaledDiv</span><span class=\"mtk1\">(</span><span class=\"mtk12\">totalStaked</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit totalStaked</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">148</span><span class=\"mtk1\">:              </span><span class=\"mtk12\">ammStakedIntegral</span><span class=\"mtk1\"> += (</span><span class=\"mtk12\">currentRate</span><span class=\"mtk1\"> * </span><span class=\"mtk12\">timeElapsed</span><span class=\"mtk1\">).</span><span class=\"mtk11\">scaledDiv</span><span class=\"mtk1\">(</span><span class=\"mtk12\">totalStaked</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L159\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L159</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"93\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrow</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit unallocatedSupply</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">84</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">unallocatedSupply</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;No reward tokens in contract&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L84\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L84</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"94\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">KeeperGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit epoch</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">87</span><span class=\"mtk1\">:           </span><span class=\"mtk12\">keeperRecords</span><span class=\"mtk1\">[</span><span class=\"mtk12\">beneficiary</span><span class=\"mtk1\">].</span><span class=\"mtk12\">feesInPeriod</span><span class=\"mtk1\">[</span><span class=\"mtk12\">epoch</span><span class=\"mtk1\">] += </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit epoch</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">88</span><span class=\"mtk1\">:           </span><span class=\"mtk12\">perPeriodTotalFees</span><span class=\"mtk1\">[</span><span class=\"mtk12\">epoch</span><span class=\"mtk1\">] += </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit epoch</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">131</span><span class=\"mtk1\">:              </span><span class=\"mtk12\">endEpoch</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">epoch</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L87\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L87</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"95\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">access</span><span class=\"mtk1\">/</span><span class=\"mtk12\">RoleManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit _roles[role].members</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">148</span><span class=\"mtk1\">:          </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_roles</span><span class=\"mtk1\">[</span><span class=\"mtk12\">role</span><span class=\"mtk1\">].</span><span class=\"mtk12\">members</span><span class=\"mtk1\">[</span><span class=\"mtk12\">account</span><span class=\"mtk1\">];</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/RoleManager.sol#L148\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/RoleManager.sol#L148</a></p>\n<h2 id=\"5-multiple-accesses-of-a-mappingarray-should-use-a-local-variable-cache\" style=\"position:relative;\"><a href=\"#5-multiple-accesses-of-a-mappingarray-should-use-a-local-variable-cache\" aria-label=\"5 multiple accesses of a mappingarray should use a local variable cache permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[5] Multiple accesses of a mapping/array should use a local variable cache</h2>\n<p>The instances below point to the second+ access of a value inside a mapping/array, within a function. Caching a mapping’s value in a local <code>storage</code> variable when the value is accessed <a href=\"https://gist.github.com/IllIllI000/ec23a57daa30a8f8ca8b9681c8ccefb0\">multiple times</a>, saves <strong>~42 gas per access</strong> due to not having to recalculate the key’s keccak256 hash (Gkeccak256 - <strong>30 gas</strong>) and that calculation’s associated stack operations. Caching an array’s struct avoids recalculating the array offsets into memory</p>\n<p><em>There are 7 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"96\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BkdLocker</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit stashedWithdraws[i]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">142</span><span class=\"mtk1\">:                  </span><span class=\"mtk12\">totalAvailableToWithdraw</span><span class=\"mtk1\"> += </span><span class=\"mtk12\">stashedWithdraws</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">].</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L142\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L142</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"97\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrow</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit amounts[i]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">96</span><span class=\"mtk1\">:               </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">recipient_</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">amounts</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">].</span><span class=\"mtk12\">recipient</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L96\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L96</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"98\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">KeeperGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit keeperRecords[beneficiary]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">84</span><span class=\"mtk1\">:               </span><span class=\"mtk12\">keeperRecords</span><span class=\"mtk1\">[</span><span class=\"mtk12\">beneficiary</span><span class=\"mtk1\">].</span><span class=\"mtk12\">firstEpochSet</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit keeperRecords[beneficiary]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">85</span><span class=\"mtk1\">:               </span><span class=\"mtk12\">keeperRecords</span><span class=\"mtk1\">[</span><span class=\"mtk12\">beneficiary</span><span class=\"mtk1\">].</span><span class=\"mtk12\">nextEpochToClaim</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">epoch</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit keeperRecords[beneficiary]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">87</span><span class=\"mtk1\">:           </span><span class=\"mtk12\">keeperRecords</span><span class=\"mtk1\">[</span><span class=\"mtk12\">beneficiary</span><span class=\"mtk1\">].</span><span class=\"mtk12\">feesInPeriod</span><span class=\"mtk1\">[</span><span class=\"mtk12\">epoch</span><span class=\"mtk1\">] += </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit keeperRecords[beneficiary]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">139</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">keeperRecords</span><span class=\"mtk1\">[</span><span class=\"mtk12\">beneficiary</span><span class=\"mtk1\">].</span><span class=\"mtk12\">nextEpochToClaim</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">endEpoch</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L84\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L84</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"99\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">access</span><span class=\"mtk1\">/</span><span class=\"mtk12\">RoleManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit _roles[role]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">148</span><span class=\"mtk1\">:          </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_roles</span><span class=\"mtk1\">[</span><span class=\"mtk12\">role</span><span class=\"mtk1\">].</span><span class=\"mtk12\">members</span><span class=\"mtk1\">[</span><span class=\"mtk12\">account</span><span class=\"mtk1\">];</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/RoleManager.sol#L148\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/RoleManager.sol#L148</a></p>\n<h2 id=\"6-the-result-of-external-function-calls-should-be-cached-rather-than-re-calling-the-function\" style=\"position:relative;\"><a href=\"#6-the-result-of-external-function-calls-should-be-cached-rather-than-re-calling-the-function\" aria-label=\"6 the result of external function calls should be cached rather than re calling the function permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[6] The result of external function calls should be cached rather than re-calling the function</h2>\n<p>The instances below point to the second+ call of the function within a single function</p>\n<p><em>There are 2 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"100\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">StakerVault</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit _controller.addressProvider()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">62</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">Authorization</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_controller</span><span class=\"mtk1\">.</span><span class=\"mtk11\">addressProvider</span><span class=\"mtk1\">().</span><span class=\"mtk11\">getRoleManager</span><span class=\"mtk1\">())</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L62\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L62</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"101\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">InflationManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit i.uncheckedInc()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">121</span><span class=\"mtk1\">:          </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">length</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">i</span><span class=\"mtk1\">.</span><span class=\"mtk11\">uncheckedInc</span><span class=\"mtk1\">()) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L121\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L121</a></p>\n<h2 id=\"7-x--y-costs-more-gas-than-x--x--y-for-state-variables\" style=\"position:relative;\"><a href=\"#7-x--y-costs-more-gas-than-x--x--y-for-state-variables\" aria-label=\"7 x  y costs more gas than x  x  y for state variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[7] <code>&#x3C;x> += &#x3C;y></code> costs more gas than <code>&#x3C;x> = &#x3C;x> + &#x3C;y></code> for state variables</h2>\n<p><em>There are 14 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"102\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">StakerVault</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">343</span><span class=\"mtk1\">:              </span><span class=\"mtk12\">strategiesTotalStaked</span><span class=\"mtk1\"> += </span><span class=\"mtk12\">staked</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">345</span><span class=\"mtk1\">:              </span><span class=\"mtk12\">_poolTotalStaked</span><span class=\"mtk1\"> += </span><span class=\"mtk12\">staked</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">392</span><span class=\"mtk1\">:              </span><span class=\"mtk12\">strategiesTotalStaked</span><span class=\"mtk1\"> -= </span><span class=\"mtk12\">unstaked</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">394</span><span class=\"mtk1\">:              </span><span class=\"mtk12\">_poolTotalStaked</span><span class=\"mtk1\"> -= </span><span class=\"mtk12\">unstaked</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L343\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L343</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"103\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BkdLocker</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">152</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">totalLocked</span><span class=\"mtk1\"> -= </span><span class=\"mtk12\">totalAvailableToWithdraw</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">230</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">totalLocked</span><span class=\"mtk1\"> += </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L152\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L152</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"104\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Minter</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">154</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">issuedNonInflationSupply</span><span class=\"mtk1\"> += </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">188</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">totalAvailableToNow</span><span class=\"mtk1\"> += (</span><span class=\"mtk12\">currentTotalInflation</span><span class=\"mtk1\"> * (</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">lastEvent</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">218</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">totalAvailableToNow</span><span class=\"mtk1\"> += ((</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">lastEvent</span><span class=\"mtk1\">) * </span><span class=\"mtk12\">currentTotalInflation</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L154\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L154</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"105\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrowRevocable</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">67</span><span class=\"mtk1\">:           </span><span class=\"mtk12\">_vestedBefore</span><span class=\"mtk1\"> += </span><span class=\"mtk12\">vested</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrowRevocable.sol#L67\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrowRevocable.sol#L67</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"106\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AmmGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">113</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">totalStaked</span><span class=\"mtk1\"> += </span><span class=\"mtk12\">staked</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">135</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">totalStaked</span><span class=\"mtk1\"> -= </span><span class=\"mtk12\">unstaked</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">148</span><span class=\"mtk1\">:              </span><span class=\"mtk12\">ammStakedIntegral</span><span class=\"mtk1\"> += (</span><span class=\"mtk12\">currentRate</span><span class=\"mtk1\"> * </span><span class=\"mtk12\">timeElapsed</span><span class=\"mtk1\">).</span><span class=\"mtk11\">scaledDiv</span><span class=\"mtk1\">(</span><span class=\"mtk12\">totalStaked</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L113\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L113</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"107\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">LpGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">115</span><span class=\"mtk1\">               </span><span class=\"mtk12\">poolStakedIntegral</span><span class=\"mtk1\"> += (</span><span class=\"mtk12\">currentRate</span><span class=\"mtk1\"> * (</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">poolLastUpdate</span><span class=\"mtk1\">)).</span><span class=\"mtk11\">scaledDiv</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">116</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">poolTotalStaked</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">117</span><span class=\"mtk1\">:              );</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/LpGauge.sol#L115-L117\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/LpGauge.sol#L115-L117</a></p>\n<h2 id=\"8-internal-functions-only-called-once-can-be-inlined-to-save-gas\" style=\"position:relative;\"><a href=\"#8-internal-functions-only-called-once-can-be-inlined-to-save-gas\" aria-label=\"8 internal functions only called once can be inlined to save gas permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[8] <code>internal</code> functions only called once can be inlined to save gas</h2>\n<p>Not inlining costs <strong>20 to 40 gas</strong> because of two extra <code>JUMP</code> instructions and additional stack operations needed for function calls.</p>\n<p><em>There are 6 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"108\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AddressProvider</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">433</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_addKnownAddressKey</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\">, AddressProviderMeta.Meta </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">meta</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/AddressProvider.sol#L433\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/AddressProvider.sol#L433</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"109\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">RewardHandler</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">62</span><span class=\"mtk1\">:       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_approve</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">token</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">spender</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L62\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L62</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"110\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">KeeperGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">146</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_mintRewards</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">beneficiary</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L146\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L146</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"111\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">FeeBurner</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">96</span><span class=\"mtk1\">        </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_depositInPool</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">underlying_</span><span class=\"mtk1\">, </span><span class=\"mtk12\">ILiquidityPool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">pool_</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">97            </span><span class=\"mtk11\">internal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">98:           </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">received</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">125:      </span><span class=\"mtk11\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_swapperRouter</span><span class=\"mtk1\">() </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">ISwapperRouter</span><span class=\"mtk1\">) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L96-L98\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L96-L98</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"112\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">LpGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">106</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_mintRewards</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">beneficiary</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/LpGauge.sol#L106\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/LpGauge.sol#L106</a></p>\n<h2 id=\"9-add-unchecked--for-subtractions-where-the-operands-cannot-underflow-because-of-a-previous-require\" style=\"position:relative;\"><a href=\"#9-add-unchecked--for-subtractions-where-the-operands-cannot-underflow-because-of-a-previous-require\" aria-label=\"9 add unchecked  for subtractions where the operands cannot underflow because of a previous require permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[9] Add <code>unchecked {}</code> for subtractions where the operands cannot underflow because of a previous <code>require()</code></h2>\n<p><code>require(a &#x3C;= b); x = b - a</code> => <code>require(a &#x3C;= b); unchecked { x = b - a }</code></p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"113\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrow</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">63</span><span class=\"mtk1\">:           </span><span class=\"mtk12\">totalTime</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">endtime_</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">starttime_</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L63\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L63</a></p>\n<h2 id=\"10-arraylength-should-not-be-looked-up-in-every-loop-of-a-for-loop\" style=\"position:relative;\"><a href=\"#10-arraylength-should-not-be-looked-up-in-every-loop-of-a-for-loop\" aria-label=\"10 arraylength should not be looked up in every loop of a for loop permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[10] <code>&#x3C;array>.length</code> should not be looked up in every loop of a <code>for</code>-loop</h2>\n<p>The overheads outlined below are <em>PER LOOP</em>, excluding the first loop</p>\n<ul>\n<li>storage arrays incur a Gwarmaccess (<strong>100 gas</strong>)</li>\n<li>memory arrays use <code>MLOAD</code> (<strong>3 gas</strong>)</li>\n<li>calldata arrays use <code>CALLDATALOAD</code> (<strong>3 gas</strong>)</li>\n</ul>\n<p>Caching the length changes each of these to a <code>DUP&#x3C;N></code> (<strong>3 gas</strong>), and gets rid of the extra <code>DUP&#x3C;N></code> needed to store the stack offset</p>\n<p><em>There are 8 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"114\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">StakerVault</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">259</span><span class=\"mtk1\">:          </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">actions</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">i</span><span class=\"mtk1\">.</span><span class=\"mtk11\">uncheckedInc</span><span class=\"mtk1\">()) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L259\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L259</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"115\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">zaps</span><span class=\"mtk1\">/</span><span class=\"mtk12\">PoolMigrationZap</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">22</span><span class=\"mtk1\">:           </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">newPools_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">; ++</span><span class=\"mtk12\">i</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">39</span><span class=\"mtk1\">:           </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">oldPoolAddresses_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">; ) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L22\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L22</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"116\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">RewardHandler</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">42</span><span class=\"mtk1\">:           </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">pools</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">i</span><span class=\"mtk1\">.</span><span class=\"mtk11\">uncheckedInc</span><span class=\"mtk1\">()) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L42\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L42</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"117\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">InflationManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">116</span><span class=\"mtk1\">:          </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">stakerVaults</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">i</span><span class=\"mtk1\">.</span><span class=\"mtk11\">uncheckedInc</span><span class=\"mtk1\">()) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L116\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L116</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"118\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrow</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">94</span><span class=\"mtk1\">:           </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">amounts</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">i</span><span class=\"mtk1\">.</span><span class=\"mtk11\">uncheckedInc</span><span class=\"mtk1\">()) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L94\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L94</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"119\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">FeeBurner</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">56</span><span class=\"mtk1\">:           </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">tokens_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">i</span><span class=\"mtk1\">.</span><span class=\"mtk11\">uncheckedInc</span><span class=\"mtk1\">()) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L56\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L56</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"120\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">access</span><span class=\"mtk1\">/</span><span class=\"mtk12\">RoleManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">82</span><span class=\"mtk1\">:           </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">roles</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">i</span><span class=\"mtk1\">.</span><span class=\"mtk11\">uncheckedInc</span><span class=\"mtk1\">()) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/RoleManager.sol#L82\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/RoleManager.sol#L82</a></p>\n<h2 id=\"11-ii-should-be-uncheckediuncheckedi-when-it-is-not-possible-for-them-to-overflow-as-is-the-case-when-used-in-for--and-while-loops\" style=\"position:relative;\"><a href=\"#11-ii-should-be-uncheckediuncheckedi-when-it-is-not-possible-for-them-to-overflow-as-is-the-case-when-used-in-for--and-while-loops\" aria-label=\"11 ii should be uncheckediuncheckedi when it is not possible for them to overflow as is the case when used in for  and while loops permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[11] <code>++i</code>/<code>i++</code> should be <code>unchecked{++i}</code>/<code>unchecked{i++}</code> when it is not possible for them to overflow, as is the case when used in <code>for</code>- and <code>while</code>-loops</h2>\n<p>The <code>unchecked</code> keyword is new in solidity version 0.8.0, so this only applies to that version or higher, which these instances are. This saves <strong>30-40 gas <a href=\"https://gist.github.com/hrkrshnn/ee8fabd532058307229d65dcd5836ddc#the-increment-in-for-loop-post-condition-can-be-made-unchecked\">per loop</a></strong></p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"121\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">zaps</span><span class=\"mtk1\">/</span><span class=\"mtk12\">PoolMigrationZap</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">22</span><span class=\"mtk1\">:           </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">newPools_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">; ++</span><span class=\"mtk12\">i</span><span class=\"mtk1\">) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L22\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L22</a></p>\n<h2 id=\"12-requirerevert-strings-longer-than-32-bytes-cost-extra-gas\" style=\"position:relative;\"><a href=\"#12-requirerevert-strings-longer-than-32-bytes-cost-extra-gas\" aria-label=\"12 requirerevert strings longer than 32 bytes cost extra gas permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[12] <code>require()</code>/<code>revert()</code> strings longer than 32 bytes cost extra gas</h2>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"122\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Minter</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">150</span><span class=\"mtk1\">           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">151</span><span class=\"mtk1\">               </span><span class=\"mtk12\">issuedNonInflationSupply</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk12\">nonInflationDistribution</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">152</span><span class=\"mtk1\">               </span><span class=\"mtk8\">&quot;Maximum non-inflation amount exceeded.&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">153</span><span class=\"mtk1\">:          );</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L150-L153\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L150-L153</a></p>\n<h2 id=\"13-using-bools-for-storage-incurs-overhead\" style=\"position:relative;\"><a href=\"#13-using-bools-for-storage-incurs-overhead\" aria-label=\"13 using bools for storage incurs overhead permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[13] Using <code>bool</code>s for storage incurs overhead</h2>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"123\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Booleans are more expensive than uint256 or any type that takes up a full</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// word because each write operation emits an extra SLOAD to first read the</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// slot&#39;s contents, replace the bits taken up by the boolean, and then write</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// back. This is the compiler&#39;s defense against contract upgrades and</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// pointer aliasing, and it cannot be disabled.</span></span></span></code></pre>\n<p><a href=\"https://github.com/OpenZeppelin/openzeppelin-contracts/blob/58f635312aa21f947cae5f8578638a85aa2519f5/contracts/security/ReentrancyGuard.sol#L23-L27\">https://github.com/OpenZeppelin/openzeppelin-contracts/blob/58f635312aa21f947cae5f8578638a85aa2519f5/contracts/security/ReentrancyGuard.sol#L23-L27</a>\nUse <code>uint256(1)</code> and <code>uint256(2)</code> for true/false to avoid a Gwarmaccess (<strong><a href=\"https://gist.github.com/IllIllI000/1b70014db712f8572a72378321250058\">100 gas</a></strong>), and to avoid Gsset (<strong>20000 gas</strong>) when changing from ‘false’ to ‘true’, after having been ‘true’ in the past</p>\n<p><em>There are 7 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"124\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">StakerVault</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">58</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">strategies</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L58\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L58</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"125\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Minter</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">41</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initialPeriodEnded</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L41\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L41</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"126\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">InflationManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">31</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">weightBasedKeeperDistributionDeactivated</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">41</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">gauges</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L31\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L31</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"127\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AmmGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">31</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">killed</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L31\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L31</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"128\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrow</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">42</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initializedSupply</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L42\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L42</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"129\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">KeeperGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">37</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">override</span><span class=\"mtk1\"> </span><span class=\"mtk12\">killed</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L37\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L37</a></p>\n<h2 id=\"14-using--0-costs-more-gas-than--0-when-used-on-a-uint-in-a-require-statement\" style=\"position:relative;\"><a href=\"#14-using--0-costs-more-gas-than--0-when-used-on-a-uint-in-a-require-statement\" aria-label=\"14 using  0 costs more gas than  0 when used on a uint in a require statement permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[14] Using <code>> 0</code> costs more gas than <code>!= 0</code> when used on a <code>uint</code> in a <code>require()</code> statement</h2>\n<p>This change saves <strong><a href=\"https://aws1.discourse-cdn.com/business6/uploads/zeppelin/original/2X/3/363a367d6d68851f27d2679d10706cd16d788b96.png\">6 gas</a></strong> per instance</p>\n<p><em>There are 7 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"130\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BkdLocker</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">91</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">INVALID_AMOUNT</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">92</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">totalLockedBoosted</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">NOT_ENOUGH_FUNDS</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">137</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;No entries&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L91\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L91</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"131\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AmmGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">104</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">INVALID_AMOUNT</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">125</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">INVALID_AMOUNT</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L104\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L104</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"132\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrow</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">84</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">unallocatedSupply</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;No reward tokens in contract&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L84\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L84</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"133\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">KeeperGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">140</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">totalClaimable</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">ZERO_TRANSFER_NOT_ALLOWED</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L140\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L140</a></p>\n<h2 id=\"15-usage-of-uintsints-smaller-than-32-bytes-256-bits-incurs-overhead\" style=\"position:relative;\"><a href=\"#15-usage-of-uintsints-smaller-than-32-bytes-256-bits-incurs-overhead\" aria-label=\"15 usage of uintsints smaller than 32 bytes 256 bits incurs overhead permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[15] Usage of <code>uints</code>/<code>ints</code> smaller than 32 bytes (256 bits) incurs overhead</h2>\n<blockquote>\n<p>When using elements that are smaller than 32 bytes, your contract’s gas usage may be higher. This is because the EVM operates on 32 bytes at a time. Therefore, if the element is smaller than that, the EVM must use more operations in order to reduce the size of the element from 32 bytes to the desired size.</p>\n</blockquote>\n<p><a href=\"https://docs.soliditylang.org/en/v0.8.11/internals/layout_in_storage.html\">https://docs.soliditylang.org/en/v0.8.11/internals/layout_in_storage.html</a>\nUse a larger size then downcast where needed</p>\n<p><em>There are 3 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"134\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">StakerVault</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">295</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">decimals</span><span class=\"mtk1\">() </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint8</span><span class=\"mtk1\">) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L295\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L295</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"135\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AmmGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">32</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">uint48</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ammLastUpdated</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L32\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L32</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"136\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">KeeperGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">34</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">uint48</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lastUpdated</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L34\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L34</a></p>\n<h2 id=\"16-using-private-rather-than-public-for-constants-saves-gas\" style=\"position:relative;\"><a href=\"#16-using-private-rather-than-public-for-constants-saves-gas\" aria-label=\"16 using private rather than public for constants saves gas permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[16] Using <code>private</code> rather than <code>public</code> for constants, saves gas</h2>\n<p>If needed, the value can be read from the verified contract source code. Savings are due to the compiler not having to create non-payable getter functions for deployment calldata, and not adding another entry to the method ID table</p>\n<p><em>There are 11 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"137\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Minter</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">25</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initialAnnualInflationRateLp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">26</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">annualInflationDecayLp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">30</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initialPeriodKeeperInflation</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">31</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initialAnnualInflationRateKeeper</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">32</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">annualInflationDecayKeeper</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">36</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initialPeriodAmmInflation</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">37</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initialAnnualInflationRateAmm</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">38</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">annualInflationDecayAmm</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">44</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">nonInflationDistribution</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L25\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L25</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"138\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrow</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">37</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">startTime</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">38</span><span class=\"mtk1\">:       </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">immutable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">endTime</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L37\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L37</a></p>\n<h2 id=\"17-duplicated-requirerevert-checks-should-be-refactored-to-a-modifier-or-function\" style=\"position:relative;\"><a href=\"#17-duplicated-requirerevert-checks-should-be-refactored-to-a-modifier-or-function\" aria-label=\"17 duplicated requirerevert checks should be refactored to a modifier or function permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[17] Duplicated <code>require()</code>/<code>revert()</code> checks should be refactored to a modifier or function</h2>\n<p>Saves deployment costs</p>\n<p><em>There are 7 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"139\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">StakerVault</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">223</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">addressProvider</span><span class=\"mtk1\">.</span><span class=\"mtk11\">isAction</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">), </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">UNAUTHORIZED_ACCESS</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L223\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L223</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"140\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">utils</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Preparable</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">98</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">deadlines</span><span class=\"mtk1\">[</span><span class=\"mtk12\">key</span><span class=\"mtk1\">] != </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">NOTHING_PENDING</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/Preparable.sol#L98\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/Preparable.sol#L98</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"141\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AddressProvider</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">260</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(!</span><span class=\"mtk12\">meta</span><span class=\"mtk1\">.</span><span class=\"mtk12\">frozen</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">ADDRESS_FROZEN</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/AddressProvider.sol#L260\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/AddressProvider.sol#L260</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"142\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">InflationManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">270</span><span class=\"mtk1\">:              </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk11\">IStakerVault</span><span class=\"mtk1\">(</span><span class=\"mtk12\">stakerVault</span><span class=\"mtk1\">).</span><span class=\"mtk11\">getLpGauge</span><span class=\"mtk1\">() != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">), </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">ADDRESS_NOT_FOUND</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">365</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">weights</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Invalid length of arguments&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L270\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L270</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"143\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AmmGauge</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">125</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">INVALID_AMOUNT</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L125\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L125</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"144\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrow</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">76</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">admin</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">UNAUTHORIZED_ACCESS</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L76\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L76</a></p>\n<h2 id=\"18-require-or-revert-statements-that-check-input-arguments-should-be-at-the-top-of-the-function\" style=\"position:relative;\"><a href=\"#18-require-or-revert-statements-that-check-input-arguments-should-be-at-the-top-of-the-function\" aria-label=\"18 require or revert statements that check input arguments should be at the top of the function permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[18] <code>require()</code> or <code>revert()</code> statements that check input arguments should be at the top of the function</h2>\n<p>Checks that involve constants should come before checks that involve state variables</p>\n<p><em>There are 3 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"145\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Controller</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">35</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_inflationManager</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">), </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">INVALID_ARGUMENT</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/Controller.sol#L35\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/Controller.sol#L35</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"146\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">InflationManager</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">60</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_minter</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">), </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">INVALID_MINTER</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L60\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L60</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"147\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VestedEscrowRevocable</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">54</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\"> != </span><span class=\"mtk12\">treasury</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Treasury cannot be revoked!&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrowRevocable.sol#L54\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrowRevocable.sol#L54</a></p>\n<h2 id=\"19-empty-blocks-should-be-removed-or-emit-something\" style=\"position:relative;\"><a href=\"#19-empty-blocks-should-be-removed-or-emit-something\" aria-label=\"19 empty blocks should be removed or emit something permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[19] Empty blocks should be removed or emit something</h2>\n<p>The code should be refactored such that they no longer exist, or the block should do something useful, such as emitting an event or reverting. If the contract is meant to be extended, the contract should be <code>abstract</code> and the function signatures be added without any default implementation. If the block is an empty if-statement block to avoid doing subsequent checks in the else-if/else conditions, the else-if/else conditions should be nested under the negation of the if-statement, because they involve different classes of checks, which may lead to the introduction of errors when the code is later modified (<code>if(x){}else if(y){...}else{...}</code> => <code>if(!x){if(y){...}else{...}}</code>)</p>\n<p><em>There are 3 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"148\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">zaps</span><span class=\"mtk1\">/</span><span class=\"mtk12\">PoolMigrationZap</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">31</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">receive</span><span class=\"mtk1\">() </span><span class=\"mtk12\">external</span><span class=\"mtk1\"> </span><span class=\"mtk12\">payable</span><span class=\"mtk1\"> {}</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L31\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L31</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"149\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">RewardHandler</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">30</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">receive</span><span class=\"mtk1\">() </span><span class=\"mtk12\">external</span><span class=\"mtk1\"> </span><span class=\"mtk12\">payable</span><span class=\"mtk1\"> {}</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L30\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L30</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"150\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">tokenomics</span><span class=\"mtk1\">/</span><span class=\"mtk12\">FeeBurner</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">35</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">receive</span><span class=\"mtk1\">() </span><span class=\"mtk12\">external</span><span class=\"mtk1\"> </span><span class=\"mtk12\">payable</span><span class=\"mtk1\"> {} </span><span class=\"mtk3\">// Recieve function for withdrawing from Backd ETH Pool</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L35\">https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L35</a></p>\n<h2 id=\"20-use-custom-errors-rather-than-revertrequire-strings-to-save-deployment-gas\" style=\"position:relative;\"><a href=\"#20-use-custom-errors-rather-than-revertrequire-strings-to-save-deployment-gas\" aria-label=\"20 use custom errors rather than revertrequire strings to save deployment gas permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[20] Use custom errors rather than <code>revert()</code>/<code>require()</code> strings to save deployment gas</h2>\n<p>Custom errors are available from solidity version 0.8.4. The instances below match or exceed that version</p>\n<p><em>There are 109 instances of this issue:</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/108\">See original submission</a> for details.</p>\n<h3 id=\"21-functions-guaranteed-to-revert-when-called-by-normal-users-can-be-marked-payable\" style=\"position:relative;\"><a href=\"#21-functions-guaranteed-to-revert-when-called-by-normal-users-can-be-marked-payable\" aria-label=\"21 functions guaranteed to revert when called by normal users can be marked payable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>21. Functions guaranteed to revert when called by normal users can be marked <code>payable</code></h3>\n<p>If a function modifier such as <code>onlyOwner</code> is used, the function will revert if a normal user tries to pay the function. Marking the function as <code>payable</code> will lower the gas cost for legitimate callers because the compiler will not include checks for whether a payment was provided. The extra opcodes avoided are\n<code>CALLVALUE</code>(2),<code>DUP1</code>(3),<code>ISZERO</code>(3),<code>PUSH2</code>(3),<code>JUMPI</code>(10),<code>PUSH1</code>(3),<code>DUP1</code>(3),<code>REVERT</code>(0),<code>JUMPDEST</code>(1),<code>POP</code>(2), which costs an average of about <strong>21 gas per call</strong> to the function, in addition to the extra deployment cost</p>\n<p><em>There are 53 instances of this issue:</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/108\">See original submission</a> for details.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/108#issuecomment-1149597562\">chase-manning (Backd) commented</a>:</strong></p>\n<blockquote>\n<p>I consider this report to be of particularly high quality.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/108#issuecomment-1159559943\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>View a <a href=\"https://github.com/code-423n4/2022-05-backd-findings/issues/108#issuecomment-1159275418\">detailed breakdown</a> of the judge’s considerations.</p>\n</blockquote>\n<blockquote>\n<p>This is hands down the best gas report I’ve ever reviewed, there’s only two improvements I’d recommend:</p>\n<ul>\n<li>Post all the extra details as separate gists to make it easier to scan vs read</li>\n<li>Show total gas saved in one line for each finding</li>\n</ul>\n</blockquote>\n<blockquote>\n<p>This would make it easier to score, review for the sponsor and immediately gives a sense of value to the findings</p>\n</blockquote>\n<blockquote>\n<p>Additionally a couple of the findings, which are completely valid, would require more detailed POC to be actionable and helpful, hence I gave them no points.</p>\n</blockquote>\n<blockquote>\n<p>That said this is the best I’ve seen so far!</p>\n</blockquote>\n<blockquote>\n<p>Total Gas Saved:\n7415</p>\n</blockquote>\n<hr>\n<h1 id=\"disclosures\" style=\"position:relative;\"><a href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Disclosures</h1>\n<p>C4 is an open organization governed by participants in the community.</p>\n<p>C4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.</p>\n<p>C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk10 { color: #4EC9B0; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>",
  "toc": "<ul>\n<li>\n<p><a href=\"#overview\">Overview</a></p>\n<ul>\n<li><a href=\"#about-c4\">About C4</a></li>\n<li><a href=\"#wardens\">Wardens</a></li>\n</ul>\n</li>\n<li><a href=\"#summary\">Summary</a></li>\n<li><a href=\"#scope\">Scope</a></li>\n<li><a href=\"#severity-criteria\">Severity Criteria</a></li>\n<li>\n<p><a href=\"#high-risk-findings-2\">High Risk Findings (2)</a></p>\n<ul>\n<li><a href=\"#h-01-mintersolstartinflation-can-be-bypassed\">[H-01] <code>Minter.sol#startInflation()</code> can be bypassed.</a></li>\n<li><a href=\"#h-02-total-supply-is-not-guaranteed-and-is-not-deterministic\">[H-02] Total Supply is not guaranteed and is not deterministic.</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#medium-risk-findings-18\">Medium Risk Findings (18)</a></p>\n<ul>\n<li><a href=\"#m-01-dos-on-keepergauge-due-to-division-by-zero\">[M-01] DoS on KeeperGauge due to division by zero</a></li>\n<li><a href=\"#m-02-the-first-amm-staker-will-have-control-over-how-the-shares-are-calculated\">[M-02] The first AMM Staker will have control over how the shares are calculated.</a></li>\n<li><a href=\"#m-03-the-first-amm-staker-may-not-receive-according-rewards-because-of-poor-checkpoints\">[M-03] THE first AMM Staker may not receive according rewards because of poor checkpoints</a></li>\n<li><a href=\"#m-04-amount-distributed-can-be-inaccurate-when-updating-weights-\">[M-04] Amount distributed can be inaccurate when updating weights </a></li>\n<li><a href=\"#m-05-bkdlockerdepositfees-can-be-front-run-to-steal-the-newly-added-rewardtoken\">[M-05] <code>BkdLocker#depositFees()</code> can be front run to steal the newly added rewardToken</a></li>\n<li><a href=\"#m-06-mintersol_executeinflationrateupdate-inflationmanagercheckpointallgauges-is-called-after-inflationrate-is-updated-causing-users-to-lose-rewards\">[M-06] <code>Minter.sol#_executeInflationRateUpdate()</code> <code>inflationManager().checkpointAllGauges()</code> is called after InflationRate is updated, causing users to lose rewards</a></li>\n<li><a href=\"#m-07-feeburner-initiates-swap-without-any-slippage-checks-if-chainlink-oracle-fails-\">[M-07] FeeBurner initiates swap without any slippage checks if Chainlink oracle fails </a></li>\n<li><a href=\"#m-08-users-can-claim-extremely-large-rewards-or-lock-rewards-from-lpgauge-due-to-uninitialised-poollastupdate-variable\">[M-08] Users can claim extremely large rewards or lock rewards from LpGauge due to uninitialised <code>poolLastUpdate</code> variable</a></li>\n<li><a href=\"#m-09-bkdlocker-depositfees-can-be-blocked\">[M-09] BkdLocker depositFees can be blocked</a></li>\n<li><a href=\"#m-10-there-are-multiple-ways-for-adminsgovernance-to-rug-users\">[M-10] There are multiple ways for admins/governance to rug users</a></li>\n<li><a href=\"#m-11-usage-of-deprecated-transfer-to-send-eth\">[M-11] Usage of deprecated transfer to send ETH</a></li>\n<li><a href=\"#m-12-users-can-claim-more-fees-than-expected-if-governance-migrates-current-rewardtoken-again-by-fault\">[M-12] Users can claim more fees than expected if governance migrates current rewardToken again by fault.</a></li>\n<li><a href=\"#m-13-inconsistency-in-view-functions-can-lead-to-users-believing-theyre-due-for-more-bkd-rewards\">[M-13] Inconsistency in view functions can lead to users believing they’re due for more BKD rewards</a></li>\n<li><a href=\"#m-14-stakervaultunstake-stakervaultunstakefor-would-revert-with-a-uint-underflow-error-of-stakervaultstrategiestotalstaked-stakervault_pooltotalstaked\">[M-14] StakerVault.unstake(), StakerVault.unstakeFor() would revert with a uint underflow error of StakerVault.strategiesTotalStaked, StakerVault._poolTotalStaked.</a></li>\n<li><a href=\"#m-15-potential-dos-when-removing-keeper-gauge\">[M-15] Potential DoS when removing keeper gauge</a></li>\n<li><a href=\"#m-16-its-possible-to-initialize-contract-bkdlocker-for-multiple-times-by-sending-startboost0-and-each-time-different-values-for-other-parameters\">[M-16] it’s possible to initialize contract BkdLocker for multiple times by sending startBoost=0 and each time different values for other parameters</a></li>\n<li><a href=\"#m-17-strategy-in-stakervaultsol-can-steal-more-rewards-even-though-its-designed-strategies-shouldnt-get-rewards\">[M-17] Strategy in StakerVault.sol can steal more rewards even though it’s designed strategies shouldn’t get rewards.</a></li>\n<li><a href=\"#m-18-fees-from-delisted-pool-still-in-reward-handler-will-become-stuck-after-delisting\">[M-18] Fees from delisted pool still in reward handler will become stuck after delisting</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#low-risk-and-non-critical-issues\">Low Risk and Non-Critical Issues</a></p>\n<ul>\n<li><a href=\"#low-risk-issues\">Low Risk Issues</a></li>\n<li><a href=\"#l-01-migrate-still-does-transfers-when-the-transfer-is-to-the-same-pool-and-this-can-be-done-multiple-times\">L-01 <code>migrate()</code> still does transfers when the transfer is to the same pool, and this can be done multiple times</a></li>\n<li><a href=\"#l-02-non-exploitable-reentrancy\">L-02 Non-exploitable reentrancy</a></li>\n<li><a href=\"#l-03-users-can-dos-themselves-by-executing-prepareunlock0-many-times\">L-03 Users can DOS themselves by executing <code>prepareUnlock(0)</code> many times</a></li>\n<li><a href=\"#l-04-unusedempty-receivefallback-function\">L-04 Unused/empty <code>receive()</code>/<code>fallback()</code> function</a></li>\n<li><a href=\"#l-05-safeapprove-is-deprecated\">L-05 <code>safeApprove()</code> is deprecated</a></li>\n<li><a href=\"#l-06-missing-checks-for-address0x0-when-assigning-values-to-address-state-variables\">L-06 Missing checks for <code>address(0x0)</code> when assigning values to <code>address</code> state variables</a></li>\n<li><a href=\"#l-07-_preparedeadline-_setconfig-and-_executedeadline-should-be-private\">L-07 <code>_prepareDeadline()</code>, <code>_setConfig()</code>, and <code>_executeDeadline()</code> should be <code>private</code></a></li>\n<li><a href=\"#non-critical-issues\">Non-Critical Issues</a></li>\n<li><a href=\"#n-01-unneeded-import\">N-01 Unneeded import</a></li>\n<li><a href=\"#n-02-return-values-of-approve-not-checked\">N-02 Return values of <code>approve()</code> not checked</a></li>\n<li><a href=\"#n-03-large-multiples-of-ten-should-use-scientific-notation-eg-1e6-rather-than-decimal-literals-eg-1000000-for-readability\">N-03 Large multiples of ten should use scientific notation (e.g. <code>1e6</code>) rather than decimal literals (e.g. <code>1000000</code>), for readability</a></li>\n<li><a href=\"#n-04-missing-event-for-critical-parameter-change\">N-04 Missing event for critical parameter change</a></li>\n<li><a href=\"#n-05-use-a-more-recent-version-of-solidity\">N-05 Use a more recent version of solidity</a></li>\n<li><a href=\"#n-06-use-a-more-recent-version-of-solidity\">N-06 Use a more recent version of solidity</a></li>\n<li><a href=\"#n-07-constant-redefined-elsewhere\">N-07 Constant redefined elsewhere</a></li>\n<li><a href=\"#n-08-inconsistent-spacing-in-comments\">N-08 Inconsistent spacing in comments</a></li>\n<li><a href=\"#n-09-file-is-missing-natspec\">N-09 File is missing NatSpec</a></li>\n<li><a href=\"#n-10-natspec-is-incomplete\">N-10 NatSpec is incomplete</a></li>\n<li><a href=\"#n-11-event-is-missing-indexed-fields\">N-11 Event is missing <code>indexed</code> fields</a></li>\n<li><a href=\"#n-12-not-using-the-named-return-variables-anywhere-in-the-function-is-confusing\">N-12 Not using the named return variables anywhere in the function is confusing</a></li>\n<li><a href=\"#n-13-typos\">N-13 Typos</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#gas-optimizations\">Gas Optimizations</a></p>\n<ul>\n<li><a href=\"#1-multiple-address-mappings-can-be-combined-into-a-single-mapping-of-an-address-to-a-struct-where-appropriate\">1 Multiple <code>address</code> mappings can be combined into a single <code>mapping</code> of an <code>address</code> to a <code>struct</code>, where appropriate</a></li>\n<li><a href=\"#2-state-variables-only-set-in-the-constructor-should-be-declared-immutable\">2 State variables only set in the constructor should be declared <code>immutable</code></a></li>\n<li><a href=\"#3-state-variables-can-be-packed-into-fewer-storage-slots\">3 State variables can be packed into fewer storage slots</a></li>\n<li><a href=\"#4-state-variables-should-be-cached-in-stack-variables-rather-than-re-reading-them-from-storage\">4 State variables should be cached in stack variables rather than re-reading them from storage</a></li>\n<li><a href=\"#5-multiple-accesses-of-a-mappingarray-should-use-a-local-variable-cache\">5 Multiple accesses of a mapping/array should use a local variable cache</a></li>\n<li><a href=\"#6-the-result-of-external-function-calls-should-be-cached-rather-than-re-calling-the-function\">6 The result of external function calls should be cached rather than re-calling the function</a></li>\n<li><a href=\"#7-x--y-costs-more-gas-than-x--x--y-for-state-variables\">7 <code>&#x3C;x> += &#x3C;y></code> costs more gas than <code>&#x3C;x> = &#x3C;x> + &#x3C;y></code> for state variables</a></li>\n<li><a href=\"#8-internal-functions-only-called-once-can-be-inlined-to-save-gas\">8 <code>internal</code> functions only called once can be inlined to save gas</a></li>\n<li><a href=\"#9-add-unchecked--for-subtractions-where-the-operands-cannot-underflow-because-of-a-previous-require\">9 Add <code>unchecked {}</code> for subtractions where the operands cannot underflow because of a previous <code>require()</code></a></li>\n<li><a href=\"#10-arraylength-should-not-be-looked-up-in-every-loop-of-a-for-loop\">10 <code>&#x3C;array>.length</code> should not be looked up in every loop of a <code>for</code>-loop</a></li>\n<li><a href=\"#11-ii-should-be-uncheckediuncheckedi-when-it-is-not-possible-for-them-to-overflow-as-is-the-case-when-used-in-for--and-while-loops\">11 <code>++i</code>/<code>i++</code> should be <code>unchecked{++i}</code>/<code>unchecked{i++}</code> when it is not possible for them to overflow, as is the case when used in <code>for</code>- and <code>while</code>-loops</a></li>\n<li><a href=\"#12-requirerevert-strings-longer-than-32-bytes-cost-extra-gas\">12 <code>require()</code>/<code>revert()</code> strings longer than 32 bytes cost extra gas</a></li>\n<li><a href=\"#13-using-bools-for-storage-incurs-overhead\">13 Using <code>bool</code>s for storage incurs overhead</a></li>\n<li><a href=\"#14-using--0-costs-more-gas-than--0-when-used-on-a-uint-in-a-require-statement\">14 Using <code>> 0</code> costs more gas than <code>!= 0</code> when used on a <code>uint</code> in a <code>require()</code> statement</a></li>\n<li><a href=\"#15-usage-of-uintsints-smaller-than-32-bytes-256-bits-incurs-overhead\">15 Usage of <code>uints</code>/<code>ints</code> smaller than 32 bytes (256 bits) incurs overhead</a></li>\n<li><a href=\"#16-using-private-rather-than-public-for-constants-saves-gas\">16 Using <code>private</code> rather than <code>public</code> for constants, saves gas</a></li>\n<li><a href=\"#17-duplicated-requirerevert-checks-should-be-refactored-to-a-modifier-or-function\">17 Duplicated <code>require()</code>/<code>revert()</code> checks should be refactored to a modifier or function</a></li>\n<li><a href=\"#18-require-or-revert-statements-that-check-input-arguments-should-be-at-the-top-of-the-function\">18 <code>require()</code> or <code>revert()</code> statements that check input arguments should be at the top of the function</a></li>\n<li><a href=\"#19-empty-blocks-should-be-removed-or-emit-something\">19 Empty blocks should be removed or emit something</a></li>\n<li><a href=\"#20-use-custom-errors-rather-than-revertrequire-strings-to-save-deployment-gas\">20 Use custom errors rather than <code>revert()</code>/<code>require()</code> strings to save deployment gas</a></li>\n</ul>\n</li>\n<li><a href=\"#disclosures\">Disclosures</a></li>\n</ul>",
  "md": "\n# Overview\n\n## About C4\n\nCode4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.\n\nA C4 audit contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.\n\nDuring the audit contest outlined in this document, C4 conducted an analysis of the Backd Tokenomics smart contract system written in Solidity. The audit contest took place between May 27—June 3 2022.\n\n## Wardens\n\n66 Wardens contributed reports to the Backd Tokenomics contest:\n\n  1. [WatchPug](https://twitter.com/WatchPug_) ([jtp](https://github.com/jack-the-pug) and [ming](https://github.com/mingwatch))\n  1. scaraven\n  1. [Picodes](https://twitter.com/thePicodes)\n  1. 0x52\n  1. [hansfriese](https://twitter.com/hansfriese)\n  1. 0xNineDec\n  1. [csanuragjain](https://twitter.com/csanuragjain)\n  1. SmartSek (0xDjango and hake)\n  1. [fatherOfBlocks](https://twitter.com/father0fBl0cks)\n  1. IllIllI\n  1. [Ruhum](https://twitter.com/0xruhum)\n  1. [shenwilly](https://twitter.com/shenwilly_)\n  1. 0x1f8b\n  1. unforgiven\n  1. StyxRave\n  1. [JC](https://twitter.com/sm4rtcontr4ct)\n  1. peritoflores\n  1. BowTiedWardens (BowTiedHeron, BowTiedPickle, [m4rio_eth](BowTiedETHernal), [Dravee](https://twitter.com/JustDravee) and BowTiedFirefox)\n  1. [MiloTruck](https://milotruck.github.io/)\n  1. SecureZeroX\n  1. [berndartmueller](https://twitter.com/berndartmueller)\n  1. [defsec](https://twitter.com/defsec_)\n  1. cccz\n  1. sashik_eth\n  1. [c3phas](https://twitter.com/c3ph_)\n  1. [Chom](https://chom.dev)\n  1. 0x29A (0x4non and rotcivegaf)\n  1. [Funen](https://instagram.com/vanensurya)\n  1. [0xNazgul](https://twitter.com/0xNazgul)\n  1. [Sm4rty](https://twitter.com/Sm4rty_)\n  1. 0xf15ers (remora and twojoy)\n  1. asutorufos\n  1. delfin454000\n  1. [gzeon](https://twitter.com/gzeon)\n  1. hake\n  1. sach1r0\n  1. simon135\n  1. oyc_109\n  1. [catchup](https://twitter.com/catchup22)\n  1. Kaiziron\n  1. Waze\n  1. robee\n  1. cryptphi\n  1. dipp\n  1. codexploder\n  1. bardamu\n  1. masterchief\n  1. Kumpa\n  1. [hyh](https://twitter.com/0xhyh)\n  1. [0xKitsune](https://github.com/0xKitsune)\n  1. [Tadashi](https://github.com/htadashi)\n  1. [Dravee](https://twitter.com/JustDravee)\n  1. djxploit\n  1. [Tomio](https://twitter.com/meidhiwirara)\n  1. 0xkatana\n  1. [Fitraldys](https://twitter.com/fitraldys)\n  1. [Randyyy](https://twitter.com/randyyramadhan)\n  1. RoiEvenHaim\n\nThis contest was judged by [Alex the Entreprenerd](https://twitter.com/GalloDaSballo).\n\nFinal report assembled by [itsmetechjay](https://twitter.com/itsmetechjay).\n\n# Summary\n\nThe C4 analysis yielded an aggregated total of 20 unique vulnerabilities. Of these vulnerabilities, 2 received a risk rating in the category of HIGH severity and 18 received a risk rating in the category of MEDIUM severity.\n\nAdditionally, C4 analysis included 42 reports detailing issues with a risk rating of LOW severity or non-critical. There were also 41 reports recommending gas optimizations.\n\nAll of the issues presented here are linked back to their original finding.\n\n# Scope\n\nThe code under review can be found within the [C4 Backd Tokenomics contest repository](https://github.com/code-423n4/2022-05-backd), and is composed of 22 smart contracts written in the Solidity programming language and includes 2,507 lines of Solidity code.\n\n# Severity Criteria\n\nC4 assesses the severity of disclosed vulnerabilities according to a methodology based on [OWASP standards](https://owasp.org/www-community/OWASP_Risk_Rating_Methodology).\n\nVulnerabilities are divided into three primary risk categories: high, medium, and low/non-critical.\n\nHigh-level considerations for vulnerabilities span the following key areas when conducting assessments:\n\n- Malicious Input Handling\n- Escalation of privileges\n- Arithmetic\n- Gas use\n\nFurther information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on [the C4 website](https://code4rena.com).\n\n# High Risk Findings (2)\n## [[H-01] `Minter.sol#startInflation()` can be bypassed.](https://github.com/code-423n4/2022-05-backd-findings/issues/99)\n_Submitted by WatchPug, also found by 0x52_\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L104-L108>\n\n```solidity\n    function startInflation() external override onlyGovernance {\n        require(lastEvent == 0, \"Inflation has already started.\");\n        lastEvent = block.timestamp;\n        lastInflationDecay = block.timestamp;\n    }\n```\n\nAs `lastEvent` and `lastInflationDecay` are not initialized in the `constructor()`, they will remain to the default value of `0`.\n\nHowever, the permissionless `executeInflationRateUpdate()` method does not check the value of `lastEvent` and `lastInflationDecay` and used them directly.\n\nAs a result, if `executeInflationRateUpdate()` is called before `startInflation()`:\n\n1.  L190, the check of if `_INFLATION_DECAY_PERIOD` has passed since `lastInflationDecay` will be `true`, and `initialPeriodEnded` will be set to `true` right away;\n2.  L188, since the `lastEvent` in `totalAvailableToNow += (currentTotalInflation * (block.timestamp - lastEvent));` is `0`, the `totalAvailableToNow` will be set to `totalAvailableToNow ≈ currentTotalInflation * 52 years`, which renders the constrains of `totalAvailableToNow` incorrect and useless.\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L115-L117>\n\n```solidity\n    function executeInflationRateUpdate() external override returns (bool) {\n        return _executeInflationRateUpdate();\n    }\n```\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L187-L215>\n\n```solidity\n    function _executeInflationRateUpdate() internal returns (bool) {\n        totalAvailableToNow += (currentTotalInflation * (block.timestamp - lastEvent));\n        lastEvent = block.timestamp;\n        if (block.timestamp >= lastInflationDecay + _INFLATION_DECAY_PERIOD) {\n            currentInflationAmountLp = currentInflationAmountLp.scaledMul(annualInflationDecayLp);\n            if (initialPeriodEnded) {\n                currentInflationAmountKeeper = currentInflationAmountKeeper.scaledMul(\n                    annualInflationDecayKeeper\n                );\n                currentInflationAmountAmm = currentInflationAmountAmm.scaledMul(\n                    annualInflationDecayAmm\n                );\n            } else {\n                currentInflationAmountKeeper =\n                    initialAnnualInflationRateKeeper /\n                    _INFLATION_DECAY_PERIOD;\n\n                currentInflationAmountAmm = initialAnnualInflationRateAmm / _INFLATION_DECAY_PERIOD;\n                initialPeriodEnded = true;\n            }\n            currentTotalInflation =\n                currentInflationAmountLp +\n                currentInflationAmountKeeper +\n                currentInflationAmountAmm;\n            controller.inflationManager().checkpointAllGauges();\n            lastInflationDecay = block.timestamp;\n        }\n        return true;\n    }\n```\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L50-L51>\n\n```solidity\n    // Used for final safety check to ensure inflation is not exceeded\n    uint256 public totalAvailableToNow;\n```\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L217-L227>\n\n```solidity\n    function _mint(address beneficiary, uint256 amount) internal returns (bool) {\n        totalAvailableToNow += ((block.timestamp - lastEvent) * currentTotalInflation);\n        uint256 newTotalMintedToNow = totalMintedToNow + amount;\n        require(newTotalMintedToNow <= totalAvailableToNow, \"Mintable amount exceeded\");\n        totalMintedToNow = newTotalMintedToNow;\n        lastEvent = block.timestamp;\n        token.mint(beneficiary, amount);\n        _executeInflationRateUpdate();\n        emit TokensMinted(beneficiary, amount);\n        return true;\n    }\n```\n\n### Recommendation\n\nConsider initializing `lastEvent`, `lastInflationDecay` in `constructor()`.\n\nor\n\nConsider adding `require(lastEvent != 0 && lastInflationDecay != 0, \"...\")` to `executeInflationRateUpdate()`.\n\n**[danhper (Backd) confirmed](https://github.com/code-423n4/2022-05-backd-findings/issues/99)** \n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/99#issuecomment-1159582144):**\n > The warden has shown how `startInflation` can be bypassed, breaking the Access Control as well as the Sponsor Goal for Emissions.\n> \n> Because of this I believe High Severity to be appropriate.\n> \n> The sponsor has mitigated in a subsequent PR\n\n\n\n***\n\n## [[H-02] Total Supply is not guaranteed and is not deterministic.](https://github.com/code-423n4/2022-05-backd-findings/issues/46)\n_Submitted by Picodes, also found by scaraven_\n\nThe actual total supply of the token is random and depends on when `_executeInflationRateUpdate` is executed.\n\n### Proof of Concept\n\nThe `README` and tokenomic documentation clearly states that “The token supply is limited to a total of 268435456 tokens.” However when executing [`_executeInflationRateUpdate`](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/tokenomics/Minter.sol#L181), it first uses the current inflation rate to update the total available before checking if it needs to be reduced.\n\nTherefore if no one mints or calls `executeInflationRateUpdate` for some time around the decay point, the inflation will be updated using the previous rate so the  `totalAvailableToNow` will grow too much.\n\n### Mitigation Steps\n\nYou should do\n\n```js\ntotalAvailableToNow += (currentTotalInflation * (block.timestamp - lastEvent));\n```\n\nOnly if the condition `block.timestamp >= lastInflationDecay + _INFLATION_DECAY_PERIOD` is false.\n\nOtherwise you should do\n\n```js\ntotalAvailableToNow += (currentTotalInflation * (lastInflationDecay + _INFLATION_DECAY_PERIOD - lastEvent));\n```\n\nThen update the rates, then complete with\n\n```js\ntotalAvailableToNow += (currentTotalInflation * (block.timestamp - lastInflationDecay + _INFLATION_DECAY_PERIOD));\n```\n\nNote that as all these variables are either constants either already loaded in memory this is super cheap to do.\n\n**[danhper (Backd) confirmed, but disagreed with severity and commented](https://github.com/code-423n4/2022-05-backd-findings/issues/46#issuecomment-1147565918):**\n > I believe this should actually be high severity\n\n**[Alex the Entreprenerd (judge) increased severity to High and commented](https://github.com/code-423n4/2022-05-backd-findings/issues/46#issuecomment-1159775172):**\n > The warden has identified the lack of an upper bound on the inflation math which would make it so that more than the expected supply cap of the token could be minted.\n> \n> The sponsor agrees that this should be of High Severity.\n> \n> Because this breaks the protocol stated invariant of a specific cap of `268435456` tokens, I agree with High Severity.\n\n\n\n***\n\n \n# Medium Risk Findings (18)\n## [[M-01] DoS on KeeperGauge due to division by zero](https://github.com/code-423n4/2022-05-backd-findings/issues/35)\n_Submitted by fatherOfBlocks_\n\nIn the **\\_calcTotalClaimable()** function it should be validated that perPeriodTotalFees\\[i] != 0 since otherwise it would generate a DoS in **claimableRewards()** and **claimRewards()**.<br>\nThis would be possible since if **advanceEpoch()** or **kill()** is executed by the InflationManager address, the epoch will go up without perPeriodTotalFees\\[newIndexEpoch] is 0.<br>\nThe negative of this is that every time the **InflationManager** executes these two methods (**kill() and advanceEpoch()**) DoS is generated until you run **reportFees()**.<br>\nAnother possible case is that **kill()** or **advanceEpoch()** are executed 2 times in a row and there is no way of a perPeriodTotalFees\\[epoch-1] updating its value, therefore it would be an irreversible DoS.<br>\n\n### Recommended Mitigation Steps\n\nGenerate a behavior for the case that perPeriodTotalFees\\[i] == 0.\n\n**[samwerner (Backd) confirmed, but disagreed with severity](https://github.com/code-423n4/2022-05-backd-findings/issues/35)** \n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/35#issuecomment-1159318667):**\n > The finding at face value is valid and it's impact is a DOS.\n> \n> A division by zero in `keeperRecords[beneficiary].feesInPeriod[i].scaledDiv(perPeriodTotalFees[i])`, will cause an instantaneous revert making it impossible to claim fees.\n> \n> After more reading I believe that the finding is valid and can cause issues if there's one epoch without fees, if for any reason the protocol skips one epoch via `advanceEpoch`, while no [`perPeriodTotalFees`](https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L88) are increased, then, because [`keeperRecords[beneficiary].nextEpochToClaim`](https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L136`) will include the empty epoch, the `beneficiary` will not be able to receive fees.\n> \n> Given that setup is necessary for this to happen, I believe Medium Severity to be more appropriate.\n\n\n\n***\n\n## [[M-02] The first AMM Staker will have control over how the shares are calculated.](https://github.com/code-423n4/2022-05-backd-findings/issues/100)\n_Submitted by 0xNineDec_\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L147>\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L154>\n\n### Impact\n\nThe first staker can take control of how the subsequent shares are going to be distributed by simply staking 1wei amount of the token and frontrunning future stakers. The reasons of this are related on how the variables are updated and with the amounts that the Gauge allows users to stake (anything but zero). The origin of this vulnerability relies on the evaluation of the `totalStaked` variable on its inception.\n\n### Proof of Concept\n\nTo illustrate this attack, an environment of testing was made in order to track the token flows and how the variables are being updated and read.\n\nThe initial or border conditions taken into account are the same as the ones used by the team to perform the tests and just a few assumptions and simplifications were taken.\n\n1.  The inflation rate is fixed for simplicity (`0.001`). This is valid within a short period of time because it is not a function of how the tokens are distributed or their flows. By tracking how the inflation rate is calculated an updated, we see that it is managed by the `currentInflationAmountAmm` within the [`Minter.sol` contract](https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L184), which value is modified by `_executeInflationRateUpdate()` three lines below the last code permalink. Its value depends on non-token balance related parameters (such as inflation decays and annual rates).\n2.  For the testing environment performed by the team, a DummyERC20 was used as testing token. The same is done on the exploit environment.\n3.  The controller is not used because it is used to retrieve the inflation rate and it is now fixed because of 1).\n\nEach user state is updated whenever he calls either `stake`, `unstake` or `claimRewards`.\n\nSteps:\n\n*   Alice is the first staker and deposits 1wei worth of DummyERC20.\n*   Bob takes one day to find out this new protocol and decides to stake 10 ETH amount of tokens (`10 * 10**decimals()`).\n*   Alice, who was scanning the mempool, frontruns Bob with the same amount he was willing to stake. Her txn is mined first.\n*   Then Bobs' transaction is mined for the 10 ETH worth.\n*   Sometime after this, the pool is checkpointed.\n*   A few days pass, and Bob wants to stake even more tokens. The same amount as before.\n*   Alice frontruns him again updating her shares.\n*   Bobs' transaction is mined and his shares are also updated.\n*   The pool is checkpointed again. And Alice managed to increase considerably her amount of shares.\n\nBoth cases were evaluated (with and without staking 1 wei first). The attack scenario outputs a 100% more shares to Alice than Bob in comparison with the ethical/non-attack situation.\n\nThe code used to perform this test is the following:\n\n    it(\"First Depositer Exploit\", async function () {\n            let userShares = []\n            let userIntegral = []\n            let userBalance = []\n\n            let globalIntegral, totalStaked;\n            let aliceBob = [alice, bob];\n\n            // Starting Checkpoint\n            await this.ammgauge.poolCheckpoint();\n            await ethers.provider.send(\"evm_increaseTime\", [1 * 24 * 60 * 60]); // 10 days\n            \n            const updateStates = async () => { \n                userShares = []\n                userIntegral = []\n                userBalance = []\n                for (const user of aliceBob) {\n                    let balances = ethers.utils.formatEther(await this.ammgauge.balances(user.address));\n                    let currentShare = ethers.utils.formatEther(await this.ammgauge.perUserShare(user.address));\n                    let currentStakedIntegral = ethers.utils.formatEther(await this.ammgauge.perUserStakedIntegral(user.address));\n                    userShares.push(currentShare);\n                    userIntegral.push(currentStakedIntegral);\n                    userBalance.push(balances);\n                }\n                globalIntegral = await this.ammgauge.ammStakedIntegral()\n                totalStaked = await this.ammgauge.totalStaked()\n                console.log(\"  \")\n                console.log(\"         ALICE / BOB\");\n                console.log(`Shares: ${userShares}`);\n                console.log(`Integr: ${userIntegral}`);\n                console.log(`Balanc: ${userBalance}`);\n                console.log(\"  \")\n                console.log(\"Global\")\n                console.log(`Integral: ${ethers.utils.formatEther(globalIntegral)}, TotalStaked: ${ethers.utils.formatEther(totalStaked)}`)\n            }\n\n            const stake = async (to, amount) => {\n                await updateStates()\n                console.log(\" \")\n                // Balance before\n                let balanceBefore = await this.ammgauge.balances(to.address);\n                // Stake\n                await this.ammgauge.connect(to).stake(amount);\n                expect(await this.ammgauge.balances(to.address)).to.be.eq(balanceBefore.add(amount));\n                // await updateStates();\n                console.log(\" \")\n            }\n\n            const unstake = async (to, amount) => {\n                await updateStates()\n                console.log(\" \")\n                // Balance before\n                let balanceBefore = await this.ammgauge.balances(to.address);\n                // Stake\n                await this.ammgauge.connect(to).unstake(amount);\n                expect(await this.ammgauge.balances(to.address)).to.be.eq(balanceBefore.sub(amount));\n                await updateStates();\n                console.log(\" \")\n            }\n\n            // HERE IS WHERE THE SIMULATION IS PERFORMED\n            let simulationTimes = 2;\n            let withOneWeiDeposit = true;\n\n            if (withOneWeiDeposit) {\n                // Alice deposits first\n                console.log(\"Alice Deposits 1wei\")\n                let firstUserDeposit = ethers.utils.parseEther(\"1\");\n                await stake(alice, 1);\n            }\n\n            for (let index = 1; index <= simulationTimes; index++) {\n                console.log(\" \")\n                console.log(`Loop number ${index}`);\n                console.log(\" \")\n\n                console.log(\"A day passes until Bob decides to deposit\")\n                await ethers.provider.send(\"evm_increaseTime\", [1 * 24 * 60 * 60]); // 1 days\n\n                console.log(\" \")\n                console.log(\"She scans that Bob is about to stake 10. So decides to frontrun him.\")\n                console.log(\"Alice Frontruns\")\n                let frontrunAmount = ethers.utils.parseEther(\"10\");\n                await stake(alice, frontrunAmount);\n\n                console.log(\" \")\n                console.log(\"Bob stakes 10 tokens\")\n                await stake(bob, frontrunAmount)\n\n                // A few days pass\n                await ethers.provider.send(\"evm_increaseTime\", [1 * 24 * 60 * 60]); // 2 days\n                // The pool is checkpointed\n                await this.ammgauge.poolCheckpoint();\n                console.log(\"After 1 day the pool is checkpointed\")\n                await updateStates()\n\n            }\n        })\n\nThe simulation was both made for the attacked and non attacked situations.\nThe values that are shown represent how the contract updates them (the `totalStaked` variable is 0 when first Alice calls the stake function after `_userCheckpoint()` rans)\n\n#### WITH 1WEI STAKE (ATTACK)\n\n| time |                Situation               |  totalStaked  | Alice Shares | Bob Shares |\n| :--: | :------------------------------------: | :-----------: | :----------: | :--------: |\n|  0-  |          First poolCheckpoint          |       0       |       0      |      0     |\n|  0+  |           Alice Deposits 1wei          |       0       |       0      |      0     |\n|   1  |       Alice frontruns Bob @ 10eth      |      1wei     |       0      |      0     |\n|   2  |         Bob 10eth txn is mined         |  10eth + 1wei |     86.4     |      0     |\n|   3  | 1 day later poolCheckpoint() is called | 20eth + 1 wei |     86.4     |      0     |\n|   4  |        Alice frontruns Bob again       | 20eth + 1 wei |     86.4     |      0     |\n|   5  |         Bob 10eth txn is mined         |  30eth + 1wei |     172.8    |      0     |\n|   6  | 1 day later poolCheckpoint() is called |  40eth + 1wei |     172.8    |    86.4    |\n\n#### WITHOUT THE 1WEI STAKE (No \"first staker hijack\")\n\n| time |                Situation               | totalStaked | Alice Shares | Bob Shares |\n| :--: | :------------------------------------: | :---------: | :----------: | :--------: |\n|  0-  |          First poolCheckpoint          |      0      |       0      |      0     |\n|  0+  |           Alice stakes 10eth           |      0      |       0      |      0     |\n|   1  |            Bob stakes 10eth            |    10eth    |       0      |      0     |\n|   2  | 1 day later poolCheckpoint() is called |    20eth    |       0      |      0     |\n|   3  |           Alice stakes 10eth           |    20eth    |       0      |      0     |\n|   4  |            Bob stakes 10eth            |    30eth    |     86.4     |      0     |\n|   5  | 1 day later poolCheckpoint() is called |    40eth    |     86.4     |    86.4    |\n\n### Recommended Mitigation Steps\n\nFurther evaluation on how the variables are updated and how does the `Integral` (both each users and global one) is calculated on the pool inception is needed to patch this issue.\n\n**[danhper (Backd) confirmed, but disagreed with severity](https://github.com/code-423n4/2022-05-backd-findings/issues/100)** \n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-05-backd-findings/issues/100#issuecomment-1159746279):**\n > The warden has identified a way for the `rewardsShares` to be improperly assigned.\n> \n> The exploit is based on the fact that if `totalStaked` is zero we effectively will skip the first loop of points.\n> \n> This can create situations where certain users are rewarded unfairly in comparison to their initial deposit.\n> \n> However, this only applies when we go from zero to non-zero for `totalStaked` henced the scenario proposed by the warden (1 day of free rewards for first depositor) is actually the worst case scenario.\n> \n> Having the deployer do 2 or 3 initial deposits should mitigate this attack, which ultimately is limited to a leak of value to the first user depositing.\n> \n> For those reasons, I believe the finding to be valid and of Medium Severity.\n\n\n\n***\n\n## [[M-03] THE first AMM Staker may not receive according rewards because of poor checkpoints](https://github.com/code-423n4/2022-05-backd-findings/issues/111)\n_Submitted by 0xNineDec_\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L56>\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L140>\n\n### Impact\n\nThe first staker within the `AmmGauge` may not get the rewards if the pool is not checkpointed right after he stakes and before he wants to claim the rewards.\n\n### Proof of Concept\n\nA testing environment that reproduces how the protocol is going to be deployed and managed is used to evaluate this case under the following assumptions and simplifications.\n\n1.  The inflation rate is fixed for simplicity (`0.001`).\n2.  For the testing environment performed by the team, a DummyERC20 was used as testing token. The same is done on the exploit environment.\n3.  The minting of tokens impact both on the inflation calculation and their balance. But this test evaluates the states just before minting (claimable balances). Following how the pools are updated, they are checkpointed in the end of the `_executeInflationRateUpdate` call. Not while staking.\n\nIn order to illustrate this scenario we will show both the vulnerable and non vulnerable situations.\n\nVulnerable Situation:\n\n1.  Alice, Bob, Charlie and David are future users of the pool. They all notice the inception of this project and decide to stake.\n2.  They all stake the same amount. Their transactions are mined with 1min of difference starting from Alice and finishing with David.\n3.  There is no external pool checkpoint between Alice and Bob (besides the one that is triggered when Bob stakes).\n4.  Sometime happens and they all want to check their accumulated reward balance. Alice accumulated much less than the others.\n\nNon Vulnerable Situation:\n\n*   The same as before but calling externally `_poolCheckpoint()` between Alice stake call and Bobs' and before checking the accumulated rewards.\n\nThe code to show this has a `secureCheckpoints` toggle that can be set as true or false to trigger (or not) the intermediate poolCheckpoints.\n\n        it('First Staker Rewards Calculation', async function () { \n            \n            let secureCheckpoints = false;\n            let currentShare, currentStakedIntegral, balances;\n            await this.ammgauge.poolCheckpoint();\n            await ethers.provider.send(\"evm_increaseTime\", [1 * 24 * 60 * 60]); // 10 days\n            \n            const updateStates = async (from) => { \n                currentShare = await this.ammgauge.perUserShare(from.address);\n                currentStakedIntegral = await this.ammgauge.perUserStakedIntegral(from.address);\n                balances = await this.ammgauge.balances(from.address);\n            }\n\n            const stake = async (to, amount) => {\n                await updateStates(to)\n                console.log(\" \")\n                // Balance before\n                let balanceBefore = await this.ammgauge.balances(to.address);\n                // Stake\n                await this.ammgauge.connect(to).stake(amount);\n                expect(await this.ammgauge.balances(to.address)).to.be.eq(balanceBefore.add(amount));\n                await updateStates(to);\n                console.log(\" \")\n            }\n\n            const unstake = async (to, amount) => {\n                await updateStates(to)\n                console.log(\" \")\n                // Balance before\n                let balanceBefore = await this.ammgauge.balances(to.address);\n                // Stake\n                await this.ammgauge.connect(to).unstake(amount);\n                expect(await this.ammgauge.balances(to.address)).to.be.eq(balanceBefore.sub(amount));\n                await updateStates(to);\n                console.log(\" \")\n            }\n\n            // Each user stakes tokens\n            let initialStaking = ethers.utils.parseEther(\"10\")\n            console.log(\" \")\n            console.log(\"USERS STAKE\");\n            for (const user of users) {\n            await stake(user, initialStaking)\n            if(secureCheckpoints){await this.ammgauge.poolCheckpoint()};\n            await ethers.provider.send(\"evm_increaseTime\", [60 * 60]); // 1hr between stakes\n            }\n            console.log(\" \")\n\n            await ethers.provider.send(\"evm_increaseTime\", [ 5 * 24 * 60 * 60]); // 5 days\n            if(secureCheckpoints){await this.ammgauge.poolCheckpoint()};\n\n            let claimableRewards = [];\n            let claimedRewards = [];\n            console.log(\" \")\n            console.log(\"USERS CLAIMABLE REWARDS AFTER 5 days\");\n            console.log(\" \")\n            for (const user of users) {\n                let stepClaimable = await this.ammgauge.claimableRewards(user.address);\n                claimableRewards.push(ethers.utils.formatEther(stepClaimable))\n\n                let rewardsClaim = await (await this.ammgauge.claimRewards(user.address)).wait()\n                claimedRewards.push(ethers.utils.formatEther(rewardsClaim.logs[0][\"data\"]))\n            }\n\n            console.log(\"Claimable calculated\")\n            console.log(\"   ALICE - BOB -  CHARLIE - DAVID\")\n            console.log(claimableRewards)\n\n            console.log(\" \")\n            console.log(\"Effectively Claimed\")\n            console.log(\"   ALICE - BOB -  CHARLIE - DAVID\")\n            console.log(claimableRewards)\n        })\n\nThe outputs for both cases are shown on the following chart. The initial staking amount is 10eth amount of the DummyERC20 token.\n\n|         | Without Checkpoints | With Checkpoints |\n| :-----: | :-----------------: | :--------------: |\n|  Alice  |         6.6         |       115.5      |\n|   Bob   |        111.9        |       111.9      |\n| Charlie |        110.1        |       110.1      |\n|  David  |        108.9        |       108.9      |\n\n### Recommended Mitigation Steps\n\n*   Check how is calculated the staking variables while the pool has no tokens staked and also how the updates and checkpoints are performed.\n\n**[chase-manning (Backd) confirmed, but disagreed with severity and commented](https://github.com/code-423n4/2022-05-backd-findings/issues/111#issuecomment-1148642951):**\n > This can only impact one user and only in an edge case so should be Medium severity.\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-05-backd-findings/issues/111#issuecomment-1159748160):**\n > The warden has shown how the first depositor may end up not getting the correct amount of points due to how zero is handled in `poolCheckpoint`\n> \n> Am not fully confident this should be kept separate from [M-02](https://github.com/code-423n4/2022-05-backd-findings/issues/100).\n> \n> However at this time, I believe the finding to be of Medium Severity.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/111#issuecomment-1172523467):**\n > At this time, while the underlying solution may be the same, I believe this finding and [M-02](https://github.com/code-423n4/2022-05-backd-findings/issues/100) to be distinct.\n\n\n\n***\n\n## [[M-04] Amount distributed can be inaccurate when updating weights ](https://github.com/code-423n4/2022-05-backd-findings/issues/47)\n_Submitted by Picodes_\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L220>\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/tokenomics/InflationManager.sol#L559>\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/tokenomics/InflationManager.sol#L572>\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/tokenomics/InflationManager.sol#L586>\n\n### Impact\n\nWhen updating pool inflation rates, other pools see their `currentRate` being modified without having `poolCheckpoint` called, which leads to false computations.\n\nThis will lead to either users losing a part of their claims, but can also lead to too many tokens could be distributed, preventing some users from claiming due to the `totalAvailableToNow` requirement in `Minter`.\n\n### Proof of Concept\n\nImagine you have 2 AMM pools A and B, both with an `ammPoolWeight` of 100, where `poolCheckpoint` has not been called for a moment. Then, imagine calling [`executeAmmTokenWeight`](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/tokenomics/InflationManager.sol#L318) to reduce the weight of A to 0.\n\nOnly A is checkpointed [here](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/tokenomics/InflationManager.sol#L591), so when B will be checkpointed it will call `getAmmRateForToken`, which will see a pool weight of 100 and a total weight of 100 over the whole period since the last checkpoint of B, which is false, therefore it will distribute too many tokens. This is critical has the minter expects an exact or lower than expected distribution due to the requirement of `totalAvailableToNow`.\n\nIn the opposite direction, when increasing weights, it will lead to less tokens being distributed in some pools than planned, leading to a loss for users.\n\n### Mitigation Steps\n\nCheckpoint every `LpStakerVault`, `KeeperGauge` or `AmmGauge` when updating the weights of one of them.\n\n**[chase-manning (Backd) confirmed, but disagreed with severity and commented](https://github.com/code-423n4/2022-05-backd-findings/issues/47#issuecomment-1148656219):**\n > We think this should be Medium as impact is quite minor.\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-05-backd-findings/issues/47#issuecomment-1159759010):**\n > Because [`getAmmRateForToken `](`https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/tokenomics/InflationManager.sol#L518`) uses the `totalAmmTokenWeight`, then all Gauges will need to be `poolCheckpoint`ed at the time the weight is changed-\n> \n> This is because for systems that accrue points over time, any time the multiplier changes, the growth of points has changed, and as such a new accrual needs to be performed.\n> \n> I believe there are 3 ways to judge this finding:\n> - It's Medium as the Admin is using their privilege to change the points, potentially to their favour or to someones detriment.\n> - It's High because the math is wrong and the code fails (by a way of lack of approximation) to properly allocate the resources.\n> - It's Medium because while the finding is correct in a vacuum, anyone can call `poolCheckpoint`, as such if a true concern for fairness is made, anyone can front-run and back-run the update of weights with the goal of offering the most accurate math possible.\n> \n> Given those considerations, I want to emphasize that not calling `poolCheckpoint` can cause potentially drastic leaks of value, in a way similar to the original Sushi MasterChef's lack of `massUpdatePools` could.\n> \n> That said, I believe the finding is of medium severity as any individual could setup a bot to monitor and prevent this and it would require the weights to be changed by governance and impact can be quite minor as long as the pools are used.\n\n\n\n***\n\n## [[M-05] `BkdLocker#depositFees()` can be front run to steal the newly added rewardToken](https://github.com/code-423n4/2022-05-backd-findings/issues/95)\n_Submitted by WatchPug_\n\nEvery time the `BkdLocker#depositFees()` gets called, there will be a surge of rewards per locked token for the existing stakeholders.\n\nThis enables a well-known attack vector, in which the attacker will take a large portion of the shares before the surge, then claim the rewards and exit immediately.\n\nWhile the `_WITHDRAW_DELAY` can be set longer to mitigate this issue in the current implementation, it is possible for the admin to configure it to a very short period of time or even `0`.\n\nIn which case, the attack will be very practical and effectively steal the major part of the newly added rewards.\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L90-L100>\n\n```solidity\nfunction depositFees(uint256 amount) external override {\n    require(amount > 0, Error.INVALID_AMOUNT);\n    require(totalLockedBoosted > 0, Error.NOT_ENOUGH_FUNDS);\n    IERC20(rewardToken).safeTransferFrom(msg.sender, address(this), amount);\n\n    RewardTokenData storage curRewardTokenData = rewardTokenData[rewardToken];\n\n    curRewardTokenData.feeIntegral += amount.scaledDiv(totalLockedBoosted);\n    curRewardTokenData.feeBalance += amount;\n    emit FeesDeposited(amount);\n}\n```\n\n### Proof of Concept\n\nGiven:\n\n*   Current `totalLockedBoosted()` is `100,000 govToken`;\n*   Pending distribution fees amount is `1,000 rewardToken`;\n\n1.  `depositFees()` is called to add `1,000 rewardToken`;\n2.  The attacker frontrun the 1st transaction with a `lock()` transaction to deposit `100,000 govToken`, taking 50% of the pool;\n3.  After the transaction in step 1 is mined, the attacker calls `claimFees()` and received `500 rewardToken`.\n\nAs a result, the attacker has stolen half of the pending fees which belong to the old users.\n\n### Recommendation\n\nConsider switching the reward to a `rewardRate`-based gradual release model, such as Synthetix's StakingRewards contract.\n\nSee: <https://github.com/Synthetixio/synthetix/blob/develop/contracts/StakingRewards.sol#L113-L132>\n\n**[chase-manning (Backd) disputed and commented](https://github.com/code-423n4/2022-05-backd-findings/issues/95#issuecomment-1147355483):**\n > The withdrawal delay prevents this attack.\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-05-backd-findings/issues/95#issuecomment-1159760706):**\n > Given the need for:\n> - Withdrawal delay set to 0 or small\n> - Need for front-running which causes leak of value\n> \n> I believe High Severity to be out of the question.\n> \n> That said, because the rewards are given out at the time of `depositFees`, and they are not linearly vested, I do believe that a front-run MEV attack can be executed, being able to immediately claim the reward tokens, at the cost / risk of having to lock the tokens.\n> \n> The shorter the withdrawal delay, the lower the risk for the attack..\n> \n> Because this is contingent on configuration, and at best it's a loss of yield for the lockers, I believe Medium Severity to be more appropriat.\n\n> As an additional note, please consider the fact that if the potential value gained is high enough, an attacker could just hedge the risk of locking by shorting the tokens, effectively being delta neutral while using the rewards for profit.\n> \n> This means that if your token becomes liquid enough (a goal for any protocol), you would expect the withdrawal delay to become ineffective as hedging options become available.\n> \n> Forcing the rewards to linearly vest will prevent the front-run from being effective and will reward long term lockers.\n\n\n\n***\n\n## [[M-06] `Minter.sol#_executeInflationRateUpdate()` `inflationManager().checkpointAllGauges()` is called after InflationRate is updated, causing users to lose rewards](https://github.com/code-423n4/2022-05-backd-findings/issues/98)\n_Submitted by WatchPug_\n\nWhen `Minter.sol#_executeInflationRateUpdate()` is called, if an `_INFLATION_DECAY_PERIOD` has past since `lastInflationDecay`, it will update the InflationRate for all of the gauges.\n\nHowever, in the current implementation, the rates will be updated first, followed by the rewards being settled using the new rates on the gauges using `inflationManager().checkpointAllGauges()`.\n\nIf the `_INFLATION_DECAY_PERIOD` has passed for a long time before `Minter.sol#executeInflationRateUpdate()` is called, the users may lose a significant amount of rewards.\n\nOn a side note, `totalAvailableToNow` is updated correctly.\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L187-L215>\n\n```solidity\nfunction _executeInflationRateUpdate() internal returns (bool) {\n    totalAvailableToNow += (currentTotalInflation * (block.timestamp - lastEvent));\n    lastEvent = block.timestamp;\n    if (block.timestamp >= lastInflationDecay + _INFLATION_DECAY_PERIOD) {\n        currentInflationAmountLp = currentInflationAmountLp.scaledMul(annualInflationDecayLp);\n        if (initialPeriodEnded) {\n            currentInflationAmountKeeper = currentInflationAmountKeeper.scaledMul(\n                annualInflationDecayKeeper\n            );\n            currentInflationAmountAmm = currentInflationAmountAmm.scaledMul(\n                annualInflationDecayAmm\n            );\n        } else {\n            currentInflationAmountKeeper =\n                initialAnnualInflationRateKeeper /\n                _INFLATION_DECAY_PERIOD;\n\n            currentInflationAmountAmm = initialAnnualInflationRateAmm / _INFLATION_DECAY_PERIOD;\n            initialPeriodEnded = true;\n        }\n        currentTotalInflation =\n            currentInflationAmountLp +\n            currentInflationAmountKeeper +\n            currentInflationAmountAmm;\n        controller.inflationManager().checkpointAllGauges();\n        lastInflationDecay = block.timestamp;\n    }\n    return true;\n}\n```\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L110-L125>\n\n```solidity\nfunction checkpointAllGauges() external override returns (bool) {\n    uint256 length = _keeperGauges.length();\n    for (uint256 i; i < length; i = i.uncheckedInc()) {\n        IKeeperGauge(_keeperGauges.valueAt(i)).poolCheckpoint();\n    }\n    address[] memory stakerVaults = addressProvider.allStakerVaults();\n    for (uint256 i; i < stakerVaults.length; i = i.uncheckedInc()) {\n        IStakerVault(stakerVaults[i]).poolCheckpoint();\n    }\n\n    length = _ammGauges.length();\n    for (uint256 i; i < length; i = i.uncheckedInc()) {\n        IAmmGauge(_ammGauges.valueAt(i)).poolCheckpoint();\n    }\n    return true;\n}\n```\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L110-L117>\n\n```solidity\nfunction poolCheckpoint() public override returns (bool) {\n    if (killed) return false;\n    uint256 timeElapsed = block.timestamp - uint256(lastUpdated);\n    uint256 currentRate = IController(controller).inflationManager().getKeeperRateForPool(pool);\n    perPeriodTotalInflation[epoch] += currentRate * timeElapsed;\n    lastUpdated = uint48(block.timestamp);\n    return true;\n}\n```\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L507-L519>\n\n```solidity\nfunction getKeeperRateForPool(address pool) external view override returns (uint256) {\n    if (minter == address(0)) {\n        return 0;\n    }\n    uint256 keeperInflationRate = Minter(minter).getKeeperInflationRate();\n    // After deactivation of weight based dist, KeeperGauge handles the splitting\n    if (weightBasedKeeperDistributionDeactivated) return keeperInflationRate;\n    if (totalKeeperPoolWeight == 0) return 0;\n    bytes32 key = _getKeeperGaugeKey(pool);\n    uint256 poolInflationRate = (currentUInts256[key] * keeperInflationRate) /\n        totalKeeperPoolWeight;\n    return poolInflationRate;\n}\n```\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L173-L176>\n\n```solidity\n    function getKeeperInflationRate() external view override returns (uint256) {\n        if (lastEvent == 0) return 0;\n        return currentInflationAmountKeeper;\n    }\n```\n\n### Proof of Concept\n\nGiven:\n\n*   currentInflationAmountAmm: 12,000 Bkd (1000 per month)\n*   annualInflationDecayAmm: 50%\n*   initialPeriodEnded: true\n*   lastInflationDecay: 11 months ago\n*   \\_INFLATION_DECAY_PERIOD: 1 year\n\n1.  Alice deposited as the one and only staker in the `AmmGauge` pool;\n2.  1 month later;\n3.  `Minter.sol#_executeInflationRateUpdate()` is called;\n4.  Alice `claimableRewards()` and received `500` Bkd tokens.\n\nExpected Results:\n\n*   Alice to receive `1000` Bkd tokens as rewards.\n\nActual Results:\n\n*   Alice received `500` Bkd tokens as rewards.\n\n### Recommendation\n\nConsider moving the call to `checkpointAllGauges()` to before the `currentInflationAmountKeeper` is updated.\n\n```solidity\nfunction _executeInflationRateUpdate() internal returns (bool) {\n    totalAvailableToNow += (currentTotalInflation * (block.timestamp - lastEvent));\n    lastEvent = block.timestamp;\n    if (block.timestamp >= lastInflationDecay + _INFLATION_DECAY_PERIOD) {\n        controller.inflationManager().checkpointAllGauges();\n        currentInflationAmountLp = currentInflationAmountLp.scaledMul(annualInflationDecayLp);\n        if (initialPeriodEnded) {\n            currentInflationAmountKeeper = currentInflationAmountKeeper.scaledMul(\n                annualInflationDecayKeeper\n            );\n            currentInflationAmountAmm = currentInflationAmountAmm.scaledMul(\n                annualInflationDecayAmm\n            );\n        } else {\n            currentInflationAmountKeeper =\n                initialAnnualInflationRateKeeper /\n                _INFLATION_DECAY_PERIOD;\n\n            currentInflationAmountAmm = initialAnnualInflationRateAmm / _INFLATION_DECAY_PERIOD;\n            initialPeriodEnded = true;\n        }\n        currentTotalInflation =\n            currentInflationAmountLp +\n            currentInflationAmountKeeper +\n            currentInflationAmountAmm;\n        lastInflationDecay = block.timestamp;\n    }\n    return true;\n}\n```\n\n**[chase-manning (Backd) confirmed, but disagreed with severity and commented](https://github.com/code-423n4/2022-05-backd-findings/issues/98#issuecomment-1148627407):**\n > This should be medium risk, as should only have a minor impact on users getting less rewards and no over-minting can occur.\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-05-backd-findings/issues/98#issuecomment-1159764863):**\n > The warden has shown how, due to an incorrect order of operations, rates for new rewards can be enacted before the old rewards are distributed, causing a loss of rewards for end users.\n> \n> There are 2 ways to judge this finding:\n> - The system is failing at distributing the proper amount of rewards, hence the finding is of High Severity\n> - End users can risk a loss of value if these functions are not called often enough as the difference between the old rates and the new rates will cause a loss of reward for the end users.\n> \n> Ultimately the impact is a loss of value, further minimized by the fact that anyone can call `poolCheckpoint` as well as `executeInflationRateUpdate` meaning the losses can be minimized.\n> \n> So from a coding standpoint I believe the bug should be fixed before deployment, but from a impact point of view the impact can be minimized to make \"loss of yield\" mostly rounding errors.\n> \n> Given the impact I believe the finding to be of Medium Severity. \n\n\n\n***\n\n## [[M-07] FeeBurner initiates swap without any slippage checks if Chainlink oracle fails ](https://github.com/code-423n4/2022-05-backd-findings/issues/44)\n_Submitted by Ruhum_\n\n<https://github.com/code-423n4/2022-05-backd/blob/main/protocol/contracts/tokenomics/FeeBurner.sol#L43-L88>\n\n<https://github.com/code-423n4/2022-05-backd/blob/main/protocol/contracts/swappers/SwapperRouter.sol#L414-L425>\n\n<https://github.com/code-423n4/2022-05-backd/blob/main/protocol/contracts/swappers/SwapperRouter.sol#L439>\n\n### Impact\n\nWhile the SwapperRouter contract isn't explicitly in scope, it's a dependency of the FeeBurner contract which *is* in scope. So I think it's valid to make this submission.\n\nThe SwapperRouter contract uses the chainlink oracle to compute the minimum amount of tokens it should expect from the swap. The value is then used for the slippage check. But, if the chainlink oracle fails, for whatever reason, the contract uses `0` for the slippage check instead. Thus there's a scenario where swaps initiated by the FeeBurner contract can be sandwiched.\n\n### Proof of Concept\n\n1.  multiple swaps initiated through [`FeeBurner.burnToTarget()`](https://github.com/code-423n4/2022-05-backd/blob/main/protocol/contracts/tokenomics/FeeBurner.sol#L43-L88)\n2.  SwapperRouter calls [`_minTokenAmountOut()`](https://github.com/code-423n4/2022-05-backd/blob/main/protocol/contracts/swappers/SwapperRouter.sol#L220) to determine `min_out` parameter.\n3.  [`minTokenAmountOut()`](https://github.com/code-423n4/2022-05-backd/blob/main/protocol/contracts/swappers/SwapperRouter.sol#L414-L425) returns `0` when Chainlink oracle fails\n\n### Recommended Mitigation Steps\n\nEither revert the transaction or initiate the transaction with a default slippage of 99%. In the case of Curve, you can get the expected amount through `get_dy()` and then multiply the value by 0.99. Use that as the `min_out` value and you don't have to worry about chainlink\n\n**[chase-manning (Backd) disputed and commented](https://github.com/code-423n4/2022-05-backd-findings/issues/44#issuecomment-1147362714):**\n > This is intended functionality. If there is no oracle for a token, we still want to swap it, even if this presents a possible sandwich attack. It should be rare for a token to not have an oracle, and when it does we would rather accept slippage as opposed to not being able to swap it at all.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/44#issuecomment-1159775547):**\n > I acknowledge the sponsor reply that they want to offer a service to the end user in allowing any swappable token to be used.\n> \n> While I believe the intent of the sponsor is respectable, the reality of the code is that it indeed allows for price manipulation and extraction of value, personally I would recommend end users to perform their own swaps to ensure a more reliable outcome.\n> \n> That said, because the code can be subject to leak of value, I believe Medium Severity to be appropriate.\n\n\n\n***\n\n## [[M-08] Users can claim extremely large rewards or lock rewards from LpGauge due to uninitialised `poolLastUpdate` variable](https://github.com/code-423n4/2022-05-backd-findings/issues/141)\n_Submitted by scaraven_\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/LpGauge.sol#L115-L119>\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L326-L328>\n\n### Impact\n\nA user can claim all of the available governance tokens or prevent any rewards from being claimed in `LpGauge.sol` if sufficient time is left between deploying the contract and initialising it in the `StakerVault.sol` contract by calling `initalizeLPGauge()` OR if a new `LPGauge` contract is deployed and added to `StakerVault` using `prepareLPGauge`.\n\nInside `LPGauge.sol` when calling `_poolCheckPoint()`, the `lastUpdated` variable is not initalised so defaults to a value of `0`, therefore if the user has managed to stake tokens in the `StakerVault` then the calculated `poolStakedIntegral` will be very large (as block.timestamp is very large). Therefore a user can mint most current available governance tokens for themselves when they claim their rewards (or prevent any governance tokens from being claimed).\n\n### Proof of Concept\n\n1.  LP Gauge and StakerVault contracts are deployed\n2.  Before the `initializeLpGauge()`, user A will stake 1 token with `stakeFor()` thereby increasing `_poolTotalStaked` by 1.\nAs the `lpgauge` address is equal to the zero address, `_userCheckPoint()` will not be called and `poolLastUpdate` will remain at 0.\n\n3. The user can then directly call `_userCheckPoint()` and be allocated a very large number of shares. This works because `poolLastUpdate` is 0 but the staked amount in the vault is larger than 0\n\n4. Once `initializeLPGauge()` is called, the user can then call `claimRewards()` and receive a very large portion of tokens or if `poolStakedIntegral` exceeds the mint limit set by `Minter.sol` then no one else can claim governance tokens from the lpGauge.<br>\n\nOR\n\n5. A new LP Gauge contract is deployed and added to the vault using `prepareGauge()`.\nFollow steps 2 to 4.\n\n### Recommended Mitigation Steps\n\nInitialise `poolLastUpdate` in the constructor\n\n**[danhper (Backd) confirmed](https://github.com/code-423n4/2022-05-backd-findings/issues/141)** \n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-05-backd-findings/issues/141#issuecomment-1159776886):**\n > The warden has identified a way to exploit the uninitialized value for the variable `poolLastUpdate`\n> \n> Because this is contingent on setup, and the impact is theft of rewards, I believe Medium Severity to be more appropriate.\n\n**[scaraven (warden) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/141#issuecomment-1168392303):**\n > Hi, correct me if I am wrong but there is a second scenario where this situation can be exploited as outlined in my report. If governance deploy a new LPGauge they must do it through `prepareLPGauge()` as `initializeLpGauge()` will revert. This introduces a significant delay (3 days if I'm correct) before the LPGauge can actually be initialised with `executeLPGauge()`. Therefore a user can easily monitor this contract and call `poolCheckpoint()` as soon as soon as `prepareLPGauge()` is called and the contract has no way to prevent this.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/141#issuecomment-1168798516):**\n > @scaraven \n> \n> I don't see any enforced delay in `initializeLpGauge`\n> <img width=\"746\" alt=\"Screenshot 2022-06-28 at 15 58 48\" src=\"https://user-images.githubusercontent.com/13383782/176197515-5c8fbd11-94dd-4a81-9f7f-47e91917e40c.png\">\n> \n> `_setConfig` bypasses the need for a `MIN_DELAY`\n> \n> Meaning the exploit is not practical for the first gauge\n> \n> ---\n> \n> For Gauge that needs to be substituted, that will indeed require a 3 day wait period, `_poolCheckpoint` can only be effective after the first deposit has happened as well, see: https://github.com/code-423n4/2022-05-backd-findings/issues/100<br>\n> Which effects how initial rewards are calculated.\n> \n> Due to the math being off it may be necessary to influence `uint256 currentRate = inflationManager.getLpRateForStakerVault(address(stakerVault));`\n> \n> This, the need for a second gauge, and the race condition between the first depositor and other depositors are external conditions, leading me to believe that Medium Severity is appropriate\n\n**[scaraven (warden) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/141#issuecomment-1168877923):**\n > Cool, thanks for taking the time to explain\n\n\n\n***\n\n## [[M-09] BkdLocker depositFees can be blocked](https://github.com/code-423n4/2022-05-backd-findings/issues/8)\n_Submitted by csanuragjain_\n\nburnFees will fail if none of the pool tokens have underlying token as native ETH token. This is shown below. Since burnFees fails so no fees is deposited in BKDLocker.\n\n### Proof of Concept\n\n1.  Assume RewardHandler.sol has currently amount 5 as address(this).balance (ethBalance) (even attacker can send a small balance to this contract to do this dos attack)\n2.  None of the pools have underlying as address(0) so no ETH tokens and only ERC20 tokens are present\n3.  Now feeBurner.burnToTarget is called passing current ETH balance of amount 5 with all pool tokens\n4.  feeBurner loops through all tokens and swap them to WETH. Since none of the token is ETH so burningEth\\_ variable is false\n5.  Now the below require condition fails since burningEth\\_ is false\n\n<!---->\n\n    require(burningEth_ || msg.value == 0, Error.INVALID_VALUE);\n\n6.  This fails the burnFees function.\n\n### Recommended Mitigation Steps\n\nETH should not be sent if none of pool underlying token is ETH. Change it to something like below:\n\n    bool ethFound=false;\n    for (uint256 i; i < pools.length; i = i.uncheckedInc()) {\n                ILiquidityPool pool = ILiquidityPool(pools[i]);\n                address underlying = pool.getUnderlying();\n                if (underlying != address(0)) {\n                    _approve(underlying, address(feeBurner));\n                } else\n    {\n    ethFound=true;\n    }\n                tokens[i] = underlying;\n            }\n\n    if(ethFound){\n            feeBurner.burnToTarget{value: ethBalance}(tokens, targetLpToken);\n    } else {\n    feeBurner.burnToTarget(tokens, targetLpToken);\n    }\n\n**[samwerner (Backd) confirmed](https://github.com/code-423n4/2022-05-backd-findings/issues/8)** \n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-05-backd-findings/issues/8#issuecomment-1159797384):**\n > The warden has shown how, due to a flaw in the logic, if ETH is present in the contract and no pool is denominated in ETH, then the contract will revert.\n> \n> This can be done as a DOS attack or for griefing.\n> \n> However, remediation would simply require adding a pool denominated in ETH, to ensure that the logic goes through\n> \n> For this reason, I believe Medium Severity to be more appropriate\n\n\n\n***\n\n## [[M-10] There are multiple ways for admins/governance to rug users](https://github.com/code-423n4/2022-05-backd-findings/issues/113)\n_Submitted by IllIllI, also found by 0x1f8b_\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L61>\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L70-L75>\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L50>\n\n### Impact\n\nA malicious admin can steal user funds or lock their balances forever.\n\nEven if the user is benevolent the fact that there is a rug vector available may [negatively impact the protocol's reputation](https://twitter.com/RugDocIO/status/1411732108029181960).\n\n### Proof of Concept\n\nUnlike the original Convex code that goes to great lengths to prevent users having the ability to transfer funds/mint things, this project introduces multiple roles and new abilities that require users to place more trust in governance:\n\n1.  Admins can initiate migrations and set the `newPool_` to be a contract that forwards funds to accounts they control\n\n```solidity\nFile: protocol/contracts/zaps/PoolMigrationZap.sol   #1\n\n61           ILiquidityPool newPool_ = _underlyingNewPools[underlying_];\n62           uint256 ethValue_ = underlying_ == address(0) ? underlyingAmount_ : 0;\n63           newPool_.depositFor{value: ethValue_}(msg.sender, underlyingAmount_);\n```\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L61-L63>\n\n2.  Admins can add infinite `newRewardToken`s:\n\n```solidity\nFile: protocol/contracts/BkdLocker.sol   #2\n\n70       function migrate(address newRewardToken) external override onlyGovernance {\n71           _replacedRewardTokens.remove(newRewardToken);\n72           _replacedRewardTokens.set(rewardToken, block.timestamp);\n73           lastMigrationEvent = block.timestamp;\n74           rewardToken = newRewardToken;\n75       }\n```\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L70-L75>\n\nso that `_userCheckpoint()`s, which are required to withdraw funds, revert because they run out of gas iterating over the tokens:\n\n```solidity\nFile: protocol/contracts/BkdLocker.sol   #3\n\n292       function _userCheckpoint(\n293           address user,\n294           uint256 amountAdded,\n295           uint256 newTotal\n296       ) internal {\n297           RewardTokenData storage curRewardTokenData = rewardTokenData[rewardToken];\n298   \n299           // Compute the share earned by the user since they last updated\n300           uint256 userBalance = balances[user];\n301           if (userBalance > 0) {\n302               curRewardTokenData.userShares[user] += (curRewardTokenData.feeIntegral -\n303                   curRewardTokenData.userFeeIntegrals[user]).scaledMul(\n304                       userBalance.scaledMul(boostFactors[user])\n305                   );\n306   \n307               // Update values for previous rewardTokens\n308               if (lastUpdated[user] < lastMigrationEvent) {\n309                   uint256 length = _replacedRewardTokens.length();\n310                   for (uint256 i; i < length; i = i.uncheckedInc()) {\n```\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L292-L310>\n\n3.  Admins can set a malicious `feeBurner`, via the addressProvider, which just takes the fees for itself\n\n```solidity\nFile: protocol/contracts/RewardHandler.sol   #4\n\n35       function burnFees() external override {\n36           IBkdLocker bkdLocker = IBkdLocker(addressProvider.getBKDLocker());\n37           IFeeBurner feeBurner = addressProvider.getFeeBurner();\n38           address targetLpToken = bkdLocker.rewardToken();\n39           address[] memory pools = addressProvider.allPools();\n40           uint256 ethBalance = address(this).balance;\n41           address[] memory tokens = new address[](pools.length);\n42           for (uint256 i; i < pools.length; i = i.uncheckedInc()) {\n43               ILiquidityPool pool = ILiquidityPool(pools[i]);\n44               address underlying = pool.getUnderlying();\n45               if (underlying != address(0)) {\n46                   _approve(underlying, address(feeBurner));\n47               }\n48               tokens[i] = underlying;\n49           }\n50           feeBurner.burnToTarget{value: ethBalance}(tokens, targetLpToken);\n```\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L35-L50>\n\n4.  Admins can set an oracle that provides the wrong answers:\n\n```solidity\nFile: protocol/contracts/swappers/SwapperRouter.sol   #5\n\n452           try _addressProvider.getOracleProvider().getPriceETH(token_) returns (uint256 price_) {\n```\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/swappers/SwapperRouter.sol#L452>\n\n### Recommended Mitigation Steps\n\nThe trust-minimizing approach that Convex took was to not allow admins to change addresses. In order for things to change, an admin is allowed to completely shut everything down, and during the shut down state, users are still able to withdraw their funds. Later, the admins spin up a whole new set of contracts, and let users migrate things themselves. Something similar can be done here by having the DAO accept proposals to spawn specific contracts, and hook up specific addresses in certain ways in the new deployment.\n\n**[danhper (Backd) disputed and commented](https://github.com/code-423n4/2022-05-backd-findings/issues/113#issuecomment-1147384553):**\n > This is a design decision. Many protocols are fully upgradeable (Compound, Aave, Maker) and some decide to be fully immutable (Convex, Curve). The governance process will be formalized a little later and have safeguards in place but we are not planning on following Convex's approach nor think that it is the \"correct\" way to design a protocol.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/113#issuecomment-1159809027):**\n > The warden has listed multiple ways in which Admin Privilege can be used against users of the protocol.\n> \n> While the sponsor may be fully aware of these mechanics, it is very important that these type of risks are clearly explained to end-users as they can ultimately bear the consequences of those risks.\n> \n> Because the findings are contingent on a malicious admin, I believe Medium Severity to be appropriate.\n\n\n\n***\n\n## [[M-11] Usage of deprecated transfer to send ETH](https://github.com/code-423n4/2022-05-backd-findings/issues/180)\n_Submitted by peritoflores, also found by JC and StyxRave_\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/swappers/SwapperRouter.sol#L140>\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/swappers/SwapperRouter.sol#L280>\n\n### Impact\n\nUsage of deprecated transfer Swap can revert.\n\n### Proof of Concept\n\nThe original `transfer` used to send eth uses a fixed stipend 2300 gas.   This was used to prevent reentrancy.   However this limit your protocol to interact with others contracts that need more than that to process the transaction.\n\nA good article about that:\n<https://consensys.net/diligence/blog/2019/09/stop-using-soliditys-transfer-now/>.\n\n### Recommended Mitigation Steps\n\nUsed call instead.  For example\n\n        (bool success, ) = msg.sender.call{amount}(\"\");\n        require(success, \"Transfer failed.\");\n\n**[chase-manning (Backd) confirmed](https://github.com/code-423n4/2022-05-backd-findings/issues/180)** \n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/180#issuecomment-1159810449):**\n > While submission is lazy in that it doesn't show the ways in which it could revert, (for example most of the times even a transfer to a gnosis-safe will not revert as the gas stipend is sufficient)\n> \n> It's true that `transfer`s gas stipend may run out, causing reverts\n> \n> For this reason I agree with Med Severity.\n\n\n\n***\n\n## [[M-12] Users can claim more fees than expected if governance migrates current rewardToken again by fault.](https://github.com/code-423n4/2022-05-backd-findings/issues/86)\n_Submitted by hansfriese, also found by csanuragjain and unforgiven_\n\n<https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/BkdLocker.sol#L70-L75>\n\n<https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/BkdLocker.sol#L302-L322>\n\n### Impact\n\nUsers can claim more fees than expected if governance migrates current rewardToken again by fault.\n\n### Proof of Concept\n\nIn the migrate() function, there is no requirement newRewardToken != rewardToken.\nIf this function is called with the same \"rewardToken\" parameter, \"\\_replacedRewardTokens\" will contain the current \"rewardToken\" also.\nThen when the user claims fees, \"userShares\" will be added two times for the same token at L302-L305, L314-L317.\n\nIt's because \"curRewardTokenData.userFeeIntegrals\\[user]\" is updated at L332 after the \"userShares\" calculation for past rewardTokens.\nSo the user can get paid more fees than he should.\n\n### Tools Used\n\nSolidity Visual Developer of VSCode\n\n### Recommended Mitigation Steps\n\nYou need to add this require() at L71.\n\nrequire(newRewardToken != rewardToken, Error.SAME_AS_CURRENT);\n\n**[danhper (Backd) confirmed](https://github.com/code-423n4/2022-05-backd-findings/issues/86)** \n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/86#issuecomment-1160995252):**\n > The warden has identified how a governance migration from and to the same token can cause the rewards to be double-counted.\n> \n> Because the exploit is contingent on:\n> - Admin Privilege\n> - Would cause issues with Yield\n> \n> I believe Medium Severity to be appropriate.\n\n\n\n***\n\n## [[M-13] Inconsistency in view functions can lead to users believing they’re due for more BKD rewards](https://github.com/code-423n4/2022-05-backd-findings/issues/150)\n_Submitted by SmartSek_\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmConvexGauge.sol#L107-L111>\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmConvexGauge.sol#L129-L134>\n\n### Impact\n\nThe view functions used for a user to check their claimable rewards vary in their implementation. This can cause users to believe they are due X amount but will receive Y.\n\n### Proof of Concept\n\nIf the `inflationRecipient` is set, then `poolStakedIntegral` will be incremented in `claimableRewards()` but not in any other function like `allClaimableRewards()` or `poolCheckpoint()`.\n\nIf a user calls `claimableRewards()` after the `inflationRepient` has been set, `claimableRewards()` will return a larger value than `allClaimableRewards()` or the amount actually returned by `claimRewards()`.\n\n### Recommended Mitigation Steps\n\nTo make the logic consistent, `claimableRewards()` needs `if (inflationRecipient == address(0))` added to it.\n\n**[chase-manning (Backd) confirmed](https://github.com/code-423n4/2022-05-backd-findings/issues/150)**\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/150#issuecomment-1161070065):**\n > The warden has identified an incorrect implementation in how rewards are shown, while no assets are at risk, the issue identified is a programming mistake that could cause further issues.\n> \n> For this reason I agree with Medium Severity\n\n> I'm still fairly conflicted on severity as the impact is going to be quite small, however at this time, because the \"code is wrong\", I still think Medium Severity to be valid.\n\n\n\n***\n\n## [[M-14] StakerVault.unstake(), StakerVault.unstakeFor() would revert with a uint underflow error of StakerVault.strategiesTotalStaked, StakerVault._poolTotalStaked.](https://github.com/code-423n4/2022-05-backd-findings/issues/87)\n_Submitted by hansfriese_\n\n<https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/StakerVault.sol#L98-L102>\n\n<https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/StakerVault.sol#L342-L346>\n\n<https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/StakerVault.sol#L391-L395>\n\n### Impact\n\nStakerVault.unstake(), StakerVault.unstakeFor() would revert with a uint underflow error of StakerVault.strategiesTotalStaked, StakerVault.\\_poolTotalStaked.\n\n### Proof of Concept\n\nCurrently it saves totalStaked for strategies and non-strategies separately.\n\nuint underflow error could occur in these cases.\n\nScenario 1.\n\n1.  Address A(non-strategy) stakes some amount x and it will be added to StakerVault_poolTotalStaked.\n2.  This address A is approved as a strategy by StakerVault.inflationManager.\n3.  Address A tries to unstake amount x, it will be deducted from StakerVault.strategiesTotalStaked because this address is a strategy already.\n\nEven if it would succeed for this strategy but it will revert for other strategies because StakerVault.strategiesTotalStaked is less than correct staked amount for strategies.\n\nScenario 2.\nThere is a transfer between strategy and non-strategy using StakerVault.transfer(), StakerVault.transferFrom() functions.\nIn this case, StakerVault.strategiesTotalStaked and StakerVault.\\_poolTotalStaked must be changed accordingly but there is no such logic.\n\n### Tools Used\n\nSolidity Visual Developer of VSCode\n\n### Recommended Mitigation Steps\n\nYou need to modify 3 functions. StakerVault.addStrategy(), StakerVault.transfer(), StakerVault.transferFrom().\n\n1.  You need to move staked amount from StakerVault.\\_poolTotalStaked to StakerVault.strategiesTotalStaked every time when StakerVault.inflationManager approves a new strategy.\n\n    You can modify addStrategy() at L98-L102 like this.\n\n    function addStrategy(address strategy) external override returns (bool) {\n    require(msg.sender == address(inflationManager), Error.UNAUTHORIZED_ACCESS);\n    require(!strategies\\[strategy], Error.ADDRESS_ALREADY_SET);\n\n    strategies[strategy] = true;\n    _poolTotalStaked -= balances[strategy];\n    strategiesTotalStaked += balances[strategy];\n\n    return true;\n    }\n\n2.  You need to add below code at L126 of transfer() function.\n\n    if(strategies\\[msg.sender] != strategies\\[account]) {\n    if(strategies\\[msg.sender]) { // from strategy to non-strategy\n    \\_poolTotalStaked += amount;\n    strategiesTotalStaked -= amount;\n    }\n    else { // from non-strategy to strategy\n    \\_poolTotalStaked -= amount;\n    strategiesTotalStaked += amount;\n    }\n    }\n\n3.  You need to add below code at L170 of transferFrom() function.\n\n    if(strategies\\[src] != strategies\\[dst]) {\n    if(strategies\\[src]) { // from strategy to non-strategy\n    \\_poolTotalStaked += amount;\n    strategiesTotalStaked -= amount;\n    }\n    else { // from non-strategy to strategy\n    \\_poolTotalStaked -= amount;\n    strategiesTotalStaked += amount;\n    }\n    }\n\n**[danhper (Backd) confirmed](https://github.com/code-423n4/2022-05-backd-findings/issues/87)** \n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/87#issuecomment-1161075516):**\n > The warden has identified a way for funds to be stuck due to underflow.\n> \n> While the odds of this happening are fairly low, the grief can be executed by frontrunning the `addStrategy` call, as well as by mistake.\n> \n> Additionally, a strategy doesn't seem to be removable making the loss of those hypothetical tokens permanent.\n> \n> For those reasons I believe Medium Severity to be appropriate.\n\n\n\n***\n\n## [[M-15] Potential DoS when removing keeper gauge](https://github.com/code-423n4/2022-05-backd-findings/issues/71)\n_Submitted by shenwilly_\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L609-L618>\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L82>\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/actions/topup/TopUpActionFeeHandler.sol#L95-L98>\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/actions/topup/TopUpAction.sol#L807>\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/actions/topup/TopUpAction.sol#L653>\n\n### Impact\n\nWhen `_removeKeeperGauge` is called, there is no guarantee that the keeper gauge isn't currently in use by any `TopUpActionFeeHandler`. If it's still in use, any top up action executions will be disabled as reporting fees in `KeeperGauge.sol` will revert:\n\n    function reportFees(\n        address beneficiary,\n        uint256 amount,\n        address lpTokenAddress\n    ) external override returns (bool) {\n        ...\n        require(!killed, Error.CONTRACT_PAUSED); // gauge is killed by InflationManager\n        ...\n        return true;\n    }\n\nIf this happened during extreme market movements, some positions that require a top up will not be executed and be in risk of being liquidated.\n\n### Proof of Concept\n\n*   Alice registers a top up action.\n*   Governance calls `InflationManager.removeKeeperGauge`, replacing an old keeper gauge. However, governance forgot to call `TopUpActionFeeHandler.prepareKeeperGauge` so `TopUpActionFeeHandler.getKeeperGauge` still points to the killed gauge.\n*   Market moved and Alice's position should now be executed by keepers, however any attempt to execute will revert:\n        > Keeper calls TopUpAction.execute();\n        > _payFees();\n        > IActionFeeHandler(feeHandler).payFees();\n        > IKeeperGauge(keeperGauge).reportFees();\n        > reverts as gauge is already killed\n*   Governance noticed and calls `prepareKeeperGauge`  with a 3 days delay.\n*   Alice's position got liquidated before the change is executed.\n\n### Recommended Mitigation Steps\n\nConsider adding an on-chain check to ensure that the keeper gauge is not in use before removing them.\n\n**[danhper (Backd) confirmed](https://github.com/code-423n4/2022-05-backd-findings/issues/71)** \n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/71#issuecomment-1163180483):**\n > I believe the warden has shown a situation in which calling `_removeKeeperGauge` can cause `payFees` to revert, making it impossible (for a time) for fees to be paid.\n> \n> I do not believe the impact will extend beyond: \n> - Potential loss of yield (or delay)\n> - Need for governance to set a new gauge\n> \n> I disagree with the statement: `Alice's position got liquidated before the change is executed.` as no liquidation should be contingent on fees being paid from this function.\n> \n> Because the finding shows how the system for fees can be stopped due to external conditions, I agree with Medium Seveirty\n\n\n\n***\n\n## [[M-16] it's possible to initialize contract BkdLocker for multiple times by sending startBoost=0 and each time different values for other parameters](https://github.com/code-423n4/2022-05-backd-findings/issues/136)\n_Submitted by unforgiven, also found by 0x1f8b and scaraven_\n\nfunction `initialize()` of `BkdLocker` suppose to be called one time and contract initialize one time. but if it's called by `startBoost=0` then it's possible to call it again with different values for other parameters. there are some logics based on the values function `initilize()` sets which is in calculating boost and withdraw delay. by initializing multiple times different users get different values for those logics and because rewards are distributed based on boosts so those logics will be wrong too.\n\n### Proof of Concept\n\nThis is `initiliaze()` code in `BkdLocker`:\n\n        function initialize(\n            uint256 startBoost,\n            uint256 maxBoost,\n            uint256 increasePeriod,\n            uint256 withdrawDelay\n        ) external override onlyGovernance {\n            require(currentUInts256[_START_BOOST] == 0, Error.CONTRACT_INITIALIZED);\n            _setConfig(_START_BOOST, startBoost);\n            _setConfig(_MAX_BOOST, maxBoost);\n            _setConfig(_INCREASE_PERIOD, increasePeriod);\n            _setConfig(_WITHDRAW_DELAY, withdrawDelay);\n        }\n\nAs you can see it checks the initialization statue by `currentUInts256[_START_BOOST]`'s value but it's not correct way to do and initializer can set `currentUInts256[_START_BOOST]` value as `0` and set other parameters values and call this function multiple times with different values for `_MAX_BOOST` and `_INCREASE_PERIOD` and `_WITHDRAW_DELAY`. setting different values for those parameters can cause different calculation in `computeNewBoost()` and `prepareUnlock()`. function `computeNewBoost()` is used to calculate users boost parameters which is used on reward distribution. so by changing `_MAX_BOOST` the rewards will be distributed wrongly between old users and new users.\n\n### Tools Used\n\nVIM\n\n### Recommended Mitigation Steps\n\nAdd some other variable to check the status of initialization of contract.\n\n**[danhper (Backd) confirmed, but disagreed with severity](https://github.com/code-423n4/2022-05-backd-findings/issues/136)** \n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/136#issuecomment-1163189343):**\n > The warden has shown how, under specific circumstances, the `BkdLocker ` contact can be initialized multiple times, with the specific goal of changing configuration parameters.\n> \n> From my understanding these configs are meant to be set only once (there are no available external setters that governance can call), effectively sidestepping the \"perceived immutability\" that the locker seems to be offering.\n> \n> The attack is contingent on malicious Governance, for that reason I believe Medium Severity to be appropriate.\n> \n> The impact of the attack can cause:\n> - Loss of Yield\n> - Unfair distribution of rewards\n> - Abuse of rewards math for governance advantage\n> \n> End users can verify that the exploit is not applicable by ensuring that `startBoost` is greater than 0.\n\n\n\n***\n\n## [[M-17] Strategy in StakerVault.sol can steal more rewards even though it's designed strategies shouldn't get rewards.](https://github.com/code-423n4/2022-05-backd-findings/issues/85)\n_Submitted by hansfriese_\n\n<https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/StakerVault.sol#L95>\n\n<https://github.com/code-423n4/2022-05-backd/tree/main/protocol/contracts/tokenomics/LpGauge.sol#L52-L63>\n\n### Impact\n\nStrategy in StakerVault.sol can steal more rewards even though it's designed strategies shouldn't get rewards.\n\nAlso there will be a problem with a rewarding system in LpGauge.sol so that some normal users wouldn't get rewards properly.\n\n### Proof of Concept\n\n1.  Strategy A staked amount x and x will be added to StakerVault.strategiesTotalStaked.\n\n    contracts\\StakerVault.sol#L312\n\n2. Strategy A transferred the amount x to non-strategy B and StakerVault.strategiesTotalStaked, StakerVault.\n    \\_poolTotalStaked won't be updated.\n    contracts\\StakerVault.sol#L111\n\n3. After some time for the larger LpGauge.poolStakedIntegral, B claims rewards using the LpGauge.claimRewards() function.\n    contracts\\tokenomics\\LpGauge.sol#L52\n\n    Inside LpGauge.userCheckPoint(), it's designed not to calculate LpGauge.perUserShare for strategy, but it will pass this condition because B is not a strategy.\n    contracts\\tokenomics\\LpGauge.sol#L90\n\n    Furthermore, when calculate rewards, LpGauge.poolStakedIntegral will be calculated larger than a normal user stakes same amount.\n    It's because StakerVault.\\_poolTotalStaked wasn't updated when A transfers x amount to B so LpGauge.poolTotalStaked is less than correct value.\n    contracts\\tokenomics\\LpGauge.sol#L113-L117\n\n    Finally B can get more rewards than he should and the reward system will pay more rewards than it's designed.\n\n### Tools Used\n\nSolidity Visual Developer of VSCode\n\n### Recommended Mitigation Steps\n\nI think there will be two methods to fix.\n\nMethod 1 is to forbid a transfer between strategy and non-strategy so that strategy can't move funds to non-strategy.\n\nMethod 2 is to update StakerVault.strategiesTotalStaked and StakerVault.\\_poolTotalStaked correctly so that strategy won't claim more rewards than he should even though he claims rewards using non-strategy.\n\nMethod 1.\nYou need to modify two functions. StakerVault.transfer(), StakerVault.transferFrom().\n\n1.  You need to add this require() at L112 for transfer().\n\n    require(strategies\\[msg.sender] == strategies\\[account], Error.FAILED_TRANSFER);\n\n2.  You need to add this require() at L144 for transferFrom().\n\n    require(strategies\\[src] == strategies\\[dst], Error.FAILED_TRANSFER);\n\nMethod 2.\nI've explained about this method in my medium risk report \"StakerVault.unstake(), StakerVault.unstakeFor() would revert with a uint underflow error of StakerVault.strategiesTotalStaked, StakerVault.\\_poolTotalStaked\"\nI will copy the same code for your convenience.\n\nYou need to modify 3 functions. StakerVault.addStrategy(), StakerVault.transfer(), StakerVault.transferFrom().\n\n1.  You need to move staked amount from StakerVault.\\_poolTotalStaked to StakerVault.strategiesTotalStaked every time when StakerVault.inflationManager approves a new strategy.\n\n    You can modify addStrategy() at L98-L102 like this.\n\n    function addStrategy(address strategy) external override returns (bool) {\n        require(msg.sender == address(inflationManager), Error.UNAUTHORIZED_ACCESS);\n        require(!strategies\\[strategy], Error.ADDRESS_ALREADY_SET);\n\n        strategies\\[strategy] = true;\n        \\_poolTotalStaked -= balances\\[strategy];\n        strategiesTotalStaked += balances\\[strategy];\n\n        return true;\n    }\n\n2.  You need to add below code at L126 of transfer() function.\n\n    if(strategies\\[msg.sender] != strategies\\[account]) {\n        if(strategies\\[msg.sender]) { // from strategy to non-strategy\n            \\_poolTotalStaked += amount;\n            strategiesTotalStaked -= amount;\n        }\n        else { // from non-strategy to strategy\n            \\_poolTotalStaked -= amount;\n            strategiesTotalStaked += amount;\n        }\n    }\n\n3.  You need to add below code at L170 of transferFrom() function.\n\n    if(strategies\\[src] != strategies\\[dst]) {\n        if(strategies\\[src]) { // from strategy to non-strategy\n            \\_poolTotalStaked += amount;\n            strategiesTotalStaked -= amount;\n        }\n        else { // from non-strategy to strategy\n            \\_poolTotalStaked -= amount;\n            strategiesTotalStaked += amount;\n        }\n    }\n\n**[chase-manning (Backd) confirmed, but disagreed with severity and commented](https://github.com/code-423n4/2022-05-backd-findings/issues/85#issuecomment-1148616366):**\n > We think this is a medium risk.\n\n**[Alex the Entreprenerd (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-05-backd-findings/issues/85#issuecomment-1163371868):**\n > I believe there's validity to the finding but at the same time I believe the impact is a loss of yield more so than an unfair gain of yield for a strategy.\n> \n> Specifically the POC is reliant on Depositing as a user, then transferring tokens to a strategy.\n> \n> I believe this will break the accounting per the POC shown (`strategiesTotalStaked` will be incorrect).\n> \n> Then the rewards will be claimable to the strategy as if it were a user, meaning that the extra checks to prevent strategies from gaining staking rewards will be sidestepped.\n> \n> I believe those tokens will be lost unless all strategies have a way to sweep non-protected tokens.\n> \n> Because the warden showed how to break accounting, I believe Medium Severity to be valid, that said I don't believe the warden has shown any meaningful economic attack beside end-users losing their own tokens and the rewards attached to them.\n\n\n\n***\n\n## [[M-18] Fees from delisted pool still in reward handler will become stuck after delisting](https://github.com/code-423n4/2022-05-backd-findings/issues/135)\n_Submitted by 0x52_\n\nUnclaimed fees from pool will be stuck.\n\n### Proof of Concept\n\nWhen delisting a pool the pool's reference is removed from address provider:\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/Controller.sol#L63>\n\nBurning fees calls a dynamic list of all pools which no longer contains the delisted pool:\n\n<https://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L39>\n\nSince the list no longer contains the pool those fees will not be processed and will remain stuck in the contract\n\n### Recommended Mitigation Steps\n\nCall burnFees() before delisting a pool.\n\n**[danhper (Backd) confirmed](https://github.com/code-423n4/2022-05-backd-findings/issues/135)** \n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/135#issuecomment-1163376879):**\n > The warden has shown how, by removing a pool before calling `burnFees`, the removed pool will not receive the portion of fees that it should.\n> \n> Because this finding related to loss of yield, I believe Medium Severity to be appropriate.\n\n\n\n***\n\n\n\n# Low Risk and Non-Critical Issues\n\nFor this contest, 42 reports were submitted by wardens detailing low risk and non-critical issues. The [report highlighted below](https://github.com/code-423n4/2022-05-backd-findings/issues/109) by **IllIllI** received the top score from the judge.\n\n*The following wardens also submitted reports: [SmartSek](https://github.com/code-423n4/2022-05-backd-findings/issues/153), [BowTiedWardens](https://github.com/code-423n4/2022-05-backd-findings/issues/174), [SecureZeroX](https://github.com/code-423n4/2022-05-backd-findings/issues/74), [berndartmueller](https://github.com/code-423n4/2022-05-backd-findings/issues/133), [cccz](https://github.com/code-423n4/2022-05-backd-findings/issues/51), [Ruhum](https://github.com/code-423n4/2022-05-backd-findings/issues/45), [cryptphi](https://github.com/code-423n4/2022-05-backd-findings/issues/159), [defsec](https://github.com/code-423n4/2022-05-backd-findings/issues/134), [dipp](https://github.com/code-423n4/2022-05-backd-findings/issues/155), [fatherOfBlocks](https://github.com/code-423n4/2022-05-backd-findings/issues/34), [unforgiven](https://github.com/code-423n4/2022-05-backd-findings/issues/166), [codexploder](https://github.com/code-423n4/2022-05-backd-findings/issues/12), [Chom](https://github.com/code-423n4/2022-05-backd-findings/issues/172), [bardamu](https://github.com/code-423n4/2022-05-backd-findings/issues/56), [masterchief](https://github.com/code-423n4/2022-05-backd-findings/issues/176), [Kumpa](https://github.com/code-423n4/2022-05-backd-findings/issues/67), [0x29A](https://github.com/code-423n4/2022-05-backd-findings/issues/94), [c3phas](https://github.com/code-423n4/2022-05-backd-findings/issues/142), [Funen](https://github.com/code-423n4/2022-05-backd-findings/issues/173), [hansfriese](https://github.com/code-423n4/2022-05-backd-findings/issues/89), [Picodes](https://github.com/code-423n4/2022-05-backd-findings/issues/49), [shenwilly](https://github.com/code-423n4/2022-05-backd-findings/issues/72), [WatchPug](https://github.com/code-423n4/2022-05-backd-findings/issues/96), [0xNazgul](https://github.com/code-423n4/2022-05-backd-findings/issues/25), [0x1f8b](https://github.com/code-423n4/2022-05-backd-findings/issues/18), [Sm4rty](https://github.com/code-423n4/2022-05-backd-findings/issues/91), [0xf15ers](https://github.com/code-423n4/2022-05-backd-findings/issues/123), [asutorufos](https://github.com/code-423n4/2022-05-backd-findings/issues/60), [delfin454000](https://github.com/code-423n4/2022-05-backd-findings/issues/126), [gzeon](https://github.com/code-423n4/2022-05-backd-findings/issues/171), [hake](https://github.com/code-423n4/2022-05-backd-findings/issues/121), [sach1r0](https://github.com/code-423n4/2022-05-backd-findings/issues/42), [simon135](https://github.com/code-423n4/2022-05-backd-findings/issues/149), [StyxRave](https://github.com/code-423n4/2022-05-backd-findings/issues/58), [oyc_109](https://github.com/code-423n4/2022-05-backd-findings/issues/3), [hyh](https://github.com/code-423n4/2022-05-backd-findings/issues/62), [catchup](https://github.com/code-423n4/2022-05-backd-findings/issues/78), [Kaiziron](https://github.com/code-423n4/2022-05-backd-findings/issues/106), [MiloTruck](https://github.com/code-423n4/2022-05-backd-findings/issues/105), [sashik_eth](https://github.com/code-423n4/2022-05-backd-findings/issues/146), and [Waze](https://github.com/code-423n4/2022-05-backd-findings/issues/130).*\n\n## Low Risk Issues\n| |Issue|Instances|\n|-|:-|:-:|\n| 1 | `migrate()` still does transfers when the transfer is to the same pool, and this can be done multiple times | 1 |\n| 2 | Non-exploitable reentrancy | 1 |\n| 3 | Users can DOS themselves by executing `prepareUnlock(0)` many times | 1 |\n| 4 | Unused/empty `receive()`/`fallback()` function | 3 |\n| 5 | `safeApprove()` is deprecated | 4 |\n| 6 | Missing checks for `address(0x0)` when assigning values to `address` state variables | 8 |\n| 7 | `_prepareDeadline()`, `_setConfig()`, and `_executeDeadline()` should be `private` | 1 |\n\nTotal: 19 instances over 7 issues\n\n## [L-01] `migrate()` still does transfers when the transfer is to the same pool, and this can be done multiple times\nThere's no check that the old address isn't the same as the new address, and there's no check that the migration has already happened\n\n*There is 1 instance of this issue:*\n```solidity\nFile: protocol/contracts/zaps/PoolMigrationZap.sol   #1\n\n52       function migrate(address oldPoolAddress_) public override {\n53           ILiquidityPool oldPool_ = ILiquidityPool(oldPoolAddress_);\n54           IERC20 lpToken_ = IERC20(oldPool_.getLpToken());\n55           uint256 lpTokenAmount_ = lpToken_.balanceOf(msg.sender);\n56           require(lpTokenAmount_ != 0, \"No LP Tokens\");\n57           require(oldPool_.getWithdrawalFee(msg.sender, lpTokenAmount_) == 0, \"withdrawal fee not 0\");\n58:          lpToken_.safeTransferFrom(msg.sender, address(this), lpTokenAmount_);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L52-L58\n\n## [L-02] Non-exploitable reentrancy\nThere is no reentrancy guard in this function, and if used with a token that has transfer callbacks, such as an ERC777, the caller can reenter before `balances` is updated. I don't currently see a way to exploit this\n\n*There is 1 instance of this issue:*\n```solidity\nFile: protocol/contracts/tokenomics/AmmGauge.sol   #1\n\n130          uint256 oldBal = IERC20(ammToken).balanceOf(address(this));\n131          IERC20(ammToken).safeTransfer(dst, amount);\n132          uint256 newBal = IERC20(ammToken).balanceOf(address(this));\n133          uint256 unstaked = oldBal - newBal;\n134          balances[msg.sender] -= unstaked;\n135:         totalStaked -= unstaked;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L130-L135\n\n## [L-03] Users can DOS themselves by executing `prepareUnlock(0)` many times\nThere's no check on the amount, and every call add another entry to an array. When the user finally calls `executeUnlocks()` they'll run out of gas\n\n*There is 1 instance of this issue:*\n```solidity\nFile: protocol/contracts/BkdLocker.sol   #1\n\n118      function prepareUnlock(uint256 amount) external override {\n119          require(\n120              totalStashed[msg.sender] + amount <= balances[msg.sender],\n121              \"Amount exceeds locked balance\"\n122:         );\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L118-L122\n\n## [L-04] Unused/empty `receive()`/`fallback()` function\nIf the intention is for the Ether to be used, the function should call another function, otherwise it should revert (e.g. `require(msg.sender == address(weth))`)\n\n*There are 3 instances of this issue:*\n```solidity\nFile: protocol/contracts/zaps/PoolMigrationZap.sol   #1\n\n31:       receive() external payable {}\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L31\n\n```solidity\nFile: protocol/contracts/RewardHandler.sol   #2\n\n30:       receive() external payable {}\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L30\n\n```solidity\nFile: protocol/contracts/tokenomics/FeeBurner.sol   #3\n\n35:       receive() external payable {} // Recieve function for withdrawing from Backd ETH Pool\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L35\n\n## [L-05] `safeApprove()` is deprecated\n[Deprecated](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/bfff03c0d2a59bcd8e2ead1da9aed9edf0080d05/contracts/token/ERC20/utils/SafeERC20.sol#L38-L45) in favor of `safeIncreaseAllowance()` and `safeDecreaseAllowance()`. If only setting the initial allowance to the value that means infinite, `safeIncreaseAllowance()` can be used instead\n\n*There are 4 instances of this issue:*\n```solidity\nFile: protocol/contracts/zaps/PoolMigrationZap.sol   #1\n\n27:               IERC20(underlying_).safeApprove(address(newPool_), type(uint256).max);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L27\n\n```solidity\nFile: protocol/contracts/RewardHandler.sol   #2\n\n52:           IERC20(targetLpToken).safeApprove(address(bkdLocker), burnedAmount);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L52\n\n```solidity\nFile: protocol/contracts/RewardHandler.sol   #3\n\n64:           IERC20(token).safeApprove(spender, type(uint256).max);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L64\n\n```solidity\nFile: protocol/contracts/tokenomics/FeeBurner.sol   #4\n\n118:          IERC20(token_).safeApprove(spender_, type(uint256).max);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L118\n\n## [L-06] Missing checks for `address(0x0)` when assigning values to `address` state variables\n\n*There are 8 instances of this issue:*\n```solidity\nFile: protocol/contracts/StakerVault.sol\n\n72:           token = _token;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L72\n\n```solidity\nFile: protocol/contracts/BkdLocker.sol\n\n49:           rewardToken = _rewardToken;\n\n74:           rewardToken = newRewardToken;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L49\n\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrowRevocable.sol\n\n43:           treasury = treasury_;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrowRevocable.sol#L43\n\n```solidity\nFile: protocol/contracts/tokenomics/AmmGauge.sol\n\n39:           ammToken = _ammToken;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L39\n\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrow.sol\n\n65:           fundAdmin = fundAdmin_;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L65\n\n```solidity\nFile: protocol/contracts/tokenomics/KeeperGauge.sol\n\n48:           pool = _pool;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L48\n\n```solidity\nFile: protocol/contracts/tokenomics/BkdToken.sol\n\n21:           minter = _minter;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/BkdToken.sol#L21\n\n## [L-07] `_prepareDeadline()`, `_setConfig()`, and `_executeDeadline()` should be `private`\nI flagged this in the last Backd contest, but it doesn't seem to have been addressed, so bringing it up again: These functions have the ability to bypass the timelocks of every setting. No contract besides the `Preparable` contract itself should need to call these functions, and having them available will lead to exploits. The contracts that currently call `_setConfig()` in their constructors should be given a new function `_initConfig()` for this purpose. The `Vault` [calls](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/Vault.sol#L222) some of these functions as well, and should be changed to manually inspect the deadline rather than mucking with the internals, which is error-prone. The mappings should also be made `private`, and there should be public getters to read their values\n\n*There is 1 instance of this issue:*\n```solidity\nFile: protocol/contracts/utils/Preparable.sol   #1\n\n115      /**\n116       * @notice Execute uint256 config update (with time delay enforced).\n117       * @dev Needs to be called after the update was prepared. Fails if called before time delay is met.\n118       * @return New value.\n119       */\n120      function _executeUInt256(bytes32 key) internal returns (uint256) {\n121          _executeDeadline(key);\n122          uint256 newValue = pendingUInts256[key];\n123          _setConfig(key, newValue);\n124          return newValue;\n125      }\n126  \n127      /**\n128       * @notice Execute address config update (with time delay enforced).\n129       * @dev Needs to be called after the update was prepared. Fails if called before time delay is met.\n130       * @return New value.\n131       */\n132      function _executeAddress(bytes32 key) internal returns (address) {\n133          _executeDeadline(key);\n134          address newValue = pendingAddresses[key];\n135          _setConfig(key, newValue);\n136          return newValue;\n137:     }\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/Preparable.sol#L115-L137\n\n## Non-Critical Issues\n| |Issue|Instances|\n|-|:-|:-:|\n| 1 | Unneeded import | 1 |\n| 2 | Return values of `approve()` not checked | 1 |\n| 3 | Large multiples of ten should use scientific notation (e.g. `1e6`) rather than decimal literals (e.g. `1000000`), for readability | 2 |\n| 4 | Missing event for critical parameter change | 3 |\n| 5 | Use a more recent version of solidity | 1 |\n| 6 | Use a more recent version of solidity | 16 |\n| 7 | Constant redefined elsewhere | 10 |\n| 8 | Inconsistent spacing in comments | 3 |\n| 9 | File is missing NatSpec | 5 |\n| 10 | NatSpec is incomplete | 17 |\n| 11 | Event is missing `indexed` fields | 10 |\n| 12 | Not using the named return variables anywhere in the function is confusing | 2 |\n| 9 | Typos | 6 |\n\nTotal: 80 instances over 13 issues\n\n## [N-01] Unneeded import\n\n*There is 1 instance of this issue:*\n```solidity\nFile: protocol/contracts/tokenomics/BkdToken.sol   #1\n\n8:   import \"../../libraries/ScaledMath.sol\";\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/BkdToken.sol#L8\n\n## [N-02] Return values of `approve()` not checked\nNot all `IERC20` implementations `revert()` when there's a failure in `approve()`. The function signature has a `boolean` return value and they indicate errors that way instead. By not checking the return value, operations that should have marked as failed, may potentially go through without actually approving anything\n\n*There is 1 instance of this issue:*\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrow.sol   #1\n\n25:           IERC20(rewardToken_).approve(msg.sender, type(uint256).max);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L25\n\n## [N-03] Large multiples of ten should use scientific notation (e.g. `1e6`) rather than decimal literals (e.g. `1000000`), for readability\n\n*There are 2 instances of this issue:*\n```solidity\nFile: protocol/contracts/utils/CvxMintAmount.sol   #1\n\n10:       uint256 private constant _CLIFF_SIZE = 100000 * 1e18; //new cliff every 100,000 tokens\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/CvxMintAmount.sol#L10\n\n```solidity\nFile: protocol/contracts/utils/CvxMintAmount.sol   #2\n\n12:       uint256 private constant _MAX_SUPPLY = 100000000 * 1e18; //100 mil max supply\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/CvxMintAmount.sol#L12\n\n## [N-04] Missing event for critical parameter change\n\n*There are 3 instances of this issue:*\n```solidity\nFile: protocol/contracts/tokenomics/InflationManager.sol   #1\n\n58        function setMinter(address _minter) external override onlyGovernance returns (bool) {\n59            require(minter == address(0), Error.ADDRESS_ALREADY_SET);\n60            require(_minter != address(0), Error.INVALID_MINTER);\n61            minter = _minter;\n62            return true;\n63:       }\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L58-L63\n\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrow.sol   #2\n\n68        function setAdmin(address _admin) external override {\n69            require(_admin != address(0), Error.ZERO_ADDRESS_NOT_ALLOWED);\n70            require(msg.sender == admin, Error.UNAUTHORIZED_ACCESS);\n71            admin = _admin;\n72:       }\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L68-L72\n\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrow.sol   #3\n\n74        function setFundAdmin(address _fundadmin) external override {\n75            require(_fundadmin != address(0), Error.ZERO_ADDRESS_NOT_ALLOWED);\n76            require(msg.sender == admin, Error.UNAUTHORIZED_ACCESS);\n77            fundAdmin = _fundadmin;\n78:       }\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L74-L78\n\n## [N-05] Use a more recent version of solidity\nUse a solidity version of at least 0.8.12 to get `string.concat()` to be used instead of `abi.encodePacked(<str>,<str>)`\n\n*There is 1 instance of this issue:*\n```solidity\nFile: protocol/contracts/tokenomics/InflationManager.sol   #1\n\n2:    pragma solidity 0.8.10;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L2\n\n## [N-06] Use a more recent version of solidity\nUse a solidity version of at least 0.8.13 to get the ability to use `using for` with a list of free functions\n\n*There are 16 instances of this issue:*\n\n[See original submission](https://github.com/code-423n4/2022-05-backd-findings/issues/109) for details.\n\n## [N-07] Constant redefined elsewhere\nConsider defining in only one contract so that values cannot become out of sync when only one location is updated. A [cheap way](https://medium.com/coinmonks/gas-cost-of-solidity-library-functions-dbe0cedd4678) to store constants in a single location is to create an `internal constant` in a `library`. If the variable is a local cache of another contract's value, consider making the cache variable internal or private, which will require external users to query the contract with the source of truth, so that callers don't get out of sync.\n\n*There are 10 instances of this issue:*\n```solidity\nFile: protocol/contracts/Controller.sol\n\n/// @audit seen in protocol/contracts/StakerVault.sol \n21:       IAddressProvider public immutable override addressProvider;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/Controller.sol#L21\n\n```solidity\nFile: protocol/contracts/RewardHandler.sol\n\n/// @audit seen in protocol/contracts/StakerVault.sol \n20:       IController public immutable controller;\n\n/// @audit seen in protocol/contracts/Controller.sol \n21:       IAddressProvider public immutable addressProvider;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L20\n\n```solidity\nFile: protocol/contracts/tokenomics/Minter.sol\n\n/// @audit seen in protocol/contracts/RewardHandler.sol \n55:       IController public immutable controller;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L55\n\n```solidity\nFile: protocol/contracts/tokenomics/InflationManager.sol\n\n/// @audit seen in protocol/contracts/RewardHandler.sol \n24:       IAddressProvider public immutable addressProvider;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L24\n\n```solidity\nFile: protocol/contracts/tokenomics/AmmGauge.sol\n\n/// @audit seen in protocol/contracts/tokenomics/Minter.sol \n20:       IController public immutable controller;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L20\n\n```solidity\nFile: protocol/contracts/tokenomics/KeeperGauge.sol\n\n/// @audit seen in protocol/contracts/tokenomics/AmmGauge.sol \n30:       IController public immutable controller;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L30\n\n```solidity\nFile: protocol/contracts/tokenomics/LpGauge.sol\n\n/// @audit seen in protocol/contracts/tokenomics/KeeperGauge.sol \n19:       IController public immutable controller;\n\n/// @audit seen in protocol/contracts/StakerVault.sol \n21:       IInflationManager public immutable inflationManager;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/LpGauge.sol#L19\n\n```solidity\nFile: protocol/contracts/access/RoleManager.sol\n\n/// @audit seen in protocol/contracts/tokenomics/InflationManager.sol \n25:       IAddressProvider public immutable addressProvider;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/RoleManager.sol#L25\n\n## [N-08] Inconsistent spacing in comments\nSome lines use `// x` and some use `//x`. The instances below point out the usages that don't follow the majority, within each file\n\n*There are 3 instances of this issue:*\n```solidity\nFile: protocol/contracts/utils/CvxMintAmount.sol   #1\n\n11:       uint256 private constant _CLIFF_COUNT = 1000; // 1,000 cliffs\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/CvxMintAmount.sol#L11\n\n```solidity\nFile: protocol/contracts/utils/CvxMintAmount.sol   #2\n\n14:           IERC20(address(0x4e3FBD56CD56c3e72c1403e103b45Db9da5B9D2B)); // CVX Token\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/CvxMintAmount.sol#L14\n\n```solidity\nFile: protocol/contracts/tokenomics/InflationManager.sol   #3\n\n532:      //TOOD: See if this is still needed somewhere\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L532\n\n## [N-09] File is missing NatSpec\n\n*There are 5 instances of this issue:*\n```solidity\nFile: protocol/contracts/utils/CvxMintAmount.sol\n\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/CvxMintAmount.sol\n\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrowRevocable.sol\n\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrowRevocable.sol\n\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrow.sol\n\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol\n\n```solidity\nFile: protocol/contracts/access/Authorization.sol\n\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/Authorization.sol\n\n```solidity\nFile: protocol/contracts/access/RoleManager.sol\n\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/RoleManager.sol\n\n## [N-10] NatSpec is incomplete\n\n*There are 17 instances of this issue:*\n```solidity\nFile: protocol/contracts/StakerVault.sol\n\n/// @audit Missing: '@param strategy'\n93        /**\n94         * @notice Registers an address as a strategy to be excluded from token accumulation.\n95         * @dev This should be used if a strategy deposits into a stakerVault and should not get gov. tokens.\n96         * @return `true` if success.\n97         */\n98:       function addStrategy(address strategy) external override returns (bool) {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L93-L98\n\n```solidity\nFile: protocol/contracts/Controller.sol\n\n/// @audit Missing: '@param payer'\n117       /**\n118        * @return the total amount of ETH require by `payer` to cover the fees for\n119        * positions registered in all actions\n120        */\n121:      function getTotalEthRequiredForGas(address payer) external view override returns (uint256) {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/Controller.sol#L117-L121\n\n```solidity\nFile: protocol/contracts/utils/Preparable.sol\n\n/// @audit Missing: '@param key'\n33        /**\n34         * @notice Prepares an uint256 that should be committed to the contract\n35         * after `_MIN_DELAY` elapsed\n36         * @param value The value to prepare\n37         * @return `true` if success.\n38         */\n39        function _prepare(\n40            bytes32 key,\n41            uint256 value,\n42            uint256 delay\n43:       ) internal returns (bool) {\n\n/// @audit Missing: '@param delay'\n33        /**\n34         * @notice Prepares an uint256 that should be committed to the contract\n35         * after `_MIN_DELAY` elapsed\n36         * @param value The value to prepare\n37         * @return `true` if success.\n38         */\n39        function _prepare(\n40            bytes32 key,\n41            uint256 value,\n42            uint256 delay\n43:       ) internal returns (bool) {\n\n/// @audit Missing: '@param key'\n57        /**\n58         * @notice Prepares an address that should be committed to the contract\n59         * after `_MIN_DELAY` elapsed\n60         * @param value The value to prepare\n61         * @return `true` if success.\n62         */\n63        function _prepare(\n64            bytes32 key,\n65            address value,\n66            uint256 delay\n67:       ) internal returns (bool) {\n\n/// @audit Missing: '@param delay'\n57        /**\n58         * @notice Prepares an address that should be committed to the contract\n59         * after `_MIN_DELAY` elapsed\n60         * @param value The value to prepare\n61         * @return `true` if success.\n62         */\n63        function _prepare(\n64            bytes32 key,\n65            address value,\n66            uint256 delay\n67:       ) internal returns (bool) {\n\n/// @audit Missing: '@param key'\n81        /**\n82         * @notice Reset a uint256 key\n83         * @return `true` if success.\n84         */\n85:       function _resetUInt256Config(bytes32 key) internal returns (bool) {\n\n/// @audit Missing: '@param key'\n93        /**\n94         * @notice Reset an address key\n95         * @return `true` if success.\n96         */\n97:       function _resetAddressConfig(bytes32 key) internal returns (bool) {\n\n/// @audit Missing: '@param key'\n115       /**\n116        * @notice Execute uint256 config update (with time delay enforced).\n117        * @dev Needs to be called after the update was prepared. Fails if called before time delay is met.\n118        * @return New value.\n119        */\n120:      function _executeUInt256(bytes32 key) internal returns (uint256) {\n\n/// @audit Missing: '@param key'\n127       /**\n128        * @notice Execute address config update (with time delay enforced).\n129        * @dev Needs to be called after the update was prepared. Fails if called before time delay is met.\n130        * @return New value.\n131        */\n132:      function _executeAddress(bytes32 key) internal returns (address) {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/Preparable.sol#L33-L43\n\n```solidity\nFile: protocol/contracts/AddressProvider.sol\n\n/// @audit Missing: '@return'\n79         * @param action Address of action to add.\n80         */\n81:       function addAction(address action) external override onlyGovernance returns (bool) {\n\n/// @audit Missing: '@param freezable'\n207       /**\n208        * @notice Initializes an address\n209        * @param key Key to initialize\n210        * @param initialAddress Address for `key`\n211        */\n212       function initializeAddress(\n213           bytes32 key,\n214           address initialAddress,\n215           bool freezable\n216:      ) public override onlyGovernance {\n\n/// @audit Missing: '@param key'\n264       /**\n265        * @notice Execute update of `key`\n266        * @return New address.\n267        */\n268:      function executeAddress(bytes32 key) external override returns (address) {\n\n/// @audit Missing: '@param key'\n274       /**\n275        * @notice Reset `key`\n276        * @return true if it was reset\n277        */\n278:      function resetAddress(bytes32 key) external override onlyGovernance returns (bool) {\n\n/// @audit Missing: '@param token'\n396       /**\n397        * @notice Tries to get the staker vault for a given token but does not throw if it does not exist\n398        * @return A boolean set to true if the vault exists and the vault address.\n399        */\n400:      function tryGetStakerVault(address token) external view override returns (bool, address) {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/AddressProvider.sol#L79-L81\n\n```solidity\nFile: protocol/contracts/tokenomics/InflationManager.sol\n\n/// @audit Missing: '@param lpToken'\n236       /**\n237        * @notice Execute update of lp pool weight (with time delay enforced).\n238        * @dev Needs to be called after the update was prepared. Fails if called before time delay is met.\n239        * @return New lp pool weight.\n240        */\n241:      function executeLpPoolWeight(address lpToken) external override returns (uint256) {\n\n/// @audit Missing: '@param token'\n321       /**\n322        * @notice Execute update of lp pool weight (with time delay enforced).\n323        * @dev Needs to be called after the update was prepared. Fails if called before time delay is met.\n324        * @return New lp pool weight.\n325        */\n326:      function executeAmmTokenWeight(address token) external override returns (uint256) {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L236-L241\n\n## [N-11] Event is missing `indexed` fields\nEach `event` should use three `indexed` fields if there are three or more fields\n\n*There are 10 instances of this issue:*\n\n[See original submission](https://github.com/code-423n4/2022-05-backd-findings/issues/109) for details.\n\n## [N-12] Not using the named return variables anywhere in the function is confusing\nConsider changing the variable to be an unnamed one\n\n*There are 2 instances of this issue:*\n```solidity\nFile: protocol/contracts/tokenomics/FeeBurner.sol   #1\n\n/// @audit received\n43        function burnToTarget(address[] memory tokens_, address targetLpToken_)\n44            public\n45            payable\n46            override\n47:           returns (uint256 received)\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L43-L47\n\n```solidity\nFile: protocol/contracts/tokenomics/FeeBurner.sol   #2\n\n/// @audit received\n96        function _depositInPool(address underlying_, ILiquidityPool pool_)\n97            internal\n98:           returns (uint256 received)\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L96-L98\n\n## [N-13] Typos\n\n*There are 6 instances of this issue:*\n```solidity\nFile: protocol/contracts/BkdLocker.sol\n\n/// @audit invlude\n173:       * @dev This does not invlude the gov. tokens queued for withdrawal.\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L173\n\n```solidity\nFile: protocol/contracts/tokenomics/InflationManager.sol\n\n/// @audit TOOD\n532:      //TOOD: See if this is still needed somewhere\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L532\n\n```solidity\nFile: protocol/contracts/tokenomics/FeeBurner.sol\n\n/// @audit Emmited\n29:       event Burned(address targetLpToken, uint256 amountBurned); // Emmited after a successfull burn to target lp token\n\n/// @audit successfull\n29:       event Burned(address targetLpToken, uint256 amountBurned); // Emmited after a successfull burn to target lp token\n\n/// @audit Recieve\n35:       receive() external payable {} // Recieve function for withdrawing from Backd ETH Pool\n\n/// @audit Transfering\n84:           // Transfering LP tokens back to sender\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L29\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/109#issuecomment-1159843872):**\n> **1. migrate() still does transfers when the transfer is to the same pool, and this can be done multiple times**<br>\n>Interesting finding, also wonder if this could cause issues with fees, but in lack of POC, I think this is a valid Low Severity finding\n\n> **2. Non-exploitable reentrancy**<br>\n>Agree with severity and finding, would rephrase to \"code doesn't conform to CEI\"\n\n> **3. Users can DOS themselves by executing prepareUnlock(0) many times**<br>\n>This should be downgraded to non-critical because it probably requires tens of thousands of calls, that said the finding is valid\n\n> **4. Unused/empty receive()/fallback() function**<br>\n>I fail to see the need for the extra checks given that the contracts are meant to handle ETH\n\n> **5. safeApprove() is deprecated**<br>\n>Technically valid, however the code is using `safeApprove` correctly, only once, from zero to X\n\n> **6. Missing checks for address(0x0) when assigning values to address state variables**<br>\n>Valid\n\n> **7. _prepareDeadline(), _setConfig(), and _executeDeadline() should be private**<br>\n>Disagree with the alarmist side, but there's validity to this finding.\n\n> **Non-critical Issues**<br>\n>Agree with the findings although it feels like a bot wrote this.\n\n>Overall a really exhaustive report, 3 findings are interesting the rest doesn't stand out, however the thoroughness of the report does.\n\n***\n\n# Gas Optimizations\n\nFor this contest, 41 reports were submitted by wardens detailing gas optimizations. The [report highlighted below](https://github.com/code-423n4/2022-05-backd-findings/issues/108) by **IllIllI** received the top score from the judge.\n\n*The following wardens also submitted reports: [MiloTruck](https://github.com/code-423n4/2022-05-backd-findings/issues/104), [Picodes](https://github.com/code-423n4/2022-05-backd-findings/issues/48), [robee](https://github.com/code-423n4/2022-05-backd-findings/issues/14), [defsec](https://github.com/code-423n4/2022-05-backd-findings/issues/129), [0xKitsune](https://github.com/code-423n4/2022-05-backd-findings/issues/27), [sashik_eth](https://github.com/code-423n4/2022-05-backd-findings/issues/148), [fatherOfBlocks](https://github.com/code-423n4/2022-05-backd-findings/issues/32), [berndartmueller](https://github.com/code-423n4/2022-05-backd-findings/issues/131), [SmartSek](https://github.com/code-423n4/2022-05-backd-findings/issues/154), [Tadashi](https://github.com/code-423n4/2022-05-backd-findings/issues/22), [Dravee](https://github.com/code-423n4/2022-05-backd-findings/issues/70), [djxploit](https://github.com/code-423n4/2022-05-backd-findings/issues/138), [csanuragjain](https://github.com/code-423n4/2022-05-backd-findings/issues/5), [scaraven](https://github.com/code-423n4/2022-05-backd-findings/issues/128), [c3phas](https://github.com/code-423n4/2022-05-backd-findings/issues/140), [Tomio](https://github.com/code-423n4/2022-05-backd-findings/issues/107), [0xkatana](https://github.com/code-423n4/2022-05-backd-findings/issues/16), [0x1f8b](https://github.com/code-423n4/2022-05-backd-findings/issues/17), [SecureZeroX](https://github.com/code-423n4/2022-05-backd-findings/issues/75), [Chom](https://github.com/code-423n4/2022-05-backd-findings/issues/178), [Fitraldys](https://github.com/code-423n4/2022-05-backd-findings/issues/103), [Sm4rty](https://github.com/code-423n4/2022-05-backd-findings/issues/92), [asutorufos](https://github.com/code-423n4/2022-05-backd-findings/issues/61), [hake](https://github.com/code-423n4/2022-05-backd-findings/issues/122), [Randyyy](https://github.com/code-423n4/2022-05-backd-findings/issues/164), [RoiEvenHaim](https://github.com/code-423n4/2022-05-backd-findings/issues/77), [Funen](https://github.com/code-423n4/2022-05-backd-findings/issues/168), [StyxRave](https://github.com/code-423n4/2022-05-backd-findings/issues/59), [Waze](https://github.com/code-423n4/2022-05-backd-findings/issues/127), [oyc_109](https://github.com/code-423n4/2022-05-backd-findings/issues/2), [0xf15ers](https://github.com/code-423n4/2022-05-backd-findings/issues/124), [simon135](https://github.com/code-423n4/2022-05-backd-findings/issues/151), [sach1r0](https://github.com/code-423n4/2022-05-backd-findings/issues/40), [0xNazgul](https://github.com/code-423n4/2022-05-backd-findings/issues/24), [Kaiziron](https://github.com/code-423n4/2022-05-backd-findings/issues/102), [gzeon](https://github.com/code-423n4/2022-05-backd-findings/issues/170), [catchup](https://github.com/code-423n4/2022-05-backd-findings/issues/79), [hansfriese](https://github.com/code-423n4/2022-05-backd-findings/issues/90), [0x29A](https://github.com/code-423n4/2022-05-backd-findings/issues/93), and [delfin454000](https://github.com/code-423n4/2022-05-backd-findings/issues/125).*\n\n| |Issue|Instances|\n|-|:-|:-:|\n| 1 | Multiple `address` mappings can be combined into a single `mapping` of an `address` to a `struct`, where appropriate | 5 |\n| 2 | State variables only set in the constructor should be declared `immutable` | 1 |\n| 3 | State variables can be packed into fewer storage slots | 2 |\n| 4 | State variables should be cached in stack variables rather than re-reading them from storage | 32 |\n| 5 | Multiple accesses of a mapping/array should use a local variable cache | 7 |\n| 6 | The result of external function calls should be cached rather than re-calling the function | 2 |\n| 7 | `<x> += <y>` costs more gas than `<x> = <x> + <y>` for state variables | 14 |\n| 8 | `internal` functions only called once can be inlined to save gas | 6 |\n| 9 | Add `unchecked {}` for subtractions where the operands cannot underflow because of a previous `require()` | 1 |\n| 10 | `<array>.length` should not be looked up in every loop of a `for`-loop | 8 |\n| 11 | `++i`/`i++` should be `unchecked{++i}`/`unchecked{i++}` when it is not possible for them to overflow, as is the case when used in `for`- and `while`-loops | 1 |\n| 12 | `require()`/`revert()` strings longer than 32 bytes cost extra gas | 1 |\n| 13 | Using `bool`s for storage incurs overhead | 7 |\n| 14 | Using `> 0` costs more gas than `!= 0` when used on a `uint` in a `require()` statement | 7 |\n| 15 | Usage of `uints`/`ints` smaller than 32 bytes (256 bits) incurs overhead | 3 |\n| 16 | Using `private` rather than `public` for constants, saves gas | 11 |\n| 17 | Duplicated `require()`/`revert()` checks should be refactored to a modifier or function | 7 |\n| 18 | `require()` or `revert()` statements that check input arguments should be at the top of the function | 3 |\n| 19 | Empty blocks should be removed or emit something | 3 |\n| 20 | Use custom errors rather than `revert()`/`require()` strings to save deployment gas | 109 |\n| 21 | Functions guaranteed to revert when called by normal users can be marked `payable` | 53 |\n\nTotal: 283 instances over 21 issues\n\n## [1] Multiple `address` mappings can be combined into a single `mapping` of an `address` to a `struct`, where appropriate\nSaves a storage slot for the mapping. Depending on the circumstances and sizes of types, can avoid a Gsset (**20000 gas**) per mapping combined. Reads and subsequent writes can also be cheaper when a function requires both values and they both fit in the same storage slot. Finally, if both fields are accessed in the same function, can save **~42 gas per access** due to [not having to recalculate the key's keccak256 hash](https://gist.github.com/IllIllI000/ec23a57daa30a8f8ca8b9681c8ccefb0) (Gkeccak256 - **30 gas**) and that calculation's associated stack operations.\n\n*There are 5 instances of this issue:*\n```solidity\nFile: protocol/contracts/StakerVault.sol\n\n50        mapping(address => uint256) public balances;\n51        mapping(address => uint256) public actionLockedBalances;\n52    \n53:       mapping(address => mapping(address => uint256)) internal _allowances;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L50-L53\n\n```solidity\nFile: protocol/contracts/BkdLocker.sol\n\n27        mapping(address => uint256) public balances;\n28        mapping(address => uint256) public boostFactors;\n29        mapping(address => uint256) public lastUpdated;\n30        mapping(address => WithdrawStash[]) public stashedGovTokens;\n31:       mapping(address => uint256) public totalStashed;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L27-L31\n\n```solidity\nFile: protocol/contracts/tokenomics/AmmGauge.sol\n\n27        mapping(address => uint256) public perUserStakedIntegral;\n28:       mapping(address => uint256) public perUserShare;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L27-L28\n\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrow.sol\n\n44        mapping(address => uint256) public initialLocked;\n45        mapping(address => uint256) public totalClaimed;\n46:       mapping(address => address) public holdingContract;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L44-L46\n\n```solidity\nFile: protocol/contracts/tokenomics/LpGauge.sol\n\n25        mapping(address => uint256) public perUserStakedIntegral;\n26:       mapping(address => uint256) public perUserShare;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/LpGauge.sol#L25-L26\n\n## [2] State variables only set in the constructor should be declared `immutable`\nAvoids a Gsset (**20000 gas**) in the constructor, and replaces each Gwarmacces (**100 gas**) with a `PUSH32` (**3 gas**).\n\n*There is 1 instance of this issue:*\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrow.sol   #1\n\n39:       uint256 public totalTime;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L39\n\n## [3] State variables can be packed into fewer storage slots\nIf variables occupying the same slot are both written the same function or by the constructor, avoids a separate Gsset (**20000 gas**). Reads of the variables can also be cheaper\n\n*There are 2 instances of this issue:*\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrow.sol   #1\n\n/// @audit Variable ordering with 8 slots instead of the current 9:\n/// @audit  uint256(32):totalTime, uint256(32):initialLockedSupply, uint256(32):unallocatedSupply, mapping(32):initialLocked, mapping(32):totalClaimed, mapping(32):holdingContract, address(20):admin, bool(1):initializedSupply, address(20):fundAdmin\n34:       address public admin;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L34\n\n```solidity\nFile: protocol/contracts/tokenomics/KeeperGauge.sol   #2\n\n/// @audit Variable ordering with 5 slots instead of the current 6:\n/// @audit  mapping(32):keeperRecords, mapping(32):perPeriodTotalFees, uint256(32):epoch, mapping(32):perPeriodTotalInflation, uint48(6):lastUpdated, bool(1):killed\n27:       mapping(address => KeeperRecord) public keeperRecords;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L27\n\n## [4] State variables should be cached in stack variables rather than re-reading them from storage\nThe instances below point to the second+ access of a state variable within a function. Caching of a state variable replace each Gwarmaccess (**100 gas**) with a much cheaper stack read. Other less obvious fixes/optimizations include having local memory caches of state variable structs, or having local caches of state variable contracts/addresses.\n\n*There are 32 instances of this issue:*\n```solidity\nFile: protocol/contracts/StakerVault.sol\n\n/// @audit token\n330:          uint256 oldBal = IERC20(token).balanceOf(address(this));\n\n/// @audit token\n333:              ILiquidityPool pool = addressProvider.getPoolForToken(token);\n\n/// @audit token\n337:          IERC20(token).safeTransferFrom(msg.sender, address(this), amount);\n\n/// @audit token\n338:          uint256 staked = IERC20(token).balanceOf(address(this)) - oldBal;\n\n/// @audit token\n375:          uint256 oldBal = IERC20(token).balanceOf(address(this));\n\n/// @audit token\n381:          IERC20(token).safeTransfer(dst, amount);\n\n/// @audit token\n383:          uint256 unstaked = oldBal.uncheckedSub(IERC20(token).balanceOf(address(this)));\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L330\n\n```solidity\nFile: protocol/contracts/BkdLocker.sol\n\n/// @audit totalLockedBoosted\n97:           curRewardTokenData.feeIntegral += amount.scaledDiv(totalLockedBoosted);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L97\n\n```solidity\nFile: protocol/contracts/tokenomics/Minter.sol\n\n/// @audit currentInflationAmountLp\n91:               currentInflationAmountLp +\n\n/// @audit currentInflationAmountLp\n208:                  currentInflationAmountLp +\n\n/// @audit currentInflationAmountKeeper\n92:               currentInflationAmountKeeper +\n\n/// @audit currentInflationAmountKeeper\n209:                  currentInflationAmountKeeper +\n\n/// @audit currentInflationAmountAmm\n93:               currentInflationAmountAmm;\n\n/// @audit currentInflationAmountAmm\n210:                  currentInflationAmountAmm;\n\n/// @audit totalAvailableToNow\n220:          require(newTotalMintedToNow <= totalAvailableToNow, \"Mintable amount exceeded\");\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L91\n\n```solidity\nFile: protocol/contracts/tokenomics/InflationManager.sol\n\n/// @audit minter\n501:          uint256 lpInflationRate = Minter(minter).getLpInflationRate();\n\n/// @audit minter\n511:          uint256 keeperInflationRate = Minter(minter).getKeeperInflationRate();\n\n/// @audit minter\n526:          uint256 ammInflationRate = Minter(minter).getAmmInflationRate();\n\n/// @audit totalKeeperPoolWeight\n517:              totalKeeperPoolWeight;\n\n/// @audit totalKeeperPoolWeight\n575:          totalKeeperPoolWeight = totalKeeperPoolWeight > 0 ? totalKeeperPoolWeight : 0;\n\n/// @audit totalLpPoolWeight\n502:          uint256 poolInflationRate = (currentUInts256[key] * lpInflationRate) / totalLpPoolWeight;\n\n/// @audit totalLpPoolWeight\n589:          totalLpPoolWeight = totalLpPoolWeight > 0 ? totalLpPoolWeight : 0;\n\n/// @audit totalAmmTokenWeight\n528:              totalAmmTokenWeight;\n\n/// @audit totalAmmTokenWeight\n602:          totalAmmTokenWeight = totalAmmTokenWeight > 0 ? totalAmmTokenWeight : 0;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L501\n\n```solidity\nFile: protocol/contracts/tokenomics/AmmGauge.sol\n\n/// @audit ammStakedIntegral\n159:          perUserStakedIntegral[user] = ammStakedIntegral;\n\n/// @audit totalStaked\n90:                   (block.timestamp - uint256(ammLastUpdated))).scaledDiv(totalStaked);\n\n/// @audit totalStaked\n148:              ammStakedIntegral += (currentRate * timeElapsed).scaledDiv(totalStaked);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L159\n\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrow.sol\n\n/// @audit unallocatedSupply\n84:           require(unallocatedSupply > 0, \"No reward tokens in contract\");\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L84\n\n```solidity\nFile: protocol/contracts/tokenomics/KeeperGauge.sol\n\n/// @audit epoch\n87:           keeperRecords[beneficiary].feesInPeriod[epoch] += amount;\n\n/// @audit epoch\n88:           perPeriodTotalFees[epoch] += amount;\n\n/// @audit epoch\n131:              endEpoch = epoch;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L87\n\n```solidity\nFile: protocol/contracts/access/RoleManager.sol\n\n/// @audit _roles[role].members\n148:          return _roles[role].members[account];\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/RoleManager.sol#L148\n\n## [5] Multiple accesses of a mapping/array should use a local variable cache\nThe instances below point to the second+ access of a value inside a mapping/array, within a function. Caching a mapping's value in a local `storage` variable when the value is accessed [multiple times](https://gist.github.com/IllIllI000/ec23a57daa30a8f8ca8b9681c8ccefb0), saves **~42 gas per access** due to not having to recalculate the key's keccak256 hash (Gkeccak256 - **30 gas**) and that calculation's associated stack operations. Caching an array's struct avoids recalculating the array offsets into memory\n\n*There are 7 instances of this issue:*\n```solidity\nFile: protocol/contracts/BkdLocker.sol\n\n/// @audit stashedWithdraws[i]\n142:                  totalAvailableToWithdraw += stashedWithdraws[i].amount;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L142\n\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrow.sol\n\n/// @audit amounts[i]\n96:               address recipient_ = amounts[i].recipient;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L96\n\n```solidity\nFile: protocol/contracts/tokenomics/KeeperGauge.sol\n\n/// @audit keeperRecords[beneficiary]\n84:               keeperRecords[beneficiary].firstEpochSet = true;\n\n/// @audit keeperRecords[beneficiary]\n85:               keeperRecords[beneficiary].nextEpochToClaim = epoch;\n\n/// @audit keeperRecords[beneficiary]\n87:           keeperRecords[beneficiary].feesInPeriod[epoch] += amount;\n\n/// @audit keeperRecords[beneficiary]\n139:          keeperRecords[beneficiary].nextEpochToClaim = endEpoch;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L84\n\n```solidity\nFile: protocol/contracts/access/RoleManager.sol\n\n/// @audit _roles[role]\n148:          return _roles[role].members[account];\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/RoleManager.sol#L148\n\n## [6] The result of external function calls should be cached rather than re-calling the function\nThe instances below point to the second+ call of the function within a single function\n\n*There are 2 instances of this issue:*\n```solidity\nFile: protocol/contracts/StakerVault.sol   #1\n\n/// @audit _controller.addressProvider()\n62:           Authorization(_controller.addressProvider().getRoleManager())\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L62\n\n```solidity\nFile: protocol/contracts/tokenomics/InflationManager.sol   #2\n\n/// @audit i.uncheckedInc()\n121:          for (uint256 i; i < length; i = i.uncheckedInc()) {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L121\n\n## [7] `<x> += <y>` costs more gas than `<x> = <x> + <y>` for state variables\n\n*There are 14 instances of this issue:*\n```solidity\nFile: protocol/contracts/StakerVault.sol\n\n343:              strategiesTotalStaked += staked;\n\n345:              _poolTotalStaked += staked;\n\n392:              strategiesTotalStaked -= unstaked;\n\n394:              _poolTotalStaked -= unstaked;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L343\n\n```solidity\nFile: protocol/contracts/BkdLocker.sol\n\n152:          totalLocked -= totalAvailableToWithdraw;\n\n230:          totalLocked += amount;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L152\n\n```solidity\nFile: protocol/contracts/tokenomics/Minter.sol\n\n154:          issuedNonInflationSupply += amount;\n\n188:          totalAvailableToNow += (currentTotalInflation * (block.timestamp - lastEvent));\n\n218:          totalAvailableToNow += ((block.timestamp - lastEvent) * currentTotalInflation);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L154\n\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrowRevocable.sol\n\n67:           _vestedBefore += vested;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrowRevocable.sol#L67\n\n```solidity\nFile: protocol/contracts/tokenomics/AmmGauge.sol\n\n113:          totalStaked += staked;\n\n135:          totalStaked -= unstaked;\n\n148:              ammStakedIntegral += (currentRate * timeElapsed).scaledDiv(totalStaked);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L113\n\n```solidity\nFile: protocol/contracts/tokenomics/LpGauge.sol\n\n115               poolStakedIntegral += (currentRate * (block.timestamp - poolLastUpdate)).scaledDiv(\n116                   poolTotalStaked\n117:              );\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/LpGauge.sol#L115-L117\n\n## [8] `internal` functions only called once can be inlined to save gas\nNot inlining costs **20 to 40 gas** because of two extra `JUMP` instructions and additional stack operations needed for function calls.\n\n*There are 6 instances of this issue:*\n```solidity\nFile: protocol/contracts/AddressProvider.sol\n\n433:      function _addKnownAddressKey(bytes32 key, AddressProviderMeta.Meta memory meta) internal {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/AddressProvider.sol#L433\n\n```solidity\nFile: protocol/contracts/RewardHandler.sol\n\n62:       function _approve(address token, address spender) internal {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L62\n\n```solidity\nFile: protocol/contracts/tokenomics/KeeperGauge.sol\n\n146:      function _mintRewards(address beneficiary, uint256 amount) internal returns (bool) {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L146\n\n```solidity\nFile: protocol/contracts/tokenomics/FeeBurner.sol\n\n96        function _depositInPool(address underlying_, ILiquidityPool pool_)\n97            internal\n98:           returns (uint256 received)\n\n125:      function _swapperRouter() internal view returns (ISwapperRouter) {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L96-L98\n\n```solidity\nFile: protocol/contracts/tokenomics/LpGauge.sol\n\n106:      function _mintRewards(address beneficiary, uint256 amount) internal {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/LpGauge.sol#L106\n\n## [9] Add `unchecked {}` for subtractions where the operands cannot underflow because of a previous `require()`\n`require(a <= b); x = b - a` => `require(a <= b); unchecked { x = b - a }`\n\n*There is 1 instance of this issue:*\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrow.sol   #1\n\n63:           totalTime = endtime_ - starttime_;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L63\n\n## [10] `<array>.length` should not be looked up in every loop of a `for`-loop\nThe overheads outlined below are _PER LOOP_, excluding the first loop\n* storage arrays incur a Gwarmaccess (**100 gas**)\n* memory arrays use `MLOAD` (**3 gas**)\n* calldata arrays use `CALLDATALOAD` (**3 gas**)\n\nCaching the length changes each of these to a `DUP<N>` (**3 gas**), and gets rid of the extra `DUP<N>` needed to store the stack offset\n\n*There are 8 instances of this issue:*\n```solidity\nFile: protocol/contracts/StakerVault.sol\n\n259:          for (uint256 i; i < actions.length; i = i.uncheckedInc()) {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L259\n\n```solidity\nFile: protocol/contracts/zaps/PoolMigrationZap.sol\n\n22:           for (uint256 i; i < newPools_.length; ++i) {\n\n39:           for (uint256 i; i < oldPoolAddresses_.length; ) {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L22\n\n```solidity\nFile: protocol/contracts/RewardHandler.sol\n\n42:           for (uint256 i; i < pools.length; i = i.uncheckedInc()) {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L42\n\n```solidity\nFile: protocol/contracts/tokenomics/InflationManager.sol\n\n116:          for (uint256 i; i < stakerVaults.length; i = i.uncheckedInc()) {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L116\n\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrow.sol\n\n94:           for (uint256 i; i < amounts.length; i = i.uncheckedInc()) {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L94\n\n```solidity\nFile: protocol/contracts/tokenomics/FeeBurner.sol\n\n56:           for (uint256 i; i < tokens_.length; i = i.uncheckedInc()) {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L56\n\n```solidity\nFile: protocol/contracts/access/RoleManager.sol\n\n82:           for (uint256 i; i < roles.length; i = i.uncheckedInc()) {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/access/RoleManager.sol#L82\n\n## [11] `++i`/`i++` should be `unchecked{++i}`/`unchecked{i++}` when it is not possible for them to overflow, as is the case when used in `for`- and `while`-loops\nThe `unchecked` keyword is new in solidity version 0.8.0, so this only applies to that version or higher, which these instances are. This saves **30-40 gas [per loop](https://gist.github.com/hrkrshnn/ee8fabd532058307229d65dcd5836ddc#the-increment-in-for-loop-post-condition-can-be-made-unchecked)**\n\n*There is 1 instance of this issue:*\n```solidity\nFile: protocol/contracts/zaps/PoolMigrationZap.sol   #1\n\n22:           for (uint256 i; i < newPools_.length; ++i) {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L22\n\n## [12] `require()`/`revert()` strings longer than 32 bytes cost extra gas\n\n*There is 1 instance of this issue:*\n```solidity\nFile: protocol/contracts/tokenomics/Minter.sol   #1\n\n150           require(\n151               issuedNonInflationSupply + amount <= nonInflationDistribution,\n152               \"Maximum non-inflation amount exceeded.\"\n153:          );\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L150-L153\n\n## [13] Using `bool`s for storage incurs overhead\n```solidity\n    // Booleans are more expensive than uint256 or any type that takes up a full\n    // word because each write operation emits an extra SLOAD to first read the\n    // slot's contents, replace the bits taken up by the boolean, and then write\n    // back. This is the compiler's defense against contract upgrades and\n    // pointer aliasing, and it cannot be disabled.\n```\nhttps://github.com/OpenZeppelin/openzeppelin-contracts/blob/58f635312aa21f947cae5f8578638a85aa2519f5/contracts/security/ReentrancyGuard.sol#L23-L27\nUse `uint256(1)` and `uint256(2)` for true/false to avoid a Gwarmaccess (**[100 gas](https://gist.github.com/IllIllI000/1b70014db712f8572a72378321250058)**), and to avoid Gsset (**20000 gas**) when changing from 'false' to 'true', after having been 'true' in the past\n\n*There are 7 instances of this issue:*\n```solidity\nFile: protocol/contracts/StakerVault.sol\n\n58:       mapping(address => bool) public strategies;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L58\n\n```solidity\nFile: protocol/contracts/tokenomics/Minter.sol\n\n41:       bool public initialPeriodEnded;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L41\n\n```solidity\nFile: protocol/contracts/tokenomics/InflationManager.sol\n\n31:       bool public weightBasedKeeperDistributionDeactivated;\n\n41:       mapping(address => bool) public gauges;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L31\n\n```solidity\nFile: protocol/contracts/tokenomics/AmmGauge.sol\n\n31:       bool public killed;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L31\n\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrow.sol\n\n42:       bool public initializedSupply;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L42\n\n```solidity\nFile: protocol/contracts/tokenomics/KeeperGauge.sol\n\n37:       bool public override killed;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L37\n\n## [14] Using `> 0` costs more gas than `!= 0` when used on a `uint` in a `require()` statement\nThis change saves **[6 gas](https://aws1.discourse-cdn.com/business6/uploads/zeppelin/original/2X/3/363a367d6d68851f27d2679d10706cd16d788b96.png)** per instance\n\n*There are 7 instances of this issue:*\n```solidity\nFile: protocol/contracts/BkdLocker.sol\n\n91:           require(amount > 0, Error.INVALID_AMOUNT);\n\n92:           require(totalLockedBoosted > 0, Error.NOT_ENOUGH_FUNDS);\n\n137:          require(length > 0, \"No entries\");\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/BkdLocker.sol#L91\n\n```solidity\nFile: protocol/contracts/tokenomics/AmmGauge.sol\n\n104:          require(amount > 0, Error.INVALID_AMOUNT);\n\n125:          require(amount > 0, Error.INVALID_AMOUNT);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L104\n\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrow.sol\n\n84:           require(unallocatedSupply > 0, \"No reward tokens in contract\");\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L84\n\n```solidity\nFile: protocol/contracts/tokenomics/KeeperGauge.sol\n\n140:          require(totalClaimable > 0, Error.ZERO_TRANSFER_NOT_ALLOWED);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L140\n\n## [15] Usage of `uints`/`ints` smaller than 32 bytes (256 bits) incurs overhead\n> When using elements that are smaller than 32 bytes, your contract’s gas usage may be higher. This is because the EVM operates on 32 bytes at a time. Therefore, if the element is smaller than that, the EVM must use more operations in order to reduce the size of the element from 32 bytes to the desired size.\n\nhttps://docs.soliditylang.org/en/v0.8.11/internals/layout_in_storage.html\nUse a larger size then downcast where needed\n\n*There are 3 instances of this issue:*\n```solidity\nFile: protocol/contracts/StakerVault.sol   #1\n\n295:      function decimals() external view override returns (uint8) {\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L295\n\n```solidity\nFile: protocol/contracts/tokenomics/AmmGauge.sol   #2\n\n32:       uint48 public ammLastUpdated;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L32\n\n```solidity\nFile: protocol/contracts/tokenomics/KeeperGauge.sol   #3\n\n34:       uint48 public lastUpdated;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/KeeperGauge.sol#L34\n\n## [16] Using `private` rather than `public` for constants, saves gas\nIf needed, the value can be read from the verified contract source code. Savings are due to the compiler not having to create non-payable getter functions for deployment calldata, and not adding another entry to the method ID table\n\n*There are 11 instances of this issue:*\n```solidity\nFile: protocol/contracts/tokenomics/Minter.sol\n\n25:       uint256 public immutable initialAnnualInflationRateLp;\n\n26:       uint256 public immutable annualInflationDecayLp;\n\n30:       uint256 public immutable initialPeriodKeeperInflation;\n\n31:       uint256 public immutable initialAnnualInflationRateKeeper;\n\n32:       uint256 public immutable annualInflationDecayKeeper;\n\n36:       uint256 public immutable initialPeriodAmmInflation;\n\n37:       uint256 public immutable initialAnnualInflationRateAmm;\n\n38:       uint256 public immutable annualInflationDecayAmm;\n\n44:       uint256 public immutable nonInflationDistribution;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/Minter.sol#L25\n\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrow.sol\n\n37:       uint256 public immutable startTime;\n\n38:       uint256 public immutable endTime;\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L37\n\n## [17] Duplicated `require()`/`revert()` checks should be refactored to a modifier or function\nSaves deployment costs\n\n*There are 7 instances of this issue:*\n```solidity\nFile: protocol/contracts/StakerVault.sol\n\n223:          require(addressProvider.isAction(msg.sender), Error.UNAUTHORIZED_ACCESS);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/StakerVault.sol#L223\n\n```solidity\nFile: protocol/contracts/utils/Preparable.sol\n\n98:           require(deadlines[key] != 0, Error.NOTHING_PENDING);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/utils/Preparable.sol#L98\n\n```solidity\nFile: protocol/contracts/AddressProvider.sol\n\n260:          require(!meta.frozen, Error.ADDRESS_FROZEN);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/AddressProvider.sol#L260\n\n```solidity\nFile: protocol/contracts/tokenomics/InflationManager.sol\n\n270:              require(IStakerVault(stakerVault).getLpGauge() != address(0), Error.ADDRESS_NOT_FOUND);\n\n365:          require(length == weights.length, \"Invalid length of arguments\");\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L270\n\n```solidity\nFile: protocol/contracts/tokenomics/AmmGauge.sol\n\n125:          require(amount > 0, Error.INVALID_AMOUNT);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/AmmGauge.sol#L125\n\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrow.sol\n\n76:           require(msg.sender == admin, Error.UNAUTHORIZED_ACCESS);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrow.sol#L76\n\n## [18] `require()` or `revert()` statements that check input arguments should be at the top of the function\nChecks that involve constants should come before checks that involve state variables\n\n*There are 3 instances of this issue:*\n```solidity\nFile: protocol/contracts/Controller.sol   #1\n\n35:           require(_inflationManager != address(0), Error.INVALID_ARGUMENT);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/Controller.sol#L35\n\n```solidity\nFile: protocol/contracts/tokenomics/InflationManager.sol   #2\n\n60:           require(_minter != address(0), Error.INVALID_MINTER);\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/InflationManager.sol#L60\n\n```solidity\nFile: protocol/contracts/tokenomics/VestedEscrowRevocable.sol   #3\n\n54:           require(_recipient != treasury, \"Treasury cannot be revoked!\");\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/VestedEscrowRevocable.sol#L54\n\n## [19] Empty blocks should be removed or emit something \nThe code should be refactored such that they no longer exist, or the block should do something useful, such as emitting an event or reverting. If the contract is meant to be extended, the contract should be `abstract` and the function signatures be added without any default implementation. If the block is an empty if-statement block to avoid doing subsequent checks in the else-if/else conditions, the else-if/else conditions should be nested under the negation of the if-statement, because they involve different classes of checks, which may lead to the introduction of errors when the code is later modified (`if(x){}else if(y){...}else{...}` => `if(!x){if(y){...}else{...}}`)\n\n*There are 3 instances of this issue:*\n```solidity\nFile: protocol/contracts/zaps/PoolMigrationZap.sol   #1\n\n31:       receive() external payable {}\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/zaps/PoolMigrationZap.sol#L31\n\n```solidity\nFile: protocol/contracts/RewardHandler.sol   #2\n\n30:       receive() external payable {}\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/RewardHandler.sol#L30\n\n```solidity\nFile: protocol/contracts/tokenomics/FeeBurner.sol   #3\n\n35:       receive() external payable {} // Recieve function for withdrawing from Backd ETH Pool\n```\nhttps://github.com/code-423n4/2022-05-backd/blob/2a5664d35cde5b036074edef3c1369b984d10010/protocol/contracts/tokenomics/FeeBurner.sol#L35\n\n## [20] Use custom errors rather than `revert()`/`require()` strings to save deployment gas\nCustom errors are available from solidity version 0.8.4. The instances below match or exceed that version\n\n*There are 109 instances of this issue:*\n\n[See original submission](https://github.com/code-423n4/2022-05-backd-findings/issues/108) for details.\n\n### 21. Functions guaranteed to revert when called by normal users can be marked `payable`\nIf a function modifier such as `onlyOwner` is used, the function will revert if a normal user tries to pay the function. Marking the function as `payable` will lower the gas cost for legitimate callers because the compiler will not include checks for whether a payment was provided. The extra opcodes avoided are \n`CALLVALUE`(2),`DUP1`(3),`ISZERO`(3),`PUSH2`(3),`JUMPI`(10),`PUSH1`(3),`DUP1`(3),`REVERT`(0),`JUMPDEST`(1),`POP`(2), which costs an average of about **21 gas per call** to the function, in addition to the extra deployment cost\n\n*There are 53 instances of this issue:*\n\n[See original submission](https://github.com/code-423n4/2022-05-backd-findings/issues/108) for details.\n\n**[chase-manning (Backd) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/108#issuecomment-1149597562):**\n>I consider this report to be of particularly high quality.\n\n**[Alex the Entreprenerd (judge) commented](https://github.com/code-423n4/2022-05-backd-findings/issues/108#issuecomment-1159559943):**\n>View a [detailed breakdown](https://github.com/code-423n4/2022-05-backd-findings/issues/108#issuecomment-1159275418) of the judge's considerations.\n\n>This is hands down the best gas report I've ever reviewed, there's only two improvements I'd recommend:\n>- Post all the extra details as separate gists to make it easier to scan vs read\n>- Show total gas saved in one line for each finding\n\n>This would make it easier to score, review for the sponsor and immediately gives a sense of value to the findings\n\n>Additionally a couple of the findings, which are completely valid, would require more detailed POC to be actionable and helpful, hence I gave them no points.\n\n>That said this is the best I've seen so far!\n\n>Total Gas Saved:\n>7415\n\n***\n\n# Disclosures\n\nC4 is an open organization governed by participants in the community.\n\nC4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.\n\nC4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.\n"
}