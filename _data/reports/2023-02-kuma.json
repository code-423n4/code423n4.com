{
  "circa": {
    "title": "KUMA Protocol - Versus contest",
    "sponsor": "KUMA Protocol",
    "slug": "2023-02-kuma",
    "date": "2023-06-23",
    "findings": "https://github.com/code-423n4/2023-02-kuma-findings/issues",
    "contest": 217
  },
  "html": "<h1 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h1>\n<h2 id=\"about-c4\" style=\"position:relative;\"><a href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>About C4</h2>\n<p>Code4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.</p>\n<p>A C4 audit contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.</p>\n<p>During the audit contest outlined in this document, C4 conducted an analysis of the KUMA Protocol smart contract system written in Solidity. The audit contest took place between February 17—February 22 2023.</p>\n<p>Following the C4 audit contest, 3 wardens (<a href=\"https://github.com/alex-ppg\">0xsomeone</a>, 0x52, and hihen) reviewed the mitigations for all identified issues; the mitigation review report is appended below the audit contest report.</p>\n<h2 id=\"wardens\" style=\"position:relative;\"><a href=\"#wardens\" aria-label=\"wardens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wardens</h2>\n<p>In Code4rena’s Versus contests, the competition is limited to a small group of wardens; for this contest, 5 wardens contributed reports:</p>\n<ol>\n<li>0x52</li>\n<li><a href=\"https://github.com/alex-ppg\">0xsomeone</a></li>\n<li><a href=\"https://twitter.com/akshaysrivastv\">AkshaySrivastav</a></li>\n<li><a href=\"https://twitter.com/bin2chen\">bin2chen</a></li>\n<li>hihen</li>\n</ol>\n<p>This contest was judged by <a href=\"https://twitter.com/GalloDaSballo\">Alex the Entreprenerd</a>.</p>\n<p>Final report assembled by <a href=\"https://twitter.com/itsmetechjay\">itsmetechjay</a>.</p>\n<h1 id=\"summary\" style=\"position:relative;\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h1>\n<p>The C4 analysis yielded an aggregated total of 5 unique vulnerabilities. Of these vulnerabilities, 1 received a risk rating in the category of HIGH severity and 4 received a risk rating in the category of MEDIUM severity.</p>\n<p>Additionally, C4 analysis included 4 reports detailing issues with a risk rating of LOW severity or non-critical. There were also 2 reports recommending gas optimizations.</p>\n<p>All of the issues presented here are linked back to their original finding.</p>\n<h1 id=\"scope\" style=\"position:relative;\"><a href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scope</h1>\n<p>The code under review can be found within the <a href=\"https://github.com/code-423n4/2023-02-kuma\">C4 KUMA Protocol contest repository</a>, and is composed of 12 smart contracts and 10 interfaces written in the Solidity programming language and includes 1,655 lines of Solidity code.</p>\n<h1 id=\"severity-criteria\" style=\"position:relative;\"><a href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Severity Criteria</h1>\n<p>C4 assesses the severity of disclosed vulnerabilities based on three primary risk categories: high, medium, and low/non-critical.</p>\n<p>High-level considerations for vulnerabilities span the following key areas when conducting assessments:</p>\n<ul>\n<li>Malicious Input Handling</li>\n<li>Escalation of privileges</li>\n<li>Arithmetic</li>\n<li>Gas use</li>\n</ul>\n<p>For more information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on <a href=\"https://code4rena.com\">the C4 website</a>, specifically our section on <a href=\"https://docs.code4rena.com/awarding/judging-criteria/severity-categorization\">Severity Categorization</a>.</p>\n<h1 id=\"high-risk-findings-1\" style=\"position:relative;\"><a href=\"#high-risk-findings-1\" aria-label=\"high risk findings 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>High Risk Findings (1)</h1>\n<h2 id=\"h-01-transfering-kibtoken-to-yourself-increases-your-balance\" style=\"position:relative;\"><a href=\"#h-01-transfering-kibtoken-to-yourself-increases-your-balance\" aria-label=\"h 01 transfering kibtoken to yourself increases your balance permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/3\">[H-01] TRANSFERING KIBToken TO YOURSELF INCREASES YOUR BALANCE</a></h2>\n<p><em>Submitted by <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/3\">bin2chen</a>, also found by <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/25\">AkshaySrivastav</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/8\">hihen</a>, and <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/2\">0xsomeone</a></em></p>\n<p>Using temporary variables to update balances is a dangerous construction.</p>\n<p>If transferred to yourself, it will cause your balance to increase, thus growing the token balance infinitely.</p>\n<h3 id=\"proof-of-concept\" style=\"position:relative;\"><a href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>KIBToken overrides <code>\\_transfer()</code> to perform the transfer of the token, the code is as follows:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">from</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Errors</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ERC20_TRANSFER_FROM_THE_ZERO_ADDRESS</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">to</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Errors</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ERC20_TRANSER_TO_THE_ZERO_ADDRESS</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">_refreshCumulativeYield</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">_refreshYield</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">startingFromBalance</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">from</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">startingFromBalance</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Errors</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ERC20_TRANSFER_AMOUNT_EXCEEDS_BALANCE</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newFromBalance</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">startingFromBalance</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newToBalance</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">to</span><span class=\"mtk1\">) + </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">previousEpochCumulativeYield_</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_previousEpochCumulativeYield</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newFromBaseBalance</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">WadRayMath</span><span class=\"mtk1\">.</span><span class=\"mtk11\">wadToRay</span><span class=\"mtk1\">(</span><span class=\"mtk12\">newFromBalance</span><span class=\"mtk1\">).</span><span class=\"mtk11\">rayDiv</span><span class=\"mtk1\">(</span><span class=\"mtk12\">previousEpochCumulativeYield_</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newToBaseBalance</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">WadRayMath</span><span class=\"mtk1\">.</span><span class=\"mtk11\">wadToRay</span><span class=\"mtk1\">(</span><span class=\"mtk12\">newToBalance</span><span class=\"mtk1\">).</span><span class=\"mtk11\">rayDiv</span><span class=\"mtk1\">(</span><span class=\"mtk12\">previousEpochCumulativeYield_</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">_totalBaseSupply</span><span class=\"mtk1\"> -= (</span><span class=\"mtk12\">_baseBalances</span><span class=\"mtk1\">[</span><span class=\"mtk12\">from</span><span class=\"mtk1\">] - </span><span class=\"mtk12\">newFromBaseBalance</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">_totalBaseSupply</span><span class=\"mtk1\"> += (</span><span class=\"mtk12\">newToBaseBalance</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">_baseBalances</span><span class=\"mtk1\">[</span><span class=\"mtk12\">to</span><span class=\"mtk1\">]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">_baseBalances</span><span class=\"mtk1\">[</span><span class=\"mtk12\">from</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">newFromBaseBalance</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">_baseBalances</span><span class=\"mtk1\">[</span><span class=\"mtk12\">to</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">newToBaseBalance</span><span class=\"mtk1\">;</span><span class=\"mtk3\">//&lt;--------if from==to,this place Will overwrite the reduction above</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>From the code above we can see that using temporary variables “newToBaseBalance” to update balances.</p>\n<p>Using temporary variables is a dangerous construction.</p>\n<p>If the from and to are the same, the balance[to] update will overwrite the balance[from] update.</p>\n<p>To simplify the example:</p>\n<p>Suppose: balance[alice]=10 ,  and execute transferFrom(from=alice,to=alice,5)</p>\n<p>Define the temporary variable:  temp_variable = balance[alice]=10</p>\n<p>So update the steps as follows:</p>\n<ol>\n<li><code>balance[to=alice] = temp_variable - 5 =5</code></li>\n<li><code>balance[from=alice] = temp_variable + 5 =15</code></li>\n</ol>\n<p>After Alice transferred it to herself, the balance was increased by 5.</p>\n<p>The test code is as follows:</p>\n<p>add to KIBToken.transfer.t.sol</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"soldity\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">    //test from == to</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    function test_transfer_same() public {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _KIBToken.mint(_alice, 10 ether);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        assertEq(_KIBToken.balanceOf(_alice), 10 ether);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.prank(_alice);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _KIBToken.transfer(_alice, 5 ether);   //&lt;-----alice transfer to alice </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        assertEq(_KIBToken.balanceOf(_alice), 15 ether); //&lt;-----increases 5 eth</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span></code></pre>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"console\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">forge test --match test_transfer_same -vvv</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Running 1 test for test/kuma-protocol/kib-token/KIBToken.transfer.t.sol:KIBTokenTransfer</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[PASS] test_transfer_same() (gas: 184320)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Test result: ok. 1 passed; 0 failed; finished in 24.67ms</span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>A more general method is to use:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">balance</span><span class=\"mtk1\">[</span><span class=\"mtk12\">to</span><span class=\"mtk1\">]-=</span><span class=\"mtk12\">amount</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">balance</span><span class=\"mtk1\">[</span><span class=\"mtk12\">from</span><span class=\"mtk1\">]+=</span><span class=\"mtk12\">amount</span></span></span></code></pre>\n<p>In view of the complexity of the amount calculation, if the code is to be easier to read, it is recommended：</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">from</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Errors</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ERC20_TRANSFER_FROM_THE_ZERO_ADDRESS</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">to</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Errors</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ERC20_TRANSER_TO_THE_ZERO_ADDRESS</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">_refreshCumulativeYield</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">_refreshYield</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+       </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">from</span><span class=\"mtk1\"> != </span><span class=\"mtk12\">to</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">startingFromBalance</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">from</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">startingFromBalance</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t            </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Errors</span><span class=\"mtk1\">.</span><span class=\"mtk11\">ERC20_TRANSFER_AMOUNT_EXCEEDS_BALANCE</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newFromBalance</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">startingFromBalance</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newToBalance</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">to</span><span class=\"mtk1\">) + </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">previousEpochCumulativeYield_</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_previousEpochCumulativeYield</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newFromBaseBalance</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">WadRayMath</span><span class=\"mtk1\">.</span><span class=\"mtk11\">wadToRay</span><span class=\"mtk1\">(</span><span class=\"mtk12\">newFromBalance</span><span class=\"mtk1\">).</span><span class=\"mtk11\">rayDiv</span><span class=\"mtk1\">(</span><span class=\"mtk12\">previousEpochCumulativeYield_</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newToBaseBalance</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">WadRayMath</span><span class=\"mtk1\">.</span><span class=\"mtk11\">wadToRay</span><span class=\"mtk1\">(</span><span class=\"mtk12\">newToBalance</span><span class=\"mtk1\">).</span><span class=\"mtk11\">rayDiv</span><span class=\"mtk1\">(</span><span class=\"mtk12\">previousEpochCumulativeYield_</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t            </span><span class=\"mtk12\">_totalBaseSupply</span><span class=\"mtk1\"> -= (</span><span class=\"mtk12\">_baseBalances</span><span class=\"mtk1\">[</span><span class=\"mtk12\">from</span><span class=\"mtk1\">] - </span><span class=\"mtk12\">newFromBaseBalance</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t            </span><span class=\"mtk12\">_totalBaseSupply</span><span class=\"mtk1\"> += (</span><span class=\"mtk12\">newToBaseBalance</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">_baseBalances</span><span class=\"mtk1\">[</span><span class=\"mtk12\">to</span><span class=\"mtk1\">]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t            </span><span class=\"mtk12\">_baseBalances</span><span class=\"mtk1\">[</span><span class=\"mtk12\">from</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">newFromBaseBalance</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t            </span><span class=\"mtk12\">_baseBalances</span><span class=\"mtk1\">[</span><span class=\"mtk12\">to</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">newToBaseBalance</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+       }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/3#issuecomment-1445452678\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The Warden has shown a way to leverage a programming mistake to duplicate an account balances, because this breaks protocol invariants, I agree with High Severity.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/3#issuecomment-1447507279\">m19 (KUMA) confirmed and commented</a>:</strong></p>\n<blockquote>\n<p>We agree that this is a high risk issue and we intend to fix this.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/3#issuecomment-1447507612\">m19 (KUMA) mitigated</a>:</strong></p>\n<blockquote>\n<p><a href=\"https://github.com/code-423n4/2023-02-kuma/pull/3\">https://github.com/code-423n4/2023-02-kuma/pull/3</a></p>\n<p> <strong>Status:</strong> Mitigation confirmed with comments. Full details in reports from <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/18\">0xsomeone</a>, <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/11\">0x52</a>, and <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/4\">hihen</a>.</p>\n</blockquote>\n<hr>\n<h1 id=\"medium-risk-findings-4\" style=\"position:relative;\"><a href=\"#medium-risk-findings-4\" aria-label=\"medium risk findings 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Medium Risk Findings (4)</h1>\n<h2 id=\"m-01-kumabondtokenapprove-should-revert-if-the-owner-of-the-tokenid-is-blacklisted\" style=\"position:relative;\"><a href=\"#m-01-kumabondtokenapprove-should-revert-if-the-owner-of-the-tokenid-is-blacklisted\" aria-label=\"m 01 kumabondtokenapprove should revert if the owner of the tokenid is blacklisted permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/22\">[M-01] <code>KUMABondToken.approve()</code> should revert if the owner of the tokenId is blacklisted</a></h2>\n<p><em>Submitted by <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/22\">hihen</a>, also found by <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/37\">0xsomeone</a></em></p>\n<p>It is still possible for a blacklisted user’s bond token to be approved.</p>\n<h3 id=\"proof-of-concept-1\" style=\"position:relative;\"><a href=\"#proof-of-concept-1\" aria-label=\"proof of concept 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/code-423n4/2023-02-kuma/blob/3f3d2269fcb3437a9f00ffdd67b5029487435b95/src/mcag-contracts/KUMABondToken.sol#L143\">KUMABondToken.approve()</a> only checks if <code>msg.sender</code> and <code>to</code> are not blacklisted. It doesn’t check if the owner of the <code>tokenId</code> is not blacklisted.</p>\n<p>For example, the following scenario allows a blacklisted user’s bond token to be approved:</p>\n<ol>\n<li>User A have a bond token bt1.</li>\n<li>User A calls <code>KUMABondToken.setApprovalForAll(B, true)</code>, and user B can operate on all user A’s bond tokens.</li>\n<li>User A is blacklisted.</li>\n<li>User B calls <code>KUMABondToken.approve(C, bt1)</code> to approve user C to operate on bond token bt1.</li>\n</ol>\n<h3 id=\"tools-used\" style=\"position:relative;\"><a href=\"#tools-used\" aria-label=\"tools used permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>VS Code</p>\n<h3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p><code>KUMABondToken.approve()</code> should revert if the owner of the tokenId is blacklisted:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">diff --git a/src/mcag-contracts/KUMABondToken.sol b/src/mcag-contracts/KUMABondToken.sol</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">index 569a042..906fe7b 100644</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">--- a/src/mcag-contracts/KUMABondToken.sol</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+++ b/src/mcag-contracts/KUMABondToken.sol</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">@@ -146,6 +146,7 @@ contract KUMABondToken is ERC721, Pausable, IKUMABondToken {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">         whenNotPaused</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">         notBlacklisted(to)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">         notBlacklisted(msg.sender)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        notBlacklisted(ERC721.ownerOf(tokenId))</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">     {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">         address owner = ERC721.ownerOf(tokenId);</span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/22#issuecomment-1445451817\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The Warden has shown an inconsistency in implementation for the blacklist functionality.</p>\n<p>Because a transfer would still be broken, due to <code>transferFrom</code> performing a check on all accounts involved, I agree with Medium Severity.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/22#issuecomment-1447505962\">m19 (KUMA) confirmed and commented</a>:</strong></p>\n<blockquote>\n<p>We confirmed this issue in a test and intend to fix it:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">    function test_approve_RevertWhen_TokenOwnerBlacklistedAndApproveCalledByOperator() external {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _kumaBondToken.issueBond(_alice, _bond);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.prank(_alice);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _kumaBondToken.setApprovalForAll(address(this), true);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _blacklist.blacklist(_alice);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.expectRevert(abi.encodeWithSelector(Errors.BLACKLIST_ACCOUNT_IS_BLACKLISTED.selector, _alice));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _kumaBondToken.approve(_bob, 1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span></code></pre>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/3#issuecomment-1447507612\">m19 (KUMA) mitigated</a>:</strong></p>\n<blockquote>\n<p><a href=\"https://github.com/code-423n4/2023-02-kuma/pull/4\">https://github.com/code-423n4/2023-02-kuma/pull/4</a> </p>\n<p> <strong>Status:</strong> Mitigation confirmed by <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/19\">0xsomeone</a>, <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/12\">0x52</a>, and <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/2\">hihen</a>.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-02-kumafeecollectorchangepayees-executes-incorrectly-when-newpayees-contains-duplicate-items\" style=\"position:relative;\"><a href=\"#m-02-kumafeecollectorchangepayees-executes-incorrectly-when-newpayees-contains-duplicate-items\" aria-label=\"m 02 kumafeecollectorchangepayees executes incorrectly when newpayees contains duplicate items permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/13\">[M-02] <code>KUMAFeeCollector.changePayees()</code> executes incorrectly when newPayees contains duplicate items</a></h2>\n<p><em>Submitted by <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/13\">hihen</a>, also found by <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/38\">0xsomeone</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/36\">0x52</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/35\">bin2chen</a>, and <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/34\">AkshaySrivastav</a></em></p>\n<p>When calling <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/3f3d2269fcb3437a9f00ffdd67b5029487435b95/src/kuma-protocol/KUMAFeeCollector.sol#L152\">KUMAFeeCollector.changePayees()</a> with duplicate payees in <code>newPayees</code>, the call is not reverted and the result state will be incorrect.</p>\n<h3 id=\"proof-of-concept-2\" style=\"position:relative;\"><a href=\"#proof-of-concept-2\" aria-label=\"proof of concept 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Contract <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/3f3d2269fcb3437a9f00ffdd67b5029487435b95/src/kuma-protocol/KUMAFeeCollector.sol#L14\">KUMAFeeCollector</a> does not support duplicate payees. The transaction will revert when trying to add duplicate payees in <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/3f3d2269fcb3437a9f00ffdd67b5029487435b95/src/kuma-protocol/KUMAFeeCollector.sol#L77\">addPayee()</a>:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">function addPayee(address payee, uint256 share) external override onlyManager {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    if (_payees.contains(payee)) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        revert Errors.PAYEE_ALREADY_EXISTS();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    ...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}</span></span></code></pre>\n<p>But, function <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/3f3d2269fcb3437a9f00ffdd67b5029487435b95/src/kuma-protocol/KUMAFeeCollector.sol#L152\">KUMAFeeCollector.changePayees()</a> forgets this constraint, which allows duplicate payees to be passed in <code>newPayees</code>. This will cause the contract to record an incorrect state and not work properly.</p>\n<p>For example, if <code>newPayees</code> contains duplicate payee A, all of its shares will be added to <code>_totalShares</code>, but <code>_shares[A]</code> will only record the last one.</p>\n<p>As a result, the sum of all recorded <code>_shares</code> will be less than <code>_totalShares</code>.</p>\n<p>Test code for PoC:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">diff --git a/test/kuma-protocol/KUMAFeeCollector.t.sol b/test/kuma-protocol/KUMAFeeCollector.t.sol</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">index f34d9ff..0b3fe46 100644</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">--- a/test/kuma-protocol/KUMAFeeCollector.t.sol</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+++ b/test/kuma-protocol/KUMAFeeCollector.t.sol</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">@@ -40,6 +40,39 @@ contract KUMAFeeCollectorTest is BaseSetUp {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">         );</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">     }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+    function test_DuplicatePayees() public {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        address[] memory newPayees = new address[](4);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        uint256[] memory newShares = new uint256[](4);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        newPayees[0] = vm.addr(10);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        newPayees[1] = vm.addr(10);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        newPayees[2] = vm.addr(11);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        newPayees[3] = vm.addr(12);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        newShares[0] = 25;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        newShares[1] = 25;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        newShares[2] = 25;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        newShares[3] = 25;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        _KUMAFeeCollector.changePayees(newPayees, newShares);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        // only 3 payees</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        assertEq(_KUMAFeeCollector.getPayees().length, 3);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        // newPayees[0] and newPayees[1] are identical and both are added as payees[0]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        address[] memory payees = _KUMAFeeCollector.getPayees();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        assertEq(payees[0], newPayees[1]);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        assertEq(payees[1], newPayees[2]);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        assertEq(payees[2], newPayees[3]);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        uint256 countedTotalShares = 0;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        for (uint i; i &lt; payees.length; i++) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+            countedTotalShares += _KUMAFeeCollector.getShare(payees[i]);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        // Counted totalShares is 75 (100 - 25)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        assertEq(countedTotalShares, 75);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        // Recorded totalShares is 100</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+        assertEq(_KUMAFeeCollector.getTotalShares(), 100);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">     function test_initialize() public {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">         assertEq(address(_KUMAFeeCollector.getKUMAAddressProvider()), address(_KUMAAddressProvider));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">         assertEq(_KUMAFeeCollector.getRiskCategory(), _RISK_CATEGORY);</span></span></code></pre>\n<p>Outputs:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">forge test -m test_DuplicatePayees</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[⠔] Compiling...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">No files changed, compilation skipped</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Running 1 test for test/kuma-protocol/KUMAFeeCollector.t.sol:KUMAFeeCollectorTest</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[PASS] test_DuplicatePayees() (gas: 259689)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Test result: ok. 1 passed; 0 failed; finished in 7.39ms</span></span></code></pre>\n<h3 id=\"tools-used-1\" style=\"position:relative;\"><a href=\"#tools-used-1\" aria-label=\"tools used 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>VS Code</p>\n<h3 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p><a href=\"https://github.com/code-423n4/2023-02-kuma/blob/3f3d2269fcb3437a9f00ffdd67b5029487435b95/src/kuma-protocol/KUMAFeeCollector.sol#L152\">KUMAFeeCollector.changePayees()</a> should revert if there are duplicates in <code>newPayees</code>:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">diff --git a/src/kuma-protocol/KUMAFeeCollector.sol b/src/kuma-protocol/KUMAFeeCollector.sol</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">index 402cf71..1a9d86d 100644</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">--- a/src/kuma-protocol/KUMAFeeCollector.sol</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+++ b/src/kuma-protocol/KUMAFeeCollector.sol</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">@@ -180,7 +180,9 @@ contract KUMAFeeCollector is IKUMAFeeCollector, UUPSUpgradeable, Initializable {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">             }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">             address payee = newPayees[i];</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">-            _payees.add(payee);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+            if (!_payees.add(payee)) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+                revert Errors.PAYEE_ALREADY_EXISTS();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+            }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">             _shares[payee] = newShares[i];</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">             _totalShares += newShares[i];</span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/13#issuecomment-1447498281\">m19 (KUMA) confirmed and commented</a>:</strong></p>\n<blockquote>\n<p>We confirm this issue and intend to fix it.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/13#issuecomment-1448246343\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The Warden has shown how, due to a lack of checks, an inconsistent setting could be achieved, where the total sum of shares would be higher than what would be effectively distributed.</p>\n<p>While the issue can be solved by changing again, because the finding shows a reasonable way to achieve an inconsistent state, which can cause loss of tokens, I agree with Medium Severity.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/3#issuecomment-1447507612\">m19 (KUMA) mitigated</a>:</strong></p>\n<blockquote>\n<p><a href=\"https://github.com/code-423n4/2023-02-kuma/pull/5\">https://github.com/code-423n4/2023-02-kuma/pull/5</a> </p>\n<p> <strong>Status:</strong> Mitigation confirmed by <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/20\">0xsomeone</a>, <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/13\">0x52</a>, and <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/3\">hihen</a>.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-03-price-feed-in-mcagratefeedgetrate-is-not-sufficiently-validated-and-can-return-stale-price\" style=\"position:relative;\"><a href=\"#m-03-price-feed-in-mcagratefeedgetrate-is-not-sufficiently-validated-and-can-return-stale-price\" aria-label=\"m 03 price feed in mcagratefeedgetrate is not sufficiently validated and can return stale price permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/11\">[M-03] Price feed in <code>MCAGRateFeed#getRate</code> is not sufficiently validated and can return stale price</a></h2>\n<p><em>Submitted by <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/11\">0x52</a></em></p>\n<p><code>MCAGRateFeed#getRate</code> may return stale data.</p>\n<h3 id=\"proof-of-concept-3\" style=\"position:relative;\"><a href=\"#proof-of-concept-3\" aria-label=\"proof of concept 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">    (, int256 answer,,,) = oracle.latestRoundData();</span></span></code></pre>\n<p>getRate only uses answer but never checks the freshness of the data, which can lead to stale bond pricing data. Stale pricing data can lead to bonds being bought and sold on KUMASwap that otherwise should not be available. This would harm KIBToken holders as KUMASwap may accept bond with too low of a coupon and reduce rewards.</p>\n<h3 id=\"recommended-mitigation-steps-3\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-3\" aria-label=\"recommended mitigation steps 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Validate that <code>updatedAt</code> has been updated recently enough:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">-   (, int256 answer,,,) = oracle.latestRoundData();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+   (, int256 answer,,updatedAt,) = oracle.latestRoundData();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+   if (updatedAt &lt; block.timestamp - MAX_DELAY) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+       revert();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+   }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    if (answer &lt; 0) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        return _MIN_RATE_COUPON;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/11#issuecomment-1445452239\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The Warden has shown how, the system will not check for a stale price.</p>\n<p>In times of high network congestion, liquidations or if the feed has any downtime, the protocol may end-up using a stale price which can leak value.</p>\n<p>For these reasons, I agree with Medium Severity.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/11#issuecomment-1447497215\">m19 (KUMA) disagreed with severity and commented</a>:</strong></p>\n<blockquote>\n<p>This issue is tricky: central bank rate updates are not expected more than a handful of times a year, at most. We failed to document this properly and the lack of a fresh <code>updatedAt</code> check was on purpose. </p>\n<p>If we were only transmitting rates when an actual rate change happens, it’s impossible to determine how “fresh” the data should be, a central bank rate change could happen every 3 months or twice a year or any timeframe really. So should the staleness check be 90 days, 180 days etc?</p>\n<p>We agree that the oracle transmitter could just repeat the current rate on a daily or weekly basis instead making a stale data check useful again.</p>\n<p>Because central bank rates are not volatile we still disagree with the severity in this case.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/11#issuecomment-1453307859\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>I empathize with the Sponsor’s answer and agree that in a way the maximum delay for the check is hard to determine, however, it’s important that we acknowledge that the smart contract cannot “defend itself” unless we offer some sort of constraint that avoids it leaking value incorrectly.</p>\n<p>In contrast to the front-run, which can be viewed as a nuance / technicality;</p>\n<p>The lack of a check would allow the bond to be sold for a time that is not intended, this could also have KumaSwap accept bonds for which the yield is no longer competitive.</p>\n<p>I believe the observation from the sponsor to be valid that the changes may be few and far between, however, because the contract relies on the oracle for its decision making, and no check is there to ensure that the decision “makes sense”;</p>\n<p>Given the possibility of:</p>\n<ul>\n<li>Unintended behaviour (selling of bond when that should not be possible)</li>\n<li>Loss of yield as a consequence</li>\n</ul>\n<p>I believe Medium Severity to be the more appropriate of the options.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/11#issuecomment-1456826785\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has added a comment in terms of suggested mitigation:</p>\n<blockquote>\n<p>We agree that the oracle transmitter could just repeat the current rate on a daily or weekly basis instead making a stale data check useful again.</p>\n</blockquote>\n<p>To quote the sponsor, I believe this would be the best course of action. Even thought the rate does not change frequently, its valuable to have a heartbeat to confirm that all systems are working as intended. Better to experience potential downtime for buys/sells than to have systems unknowingly down during an important rate change.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/3#issuecomment-1447507612\">m19 (KUMA) mitigated</a>:</strong></p>\n<blockquote>\n<p><a href=\"https://github.com/code-423n4/2023-02-kuma/pull/6\">https://github.com/code-423n4/2023-02-kuma/pull/6</a></p>\n<p> <strong>Status:</strong> Mitigation confirmed by <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/21\">0xsomeone</a>, <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/14\">0x52</a>, and <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/6\">hihen</a>.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-04-kumaswap-incorrectly-reverts-when-when-_maxcoupons-has-been-reached\" style=\"position:relative;\"><a href=\"#m-04-kumaswap-incorrectly-reverts-when-when-_maxcoupons-has-been-reached\" aria-label=\"m 04 kumaswap incorrectly reverts when when _maxcoupons has been reached permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/10\">[M-04] KUMASwap incorrectly reverts when when <code>_maxCoupons</code> has been reached</a></h2>\n<p><em>Submitted by <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/10\">0x52</a></em></p>\n<p>Selling bonds with coupons that are already accounted will fail unexpectedly.</p>\n<h3 id=\"proof-of-concept-4\" style=\"position:relative;\"><a href=\"#proof-of-concept-4\" aria-label=\"proof of concept 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/code-423n4/2023-02-kuma/blob/3f3d2269fcb3437a9f00ffdd67b5029487435b95/src/kuma-protocol/KUMASwap.sol#L116-L118\">https://github.com/code-423n4/2023-02-kuma/blob/3f3d2269fcb3437a9f00ffdd67b5029487435b95/src/kuma-protocol/KUMASwap.sol#L116-L118</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">    if (_coupons.length() == _maxCoupons) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        revert Errors.MAX_COUPONS_REACHED();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span></code></pre>\n<p>The above lines will cause ALL bonds sales to revert when <code>_coupons.length</code> has reached <code>_maxCoupons</code>. Since bonds may share the same <code>coupon</code>, the swap should continue to accept bonds with a <code>coupon</code> that already exist in the <code>_coupons</code> set.</p>\n<h3 id=\"recommended-mitigation-steps-4\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-4\" aria-label=\"recommended mitigation steps 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>sellBond should only revert if the max length has been reached and bond.coupon doesn’t already exist:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">-   if (_coupons.length() == _maxCoupons) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+   if (_coupons.length() == _maxCoupons &amp;&amp; !_coupons.contains(bond.coupon)) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        revert Errors.MAX_COUPONS_REACHED();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/10#issuecomment-1447491243\">m19 (KUMA) confirmed and commented</a>:</strong></p>\n<blockquote>\n<p>Even though this scenario is unlikely to ever happen we have confirmed this issue in a test:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">    function test_sellBond_WithExistingCouponWhenMaxCouponsReached() external {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _KUMASwap.sellBond(1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        IKUMABondToken.Bond memory bond_ = _bond;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        for (uint256 i; i &lt; 364; i++) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            bond_.coupon = bond_.coupon + 1;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            _KUMABondToken.issueBond(address(this), bond_);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            _KUMASwap.sellBond(i + 2);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _KUMABondToken.issueBond(address(this), _bond);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _KUMASwap.sellBond(365);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span></code></pre>\n<p>We intend to fix this.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/10#issuecomment-1449844072\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown a way in which the system could stop selling coupons due to the handling of duplicate coupons, this relies on a specific condition which may not always happen, for this reason, in lack of an attack that can be used to break the functionality, I agree with Medium Severity.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/3#issuecomment-1447507612\">m19 (KUMA) mitigated</a>:</strong>\n<a href=\"https://github.com/code-423n4/2023-02-kuma/pull/7\">https://github.com/code-423n4/2023-02-kuma/pull/7</a> </p>\n<p> <strong>Status:</strong> Mitigation confirmed by <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/22\">0xsomeone</a>, <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/15\">0x52</a>, and <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/5\">hihen</a>.</p>\n</blockquote>\n<hr>\n<h1 id=\"low-risk-and-non-critical-issues\" style=\"position:relative;\"><a href=\"#low-risk-and-non-critical-issues\" aria-label=\"low risk and non critical issues permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Low Risk and Non-Critical Issues</h1>\n<p>For this contest, 4 reports were submitted by wardens detailing low risk and non-critical issues. The <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/19\">report highlighted below</a> by <strong>0xsomeone</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/18\">0x52</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/14\">hihen</a>, and <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/7\">bin2chen</a>.</em></p>\n<h2 id=\"kbctokensol\" style=\"position:relative;\"><a href=\"#kbctokensol\" aria-label=\"kbctokensol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>KBCToken.sol</code></h2>\n<h3 id=\"kbc-01l-improper-disable-of-initializer-affected-lines-l30\" style=\"position:relative;\"><a href=\"#kbc-01l-improper-disable-of-initializer-affected-lines-l30\" aria-label=\"kbc 01l improper disable of initializer affected lines l30 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KBC-01L: Improper Disable of Initializer (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KBCToken.sol#L30\">L30</a>)</h3>\n<p>The Kuma Protocol repository makes use of the <code>v4.8.1</code> dependency of OpenZeppelin with the <code>Initializer</code> contract being our focus. The contract contains a dedicated <code>_disableInitializers</code> function meant to be invoked by contract <code>constructor</code> implementations in contracts that inherit it, ensuring that the contract cannot be initialized <strong>or re-initialized</strong> in the future. </p>\n<p>In the current implementation, the <code>initializer</code> modifier is simply added to the contract’s <code>constructor</code> which does not disable the initializer properly as it still permits <strong>a re-initialization to occur</strong>. In the current version of the codebase this does not pose an issue as a <code>reinitializer</code> modifier is not in use, however, in a future deployment this may manifest.</p>\n<h2 id=\"kibtokensol\" style=\"position:relative;\"><a href=\"#kibtokensol\" aria-label=\"kibtokensol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>KIBToken.sol</code></h2>\n<h3 id=\"kib-01l-improper-disable-of-initializer-affected-lines-l49\" style=\"position:relative;\"><a href=\"#kib-01l-improper-disable-of-initializer-affected-lines-l49\" aria-label=\"kib 01l improper disable of initializer affected lines l49 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KIB-01L: Improper Disable of Initializer (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L49\">L49</a>)</h3>\n<p>The Kuma Protocol repository makes use of the <code>v4.8.1</code> dependency of OpenZeppelin with the <code>Initializer</code> contract being our focus. The contract contains a dedicated <code>_disableInitializers</code> function meant to be invoked by contract <code>constructor</code> implementations in contracts that inherit it, ensuring that the contract cannot be initialized <strong>or re-initialized</strong> in the future. </p>\n<p>In the current implementation, the <code>initializer</code> modifier is simply added to the contract’s <code>constructor</code> which does not disable the initializer properly as it still permits <strong>a re-initialization to occur</strong>. In the current version of the codebase this does not pose an issue as a <code>reinitializer</code> modifier is not in use, however, in a future deployment this may manifest.</p>\n<h3 id=\"kib-02l-insufficient-initial-epoch-sanitization-affected-lines-l68\" style=\"position:relative;\"><a href=\"#kib-02l-insufficient-initial-epoch-sanitization-affected-lines-l68\" aria-label=\"kib 02l insufficient initial epoch sanitization affected lines l68 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KIB-02L: Insufficient Initial Epoch Sanitization (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L68\">L68</a>)</h3>\n<p>While the <code>KIBToken::setEpochLength</code> function properly evaluates that the <code>epochLength</code> provided is not greater-than (<code>></code>) the <code>MAX_EPOCH_LENGTH</code>, no such sanitization is applied during the <code>KIBToken::initialize</code> function. We advise the <code>initialize</code> function to apply the same logical checks as <code>setEpochLength</code>, potentially refactored to an <code>internal</code> function that both code segments utilize.</p>\n<h3 id=\"kib-03l-discrepant-epoch-inclusivity-definitions-affected-lines-l79-l81-l342-l345\" style=\"position:relative;\"><a href=\"#kib-03l-discrepant-epoch-inclusivity-definitions-affected-lines-l79-l81-l342-l345\" aria-label=\"kib 03l discrepant epoch inclusivity definitions affected lines l79 l81 l342 l345 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KIB-03L: Discrepant Epoch Inclusivity Definitions (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L79-L81\">L79-L81</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L342-L345\">L342-L345</a>)</h3>\n<p>The <code>KIBToken::_getPreviousEpochTimestamp</code> and <code>KIBToken::initialize</code> functions differ in the way they define the “current” and “previous” epoch. In the <code>initialize</code> function, the <code>_lastRefresh</code> is either set to the current <code>block.timestamp</code> or <code>(block.timestamp / epochLength) * epochLength + epochLength</code>, while in the <code>_getPreviousEpochTimestamp</code> function the value yielded is either <code>block.timestamp</code> or <code>(block.timestamp / epochLength) * epochLength</code>. </p>\n<p>We advise either the assignment in <code>initialize</code> to add the <code>epochLength</code> to the current <code>block.timestamp</code> or the <code>_getPreviousEpochTimestamp</code> to subtract the <code>epochLength</code> from the <code>block.timestamp</code>, the former of which we consider standard.</p>\n<h3 id=\"kib-04l-inexistent-enforcement-of-minimums--maximums-in-yield-affected-lines-l331\" style=\"position:relative;\"><a href=\"#kib-04l-inexistent-enforcement-of-minimums--maximums-in-yield-affected-lines-l331\" aria-label=\"kib 04l inexistent enforcement of minimums  maximums in yield affected lines l331 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KIB-04L: Inexistent Enforcement of Minimums / Maximums in Yield (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L331\">L331</a>)</h3>\n<p>The <code>MAX_YIELD</code> constant variable declared in <code>KIBToken</code> remains unutilized. We advise it to be enforced in the <code>_refreshYield</code> function by ensuring that the <code>lowestYield</code> being set is at most equal to <code>MAX_YIELD</code>, in which case the value of <code>MAX_YIELD</code> should be used instead. Additionally, the <code>MIN_YIELD</code> value should be enforced in a similar fashion.</p>\n<h2 id=\"kumaaddressprovidersol\" style=\"position:relative;\"><a href=\"#kumaaddressprovidersol\" aria-label=\"kumaaddressprovidersol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>KUMAAddressProvider.sol</code></h2>\n<h3 id=\"kap-01l-improper-disable-of-initializer-affected-lines-l39\" style=\"position:relative;\"><a href=\"#kap-01l-improper-disable-of-initializer-affected-lines-l39\" aria-label=\"kap 01l improper disable of initializer affected lines l39 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KAP-01L: Improper Disable of Initializer (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAAddressProvider.sol#L39\">L39</a>)</h3>\n<p>The Kuma Protocol repository makes use of the <code>v4.8.1</code> dependency of OpenZeppelin with the <code>Initializer</code> contract being our focus. The contract contains a dedicated <code>_disableInitializers</code> function meant to be invoked by contract <code>constructor</code> implementations in contracts that inherit it, ensuring that the contract cannot be initialized <strong>or re-initialized</strong> in the future. </p>\n<p>In the current implementation, the <code>initializer</code> modifier is simply added to the contract’s <code>constructor</code> which does not disable the initializer properly as it still permits <strong>a re-initialization to occur</strong>. In the current version of the codebase this does not pose an issue as a <code>reinitializer</code> modifier is not in use, however, in a future deployment this may manifest.</p>\n<h2 id=\"kumafeecollectorsol\" style=\"position:relative;\"><a href=\"#kumafeecollectorsol\" aria-label=\"kumafeecollectorsol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>KUMAFeeCollector.sol</code></h2>\n<h3 id=\"kfc-01l-improper-disable-of-initializer-affected-lines-l32\" style=\"position:relative;\"><a href=\"#kfc-01l-improper-disable-of-initializer-affected-lines-l32\" aria-label=\"kfc 01l improper disable of initializer affected lines l32 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KFC-01L: Improper Disable of Initializer (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAFeeCollector.sol#L32\">L32</a>)</h3>\n<p>The Kuma Protocol repository makes use of the <code>v4.8.1</code> dependency of OpenZeppelin with the <code>Initializer</code> contract being our focus. The contract contains a dedicated <code>_disableInitializers</code> function meant to be invoked by contract <code>constructor</code> implementations in contracts that inherit it, ensuring that the contract cannot be initialized <strong>or re-initialized</strong> in the future. </p>\n<p>In the current implementation, the <code>initializer</code> modifier is simply added to the contract’s <code>constructor</code> which does not disable the initializer properly as it still permits <strong>a re-initialization to occur</strong>. In the current version of the codebase this does not pose an issue as a <code>reinitializer</code> modifier is not in use, however, in a future deployment this may manifest.</p>\n<h3 id=\"kfc-02l-improper-release-event-affected-lines-l88-l160\" style=\"position:relative;\"><a href=\"#kfc-02l-improper-release-event-affected-lines-l88-l160\" aria-label=\"kfc 02l improper release event affected lines l88 l160 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KFC-02L: Improper Release Event (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAFeeCollector.sol#L88\">L88</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAFeeCollector.sol#L160\">L160</a>)</h3>\n<p>The <code>KUMAFeeCollector::addPayee</code> and <code>KUMAFeeCollector::changePayees</code> functions may operate on an empty <code>_payees</code> data entry. In such a case, if funds to-be distributed are present in the contract the <code>KUMAFeeCollector::_releaseIfAvailableIncome</code> function will incorrectly execute <code>KUMAFeeCollector::_release</code> which in turn will emit the <code>FeeReleased</code> event for the available income. We advise the <code>_releaseIfAvailableIncome</code> function to be invoked solely when <code>_payees.length()</code> is non-zero in the referenced instances as otherwise incorrect events may be emitted in <code>addPayee</code> and <code>changePayees</code>.</p>\n<h3 id=\"kfc-03l-inexistent-duplicate-entry-prevention-affected-lines-l175-l180\" style=\"position:relative;\"><a href=\"#kfc-03l-inexistent-duplicate-entry-prevention-affected-lines-l175-l180\" aria-label=\"kfc 03l inexistent duplicate entry prevention affected lines l175 l180 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KFC-03L: Inexistent Duplicate Entry Prevention (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAFeeCollector.sol#L175-L180\">L175-L180</a>)</h3>\n<p>The <code>KUMAFeeCollector::changePayees</code> function does not adequately sanitize the new payees, permitting duplicate entries to exist which will cause the contract to significantly misbehave as it would track the <code>_totalShares</code> incorrectly, and perform two payouts with the latest <code>newShares[i]</code> value. We advise the code to add a new <code>if</code> conditional which causes the code to fail if <code>_payees.contains(newPayees[i])</code> evaluates to <code>true</code>.</p>\n<h2 id=\"kumaswapsol\" style=\"position:relative;\"><a href=\"#kumaswapsol\" aria-label=\"kumaswapsol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>KUMASwap.sol</code></h2>\n<h3 id=\"ksp-01l-inexistent-limitation-of-variable-fee-affected-lines-l360\" style=\"position:relative;\"><a href=\"#ksp-01l-inexistent-limitation-of-variable-fee-affected-lines-l360\" aria-label=\"ksp 01l inexistent limitation of variable fee affected lines l360 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KSP-01L: Inexistent Limitation of Variable Fee (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMASwap.sol#L360\">L360</a>)</h3>\n<p>The <code>KUMASwap::setFees</code> function does not apply any sanitization on the <code>variableFee</code> value, permitting a fee to be applied that exceeds the 100% value of the bond (i.e. <code>PercentageMath::PERCENTAGE_FACTOR</code>). We advise the <code>variableFee</code> input variable of <code>setFees</code> to be validated as less than <code>PERCENTAGE_FACTOR</code> and preferably less than a stricter value (i.e. 20%) to ensure unfair fees are not applied in the protocol. </p>\n<p>This finding also ties in with the slippage-related vulnerability submitted in a separate exhibit whereby a user could submit a transaction with a blockchain state that applies a 5% fee and the fee could change between the transaction’s submission and the transaction’s execution by the network.</p>\n<h3 id=\"ksp-02l-inexistent-limitation-of-bond-fee-affected-lines-l636-l643\" style=\"position:relative;\"><a href=\"#ksp-02l-inexistent-limitation-of-bond-fee-affected-lines-l636-l643\" aria-label=\"ksp 02l inexistent limitation of bond fee affected lines l636 l643 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KSP-02L: Inexistent Limitation of Bond Fee (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMASwap.sol#L636-L643\">L636-L643</a>)</h3>\n<p>The <code>KUMASwap::_calculateFees</code> function does not apply adequate sanitization to the <code>fee</code> that is ultimately applied to the <code>amount</code> which can potentially exceed it due to the presence of a <code>_fixedFee</code>. We advise the code to mandate that the final <code>fee</code> calculated does not exceed the <code>amount</code> supplied as an argument and to fail in such a case.</p>\n<h3 id=\"ksp-03l-improper-disable-of-initializer-affected-lines-l78\" style=\"position:relative;\"><a href=\"#ksp-03l-improper-disable-of-initializer-affected-lines-l78\" aria-label=\"ksp 03l improper disable of initializer affected lines l78 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KSP-03L: Improper Disable of Initializer (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMASwap.sol#L78\">L78</a>)</h3>\n<p>The Kuma Protocol repository makes use of the <code>v4.8.1</code> dependency of OpenZeppelin with the <code>Initializer</code> contract being our focus. The contract contains a dedicated <code>_disableInitializers</code> function meant to be invoked by contract <code>constructor</code> implementations in contracts that inherit it, ensuring that the contract cannot be initialized <strong>or re-initialized</strong> in the future. </p>\n<p>In the current implementation, the <code>initializer</code> modifier is simply added to the contract’s <code>constructor</code> which does not disable the initializer properly as it still permits <strong>a re-initialization to occur</strong>. In the current version of the codebase this does not pose an issue as a <code>reinitializer</code> modifier is not in use, however, in a future deployment this may manifest.</p>\n<h3 id=\"ksp-04l-unsafe-casting-of-term-months-affected-lines-l100\" style=\"position:relative;\"><a href=\"#ksp-04l-unsafe-casting-of-term-months-affected-lines-l100\" aria-label=\"ksp 04l unsafe casting of term months affected lines l100 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KSP-04L: Unsafe Casting of Term Months (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMASwap.sol#L100\">L100</a>)</h3>\n<p>The <code>KUMASwap::initialize</code> function casts the result of <code>term / 30 days</code> to a <code>uint16</code> variable unsafely. We advise the casting operation to be performed safely by ensuring that the <code>term / 30 days</code> calculation’s result does not exceed the maximum value that a <code>uint16</code> variable can hold (i.e. <code>type(uint16).max</code>). To note, the built-in safe arithmetic of Solidity <strong>does not protect against casting overflows</strong>.</p>\n<h2 id=\"blacklistsol\" style=\"position:relative;\"><a href=\"#blacklistsol\" aria-label=\"blacklistsol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>Blacklist.sol</code></h2>\n<h3 id=\"blt-01l-inexistent-sanitization-of-state-transitions-affected-lines-l38-l47\" style=\"position:relative;\"><a href=\"#blt-01l-inexistent-sanitization-of-state-transitions-affected-lines-l38-l47\" aria-label=\"blt 01l inexistent sanitization of state transitions affected lines l38 l47 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BLT-01L: Inexistent Sanitization of State Transitions (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/Blacklist.sol#L38\">L38</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/Blacklist.sol#L47\">L47</a>)</h3>\n<p>The <code>Blacklist::blacklist</code> and <code>Blacklist::unBlacklist</code> functions do not ensure that the previous state of a <code>_blacklisted[account]</code> was the opposite of what it is being set to. We advise this sanitization to be applied to prevent misuse of the functions as well as misleading <code>Blacklisted</code> / <code>UnBlacklisted</code> events.</p>\n<h2 id=\"kyctokensol\" style=\"position:relative;\"><a href=\"#kyctokensol\" aria-label=\"kyctokensol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>KYCToken.sol</code></h2>\n<h3 id=\"kyc-01l-weak-definition-of-owner-affected-lines-l49\" style=\"position:relative;\"><a href=\"#kyc-01l-weak-definition-of-owner-affected-lines-l49\" aria-label=\"kyc 01l weak definition of owner affected lines l49 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KYC-01L: Weak Definition of Owner (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/KYCToken.sol#L49\">L49</a>)</h3>\n<p>The <code>KYCToken::mint</code> function accepts a <code>kycData</code> argument that is meant to contain data about a KYC’d person. The <code>kycData</code> contains an <code>owner</code> argument that does not appear to be sanitized, permitting KYC data to be minted to an arbitrary <code>to</code> address when the <code>owner</code> of the <code>kycData</code> may be someone else. We advise the <code>mint</code> function to permit minting of the <code>kycData</code> by either enforcing <code>to</code> to equal the data’s <code>owner</code> member or by not accepting a <code>to</code> argument altogether, minting the <code>kycData</code> directly to its <code>owner</code>.</p>\n<h2 id=\"kumabondtokensol\" style=\"position:relative;\"><a href=\"#kumabondtokensol\" aria-label=\"kumabondtokensol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>KUMABondToken.sol</code></h2>\n<h3 id=\"kbt-01l-potential-approval-blacklist-bypass-affected-lines-l148\" style=\"position:relative;\"><a href=\"#kbt-01l-potential-approval-blacklist-bypass-affected-lines-l148\" aria-label=\"kbt 01l potential approval blacklist bypass affected lines l148 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KBT-01L: Potential Approval Blacklist Bypass (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/KUMABondToken.sol#L148\">L148</a>)</h3>\n<p>The <code>KUMABondToken::approve</code> function will apply a blacklist check on the <code>to</code> as well as <code>msg.sender</code> contextual arguments of the call, however, the actual <code>owner</code> of the <code>tokenId</code> is not validated in contrast to <code>setApprovalForAll</code> which disallows an approval to be made by a party that is in the blacklist.</p>\n<p>While the approval cannot be actuated on by the <code>transferFrom</code> / <code>safeTransferFrom</code> functions as they do validate the <code>from</code> argument, an approval being made on behalf of a blacklisted owner is an undesirable trait. We advise the code to properly apply the blacklist to the <code>owner</code> of the <code>ERC721</code> asset, preventing circumvention of the checks if an operator (i.e. <code>isApprovedForAll</code>) was created by a blacklisted owner before they were included in the blacklist.</p>\n<h2 id=\"mcagaggregatorsol\" style=\"position:relative;\"><a href=\"#mcagaggregatorsol\" aria-label=\"mcagaggregatorsol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>MCAGAggregator.sol</code></h2>\n<h3 id=\"mar-01l-inexistent-sanitization-of-maximum-answer-affected-lines-l69-l72\" style=\"position:relative;\"><a href=\"#mar-01l-inexistent-sanitization-of-maximum-answer-affected-lines-l69-l72\" aria-label=\"mar 01l inexistent sanitization of maximum answer affected lines l69 l72 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MAR-01L: Inexistent Sanitization of Maximum Answer (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/MCAGAggregator.sol#L69-L72\">L69-L72</a>)</h3>\n<p>The <code>MCAGAggregator::setMaxAnswer</code> function does not apply any sanitization on the input <code>newMaxAnswer</code>, permitting even negative values to be set. We advise the function to mandate at least a non-zero <code>newMaxAnswer</code>, applying the same check in the <code>constructor</code> of the contract.</p>\n<h2 id=\"wadraymathsol\" style=\"position:relative;\"><a href=\"#wadraymathsol\" aria-label=\"wadraymathsol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>WadRayMath.sol</code></h2>\n<h3 id=\"wrm-01l-incorrect-code-merge-affected-lines-l127-l137\" style=\"position:relative;\"><a href=\"#wrm-01l-incorrect-code-merge-affected-lines-l127-l137\" aria-label=\"wrm 01l incorrect code merge affected lines l127 l137 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WRM-01L: Incorrect Code Merge (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/libraries/WadRayMath.sol#L127-L137\">L127-L137</a>)</h3>\n<p>The referenced <code>WadRayMath::rayPow</code> implementation is not present in the Aave V3 codebase and is instead merged from the <code>WadRayMath</code> implementation of Aave V1. The Aave V1 implementation is compiled with a <code>pragma</code> statement of <code>^0.5.0</code>, rendering the statements within <code>rayPow</code> performed using unchecked arithmetics in the original implementation.</p>\n<p>We advise the <code>rayPow</code> function’s body to be wrapped in an <code>unchecked</code> code block, replicating the original behavior of <code>WadRayMath</code> in Aave V1. We would like to note that while presently not a vulnerability, code copied from other projects should execute in the same format it originates from.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/19#issuecomment-1446095674\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p><strong>KBC-01L: Improper Disable of Initializer (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KBCToken.sol#L30\">L30</a>)</strong></p>\n<p>I would partially disagree on this, will award a Non-Critical.</p>\n<p><strong>KIB-01L: Improper Disable of Initializer (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L49\">L49</a>)</strong></p>\n<p>See KBC-01L</p>\n<p><strong>KIB-02L: Insufficient Initial Epoch Sanitization (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L68\">L68</a>)</strong></p>\n<p>Low because inconsistent.</p>\n<p><strong>KIB-03L: Discrepant Epoch Inclusivity Definitions (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L79-L81\">L79-L81</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L342-L345\">L342-L345</a>)</strong></p>\n<p>Low because inconsistent.</p>\n<p><strong>KIB-04L: Inexistent Enforcement of Minimums / Maximums in Yield (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L331\">L331</a>)</strong></p>\n<p>Low</p>\n<p><strong>KAP-01L: Improper Disable of Initializer (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAAddressProvider.sol#L39\">L39</a>)</strong></p>\n<p>See KBC-01L</p>\n<p><strong>KFC-01L: Improper Disable of Initializer (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAFeeCollector.sol#L32\">L32</a>)</strong></p>\n<p>See KBC-01L</p>\n<p><strong>KFC-02L: Improper Release Event (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAFeeCollector.sol#L88\">L88</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAFeeCollector.sol#L160\">L160</a>)</strong></p>\n<p>Refactoring</p>\n<p><strong>KFC-03L: Inexistent Duplicate Entry Prevention (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAFeeCollector.sol#L175-L180\">L175-L180</a>)</strong></p>\n<p>Duplicate of <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/13\">13</a></p>\n<p><strong>KSP-01L: Inexistent Limitation of Variable Fee (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMASwap.sol#L360\">L360</a>)</strong></p>\n<p>Low.</p>\n<p><strong>KSP-02L: Inexistent Limitation of Bond Fee (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMASwap.sol#L636-L643\">L636-L643</a>)</strong></p>\n<p>See  KSP-01L</p>\n<p><strong>KSP-03L: Improper Disable of Initializer (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMASwap.sol#L78\">L78</a>)</strong></p>\n<p>See KBC-01L.</p>\n<p><strong>KSP-04L: Unsafe Casting of Term Months (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMASwap.sol#L100\">L100</a>)</strong></p>\n<p>Low.</p>\n<p><strong>BLT-01L: Inexistent Sanitization of State Transitions (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/Blacklist.sol#L38\">L38</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/Blacklist.sol#L47\">L47</a>)</strong></p>\n<p>Refactoring</p>\n<p><strong>KYC-01L: Weak Definition of Owner (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/KYCToken.sol#L49\">L49</a>)</strong></p>\n<p>Low because trusted owner, but worth flagging.</p>\n<p><strong>KBT-01L: Potential Approval Blacklist Bypass (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/KUMABondToken.sol#L148\">L148</a>)</strong></p>\n<p>Duplicate of <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/22\">22</a>.</p>\n<p><strong>MAR-01L: Inexistent Sanitization of Maximum Answer (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/MCAGAggregator.sol#L69-L72\">L69-L72</a>)</strong> </p>\n<p>Low.</p>\n<p><strong>WRM-01L: Incorrect Code Merge (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/libraries/WadRayMath.sol#L127-L137\">L127-L137</a>)</strong></p>\n<p>Low, good flag IMO even in lack of exploit.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/19#issuecomment-1449918551\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Best report by far, great work!</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/3#issuecomment-1447507612\">m19 (KUMA) mitigated</a>:</strong></p>\n<blockquote>\n<p><a href=\"https://github.com/code-423n4/2023-02-kuma/pull/8\">https://github.com/code-423n4/2023-02-kuma/pull/8</a> </p>\n<p> <strong>Status:</strong> Mitigations confirmed with comments. Full details in reports from <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/23\">0xsomeone</a>, <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/16\">0x52</a>, and <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/7\">hihen</a>.</p>\n</blockquote>\n<hr>\n<h1 id=\"gas-optimizations\" style=\"position:relative;\"><a href=\"#gas-optimizations\" aria-label=\"gas optimizations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gas Optimizations</h1>\n<p>For this contest, 2 reports were submitted by wardens detailing gas optimizations. The <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/21\">report highlighted below</a> by <strong>0xsomeone</strong> received the top score from the judge.</p>\n<p><em>The following warden also submitted a report: <a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/24\">hihen</a>.</em></p>\n<h2 id=\"kbctokensol-1\" style=\"position:relative;\"><a href=\"#kbctokensol-1\" aria-label=\"kbctokensol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>KBCToken.sol</code></h2>\n<h3 id=\"kbc-01g-variable-data-location-optimization-affected-lines-l51\" style=\"position:relative;\"><a href=\"#kbc-01g-variable-data-location-optimization-affected-lines-l51\" aria-label=\"kbc 01g variable data location optimization affected lines l51 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KBC-01G: Variable Data Location Optimization (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KBCToken.sol#L51\">L51</a>)</h3>\n<p>The <code>cBond</code> argument of the <code>KBCToken::issueBond</code> function is set as <code>memory</code> whilst the function itself is <code>external</code>. We advise it to be set to <code>calldata</code> optimizing the <code>issueBond</code> function’s execution cost in <code>KUMASwap::buyBond</code>.</p>\n<h3 id=\"kbc-02g-inefficient-variable-declaration-affected-lines-l72\" style=\"position:relative;\"><a href=\"#kbc-02g-inefficient-variable-declaration-affected-lines-l72\" aria-label=\"kbc 02g inefficient variable declaration affected lines l72 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KBC-02G: Inefficient Variable Declaration (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KBCToken.sol#L72\">L72</a>)</h3>\n<p>The <code>KBCToken::redeem</code> function loads the full <code>CloneBond</code> struct into memory only to utilize the <code>cBond.parentId</code> member of it. We advise the <code>_bonds[tokenId].parentId</code> entry to be stored to a <code>uint256</code> variable that is consequently utilized, optimizing the function’s gas cost significantly.</p>\n<h2 id=\"kibtokensol-1\" style=\"position:relative;\"><a href=\"#kibtokensol-1\" aria-label=\"kibtokensol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>KIBToken.sol</code></h2>\n<h3 id=\"kib-01g-unused-private-contract-member-affected-lines-l40\" style=\"position:relative;\"><a href=\"#kib-01g-unused-private-contract-member-affected-lines-l40\" aria-label=\"kib 01g unused private contract member affected lines l40 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KIB-01G: Unused Private Contract Member (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L40\">L40</a>)</h3>\n<p>The referenced <code>_allowances</code> mapping present in the <code>KIBToken</code> implementation remains unused in the codebase. We advise it to be safely omitted as its presence can cause ambiguity with the homonym <code>_allowances</code> mapping of the <code>ERC20Upgradeable</code> implementation of OpenZeppelin.</p>\n<h3 id=\"kib-02g-redundant-external-self-calls-affected-lines-l142-l170-l276-l281\" style=\"position:relative;\"><a href=\"#kib-02g-redundant-external-self-calls-affected-lines-l142-l170-l276-l281\" aria-label=\"kib 02g redundant external self calls affected lines l142 l170 l276 l281 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KIB-02G: Redundant External Self Calls (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L142\">L142</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L170\">L170</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L276\">L276</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L281\">L281</a>)</h3>\n<p>The referenced statements perform an external self-call as they specify <code>this.balanceOf</code> instead of <code>balanceOf</code> directly, instructing the compiler to treat the statement as an external call to the <code>address(this)</code> target. We advise the code to utilize <code>balanceOf</code> directly, avoiding the significant gas overhead of external calls. If the code wishes to be verbose about which implementation it invokes, the <code>this.balanceOf</code> statements can be replaced by <code>KIBToken.balanceOf</code>, instructing the compiler to invoke the <code>KIBToken</code> implementation of <code>balanceOf</code> explicitly.</p>\n<h3 id=\"kib-03g-potential-arithmetic-optimizations-affected-lines-l175-l280-l367\" style=\"position:relative;\"><a href=\"#kib-03g-potential-arithmetic-optimizations-affected-lines-l175-l280-l367\" aria-label=\"kib 03g potential arithmetic optimizations affected lines l175 l280 l367 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KIB-03G: Potential Arithmetic Optimizations (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L175\">L175</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L280\">L280</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L367\">L367</a>)</h3>\n<p>The referenced arithmetic calculations are guaranteed to be performed safely by the conditional clauses whose execution precedes them. We advise them to be wrapped in <code>unchecked</code> code blocks, optimizing their execution. We should note that more calculations can theoretically be performed in <code>unchecked</code> code blocks (i.e. <code>block.timestamp - _lastRefresh</code> in <code>KIBToken::_calculateCumulativeYield</code>), however, the referenced lines are <strong>guaranteed by conditionals rather than logic</strong> to be performed safely and thus their validity is infallible.</p>\n<h2 id=\"kumaaddressprovidersol-1\" style=\"position:relative;\"><a href=\"#kumaaddressprovidersol-1\" aria-label=\"kumaaddressprovidersol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>KUMAAddressProvider.sol</code></h2>\n<h3 id=\"kap-01g-redundant-initializable-import--inheritence-affected-lines-l14\" style=\"position:relative;\"><a href=\"#kap-01g-redundant-initializable-import--inheritence-affected-lines-l14\" aria-label=\"kap 01g redundant initializable import  inheritence affected lines l14 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KAP-01G: Redundant <code>Initializable</code> Import &#x26; Inheritence (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAAddressProvider.sol#L14\">L14</a>)</h3>\n<p>The <code>Initializable</code> contract is part of the <code>UUPSUpgradeable</code> inheritance chain and is also imported and inherited directly by <code>KUMAAddressProvider</code>. We advise it to be safely omitted from the contract’s import list and direct inheritance declarations as it is ineffectual.</p>\n<h2 id=\"kumafeecollectorsol-1\" style=\"position:relative;\"><a href=\"#kumafeecollectorsol-1\" aria-label=\"kumafeecollectorsol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>KUMAFeeCollector.sol</code></h2>\n<h3 id=\"kfc-01g-redundant-initializable-import--inheritence-affected-lines-l14\" style=\"position:relative;\"><a href=\"#kfc-01g-redundant-initializable-import--inheritence-affected-lines-l14\" aria-label=\"kfc 01g redundant initializable import  inheritence affected lines l14 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KFC-01G: Redundant <code>Initializable</code> Import &#x26; Inheritence (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAFeeCollector.sol#L14\">L14</a>)</h3>\n<p>The <code>Initializable</code> contract is part of the <code>UUPSUpgradeable</code> inheritance chain and is also imported and inherited directly by <code>KUMAFeeCollector</code>. We advise it to be safely omitted from the contract’s import list and direct inheritance declarations as it is ineffectual.</p>\n<h3 id=\"kfc-02g-potential-iterator-optimizations-affected-lines-l165-l174-l208\" style=\"position:relative;\"><a href=\"#kfc-02g-potential-iterator-optimizations-affected-lines-l165-l174-l208\" aria-label=\"kfc 02g potential iterator optimizations affected lines l165 l174 l208 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KFC-02G: Potential Iterator Optimizations (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAFeeCollector.sol#L165\">L165</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAFeeCollector.sol#L174\">L174</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAFeeCollector.sol#L208\">L208</a>)</h3>\n<p>The referenced iterator increments / decrements are performed “safely” via Solidity’s built-in safe arithmetic due to the usage of the <code>0.8.17</code> version compiler. We advise the relevant increment / decrement statements to be relocated to the end of their respective <code>for</code> loop and wrapped in an <code>unchecked</code> code block, optimizing their execution.</p>\n<h3 id=\"kfc-03g-inefficient-loop-bounds-affected-lines-l165-l166\" style=\"position:relative;\"><a href=\"#kfc-03g-inefficient-loop-bounds-affected-lines-l165-l166\" aria-label=\"kfc 03g inefficient loop bounds affected lines l165 l166 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KFC-03G: Inefficient Loop Bounds (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAFeeCollector.sol#L165-L166\">L165-L166</a>)</h3>\n<p>The referenced loop iterates from <code>payeesLength</code> to <code>1</code>, however, on each iteration it utilizes the <code>i</code> iterator by subtracting it by <code>1</code>. We advise the iteration to start from <code>payeesLength - 1</code>, apply no conditional for the loop, and contain an <code>if (i == 0) break;</code> statement at the end of the <code>for</code> loop, significantly optimizing the loop’s gas cost.</p>\n<h3 id=\"kfc-04g-inefficient-adjustment-of-storage-variable-affected-lines-l185\" style=\"position:relative;\"><a href=\"#kfc-04g-inefficient-adjustment-of-storage-variable-affected-lines-l185\" aria-label=\"kfc 04g inefficient adjustment of storage variable affected lines l185 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KFC-04G: Inefficient Adjustment of Storage Variable (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAFeeCollector.sol#L185\">L185</a>)</h3>\n<p>The <code>_totalShares</code> variable is updated on each iteration of the <code>newPayees</code> array instead of being assigned to once at the end of the <code>KUMAFeeCollector::changePayees</code> function’s execution. We advise a local <code>totalShares</code> / <code>totalShares_</code> variable to be declared that is incremented on each iteration of the <code>newPayees</code> array. Finally, we advise the <code>_totalShares</code> variable to be updated once after the <code>for</code> loop with the value of <code>totalShares</code> / <code>totalShares_</code>, requiring a single <code>SSTORE</code> operation for the function’s execution.</p>\n<h3 id=\"kfc-05g-potential-arithmetic-optimizations-affected-lines-l136-l138\" style=\"position:relative;\"><a href=\"#kfc-05g-potential-arithmetic-optimizations-affected-lines-l136-l138\" aria-label=\"kfc 05g potential arithmetic optimizations affected lines l136 l138 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KFC-05G: Potential Arithmetic Optimizations (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAFeeCollector.sol#L136\">L136</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAFeeCollector.sol#L138\">L138</a>)</h3>\n<p>The referenced arithmetic calculations are guaranteed to be performed safely by the conditional clauses whose execution precedes them. We advise them to be wrapped in <code>unchecked</code> code blocks, optimizing their execution. We should note that more calculations can theoretically be performed in <code>unchecked</code> code blocks (i.e. <code>_totalShares -= _shares[payee]</code> in <code>KUMAFeeCollector::removePayee</code>), however, the referenced lines are <strong>guaranteed by conditionals rather than logic</strong> to be performed safely and thus their validity is infallible.</p>\n<h3 id=\"kfc-06g-inefficient-loop-limit-evaluation-affected-lines-l208\" style=\"position:relative;\"><a href=\"#kfc-06g-inefficient-loop-limit-evaluation-affected-lines-l208\" aria-label=\"kfc 06g inefficient loop limit evaluation affected lines l208 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KFC-06G: Inefficient Loop Limit Evaluation (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMAFeeCollector.sol#L208\">L208</a>)</h3>\n<p>As loop limits in Solidity are dynamically evaluated when they contain function calls, the referenced <code>length</code> invocation will be repeated on each iteration of the <code>for</code> loop. We advise the <code>length</code> to be cached to a local variable that is consequently utilized for the <code>for</code> loop as it is not expected to change during the <code>KUMAFeeCollector::_release</code> function’s execution.</p>\n<h2 id=\"kumaswapsol-1\" style=\"position:relative;\"><a href=\"#kumaswapsol-1\" aria-label=\"kumaswapsol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>KUMASwap.sol</code></h2>\n<h3 id=\"ksp-01g-unused-named-function-arguments-affected-lines-l561\" style=\"position:relative;\"><a href=\"#ksp-01g-unused-named-function-arguments-affected-lines-l561\" aria-label=\"ksp 01g unused named function arguments affected lines l561 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KSP-01G: Unused Named Function Arguments (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMASwap.sol#L561\">L561</a>)</h3>\n<p>The <code>KUMASwap::onERC721Received</code> function contains named function arguments yet does not utilize them. We advise their explicit names to be omitted. To note, a function signature is defined by the data types and not the variable names. As such, a <code>function</code> declaration of <code>onERC721Received(address, address, uint256, bytes calldata)</code> is entirely valid.</p>\n<h3 id=\"ksp-02g-inefficient-loop-limit-evaluation-affected-lines-l614\" style=\"position:relative;\"><a href=\"#ksp-02g-inefficient-loop-limit-evaluation-affected-lines-l614\" aria-label=\"ksp 02g inefficient loop limit evaluation affected lines l614 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KSP-02G: Inefficient Loop Limit Evaluation (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMASwap.sol#L614\">L614</a>)</h3>\n<p>As loop limits in Solidity are dynamically evaluated when they contain function calls, the referenced <code>length</code> invocation will be repeated on each iteration of the <code>for</code> loop. We advise the <code>length</code> to be cached to a local variable that is consequently utilized for the <code>for</code> loop as it is not expected to change during the <code>KUMASwap::_updateMinCoupon</code> function’s execution.</p>\n<h3 id=\"ksp-03g-potential-arithmetic-optimizations-affected-lines-l587\" style=\"position:relative;\"><a href=\"#ksp-03g-potential-arithmetic-optimizations-affected-lines-l587\" aria-label=\"ksp 03g potential arithmetic optimizations affected lines l587 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KSP-03G: Potential Arithmetic Optimizations (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KUMASwap.sol#L587\">L587</a>)</h3>\n<p>The referenced arithmetic calculations are guaranteed to be performed safely by the conditional clauses whose execution precedes them. We advise them to be wrapped in <code>unchecked</code> code blocks, optimizing their execution. We should note that more calculations can theoretically be performed in <code>unchecked</code> code blocks (i.e. <code>_couponInventory[bond.coupon]</code> in <code>KUMASwap::buyBond</code>), however, the referenced lines are <strong>guaranteed by conditionals rather than logic</strong> to be performed safely and thus their validity is infallible.</p>\n<h2 id=\"kyctokensol-1\" style=\"position:relative;\"><a href=\"#kyctokensol-1\" aria-label=\"kyctokensol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>KYCToken.sol</code></h2>\n<h3 id=\"kyc-01g-non-standard-override-of-transfer-functionality-affected-lines-l119-l121-l126-l132\" style=\"position:relative;\"><a href=\"#kyc-01g-non-standard-override-of-transfer-functionality-affected-lines-l119-l121-l126-l132\" aria-label=\"kyc 01g non standard override of transfer functionality affected lines l119 l121 l126 l132 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KYC-01G: Non-Standard Override of Transfer Functionality (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/KYCToken.sol#L119-L121\">L119-L121</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/KYCToken.sol#L126-L132\">L126-L132</a>)</h3>\n<p>The <code>KYCToken</code> is meant to represent a non-transferrable token and this is achieved by overriding the relevant <code>transferFrom</code> and <code>safeTransferFrom</code> functions of the <code>ERC721</code> dependency of OpenZeppelin. However, the current mechanism only overrides <code>transferFrom(address, address, uint256)</code> and <code>safeTransferFrom(address, address, uint256, bytes memory)</code> and not <code>safeTransferFrom(address, address, uint256)</code>.</p>\n<p>The <code>safeTransferFrom(address, address, uint256)</code> function invokes <code>safeTransferFrom(address, address, uint256, bytes memory)</code> in the code of OpenZeppelin and is protected, however, the current way of preventing transfers is non-standard and non-uniform. We advise the <code>_beforeTokenTransfer</code> hook to be overridden instead, ensuring that regardless of the implementations of <code>ERC721</code> the code will never permit a transfer as the <code>_beforeTokenTransfer</code> hook is guaranteed to be executed in all transfer flows including mint and burn operations.</p>\n<h2 id=\"kumabondtokensol-1\" style=\"position:relative;\"><a href=\"#kumabondtokensol-1\" aria-label=\"kumabondtokensol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>KUMABondToken.sol</code></h2>\n<h3 id=\"kbt-01g-non-standard-override-of-transfer-functionality-affected-lines-l185-l197-l205-l217\" style=\"position:relative;\"><a href=\"#kbt-01g-non-standard-override-of-transfer-functionality-affected-lines-l185-l197-l205-l217\" aria-label=\"kbt 01g non standard override of transfer functionality affected lines l185 l197 l205 l217 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KBT-01G: Non-Standard Override of Transfer Functionality (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/KUMABondToken.sol#L185-L197\">L185-L197</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/KUMABondToken.sol#L205-L217\">L205-L217</a>)</h3>\n<p>The <code>KUMABondToken</code> is meant to represent a blacklist-able and pausable token and this is achieved by overriding the relevant <code>transferFrom</code> and <code>safeTransferFrom</code> functions of the <code>ERC721</code> dependency of OpenZeppelin. However, the current mechanism only overrides <code>transferFrom(address, address, uint256)</code> and <code>safeTransferFrom(address, address, uint256, bytes memory)</code> and not <code>safeTransferFrom(address, address, uint256)</code>.</p>\n<p>The <code>safeTransferFrom(address, address, uint256)</code> function invokes <code>safeTransferFrom(address, address, uint256, bytes memory)</code> in the code of OpenZeppelin and is protected, however, the current way of preventing transfers is non-standard and non-uniform. We advise the <code>_beforeTokenTransfer</code> hook to be overridden instead, ensuring that regardless of the implementations of <code>ERC721</code> the code will apply proper access control to transfers as the <code>_beforeTokenTransfer</code> hook is guaranteed to be executed in all transfer flows including mint and burn operations.</p>\n<h3 id=\"kbt-02g-inconsistent-usage-of-caller--_msgsender-affected-lines-l148-l156-l173-l176-l189-l193-l209-l213\" style=\"position:relative;\"><a href=\"#kbt-02g-inconsistent-usage-of-caller--_msgsender-affected-lines-l148-l156-l173-l176-l189-l193-l209-l213\" aria-label=\"kbt 02g inconsistent usage of caller  _msgsender affected lines l148 l156 l173 l176 l189 l193 l209 l213 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KBT-02G: Inconsistent Usage of Caller / <code>_msgSender</code> (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/KUMABondToken.sol#L148\">L148</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/KUMABondToken.sol#L156\">L156</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/KUMABondToken.sol#L173\">L173</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/KUMABondToken.sol#L176\">L176</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/KUMABondToken.sol#L189\">L189</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/KUMABondToken.sol#L193\">L193</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/KUMABondToken.sol#L209\">L209</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/KUMABondToken.sol#L213\">L213</a>)</h3>\n<p>The codebase of <code>KUMABondToken</code> applies modifier-based access control on transfers and approvals by using the <code>msg.sender</code> value whilst the code of the implementations make use of the <code>_msgSender</code> GSN-compliant method. We advise the style to be standardized to either <code>msg.sender</code> or <code>_msgSender</code> across all instances, the former of which will lead to a gas optimization as it will not incur the gas overhead of invoking an internal function. To note, this does not constitute a vulnerability as the <code>_msgSender</code> implementation of the OpenZeppelin dependency in use yields the <code>msg.sender</code> value.</p>\n<h2 id=\"mcagratefeedsol\" style=\"position:relative;\"><a href=\"#mcagratefeedsol\" aria-label=\"mcagratefeedsol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>MCAGRateFeed.sol</code></h2>\n<h3 id=\"mrf-01g-redundant-initializable-import--inheritence-affected-lines-l13\" style=\"position:relative;\"><a href=\"#mrf-01g-redundant-initializable-import--inheritence-affected-lines-l13\" aria-label=\"mrf 01g redundant initializable import  inheritence affected lines l13 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MRF-01G: Redundant <code>Initializable</code> Import &#x26; Inheritence (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/MCAGRateFeed.sol#L13\">L13</a>)</h3>\n<p>The <code>Initializable</code> contract is part of the <code>UUPSUpgradeable</code> inheritance chain and is also imported and inherited directly by <code>MCAGRateFeed</code>. We advise it to be safely omitted from the contract’s import list and direct inheritance declarations as it is ineffectual.</p>\n<h3 id=\"mrf-02g-conditional-optimization-affected-lines-l92\" style=\"position:relative;\"><a href=\"#mrf-02g-conditional-optimization-affected-lines-l92\" aria-label=\"mrf 02g conditional optimization affected lines l92 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MRF-02G: Conditional Optimization (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/MCAGRateFeed.sol#L92\">L92</a>)</h3>\n<p>The referenced conditional within <code>MCAGRateFeed::getRate</code> will evaluate whether a <code>rate</code> is below the <code>_MIN_RATE_COUPON</code> threshold and yield the value of <code>_MIN_RATE_COUPON</code> instead in such a case. We advise the conditional to be made inclusive, optimizing the code’s gas cost in the case of <code>rate == _MIN_RATE_COUPON</code>. This optimization is possible as inclusive and non-inclusive comparators utilize the same gas thus reducing the code’s gas cost by one <code>JUMP</code> instruction if <code>rate == _MIN_RATE_COUPON</code>.</p>\n<h3 id=\"mrf-03g-potential-arithmetic-optimizations-affected-lines-l87-l89\" style=\"position:relative;\"><a href=\"#mrf-03g-potential-arithmetic-optimizations-affected-lines-l87-l89\" aria-label=\"mrf 03g potential arithmetic optimizations affected lines l87 l89 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MRF-03G: Potential Arithmetic Optimizations (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/MCAGRateFeed.sol#L87\">L87</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/MCAGRateFeed.sol#L89\">L89</a>)</h3>\n<p>The referenced arithmetic calculations are guaranteed to be performed safely by the conditional clauses whose execution precedes them. We advise them to be wrapped in <code>unchecked</code> code blocks, optimizing their execution. The referenced lines are <strong>guaranteed by conditionals rather than logic</strong> to be performed safely and thus their validity is infallible.</p>\n<h2 id=\"mcagaggregatorsol-1\" style=\"position:relative;\"><a href=\"#mcagaggregatorsol-1\" aria-label=\"mcagaggregatorsol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>MCAGAggregator.sol</code></h2>\n<h3 id=\"mar-01g-improperly-empty-chainlink-format-variable-affected-lines-l86\" style=\"position:relative;\"><a href=\"#mar-01g-improperly-empty-chainlink-format-variable-affected-lines-l86\" aria-label=\"mar 01g improperly empty chainlink format variable affected lines l86 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MAR-01G: Improperly Empty Chainlink Format Variable (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/MCAGAggregator.sol#L86\">L86</a>)</h3>\n<p>The <code>MCAGAggregator::latestRoundData</code> function is meant to conform to the Chainlink paradigm and while it does fill in both the <code>roundId</code> and <code>answeredInRound</code> variables (the latter being irrelevant to the Kuma Protocol), the function does not fill in the <code>startedAt</code> value. We advise the <code>startedAt</code> value to be set to the same value as <code>updatedAt</code>, replicating the Chainlink paradigm and ensuring users of the <code>latestRoundData</code> can apply the same sanitizations regardless of whether they integrate with a Chainlink oracle or with the <code>MCAGAggregator</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/21#issuecomment-1446085318\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p><strong>KBC-01G: Variable Data Location Optimization (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KBCToken.sol#L51\">L51</a>)</strong></p>\n<p>150</p>\n<p><strong>KBC-02G: Inefficient Variable Declaration (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KBCToken.sol#L72\">L72</a>)</strong></p>\n<p>Saves 3 slots from being loaded, that’s 2.1k * 3<br>\n6.3k</p>\n<p><strong>KIB-01G: Unused Private Contract Member (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L40\">L40</a>)</strong></p>\n<p>Valid QA but no meaningful savings</p>\n<p><strong>KIB-02G: Redundant External Self Calls (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L142\">L142</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L170\">L170</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L276\">L276</a>, <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/kuma-protocol/KIBToken.sol#L281\">L281</a>)</strong></p>\n<p>100 per instance = 400</p>\n<p><strong>MAR-01G: Improperly Empty Chainlink Format Variable (Affected Lines: <a href=\"https://github.com/code-423n4/2023-02-kuma/blob/main/src/mcag-contracts/MCAGAggregator.sol#L86\">L86</a>)</strong></p>\n<p>Not a savings finding, but definitely a good suggestion</p>\n<p>Would guesstimate the rest of the optimizations at around 50 / 100 gas each.</p>\n<p>Above 7k saved.</p>\n<p>Great report that is customized to the contest!</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/21#issuecomment-1448228275\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Example of what we want to see more of, amazing work!</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-02-kuma-findings/issues/3#issuecomment-1447507612\">m19 (KUMA) mitigated</a>:</strong></p>\n<blockquote>\n<p><a href=\"https://github.com/code-423n4/2023-02-kuma/pull/9\">https://github.com/code-423n4/2023-02-kuma/pull/9</a> </p>\n<p> <strong>Status:</strong> Mitigations confirmed with comments. Full details in reports from <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/24\">0xsomeone</a>, <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/17\">0x52</a>, and <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/8\">hihen</a>.</p>\n</blockquote>\n<hr>\n<h1 id=\"mitigation-review\" style=\"position:relative;\"><a href=\"#mitigation-review\" aria-label=\"mitigation review permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mitigation Review</h1>\n<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>Following the C4 audit contest, 3 wardens (<a href=\"https://github.com/alex-ppg\">0xsomeone</a>, 0x52, and hihen) reviewed the mitigations for all identified issues. Additional details can be found within the <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest\">C4 KUMA Versus Mitigation Review contest repository</a>.</p>\n<h2 id=\"overview-of-changes\" style=\"position:relative;\"><a href=\"#overview-of-changes\" aria-label=\"overview of changes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview of Changes</h2>\n<p><strong><a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest/blob/main/README.md#overview-of-changes\">Summary from the Sponsor</a>:</strong></p>\n<blockquote>\n<p>This mitigation adds validation to state modifications and oracles in the KIBT, KUMASwap, MCAGRateFeed, and KUMABondToken contracts, in addition to gas optimizations and QA fixes.</p>\n</blockquote>\n<h2 id=\"mitigation-review-scope\" style=\"position:relative;\"><a href=\"#mitigation-review-scope\" aria-label=\"mitigation review scope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mitigation Review Scope</h2>\n<table>\n<thead>\n<tr>\n<th>URL</th>\n<th>Mitigation of</th>\n<th>Purpose</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><a href=\"https://github.com/code-423n4/2023-02-kuma/pull/3\">https://github.com/code-423n4/2023-02-kuma/pull/3</a></td>\n<td>H-01</td>\n<td>This mitigation adds a check disallowing transfer to self in KIBT _transfer</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/code-423n4/2023-02-kuma/pull/4\">https://github.com/code-423n4/2023-02-kuma/pull/4</a></td>\n<td>M-01</td>\n<td>This mitigation adds a check that the owner of a KUMABondToken approve call is not black listed</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/code-423n4/2023-02-kuma/pull/5\">https://github.com/code-423n4/2023-02-kuma/pull/5</a></td>\n<td>M-02</td>\n<td>This mitigation adds a duplicate payees check in KUMAFeeCollector changePayees</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/code-423n4/2023-02-kuma/pull/6\">https://github.com/code-423n4/2023-02-kuma/pull/6</a></td>\n<td>M-03</td>\n<td>This mitigation adds a staleness threshold check to MCAGRateFeed</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/code-423n4/2023-02-kuma/pull/7\">https://github.com/code-423n4/2023-02-kuma/pull/7</a></td>\n<td>M-04</td>\n<td>This mitigation fixes the logic in KUMASwap sellBond revert for when maxCoupons has been reached</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/code-423n4/2023-02-kuma/pull/8\">https://github.com/code-423n4/2023-02-kuma/pull/8</a></td>\n<td>QA</td>\n<td>This mitigation adds QA fixes - see PR for specific fixes</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/code-423n4/2023-02-kuma/pull/9\">https://github.com/code-423n4/2023-02-kuma/pull/9</a></td>\n<td>GAS</td>\n<td>This mitigation adds GAS fixes - see PR for specific fixes</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/code-423n4/2023-02-kuma/pull/10\">https://github.com/code-423n4/2023-02-kuma/pull/10</a></td>\n<td>term-fix</td>\n<td>This mitigation refactors bond.term to months instead of seconds</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"mitigation-review-summary\" style=\"position:relative;\"><a href=\"#mitigation-review-summary\" aria-label=\"mitigation review summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mitigation Review Summary</h2>\n<p>Of the mitigations reviewed, 7 have been confirmed:</p>\n<ul>\n<li>H-01: Mitigation confirmed with comments by <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/18\">0xsomeone</a>, <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/11\">0x52</a>, and <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/4\">hihen</a>.</li>\n<li>M-01: Mitigation confirmed by <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/19\">0xsomeone</a>, <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/12\">0x52</a>, and <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/2\">hihen</a>.</li>\n<li>M-02: Mitigation confirmed by <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/20\">0xsomeone</a>, <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/13\">0x52</a>, and <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/3\">hihen</a>.</li>\n<li>M-03: Mitigation confirmed by <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/21\">0xsomeone</a>, <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/14\">0x52</a>, and <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/6\">hihen</a>.</li>\n<li>M-04: Mitigation confirmed by <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/22\">0xsomeone</a>, <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/15\">0x52</a>, and <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/5\">hihen</a>.</li>\n<li>QA: Mitigation confirmed with comments by <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/23\">0xsomeone</a>, <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/16\">0x52</a>, and <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/7\">hihen</a>.</li>\n<li>Gas: Mitigation confirmed with comments by <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/24\">0xsomeone</a>, <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/17\">0x52</a>, and <a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/8\">hihen</a>.</li>\n</ul>\n<p>The one remaining mitigation introduced a new issue. See full details below.</p>\n<h2 id=\"non-fixed-terms-will-cause-variable-length-bonds-with-the-same-nominal-yield-to-have-different-coupons\" style=\"position:relative;\"><a href=\"#non-fixed-terms-will-cause-variable-length-bonds-with-the-same-nominal-yield-to-have-different-coupons\" aria-label=\"non fixed terms will cause variable length bonds with the same nominal yield to have different coupons permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/26\">Non-fixed terms will cause variable length bonds with the same nominal yield to have different coupons</a></h2>\n<p><em>Submitted by 0x52</em></p>\n<p><a href=\"https://github.com/code-423n4/2023-02-kuma/blob/22fd56b3f0df71714cb71f1ce2585f1c4dd21d64/src/kuma-protocol/KUMASwap.sol#L177-L220\">https://github.com/code-423n4/2023-02-kuma/blob/22fd56b3f0df71714cb71f1ce2585f1c4dd21d64/src/kuma-protocol/KUMASwap.sol#L177-L220</a></p>\n<h3 id=\"vulnerability-details\" style=\"position:relative;\"><a href=\"#vulnerability-details\" aria-label=\"vulnerability details permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerability details</h3>\n<p>Note - The term refactoring has been made for the following reason:</p>\n<p><code>Our main KIBT is intended to be backed by 1-year treasury bill tokens, however, a bond issued on 1 Jan 2023 does not have the same amount of seconds compared to a 1-year treasury bill issued on 1 March 2023, or 1 Jan 2024 etc.</code></p>\n<p>This seems to be a misunderstanding because a 1-year treasury bill is not 1 year in length. It’s actually a 52 week fixed length bond (<a href=\"https://www.treasurydirect.gov/marketable-securities/treasury-bills/\">source</a>), so there’s no need for a change. Second as explained below using the new system will cause compatibility issues for variable length bonds like treasury notes and other non-US bonds.</p>\n<h3 id=\"impact\" style=\"position:relative;\"><a href=\"#impact\" aria-label=\"impact permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>Non-fixed terms will cause variable length bonds with the same nominal yield to have different coupons</p>\n<h3 id=\"proof-of-concept-5\" style=\"position:relative;\"><a href=\"#proof-of-concept-5\" aria-label=\"proof of concept 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Currently coupon is used to track which bonds can and cannot be sold to KUMASwap. Coupon is the amount of yield the bond accumulates per second. Since term is now tracked in months rather than seconds the coupon rate will have to be different between nearly every bond issued. It will also hurt the compatibility of bonds because even when the underlying bond rate doesn’t change, the coupon will have to be adjusted. </p>\n<p><strong>Example:</strong></p>\n<p>There are 31536000 seconds in a calendar year and there are 31622400 seconds in a leap year. This means that bonds that include the end of a leap year will have to have a different (and lower) coupon than bonds with the same yield that don’t include the end of a leap year. This is because bonds that do will have a longer term and even though their yields are the same nominally (i.e. 3.5%) they’re coupons will be different. </p>\n<p>3.5% (non-leap year) => coupon = 1.00000000109085<br>\n3.5% (leap year) => coupon = 1.00000000108785</p>\n<p>The result of this is that bonds that share the same nominal yields will be forced to have different coupons or else their value will be calculated incorrectly. This causes the frustrating problem that two bonds with the same nominal yield will have different coupons if one includes the end of a leap year while the other doesn’t. Since bonds that have a coupon lower than the current rate can’t be sold to KUMA swap these bonds can’t be sold. This becomes increasingly complicated (and more fragmented) the longer the term of the bonds because different issuance dates will includes more or less leap year ends.</p>\n<p>It is also worth considering that different types of bonds will behave differently. As an example T-Bills are fixed length bonds. The “1 year” T-Bill is actually a 52 week fixed length bond. The “2 year” T-Notes are variable length bonds which depends on leap years.</p>\n<h3 id=\"recommended-mitigation-steps-5\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-5\" aria-label=\"recommended mitigation steps 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Even though some bonds should have slightly longer terms (because of leap years) the previous way a tracking using fixed term length in seconds will provide a better user experience and prevent bonds with the same nominal yield from having different coupons.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/26#issuecomment-1480919959\">m19 (KUMA) commented</a>:</strong></p>\n<blockquote>\n<p>This sparked some internal discussions and we are inclined to agree with the warden here. We’ve actually gone as far as reverting back the change completely.</p>\n<p>This helped us realize that our current model only works with fixed-length treasury bills, ie. 13 weeks, 26 weeks, 52 weeks because those are always the same duration. But as pointed out by the warden treasury notes such as the 2year notes are not fixed in length, we found several that were 730 or 731 or even 729 days in length. We will come up with a better solution in a v1.1 or v2 of the protocol to support these.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/26#issuecomment-1481527158\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Am considering the coupon value as well as the duration inaccuracies for:</p>\n<ul>\n<li>Risk of value leak / mispricing</li>\n<li>Inconsistency in behavior between different bonds</li>\n</ul>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/26#issuecomment-1482667661\">m19 (KUMA) commented</a>:</strong></p>\n<blockquote>\n<p>@Alex the Entreprenerd - just a quick question: when you’re talking about the risk of value leak/mispricing, you’re talking about the <code>term-fix</code> branch changes or the original version?</p>\n<p>With the initial codebase (so ignoring the changes made in <code>term-fix</code>) we don’t believe there is a leak of value risk, a different term in seconds would just result in different risk category contracts, and limiting it to fixed term treasury bills (many countries issue these, not just US, but also France for example) will solve this.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/26#issuecomment-1482737930\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>@m19 - Thank you for the info, in order to determine Severity, I’d have to estimate the risk introduced by the change (on the branch <code>term-fix</code>), we can then have a discussion around reverting the change as a recommendation.</p>\n<p>Would you say that <code>term-fix</code> introduced a leak of value or would you say it’s mostly an inconvenience / inconsistency in behaviour?</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/26#issuecomment-1482789908\">m19 (KUMA) commented</a>:</strong></p>\n<blockquote>\n<p>@Alex the Entreprenerd - I do agree there could’ve potentially been a leak of value, for example, if we had started issuing 2-year bonds with a term of <code>24</code> while the actual bonds could’ve been 729, 730, or 731 days in duration. And that was our intention as per the PR description after all. This risk would’ve not been there if we had stuck with the term in seconds since the 729, 730 and 731 bonds would’ve all been in a different risk category.</p>\n<p>The changes to the <code>KUMASwap.sol</code> made it so that <code>bond.term</code> no longer has to be in seconds as it no longer was used for calculations and now could be anything (days, months, years) and thus allow us to group bonds of different durations together.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-03-kuma-mitigation-contest-findings/issues/26#issuecomment-1485042150\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Per the discussion above, the finding has shown the following risk:</p>\n<ul>\n<li>Bonds with the same duration but different coupons</li>\n<li>Which could have caused KumaSwap to behave in an unintended way</li>\n</ul>\n<p>The sponsor is choosing to mitigate by changing <code>bond.term</code> to be expressed in an arbitrary unit which will help standardize and group bonds together.</p>\n<p>The finding has shown a new risk and inconsistent behavior that could have been introduced via the new PR, and for this reason I believe it meets the requirements for Medium Severity.</p>\n</blockquote>\n<hr>\n<h1 id=\"disclosures\" style=\"position:relative;\"><a href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Disclosures</h1>\n<p>C4 is an open organization governed by participants in the community.</p>\n<p>C4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.</p>\n<p>C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>",
  "toc": "<ul>\n<li>\n<p><a href=\"#overview\">Overview</a></p>\n<ul>\n<li><a href=\"#about-c4\">About C4</a></li>\n<li><a href=\"#wardens\">Wardens</a></li>\n</ul>\n</li>\n<li><a href=\"#summary\">Summary</a></li>\n<li><a href=\"#scope\">Scope</a></li>\n<li><a href=\"#severity-criteria\">Severity Criteria</a></li>\n<li>\n<p><a href=\"#high-risk-findings-1\">High Risk Findings (1)</a></p>\n<ul>\n<li><a href=\"#h-01-transfering-kibtoken-to-yourself-increases-your-balance\">[H-01] TRANSFERING KIBToken TO YOURSELF INCREASES YOUR BALANCE</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#medium-risk-findings-4\">Medium Risk Findings (4)</a></p>\n<ul>\n<li><a href=\"#m-01-kumabondtokenapprove-should-revert-if-the-owner-of-the-tokenid-is-blacklisted\">[M-01] <code>KUMABondToken.approve()</code> should revert if the owner of the tokenId is blacklisted</a></li>\n<li><a href=\"#m-02-kumafeecollectorchangepayees-executes-incorrectly-when-newpayees-contains-duplicate-items\">[M-02] <code>KUMAFeeCollector.changePayees()</code> executes incorrectly when newPayees contains duplicate items</a></li>\n<li><a href=\"#m-03-price-feed-in-mcagratefeedgetrate-is-not-sufficiently-validated-and-can-return-stale-price\">[M-03] Price feed in <code>MCAGRateFeed#getRate</code> is not sufficiently validated and can return stale price</a></li>\n<li><a href=\"#m-04-kumaswap-incorrectly-reverts-when-when-_maxcoupons-has-been-reached\">[M-04] KUMASwap incorrectly reverts when when <code>_maxCoupons</code> has been reached</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#low-risk-and-non-critical-issues\">Low Risk and Non-Critical Issues</a></p>\n<ul>\n<li><a href=\"#kbctokensol\"><code>KBCToken.sol</code></a></li>\n<li><a href=\"#kibtokensol\"><code>KIBToken.sol</code></a></li>\n<li><a href=\"#kumaaddressprovidersol\"><code>KUMAAddressProvider.sol</code></a></li>\n<li><a href=\"#kumafeecollectorsol\"><code>KUMAFeeCollector.sol</code></a></li>\n<li><a href=\"#kumaswapsol\"><code>KUMASwap.sol</code></a></li>\n<li><a href=\"#blacklistsol\"><code>Blacklist.sol</code></a></li>\n<li><a href=\"#kyctokensol\"><code>KYCToken.sol</code></a></li>\n<li><a href=\"#kumabondtokensol\"><code>KUMABondToken.sol</code></a></li>\n<li><a href=\"#mcagaggregatorsol\"><code>MCAGAggregator.sol</code></a></li>\n<li><a href=\"#wadraymathsol\"><code>WadRayMath.sol</code></a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#gas-optimizations\">Gas Optimizations</a></p>\n<ul>\n<li><a href=\"#kbctokensol-1\"><code>KBCToken.sol</code></a></li>\n<li><a href=\"#kibtokensol-1\"><code>KIBToken.sol</code></a></li>\n<li><a href=\"#kumaaddressprovidersol-1\"><code>KUMAAddressProvider.sol</code></a></li>\n<li><a href=\"#kumafeecollectorsol-1\"><code>KUMAFeeCollector.sol</code></a></li>\n<li><a href=\"#kumaswapsol-1\"><code>KUMASwap.sol</code></a></li>\n<li><a href=\"#kyctokensol-1\"><code>KYCToken.sol</code></a></li>\n<li><a href=\"#kumabondtokensol-1\"><code>KUMABondToken.sol</code></a></li>\n<li><a href=\"#mcagratefeedsol\"><code>MCAGRateFeed.sol</code></a></li>\n<li><a href=\"#mcagaggregatorsol-1\"><code>MCAGAggregator.sol</code></a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#mitigation-review\">Mitigation Review</a></p>\n<ul>\n<li><a href=\"#introduction\">Introduction</a></li>\n<li><a href=\"#overview-of-changes\">Overview of Changes</a></li>\n<li><a href=\"#mitigation-review-scope\">Mitigation Review Scope</a></li>\n<li><a href=\"#mitigation-review-summary\">Mitigation Review Summary</a></li>\n<li><a href=\"#non-fixed-terms-will-cause-variable-length-bonds-with-the-same-nominal-yield-to-have-different-coupons\">Non-fixed terms will cause variable length bonds with the same nominal yield to have different coupons</a></li>\n</ul>\n</li>\n<li><a href=\"#disclosures\">Disclosures</a></li>\n</ul>"
}