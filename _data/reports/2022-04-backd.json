{
  "circa": {
    "title": "Backd contest",
    "sponsor": "Backd",
    "slug": "2022-04-backd",
    "date": "2022-06-02",
    "findings": "https://github.com/code-423n4/2022-04-backd-findings/issues",
    "contest": 112
  },
  "html": "<h1 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h1>\n<h2 id=\"about-c4\" style=\"position:relative;\"><a href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>About C4</h2>\n<p>Code4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.</p>\n<p>A C4 audit contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.</p>\n<p>During the audit contest outlined in this document, C4 conducted an analysis of the Backd smart contract system written in Solidity. The audit contest took place between April 21—April 27 2022.</p>\n<h2 id=\"wardens\" style=\"position:relative;\"><a href=\"#wardens\" aria-label=\"wardens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wardens</h2>\n<p>62 Wardens contributed reports to the Backd contest:</p>\n<ol>\n<li>unforgiven</li>\n<li>IllIllI</li>\n<li><a href=\"https://twitter.com/WatchPug_\">WatchPug</a></li>\n<li>0xDjango</li>\n<li><a href=\"https://twitter.com/shenwilly_\">shenwilly</a></li>\n<li><a href=\"http://seanseefried.org/blog\">sseefried</a></li>\n<li>0x52</li>\n<li><a href=\"https://twitter.com/0xruhum\">Ruhum</a></li>\n<li><a href=\"https://twitter.com/father0fBl0cks\">fatherOfBlocks</a></li>\n<li><a href=\"https://twitter.com/wuwe19\">wuwe1</a></li>\n<li><a href=\"https://twitter.com/defsec_\">defsec</a></li>\n<li><a href=\"https://twitter.com/JustDravee\">Dravee</a></li>\n<li>horsefacts</li>\n<li>joestakey</li>\n<li><a href=\"https://twitter.com/SolidityDev\">pauliax</a></li>\n<li>StyxRave</li>\n<li><a href=\"https://twitter.com/rayn731\">rayn</a></li>\n<li>hubble (ksk2345 and shri4net)</li>\n<li>robee</li>\n<li><a href=\"https://github.com/antoncoding\">antonttc</a></li>\n<li><a href=\"https://twitter.com/meidhiwirara\">Tomio</a></li>\n<li><a href=\"https://twitter.com/csanuragjain\">csanuragjain</a></li>\n<li>TrungOre</li>\n<li>sorrynotsorry</li>\n<li><a href=\"https://twitter.com/catchup22\">catchup</a></li>\n<li>0xkatana</li>\n<li>reassor</li>\n<li><a href=\"https://twitter.com/berndartmueller\">berndartmueller</a></li>\n<li>kenta</li>\n<li><a href=\"https://twitter.com/securerodd\">securerodd</a></li>\n<li>gs8nrv</li>\n<li>hake</li>\n<li><a href=\"https://github.com/z3s/\">z3s</a></li>\n<li><a href=\"https://twitter.com/_0v3rf10w\">0v3rf10w</a></li>\n<li><a href=\"https://instagram.com/vanensurya\">Funen</a></li>\n<li>TerrierLover</li>\n<li>oyc_109</li>\n<li>simon135</li>\n<li><a href=\"https://github.com/htadashi\">Tadashi</a></li>\n<li>dipp</li>\n<li>kebabsec (okkothejawa and <a href=\"https://twitter.com/FlameHorizon1\">FlameHorizon</a>)</li>\n<li>peritoflores</li>\n<li>jayjonah8</li>\n<li><a href=\"https://twitter.com/nonfungiblenero\">Kenshin</a></li>\n<li><a href=\"BowTiedETHernal\">m4rio_eth</a></li>\n<li>remora</li>\n<li><a href=\"https://twitter.com/MaratCerby\">MaratCerby</a></li>\n<li>0x1f8b</li>\n<li>cccz</li>\n<li>hyh</li>\n<li>slywaters</li>\n<li>0x4non</li>\n<li><a href=\"https://twitter.com/0xNazgul\">0xNazgul</a></li>\n<li>NoamYakov</li>\n<li><a href=\"https://www.instagram.com/riyan_rfa/\">rfa</a></li>\n<li>saian</li>\n<li>0xmint</li>\n<li>tin537</li>\n<li><a href=\"https://twitter.com/danbinnun\">danb</a></li>\n<li>UnusualTurtle</li>\n</ol>\n<p>This contest was judged by <a href=\"https://twitter.com/gzeon\">gzeon</a>. The judge also competed in the contest as a warden, but forfeited their winnings.</p>\n<p>Final report assembled by <a href=\"https://twitter.com/liveactionllama\">liveactionllama</a>.</p>\n<h1 id=\"summary\" style=\"position:relative;\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h1>\n<p>The C4 analysis yielded an aggregated total of 18 unique vulnerabilities. Of these vulnerabilities, 3 received a risk rating in the category of HIGH severity and 15 received a risk rating in the category of MEDIUM severity.</p>\n<p>Additionally, C4 analysis included 39 reports detailing issues with a risk rating of LOW severity or non-critical. There were also 35 reports recommending gas optimizations.</p>\n<p>All of the issues presented here are linked back to their original finding.</p>\n<h1 id=\"scope\" style=\"position:relative;\"><a href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scope</h1>\n<p>The code under review can be found within the <a href=\"https://github.com/code-423n4/2022-04-backd\">C4 Backd contest repository</a>, and is composed of 38 smart contracts written in the Solidity programming language and includes 4,630 lines of Solidity code.</p>\n<h1 id=\"severity-criteria\" style=\"position:relative;\"><a href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Severity Criteria</h1>\n<p>C4 assesses the severity of disclosed vulnerabilities according to a methodology based on <a href=\"https://owasp.org/www-community/OWASP_Risk_Rating_Methodology\">OWASP standards</a>.</p>\n<p>Vulnerabilities are divided into three primary risk categories: high, medium, and low/non-critical.</p>\n<p>High-level considerations for vulnerabilities span the following key areas when conducting assessments:</p>\n<ul>\n<li>Malicious Input Handling</li>\n<li>Escalation of privileges</li>\n<li>Arithmetic</li>\n<li>Gas use</li>\n</ul>\n<p>Further information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on <a href=\"https://code4rena.com\">the C4 website</a>.</p>\n<h1 id=\"high-risk-findings-3\" style=\"position:relative;\"><a href=\"#high-risk-findings-3\" aria-label=\"high risk findings 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>High Risk Findings (3)</h1>\n<h2 id=\"h-01-user-can-steal-all-rewards-due-to-checkpoint-after-transfer\" style=\"position:relative;\"><a href=\"#h-01-user-can-steal-all-rewards-due-to-checkpoint-after-transfer\" aria-label=\"h 01 user can steal all rewards due to checkpoint after transfer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/36\">[H-01] User can steal all rewards due to checkpoint after transfer</a></h2>\n<p><em>Submitted by 0xDjango, also found by unforgiven</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/StakerVault.sol#L112-L119\">StakerVault.sol#L112-L119</a><br></p>\n<p>I believe this to be a high severity vulnerability that is potentially included in the currently deployed <code>StakerVault.sol</code> contract also. The team will be contacted immediately following the submission of this report.</p>\n<p>In <code>StakerVault.sol</code>, the user checkpoints occur AFTER the balances are updated in the <code>transfer()</code> function. The user checkpoints update the amount of rewards claimable by the user. Since their rewards will be updated after transfer, a user can send funds between their own accounts and repeatedly claim maximum rewards since the pool’s inception.</p>\n<p>In every actionable function except <code>transfer()</code> of <code>StakerVault.sol</code>, a call to <code>ILpGauge(lpGauge).userCheckpoint()</code> is correctly made BEFORE the action effects.</p>\n<h3 id=\"proof-of-concept\" style=\"position:relative;\"><a href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Assume a certain period of time has passed since the pool’s inception. For easy accounting, assume <code>poolStakedIntegral</code> of <code>LpGauge.sol</code> equals <code>1</code>. The <code>poolStakedIntegral</code> is used to keep track of the current reward rate.</p>\n<p>Steps:</p>\n<ul>\n<li>Account A stakes 1000 LP tokens. <code>balances[A] += 1000</code></li>\n<li>In the same <code>stakeFor()</code> function, <code>userCheckpoint()</code> was already called so A will already have <code>perUserShare[A]</code> set correctly based on their previously 0 balance and the current <code>poolStakedIntegral</code>.</li>\n<li>Account A can immediately send all balance to Account B via <code>transfer()</code>.</li>\n<li>Since the checkpoint occurs after the transfer, B’s balance will increase and then <code>perUserShare[B]</code> will be updated. The calculation for <code>perUserShare</code> looks as follows.</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">perUserShare</span><span class=\"mtk1\">[</span><span class=\"mtk12\">user</span><span class=\"mtk1\">] += (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            (</span><span class=\"mtk12\">stakerVault</span><span class=\"mtk1\">.</span><span class=\"mtk11\">stakedAndActionLockedBalanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">user</span><span class=\"mtk1\">)).</span><span class=\"mtk11\">scaledMul</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                (</span><span class=\"mtk12\">poolStakedIntegral_</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">perUserStakedIntegral</span><span class=\"mtk1\">[</span><span class=\"mtk12\">user</span><span class=\"mtk1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        );</span></span></span></code></pre>\n<p>Assuming Account B is new to the protocol, their <code>perUserStakedIntegral[user]</code> will default to <code>0</code>.</p>\n<p><code>perUserShare[B] += 1000 * (1 - 0) = 1000</code></p>\n<ul>\n<li>B is able to call <code>claimRewards()</code> and mint all 1000 reward tokens.</li>\n<li>B then calls <code>transfer()</code> and sends all 1000 staked tokens to Account C.</li>\n<li>Same calculation occurs, and C can claim all 1000 reward tokens.</li>\n<li>This process can be repeated until the contract is drained of reward tokens.</li>\n</ul>\n<h3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>In <code>StakerVault.transfer()</code>, move the call to <code>ILpGauge(lpGauge).userCheckpoint()</code> to before the balances are updated.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/36\">chase-manning (Backd) confirmed and resolved</a></strong></p>\n<hr>\n<h2 id=\"h-02-function-lockfunds-in-topupactionlibrary-can-cause-serious-fund-lose-fee-and-capped-bypass-its-not-calling-stakervaultincreaseactionlockedbalance-when-transfers-stakes\" style=\"position:relative;\"><a href=\"#h-02-function-lockfunds-in-topupactionlibrary-can-cause-serious-fund-lose-fee-and-capped-bypass-its-not-calling-stakervaultincreaseactionlockedbalance-when-transfers-stakes\" aria-label=\"h 02 function lockfunds in topupactionlibrary can cause serious fund lose fee and capped bypass its not calling stakervaultincreaseactionlockedbalance when transfers stakes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/60\">[H-02] function <code>lockFunds</code> in <code>TopUpActionLibrary</code> can cause serious fund lose. fee and Capped bypass. It’s not calling <code>stakerVault.increaseActionLockedBalance</code> when transfers stakes.</a></h2>\n<p><em>Submitted by unforgiven</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L57-L65\">TopUpAction.sol#L57-L65</a><br></p>\n<p>In function TopUpActionLibrary.lockFunds when transfers stakes from payer it doesn’t call stakerVault.increaseActionLockedBalance for that payer so stakerVault.actionLockedBalances[payer] is not get updated for payer and stakerVault.stakedAndActionLockedBalanceOf(payer) is going to show wrong value and any calculation based on this function is gonna be wrong which will cause fund lose and theft and some restriction bypasses.</p>\n<h3 id=\"proof-of-concept-1\" style=\"position:relative;\"><a href=\"#proof-of-concept-1\" aria-label=\"proof of concept 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>When user wants to create a TopUpAction. so he deposit his funds to Pool and get LP token. then stake the LP token in StakerVault and use that stakes to create a TopUp position with function TopUpAction.register. This function transfer user stakes (locks user staks) and create his position.<br></p>\n<p>For transferring and locking user stakes it uses TopUpActionLibrary.lockFunds. function lockFunds transfers user stakes but don’t call stakerVault.increaseActionLockedBalance for the payer which cause that stakerVault.actionLockedBalances[payer] to get different values(not equal to position.depositTokenBalance).<br></p>\n<p>Function StakerVault.stakedAndActionLockedBalanceOf(account) uses stakerVault.actionLockedBalances[account] so it will return wrong value and any where in code that uses stakedAndActionLockedBalanceOf() is going to cause problems.<br></p>\n<p>three part of the codes uses stakerVault.stakedAndActionLockedBalanceOf():<br></p>\n<ol>\n<li>LiqudityPool.depositFor() for checking user total deposits to be less than depositCap.<br></li>\n<li>LiqudityPool._updateUserFeesOnDeposit() for updating user fee on new deposits.<br></li>\n<li>userCheckpoint() for calculating user rewards.<br>\nattacker can use #1 and #2 to bypass high fee payment and max depositCap and #3 will cause users to lose\nrewards.<br></li>\n</ol>\n<p>The detail steps:<br>\n1- user deposit fund to Pool and get LP token.<br>\n2- user stakes LP token in StakerVault.<br>\n3- user approve TopUpAction address to transfer his staks in StakerVault.<br>\n3- user use all his stakes to create a position with TopUpAction.register() function.<br>\n3.1- register() will call lockFunds to transfer and lock user stakes.<br>\n3.2- lockFunds() will transfer user stakes with stakerVault.transferFrom() but don’t call stakerVault.increaseActionLockedBalance() so StakerVault.actionLockedBalances[user] will be zero.<br>\n3.3- StakerVault.balance[useer] will be zero too because his stakes get transfers in 3.2<br>\n4- StakerVault.stakedAndActionLockedBalanceOf(user) will return zero (user has some locked stakes in TopUpAction but because of the bug calculation get out of sync)<br></p>\n<p>In this moment user will lose all the rewards that are minted in LpGauge. because userCheckpoint() use stakerVault.stakedAndActionLockedBalanceOf(user) for calculating rewards which is zero  and new rewards will be zero too.<br></p>\n<p>Attacker can use this process to bypass “max deposit Cap” and deposit any amount of assets he wants. because LiqudityPool.depositFor(address,uint256,uint256) uses stakedAndActionLockedBalanceOf to check user deposits which is zero so Attacker can deposit &#x26; stake &#x26; register to make his balance zero and repeat this and in the end reset his TopUp positions to get back his large stakes which are multiple time bigger than “max deposit Cap”</p>\n<p>Attacker can also use this process to bypass fee penalties for early withdraw. because LiqudityPool._updateUserFeesOnDeposit() to get user current balance use stakedAndActionLockedBalanceOf() which is zero. so the value of shareExisting variable become zero and newFeeRatio will be calculated based on feeOnDeposit which can be minFee if asset is already in wallet for some time.</p>\n<h3 id=\"tools-used\" style=\"position:relative;\"><a href=\"#tools-used\" aria-label=\"tools used permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>VIM</p>\n<h3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Add this line to TopUpActionLibrary.lockFunds() after stakerVault.transferFrom():</p>\n<p>stakerVault.increaseActionLockedBalance(payer, amountLeft);</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/60\">chase-manning (Backd) confirmed and resolved</a></strong></p>\n<hr>\n<h2 id=\"h-03-customers-cannot-be-topuped-a-second-time\" style=\"position:relative;\"><a href=\"#h-03-customers-cannot-be-topuped-a-second-time\" aria-label=\"h 03 customers cannot be topuped a second time permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/178\">[H-03] Customers cannot be <code>topUp()</code>ed a second time</a></h2>\n<p><em>Submitted by IllIllI</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CompoundHandler.sol#L71\">CompoundHandler.sol#L71</a><br>\n<a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CompoundHandler.sol#L120\">CompoundHandler.sol#L120</a><br>\n<a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/AaveHandler.sol#L53\">AaveHandler.sol#L53</a><br>\n<a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L847\">TopUpAction.sol#L847</a><br></p>\n<p>OpenZeppelin’s <code>safeApprove()</code> will revert if the account already is approved and the new <code>safeApprove()</code> is done with a non-zero value.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">safeApprove</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">IERC20</span><span class=\"mtk1\"> </span><span class=\"mtk12\">token</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">spender</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">value</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// safeApprove should only be called when setting an initial allowance,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// or when resetting it to zero. To increase and decrease it, use</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// &#39;safeIncreaseAllowance&#39; and &#39;safeDecreaseAllowance&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        (</span><span class=\"mtk12\">value</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) || (</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">allowance</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">), </span><span class=\"mtk12\">spender</span><span class=\"mtk1\">) == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;SafeERC20: approve from non-zero to non-zero allowance&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">_callOptionalReturn</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">, </span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encodeWithSelector</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk12\">approve</span><span class=\"mtk1\">.</span><span class=\"mtk12\">selector</span><span class=\"mtk1\">, </span><span class=\"mtk12\">spender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">value</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><a href=\"https://github.com/OpenZeppelin/openzeppelin-contracts/blob/fcf35e5722847f5eadaaee052968a8a54d03622a/contracts/token/ERC20/utils/SafeERC20.sol#L45-L58\">OpenZeppelin/SafeERC20.sol#L45-L58</a><br></p>\n<h3 id=\"impact\" style=\"position:relative;\"><a href=\"#impact\" aria-label=\"impact permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>Customers cannot be topped up a second time, which will cause them to be liquidated even though they think they’re protected.</p>\n<h3 id=\"proof-of-concept-2\" style=\"position:relative;\"><a href=\"#proof-of-concept-2\" aria-label=\"proof of concept 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>There are multiple places where <code>safeApprove()</code> is called a second time without setting the value to zero first. The instances below are all related to topping up.</p>\n<p>Compound-specific top-ups will fail the second time around when approving the <code>ctoken</code> again:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">actions</span><span class=\"mtk1\">/</span><span class=\"mtk12\">topup</span><span class=\"mtk1\">/</span><span class=\"mtk12\">handlers</span><span class=\"mtk1\">/</span><span class=\"mtk12\">CompoundHandler</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">50</span><span class=\"mtk1\">       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">topUp</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">51           </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">account</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">52           </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">underlying</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">53           </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">54           </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">extra</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">55       ) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">56</span><span class=\"mtk1\">           </span><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">repayDebt</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">decode</span><span class=\"mtk1\">(</span><span class=\"mtk12\">extra</span><span class=\"mtk1\">, (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">57</span><span class=\"mtk1\">           </span><span class=\"mtk12\">CToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ctoken</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">cTokenRegistry</span><span class=\"mtk1\">.</span><span class=\"mtk11\">fetchCToken</span><span class=\"mtk1\">(</span><span class=\"mtk12\">underlying</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">58</span><span class=\"mtk1\">           </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initialTokens</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">ctoken</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">59</span><span class=\"mtk1\">   </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">60</span><span class=\"mtk1\">           </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">addr</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">account</span><span class=\"mtk1\">.</span><span class=\"mtk11\">addr</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">61</span><span class=\"mtk1\">   </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">62</span><span class=\"mtk1\">           </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">repayDebt</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">63</span><span class=\"mtk1\">               </span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> -= </span><span class=\"mtk11\">_repayAnyDebt</span><span class=\"mtk1\">(</span><span class=\"mtk12\">addr</span><span class=\"mtk1\">, </span><span class=\"mtk12\">underlying</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">, </span><span class=\"mtk12\">ctoken</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">64</span><span class=\"mtk1\">               </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">65</span><span class=\"mtk1\">           }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">66</span><span class=\"mtk1\">   </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">67</span><span class=\"mtk1\">           </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">err</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">68</span><span class=\"mtk1\">           </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">underlying</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">69</span><span class=\"mtk1\">               </span><span class=\"mtk12\">err</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">ctoken</span><span class=\"mtk1\">.</span><span class=\"mtk12\">mint</span><span class=\"mtk1\">{value: </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">}(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">70</span><span class=\"mtk1\">           } </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">71</span><span class=\"mtk1\">               </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">underlying</span><span class=\"mtk1\">).</span><span class=\"mtk11\">safeApprove</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ctoken</span><span class=\"mtk1\">), </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CompoundHandler.sol#L50-L71\">CompoundHandler.sol#L50-L71</a><br></p>\n<p>Compound-specific top-ups will also fail when trying to repay debt:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">actions</span><span class=\"mtk1\">/</span><span class=\"mtk12\">topup</span><span class=\"mtk1\">/</span><span class=\"mtk12\">handlers</span><span class=\"mtk1\">/</span><span class=\"mtk12\">CompoundHandler</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">62</span><span class=\"mtk1\">           </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">repayDebt</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">63</span><span class=\"mtk1\">               </span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> -= </span><span class=\"mtk11\">_repayAnyDebt</span><span class=\"mtk1\">(</span><span class=\"mtk12\">addr</span><span class=\"mtk1\">, </span><span class=\"mtk12\">underlying</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">, </span><span class=\"mtk12\">ctoken</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">64</span><span class=\"mtk1\">               </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">65</span><span class=\"mtk1\">           }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CompoundHandler.sol#L62-L65\">CompoundHandler.sol#L62-L65</a><br></p>\n<p>Aave-specific top-ups will fail for the <code>lendingPool</code>:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">actions</span><span class=\"mtk1\">/</span><span class=\"mtk12\">topup</span><span class=\"mtk1\">/</span><span class=\"mtk12\">handlers</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AaveHandler</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">36</span><span class=\"mtk1\">       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">topUp</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">37           </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">account</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">38           </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">underlying</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">39           </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">40           </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">extra</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">41       ) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">42</span><span class=\"mtk1\">           </span><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">repayDebt</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">decode</span><span class=\"mtk1\">(</span><span class=\"mtk12\">extra</span><span class=\"mtk1\">, (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">43</span><span class=\"mtk1\">           </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">underlying</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">44</span><span class=\"mtk1\">               </span><span class=\"mtk12\">weth</span><span class=\"mtk1\">.</span><span class=\"mtk12\">deposit</span><span class=\"mtk1\">{value: </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">}();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">45</span><span class=\"mtk1\">               </span><span class=\"mtk12\">underlying</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">weth</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">46</span><span class=\"mtk1\">           }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">47</span><span class=\"mtk1\">   </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">48</span><span class=\"mtk1\">           </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">addr</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">account</span><span class=\"mtk1\">.</span><span class=\"mtk11\">addr</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">49</span><span class=\"mtk1\">   </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">50</span><span class=\"mtk1\">           </span><span class=\"mtk12\">DataTypes</span><span class=\"mtk1\">.</span><span class=\"mtk12\">ReserveData</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">reserve</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">lendingPool</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getReserveData</span><span class=\"mtk1\">(</span><span class=\"mtk12\">underlying</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">51</span><span class=\"mtk1\">           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">reserve</span><span class=\"mtk1\">.</span><span class=\"mtk12\">aTokenAddress</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">), </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">UNDERLYING_NOT_SUPPORTED</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">52</span><span class=\"mtk1\">   </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">53</span><span class=\"mtk1\">           </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">underlying</span><span class=\"mtk1\">).</span><span class=\"mtk11\">safeApprove</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">lendingPool</span><span class=\"mtk1\">), </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/AaveHandler.sol#L36-L53\">AaveHandler.sol#L36-L53</a><br></p>\n<p>The <code>TopUpAction</code> itself fails for the <code>feeHandler</code>:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">actions</span><span class=\"mtk1\">/</span><span class=\"mtk12\">topup</span><span class=\"mtk1\">/</span><span class=\"mtk12\">TopUpAction</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">4</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">840</span><span class=\"mtk1\">       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_payFees</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">841           </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">payer</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">842           </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">beneficiary</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">843           </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">feeAmount</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">844           </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">depositToken</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">845       ) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">846</span><span class=\"mtk1\">           </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">feeHandler</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">getFeeHandler</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">847</span><span class=\"mtk1\">           </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">depositToken</span><span class=\"mtk1\">).</span><span class=\"mtk11\">safeApprove</span><span class=\"mtk1\">(</span><span class=\"mtk12\">feeHandler</span><span class=\"mtk1\">, </span><span class=\"mtk12\">feeAmount</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L840-L847\">TopUpAction.sol#L840-L847</a><br></p>\n<p>I’ve filed the other less-severe instances as a separate medium-severity issue, and flagged the remaining low-severity instances in my QA report.</p>\n<h3 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Always do <code>safeApprove(0)</code> if the allowance is being changed, or use <code>safeIncreaseAllowance()</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/178\">chase-manning (Backd) confirmed and resolved</a></strong></p>\n<hr>\n<h1 id=\"medium-risk-findings-15\" style=\"position:relative;\"><a href=\"#medium-risk-findings-15\" aria-label=\"medium risk findings 15 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Medium Risk Findings (15)</h1>\n<h2 id=\"m-01-call-should-be-used-instead-of-transfer-on-an-address-payable\" style=\"position:relative;\"><a href=\"#m-01-call-should-be-used-instead-of-transfer-on-an-address-payable\" aria-label=\"m 01 call should be used instead of transfer on an address payable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/52\">[M-01] <code>call()</code> should be used instead of <code>transfer()</code> on an <code>address payable</code></a></h2>\n<p><em>Submitted by Dravee, also found by antonttc, berndartmueller, cccz, danb, horsefacts, hyh, IllIllI, MaratCerby, pauliax, rayn, UnusualTurtle, WatchPug, and wuwe1</em></p>\n<p>This is a classic Code4rena issue:</p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2021-04-meebits-findings/issues/2\">https://github.com/code-423n4/2021-04-meebits-findings/issues/2</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-10-tally-findings/issues/20\">https://github.com/code-423n4/2021-10-tally-findings/issues/20</a></li>\n<li><a href=\"https://github.com/code-423n4/2022-01-openleverage-findings/issues/75\">https://github.com/code-423n4/2022-01-openleverage-findings/issues/75</a></li>\n</ul>\n<h3 id=\"impact-1\" style=\"position:relative;\"><a href=\"#impact-1\" aria-label=\"impact 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>The use of the deprecated <code>transfer()</code> function for an address will inevitably make the transaction fail when:</p>\n<ol>\n<li>The claimer smart contract does not implement a payable function.</li>\n<li>The claimer smart contract does implement a payable fallback which uses more than 2300 gas unit.</li>\n<li>The claimer smart contract implements a payable fallback function that needs less than 2300 gas units but is called through proxy, raising the call’s gas usage above 2300.</li>\n</ol>\n<p>Additionally, using higher than 2300 gas might be mandatory for some multisig wallets.</p>\n<h4 id=\"impacted-lines\" style=\"position:relative;\"><a href=\"#impacted-lines\" aria-label=\"impacted lines permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impacted lines:</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">pool</span><span class=\"mtk1\">/</span><span class=\"mtk12\">EthPool</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">30</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">to</span><span class=\"mtk1\">.</span><span class=\"mtk11\">transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">strategies</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BkdEthCvx</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">   </span><span class=\"mtk7\">77</span><span class=\"mtk1\">:             </span><span class=\"mtk11\">payable</span><span class=\"mtk1\">(</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">).</span><span class=\"mtk11\">transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">   </span><span class=\"mtk7\">93</span><span class=\"mtk1\">:         </span><span class=\"mtk11\">payable</span><span class=\"mtk1\">(</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">).</span><span class=\"mtk11\">transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">117</span><span class=\"mtk1\">:         </span><span class=\"mtk11\">payable</span><span class=\"mtk1\">(</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">).</span><span class=\"mtk11\">transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">underlyingBalance</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">/</span><span class=\"mtk12\">EthVault</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">29</span><span class=\"mtk1\">:         </span><span class=\"mtk11\">payable</span><span class=\"mtk1\">(</span><span class=\"mtk12\">to</span><span class=\"mtk1\">).</span><span class=\"mtk11\">transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">); </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">37</span><span class=\"mtk1\">:         </span><span class=\"mtk11\">payable</span><span class=\"mtk1\">(</span><span class=\"mtk12\">addressProvider</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getTreasury</span><span class=\"mtk1\">()).</span><span class=\"mtk11\">transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);  </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VaultReserve</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">81</span><span class=\"mtk1\">:             </span><span class=\"mtk11\">payable</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">).</span><span class=\"mtk11\">transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation\" style=\"position:relative;\"><a href=\"#recommended-mitigation\" aria-label=\"recommended mitigation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation</h3>\n<p>I recommend using <code>call()</code> instead of <code>transfer()</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/52\">chase-manning (Backd) confirmed and resolved</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/52#issuecomment-1120238070\">gzeon (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Sponsor confirmed. Judging this as Medium Risk.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-02-its-possible-to-lose-total-governance-control-by-mistake\" style=\"position:relative;\"><a href=\"#m-02-its-possible-to-lose-total-governance-control-by-mistake\" aria-label=\"m 02 its possible to lose total governance control by mistake permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/83\">[M-02] Its possible to lose total governance control by mistake</a></h2>\n<p><em>Submitted by hubble, also found by antonttc, csanuragjain, gs8nrv, rayn, reassor, and TrungOre</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/access/RoleManager.sol#L43-L46\">RoleManager.sol#L43-L46</a><br>\n<a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/access/RoleManager.sol#L115-L128\">RoleManager.sol#L115-L128</a><br></p>\n<p>The impact of this vulnerability, i.e.,  losing all governance control is very High.<br>\nThere is a possibility, due to a corner case as described below.<br></p>\n<h3 id=\"proof-of-concept-3\" style=\"position:relative;\"><a href=\"#proof-of-concept-3\" aria-label=\"proof of concept 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Contract : RoleManager.sol<br>\nFunction : renounceGovernance()<br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">   Step 0:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">     Let current governance role given to = CURRENT_GOV_ADDRESS</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">     so, getRoleMemberCount() for &quot;governance&quot; role will return = 1 </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">   Step 1: Add a new address say ALICE to governance role, by addGovernor(ALICE)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">     now, ALICE also has governace role, and getRoleMemberCount() for &quot;governance&quot; role will return = 2 </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">   </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">   Step 2: Assume that ALICE renounces governance role, by renounceGovernance()</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">     now, ALICE does not have governance role, but getRoleMemberCount() for &quot;governance&quot; role will return = 2, due to a BUG</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">   Step 3: In some distant future, if there is a compromise of CURRENT_GOV_ADDRESS keys or due to some other reason, </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">     its decided to revoke governance role for CURRENT_GOV_ADDRESS via renounceGovernance(), and the command succeeds</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">     It can be assumed that since getRoleMemberCount() for &quot;governance&quot; role returns = 2, at least there is one other active governor address. </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">     But now, CURRENT_GOV_ADDRESS does not have governance role, and the total governance control on the protocol is lost my mistake.</span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-3\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-3\" aria-label=\"recommended mitigation steps 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>getRoleMemberCount() currently returns _roleMembers[role].length();<br>\nIt should return the count only for _roles[role].members[account] = true;<br></p>\n<p>Its recommended to add a new function to know who are the active members for any role,<br>\nlike getRoleMembers(bytes32 role) returning address account.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/83\">chase-manning (Backd) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/83\">gzeon (judge) decreased severity to Medium</a></strong></p>\n<hr>\n<h2 id=\"m-03-lack-of-safeapprove0-prevents-some-registrations-and-the-changing-of-stakers-and-lp-tokens\" style=\"position:relative;\"><a href=\"#m-03-lack-of-safeapprove0-prevents-some-registrations-and-the-changing-of-stakers-and-lp-tokens\" aria-label=\"m 03 lack of safeapprove0 prevents some registrations and the changing of stakers and lp tokens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/180\">[M-03] Lack of <code>safeApprove(0)</code> prevents some registrations, and the changing of stakers and LP tokens</a></h2>\n<p><em>Submitted by IllIllI, also found by defsec and Dravee</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L50\">TopUpAction.sol#L50</a><br>\n<a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/LiquidityPool.sol#L721\">LiquidityPool.sol#L721</a><br></p>\n<p>OpenZeppelin’s <code>safeApprove()</code> will revert if the account already is approved and the new <code>safeApprove()</code> is done with a non-zero value</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">safeApprove</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">IERC20</span><span class=\"mtk1\"> </span><span class=\"mtk12\">token</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">spender</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">value</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// safeApprove should only be called when setting an initial allowance,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// or when resetting it to zero. To increase and decrease it, use</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// &#39;safeIncreaseAllowance&#39; and &#39;safeDecreaseAllowance&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            (</span><span class=\"mtk12\">value</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) || (</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">allowance</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">), </span><span class=\"mtk12\">spender</span><span class=\"mtk1\">) == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk8\">&quot;SafeERC20: approve from non-zero to non-zero allowance&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">_callOptionalReturn</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">, </span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encodeWithSelector</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk12\">approve</span><span class=\"mtk1\">.</span><span class=\"mtk12\">selector</span><span class=\"mtk1\">, </span><span class=\"mtk12\">spender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">value</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><a href=\"https://github.com/OpenZeppelin/openzeppelin-contracts/blob/fcf35e5722847f5eadaaee052968a8a54d03622a/contracts/token/ERC20/utils/SafeERC20.sol#L45-L58\">OpenZeppelin/SafeERC20.sol#L45-L58</a><br></p>\n<h3 id=\"impact-2\" style=\"position:relative;\"><a href=\"#impact-2\" aria-label=\"impact 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>Customers can be prevented from <code>register()</code>ing the same <code>token</code>/<code>stakerVaultAddress</code> as another customer; and once changed away from, stakers and lptokens can’t be used in the future.</p>\n<h3 id=\"proof-of-concept-4\" style=\"position:relative;\"><a href=\"#proof-of-concept-4\" aria-label=\"proof of concept 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>There are multiple places where <code>safeApprove()</code> is called a second time without setting the value to zero first.</p>\n<p><code>register()</code> calls <code>lockFunds()</code> for each user registration, and since users will use the same tokens and staker vaults, the second user’s <code>register()</code> call will fail:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">actions</span><span class=\"mtk1\">/</span><span class=\"mtk12\">topup</span><span class=\"mtk1\">/</span><span class=\"mtk12\">TopUpAction</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">36</span><span class=\"mtk1\">       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">lockFunds</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">37           </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">stakerVaultAddress</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">38           </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">payer</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">39           </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">token</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">40           </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lockAmount</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">41           </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">depositAmount</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">42       ) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">43</span><span class=\"mtk1\">           </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amountLeft</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">lockAmount</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">44</span><span class=\"mtk1\">           </span><span class=\"mtk12\">IStakerVault</span><span class=\"mtk1\"> </span><span class=\"mtk12\">stakerVault</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">IStakerVault</span><span class=\"mtk1\">(</span><span class=\"mtk12\">stakerVaultAddress</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">45</span><span class=\"mtk1\">   </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">46</span><span class=\"mtk1\">           </span><span class=\"mtk3\">// stake deposit amount</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">47</span><span class=\"mtk1\">           </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">depositAmount</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">48</span><span class=\"mtk1\">               </span><span class=\"mtk12\">depositAmount</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">depositAmount</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk12\">amountLeft</span><span class=\"mtk1\"> ? </span><span class=\"mtk12\">amountLeft</span><span class=\"mtk1\"> : </span><span class=\"mtk12\">depositAmount</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">49</span><span class=\"mtk1\">               </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">).</span><span class=\"mtk11\">safeTransferFrom</span><span class=\"mtk1\">(</span><span class=\"mtk12\">payer</span><span class=\"mtk1\">, </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">), </span><span class=\"mtk12\">depositAmount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">50</span><span class=\"mtk1\">               </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">).</span><span class=\"mtk11\">safeApprove</span><span class=\"mtk1\">(</span><span class=\"mtk12\">stakerVaultAddress</span><span class=\"mtk1\">, </span><span class=\"mtk12\">depositAmount</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L36-L50\">TopUpAction.sol#L36-L50</a><br></p>\n<p>The changing of either the staker or an lp token is behind a time-lock, and once the time has passed, the changed variables rely on this function:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">pool</span><span class=\"mtk1\">/</span><span class=\"mtk12\">LiquidityPool</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">717</span><span class=\"mtk1\">       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_approveStakerVaultSpendingLpTokens</span><span class=\"mtk1\">() </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">718</span><span class=\"mtk1\">           </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">staker_</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">staker</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">719</span><span class=\"mtk1\">           </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lpToken_</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">lpToken</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">720</span><span class=\"mtk1\">           </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">staker_</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">) || </span><span class=\"mtk12\">lpToken_</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) </span><span class=\"mtk15\">return</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">721</span><span class=\"mtk1\">           </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">lpToken_</span><span class=\"mtk1\">).</span><span class=\"mtk11\">safeApprove</span><span class=\"mtk1\">(</span><span class=\"mtk12\">staker_</span><span class=\"mtk1\">, </span><span class=\"mtk11\">type</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">).</span><span class=\"mtk12\">max</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">722</span><span class=\"mtk1\">       }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/LiquidityPool.sol#L717-L722\">LiquidityPool.sol#L717-L722</a><br></p>\n<p>If a bug is found in a new <code>staker</code> or <code>lpToken</code> and the governor wishes to change back to the old one(s), the governor will have to wait for the time-lock delay only to find out that the old value(s) cause the code to revert.</p>\n<p>I’ve filed the other more-severe instances as a separate high-severity issue, and flagged the remaining low-severity instances in my QA report.</p>\n<h3 id=\"recommended-mitigation-steps-4\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-4\" aria-label=\"recommended mitigation steps 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Always do <code>safeApprove(0)</code> if the allowance is being changed, or use <code>safeIncreaseAllowance()</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/180\">chase-manning (Backd) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/180#issuecomment-1116388323\">samwerner (Backd) commented</a>:</strong></p>\n<blockquote>\n<p>It should be noted that the second example referring to <code>_approveStakerVaultSpendingLpTokens()</code> is not an issue. This is neither a member variable that can be updated nor is it behind a time lock. Both the <code>staker</code> and <code>lpToken</code> can only be set once and hence the <code>safeApprove</code> in the aforementioned function can only be called once.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/180\">chase-manning (Backd) resolved</a></strong> resolved</p>\n<hr>\n<h2 id=\"m-04-cvxcrvrewardslocker-implements-a-swap-without-a-slippage-check-that-can-result-in-a-loss-of-funds-through-mev\" style=\"position:relative;\"><a href=\"#m-04-cvxcrvrewardslocker-implements-a-swap-without-a-slippage-check-that-can-result-in-a-loss-of-funds-through-mev\" aria-label=\"m 04 cvxcrvrewardslocker implements a swap without a slippage check that can result in a loss of funds through mev permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/161\">[M-04] <code>CvxCrvRewardsLocker</code> implements a swap without a slippage check that can result in a loss of funds through MEV</a></h2>\n<p><em>Submitted by Ruhum</em></p>\n<p>The CvxCrvRewardsLocker contract swaps tokens through the CRV cvxCRV pool. But, it doesn’t use any slippage checks. The swap is at risk of being frontrun / sandwiched which will result in a loss of funds.</p>\n<p>Since MEV is very prominent I think the chance of that happening is pretty high.</p>\n<h3 id=\"proof-of-concept-5\" style=\"position:relative;\"><a href=\"#proof-of-concept-5\" aria-label=\"proof of concept 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Here’s the swap: <a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/CvxCrvRewardsLocker.sol#L247-L252\">CvxCrvRewardsLocker.sol#L247-L252</a>.</p>\n<h3 id=\"recommended-mitigation-steps-5\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-5\" aria-label=\"recommended mitigation steps 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Use a proper value for <code>minOut</code> instead of <code>0</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/161\">chase-manning (Backd) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/161#issuecomment-1120269300\">gzeon (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>According to <a href=\"https://docs.code4rena.com/roles/judges/how-to-judge-a-contest#notes-on-judging\">C4 Judging criteria</a>:</p>\n<blockquote>\n<p>Unless there is something uniquely novel created by combining vectors, most submissions regarding vulnerabilities that are inherent to a particular system or the Ethereum network as a whole should be considered QA. Examples of such vulnerabilities include front running, sandwich attacks, and MEV. </p>\n</blockquote>\n<p>However since there is a configurable <code>minOut</code> that is deliberately set to 0, this seems to be a valid issue. I am judging this as Medium Risk.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-05-chainlinks-latestrounddata-might-return-stale-or-incorrect-results\" style=\"position:relative;\"><a href=\"#m-05-chainlinks-latestrounddata-might-return-stale-or-incorrect-results\" aria-label=\"m 05 chainlinks latestrounddata might return stale or incorrect results permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/17\">[M-05] Chainlink’s <code>latestRoundData</code> might return stale or incorrect results</a></h2>\n<p><em>Submitted by cccz, also found by 0x1f8b, 0xDjango, 0xkatana, berndartmueller, defsec, Dravee, horsefacts, hyh, IllIllI, kenta, rayn, reassor, sorrynotsorry, and WatchPug</em></p>\n<p>On ChainlinkOracleProvider.sol and ChainlinkUsdWrapper.sol , we are using latestRoundData, but there is no check if the return value indicates stale data.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_ethPrice</span><span class=\"mtk1\">() </span><span class=\"mtk11\">private</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">int256</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        (, </span><span class=\"mtk12\">int256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">answer</span><span class=\"mtk1\">, , , ) = </span><span class=\"mtk12\">_ethOracle</span><span class=\"mtk1\">.</span><span class=\"mtk11\">latestRoundData</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">answer</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">getPriceUSD</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">asset</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">feed</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">feeds</span><span class=\"mtk1\">[</span><span class=\"mtk12\">asset</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">feed</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">), </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">ASSET_NOT_SUPPORTED</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        (, </span><span class=\"mtk12\">int256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">answer</span><span class=\"mtk1\">, , </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">updatedAt</span><span class=\"mtk1\">, ) = </span><span class=\"mtk11\">AggregatorV2V3Interface</span><span class=\"mtk1\">(</span><span class=\"mtk12\">feed</span><span class=\"mtk1\">).</span><span class=\"mtk11\">latestRoundData</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk12\">updatedAt</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">stalePriceDelay</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">STALE_PRICE</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">answer</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">NEGATIVE_PRICE</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">price</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">answer</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint8</span><span class=\"mtk1\"> </span><span class=\"mtk12\">decimals</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">AggregatorV2V3Interface</span><span class=\"mtk1\">(</span><span class=\"mtk12\">feed</span><span class=\"mtk1\">).</span><span class=\"mtk11\">decimals</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">price</span><span class=\"mtk1\">.</span><span class=\"mtk11\">scaleFrom</span><span class=\"mtk1\">(</span><span class=\"mtk12\">decimals</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>This could lead to stale prices according to the Chainlink documentation:</p>\n<p><a href=\"https://docs.chain.link/docs/historical-price-data/#historical-rounds\">https://docs.chain.link/docs/historical-price-data/#historical-rounds</a><br>\n<a href=\"https://docs.chain.link/docs/faq/#how-can-i-check-if-the-answer-to-a-round-is-being-carried-over-from-a-previous-round\">https://docs.chain.link/docs/faq/#how-can-i-check-if-the-answer-to-a-round-is-being-carried-over-from-a-previous-round</a></p>\n<h3 id=\"proof-of-concept-6\" style=\"position:relative;\"><a href=\"#proof-of-concept-6\" aria-label=\"proof of concept 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/main/backd/contracts/oracles/ChainlinkOracleProvider.sol#L55\">ChainlinkOracleProvider.sol#L55</a><br>\n<a href=\"https://github.com/code-423n4/2022-04-backd/blob/main/backd/contracts/oracles/ChainlinkUsdWrapper.sol#L64\">ChainlinkUsdWrapper.sol#L64</a></p>\n<h3 id=\"recommended-mitigation-steps-6\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-6\" aria-label=\"recommended mitigation steps 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_ethPrice</span><span class=\"mtk1\">() </span><span class=\"mtk11\">private</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">int256</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        (</span><span class=\"mtk12\">uint80</span><span class=\"mtk1\"> </span><span class=\"mtk12\">roundID</span><span class=\"mtk1\">, </span><span class=\"mtk12\">int256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">answer</span><span class=\"mtk1\">, , </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint80</span><span class=\"mtk1\"> </span><span class=\"mtk12\">answeredInRound</span><span class=\"mtk1\">) = </span><span class=\"mtk12\">_ethOracle</span><span class=\"mtk1\">.</span><span class=\"mtk11\">latestRoundData</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">answeredInRound</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">roundID</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Stale price&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> != </span><span class=\"mtk7\">0</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;Round not complete&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">answer</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot;Chainlink answer reporting 0&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">answer</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">getPriceUSD</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">asset</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">feed</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">feeds</span><span class=\"mtk1\">[</span><span class=\"mtk12\">asset</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">feed</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">), </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">ASSET_NOT_SUPPORTED</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        (</span><span class=\"mtk12\">uint80</span><span class=\"mtk1\"> </span><span class=\"mtk12\">roundID</span><span class=\"mtk1\">, </span><span class=\"mtk12\">int256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">answer</span><span class=\"mtk1\">, , </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">updatedAt</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint80</span><span class=\"mtk1\"> </span><span class=\"mtk12\">answeredInRound</span><span class=\"mtk1\">) = </span><span class=\"mtk11\">AggregatorV2V3Interface</span><span class=\"mtk1\">(</span><span class=\"mtk12\">feed</span><span class=\"mtk1\">).</span><span class=\"mtk11\">latestRoundData</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">answeredInRound</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">roundID</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Stale price&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">answer</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">,</span><span class=\"mtk8\">&quot; Error.NEGATIVE_PRICE&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk12\">updatedAt</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">stalePriceDelay</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">STALE_PRICE</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">price</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">answer</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint8</span><span class=\"mtk1\"> </span><span class=\"mtk12\">decimals</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">AggregatorV2V3Interface</span><span class=\"mtk1\">(</span><span class=\"mtk12\">feed</span><span class=\"mtk1\">).</span><span class=\"mtk11\">decimals</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">price</span><span class=\"mtk1\">.</span><span class=\"mtk11\">scaleFrom</span><span class=\"mtk1\">(</span><span class=\"mtk12\">decimals</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/17\">chase-manning (Backd) confirmed and resolved</a></strong></p>\n<hr>\n<h2 id=\"m-06-erc777-tokens-can-bypass-depositcap-guard\" style=\"position:relative;\"><a href=\"#m-06-erc777-tokens-can-bypass-depositcap-guard\" aria-label=\"m 06 erc777 tokens can bypass depositcap guard permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/47\">[M-06] ERC777 tokens can bypass <code>depositCap</code> guard</a></h2>\n<p><em>Submitted by shenwilly, also found by wuwe1</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/LiquidityPool.sol#L523\">LiquidityPool.sol#L523</a><br></p>\n<p>When ERC777 token is used as the underlying token for a <code>LiquidityPool</code>, a depositor can reenter <code>depositFor</code> and bypass the <code>depositCap</code> requirement check, resulting in higher total deposit than intended by governance.</p>\n<h3 id=\"proof-of-concept-7\" style=\"position:relative;\"><a href=\"#proof-of-concept-7\" aria-label=\"proof of concept 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<ul>\n<li>An empty ERC777 liquidity pool is capped at 1.000 token.</li>\n<li>Alice deposits 1.000 token. Before the token is actually sent to the contract, <code>tokensToSend</code> ERC777 hook is called and Alice reenters <code>depositFor</code>.</li>\n<li>As the previous deposit hasn’t been taken into account, the reentrancy passes the <code>depositCap</code> check.</li>\n<li>Pool has 2.000 token now, despite the 1.000 deposit cap.</li>\n</ul>\n<h3 id=\"recommended-mitigation-steps-7\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-7\" aria-label=\"recommended mitigation steps 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Add reentrancy guards to <code>depositFor</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/47\">chase-manning (Backd) confirmed and resolved</a></strong></p>\n<hr>\n<h2 id=\"m-07-inconsistency-between-constructor-and-setting-method-for-slippagetolerance\" style=\"position:relative;\"><a href=\"#m-07-inconsistency-between-constructor-and-setting-method-for-slippagetolerance\" aria-label=\"m 07 inconsistency between constructor and setting method for slippagetolerance permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/97\">[M-07] Inconsistency between constructor and setting method for <code>slippageTolerance</code></a></h2>\n<p><em>Submitted by fatherOfBlocks, also found by shenwilly</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/StrategySwapper.sol#L38-L43\">StrategySwapper.sol#L38-L43</a><br>\n<a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/StrategySwapper.sol#L109-L114\">StrategySwapper.sol#L109-L114</a><br></p>\n<p>In the setSlippageTolerance(L119) method you have certain requirements to set slippageTolerance, but in the constructor you don’t.</p>\n<h3 id=\"recommended-mitigation-steps-8\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-8\" aria-label=\"recommended mitigation steps 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>I would add the corresponding validations to the constructor.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/97\">chase-manning (Backd) confirmed and resolved</a></strong></p>\n<hr>\n<h2 id=\"m-08-_decimalmultiplier-doesnt-account-for-tokens-with-decimals-higher-than-18\" style=\"position:relative;\"><a href=\"#m-08-_decimalmultiplier-doesnt-account-for-tokens-with-decimals-higher-than-18\" aria-label=\"m 08 _decimalmultiplier doesnt account for tokens with decimals higher than 18 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/49\">[M-08] <code>_decimalMultiplier</code> doesn’t account for tokens with decimals higher than 18</a></h2>\n<p><em>Submitted by shenwilly, also found by pauliax, StyxRave, and WatchPug</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/StrategySwapper.sol#L287-L289\">StrategySwapper.sol#L287-L289</a><br>\n<a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/StrategySwapper.sol#L318-L320\">StrategySwapper.sol#L318-L320</a><br>\n<a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/StrategySwapper.sol#L335-L337\">StrategySwapper.sol#L335-L337</a><br></p>\n<p>In <code>StrategySwapper</code>, swapping from or to tokens with decimals higher than 18 will always revert. This will cause inabilities for strategies to harvest rewards.</p>\n<h3 id=\"proof-of-concept-8\" style=\"position:relative;\"><a href=\"#proof-of-concept-8\" aria-label=\"proof of concept 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/StrategySwapper.sol#L288\">L288</a> will revert when <code>token_</code> has higher than 18 decimals.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"> return 10**(18 - IERC20Full(token_).decimals());</span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-9\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-9\" aria-label=\"recommended mitigation steps 9 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Consider modifying how <code>_decimalMultiplier</code> works so it could handle tokens with higher than 18 decimals.</p>\n<p>Update the calculation of <code>_minTokenAmountOut</code> and <code>_minWethAmountOut</code> to account when decimals are higher/lower than <code>18</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/49\">chase-manning (Backd) confirmed and resolved</a></strong></p>\n<hr>\n<h2 id=\"m-09-getnewcurrentfees-reverts-when-minfeepercentage--feeratio\" style=\"position:relative;\"><a href=\"#m-09-getnewcurrentfees-reverts-when-minfeepercentage--feeratio\" aria-label=\"m 09 getnewcurrentfees reverts when minfeepercentage  feeratio permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/50\">[M-09] <code>getNewCurrentFees</code> reverts when <code>minFeePercentage</code> > <code>feeRatio</code></a></h2>\n<p><em>Submitted by shenwilly</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/LiquidityPool.sol#L694\">LiquidityPool.sol#L694</a><br></p>\n<p>Depositors won’t be able to transfer or redeem funds temporarily.</p>\n<p>The problem is caused by the implementation of <code>LiquidityPool.getNewCurrentFees</code>:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">getNewCurrentFees</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">timeToWait</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lastActionTimestamp</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">feeRatio</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">timeElapsed</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">_getTime</span><span class=\"mtk1\">() - </span><span class=\"mtk12\">lastActionTimestamp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">minFeePercentage</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">getMinWithdrawalFee</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">timeElapsed</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">timeToWait</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">minFeePercentage</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">elapsedShare</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">timeElapsed</span><span class=\"mtk1\">.</span><span class=\"mtk11\">scaledDiv</span><span class=\"mtk1\">(</span><span class=\"mtk12\">timeToWait</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">feeRatio</span><span class=\"mtk1\"> - (</span><span class=\"mtk12\">feeRatio</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">minFeePercentage</span><span class=\"mtk1\">).</span><span class=\"mtk11\">scaledMul</span><span class=\"mtk1\">(</span><span class=\"mtk12\">elapsedShare</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>The last line requires the current <code>feeRatio</code> to be higher than <code>minFeePercentage</code> or the function will revert. When this condition is broken, some critical functions such as transferring tokens and redeeming will be unusable. Affected users need to wait until enough time has elapsed and <code>getNewCurrentFees</code> returns <code>minFeePercentage</code> on <a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/LiquidityPool.sol#L691\">L691</a>.</p>\n<p>This could happen if governance changes the <code>MinWithdrawalFee</code> to be higher than a user’s feeRatio.</p>\n<h3 id=\"proof-of-concept-9\" style=\"position:relative;\"><a href=\"#proof-of-concept-9\" aria-label=\"proof of concept 9 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<ul>\n<li>Initial <code>MinWithdrawalFee</code> is set to 0, <code>MaxWithdrawalFee</code> is set to 0.03e18.</li>\n<li>Alice deposits fund and receives LP token. Alice’s <code>feeRatio</code> is now set to 0.03e18 (the current <code>MaxWithdrawalFee</code>).</li>\n<li>Governance changes <code>MaxWithdrawalFee</code> to <code>0.05e18</code> and <code>MinWithdrawalFee</code> to <code>0.04e18</code>.</li>\n<li><code>minFeePercentage</code> is now higher than Alice’s <code>feeRatio</code> and she can’t transfer nor redeem the LP token until <code>timeElapsed >= timeToWait</code>.</li>\n</ul>\n<h3 id=\"recommended-mitigation-steps-10\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-10\" aria-label=\"recommended mitigation steps 10 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Add a new condition in <code>getNewCurrentFees</code> <a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/LiquidityPool.sol#L690\">L690</a> to account for this case:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">timeElapsed</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">timeToWait</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">minFeePercentage</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk12\">feeRatio</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">minFeePercentage</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/50\">chase-manning (Backd) confirmed and resolved</a></strong></p>\n<hr>\n<h2 id=\"m-10-griefer-can-extend-period-of-higher-withdrawal-fees\" style=\"position:relative;\"><a href=\"#m-10-griefer-can-extend-period-of-higher-withdrawal-fees\" aria-label=\"m 10 griefer can extend period of higher withdrawal fees permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/56\">[M-10] Griefer can extend period of higher withdrawal fees</a></h2>\n<p><em>Submitted by 0xDjango</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/LiquidityPool.sol#L790-L792\">LiquidityPool.sol#L790-L792</a><br></p>\n<p>The <code>_updateUserFeesOnDeposit()</code> function in <code>LiquidityPool.sol</code> is used to update a user’s withdrawal fees after an action such as deposit, transfer in, etc. The withdrawal fee decays toward a minimum withdrawal fee over a period of 1 or 2 weeks (discussed with developer). Since anyone can transfer lp tokens to any user, a griefer can transfer 1 wei of lp tokens to another user to reset their <code>lastActionTimestamp</code> used in the withdrawal fee calculation.</p>\n<p>The developers nicely weight the updated withdrawal fee by taking the original balance/original fee vs the added balance/added fee. The attacker will only be able to extend the runway of the withdrawal fee cooldown by resetting the <code>lastActionTimestamp</code> for future calculations. Example below:</p>\n<h3 id=\"proof-of-concept-10\" style=\"position:relative;\"><a href=\"#proof-of-concept-10\" aria-label=\"proof of concept 10 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Assumptions:</p>\n<ul>\n<li>MinWithdrawalFee = 0% //For easy math</li>\n<li>MaxWithdrawalFee = 10%</li>\n<li>timeToWait = 2 weeks</li>\n</ul>\n<h4 id=\"steps\" style=\"position:relative;\"><a href=\"#steps\" aria-label=\"steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Steps</h4>\n<ul>\n<li>User A has <code>100 wei</code> of shares</li>\n<li>User A waits 1 week (Current withdrawal fee = 5%)</li>\n<li>User B deposits, receives <code>1 wei</code> of shares, current withdrawal fee = 10%</li>\n<li>User B immediately transfers <code>1 wei</code> of shares to User A</li>\n</ul>\n<p>Based on the formula to calculated User A’s new feeRatio:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newFeeRatio</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">shareExisting</span><span class=\"mtk1\">.</span><span class=\"mtk11\">scaledMul</span><span class=\"mtk1\">(</span><span class=\"mtk12\">newCurrentFeeRatio</span><span class=\"mtk1\">) +</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">shareAdded</span><span class=\"mtk1\">.</span><span class=\"mtk11\">scaledMul</span><span class=\"mtk1\">(</span><span class=\"mtk12\">feeOnDeposit</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>In reality, User A’s withdrawal fee will only increase by a negligible amount since the shares added were very small in proportion to the original shares. We can assume user A’s current withdrawal fee is still 5%.</p>\n<p>The issue is that the function then reset’s User A’s <code>lastActionTimestamp</code> to the current time. This means that User A will have to wait the maximum 2 weeks for the withdrawal fee to reduce from 5% to 0%. Effectively the cooldown runway is the same length as the original runway length, so the decay down to 0% will take twice as long.</p>\n<p><code>meta.lastActionTimestamp = uint64(_getTime());</code></p>\n<h3 id=\"recommended-mitigation-steps-11\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-11\" aria-label=\"recommended mitigation steps 11 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Instead of resetting <code>lastActionTimestamp</code> to the current time, scale it the same way the <code>feeRatio</code> is scaled. I understand that this would technically not be the timestamp of the last action, so the variable would probably need to be renamed.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/56\">chase-manning (Backd) confirmed and resolved</a></strong></p>\n<hr>\n<h2 id=\"m-11-position-owner-should-set-allowed-slippage\" style=\"position:relative;\"><a href=\"#m-11-position-owner-should-set-allowed-slippage\" aria-label=\"m 11 position owner should set allowed slippage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/87\">[M-11] Position owner should set allowed slippage</a></h2>\n<p><em>Submitted by 0x52</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L154\">TopUpAction.sol#L154</a><br>\n<a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L187\">TopUpAction.sol#L187</a><br></p>\n<p>The default swap slippage of 5% allows malicious keepers to sandwich attack topup. Additionally, up to 40% (_MIN<em>SWAPPER</em>SLIPPAGE) slippage allows malicious owner to sandwich huge amounts from topup</p>\n<h3 id=\"proof-of-concept-11\" style=\"position:relative;\"><a href=\"#proof-of-concept-11\" aria-label=\"proof of concept 11 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Keeper can bundle swaps before and after topup to sandwich topup action, in fact it’s actually in their best interest to do so.</p>\n<h3 id=\"recommended-mitigation-steps-12\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-12\" aria-label=\"recommended mitigation steps 12 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Allow user to specify max swap slippage when creating topup similar to how it’s specified on uniswap or sushiswap to block attacks from both keepers and owners.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/87\">chase-manning (Backd) confirmed and resolved</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/87#issuecomment-1121225398\">gzeon (judge) commented</a>:</strong></p>\n<blockquote>\n<p>According to <a href=\"https://docs.code4rena.com/roles/judges/how-to-judge-a-contest#notes-on-judging\">C4 Judging criteria</a></p>\n<blockquote>\n<p>Unless there is something uniquely novel created by combining vectors, most submissions regarding vulnerabilities that are inherent to a particular system or the Ethereum network as a whole should be considered QA. Examples of such vulnerabilities include front running, sandwich attacks, and MEV. </p>\n</blockquote>\n<p>However since Backd use keeper to run topup transactions, which presumably are bots and smart contracts that can fetch onchain price directly. A large (5% default, up to 40%) seems excessive and can lead to user losing fund. Judging this as Medium Risk.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-12-compoundhandlertopup-using-the-wrong-function-selector-makes-native-token-topup-always-revert\" style=\"position:relative;\"><a href=\"#m-12-compoundhandlertopup-using-the-wrong-function-selector-makes-native-token-topup-always-revert\" aria-label=\"m 12 compoundhandlertopup using the wrong function selector makes native token topup always revert permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/120\">[M-12] <code>CompoundHandler#topUp()</code> Using the wrong function selector makes native token <code>topUp()</code> always revert</a></h2>\n<p><em>Submitted by WatchPug</em></p>\n<p><a href=\"https://github.com/compound-finance/compound-protocol/blob/v2.8.1/contracts/CEther.sol#L44-L47\">compound-finance/CEther.sol#L44-L47</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">mint</span><span class=\"mtk1\">() </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">payable</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    (</span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">err</span><span class=\"mtk1\">,) = </span><span class=\"mtk11\">mintInternal</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">value</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">requireNoError</span><span class=\"mtk1\">(</span><span class=\"mtk12\">err</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;mint failed&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><code>mint()</code> for native cToken (<code>CEther</code>) does not have any parameters, as the <code>Function Selector</code> is based on <code>the function name with the parenthesised list of parameter types</code>, when you add a nonexisting <code>parameter</code>, the <code>Function Selector</code> will be incorrect.</p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/interfaces/vendor/CTokenInterfaces.sol#L316\">CTokenInterfaces.sol#L316</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">mint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">mintAmount</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">payable</span><span class=\"mtk1\"> </span><span class=\"mtk11\">virtual</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>The current implementation uses the same <code>CToken</code> interface for both <code>CEther</code> and <code>CErc20</code> in <code>topUp()</code>, and <code>function mint(uint256 mintAmount)</code> is a nonexisting function for <code>CEther</code>.</p>\n<p>As a result, the native token <code>topUp()</code> always revert.</p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CompoundHandler.sol#L57-L70\">CompoundHandler.sol#L57-L70</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"19\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">CToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ctoken</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">cTokenRegistry</span><span class=\"mtk1\">.</span><span class=\"mtk11\">fetchCToken</span><span class=\"mtk1\">(</span><span class=\"mtk12\">underlying</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initialTokens</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">ctoken</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">addr</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">account</span><span class=\"mtk1\">.</span><span class=\"mtk11\">addr</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">repayDebt</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> -= </span><span class=\"mtk11\">_repayAnyDebt</span><span class=\"mtk1\">(</span><span class=\"mtk12\">addr</span><span class=\"mtk1\">, </span><span class=\"mtk12\">underlying</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">, </span><span class=\"mtk12\">ctoken</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">err</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">underlying</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">err</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">ctoken</span><span class=\"mtk1\">.</span><span class=\"mtk12\">mint</span><span class=\"mtk1\">{value: </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">}(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://compound.finance/docs/ctokens#mint\">Compound’s cToken mint doc</a></li>\n</ul>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/120\">samwerner (Backd) confirmed and resolved</a></strong></p>\n<hr>\n<h2 id=\"m-13-cethinterfacerepayborrowbehalf-reading-non-existing-returns-makes--_repayanydebt-with-cether-always-revert\" style=\"position:relative;\"><a href=\"#m-13-cethinterfacerepayborrowbehalf-reading-non-existing-returns-makes--_repayanydebt-with-cether-always-revert\" aria-label=\"m 13 cethinterfacerepayborrowbehalf reading non existing returns makes  _repayanydebt with cether always revert permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/121\">[M-13] <code>CEthInterface#repayBorrowBehalf()</code> reading non-existing returns makes  <code>_repayAnyDebt()</code> with CEther always revert</a></h2>\n<p><em>Submitted by WatchPug</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/interfaces/vendor/CTokenInterfaces.sol#L355-L358\">CTokenInterfaces.sol#L355-L358</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"20\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">repayBorrowBehalf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">borrower</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">repayAmount</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">external</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">payable</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><code>repayBorrowBehalf()</code> for native cToken (<code>CEther</code>) will return nothing, while the current <code>CEthInterface</code> interface defines the returns as <code>(uint256)</code>.</p>\n<p>As a result, <code>ether.repayBorrowBehalf()</code> will always revert</p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CompoundHandler.sol#L117-L118\">CompoundHandler.sol#L117-L118</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"21\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">CEther</span><span class=\"mtk1\"> </span><span class=\"mtk12\">cether</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">CEther</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ctoken</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">err</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">cether</span><span class=\"mtk1\">.</span><span class=\"mtk12\">repayBorrowBehalf</span><span class=\"mtk1\">{value: </span><span class=\"mtk12\">debt</span><span class=\"mtk1\">}(</span><span class=\"mtk12\">account</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>Ref:</p>\n<table>\n<thead>\n<tr>\n<th>method</th>\n<th>CEther</th>\n<th>CErc20</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>mint()</td>\n<td>revert</td>\n<td>error code</td>\n</tr>\n<tr>\n<td>redeem()</td>\n<td>error code</td>\n<td>error code</td>\n</tr>\n<tr>\n<td>repayBorrow()</td>\n<td>revert</td>\n<td>error code</td>\n</tr>\n<tr>\n<td>repayBorrowBehalf()</td>\n<td>revert</td>\n<td>error code</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li><a href=\"https://compound.finance/docs/ctokens#repay-borrow-behalf\">Compound cToken Repay Borrow Behalf doc</a></li>\n<li><a href=\"https://github.com/compound-finance/compound-protocol/blob/v2.8.1/contracts/CEther.sol#L92-L95\">Compound CEther.repayBorrowBehalf()</a></li>\n<li><a href=\"https://github.com/compound-finance/compound-protocol/blob/v2.8.1/contracts/CErc20.sol#L94-L97\">Compound CErc20.repayBorrowBehalf()</a></li>\n</ul>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/121\">chase-manning (Backd) confirmed</a></strong></p>\n<hr>\n<h2 id=\"m-14-cethinterfacemint-reading-non-existing-returns-makes-topup-with-native-token-always-revert\" style=\"position:relative;\"><a href=\"#m-14-cethinterfacemint-reading-non-existing-returns-makes-topup-with-native-token-always-revert\" aria-label=\"m 14 cethinterfacemint reading non existing returns makes topup with native token always revert permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/125\">[M-14] <code>CEthInterface#mint()</code> reading non-existing returns makes <code>topUp()</code> with native token always revert</a></h2>\n<p><em>Submitted by WatchPug</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/interfaces/vendor/CTokenInterfaces.sol#L345\">CTokenInterfaces.sol#L345</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"22\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">mint</span><span class=\"mtk1\">() </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">payable</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><code>mint()</code> for native cToken (<code>CEther</code>) will return nothing, while the current <code>CEthInterface</code> interface defines the returns as <code>(uint256)</code>.</p>\n<p>In the current implementation, the interface for <code>CToken</code> is used for both <code>CEther</code> and <code>CErc20</code>.</p>\n<p>As a result, the transaction will revert with the error: <code>function returned an unexpected amount of data</code> when <code>topUp()</code> with the native token (ETH).</p>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CompoundHandler.sol#L57-L70\">CompoundHandler.sol#L57-L70</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"23\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">CToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ctoken</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">cTokenRegistry</span><span class=\"mtk1\">.</span><span class=\"mtk11\">fetchCToken</span><span class=\"mtk1\">(</span><span class=\"mtk12\">underlying</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initialTokens</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">ctoken</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">addr</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">account</span><span class=\"mtk1\">.</span><span class=\"mtk11\">addr</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">repayDebt</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> -= </span><span class=\"mtk11\">_repayAnyDebt</span><span class=\"mtk1\">(</span><span class=\"mtk12\">addr</span><span class=\"mtk1\">, </span><span class=\"mtk12\">underlying</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">, </span><span class=\"mtk12\">ctoken</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">err</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">underlying</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">err</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">ctoken</span><span class=\"mtk1\">.</span><span class=\"mtk12\">mint</span><span class=\"mtk1\">{value: </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">}(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>Ref:</p>\n<table>\n<thead>\n<tr>\n<th>method</th>\n<th>CEther</th>\n<th>CErc20</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>mint()</td>\n<td>revert</td>\n<td>error code</td>\n</tr>\n<tr>\n<td>redeem()</td>\n<td>error code</td>\n<td>error code</td>\n</tr>\n<tr>\n<td>repayBorrow()</td>\n<td>revert</td>\n<td>error code</td>\n</tr>\n<tr>\n<td>repayBorrowBehalf()</td>\n<td>revert</td>\n<td>error code</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li><a href=\"https://compound.finance/docs/ctokens#mint\">Compound’s cToken mint doc</a><br></li>\n<li><a href=\"https://github.com/compound-finance/compound-protocol/blob/v2.8.1/contracts/CEther.sol#L46\">Compound CEther.mint()</a><br></li>\n<li><a href=\"https://github.com/compound-finance/compound-protocol/blob/v2.8.1/contracts/CErc20.sol#L46\">Compound CErc20.mint()</a><br></li>\n</ul>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/125\">chase-manning (Backd) confirmed</a></strong></p>\n<hr>\n<h2 id=\"m-15-malicious-stakers-can-grief-keepers\" style=\"position:relative;\"><a href=\"#m-15-malicious-stakers-can-grief-keepers\" aria-label=\"m 15 malicious stakers can grief keepers permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/194\">[M-15] Malicious Stakers can grief Keepers</a></h2>\n<p><em>Submitted by sseefried</em></p>\n<p>A Staker — that has their top-up position removed after <code>execute</code> is called by a Keeper — can always cause the transaction to revert. They can do this by deploying a smart contract to the <code>payer</code> address that has implemented a <code>receive()</code> function that calls <code>revert()</code>. The revert will be triggered by the following <a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L727-L729\">lines</a> in <code>execute</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"24\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">vars</span><span class=\"mtk1\">.</span><span class=\"mtk12\">removePosition</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">gasBank</span><span class=\"mtk1\">.</span><span class=\"mtk11\">withdrawUnused</span><span class=\"mtk1\">(</span><span class=\"mtk12\">payer</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>This will consume some gas from the keeper while preventing them accruing any rewards for performing the top-up action.</p>\n<h3 id=\"proof-of-concept-12\" style=\"position:relative;\"><a href=\"#proof-of-concept-12\" aria-label=\"proof of concept 12 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>I have implemented a <a href=\"https://github.com/sseefried/codearena-backd-2022-04/blob/4d3c3ba7a0139bea01a0bdee9e84a7921572a9fd/backd/tests/top_up_action/sseefried_test_staker_grief.py\">PoC</a> in a fork of the contest repo. The attacker’s contract can be found <a href=\"https://github.com/sseefried/codearena-backd-2022-04/blob/4d3c3ba7a0139bea01a0bdee9e84a7921572a9fd/backd/contracts/AliceAttacker.sol\">here</a>.</p>\n<h3 id=\"recommend-mitigation-steps\" style=\"position:relative;\"><a href=\"#recommend-mitigation-steps\" aria-label=\"recommend mitigation steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommend Mitigation Steps</h3>\n<p>To prevent this denial of service attack some way of blacklisting badly behaved Stakers should be added.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/194\">chase-manning (Backd) confirmed</a></strong></p>\n<hr>\n<h1 id=\"low-risk-and-non-critical-issues\" style=\"position:relative;\"><a href=\"#low-risk-and-non-critical-issues\" aria-label=\"low risk and non critical issues permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Low Risk and Non-Critical Issues</h1>\n<p>For this contest, 39 reports were submitted by wardens detailing low risk and non-critical issues. The <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/182\">report highlighted below</a> by <strong>IllIllI</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/199\">horsefacts</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/209\">sseefried</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/6\">robee</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/198\">defsec</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/148\">hubble</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/172\">0xDjango</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/151\">sorrynotsorry</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/138\">berndartmueller</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/146\">Dravee</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/170\">joestakey</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/153\">StyxRave</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/63\">0xkatana</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/39\">csanuragjain</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/191\">dipp</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/187\">hake</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/67\">kebabsec</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/173\">pauliax</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/196\">peritoflores</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/109\">securerodd</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/185\">z3s</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/29\">0v3rf10w</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/88\">0x52</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/104\">catchup</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/99\">fatherOfBlocks</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/107\">Funen</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/4\">jayjonah8</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/54\">Kenshin</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/211\">kenta</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/26\">m4rio_eth</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/2\">oyc_109</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/137\">rayn</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/160\">remora</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/189\">Ruhum</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/162\">simon135</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/81\">Tadashi</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/85\">TerrierLover</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/89\">TrungOre</a>, and <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/165\">antonttc</a>.</em></p>\n<p>Vulnerability details:</p>\n<h2 id=\"l-01-the-first-withdrawal-for-each-vault-from-the-vault-reserve-has-no-delay\" style=\"position:relative;\"><a href=\"#l-01-the-first-withdrawal-for-each-vault-from-the-vault-reserve-has-no-delay\" aria-label=\"l 01 the first withdrawal for each vault from the vault reserve has no delay permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-01] The first withdrawal for each vault from the vault reserve has no delay</h2>\n<p><code>_lastWithdrawal[vault]</code> will always be zero for new vaults, so the check is for <code>0 + minWithdrawalDelay</code> which will always be less than <code>block.timestamp</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"25\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VaultReserve</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">102</span><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">canWithdraw</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vault</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">103</span><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">_lastWithdrawal</span><span class=\"mtk1\">[</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">] + </span><span class=\"mtk12\">minWithdrawalDelay</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/VaultReserve.sol#L102-L103\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/VaultReserve.sol#L102-L103</a></p>\n<h2 id=\"l-02-aavehandler-does-not-extend-basehandler\" style=\"position:relative;\"><a href=\"#l-02-aavehandler-does-not-extend-basehandler\" aria-label=\"l 02 aavehandler does not extend basehandler permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-02] <code>AaveHandler</code> does not extend <code>BaseHandler</code></h2>\n<p>Unlike <code>CompoundHandler</code>, <code>AaveHandler</code> does not extend <code>BaseHandler</code>, which will cause storage problems in future versions</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"26\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">actions</span><span class=\"mtk1\">/</span><span class=\"mtk12\">topup</span><span class=\"mtk1\">/</span><span class=\"mtk12\">handlers</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AaveHandler</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">15</span><span class=\"mtk1\"> </span><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">AaveHandler</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ITopUpHandler</span><span class=\"mtk1\"> {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/AaveHandler.sol#L15\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/AaveHandler.sol#L15</a></p>\n<h2 id=\"l-03-unused-receive-function-will-lock-ether-in-contract\" style=\"position:relative;\"><a href=\"#l-03-unused-receive-function-will-lock-ether-in-contract\" aria-label=\"l 03 unused receive function will lock ether in contract permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-03] Unused <code>receive()</code> function will lock Ether in contract</h2>\n<p>If the intention is for the Ether to be used, the function should call another function, otherwise it should revert</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"27\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">actions</span><span class=\"mtk1\">/</span><span class=\"mtk12\">topup</span><span class=\"mtk1\">/</span><span class=\"mtk12\">TopUpAction</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">176</span><span class=\"mtk1\">     </span><span class=\"mtk11\">receive</span><span class=\"mtk1\">() </span><span class=\"mtk12\">external</span><span class=\"mtk1\"> </span><span class=\"mtk12\">payable</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">177</span><span class=\"mtk1\">         </span><span class=\"mtk3\">// solhint-disable-previous-line no-empty-blocks</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">178</span><span class=\"mtk1\">     }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L176-L178\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L176-L178</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"28\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">pool</span><span class=\"mtk1\">/</span><span class=\"mtk12\">EthPool</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">10</span><span class=\"mtk1\">     </span><span class=\"mtk11\">receive</span><span class=\"mtk1\">() </span><span class=\"mtk12\">external</span><span class=\"mtk1\"> </span><span class=\"mtk12\">payable</span><span class=\"mtk1\"> {}</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/EthPool.sol#L10\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/EthPool.sol#L10</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"29\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">strategies</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BkdEthCvx</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">46</span><span class=\"mtk1\">     </span><span class=\"mtk11\">receive</span><span class=\"mtk1\">() </span><span class=\"mtk12\">external</span><span class=\"mtk1\"> </span><span class=\"mtk12\">payable</span><span class=\"mtk1\"> {}</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/BkdEthCvx.sol#L46\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/BkdEthCvx.sol#L46</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"30\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">strategies</span><span class=\"mtk1\">/</span><span class=\"mtk12\">StrategySwapper</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">4</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">45</span><span class=\"mtk1\">     </span><span class=\"mtk11\">receive</span><span class=\"mtk1\">() </span><span class=\"mtk12\">external</span><span class=\"mtk1\"> </span><span class=\"mtk12\">payable</span><span class=\"mtk1\"> {}</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/StrategySwapper.sol#L45\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/StrategySwapper.sol#L45</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"31\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">/</span><span class=\"mtk12\">EthVault</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">5</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">13</span><span class=\"mtk1\">     </span><span class=\"mtk11\">receive</span><span class=\"mtk1\">() </span><span class=\"mtk12\">external</span><span class=\"mtk1\"> </span><span class=\"mtk12\">payable</span><span class=\"mtk1\"> {}</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/EthVault.sol#L13\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/EthVault.sol#L13</a></p>\n<h2 id=\"l-04-front-runable-initializer\" style=\"position:relative;\"><a href=\"#l-04-front-runable-initializer\" aria-label=\"l 04 front runable initializer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-04] Front-runable initializer</h2>\n<p>If the initializer is not executed in the same transaction as the constructor, a malicious user can front-run the <code>initialize()</code> call, forcing the contract to be redeployed. Most other initializers in this project are protected, but this one appears not to be.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"32\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AddressProvider</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">53</span><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">initialize</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">roleManager</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">initializer</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">54</span><span class=\"mtk1\">        </span><span class=\"mtk12\">AddressProviderMeta</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Meta</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">meta</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">AddressProviderMeta</span><span class=\"mtk1\">.</span><span class=\"mtk11\">Meta</span><span class=\"mtk1\">(</span><span class=\"mtk4\">true</span><span class=\"mtk1\">, </span><span class=\"mtk4\">true</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">55</span><span class=\"mtk1\">        </span><span class=\"mtk12\">_addressKeyMetas</span><span class=\"mtk1\">.</span><span class=\"mtk11\">set</span><span class=\"mtk1\">(</span><span class=\"mtk12\">AddressProviderKeys</span><span class=\"mtk1\">.</span><span class=\"mtk12\">_ROLE_MANAGER_KEY</span><span class=\"mtk1\">, </span><span class=\"mtk12\">meta</span><span class=\"mtk1\">.</span><span class=\"mtk11\">toUInt</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">56</span><span class=\"mtk1\">        </span><span class=\"mtk11\">_setConfig</span><span class=\"mtk1\">(</span><span class=\"mtk12\">AddressProviderKeys</span><span class=\"mtk1\">.</span><span class=\"mtk12\">_ROLE_MANAGER_KEY</span><span class=\"mtk1\">, </span><span class=\"mtk12\">roleManager</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">57</span><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/AddressProvider.sol#L53-L57\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/AddressProvider.sol#L53-L57</a></p>\n<h2 id=\"l-05-safeapprove-is-deprecated\" style=\"position:relative;\"><a href=\"#l-05-safeapprove-is-deprecated\" aria-label=\"l 05 safeapprove is deprecated permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-05] <code>safeApprove()</code> is deprecated</h2>\n<p><a href=\"https://github.com/OpenZeppelin/openzeppelin-contracts/blob/bfff03c0d2a59bcd8e2ead1da9aed9edf0080d05/contracts/token/ERC20/utils/SafeERC20.sol#L38-L45\">Deprecated</a> in favor of <code>safeIncreaseAllowance()</code> and <code>safeDecreaseAllowance()</code></p>\n<p>See <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/182\">original submission</a> for instances.</p>\n<h2 id=\"l-06-missing-checks-for-address0x0-when-assigning-values-to-address-state-variables\" style=\"position:relative;\"><a href=\"#l-06-missing-checks-for-address0x0-when-assigning-values-to-address-state-variables\" aria-label=\"l 06 missing checks for address0x0 when assigning values to address state variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-06] Missing checks for <code>address(0x0)</code> when assigning values to <code>address</code> state variables</h2>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"33\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">actions</span><span class=\"mtk1\">/</span><span class=\"mtk12\">topup</span><span class=\"mtk1\">/</span><span class=\"mtk12\">TopUpActionFeeHandler</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">55</span><span class=\"mtk1\">         </span><span class=\"mtk12\">actionContract</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_actionContract</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpActionFeeHandler.sol#L55\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpActionFeeHandler.sol#L55</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"34\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">CvxCrvRewardsLocker</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">151</span><span class=\"mtk1\">         </span><span class=\"mtk12\">treasury</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_treasury</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/CvxCrvRewardsLocker.sol#L151\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/CvxCrvRewardsLocker.sol#L151</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"35\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">StakerVault</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">66</span><span class=\"mtk1\">         </span><span class=\"mtk12\">token</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_token</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/StakerVault.sol#L66\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/StakerVault.sol#L66</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"36\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">strategies</span><span class=\"mtk1\">/</span><span class=\"mtk12\">ConvexStrategyBase</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">4</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">100</span><span class=\"mtk1\">         </span><span class=\"mtk12\">vault</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">vault_</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L100\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L100</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"37\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">strategies</span><span class=\"mtk1\">/</span><span class=\"mtk12\">ConvexStrategyBase</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">5</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">101</span><span class=\"mtk1\">         </span><span class=\"mtk12\">_strategist</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">strategist_</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L101\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L101</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"38\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">strategies</span><span class=\"mtk1\">/</span><span class=\"mtk12\">ConvexStrategyBase</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">6</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">182</span><span class=\"mtk1\">         </span><span class=\"mtk12\">communityReserve</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_communityReserve</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L182\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L182</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"39\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">strategies</span><span class=\"mtk1\">/</span><span class=\"mtk12\">ConvexStrategyBase</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">7</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">261</span><span class=\"mtk1\">         </span><span class=\"mtk12\">_strategist</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">strategist_</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L261\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L261</a></p>\n<h2 id=\"l-07-abiencodepacked-should-not-be-used-with-dynamic-types-when-passing-the-result-to-a-hash-function-such-as-keccak256\" style=\"position:relative;\"><a href=\"#l-07-abiencodepacked-should-not-be-used-with-dynamic-types-when-passing-the-result-to-a-hash-function-such-as-keccak256\" aria-label=\"l 07 abiencodepacked should not be used with dynamic types when passing the result to a hash function such as keccak256 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-07] <code>abi.encodePacked()</code> should not be used with dynamic types when passing the result to a hash function such as <code>keccak256()</code></h2>\n<p>Use <code>abi.encode()</code> instead which will pad items to 32 bytes, which will <a href=\"https://docs.soliditylang.org/en/v0.8.13/abi-spec.html#non-standard-packed-mode\">prevent hash collisions</a> (e.g. <code>abi.encodePacked(0x123,0x456)</code> => <code>0x123456</code> => <code>abi.encodePacked(0x1,0x23456)</code>, but <code>abi.encode(0x123,0x456)</code> => <code>0x0...1230...456</code>). “Unless there is a compelling reason, <code>abi.encode</code> should be preferred”. If there is only one argument to <code>abi.encodePacked()</code> it can often be cast to <code>bytes()</code> or <code>bytes32()</code> <a href=\"https://ethereum.stackexchange.com/questions/30912/how-to-compare-strings-in-solidity#answer-82739\">instead</a>.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"40\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">actions</span><span class=\"mtk1\">/</span><span class=\"mtk12\">topup</span><span class=\"mtk1\">/</span><span class=\"mtk12\">handlers</span><span class=\"mtk1\">/</span><span class=\"mtk12\">CTokenRegistry</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">67</span><span class=\"mtk1\">                 </span><span class=\"mtk11\">keccak256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encodePacked</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ctoken</span><span class=\"mtk1\">.</span><span class=\"mtk11\">symbol</span><span class=\"mtk1\">())) == </span><span class=\"mtk11\">keccak256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encodePacked</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;cETH&quot;</span><span class=\"mtk1\">))</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CTokenRegistry.sol#L67\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CTokenRegistry.sol#L67</a></p>\n<h2 id=\"l-08-addresscallvaluex-should-be-used-instead-of-payabletransfer\" style=\"position:relative;\"><a href=\"#l-08-addresscallvaluex-should-be-used-instead-of-payabletransfer\" aria-label=\"l 08 addresscallvaluex should be used instead of payabletransfer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-08] <code>address.call{value:x}()</code> should be used instead of <code>payable.transfer()</code></h2>\n<p>The use of <code>payable.transfer()</code> is heavily frowned upon because it can lead to the locking of funds. The <code>transfer()</code> call requires that the recipient has a <code>payable</code> callback, only provides 2300 gas for its operation. This means the following cases can cause the transfer to fail:</p>\n<ul>\n<li>The contract does not have a <code>payable</code> callback</li>\n<li>The contract’s <code>payable</code> callback spends more than 2300 gas (which is only enough to emit something)</li>\n<li>The contract is called through a proxy which itself uses up the 2300 gas</li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"41\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VaultReserve</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">81</span><span class=\"mtk1\">            </span><span class=\"mtk11\">payable</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">).</span><span class=\"mtk11\">transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>uses the <code>onlyVault</code> modifier, and vaults currently have empty <code>payable</code> callbacks, so they don’t currently revert\n<a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/VaultReserve.sol#L81\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/VaultReserve.sol#L81</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"42\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">/</span><span class=\"mtk12\">EthVault</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">29</span><span class=\"mtk1\">        </span><span class=\"mtk11\">payable</span><span class=\"mtk1\">(</span><span class=\"mtk12\">to</span><span class=\"mtk1\">).</span><span class=\"mtk11\">transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>uses the <code>onlyPoolOrGovernance</code> modifier, and pools currently have an empty <code>payable</code> callback, so they don’t currently rever. Governance is currently deployed and not seeing issues, so presumably it also has an empty <code>payable</code> callback\n<a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/EthVault.sol#L29\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/EthVault.sol#L29</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"43\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">/</span><span class=\"mtk12\">EthVault</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">37</span><span class=\"mtk1\">        </span><span class=\"mtk11\">payable</span><span class=\"mtk1\">(</span><span class=\"mtk12\">addressProvider</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getTreasury</span><span class=\"mtk1\">()).</span><span class=\"mtk11\">transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>the treasury is currently deployed and not seeing issues, so presumably it also has an empty <code>payable</code> callback\n<a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/EthVault.sol#L37\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/EthVault.sol#L37</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"44\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">strategies</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BkdEthCvx</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">4</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">77</span><span class=\"mtk1\">            </span><span class=\"mtk11\">payable</span><span class=\"mtk1\">(</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">).</span><span class=\"mtk11\">transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>vaults currently have an empty <code>payable</code> callback\n<a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/BkdEthCvx.sol#L77\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/BkdEthCvx.sol#L77</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"45\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">strategies</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BkdEthCvx</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">5</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">93</span><span class=\"mtk1\">        </span><span class=\"mtk11\">payable</span><span class=\"mtk1\">(</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">).</span><span class=\"mtk11\">transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>vaults currently have an empty <code>payable</code> callback\n<a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/BkdEthCvx.sol#L93\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/BkdEthCvx.sol#L93</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"46\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">strategies</span><span class=\"mtk1\">/</span><span class=\"mtk12\">BkdEthCvx</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">6</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">117</span><span class=\"mtk1\">        </span><span class=\"mtk11\">payable</span><span class=\"mtk1\">(</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">).</span><span class=\"mtk11\">transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">underlyingBalance</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>vaults currently have an empty <code>payable</code> callback\n<a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/BkdEthCvx.sol#L117\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/BkdEthCvx.sol#L117</a></p>\n<h2 id=\"l-09-upgradeable-contract-is-missing-a-__gap50-storage-variable-to-allow-for-new-storage-variables-in-later-versions\" style=\"position:relative;\"><a href=\"#l-09-upgradeable-contract-is-missing-a-__gap50-storage-variable-to-allow-for-new-storage-variables-in-later-versions\" aria-label=\"l 09 upgradeable contract is missing a __gap50 storage variable to allow for new storage variables in later versions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-09] Upgradeable contract is missing a <code>__gap[50]</code> storage variable to allow for new storage variables in later versions</h2>\n<p>See <a href=\"https://docs.openzeppelin.com/contracts/4.x/upgradeable#storage_gaps\">this</a> link for a description of this storage variable. While some contracts may not currently be sub-classed, adding the variable now protects against forgetting to add it in the future.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"47\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">LpToken</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">10</span><span class=\"mtk1\"> </span><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">LpToken</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ILpToken</span><span class=\"mtk1\">, </span><span class=\"mtk12\">ERC20Upgradeable</span><span class=\"mtk1\"> {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/LpToken.sol#L10\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/LpToken.sol#L10</a></p>\n<h2 id=\"l-10-math-library-unnecessarily-overflows-during-some-operations\" style=\"position:relative;\"><a href=\"#l-10-math-library-unnecessarily-overflows-during-some-operations\" aria-label=\"l 10 math library unnecessarily overflows during some operations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-10] Math library unnecessarily overflows during some operations</h2>\n<p>In the example below, <code>a + b</code> may overflow even though the division that comes later would prevent it. This particular case can be prevented by doing <a href=\"https://github.com/fei-protocol/flywheel-v2/blob/77bfadf388db25cf5917d39cd9c0ad920f404aad/src/token/ERC20MultiVotes.sol#L92-L95\"><code>(a &#x26; b) + (a ^ b) / b</code></a>. There are other functions with similar issues. See <a href=\"https://github.com/barakman/solidity-math-utils/blob/master/project/contracts/IntegralMath.sol\">this</a> library for ways of doing math without this sort of issue.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"48\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">libraries</span><span class=\"mtk1\">/</span><span class=\"mtk12\">ScaledMath</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">40</span><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">divRoundUp</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">a</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">b</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">pure</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">41</span><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">a</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">b</span><span class=\"mtk1\"> - </span><span class=\"mtk7\">1</span><span class=\"mtk1\">) / </span><span class=\"mtk12\">b</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">42</span><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/libraries/ScaledMath.sol#L40-L42\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/libraries/ScaledMath.sol#L40-L42</a></p>\n<h2 id=\"n-01-_preparedeadline-_setconfig-and-_executedeadline-should-be-private\" style=\"position:relative;\"><a href=\"#n-01-_preparedeadline-_setconfig-and-_executedeadline-should-be-private\" aria-label=\"n 01 _preparedeadline _setconfig and _executedeadline should be private permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-01] <code>_prepareDeadline()</code>, <code>_setConfig()</code>, and <code>_executeDeadline()</code> should be <code>private</code></h2>\n<p>These functions have the ability to bypass the timelocks of every setting. No contract besides the <code>Preparable</code> contract itself should need to call these functions, and having them available will lead to exploits. The contracts that currently call <code>_setConfig()</code> in their constructors should be given a new function <code>_initConfig()</code> for this purpose. The <code>Vault</code> <a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/Vault.sol#L222\">calls</a> some of these functions as well, and should be changed to manually inspect the deadline rather than mucking with the internals, which is error-prone. The mappings should also be made <code>private</code>, and there should be public getters to read their values</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"49\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">utils</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Preparable</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">115</span><span class=\"mtk1\">    </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">116     * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Execute uint256 config update (with time delay enforced).</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">117     * </span><span class=\"mtk4\">@dev</span><span class=\"mtk3\"> Needs to be called after the update was prepared. Fails if called before time delay is met.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">118     * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> New value.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">119     */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">120</span><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_executeUInt256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">121</span><span class=\"mtk1\">        </span><span class=\"mtk11\">_executeDeadline</span><span class=\"mtk1\">(</span><span class=\"mtk12\">key</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">122</span><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newValue</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">pendingUInts256</span><span class=\"mtk1\">[</span><span class=\"mtk12\">key</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">123</span><span class=\"mtk1\">        </span><span class=\"mtk11\">_setConfig</span><span class=\"mtk1\">(</span><span class=\"mtk12\">key</span><span class=\"mtk1\">, </span><span class=\"mtk12\">newValue</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">124</span><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newValue</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">125</span><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">126</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">127</span><span class=\"mtk1\">    </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">128     * </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Execute address config update (with time delay enforced).</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">129     * </span><span class=\"mtk4\">@dev</span><span class=\"mtk3\"> Needs to be called after the update was prepared. Fails if called before time delay is met.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">130     * </span><span class=\"mtk4\">@return</span><span class=\"mtk3\"> New value.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">131     */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">132</span><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_executeAddress</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">address</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">133</span><span class=\"mtk1\">        </span><span class=\"mtk11\">_executeDeadline</span><span class=\"mtk1\">(</span><span class=\"mtk12\">key</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">134</span><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newValue</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">pendingAddresses</span><span class=\"mtk1\">[</span><span class=\"mtk12\">key</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">135</span><span class=\"mtk1\">        </span><span class=\"mtk11\">_setConfig</span><span class=\"mtk1\">(</span><span class=\"mtk12\">key</span><span class=\"mtk1\">, </span><span class=\"mtk12\">newValue</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">136</span><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newValue</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">137</span><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/Preparable.sol#L115-L137\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/Preparable.sol#L115-L137</a></p>\n<h2 id=\"n-02-open-todos\" style=\"position:relative;\"><a href=\"#n-02-open-todos\" aria-label=\"n 02 open todos permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-02] Open TODOs</h2>\n<p>Code architecture, incentives, and error handling/reporting questions/issues should be resolved before deployment</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"50\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">actions</span><span class=\"mtk1\">/</span><span class=\"mtk12\">topup</span><span class=\"mtk1\">/</span><span class=\"mtk12\">TopUpAction</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">713</span><span class=\"mtk1\">         </span><span class=\"mtk3\">// TODO: add constant gas consumed for transfer and tx prologue</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L713\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L713</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"51\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">strategies</span><span class=\"mtk1\">/</span><span class=\"mtk12\">ConvexStrategyBase</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">4</span><span class=\"mtk1\"> </span><span class=\"mtk3\">// TODO Add validation of curve pools</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L4\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L4</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"52\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">strategies</span><span class=\"mtk1\">/</span><span class=\"mtk12\">ConvexStrategyBase</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">5</span><span class=\"mtk1\"> </span><span class=\"mtk3\">// TODO Test validation</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L5\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L5</a></p>\n<h2 id=\"n-03-payable-function-does-not-reject-payments-to-erc20-tokens\" style=\"position:relative;\"><a href=\"#n-03-payable-function-does-not-reject-payments-to-erc20-tokens\" aria-label=\"n 03 payable function does not reject payments to erc20 tokens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-03] <code>payable</code> function does not reject payments to ERC20 tokens</h2>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"53\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">backd</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VaultReserve</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">50</span><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">token</span><span class=\"mtk1\"> == </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">51</span><span class=\"mtk1\">            </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">value</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Error</span><span class=\"mtk1\">.</span><span class=\"mtk12\">INVALID_AMOUNT</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">52</span><span class=\"mtk1\">            </span><span class=\"mtk12\">_balances</span><span class=\"mtk1\">[</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">][</span><span class=\"mtk12\">token</span><span class=\"mtk1\">] += </span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">value</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">53</span><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">54</span><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">55</span><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">balance</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">).</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">));</span></span></span></code></pre>\n<p>After the if-statement there should be a <code>require(0 == msg.value)</code> to ensure no Ether is being used when updating ERC20 balances. This is non-critical since the function has the <code>onlyVault</code> modifier, and presumably vaults would be coded never to deposit Ether to ERC20 tokens\n<a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/VaultReserve.sol#L50-L55\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/VaultReserve.sol#L50-L55</a></p>\n<h2 id=\"n-04-adding-a-return-statement-when-the-function-defines-a-named-return-variable-is-redundant\" style=\"position:relative;\"><a href=\"#n-04-adding-a-return-statement-when-the-function-defines-a-named-return-variable-is-redundant\" aria-label=\"n 04 adding a return statement when the function defines a named return variable is redundant permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-04] Adding a <code>return</code> statement when the function defines a named return variable, is redundant</h2>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"54\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">pool</span><span class=\"mtk1\">/</span><span class=\"mtk12\">PoolFactory</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">216</span><span class=\"mtk1\">         </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">addrs</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/PoolFactory.sol#L216\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/PoolFactory.sol#L216</a></p>\n<h2 id=\"n-05-public-functions-not-called-by-the-contract-should-be-declared-external-instead\" style=\"position:relative;\"><a href=\"#n-05-public-functions-not-called-by-the-contract-should-be-declared-external-instead\" aria-label=\"n 05 public functions not called by the contract should be declared external instead permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-05] <code>public</code> functions not called by the contract should be declared <code>external</code> instead</h2>\n<p>Contracts <a href=\"https://docs.soliditylang.org/en/latest/contracts.html#function-overriding\">are allowed</a> to override their parents’ functions and change the visibility from <code>external</code> to <code>public</code>.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"55\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">actions</span><span class=\"mtk1\">/</span><span class=\"mtk12\">topup</span><span class=\"mtk1\">/</span><span class=\"mtk12\">TopUpAction</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">742</span><span class=\"mtk1\">     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">prepareTopUpHandler</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">protocol</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newHandler</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">743         </span><span class=\"mtk11\">public</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">744         </span><span class=\"mtk11\">onlyGovernance</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">745         </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L742-L745\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L742-L745</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"56\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">CvxCrvRewardsLocker</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">222</span><span class=\"mtk1\">     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">withdraw</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">token</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyGovernance</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/CvxCrvRewardsLocker.sol#L222\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/CvxCrvRewardsLocker.sol#L222</a></p>\n<h2 id=\"n-06-constants-should-be-defined-rather-than-using-magic-numbers\" style=\"position:relative;\"><a href=\"#n-06-constants-should-be-defined-rather-than-using-magic-numbers\" aria-label=\"n 06 constants should be defined rather than using magic numbers permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-06] <code>constant</code>s should be defined rather than using magic numbers</h2>\n<p>See <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/182\">original submission</a> for instances.</p>\n<h2 id=\"n-07-large-multiples-of-ten-should-use-scientific-notation-eg-1e6-rather-than-decimal-literals-eg-1000000-for-readability\" style=\"position:relative;\"><a href=\"#n-07-large-multiples-of-ten-should-use-scientific-notation-eg-1e6-rather-than-decimal-literals-eg-1000000-for-readability\" aria-label=\"n 07 large multiples of ten should use scientific notation eg 1e6 rather than decimal literals eg 1000000 for readability permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-07] Large multiples of ten should use scientific notation (e.g. <code>1e6</code>) rather than decimal literals (e.g. <code>1000000</code>), for readability</h2>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"57\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">utils</span><span class=\"mtk1\">/</span><span class=\"mtk12\">CvxMintAmount</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">7</span><span class=\"mtk1\">     </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">private</span><span class=\"mtk1\"> </span><span class=\"mtk12\">constant</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_CLIFF_SIZE</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">100000</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">1e18</span><span class=\"mtk1\">; </span><span class=\"mtk3\">//new cliff every 100,000 tokens</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/CvxMintAmount.sol#L7\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/CvxMintAmount.sol#L7</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"58\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">utils</span><span class=\"mtk1\">/</span><span class=\"mtk12\">CvxMintAmount</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">9</span><span class=\"mtk1\">     </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">private</span><span class=\"mtk1\"> </span><span class=\"mtk12\">constant</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_MAX_SUPPLY</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">100000000</span><span class=\"mtk1\"> * </span><span class=\"mtk7\">1e18</span><span class=\"mtk1\">; </span><span class=\"mtk3\">//100 mil max supply</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/CvxMintAmount.sol#L9\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/CvxMintAmount.sol#L9</a></p>\n<h2 id=\"n-08-use-a-more-recent-version-of-solidity\" style=\"position:relative;\"><a href=\"#n-08-use-a-more-recent-version-of-solidity\" aria-label=\"n 08 use a more recent version of solidity permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-08] Use a more recent version of solidity</h2>\n<p>Use a solidity version of at least 0.8.12 to get <code>string.concat()</code> to be used instead of <code>abi.encodePacked(,)</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"59\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">actions</span><span class=\"mtk1\">/</span><span class=\"mtk12\">topup</span><span class=\"mtk1\">/</span><span class=\"mtk12\">handlers</span><span class=\"mtk1\">/</span><span class=\"mtk12\">CTokenRegistry</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">2</span><span class=\"mtk1\"> </span><span class=\"mtk12\">pragma</span><span class=\"mtk1\"> </span><span class=\"mtk12\">solidity</span><span class=\"mtk1\"> </span><span class=\"mtk7\">0.8</span><span class=\"mtk1\">.</span><span class=\"mtk7\">9</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CTokenRegistry.sol#L2\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CTokenRegistry.sol#L2</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"60\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">actions</span><span class=\"mtk1\">/</span><span class=\"mtk12\">topup</span><span class=\"mtk1\">/</span><span class=\"mtk12\">TopUpActionFeeHandler</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">2</span><span class=\"mtk1\"> </span><span class=\"mtk12\">pragma</span><span class=\"mtk1\"> </span><span class=\"mtk12\">solidity</span><span class=\"mtk1\"> </span><span class=\"mtk7\">0.8</span><span class=\"mtk1\">.</span><span class=\"mtk7\">9</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpActionFeeHandler.sol#L2\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpActionFeeHandler.sol#L2</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"61\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">actions</span><span class=\"mtk1\">/</span><span class=\"mtk12\">topup</span><span class=\"mtk1\">/</span><span class=\"mtk12\">TopUpAction</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">2</span><span class=\"mtk1\"> </span><span class=\"mtk12\">pragma</span><span class=\"mtk1\"> </span><span class=\"mtk12\">solidity</span><span class=\"mtk1\"> </span><span class=\"mtk7\">0.8</span><span class=\"mtk1\">.</span><span class=\"mtk7\">9</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L2\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L2</a></p>\n<h2 id=\"n-09-constant-redefined-elsewhere\" style=\"position:relative;\"><a href=\"#n-09-constant-redefined-elsewhere\" aria-label=\"n 09 constant redefined elsewhere permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-09] Constant redefined elsewhere</h2>\n<p>Consider defining in only one contract so that values cannot become out of sync when only one location is updated. A <a href=\"https://medium.com/coinmonks/gas-cost-of-solidity-library-functions-dbe0cedd4678\">cheap way</a> to store constants in a single location is to create an <code>internal constant</code> in a <code>library</code>. If the variable is a local cache of another contract’s value, consider making the cache variable internal or private, which will require external users to query the contract with the source of truth, so that callers don’t get out of sync.</p>\n<p>See <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/182\">original submission</a> for instances.</p>\n<h2 id=\"n-10-inconsistent-spacing-in-comments\" style=\"position:relative;\"><a href=\"#n-10-inconsistent-spacing-in-comments\" aria-label=\"n 10 inconsistent spacing in comments permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-10] Inconsistent spacing in comments</h2>\n<p>Some lines use <code>// x</code> and some use <code>//x</code>. The instances below point out the usages that don’t follow the majority, within each file</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"62\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">utils</span><span class=\"mtk1\">/</span><span class=\"mtk12\">CvxMintAmount</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">8</span><span class=\"mtk1\">     </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">private</span><span class=\"mtk1\"> </span><span class=\"mtk12\">constant</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_CLIFF_COUNT</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">1000</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// 1,000 cliffs</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/CvxMintAmount.sol#L8\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/CvxMintAmount.sol#L8</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"63\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">utils</span><span class=\"mtk1\">/</span><span class=\"mtk12\">CvxMintAmount</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">   #</span><span class=\"mtk7\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">11</span><span class=\"mtk1\">         </span><span class=\"mtk11\">IERC20</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0x4e3FBD56CD56c3e72c1403e103b45Db9da5B9D2B</span><span class=\"mtk1\">)); </span><span class=\"mtk3\">// CVX Token</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/CvxMintAmount.sol#L11\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/CvxMintAmount.sol#L11</a></p>\n<h2 id=\"n-11-typos\" style=\"position:relative;\"><a href=\"#n-11-typos\" aria-label=\"n 11 typos permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-11] Typos</h2>\n<p>See <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/182\">original submission</a> for instances.</p>\n<h2 id=\"n-12-file-is-missing-natspec\" style=\"position:relative;\"><a href=\"#n-12-file-is-missing-natspec\" aria-label=\"n 12 file is missing natspec permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-12] File is missing NatSpec</h2>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"64\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">access</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Authorization</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sol</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">various</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lines</span><span class=\"mtk1\">)   #</span><span class=\"mtk7\">1</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/access/Authorization.sol\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/access/Authorization.sol</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"65\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">access</span><span class=\"mtk1\">/</span><span class=\"mtk12\">RoleManager</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sol</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">various</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lines</span><span class=\"mtk1\">)   #</span><span class=\"mtk7\">2</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/access/RoleManager.sol\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/access/RoleManager.sol</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"66\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">oracles</span><span class=\"mtk1\">/</span><span class=\"mtk12\">ChainlinkUsdWrapper</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sol</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">various</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lines</span><span class=\"mtk1\">)   #</span><span class=\"mtk7\">3</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/oracles/ChainlinkUsdWrapper.sol\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/oracles/ChainlinkUsdWrapper.sol</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"67\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">oracles</span><span class=\"mtk1\">/</span><span class=\"mtk12\">OracleProviderExtensions</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sol</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">various</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lines</span><span class=\"mtk1\">)   #</span><span class=\"mtk7\">4</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/oracles/OracleProviderExtensions.sol\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/oracles/OracleProviderExtensions.sol</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"68\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">pool</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Erc20Pool</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sol</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">various</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lines</span><span class=\"mtk1\">)   #</span><span class=\"mtk7\">5</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/Erc20Pool.sol\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/Erc20Pool.sol</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"69\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">pool</span><span class=\"mtk1\">/</span><span class=\"mtk12\">EthPool</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sol</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">various</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lines</span><span class=\"mtk1\">)   #</span><span class=\"mtk7\">6</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/EthPool.sol\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/EthPool.sol</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"70\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">utils</span><span class=\"mtk1\">/</span><span class=\"mtk12\">CvxMintAmount</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sol</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">various</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lines</span><span class=\"mtk1\">)   #</span><span class=\"mtk7\">7</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/CvxMintAmount.sol\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/CvxMintAmount.sol</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"71\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Erc20Vault</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sol</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">various</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lines</span><span class=\"mtk1\">)   #</span><span class=\"mtk7\">8</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/Erc20Vault.sol\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/Erc20Vault.sol</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"72\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">/</span><span class=\"mtk12\">EthVault</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sol</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">various</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lines</span><span class=\"mtk1\">)   #</span><span class=\"mtk7\">9</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/EthVault.sol\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/EthVault.sol</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"73\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">libraries</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AddressProviderMeta</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sol</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">various</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lines</span><span class=\"mtk1\">)   #</span><span class=\"mtk7\">10</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/libraries/AddressProviderMeta.sol\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/libraries/AddressProviderMeta.sol</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"74\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">libraries</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Errors</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sol</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">various</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lines</span><span class=\"mtk1\">)   #</span><span class=\"mtk7\">11</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/libraries/Errors.sol\">https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/libraries/Errors.sol</a></p>\n<h2 id=\"n-13-natspec-is-incomplete\" style=\"position:relative;\"><a href=\"#n-13-natspec-is-incomplete\" aria-label=\"n 13 natspec is incomplete permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-13] NatSpec is incomplete</h2>\n<p>See <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/182\">original submission</a> for instances.</p>\n<h2 id=\"n-14-event-is-missing-indexed-fields\" style=\"position:relative;\"><a href=\"#n-14-event-is-missing-indexed-fields\" aria-label=\"n 14 event is missing indexed fields permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-14] Event is missing <code>indexed</code> fields</h2>\n<p>Each <code>event</code> should use three <code>indexed</code> fields if there are three or more fields</p>\n<p>See <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/182\">original submission</a> for instances.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/182#issuecomment-1112018709\">chase-manning (Backd) resolved and commented</a>:</strong></p>\n<blockquote>\n<p>I consider this report to be of particularly high quality.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/182#issuecomment-1120478997\">gzeon (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Nice submission, warden covered basically all the low risk and non-critical issues. Would be nice if there was an index.</p>\n</blockquote>\n<hr>\n<h1 id=\"gas-optimizations\" style=\"position:relative;\"><a href=\"#gas-optimizations\" aria-label=\"gas optimizations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gas Optimizations</h1>\n<p>For this contest, 35 reports were submitted by wardens detailing gas optimizations. The <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/168\">report highlighted below</a> by <strong>joestakey</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/57\">Tomio</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/181\">IllIllI</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/35\">Dravee</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/103\">catchup</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/192\">defsec</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/111\">securerodd</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/62\">0xkatana</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/204\">kenta</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/5\">robee</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/43\">slywaters</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/154\">sorrynotsorry</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/30\">0v3rf10w</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/156\">0x1f8b</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/79\">0x4non</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/16\">0xNazgul</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/94\">fatherOfBlocks</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/105\">Funen</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/136\">NoamYakov</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/174\">pauliax</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/143\">rfa</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/129\">saian</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/84\">TerrierLover</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/116\">WatchPug</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/113\">MaratCerby</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/175\">0xDjango</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/207\">0xmint</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/188\">hake</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/202\">horsefacts</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/1\">oyc_109</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/135\">rayn</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/163\">simon135</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/82\">Tadashi</a>, <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/22\">tin537</a>, and <a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/183\">z3s</a>.</em></p>\n<h2 id=\"g-01-caching-storage-variables-in-memory-to-save-gas\" style=\"position:relative;\"><a href=\"#g-01-caching-storage-variables-in-memory-to-save-gas\" aria-label=\"g 01 caching storage variables in memory to save gas permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-01] Caching storage variables in memory to save gas</h2>\n<h3 id=\"problem\" style=\"position:relative;\"><a href=\"#problem\" aria-label=\"problem permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROBLEM</h3>\n<p>Anytime you are reading from storage more than once, it is cheaper in gas cost to cache the variable in memory: a SLOAD cost 100gas, while MLOAD and MSTORE cost 3 gas.</p>\n<p>In particular, in <code>for</code> loops, when using the length of a storage array as the condition being checked after each loop, caching the array length in memory can yield significant gas savings if the array length is high.</p>\n<h3 id=\"proof-of-concept-13\" style=\"position:relative;\"><a href=\"#proof-of-concept-13\" aria-label=\"proof of concept 13 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROOF OF CONCEPT</h3>\n<p>Instances include:</p>\n<h4 id=\"aavehandlersol\" style=\"position:relative;\"><a href=\"#aavehandlersol\" aria-label=\"aavehandlersol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AaveHandler.sol</h4>\n<p>scope: <code>topUp()</code></p>\n<ul>\n<li><code>weth</code> is read twice</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"75\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">AaveHandler.sol:44</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AaveHandler.sol:45</span></span></code></pre>\n<ul>\n<li><code>lendingPool</code> is read 4 times</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"76\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">AaveHandler.sol:50</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AaveHandler.sol:53</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AaveHandler.sol:60</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AaveHandler.sol:65</span></span></code></pre>\n<h4 id=\"compoundhandlersol\" style=\"position:relative;\"><a href=\"#compoundhandlersol\" aria-label=\"compoundhandlersol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CompoundHandler.sol</h4>\n<p>scope: <code>_getAccountBorrowsAndSupply()</code></p>\n<ul>\n<li><code>comptroller</code> is read (2 + <code>assets.length</code>) times. Number of read depends on the length of <code>assets</code> as it is in a for loop</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"77\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">CompoundHandler.sol:132</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">CompoundHandler.sol:134</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">CompoundHandler.sol:142</span></span></code></pre>\n<h4 id=\"ctokenregistrysol\" style=\"position:relative;\"><a href=\"#ctokenregistrysol\" aria-label=\"ctokenregistrysol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CTokenRegistry.sol</h4>\n<p>scope: <code>_isCTokenUsable()</code></p>\n<ul>\n<li><code>comptroller</code> is read  3 times</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"78\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">CTokenRegistry.sol:77</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">CTokenRegistry.sol:79</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">CTokenRegistry.sol:80</span></span></code></pre>\n<h4 id=\"topupactionsol\" style=\"position:relative;\"><a href=\"#topupactionsol\" aria-label=\"topupactionsol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TopUpAction.sol</h4>\n<p>scope: <code>resetPosition()</code></p>\n<ul>\n<li><code>addressProvider</code> is read twice</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"79\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:284</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:295</span></span></code></pre>\n<p>scope: <code>execute()</code></p>\n<ul>\n<li><code>addressProvider</code> is read 3 times</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"80\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:562</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:604</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:632</span></span></code></pre>\n<h4 id=\"bkdethcvxsol\" style=\"position:relative;\"><a href=\"#bkdethcvxsol\" aria-label=\"bkdethcvxsol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BkdEthCvx.sol</h4>\n<p>scope: <code>_withdraw()</code></p>\n<ul>\n<li><code>vault</code> is read twice</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"81\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdEthCvx.sol:77</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdEthCvx.sol:93</span></span></code></pre>\n<h4 id=\"bkdtrihopcvxsol\" style=\"position:relative;\"><a href=\"#bkdtrihopcvxsol\" aria-label=\"bkdtrihopcvxsol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BkdTriHopCvx.sol</h4>\n<p>scope: <code>_withdraw()</code></p>\n<ul>\n<li><code>vault</code> is read twice</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"82\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdTriHopCvx.sol:175</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdTriHopCvx.sol:201</span></span></code></pre>\n<h4 id=\"convexstrategybasesol\" style=\"position:relative;\"><a href=\"#convexstrategybasesol\" aria-label=\"convexstrategybasesol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ConvexStrategyBase.sol</h4>\n<p>scope: <code>addRewardToken()</code></p>\n<ul>\n<li><code>_strategySwapper</code> is read twice</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"83\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:279</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:280</span></span></code></pre>\n<p>scope: <code>harvestable()</code></p>\n<ul>\n<li><code>crvCommunityReserveShare</code> is read twice</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"84\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:307</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:311</span></span></code></pre>\n<ul>\n<li><code>_rewardTokens.length()</code> is read <code>_rewardTokens.length()</code> times. Number of read depends on the length of <code>_rewardsTokens</code> as it is in a for loop</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"85\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:313</span></span></code></pre>\n<p>scope: <code>_harvest()</code></p>\n<ul>\n<li><code>_rewardTokens.length()</code> is read <code>_rewardTokens.length()</code> times. Number of read depends on the length of <code>_rewardsTokens</code> as it is in a for loop</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"86\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:380</span></span></code></pre>\n<p>scope: <code>_sendCommunityReserveShare()</code></p>\n<ul>\n<li><code>cvxCommunityReserveShare</code> is read twice</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"87\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:398</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:409</span></span></code></pre>\n<h4 id=\"vaultsol\" style=\"position:relative;\"><a href=\"#vaultsol\" aria-label=\"vaultsol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vault.sol</h4>\n<p>scope: <code>_handleExcessDebt()</code></p>\n<ul>\n<li><code>reserve</code> is read 3 times</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"88\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:645</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:648</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:649</span></span></code></pre>\n<p>scope: <code>_handleExcessDebt()</code></p>\n<ul>\n<li><code>totalDebt</code> is read twice</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"89\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:657</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:658</span></span></code></pre>\n<h4 id=\"vaultsol-1\" style=\"position:relative;\"><a href=\"#vaultsol-1\" aria-label=\"vaultsol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vault.sol</h4>\n<p>scope: <code>stakeFor()</code></p>\n<ul>\n<li><code>token</code> is read 4 times</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"90\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:324</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:331</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:338</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:339</span></span></code></pre>\n<p>scope: <code>unStakeFor()</code></p>\n<ul>\n<li><code>token</code> is read 4 times</li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"91\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:365</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:376</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:382</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:384</span></span></code></pre>\n<h3 id=\"mitigation\" style=\"position:relative;\"><a href=\"#mitigation\" aria-label=\"mitigation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MITIGATION</h3>\n<p>cache these storage variables in memory</p>\n<h2 id=\"g-02-calldata-instead-of-memory-for-ro-function-parameters\" style=\"position:relative;\"><a href=\"#g-02-calldata-instead-of-memory-for-ro-function-parameters\" aria-label=\"g 02 calldata instead of memory for ro function parameters permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-02] Calldata instead of memory for RO function parameters</h2>\n<h3 id=\"problem-1\" style=\"position:relative;\"><a href=\"#problem-1\" aria-label=\"problem 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROBLEM</h3>\n<p>If a reference type function parameter is read-only, it is cheaper in gas to use calldata instead of memory.\nCalldata is a non-modifiable, non-persistent area where function arguments are stored, and behaves mostly like memory.</p>\n<p>Try to use calldata as a data location because it will avoid copies and also makes sure that the data cannot be modified.</p>\n<h3 id=\"proof-of-concept-14\" style=\"position:relative;\"><a href=\"#proof-of-concept-14\" aria-label=\"proof of concept 14 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROOF OF CONCEPT</h3>\n<p>Instances include:</p>\n<h4 id=\"rolemanagersol\" style=\"position:relative;\"><a href=\"#rolemanagersol\" aria-label=\"rolemanagersol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RoleManager.sol</h4>\n<p>scope: <code>hasAnyRole()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"92\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">RoleManager.sol:73: bytes32[] memory roles</span></span></code></pre>\n<h4 id=\"aavehandlersol-1\" style=\"position:relative;\"><a href=\"#aavehandlersol-1\" aria-label=\"aavehandlersol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AaveHandler.sol</h4>\n<p>scope: <code>topUp()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"93\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">AaveHandler.sol:40: bytes memory extra</span></span></code></pre>\n<h4 id=\"compoundhandlersol-1\" style=\"position:relative;\"><a href=\"#compoundhandlersol-1\" aria-label=\"compoundhandlersol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CompoundHandler.sol</h4>\n<p>scope: <code>topUp()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"94\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">CompoundHandler.sol:54: bytes memory extra</span></span></code></pre>\n<h4 id=\"topupactionsol-1\" style=\"position:relative;\"><a href=\"#topupactionsol-1\" aria-label=\"topupactionsol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TopUpAction.sol</h4>\n<p>scope: <code>getHealthFactor()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"95\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:760: bytes memory extra</span></span></code></pre>\n<h4 id=\"topupkeeperhelpersol\" style=\"position:relative;\"><a href=\"#topupkeeperhelpersol\" aria-label=\"topupkeeperhelpersol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TopUpKeeperHelper.sol</h4>\n<p>scope: <code>canExecute()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"96\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpKeeperHelper.sol:108: ITopUpAction.RecordKey memory key</span></span></code></pre>\n<p>scope: <code>_canExecute()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"97\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpKeeperHelper.sol:131: ITopUpAction.RecordWithMeta memory position</span></span></code></pre>\n<p>scope: <code>_positionToTopup()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"98\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpKeeperHelper.sol:145: ITopUpAction.RecordWithMeta memory position</span></span></code></pre>\n<p>scope: <code>_shortenTopups()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"99\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpKeeperHelper.sol:159: TopupData[] memory topups</span></span></code></pre>\n<h4 id=\"erc20poolsol\" style=\"position:relative;\"><a href=\"#erc20poolsol\" aria-label=\"erc20poolsol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Erc20Pool.sol</h4>\n<p>scope: <code>initialize()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"100\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Erc20Pool.sol:15: string memory name_</span></span></code></pre>\n<h4 id=\"ethpoolsol\" style=\"position:relative;\"><a href=\"#ethpoolsol\" aria-label=\"ethpoolsol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EthPool.sol</h4>\n<p>scope: <code>initialize()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"101\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">EthPool.sol:13: string memory name_</span></span></code></pre>\n<h4 id=\"liquiditypoolsol\" style=\"position:relative;\"><a href=\"#liquiditypoolsol\" aria-label=\"liquiditypoolsol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LiquidityPool.sol</h4>\n<p>scope: <code>initialize()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"102\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:702: string memory name_</span></span></code></pre>\n<h4 id=\"lptokensol\" style=\"position:relative;\"><a href=\"#lptokensol\" aria-label=\"lptokensol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LpToken.sol</h4>\n<p>scope: <code>initialize()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"103\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">LpToken.sol:29: string memory name_</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LpToken.sol:30: string memory symbol_</span></span></code></pre>\n<h3 id=\"mitigation-1\" style=\"position:relative;\"><a href=\"#mitigation-1\" aria-label=\"mitigation 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MITIGATION</h3>\n<p>Replace <code>memory</code> with <code>calldata</code></p>\n<h2 id=\"g-03-comparisons-with-zero-for-unsigned-integers\" style=\"position:relative;\"><a href=\"#g-03-comparisons-with-zero-for-unsigned-integers\" aria-label=\"g 03 comparisons with zero for unsigned integers permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-03] Comparisons with zero for unsigned integers</h2>\n<h3 id=\"problem-2\" style=\"position:relative;\"><a href=\"#problem-2\" aria-label=\"problem 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROBLEM</h3>\n<p><code>>0</code> is less gas efficient than <code>!0</code> if you enable the optimizer at 10k AND you’re in a require statement.\nDetailed explanation with the opcodes <a href=\"https://twitter.com/gzeon/status/1485428085885640706\">here</a></p>\n<h3 id=\"proof-of-concept-15\" style=\"position:relative;\"><a href=\"#proof-of-concept-15\" aria-label=\"proof of concept 15 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROOF OF CONCEPT</h3>\n<p>Instances include:</p>\n<h4 id=\"topupactionsol-2\" style=\"position:relative;\"><a href=\"#topupactionsol-2\" aria-label=\"topupactionsol 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TopUpAction.sol</h4>\n<p>scope: <code>register()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"104\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:210</span></span></code></pre>\n<p>scope: <code>execute()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"105\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:554</span></span></code></pre>\n<h4 id=\"topupactionfeehandlersol\" style=\"position:relative;\"><a href=\"#topupactionfeehandlersol\" aria-label=\"topupactionfeehandlersol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TopUpActionFeeHandler.sol</h4>\n<p>scope: <code>claimKeeperFeesForPool()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"106\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionFeeHandler.sol:123</span></span></code></pre>\n<h4 id=\"liquiditypoolsol-1\" style=\"position:relative;\"><a href=\"#liquiditypoolsol-1\" aria-label=\"liquiditypoolsol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LiquidityPool.sol</h4>\n<p>scope: <code>updateDepositCap()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"107\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:401</span></span></code></pre>\n<p>scope: <code>calcRedeem()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"108\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:471</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:473</span></span></code></pre>\n<p>scope: <code>redeem()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"109\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:549</span></span></code></pre>\n<h4 id=\"vaultsol-2\" style=\"position:relative;\"><a href=\"#vaultsol-2\" aria-label=\"vaultsol 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vault.sol</h4>\n<p>scope: <code>withdrawFromReserve()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"110\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:164</span></span></code></pre>\n<h4 id=\"bkdlockersol\" style=\"position:relative;\"><a href=\"#bkdlockersol\" aria-label=\"bkdlockersol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BkdLocker.sol</h4>\n<p>scope: <code>depositFees()</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"111\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdLocker.sol:90</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdLocker.sol:91</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdLocker.sol:136</span></span></code></pre>\n<h3 id=\"mitigation-2\" style=\"position:relative;\"><a href=\"#mitigation-2\" aria-label=\"mitigation 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MITIGATION</h3>\n<p>Replace <code>> 0</code> with <code>!0</code></p>\n<h2 id=\"g-04-comparison-operators\" style=\"position:relative;\"><a href=\"#g-04-comparison-operators\" aria-label=\"g 04 comparison operators permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-04] Comparison Operators</h2>\n<h3 id=\"problem-3\" style=\"position:relative;\"><a href=\"#problem-3\" aria-label=\"problem 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROBLEM</h3>\n<p>In the EVM, there is no opcode for >= or &#x3C;=.\nWhen using greater than or equal, two operations are performed: > and =.</p>\n<p>Using strict comparison operators hence saves gas</p>\n<h3 id=\"proof-of-concept-16\" style=\"position:relative;\"><a href=\"#proof-of-concept-16\" aria-label=\"proof of concept 16 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROOF OF CONCEPT</h3>\n<p>Instances include:</p>\n<h4 id=\"topupactionsol-3\" style=\"position:relative;\"><a href=\"#topupactionsol-3\" aria-label=\"topupactionsol 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TopUpAction.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"112\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:61</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:212</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:224</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:328</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:360</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:361</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:500</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:501</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:576</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:584</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:724</span></span></code></pre>\n<h4 id=\"topupactionfeehandlersol-1\" style=\"position:relative;\"><a href=\"#topupactionfeehandlersol-1\" aria-label=\"topupactionfeehandlersol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TopUpActionFeeHandler.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"113\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionFeeHandler.sol:54</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionFeeHandler.sol:151</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionFeeHandler.sol:163</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionFeeHandler.sol:196</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionFeeHandler.sol:208</span></span></code></pre>\n<h4 id=\"chainlinkoracleprovidersol\" style=\"position:relative;\"><a href=\"#chainlinkoracleprovidersol\" aria-label=\"chainlinkoracleprovidersol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ChainLinkOracleProvider.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"114\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">ChainLinkOracleProvider.sol:41</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ChainLinkOracleProvider.sol:57</span></span></code></pre>\n<h4 id=\"ethpoolsol-1\" style=\"position:relative;\"><a href=\"#ethpoolsol-1\" aria-label=\"ethpoolsol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EthPool.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"115\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">EthPool.sol:442</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">EthPool.sol:208</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">EthPool.sol:518</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">EthPool.sol:525</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">EthPool.sol:551</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">EthPool.sol:562</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">EthPool.sol:690</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">EthPool.sol:811</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">EthPool.sol:812</span></span></code></pre>\n<h4 id=\"bkdethcvxsol-1\" style=\"position:relative;\"><a href=\"#bkdethcvxsol-1\" aria-label=\"bkdethcvxsol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BkdEthCvx.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"116\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdEthCvx.sol:76</span></span></code></pre>\n<h4 id=\"bkdtrihopcvxsol-1\" style=\"position:relative;\"><a href=\"#bkdtrihopcvxsol-1\" aria-label=\"bkdtrihopcvxsol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BkdTriHopCvx.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"117\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdTriHopCvx.sol:174</span></span></code></pre>\n<h4 id=\"convexstrategybasesol-1\" style=\"position:relative;\"><a href=\"#convexstrategybasesol-1\" aria-label=\"convexstrategybasesol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ConvexStrategyBase.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"118\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:197</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:214</span></span></code></pre>\n<h4 id=\"strategyswappersol\" style=\"position:relative;\"><a href=\"#strategyswappersol\" aria-label=\"strategyswappersol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>StrategySwapper.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"119\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">StrategySwapper.sol:110</span></span></code></pre>\n<h4 id=\"cvxmintamountsol\" style=\"position:relative;\"><a href=\"#cvxmintamountsol\" aria-label=\"cvxmintamountsol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CvxMintAmount.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"120\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">CvxMintAmount.sol:21</span></span></code></pre>\n<h4 id=\"preparablesol\" style=\"position:relative;\"><a href=\"#preparablesol\" aria-label=\"preparablesol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Preparable.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"121\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Preparable.sol:29</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Preparable.sol:110</span></span></code></pre>\n<h4 id=\"vaultsol-3\" style=\"position:relative;\"><a href=\"#vaultsol-3\" aria-label=\"vaultsol 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vault.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"122\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:88</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:89</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:90</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:167</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:264</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:323</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:392</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:437</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:482</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:712</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:763</span></span></code></pre>\n<h4 id=\"vaultreservesol\" style=\"position:relative;\"><a href=\"#vaultreservesol\" aria-label=\"vaultreservesol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>VaultReserve.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"123\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">VaultReserve.sol:59</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">VaultReserve.sol:75</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">VaultReserve.sol:103</span></span></code></pre>\n<h4 id=\"bkdlockersol-1\" style=\"position:relative;\"><a href=\"#bkdlockersol-1\" aria-label=\"bkdlockersol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BkdLocker.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"124\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdLocker.sol:119</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdLocker.sol:140</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdLocker.sol:281</span></span></code></pre>\n<h4 id=\"controllersol\" style=\"position:relative;\"><a href=\"#controllersol\" aria-label=\"controllersol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Controller.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"125\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Controller:98</span></span></code></pre>\n<h4 id=\"cvxcrvrewardslockersol\" style=\"position:relative;\"><a href=\"#cvxcrvrewardslockersol\" aria-label=\"cvxcrvrewardslockersol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CvxCrvRewardsLocker.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"126\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">CvxCrvRewardsLocker:84</span></span></code></pre>\n<h4 id=\"gasbanksol\" style=\"position:relative;\"><a href=\"#gasbanksol\" aria-label=\"gasbanksol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GasBank.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"127\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">GasBank:68</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">GasBank:76</span></span></code></pre>\n<h4 id=\"stakervaultsol\" style=\"position:relative;\"><a href=\"#stakervaultsol\" aria-label=\"stakervaultsol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>StakerVault.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"128\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:107</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:150</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:153</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:324</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:368</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:371</span></span></code></pre>\n<h3 id=\"mitigation-3\" style=\"position:relative;\"><a href=\"#mitigation-3\" aria-label=\"mitigation 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MITIGATION</h3>\n<p>Replace <code>&#x3C;=</code> with <code>&#x3C;</code>, and <code>>=</code> with <code>></code>. Do not forget to increment/decrement the compared variable</p>\n<p>example:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"129\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">-require(maxFee &gt;= minFee, Error.INVALID_AMOUNT);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+require(maxFee &gt; minFee - 1, Error.INVALID_AMOUNT);</span></span></code></pre>\n<p>When the comparison is with a constant storage variable, you can also do the increment in the storage variable declaration</p>\n<p>example:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"130\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">-require(maxFee &lt;= _MAX_WITHDRAWAL_FEE, Error.INVALID_AMOUNT)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+require(maxFee &lt; _MAX_WITHDRAWAL_FEE_PLUS_ONE, Error.INVALID_AMOUNT)</span></span></code></pre>\n<p>However, when <code>1</code> is negligible compared to the variable (with is the case here as the variable is in the order of <code>10**16</code>), it is not necessary to increment.</p>\n<h2 id=\"g-05-custom-errors\" style=\"position:relative;\"><a href=\"#g-05-custom-errors\" aria-label=\"g 05 custom errors permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-05] Custom Errors</h2>\n<h3 id=\"problem-4\" style=\"position:relative;\"><a href=\"#problem-4\" aria-label=\"problem 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROBLEM</h3>\n<p>Custom errors from Solidity 0.8.4 are cheaper than revert strings (cheaper deployment cost and runtime cost when the revert condition is met) while providing the same amount of information, as explained <a href=\"https://blog.soliditylang.org/2021/04/21/custom-errors/\">here</a></p>\n<p>Custom errors are defined using the error statement</p>\n<h3 id=\"proof-of-concept-17\" style=\"position:relative;\"><a href=\"#proof-of-concept-17\" aria-label=\"proof of concept 17 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROOF OF CONCEPT</h3>\n<p>Instances include:</p>\n<h4 id=\"rolemanagersol-1\" style=\"position:relative;\"><a href=\"#rolemanagersol-1\" aria-label=\"rolemanagersol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RoleManager.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"131\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">RoleManager.sol:44</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">RoleManager.sol:110</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">RoleManager.sol:111</span></span></code></pre>\n<h4 id=\"aavehandlersol-2\" style=\"position:relative;\"><a href=\"#aavehandlersol-2\" aria-label=\"aavehandlersol 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AaveHandler.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"132\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">AaveHandler.sol:51</span></span></code></pre>\n<h4 id=\"compoundhandlersol-2\" style=\"position:relative;\"><a href=\"#compoundhandlersol-2\" aria-label=\"compoundhandlersol 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CompoundHandler.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"133\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">CompoundHandler.sol:74</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">CompoundHandler.sol:80</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">CompoundHandler.sol:123</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">CompoundHandler.sol:141</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">CompoundHandler.sol:148</span></span></code></pre>\n<h4 id=\"topupactionsol-4\" style=\"position:relative;\"><a href=\"#topupactionsol-4\" aria-label=\"topupactionsol 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TopUpAction.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"134\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:67</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:98</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:185</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:209</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:210</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:211</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:212</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:213</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:217</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:218</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:224</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:282</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:328</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:359</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:546</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:553</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:554</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:560</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:575</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:583</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:676</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:723</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:928</span></span></code></pre>\n<h4 id=\"topupactionfeehandlersol-2\" style=\"position:relative;\"><a href=\"#topupactionfeehandlersol-2\" aria-label=\"topupactionfeehandlersol 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TopUpActionFeeHandler.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"135\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionFeeHandler.sol:67</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionFeeHandler.sol:68</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionFeeHandler.sol:87</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionFeeHandler.sol:123</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionFeeHandler.sol:151</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionFeeHandler.sol:161</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionFeeHandler.sol:196</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionFeeHandler.sol:206</span></span></code></pre>\n<h4 id=\"chainlinkoracleprovidersol-1\" style=\"position:relative;\"><a href=\"#chainlinkoracleprovidersol-1\" aria-label=\"chainlinkoracleprovidersol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ChainLinkOracleProvider.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"136\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">ChainLinkOracleProvider.sol:31</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ChainLinkOracleProvider.sol:41</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ChainLinkOracleProvider.sol:53</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ChainLinkOracleProvider.sol:57</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ChainLinkOracleProvider.sol:58</span></span></code></pre>\n<h4 id=\"erc20poolsol-1\" style=\"position:relative;\"><a href=\"#erc20poolsol-1\" aria-label=\"erc20poolsol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Erc20Pool.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"137\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Erc20Pool.sol:20</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Erc20Pool.sol:30</span></span></code></pre>\n<h4 id=\"ethpoolsol-2\" style=\"position:relative;\"><a href=\"#ethpoolsol-2\" aria-label=\"ethpoolsol 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EthPool.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"138\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">EthPool.sol:25</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">EthPool.sol:26</span></span></code></pre>\n<h4 id=\"liquiditypoolsol-2\" style=\"position:relative;\"><a href=\"#liquiditypoolsol-2\" aria-label=\"liquiditypoolsol 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LiquidityPool.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"139\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:76</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:136</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:137</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:155</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:179</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:208</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:331</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:333</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:387</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:399</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:400</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:401</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:441</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:471</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:473</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:517</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:525</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:549</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:551</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:562</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:811</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:812</span></span></code></pre>\n<h4 id=\"poolfactorysol\" style=\"position:relative;\"><a href=\"#poolfactorysol\" aria-label=\"poolfactorysol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PoolFactory.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"140\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">PoolFactory.sol:159</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">PoolFactory.sol:162</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">PoolFactory.sol:165</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">PoolFactory.sol:170</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">PoolFactory.sol:180</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">PoolFactory.sol:184</span></span></code></pre>\n<h4 id=\"bkdtrihopcvxsol-2\" style=\"position:relative;\"><a href=\"#bkdtrihopcvxsol-2\" aria-label=\"bkdtrihopcvxsol 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BkdTriHopCvx.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"141\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdTriHopCvx.sol:133</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdTriHopCvx.sol:147</span></span></code></pre>\n<h4 id=\"convexstrategybasesol-2\" style=\"position:relative;\"><a href=\"#convexstrategybasesol-2\" aria-label=\"convexstrategybasesol 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ConvexStrategyBase.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"142\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:117</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:144</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:197</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:198</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:214</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:215</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:260</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:273</span></span></code></pre>\n<h4 id=\"strategyswappersol-1\" style=\"position:relative;\"><a href=\"#strategyswappersol-1\" aria-label=\"strategyswappersol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>StrategySwapper.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"143\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">StrategySwapper.sol:69</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StrategySwapper.sol:110</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StrategySwapper.sol:111</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StrategySwapper.sol:123</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StrategySwapper.sol:124</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StrategySwapper.sol:139</span></span></code></pre>\n<h4 id=\"preparablesol-1\" style=\"position:relative;\"><a href=\"#preparablesol-1\" aria-label=\"preparablesol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Preparable.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"144\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Preparable.sol:28</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Preparable.sol:29</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Preparable.sol:86</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Preparable.sol:98</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Preparable.sol:110</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Preparable.sol:111</span></span></code></pre>\n<h4 id=\"erc20vaultsol\" style=\"position:relative;\"><a href=\"#erc20vaultsol\" aria-label=\"erc20vaultsol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Erc20Vault.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"145\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Erc20Vault.sol:20</span></span></code></pre>\n<h4 id=\"vaultsol-4\" style=\"position:relative;\"><a href=\"#vaultsol-4\" aria-label=\"vaultsol 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vault.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"146\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:88</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:89</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:90</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:164</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:165</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:167</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:194</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:195</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:198</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:264</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:392</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:429</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:762</span></span></code></pre>\n<h4 id=\"vaultreservesol-1\" style=\"position:relative;\"><a href=\"#vaultreservesol-1\" aria-label=\"vaultreservesol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>VaultReserve.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"147\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">VaultReserve.sol:51</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">VaultReserve.sol:59</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">VaultReserve.sol:73</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">VaultReserve.sol:75</span></span></code></pre>\n<h4 id=\"addressprovidersol\" style=\"position:relative;\"><a href=\"#addressprovidersol\" aria-label=\"addressprovidersol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AddressProvider.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"148\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">AddressProvider.sol:64</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AddressProvider.sol:70</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AddressProvider.sol:96</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AddressProvider.sol:100</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AddressProvider.sol:170</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AddressProvider.sol:179</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AddressProvider.sol:188</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AddressProvider.sol:230</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AddressProvider.sol:231</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AddressProvider.sol:249</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AddressProvider.sol:259</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AddressProvider.sol:284</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AddressProvider.sol:285</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AddressProvider.sol:314</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AddressProvider.sol:417</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AddressProvider.sol:423</span></span></code></pre>\n<h4 id=\"bkdlockersol-2\" style=\"position:relative;\"><a href=\"#bkdlockersol-2\" aria-label=\"bkdlockersol 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BkdLocker.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"149\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdLocker.sol:58</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdLocker.sol:90</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdLocker.sol:91</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdLocker.sol:118</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdLocker.sol:136</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdLocker.sol:207</span></span></code></pre>\n<h4 id=\"controllersol-1\" style=\"position:relative;\"><a href=\"#controllersol-1\" aria-label=\"controllersol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Controller.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"150\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Controller:32</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Controller:33</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Controller:80</span></span></code></pre>\n<h4 id=\"cvxcrvrewardslockersol-1\" style=\"position:relative;\"><a href=\"#cvxcrvrewardslockersol-1\" aria-label=\"cvxcrvrewardslockersol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CvxCrvRewardsLocker.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"151\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">CvxCrvRewardsLocker:83</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">CvxCrvRewardsLocker:135</span></span></code></pre>\n<h4 id=\"gasbanksol-1\" style=\"position:relative;\"><a href=\"#gasbanksol-1\" aria-label=\"gasbanksol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GasBank.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"152\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">GasBank:42</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">GasBank:68</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">GasBank:69</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">GasBank:76</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">GasBank:91</span></span></code></pre>\n<h4 id=\"lptokensol-1\" style=\"position:relative;\"><a href=\"#lptokensol-1\" aria-label=\"lptokensol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LpToken.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"153\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">LpToken:34</span></span></code></pre>\n<h4 id=\"stakervaultsol-1\" style=\"position:relative;\"><a href=\"#stakervaultsol-1\" aria-label=\"stakervaultsol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>StakerVault.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"154\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:70</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:93</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:106</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:107</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:139</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:150</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:153</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:203</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:224</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:324</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:340</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:367</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:371</span></span></code></pre>\n<h4 id=\"swapperregistrysol\" style=\"position:relative;\"><a href=\"#swapperregistrysol\" aria-label=\"swapperregistrysol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SwapperRegistry.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"155\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">SwapperRegistry:35</span></span></code></pre>\n<h3 id=\"mitigation-4\" style=\"position:relative;\"><a href=\"#mitigation-4\" aria-label=\"mitigation 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MITIGATION</h3>\n<p>Replace require statements with custom errors.</p>\n<h2 id=\"g-06-default-value-initialization\" style=\"position:relative;\"><a href=\"#g-06-default-value-initialization\" aria-label=\"g 06 default value initialization permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-06] Default value initialization</h2>\n<h3 id=\"problem-5\" style=\"position:relative;\"><a href=\"#problem-5\" aria-label=\"problem 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROBLEM</h3>\n<p>If a variable is not set/initialized, it is assumed to have the default value (0, false, 0x0 etc depending on the data type).\nExplicitly initializing it with its default value is an anti-pattern and wastes gas.</p>\n<h3 id=\"proof-of-concept-18\" style=\"position:relative;\"><a href=\"#proof-of-concept-18\" aria-label=\"proof of concept 18 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROOF OF CONCEPT</h3>\n<p>Instances include:</p>\n<h4 id=\"rolemanagersol-2\" style=\"position:relative;\"><a href=\"#rolemanagersol-2\" aria-label=\"rolemanagersol 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RoleManager.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"156\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">RoleManager.sol:80</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">RoleManager.sol:110</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">RoleManager.sol:111</span></span></code></pre>\n<h4 id=\"compoundhandlersol-3\" style=\"position:relative;\"><a href=\"#compoundhandlersol-3\" aria-label=\"compoundhandlersol 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CompoundHandler.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"157\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">CompoundHandler.sol:135</span></span></code></pre>\n<h4 id=\"ctokenregistrysol-1\" style=\"position:relative;\"><a href=\"#ctokenregistrysol-1\" aria-label=\"ctokenregistrysol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CTokenRegistry.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"158\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">CTokenRegistry.sol:61</span></span></code></pre>\n<h4 id=\"topupactionsol-5\" style=\"position:relative;\"><a href=\"#topupactionsol-5\" aria-label=\"topupactionsol 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TopUpAction.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"159\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:188</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:452</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:456</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:479</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:506</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:891</span></span></code></pre>\n<h4 id=\"topupactionkeeperhandlersol\" style=\"position:relative;\"><a href=\"#topupactionkeeperhandlersol\" aria-label=\"topupactionkeeperhandlersol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TopUpActionKeeperHandler.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"160\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionKeeperHandler.sol:43</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionKeeperHandler.sol:46</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionKeeperHandler.sol:72</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionKeeperHandler.sol:93</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionKeeperHandler.sol:165</span></span></code></pre>\n<h4 id=\"liquiditypoolsol-3\" style=\"position:relative;\"><a href=\"#liquiditypoolsol-3\" aria-label=\"liquiditypoolsol 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LiquidityPool.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"161\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:483</span></span></code></pre>\n<h4 id=\"convexstrategybasesol-3\" style=\"position:relative;\"><a href=\"#convexstrategybasesol-3\" aria-label=\"convexstrategybasesol 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ConvexStrategyBase.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"162\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:313</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:380</span></span></code></pre>\n<h4 id=\"vaultsol-5\" style=\"position:relative;\"><a href=\"#vaultsol-5\" aria-label=\"vaultsol 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vault.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"163\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:42</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:135</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:583</span></span></code></pre>\n<h4 id=\"bkdlockersol-3\" style=\"position:relative;\"><a href=\"#bkdlockersol-3\" aria-label=\"bkdlockersol 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BkdLocker.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"164\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdLocker.sol:133</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdLocker.sol:310</span></span></code></pre>\n<h4 id=\"controllersol-2\" style=\"position:relative;\"><a href=\"#controllersol-2\" aria-label=\"controllersol 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Controller.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"165\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Controller:114</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Controller:117</span></span></code></pre>\n<h4 id=\"cvxcrvrewardslockersol-2\" style=\"position:relative;\"><a href=\"#cvxcrvrewardslockersol-2\" aria-label=\"cvxcrvrewardslockersol 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CvxCrvRewardsLocker.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"166\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">CvxCrvRewardsLocker:43</span></span></code></pre>\n<h4 id=\"stakervaultsol-2\" style=\"position:relative;\"><a href=\"#stakervaultsol-2\" aria-label=\"stakervaultsol 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>StakerVault.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"167\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:144</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:260</span></span></code></pre>\n<h3 id=\"mitigation-5\" style=\"position:relative;\"><a href=\"#mitigation-5\" aria-label=\"mitigation 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MITIGATION</h3>\n<p>Remove explicit initialization for default values.</p>\n<h2 id=\"g-07-prefix-increments\" style=\"position:relative;\"><a href=\"#g-07-prefix-increments\" aria-label=\"g 07 prefix increments permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-07] Prefix increments</h2>\n<h3 id=\"problem-6\" style=\"position:relative;\"><a href=\"#problem-6\" aria-label=\"problem 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROBLEM</h3>\n<p>Prefix increments are cheaper than postfix increments.</p>\n<h3 id=\"proof-of-concept-19\" style=\"position:relative;\"><a href=\"#proof-of-concept-19\" aria-label=\"proof of concept 19 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROOF OF CONCEPT</h3>\n<p>Instances include:</p>\n<h4 id=\"rolemanagersol-3\" style=\"position:relative;\"><a href=\"#rolemanagersol-3\" aria-label=\"rolemanagersol 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RoleManager.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"168\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">RoleManager.sol:80</span></span></code></pre>\n<h4 id=\"compoundhandlersol-4\" style=\"position:relative;\"><a href=\"#compoundhandlersol-4\" aria-label=\"compoundhandlersol 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CompoundHandler.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"169\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">CompoundHandler.sol:135</span></span></code></pre>\n<h4 id=\"ctokenregistrysol-2\" style=\"position:relative;\"><a href=\"#ctokenregistrysol-2\" aria-label=\"ctokenregistrysol 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CTokenRegistry.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"170\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">CTokenRegistry.sol:61</span></span></code></pre>\n<h4 id=\"topupactionsol-6\" style=\"position:relative;\"><a href=\"#topupactionsol-6\" aria-label=\"topupactionsol 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TopUpAction.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"171\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:188</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:456</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:479</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:506</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction.sol:891</span></span></code></pre>\n<h4 id=\"topupactionkeeperhandlersol-1\" style=\"position:relative;\"><a href=\"#topupactionkeeperhandlersol-1\" aria-label=\"topupactionkeeperhandlersol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TopUpActionKeeperHandler.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"172\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionKeeperHandler.sol:43</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionKeeperHandler.sol:46</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionKeeperHandler.sol:50</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionKeeperHandler.sol:72</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionKeeperHandler.sol:93</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpActionKeeperHandler.sol:165</span></span></code></pre>\n<h4 id=\"convexstrategybasesol-4\" style=\"position:relative;\"><a href=\"#convexstrategybasesol-4\" aria-label=\"convexstrategybasesol 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ConvexStrategyBase.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"173\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:313</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase.sol:380</span></span></code></pre>\n<h4 id=\"bkdlockersol-4\" style=\"position:relative;\"><a href=\"#bkdlockersol-4\" aria-label=\"bkdlockersol 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BkdLocker.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"174\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdLocker.sol:310</span></span></code></pre>\n<h4 id=\"controllersol-3\" style=\"position:relative;\"><a href=\"#controllersol-3\" aria-label=\"controllersol 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Controller.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"175\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Controller:117</span></span></code></pre>\n<h4 id=\"stakervaultsol-3\" style=\"position:relative;\"><a href=\"#stakervaultsol-3\" aria-label=\"stakervaultsol 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>StakerVault.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"176\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault:260</span></span></code></pre>\n<h3 id=\"mitigation-6\" style=\"position:relative;\"><a href=\"#mitigation-6\" aria-label=\"mitigation 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MITIGATION</h3>\n<p>change <code>variable++</code> to <code>++variable</code></p>\n<h2 id=\"g-08-redundant-code\" style=\"position:relative;\"><a href=\"#g-08-redundant-code\" aria-label=\"g 08 redundant code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-08] Redundant code</h2>\n<h3 id=\"impact-3\" style=\"position:relative;\"><a href=\"#impact-3\" aria-label=\"impact 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>IMPACT</h3>\n<p>Redundant code should be avoided as it costs unnecessary gas</p>\n<h3 id=\"proof-of-concept-20\" style=\"position:relative;\"><a href=\"#proof-of-concept-20\" aria-label=\"proof of concept 20 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROOF OF CONCEPT</h3>\n<p>Instances include:</p>\n<h4 id=\"preparablesol-2\" style=\"position:relative;\"><a href=\"#preparablesol-2\" aria-label=\"preparablesol 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Preparable.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"177\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Preparable.sol:140:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">address oldValue = currentAddresses[key];</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">currentAddresses[key] = value;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">pendingAddresses[key] = address(0);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">deadlines[key] = 0;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">emit ConfigUpdatedAddress(key, oldValue, value);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">return value;</span></span></code></pre>\n<p>We can update <code>currentAddresses[key]</code> after emitting the event to save the gas of the declaration of <code>oldValue</code>:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"178\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">+emit ConfigUpdatedAddress(key, currentAddresses[key], value);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">pendingAddresses[key] = address(0);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">deadlines[key] = 0;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">currentAddresses[key] = value;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">return value;</span></span></code></pre>\n<h3 id=\"mitigation-7\" style=\"position:relative;\"><a href=\"#mitigation-7\" aria-label=\"mitigation 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MITIGATION</h3>\n<p>see Proof of Concept for mitigation steps.</p>\n<h2 id=\"g-09-require-instead-of-\" style=\"position:relative;\"><a href=\"#g-09-require-instead-of-\" aria-label=\"g 09 require instead of  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-09] Require instead of &#x26;&#x26;</h2>\n<h3 id=\"impact-4\" style=\"position:relative;\"><a href=\"#impact-4\" aria-label=\"impact 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>IMPACT</h3>\n<p>Require statements including conditions with the <code>&#x26;&#x26;</code> operator can be broken down in multiple require statements to save gas.</p>\n<h3 id=\"proof-of-concept-21\" style=\"position:relative;\"><a href=\"#proof-of-concept-21\" aria-label=\"proof of concept 21 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROOF OF CONCEPT</h3>\n<p>Instances include:</p>\n<h4 id=\"topupactionsol-7\" style=\"position:relative;\"><a href=\"#topupactionsol-7\" aria-label=\"topupactionsol 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TopUpAction.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"179\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TopUpAction:360:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">require(</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            newSwapperSlippage &gt;= _MIN_SWAPPER_SLIPPAGE &amp;&amp;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                newSwapperSlippage &lt;= _MAX_SWAPPER_SLIPPAGE,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            Error.INVALID_AMOUNT</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        );</span></span></code></pre>\n<h4 id=\"convexstrategybasesol-5\" style=\"position:relative;\"><a href=\"#convexstrategybasesol-5\" aria-label=\"convexstrategybasesol 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ConvexStrategyBase.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"180\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">ConvexStrategyBase:274:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">require(</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            token_ != address(_CVX) &amp;&amp; token_ != address(underlying) &amp;&amp; token_ != address(_CRV),</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            Error.INVALID_TOKEN_TO_ADD</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        );</span></span></code></pre>\n<h4 id=\"swapperregistrysol-1\" style=\"position:relative;\"><a href=\"#swapperregistrysol-1\" aria-label=\"swapperregistrysol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SwapperRegistry.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"181\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">SwapperRegistry:35:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">require(</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            fromToken != toToken &amp;&amp;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                fromToken != address(0) &amp;&amp;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                toToken != address(0) &amp;&amp;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                newSwapper != address(0),</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            Error.INVALID_TOKEN_PAIR</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        );</span></span></code></pre>\n<h3 id=\"mitigation-8\" style=\"position:relative;\"><a href=\"#mitigation-8\" aria-label=\"mitigation 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MITIGATION</h3>\n<p>Breakdown each condition in a separate <code>require</code> statement (though require statements should be <a href=\"#custom-errors\">replaced with custom errors</a>)</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"182\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">require( newSwapperSlippage &gt;=_MIN_SWAPPER_SLIPPAGE);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">require(newSwapperSlippage &lt;= _MAX_SWAPPER_SLIPPAGE,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            Error.INVALID_AMOUNT)</span></span></code></pre>\n<h2 id=\"g-10-tight-variable-packing\" style=\"position:relative;\"><a href=\"#g-10-tight-variable-packing\" aria-label=\"g 10 tight variable packing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-10] Tight Variable Packing</h2>\n<h3 id=\"problem-7\" style=\"position:relative;\"><a href=\"#problem-7\" aria-label=\"problem 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROBLEM</h3>\n<p>Solidity contracts have contiguous 32 bytes (256 bits) slots used in storage.\nBy arranging the variables, it is possible to minimize the number of slots used within a contract’s storage and therefore reduce deployment costs.</p>\n<p>address type variables are each of 20 bytes size (way less than 32 bytes). However, they here take up a whole 32 bytes slot (they are contiguous).</p>\n<p>As bool type variables are of size 1 byte, there’s a slot here that can get saved by moving them closer to an address</p>\n<h3 id=\"proof-of-concept-22\" style=\"position:relative;\"><a href=\"#proof-of-concept-22\" aria-label=\"proof of concept 22 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROOF OF CONCEPT</h3>\n<p>Instances include:</p>\n<h4 id=\"vaultstoragesol\" style=\"position:relative;\"><a href=\"#vaultstoragesol\" aria-label=\"vaultstoragesol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>VaultStorage.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"183\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">VaultStorage.sol:11:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">address public pool;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">uint256 public totalDebt;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">bool public strategyActive;</span></span></code></pre>\n<h3 id=\"mitigation-9\" style=\"position:relative;\"><a href=\"#mitigation-9\" aria-label=\"mitigation 9 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MITIGATION</h3>\n<p>Place <code>strategyActive</code> after <code>pool</code> to save one storage slot</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"184\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">address public pool;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+bool public strategyActive;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">uint256 public totalDebt;</span></span></code></pre>\n<h2 id=\"g-11-unchecked-arithmetic\" style=\"position:relative;\"><a href=\"#g-11-unchecked-arithmetic\" aria-label=\"g 11 unchecked arithmetic permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-11] Unchecked arithmetic</h2>\n<h3 id=\"problem-8\" style=\"position:relative;\"><a href=\"#problem-8\" aria-label=\"problem 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROBLEM</h3>\n<p>The default “checked” behavior costs more gas when adding/diving/multiplying, because under-the-hood those checks are implemented as a series of opcodes that, prior to performing the actual arithmetic, check for under/overflow and revert if it is detected.</p>\n<p>if it can statically be determined there is no possible way for your arithmetic to under/overflow (such as a condition in an if statement), surrounding the arithmetic in an <code>unchecked</code> block will save gas</p>\n<h3 id=\"proof-of-concept-23\" style=\"position:relative;\"><a href=\"#proof-of-concept-23\" aria-label=\"proof of concept 23 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PROOF OF CONCEPT</h3>\n<p>Instances include:</p>\n<h4 id=\"liquiditypoolsol-4\" style=\"position:relative;\"><a href=\"#liquiditypoolsol-4\" aria-label=\"liquiditypoolsol 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LiquidityPool.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"185\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">LiquidityPool.sol:751: underlyingBalance - underlyingToWithdraw; //because of the condition line 745, the underflow check is unnecessary</span></span></code></pre>\n<h4 id=\"bkdethcvxsol-2\" style=\"position:relative;\"><a href=\"#bkdethcvxsol-2\" aria-label=\"bkdethcvxsol 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BkdEthCvx.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"186\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdEthCvx.sol:83: uint256 requiredUnderlyingAmount = amount - underlyingBalance; //because of the condition line 76, the underflow check is unnecessary</span></span></code></pre>\n<h4 id=\"bkdtrihopcvxsol-3\" style=\"position:relative;\"><a href=\"#bkdtrihopcvxsol-3\" aria-label=\"bkdtrihopcvxsol 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BkdTriHopCvx.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"187\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">BkdTriHopCvx.sol:181: uint256 requiredUnderlyingAmount = amount - underlyingBalance; //because of the condition line 174, the underflow check is unnecessary</span></span></code></pre>\n<h4 id=\"cvxmintamountsol-1\" style=\"position:relative;\"><a href=\"#cvxmintamountsol-1\" aria-label=\"cvxmintamountsol 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CvxMintAmount.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"188\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">CvxMintAmount.sol:24: uint256 remaining = _CLIFF_COUNT - currentCliff; //because of the condition line 21, the underflow check is unnecessary</span></span></code></pre>\n<h4 id=\"vaultsol-6\" style=\"position:relative;\"><a href=\"#vaultsol-6\" aria-label=\"vaultsol 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vault.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"189\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:24: uint256 remaining = _CLIFF_COUNT - currentCliff; //because of the condition line 21, the underflow check is unnecessary</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:125: uint256 requiredWithdrawal = amount - availableUnderlying_; //because of the condition line 122, the underflow check is unnecessary</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:130: uint256 newTarget = (allocated - requiredWithdrawal) //because of the condition line 127, the underflow check is unnecessary</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:141: uint256 totalUnderlyingAfterWithdraw = totalUnderlying - amount; //because of the condition line 122, the underflow check is unnecessary</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:440: waitingForRemovalAllocated = _waitingForRemovalAllocated - withdrawn; //because of the condition line 437, the underflow check is unnecessary</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:444: uint256 profit = withdrawn - allocated; //because of the condition line 443, the underflow check is unnecessary</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:452: allocated -= withdrawn; //because of the condition line 443, the underflow check is unnecessary</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:591: uint256 profit = allocatedUnderlying - amountAllocated; //because of the condition line 589, the underflow check is unnecessary</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:595: profit -= currentDebt; //because of the condition line 593, the underflow check is unnecessary</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:600: currentDebt -= profit; //because of the condition line 593, the underflow check is unnecessary</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:605: uint256 loss = amountAllocated - allocatedUnderlying; //because of the condition line 603, the underflow check is unnecessary</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:784: uint256 withdrawAmount = allocatedUnderlying - target; //because of the condition line 782, the underflow check is unnecessary</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vault.sol:790: uint256 depositAmount = target - allocatedUnderlying; //because of the condition line 788, the underflow check is unnecessary</span></span></code></pre>\n<h4 id=\"stakervaultsol-4\" style=\"position:relative;\"><a href=\"#stakervaultsol-4\" aria-label=\"stakervaultsol 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>StakerVault.sol</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"190\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">StakerVault.sol:164: uint256 srcTokensNew = srcTokens - amount; //because of the condition line 153, the underflow check is unnecessary</span></span></code></pre>\n<h3 id=\"mitigation-10\" style=\"position:relative;\"><a href=\"#mitigation-10\" aria-label=\"mitigation 10 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MITIGATION</h3>\n<p>Place the arithmetic operations in an <code>unchecked</code> block</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-04-backd-findings/issues/168#issuecomment-1111981824\">chase-manning (Backd) resolved and commented</a>:</strong></p>\n<blockquote>\n<p>I consider this report to be of particularly high quality.</p>\n</blockquote>\n<hr>\n<h1 id=\"disclosures\" style=\"position:relative;\"><a href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Disclosures</h1>\n<p>C4 is an open organization governed by participants in the community.</p>\n<p>C4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.</p>\n<p>C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk10 { color: #4EC9B0; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>",
  "toc": "<ul>\n<li>\n<p><a href=\"#overview\">Overview</a></p>\n<ul>\n<li><a href=\"#about-c4\">About C4</a></li>\n<li><a href=\"#wardens\">Wardens</a></li>\n</ul>\n</li>\n<li><a href=\"#summary\">Summary</a></li>\n<li><a href=\"#scope\">Scope</a></li>\n<li><a href=\"#severity-criteria\">Severity Criteria</a></li>\n<li>\n<p><a href=\"#high-risk-findings-3\">High Risk Findings (3)</a></p>\n<ul>\n<li><a href=\"#h-01-user-can-steal-all-rewards-due-to-checkpoint-after-transfer\">[H-01] User can steal all rewards due to checkpoint after transfer</a></li>\n<li><a href=\"#h-02-function-lockfunds-in-topupactionlibrary-can-cause-serious-fund-lose-fee-and-capped-bypass-its-not-calling-stakervaultincreaseactionlockedbalance-when-transfers-stakes\">[H-02] function <code>lockFunds</code> in <code>TopUpActionLibrary</code> can cause serious fund lose. fee and Capped bypass. It’s not calling <code>stakerVault.increaseActionLockedBalance</code> when transfers stakes.</a></li>\n<li><a href=\"#h-03-customers-cannot-be-topuped-a-second-time\">[H-03] Customers cannot be <code>topUp()</code>ed a second time</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#medium-risk-findings-15\">Medium Risk Findings (15)</a></p>\n<ul>\n<li><a href=\"#m-01-call-should-be-used-instead-of-transfer-on-an-address-payable\">[M-01] <code>call()</code> should be used instead of <code>transfer()</code> on an <code>address payable</code></a></li>\n<li><a href=\"#m-02-its-possible-to-lose-total-governance-control-by-mistake\">[M-02] Its possible to lose total governance control by mistake</a></li>\n<li><a href=\"#m-03-lack-of-safeapprove0-prevents-some-registrations-and-the-changing-of-stakers-and-lp-tokens\">[M-03] Lack of <code>safeApprove(0)</code> prevents some registrations, and the changing of stakers and LP tokens</a></li>\n<li><a href=\"#m-04-cvxcrvrewardslocker-implements-a-swap-without-a-slippage-check-that-can-result-in-a-loss-of-funds-through-mev\">[M-04] <code>CvxCrvRewardsLocker</code> implements a swap without a slippage check that can result in a loss of funds through MEV</a></li>\n<li><a href=\"#m-05-chainlinks-latestrounddata-might-return-stale-or-incorrect-results\">[M-05] Chainlink’s <code>latestRoundData</code> might return stale or incorrect results</a></li>\n<li><a href=\"#m-06-erc777-tokens-can-bypass-depositcap-guard\">[M-06] ERC777 tokens can bypass <code>depositCap</code> guard</a></li>\n<li><a href=\"#m-07-inconsistency-between-constructor-and-setting-method-for-slippagetolerance\">[M-07] Inconsistency between constructor and setting method for <code>slippageTolerance</code></a></li>\n<li><a href=\"#m-08-_decimalmultiplier-doesnt-account-for-tokens-with-decimals-higher-than-18\">[M-08] <code>_decimalMultiplier</code> doesn’t account for tokens with decimals higher than 18</a></li>\n<li><a href=\"#m-09-getnewcurrentfees-reverts-when-minfeepercentage--feeratio\">[M-09] <code>getNewCurrentFees</code> reverts when <code>minFeePercentage</code> > <code>feeRatio</code></a></li>\n<li><a href=\"#m-10-griefer-can-extend-period-of-higher-withdrawal-fees\">[M-10] Griefer can extend period of higher withdrawal fees</a></li>\n<li><a href=\"#m-11-position-owner-should-set-allowed-slippage\">[M-11] Position owner should set allowed slippage</a></li>\n<li><a href=\"#m-12-compoundhandlertopup-using-the-wrong-function-selector-makes-native-token-topup-always-revert\">[M-12] <code>CompoundHandler#topUp()</code> Using the wrong function selector makes native token <code>topUp()</code> always revert</a></li>\n<li><a href=\"#m-13-cethinterfacerepayborrowbehalf-reading-non-existing-returns-makes--_repayanydebt-with-cether-always-revert\">[M-13] <code>CEthInterface#repayBorrowBehalf()</code> reading non-existing returns makes  <code>_repayAnyDebt()</code> with CEther always revert</a></li>\n<li><a href=\"#m-14-cethinterfacemint-reading-non-existing-returns-makes-topup-with-native-token-always-revert\">[M-14] <code>CEthInterface#mint()</code> reading non-existing returns makes <code>topUp()</code> with native token always revert</a></li>\n<li><a href=\"#m-15-malicious-stakers-can-grief-keepers\">[M-15] Malicious Stakers can grief Keepers</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#low-risk-and-non-critical-issues\">Low Risk and Non-Critical Issues</a></p>\n<ul>\n<li><a href=\"#l-01-the-first-withdrawal-for-each-vault-from-the-vault-reserve-has-no-delay\">L-01 The first withdrawal for each vault from the vault reserve has no delay</a></li>\n<li><a href=\"#l-02-aavehandler-does-not-extend-basehandler\">L-02 <code>AaveHandler</code> does not extend <code>BaseHandler</code></a></li>\n<li><a href=\"#l-03-unused-receive-function-will-lock-ether-in-contract\">L-03 Unused <code>receive()</code> function will lock Ether in contract</a></li>\n<li><a href=\"#l-04-front-runable-initializer\">L-04 Front-runable initializer</a></li>\n<li><a href=\"#l-05-safeapprove-is-deprecated\">L-05 <code>safeApprove()</code> is deprecated</a></li>\n<li><a href=\"#l-06-missing-checks-for-address0x0-when-assigning-values-to-address-state-variables\">L-06 Missing checks for <code>address(0x0)</code> when assigning values to <code>address</code> state variables</a></li>\n<li><a href=\"#l-07-abiencodepacked-should-not-be-used-with-dynamic-types-when-passing-the-result-to-a-hash-function-such-as-keccak256\">L-07 <code>abi.encodePacked()</code> should not be used with dynamic types when passing the result to a hash function such as <code>keccak256()</code></a></li>\n<li><a href=\"#l-08-addresscallvaluex-should-be-used-instead-of-payabletransfer\">L-08 <code>address.call{value:x}()</code> should be used instead of <code>payable.transfer()</code></a></li>\n<li><a href=\"#l-09-upgradeable-contract-is-missing-a-__gap50-storage-variable-to-allow-for-new-storage-variables-in-later-versions\">L-09 Upgradeable contract is missing a <code>__gap[50]</code> storage variable to allow for new storage variables in later versions</a></li>\n<li><a href=\"#l-10-math-library-unnecessarily-overflows-during-some-operations\">L-10 Math library unnecessarily overflows during some operations</a></li>\n<li><a href=\"#n-01-_preparedeadline-_setconfig-and-_executedeadline-should-be-private\">N-01 <code>_prepareDeadline()</code>, <code>_setConfig()</code>, and <code>_executeDeadline()</code> should be <code>private</code></a></li>\n<li><a href=\"#n-02-open-todos\">N-02 Open TODOs</a></li>\n<li><a href=\"#n-03-payable-function-does-not-reject-payments-to-erc20-tokens\">N-03 <code>payable</code> function does not reject payments to ERC20 tokens</a></li>\n<li><a href=\"#n-04-adding-a-return-statement-when-the-function-defines-a-named-return-variable-is-redundant\">N-04 Adding a <code>return</code> statement when the function defines a named return variable, is redundant</a></li>\n<li><a href=\"#n-05-public-functions-not-called-by-the-contract-should-be-declared-external-instead\">N-05 <code>public</code> functions not called by the contract should be declared <code>external</code> instead</a></li>\n<li><a href=\"#n-06-constants-should-be-defined-rather-than-using-magic-numbers\">N-06 <code>constant</code>s should be defined rather than using magic numbers</a></li>\n<li><a href=\"#n-07-large-multiples-of-ten-should-use-scientific-notation-eg-1e6-rather-than-decimal-literals-eg-1000000-for-readability\">N-07 Large multiples of ten should use scientific notation (e.g. <code>1e6</code>) rather than decimal literals (e.g. <code>1000000</code>), for readability</a></li>\n<li><a href=\"#n-08-use-a-more-recent-version-of-solidity\">N-08 Use a more recent version of solidity</a></li>\n<li><a href=\"#n-09-constant-redefined-elsewhere\">N-09 Constant redefined elsewhere</a></li>\n<li><a href=\"#n-10-inconsistent-spacing-in-comments\">N-10 Inconsistent spacing in comments</a></li>\n<li><a href=\"#n-11-typos\">N-11 Typos</a></li>\n<li><a href=\"#n-12-file-is-missing-natspec\">N-12 File is missing NatSpec</a></li>\n<li><a href=\"#n-13-natspec-is-incomplete\">N-13 NatSpec is incomplete</a></li>\n<li><a href=\"#n-14-event-is-missing-indexed-fields\">N-14 Event is missing <code>indexed</code> fields</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#gas-optimizations\">Gas Optimizations</a></p>\n<ul>\n<li><a href=\"#g-01-caching-storage-variables-in-memory-to-save-gas\">G-01 Caching storage variables in memory to save gas</a></li>\n<li><a href=\"#g-02-calldata-instead-of-memory-for-ro-function-parameters\">G-02 Calldata instead of memory for RO function parameters</a></li>\n<li><a href=\"#g-03-comparisons-with-zero-for-unsigned-integers\">G-03 Comparisons with zero for unsigned integers</a></li>\n<li><a href=\"#g-04-comparison-operators\">G-04 Comparison Operators</a></li>\n<li><a href=\"#g-05-custom-errors\">G-05 Custom Errors</a></li>\n<li><a href=\"#g-06-default-value-initialization\">G-06 Default value initialization</a></li>\n<li><a href=\"#g-07-prefix-increments\">G-07 Prefix increments</a></li>\n<li><a href=\"#g-08-redundant-code\">G-08 Redundant code</a></li>\n<li><a href=\"#g-09-require-instead-of-\">G-09 Require instead of &#x26;&#x26;</a></li>\n<li><a href=\"#g-10-tight-variable-packing\">G-10 Tight Variable Packing</a></li>\n<li><a href=\"#g-11-unchecked-arithmetic\">G-11 Unchecked arithmetic</a></li>\n</ul>\n</li>\n<li><a href=\"#disclosures\">Disclosures</a></li>\n</ul>",
  "md": "\n# Overview\n\n## About C4\n\nCode4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.\n\nA C4 audit contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.\n\nDuring the audit contest outlined in this document, C4 conducted an analysis of the Backd smart contract system written in Solidity. The audit contest took place between April 21—April 27 2022.\n\n## Wardens\n\n62 Wardens contributed reports to the Backd contest:\n\n  1. unforgiven\n  1. IllIllI\n  1. [WatchPug](https://twitter.com/WatchPug_)\n  1. 0xDjango\n  1. [shenwilly](https://twitter.com/shenwilly_)\n  1. [sseefried](http://seanseefried.org/blog)\n  1. 0x52\n  1. [Ruhum](https://twitter.com/0xruhum)\n  1. [fatherOfBlocks](https://twitter.com/father0fBl0cks)\n  1. [wuwe1](https://twitter.com/wuwe19)\n  1. [defsec](https://twitter.com/defsec_)\n  1. [Dravee](https://twitter.com/JustDravee)\n  1. horsefacts\n  1. joestakey\n  1. [pauliax](https://twitter.com/SolidityDev)\n  1. StyxRave\n  1. [rayn](https://twitter.com/rayn731)\n  1. hubble (ksk2345 and shri4net)\n  1. robee\n  1. [antonttc](https://github.com/antoncoding)\n  1. [Tomio](https://twitter.com/meidhiwirara)\n  1. [csanuragjain](https://twitter.com/csanuragjain)\n  1. TrungOre\n  1. sorrynotsorry\n  1. [catchup](https://twitter.com/catchup22)\n  1. 0xkatana\n  1. reassor\n  1. [berndartmueller](https://twitter.com/berndartmueller)\n  1. kenta\n  1. [securerodd](https://twitter.com/securerodd)\n  1. gs8nrv\n  1. hake\n  1. [z3s](https://github.com/z3s/)\n  1. [0v3rf10w](https://twitter.com/_0v3rf10w)\n  1. [Funen](https://instagram.com/vanensurya)\n  1. TerrierLover\n  1. oyc_109\n  1. simon135\n  1. [Tadashi](https://github.com/htadashi)\n  1. dipp\n  1. kebabsec (okkothejawa and [FlameHorizon](https://twitter.com/FlameHorizon1))\n  1. peritoflores\n  1. jayjonah8\n  1. [Kenshin](https://twitter.com/nonfungiblenero)\n  1. [m4rio_eth](BowTiedETHernal)\n  1. remora\n  1. [MaratCerby](https://twitter.com/MaratCerby)\n  1. 0x1f8b\n  1. cccz\n  1. hyh\n  1. slywaters\n  1. 0x4non\n  1. [0xNazgul](https://twitter.com/0xNazgul)\n  1. NoamYakov\n  1. [rfa](https://www.instagram.com/riyan_rfa/)\n  1. saian\n  1. 0xmint\n  1. tin537\n  1. [danb](https://twitter.com/danbinnun)\n  1. UnusualTurtle\n\nThis contest was judged by [gzeon](https://twitter.com/gzeon). The judge also competed in the contest as a warden, but forfeited their winnings.\n\nFinal report assembled by [liveactionllama](https://twitter.com/liveactionllama).\n\n# Summary\n\nThe C4 analysis yielded an aggregated total of 18 unique vulnerabilities. Of these vulnerabilities, 3 received a risk rating in the category of HIGH severity and 15 received a risk rating in the category of MEDIUM severity.\n\nAdditionally, C4 analysis included 39 reports detailing issues with a risk rating of LOW severity or non-critical. There were also 35 reports recommending gas optimizations.\n\nAll of the issues presented here are linked back to their original finding.\n\n# Scope\n\nThe code under review can be found within the [C4 Backd contest repository](https://github.com/code-423n4/2022-04-backd), and is composed of 38 smart contracts written in the Solidity programming language and includes 4,630 lines of Solidity code.\n\n# Severity Criteria\n\nC4 assesses the severity of disclosed vulnerabilities according to a methodology based on [OWASP standards](https://owasp.org/www-community/OWASP_Risk_Rating_Methodology).\n\nVulnerabilities are divided into three primary risk categories: high, medium, and low/non-critical.\n\nHigh-level considerations for vulnerabilities span the following key areas when conducting assessments:\n\n- Malicious Input Handling\n- Escalation of privileges\n- Arithmetic\n- Gas use\n\nFurther information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on [the C4 website](https://code4rena.com).\n\n# High Risk Findings (3)\n## [[H-01] User can steal all rewards due to checkpoint after transfer](https://github.com/code-423n4/2022-04-backd-findings/issues/36)\n_Submitted by 0xDjango, also found by unforgiven_\n\n[StakerVault.sol#L112-L119](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/StakerVault.sol#L112-L119)<br>\n\nI believe this to be a high severity vulnerability that is potentially included in the currently deployed `StakerVault.sol` contract also. The team will be contacted immediately following the submission of this report.\n\nIn `StakerVault.sol`, the user checkpoints occur AFTER the balances are updated in the `transfer()` function. The user checkpoints update the amount of rewards claimable by the user. Since their rewards will be updated after transfer, a user can send funds between their own accounts and repeatedly claim maximum rewards since the pool's inception.\n\nIn every actionable function except `transfer()` of `StakerVault.sol`, a call to `ILpGauge(lpGauge).userCheckpoint()` is correctly made BEFORE the action effects.\n\n### Proof of Concept\n\nAssume a certain period of time has passed since the pool's inception. For easy accounting, assume `poolStakedIntegral` of `LpGauge.sol` equals `1`. The `poolStakedIntegral` is used to keep track of the current reward rate.\n\nSteps:\n\n*   Account A stakes 1000 LP tokens. `balances[A] += 1000`\n*   In the same `stakeFor()` function, `userCheckpoint()` was already called so A will already have `perUserShare[A]` set correctly based on their previously 0 balance and the current `poolStakedIntegral`.\n*   Account A can immediately send all balance to Account B via `transfer()`.\n*   Since the checkpoint occurs after the transfer, B's balance will increase and then `perUserShare[B]` will be updated. The calculation for `perUserShare` looks as follows.\n\n<!---->\n```solidity\nperUserShare[user] += (\n            (stakerVault.stakedAndActionLockedBalanceOf(user)).scaledMul(\n                (poolStakedIntegral_ - perUserStakedIntegral[user])\n            )\n        );\n```\n\nAssuming Account B is new to the protocol, their `perUserStakedIntegral[user]` will default to `0`.\n\n`perUserShare[B] += 1000 * (1 - 0) = 1000`\n\n*   B is able to call `claimRewards()` and mint all 1000 reward tokens.\n*   B then calls `transfer()` and sends all 1000 staked tokens to Account C.\n*   Same calculation occurs, and C can claim all 1000 reward tokens.\n*   This process can be repeated until the contract is drained of reward tokens.\n\n### Recommended Mitigation Steps\n\nIn `StakerVault.transfer()`, move the call to `ILpGauge(lpGauge).userCheckpoint()` to before the balances are updated.\n\n**[chase-manning (Backd) confirmed and resolved](https://github.com/code-423n4/2022-04-backd-findings/issues/36)**\n\n\n\n***\n\n## [[H-02] function `lockFunds` in `TopUpActionLibrary` can cause serious fund lose. fee and Capped bypass. It's not calling `stakerVault.increaseActionLockedBalance` when transfers stakes.](https://github.com/code-423n4/2022-04-backd-findings/issues/60)\n_Submitted by unforgiven_\n\n[TopUpAction.sol#L57-L65](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L57-L65)<br>\n\nIn function TopUpActionLibrary.lockFunds when transfers stakes from payer it doesn't call stakerVault.increaseActionLockedBalance for that payer so stakerVault.actionLockedBalances\\[payer] is not get updated for payer and stakerVault.stakedAndActionLockedBalanceOf(payer) is going to show wrong value and any calculation based on this function is gonna be wrong which will cause fund lose and theft and some restriction bypasses.\n\n### Proof of Concept\n\nWhen user wants to create a TopUpAction. so he deposit his funds to Pool and get LP token. then stake the LP token in StakerVault and use that stakes to create a TopUp position with function TopUpAction.register. This function transfer user stakes (locks user staks) and create his position.<br>\n\nFor transferring and locking user stakes it uses TopUpActionLibrary.lockFunds. function lockFunds transfers user stakes but don't call stakerVault.increaseActionLockedBalance for the payer which cause that stakerVault.actionLockedBalances\\[payer] to get different values(not equal to position.depositTokenBalance).<br>\n\nFunction StakerVault.stakedAndActionLockedBalanceOf(account) uses stakerVault.actionLockedBalances\\[account] so it will return wrong value and any where in code that uses stakedAndActionLockedBalanceOf() is going to cause problems.<br>\n\nthree part of the codes uses stakerVault.stakedAndActionLockedBalanceOf():<br>\n1. LiqudityPool.depositFor() for checking user total deposits to be less than depositCap.<br>\n2. LiqudityPool.\\_updateUserFeesOnDeposit() for updating user fee on new deposits.<br>\n3. userCheckpoint() for calculating user rewards.<br>\nattacker can use #1 and #2 to bypass high fee payment and max depositCap and #3 will cause users to lose\nrewards.<br>\n\nThe detail steps:<br>\n1- user deposit fund to Pool and get LP token.<br>\n2- user stakes LP token in StakerVault.<br>\n3- user approve TopUpAction address to transfer his staks in StakerVault.<br>\n3- user use all his stakes to create a position with TopUpAction.register() function.<br>\n3.1- register() will call lockFunds to transfer and lock user stakes.<br>\n3.2- lockFunds() will transfer user stakes with stakerVault.transferFrom() but don't call stakerVault.increaseActionLockedBalance() so StakerVault.actionLockedBalances\\[user] will be zero.<br>\n3.3- StakerVault.balance\\[useer] will be zero too because his stakes get transfers in 3.2<br>\n4- StakerVault.stakedAndActionLockedBalanceOf(user) will return zero (user has some locked stakes in TopUpAction but because of the bug calculation get out of sync)<br>\n\nIn this moment user will lose all the rewards that are minted in LpGauge. because userCheckpoint() use stakerVault.stakedAndActionLockedBalanceOf(user) for calculating rewards which is zero  and new rewards will be zero too.<br>\n\nAttacker can use this process to bypass \"max deposit Cap\" and deposit any amount of assets he wants. because LiqudityPool.depositFor(address,uint256,uint256) uses stakedAndActionLockedBalanceOf to check user deposits which is zero so Attacker can deposit & stake & register to make his balance zero and repeat this and in the end reset his TopUp positions to get back his large stakes which are multiple time bigger than \"max deposit Cap\"\n\nAttacker can also use this process to bypass fee penalties for early withdraw. because LiqudityPool.\\_updateUserFeesOnDeposit() to get user current balance use stakedAndActionLockedBalanceOf() which is zero. so the value of shareExisting variable become zero and newFeeRatio will be calculated based on feeOnDeposit which can be minFee if asset is already in wallet for some time.\n\n### Tools Used\n\nVIM\n\n### Recommended Mitigation Steps\n\nAdd this line to TopUpActionLibrary.lockFunds() after stakerVault.transferFrom():\n\nstakerVault.increaseActionLockedBalance(payer, amountLeft);\n\n**[chase-manning (Backd) confirmed and resolved](https://github.com/code-423n4/2022-04-backd-findings/issues/60)**\n\n\n\n***\n\n## [[H-03] Customers cannot be `topUp()`ed a second time](https://github.com/code-423n4/2022-04-backd-findings/issues/178)\n_Submitted by IllIllI_\n\n[CompoundHandler.sol#L71](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CompoundHandler.sol#L71)<br>\n[CompoundHandler.sol#L120](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CompoundHandler.sol#L120)<br>\n[AaveHandler.sol#L53](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/AaveHandler.sol#L53)<br>\n[TopUpAction.sol#L847](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L847)<br>\n\nOpenZeppelin's `safeApprove()` will revert if the account already is approved and the new `safeApprove()` is done with a non-zero value.\n\n```solidity\nfunction safeApprove(\n    IERC20 token,\n    address spender,\n    uint256 value\n) internal {\n    // safeApprove should only be called when setting an initial allowance,\n    // or when resetting it to zero. To increase and decrease it, use\n    // 'safeIncreaseAllowance' and 'safeDecreaseAllowance'\n    require(\n        (value == 0) || (token.allowance(address(this), spender) == 0),\n        \"SafeERC20: approve from non-zero to non-zero allowance\"\n    );\n    _callOptionalReturn(token, abi.encodeWithSelector(token.approve.selector, spender, value));\n}\n```\n\n[OpenZeppelin/SafeERC20.sol#L45-L58](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/fcf35e5722847f5eadaaee052968a8a54d03622a/contracts/token/ERC20/utils/SafeERC20.sol#L45-L58)<br>\n\n### Impact\n\nCustomers cannot be topped up a second time, which will cause them to be liquidated even though they think they're protected.\n\n### Proof of Concept\n\nThere are multiple places where `safeApprove()` is called a second time without setting the value to zero first. The instances below are all related to topping up.\n\nCompound-specific top-ups will fail the second time around when approving the `ctoken` again:\n\n```solidity\nFile: backd/contracts/actions/topup/handlers/CompoundHandler.sol   #1\n\n50       function topUp(\n51           bytes32 account,\n52           address underlying,\n53           uint256 amount,\n54           bytes memory extra\n55       ) external override returns (bool) {\n56           bool repayDebt = abi.decode(extra, (bool));\n57           CToken ctoken = cTokenRegistry.fetchCToken(underlying);\n58           uint256 initialTokens = ctoken.balanceOf(address(this));\n59   \n60           address addr = account.addr();\n61   \n62           if (repayDebt) {\n63               amount -= _repayAnyDebt(addr, underlying, amount, ctoken);\n64               if (amount == 0) return true;\n65           }\n66   \n67           uint256 err;\n68           if (underlying == address(0)) {\n69               err = ctoken.mint{value: amount}(amount);\n70           } else {\n71               IERC20(underlying).safeApprove(address(ctoken), amount);\n```\n\n[CompoundHandler.sol#L50-L71](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CompoundHandler.sol#L50-L71)<br>\n\nCompound-specific top-ups will also fail when trying to repay debt:\n\n```solidity\nFile: backd/contracts/actions/topup/handlers/CompoundHandler.sol   #2\n\n62           if (repayDebt) {\n63               amount -= _repayAnyDebt(addr, underlying, amount, ctoken);\n64               if (amount == 0) return true;\n65           }\n```\n\n[CompoundHandler.sol#L62-L65](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CompoundHandler.sol#L62-L65)<br>\n\nAave-specific top-ups will fail for the `lendingPool`:\n\n```solidity\nFile: backd/contracts/actions/topup/handlers/AaveHandler.sol   #3\n\n36       function topUp(\n37           bytes32 account,\n38           address underlying,\n39           uint256 amount,\n40           bytes memory extra\n41       ) external override returns (bool) {\n42           bool repayDebt = abi.decode(extra, (bool));\n43           if (underlying == address(0)) {\n44               weth.deposit{value: amount}();\n45               underlying = address(weth);\n46           }\n47   \n48           address addr = account.addr();\n49   \n50           DataTypes.ReserveData memory reserve = lendingPool.getReserveData(underlying);\n51           require(reserve.aTokenAddress != address(0), Error.UNDERLYING_NOT_SUPPORTED);\n52   \n53           IERC20(underlying).safeApprove(address(lendingPool), amount);\n```\n\n[AaveHandler.sol#L36-L53](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/AaveHandler.sol#L36-L53)<br>\n\nThe `TopUpAction` itself fails for the `feeHandler`:\n\n```solidity\nFile: backd/contracts/actions/topup/TopUpAction.sol   #4\n\n840       function _payFees(\n841           address payer,\n842           address beneficiary,\n843           uint256 feeAmount,\n844           address depositToken\n845       ) internal {\n846           address feeHandler = getFeeHandler();\n847           IERC20(depositToken).safeApprove(feeHandler, feeAmount);\n```\n\n[TopUpAction.sol#L840-L847](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L840-L847)<br>\n\nI've filed the other less-severe instances as a separate medium-severity issue, and flagged the remaining low-severity instances in my QA report.\n\n### Recommended Mitigation Steps\n\nAlways do `safeApprove(0)` if the allowance is being changed, or use `safeIncreaseAllowance()`.\n\n**[chase-manning (Backd) confirmed and resolved](https://github.com/code-423n4/2022-04-backd-findings/issues/178)**\n\n\n\n***\n\n \n# Medium Risk Findings (15)\n## [[M-01] `call()` should be used instead of `transfer()` on an `address payable`](https://github.com/code-423n4/2022-04-backd-findings/issues/52)\n_Submitted by Dravee, also found by antonttc, berndartmueller, cccz, danb, horsefacts, hyh, IllIllI, MaratCerby, pauliax, rayn, UnusualTurtle, WatchPug, and wuwe1_\n\nThis is a classic Code4rena issue:\n\n*   <https://github.com/code-423n4/2021-04-meebits-findings/issues/2>\n*   <https://github.com/code-423n4/2021-10-tally-findings/issues/20>\n*   <https://github.com/code-423n4/2022-01-openleverage-findings/issues/75>\n\n### Impact\n\nThe use of the deprecated `transfer()` function for an address will inevitably make the transaction fail when:\n\n1.  The claimer smart contract does not implement a payable function.\n2.  The claimer smart contract does implement a payable fallback which uses more than 2300 gas unit.\n3.  The claimer smart contract implements a payable fallback function that needs less than 2300 gas units but is called through proxy, raising the call's gas usage above 2300.\n\nAdditionally, using higher than 2300 gas might be mandatory for some multisig wallets.\n\n#### Impacted lines:\n\n```solidity\nbackd/contracts/pool/EthPool.sol:\n  30:         to.transfer(amount);\n\nbackd/contracts/strategies/BkdEthCvx.sol:\n   77:             payable(vault).transfer(amount);\n   93:         payable(vault).transfer(amount);\n  117:         payable(vault).transfer(underlyingBalance);\n\nbackd/contracts/vault/EthVault.sol:\n  29:         payable(to).transfer(amount); \n  37:         payable(addressProvider.getTreasury()).transfer(amount);  \n\nbackd/contracts/vault/VaultReserve.sol:\n  81:             payable(msg.sender).transfer(amount);\n```\n\n### Recommended Mitigation\n\nI recommend using `call()` instead of `transfer()`.\n\n**[chase-manning (Backd) confirmed and resolved](https://github.com/code-423n4/2022-04-backd-findings/issues/52)**\n\n**[gzeon (judge) commented](https://github.com/code-423n4/2022-04-backd-findings/issues/52#issuecomment-1120238070):**\n > Sponsor confirmed. Judging this as Medium Risk.\n\n\n\n***\n\n## [[M-02] Its possible to lose total governance control by mistake](https://github.com/code-423n4/2022-04-backd-findings/issues/83)\n_Submitted by hubble, also found by antonttc, csanuragjain, gs8nrv, rayn, reassor, and TrungOre_\n\n[RoleManager.sol#L43-L46](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/access/RoleManager.sol#L43-L46)<br>\n[RoleManager.sol#L115-L128](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/access/RoleManager.sol#L115-L128)<br>\n\nThe impact of this vulnerability, i.e.,  losing all governance control is very High.<br>\nThere is a possibility, due to a corner case as described below.<br>\n\n### Proof of Concept\nContract : RoleManager.sol<br>\nFunction : renounceGovernance()<br>\n```\n   Step 0:\n     Let current governance role given to = CURRENT_GOV_ADDRESS\n     so, getRoleMemberCount() for \"governance\" role will return = 1 \n\n   Step 1: Add a new address say ALICE to governance role, by addGovernor(ALICE)\n     now, ALICE also has governace role, and getRoleMemberCount() for \"governance\" role will return = 2 \n   \n   Step 2: Assume that ALICE renounces governance role, by renounceGovernance()\n     now, ALICE does not have governance role, but getRoleMemberCount() for \"governance\" role will return = 2, due to a BUG\n\n   Step 3: In some distant future, if there is a compromise of CURRENT_GOV_ADDRESS keys or due to some other reason, \n     its decided to revoke governance role for CURRENT_GOV_ADDRESS via renounceGovernance(), and the command succeeds\n     It can be assumed that since getRoleMemberCount() for \"governance\" role returns = 2, at least there is one other active governor address. \n     But now, CURRENT_GOV_ADDRESS does not have governance role, and the total governance control on the protocol is lost my mistake.\n```\n### Recommended Mitigation Steps\ngetRoleMemberCount() currently returns _roleMembers[role].length();<br>\n  It should return the count only for _roles[role].members[account] = true;<br>\n\nIts recommended to add a new function to know who are the active members for any role,<br>\n  like getRoleMembers(bytes32 role) returning address account.\n\n**[chase-manning (Backd) confirmed](https://github.com/code-423n4/2022-04-backd-findings/issues/83)**\n\n**[gzeon (judge) decreased severity to Medium](https://github.com/code-423n4/2022-04-backd-findings/issues/83)**\n\n\n\n***\n\n## [[M-03] Lack of `safeApprove(0)` prevents some registrations, and the changing of stakers and LP tokens](https://github.com/code-423n4/2022-04-backd-findings/issues/180)\n_Submitted by IllIllI, also found by defsec and Dravee_\n\n[TopUpAction.sol#L50](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L50)<br>\n[LiquidityPool.sol#L721](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/LiquidityPool.sol#L721)<br>\n\nOpenZeppelin's `safeApprove()` will revert if the account already is approved and the new `safeApprove()` is done with a non-zero value\n\n```solidity\n    function safeApprove(\n        IERC20 token,\n        address spender,\n        uint256 value\n    ) internal {\n        // safeApprove should only be called when setting an initial allowance,\n        // or when resetting it to zero. To increase and decrease it, use\n        // 'safeIncreaseAllowance' and 'safeDecreaseAllowance'\n        require(\n            (value == 0) || (token.allowance(address(this), spender) == 0),\n            \"SafeERC20: approve from non-zero to non-zero allowance\"\n        );\n        _callOptionalReturn(token, abi.encodeWithSelector(token.approve.selector, spender, value));\n    }\n```\n\n[OpenZeppelin/SafeERC20.sol#L45-L58](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/fcf35e5722847f5eadaaee052968a8a54d03622a/contracts/token/ERC20/utils/SafeERC20.sol#L45-L58)<br>\n\n### Impact\n\nCustomers can be prevented from `register()`ing the same `token`/`stakerVaultAddress` as another customer; and once changed away from, stakers and lptokens can't be used in the future.\n\n### Proof of Concept\n\nThere are multiple places where `safeApprove()` is called a second time without setting the value to zero first.\n\n`register()` calls `lockFunds()` for each user registration, and since users will use the same tokens and staker vaults, the second user's `register()` call will fail:\n\n```solidity\nFile: backd/contracts/actions/topup/TopUpAction.sol   #1\n\n36       function lockFunds(\n37           address stakerVaultAddress,\n38           address payer,\n39           address token,\n40           uint256 lockAmount,\n41           uint256 depositAmount\n42       ) external {\n43           uint256 amountLeft = lockAmount;\n44           IStakerVault stakerVault = IStakerVault(stakerVaultAddress);\n45   \n46           // stake deposit amount\n47           if (depositAmount > 0) {\n48               depositAmount = depositAmount > amountLeft ? amountLeft : depositAmount;\n49               IERC20(token).safeTransferFrom(payer, address(this), depositAmount);\n50               IERC20(token).safeApprove(stakerVaultAddress, depositAmount);\n```\n\n[TopUpAction.sol#L36-L50](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L36-L50)<br>\n\nThe changing of either the staker or an lp token is behind a time-lock, and once the time has passed, the changed variables rely on this function:\n\n```solidity\nFile: backd/contracts/pool/LiquidityPool.sol   #2\n\n717       function _approveStakerVaultSpendingLpTokens() internal {\n718           address staker_ = address(staker);\n719           address lpToken_ = address(lpToken);\n720           if (staker_ == address(0) || lpToken_ == address(0)) return;\n721           IERC20(lpToken_).safeApprove(staker_, type(uint256).max);\n722       }\n```\n\n[LiquidityPool.sol#L717-L722](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/LiquidityPool.sol#L717-L722)<br>\n\nIf a bug is found in a new `staker` or `lpToken` and the governor wishes to change back to the old one(s), the governor will have to wait for the time-lock delay only to find out that the old value(s) cause the code to revert.\n\nI've filed the other more-severe instances as a separate high-severity issue, and flagged the remaining low-severity instances in my QA report.\n\n### Recommended Mitigation Steps\n\nAlways do `safeApprove(0)` if the allowance is being changed, or use `safeIncreaseAllowance()`.\n\n**[chase-manning (Backd) confirmed](https://github.com/code-423n4/2022-04-backd-findings/issues/180)**\n\n**[samwerner (Backd) commented](https://github.com/code-423n4/2022-04-backd-findings/issues/180#issuecomment-1116388323):**\n > It should be noted that the second example referring to `_approveStakerVaultSpendingLpTokens()` is not an issue. This is neither a member variable that can be updated nor is it behind a time lock. Both the `staker` and `lpToken` can only be set once and hence the `safeApprove` in the aforementioned function can only be called once.\n\n**[chase-manning (Backd) resolved](https://github.com/code-423n4/2022-04-backd-findings/issues/180)** resolved\n\n\n\n***\n\n## [[M-04] `CvxCrvRewardsLocker` implements a swap without a slippage check that can result in a loss of funds through MEV](https://github.com/code-423n4/2022-04-backd-findings/issues/161)\n_Submitted by Ruhum_\n\nThe CvxCrvRewardsLocker contract swaps tokens through the CRV cvxCRV pool. But, it doesn't use any slippage checks. The swap is at risk of being frontrun / sandwiched which will result in a loss of funds.\n\nSince MEV is very prominent I think the chance of that happening is pretty high.\n\n### Proof of Concept\n\nHere's the swap: [CvxCrvRewardsLocker.sol#L247-L252](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/CvxCrvRewardsLocker.sol#L247-L252).\n\n### Recommended Mitigation Steps\n\nUse a proper value for `minOut` instead of `0`.\n\n**[chase-manning (Backd) confirmed](https://github.com/code-423n4/2022-04-backd-findings/issues/161)**\n\n**[gzeon (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-04-backd-findings/issues/161#issuecomment-1120269300):**\n > According to [C4 Judging criteria](https://docs.code4rena.com/roles/judges/how-to-judge-a-contest#notes-on-judging):\n> > Unless there is something uniquely novel created by combining vectors, most submissions regarding vulnerabilities that are inherent to a particular system or the Ethereum network as a whole should be considered QA. Examples of such vulnerabilities include front running, sandwich attacks, and MEV. \n> \n> However since there is a configurable `minOut` that is deliberately set to 0, this seems to be a valid issue. I am judging this as Medium Risk.\n\n\n\n***\n\n## [[M-05] Chainlink's `latestRoundData` might return stale or incorrect results](https://github.com/code-423n4/2022-04-backd-findings/issues/17)\n_Submitted by cccz, also found by 0x1f8b, 0xDjango, 0xkatana, berndartmueller, defsec, Dravee, horsefacts, hyh, IllIllI, kenta, rayn, reassor, sorrynotsorry, and WatchPug_\n\nOn ChainlinkOracleProvider.sol and ChainlinkUsdWrapper.sol , we are using latestRoundData, but there is no check if the return value indicates stale data.\n```solidity\n    function _ethPrice() private view returns (int256) {\n        (, int256 answer, , , ) = _ethOracle.latestRoundData();\n        return answer;\n    }\n...\n    function getPriceUSD(address asset) public view override returns (uint256) {\n        address feed = feeds[asset];\n        require(feed != address(0), Error.ASSET_NOT_SUPPORTED);\n\n        (, int256 answer, , uint256 updatedAt, ) = AggregatorV2V3Interface(feed).latestRoundData();\n\n        require(block.timestamp <= updatedAt + stalePriceDelay, Error.STALE_PRICE);\n        require(answer >= 0, Error.NEGATIVE_PRICE);\n\n        uint256 price = uint256(answer);\n        uint8 decimals = AggregatorV2V3Interface(feed).decimals();\n        return price.scaleFrom(decimals);\n    }\n```\n\nThis could lead to stale prices according to the Chainlink documentation:\n\n<https://docs.chain.link/docs/historical-price-data/#historical-rounds><br>\n<https://docs.chain.link/docs/faq/#how-can-i-check-if-the-answer-to-a-round-is-being-carried-over-from-a-previous-round>\n\n### Proof of Concept\n\n[ChainlinkOracleProvider.sol#L55](https://github.com/code-423n4/2022-04-backd/blob/main/backd/contracts/oracles/ChainlinkOracleProvider.sol#L55)<br>\n[ChainlinkUsdWrapper.sol#L64](https://github.com/code-423n4/2022-04-backd/blob/main/backd/contracts/oracles/ChainlinkUsdWrapper.sol#L64)\n\n### Recommended Mitigation Steps\n```solidity\n    function _ethPrice() private view returns (int256) {\n        (uint80 roundID, int256 answer, , uint256 timestamp, uint80 answeredInRound) = _ethOracle.latestRoundData();\n        require(answeredInRound >= roundID, \"Stale price\");\n        require(timestamp != 0,\"Round not complete\");\n        require(answer > 0,\"Chainlink answer reporting 0\");\n        return answer;\n    }\n...\n    function getPriceUSD(address asset) public view override returns (uint256) {\n        address feed = feeds[asset];\n        require(feed != address(0), Error.ASSET_NOT_SUPPORTED);\n        (uint80 roundID, int256 answer, , uint256 updatedAt, uint80 answeredInRound) = AggregatorV2V3Interface(feed).latestRoundData();\n        require(answeredInRound >= roundID, \"Stale price\");\n        require(answer > 0,\" Error.NEGATIVE_PRICE\");\n        require(block.timestamp <= updatedAt + stalePriceDelay, Error.STALE_PRICE);\n\n        uint256 price = uint256(answer);\n        uint8 decimals = AggregatorV2V3Interface(feed).decimals();\n        return price.scaleFrom(decimals);\n    }\n```\n\n**[chase-manning (Backd) confirmed and resolved](https://github.com/code-423n4/2022-04-backd-findings/issues/17)**\n\n\n\n***\n\n## [[M-06] ERC777 tokens can bypass `depositCap` guard](https://github.com/code-423n4/2022-04-backd-findings/issues/47)\n_Submitted by shenwilly, also found by wuwe1_\n\n[LiquidityPool.sol#L523](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/LiquidityPool.sol#L523)<br>\n\nWhen ERC777 token is used as the underlying token for a `LiquidityPool`, a depositor can reenter `depositFor` and bypass the `depositCap` requirement check, resulting in higher total deposit than intended by governance.\n\n### Proof of Concept\n\n*   An empty ERC777 liquidity pool is capped at 1.000 token.\n*   Alice deposits 1.000 token. Before the token is actually sent to the contract, `tokensToSend` ERC777 hook is called and Alice reenters `depositFor`.\n*   As the previous deposit hasn't been taken into account, the reentrancy passes the `depositCap` check.\n*   Pool has 2.000 token now, despite the 1.000 deposit cap.\n\n### Recommended Mitigation Steps\n\nAdd reentrancy guards to `depositFor`.\n\n**[chase-manning (Backd) confirmed and resolved](https://github.com/code-423n4/2022-04-backd-findings/issues/47)**\n\n\n\n***\n\n## [[M-07] Inconsistency between constructor and setting method for `slippageTolerance`](https://github.com/code-423n4/2022-04-backd-findings/issues/97)\n_Submitted by fatherOfBlocks, also found by shenwilly_\n\n[StrategySwapper.sol#L38-L43](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/StrategySwapper.sol#L38-L43)<br>\n[StrategySwapper.sol#L109-L114](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/StrategySwapper.sol#L109-L114)<br>\n\nIn the setSlippageTolerance(L119) method you have certain requirements to set slippageTolerance, but in the constructor you don't.\n\n### Recommended Mitigation Steps\n\nI would add the corresponding validations to the constructor.\n\n**[chase-manning (Backd) confirmed and resolved](https://github.com/code-423n4/2022-04-backd-findings/issues/97)**\n\n\n\n***\n\n## [[M-08] `_decimalMultiplier` doesn't account for tokens with decimals higher than 18](https://github.com/code-423n4/2022-04-backd-findings/issues/49)\n_Submitted by shenwilly, also found by pauliax, StyxRave, and WatchPug_\n\n[StrategySwapper.sol#L287-L289](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/StrategySwapper.sol#L287-L289)<br>\n[StrategySwapper.sol#L318-L320](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/StrategySwapper.sol#L318-L320)<br>\n[StrategySwapper.sol#L335-L337](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/StrategySwapper.sol#L335-L337)<br>\n\nIn `StrategySwapper`, swapping from or to tokens with decimals higher than 18 will always revert. This will cause inabilities for strategies to harvest rewards.\n\n### Proof of Concept\n\n[L288](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/StrategySwapper.sol#L288) will revert when `token_` has higher than 18 decimals.\n\n     return 10**(18 - IERC20Full(token_).decimals());\n\n### Recommended Mitigation Steps\n\nConsider modifying how `_decimalMultiplier` works so it could handle tokens with higher than 18 decimals.\n\nUpdate the calculation of `_minTokenAmountOut` and `_minWethAmountOut` to account when decimals are higher/lower than `18`.\n\n**[chase-manning (Backd) confirmed and resolved](https://github.com/code-423n4/2022-04-backd-findings/issues/49)**\n\n\n\n***\n\n## [[M-09] `getNewCurrentFees` reverts when `minFeePercentage` > `feeRatio`](https://github.com/code-423n4/2022-04-backd-findings/issues/50)\n_Submitted by shenwilly_\n\n[LiquidityPool.sol#L694](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/LiquidityPool.sol#L694)<br>\n\nDepositors won't be able to transfer or redeem funds temporarily.\n\nThe problem is caused by the implementation of `LiquidityPool.getNewCurrentFees`:\n```solidity\nfunction getNewCurrentFees(\n    uint256 timeToWait,\n    uint256 lastActionTimestamp,\n    uint256 feeRatio\n) public view returns (uint256) {\n    uint256 timeElapsed = _getTime() - lastActionTimestamp;\n    uint256 minFeePercentage = getMinWithdrawalFee();\n    if (timeElapsed >= timeToWait) {\n        return minFeePercentage;\n    }\n    uint256 elapsedShare = timeElapsed.scaledDiv(timeToWait);\n    return feeRatio - (feeRatio - minFeePercentage).scaledMul(elapsedShare);\n}\n```\n\nThe last line requires the current `feeRatio` to be higher than `minFeePercentage` or the function will revert. When this condition is broken, some critical functions such as transferring tokens and redeeming will be unusable. Affected users need to wait until enough time has elapsed and `getNewCurrentFees` returns `minFeePercentage` on [L691](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/LiquidityPool.sol#L691).\n\nThis could happen if governance changes the `MinWithdrawalFee` to be higher than a user's feeRatio.\n\n### Proof of Concept\n\n*   Initial `MinWithdrawalFee` is set to 0, `MaxWithdrawalFee` is set to 0.03e18.\n*   Alice deposits fund and receives LP token. Alice's `feeRatio` is now set to 0.03e18 (the current `MaxWithdrawalFee`).\n*   Governance changes `MaxWithdrawalFee` to `0.05e18` and `MinWithdrawalFee` to `0.04e18`.\n*   `minFeePercentage` is now higher than Alice's `feeRatio` and she can't transfer nor redeem the LP token until `timeElapsed >= timeToWait`.\n\n### Recommended Mitigation Steps\n\nAdd a new condition in `getNewCurrentFees` [L690](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/LiquidityPool.sol#L690) to account for this case:\n\n```solidity\nif (timeElapsed >= timeToWait || minFeePercentage > feeRatio) {\n    return minFeePercentage;\n}\n```\n\n**[chase-manning (Backd) confirmed and resolved](https://github.com/code-423n4/2022-04-backd-findings/issues/50)**\n\n\n\n***\n\n## [[M-10] Griefer can extend period of higher withdrawal fees](https://github.com/code-423n4/2022-04-backd-findings/issues/56)\n_Submitted by 0xDjango_\n\n[LiquidityPool.sol#L790-L792](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/LiquidityPool.sol#L790-L792)<br>\n\nThe `_updateUserFeesOnDeposit()` function in `LiquidityPool.sol` is used to update a user's withdrawal fees after an action such as deposit, transfer in, etc. The withdrawal fee decays toward a minimum withdrawal fee over a period of 1 or 2 weeks (discussed with developer). Since anyone can transfer lp tokens to any user, a griefer can transfer 1 wei of lp tokens to another user to reset their `lastActionTimestamp` used in the withdrawal fee calculation.\n\nThe developers nicely weight the updated withdrawal fee by taking the original balance/original fee vs the added balance/added fee. The attacker will only be able to extend the runway of the withdrawal fee cooldown by resetting the `lastActionTimestamp` for future calculations. Example below:\n\n### Proof of Concept\nAssumptions:\n- MinWithdrawalFee = 0% //For easy math\n- MaxWithdrawalFee = 10%\n- timeToWait = 2 weeks\n\n#### Steps\n- User A has `100 wei` of shares\n- User A waits 1 week (Current withdrawal fee = 5%)\n- User B deposits, receives `1 wei` of shares, current withdrawal fee = 10%\n- User B immediately transfers `1 wei` of shares to User A\n\nBased on the formula to calculated User A's new feeRatio:\n\n```solidity\nuint256 newFeeRatio = shareExisting.scaledMul(newCurrentFeeRatio) +\n    shareAdded.scaledMul(feeOnDeposit);\n```\n\nIn reality, User A's withdrawal fee will only increase by a negligible amount since the shares added were very small in proportion to the original shares. We can assume user A's current withdrawal fee is still 5%.\n\nThe issue is that the function then reset's User A's `lastActionTimestamp` to the current time. This means that User A will have to wait the maximum 2 weeks for the withdrawal fee to reduce from 5% to 0%. Effectively the cooldown runway is the same length as the original runway length, so the decay down to 0% will take twice as long.\n\n`meta.lastActionTimestamp = uint64(_getTime());`\n\n### Recommended Mitigation Steps\nInstead of resetting `lastActionTimestamp` to the current time, scale it the same way the `feeRatio` is scaled. I understand that this would technically not be the timestamp of the last action, so the variable would probably need to be renamed.\n\n**[chase-manning (Backd) confirmed and resolved](https://github.com/code-423n4/2022-04-backd-findings/issues/56)**\n\n\n\n***\n\n## [[M-11] Position owner should set allowed slippage](https://github.com/code-423n4/2022-04-backd-findings/issues/87)\n_Submitted by 0x52_\n\n[TopUpAction.sol#L154](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L154)<br>\n[TopUpAction.sol#L187](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L187)<br>\n\nThe default swap slippage of 5% allows malicious keepers to sandwich attack topup. Additionally, up to 40% (\\_MIN_SWAPPER_SLIPPAGE) slippage allows malicious owner to sandwich huge amounts from topup\n\n### Proof of Concept\n\nKeeper can bundle swaps before and after topup to sandwich topup action, in fact it's actually in their best interest to do so.\n\n### Recommended Mitigation Steps\n\nAllow user to specify max swap slippage when creating topup similar to how it's specified on uniswap or sushiswap to block attacks from both keepers and owners.\n\n**[chase-manning (Backd) confirmed and resolved](https://github.com/code-423n4/2022-04-backd-findings/issues/87)**\n\n**[gzeon (judge) commented](https://github.com/code-423n4/2022-04-backd-findings/issues/87#issuecomment-1121225398):**\n > According to [C4 Judging criteria](https://docs.code4rena.com/roles/judges/how-to-judge-a-contest#notes-on-judging)\n> > Unless there is something uniquely novel created by combining vectors, most submissions regarding vulnerabilities that are inherent to a particular system or the Ethereum network as a whole should be considered QA. Examples of such vulnerabilities include front running, sandwich attacks, and MEV. \n> \n> However since Backd use keeper to run topup transactions, which presumably are bots and smart contracts that can fetch onchain price directly. A large (5% default, up to 40%) seems excessive and can lead to user losing fund. Judging this as Medium Risk.\n\n\n\n***\n\n## [[M-12] `CompoundHandler#topUp()` Using the wrong function selector makes native token `topUp()` always revert](https://github.com/code-423n4/2022-04-backd-findings/issues/120)\n_Submitted by WatchPug_\n\n[compound-finance/CEther.sol#L44-L47](https://github.com/compound-finance/compound-protocol/blob/v2.8.1/contracts/CEther.sol#L44-L47)<br>\n\n```solidity\nfunction mint() external payable {\n    (uint err,) = mintInternal(msg.value);\n    requireNoError(err, \"mint failed\");\n}\n```\n\n`mint()` for native cToken (`CEther`) does not have any parameters, as the `Function Selector` is based on `the function name with the parenthesised list of parameter types`, when you add a nonexisting `parameter`, the `Function Selector` will be incorrect.\n\n[CTokenInterfaces.sol#L316](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/interfaces/vendor/CTokenInterfaces.sol#L316)<br>\n\n```solidity\nfunction mint(uint256 mintAmount) external payable virtual returns (uint256);\n```\n\nThe current implementation uses the same `CToken` interface for both `CEther` and `CErc20` in `topUp()`, and `function mint(uint256 mintAmount)` is a nonexisting function for `CEther`.\n\nAs a result, the native token `topUp()` always revert.\n\n[CompoundHandler.sol#L57-L70](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CompoundHandler.sol#L57-L70)<br>\n\n```solidity\nCToken ctoken = cTokenRegistry.fetchCToken(underlying);\nuint256 initialTokens = ctoken.balanceOf(address(this));\n\naddress addr = account.addr();\n\nif (repayDebt) {\n    amount -= _repayAnyDebt(addr, underlying, amount, ctoken);\n    if (amount == 0) return true;\n}\n\nuint256 err;\nif (underlying == address(0)) {\n    err = ctoken.mint{value: amount}(amount);\n}\n```\n\nSee also:\n\n*   [Compound's cToken mint doc](https://compound.finance/docs/ctokens#mint)\n\n**[samwerner (Backd) confirmed and resolved](https://github.com/code-423n4/2022-04-backd-findings/issues/120)**\n\n\n\n***\n\n## [[M-13] `CEthInterface#repayBorrowBehalf()` reading non-existing returns makes  `_repayAnyDebt()` with CEther always revert](https://github.com/code-423n4/2022-04-backd-findings/issues/121)\n_Submitted by WatchPug_\n\n[CTokenInterfaces.sol#L355-L358](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/interfaces/vendor/CTokenInterfaces.sol#L355-L358)<br>\n\n```solidity\nfunction repayBorrowBehalf(address borrower, uint256 repayAmount)\n        external\n        payable\n        returns (uint256);\n```\n\n`repayBorrowBehalf()` for native cToken (`CEther`) will return nothing, while the current `CEthInterface` interface defines the returns as `(uint256)`.\n\nAs a result, `ether.repayBorrowBehalf()` will always revert\n\n[CompoundHandler.sol#L117-L118](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CompoundHandler.sol#L117-L118)<br>\n\n```solidity\nCEther cether = CEther(address(ctoken));\nerr = cether.repayBorrowBehalf{value: debt}(account);\n```\n\nRef:\n\n| method              | CEther     | CErc20     |\n| ------------------- | ---------- | ---------- |\n| mint()              | revert     | error code |\n| redeem()            | error code | error code |\n| repayBorrow()       | revert     | error code |\n| repayBorrowBehalf() | revert     | error code |\n\n*   [Compound cToken Repay Borrow Behalf doc](https://compound.finance/docs/ctokens#repay-borrow-behalf)\n*   [Compound CEther.repayBorrowBehalf()](https://github.com/compound-finance/compound-protocol/blob/v2.8.1/contracts/CEther.sol#L92-L95)\n*   [Compound CErc20.repayBorrowBehalf()](https://github.com/compound-finance/compound-protocol/blob/v2.8.1/contracts/CErc20.sol#L94-L97)\n\n**[chase-manning (Backd) confirmed](https://github.com/code-423n4/2022-04-backd-findings/issues/121)**\n\n\n\n***\n\n## [[M-14] `CEthInterface#mint()` reading non-existing returns makes `topUp()` with native token always revert](https://github.com/code-423n4/2022-04-backd-findings/issues/125)\n_Submitted by WatchPug_\n\n[CTokenInterfaces.sol#L345](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/interfaces/vendor/CTokenInterfaces.sol#L345)<br>\n\n```solidity\nfunction mint() external payable returns (uint256);\n```\n\n`mint()` for native cToken (`CEther`) will return nothing, while the current `CEthInterface` interface defines the returns as `(uint256)`.\n\nIn the current implementation, the interface for `CToken` is used for both `CEther` and `CErc20`.\n\nAs a result, the transaction will revert with the error: `function returned an unexpected amount of data` when `topUp()` with the native token (ETH).\n\n[CompoundHandler.sol#L57-L70](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CompoundHandler.sol#L57-L70)<br>\n\n```solidity\n    CToken ctoken = cTokenRegistry.fetchCToken(underlying);\n    uint256 initialTokens = ctoken.balanceOf(address(this));\n\n    address addr = account.addr();\n\n    if (repayDebt) {\n        amount -= _repayAnyDebt(addr, underlying, amount, ctoken);\n        if (amount == 0) return true;\n    }\n\n    uint256 err;\n    if (underlying == address(0)) {\n        err = ctoken.mint{value: amount}(amount);\n    }\n```\n\nRef:\n\n| method  | CEther | CErc20 |\n|----------|------------|-------------|\n| mint()   | revert      | error code  |\n| redeem() | error code | error code  |\n| repayBorrow() | revert | error code  |\n| repayBorrowBehalf() | revert | error code  |\n\n- [Compound's cToken mint doc](https://compound.finance/docs/ctokens#mint)<br>\n- [Compound CEther.mint()](https://github.com/compound-finance/compound-protocol/blob/v2.8.1/contracts/CEther.sol#L46)<br>\n- [Compound CErc20.mint()](https://github.com/compound-finance/compound-protocol/blob/v2.8.1/contracts/CErc20.sol#L46)<br>\n\n**[chase-manning (Backd) confirmed](https://github.com/code-423n4/2022-04-backd-findings/issues/125)**\n\n\n\n***\n\n## [[M-15] Malicious Stakers can grief Keepers](https://github.com/code-423n4/2022-04-backd-findings/issues/194)\n_Submitted by sseefried_\n\nA Staker -- that has their top-up position removed after `execute` is called by a Keeper -- can always cause the transaction to revert. They can do this by deploying a smart contract to the `payer` address that has implemented a `receive()` function that calls `revert()`. The revert will be triggered by the following [lines](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L727-L729) in `execute`\n\n```solidity\nif (vars.removePosition) {\n    gasBank.withdrawUnused(payer);\n}\n```\n\nThis will consume some gas from the keeper while preventing them accruing any rewards for performing the top-up action.\n\n### Proof of Concept\n\nI have implemented a [PoC](https://github.com/sseefried/codearena-backd-2022-04/blob/4d3c3ba7a0139bea01a0bdee9e84a7921572a9fd/backd/tests/top_up_action/sseefried_test_staker_grief.py) in a fork of the contest repo. The attacker's contract can be found [here](https://github.com/sseefried/codearena-backd-2022-04/blob/4d3c3ba7a0139bea01a0bdee9e84a7921572a9fd/backd/contracts/AliceAttacker.sol).\n\n### Recommend Mitigation Steps\n\nTo prevent this denial of service attack some way of blacklisting badly behaved Stakers should be added.\n\n**[chase-manning (Backd) confirmed](https://github.com/code-423n4/2022-04-backd-findings/issues/194)**\n\n\n\n***\n\n# Low Risk and Non-Critical Issues\n\nFor this contest, 39 reports were submitted by wardens detailing low risk and non-critical issues. The [report highlighted below](https://github.com/code-423n4/2022-04-backd-findings/issues/182) by **IllIllI** received the top score from the judge.\n\n*The following wardens also submitted reports: [horsefacts](https://github.com/code-423n4/2022-04-backd-findings/issues/199), [sseefried](https://github.com/code-423n4/2022-04-backd-findings/issues/209), [robee](https://github.com/code-423n4/2022-04-backd-findings/issues/6), [defsec](https://github.com/code-423n4/2022-04-backd-findings/issues/198), [hubble](https://github.com/code-423n4/2022-04-backd-findings/issues/148), [0xDjango](https://github.com/code-423n4/2022-04-backd-findings/issues/172), [sorrynotsorry](https://github.com/code-423n4/2022-04-backd-findings/issues/151), [berndartmueller](https://github.com/code-423n4/2022-04-backd-findings/issues/138), [Dravee](https://github.com/code-423n4/2022-04-backd-findings/issues/146), [joestakey](https://github.com/code-423n4/2022-04-backd-findings/issues/170), [StyxRave](https://github.com/code-423n4/2022-04-backd-findings/issues/153), [0xkatana](https://github.com/code-423n4/2022-04-backd-findings/issues/63), [csanuragjain](https://github.com/code-423n4/2022-04-backd-findings/issues/39), [dipp](https://github.com/code-423n4/2022-04-backd-findings/issues/191), [hake](https://github.com/code-423n4/2022-04-backd-findings/issues/187), [kebabsec](https://github.com/code-423n4/2022-04-backd-findings/issues/67), [pauliax](https://github.com/code-423n4/2022-04-backd-findings/issues/173), [peritoflores](https://github.com/code-423n4/2022-04-backd-findings/issues/196), [securerodd](https://github.com/code-423n4/2022-04-backd-findings/issues/109), [z3s](https://github.com/code-423n4/2022-04-backd-findings/issues/185), [0v3rf10w](https://github.com/code-423n4/2022-04-backd-findings/issues/29), [0x52](https://github.com/code-423n4/2022-04-backd-findings/issues/88), [catchup](https://github.com/code-423n4/2022-04-backd-findings/issues/104), [fatherOfBlocks](https://github.com/code-423n4/2022-04-backd-findings/issues/99), [Funen](https://github.com/code-423n4/2022-04-backd-findings/issues/107), [jayjonah8](https://github.com/code-423n4/2022-04-backd-findings/issues/4), [Kenshin](https://github.com/code-423n4/2022-04-backd-findings/issues/54), [kenta](https://github.com/code-423n4/2022-04-backd-findings/issues/211), [m4rio_eth](https://github.com/code-423n4/2022-04-backd-findings/issues/26), [oyc_109](https://github.com/code-423n4/2022-04-backd-findings/issues/2), [rayn](https://github.com/code-423n4/2022-04-backd-findings/issues/137), [remora](https://github.com/code-423n4/2022-04-backd-findings/issues/160), [Ruhum](https://github.com/code-423n4/2022-04-backd-findings/issues/189), [simon135](https://github.com/code-423n4/2022-04-backd-findings/issues/162), [Tadashi](https://github.com/code-423n4/2022-04-backd-findings/issues/81), [TerrierLover](https://github.com/code-423n4/2022-04-backd-findings/issues/85), [TrungOre](https://github.com/code-423n4/2022-04-backd-findings/issues/89), and [antonttc](https://github.com/code-423n4/2022-04-backd-findings/issues/165).*\n\nVulnerability details:\n\n## [L-01] The first withdrawal for each vault from the vault reserve has no delay\n\n`_lastWithdrawal[vault]` will always be zero for new vaults, so the check is for `0 + minWithdrawalDelay` which will always be less than `block.timestamp`\n\n```solidity\nFile: backd/contracts/vault/VaultReserve.sol   #1\n\n102    function canWithdraw(address vault) public view returns (bool) {\n103        return block.timestamp >= _lastWithdrawal[vault] + minWithdrawalDelay;\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/VaultReserve.sol#L102-L103>\n\n## [L-02] `AaveHandler` does not extend `BaseHandler`\n\nUnlike `CompoundHandler`, `AaveHandler` does not extend `BaseHandler`, which will cause storage problems in future versions\n\n```solidity\nFile: backd/contracts/actions/topup/handlers/AaveHandler.sol   #1\n\n15 contract AaveHandler is ITopUpHandler {\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/AaveHandler.sol#L15>\n\n## [L-03] Unused `receive()` function will lock Ether in contract\n\nIf the intention is for the Ether to be used, the function should call another function, otherwise it should revert\n\n```solidity\nFile: contracts/actions/topup/TopUpAction.sol   #1\n\n176     receive() external payable {\n177         // solhint-disable-previous-line no-empty-blocks\n178     }\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L176-L178>\n\n```solidity\nFile: contracts/pool/EthPool.sol   #2\n\n10     receive() external payable {}\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/EthPool.sol#L10>\n\n```solidity\nFile: contracts/strategies/BkdEthCvx.sol   #3\n\n46     receive() external payable {}\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/BkdEthCvx.sol#L46>\n\n```solidity\nFile: contracts/strategies/StrategySwapper.sol   #4\n\n45     receive() external payable {}\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/StrategySwapper.sol#L45>\n\n```solidity\nFile: contracts/vault/EthVault.sol   #5\n\n13     receive() external payable {}\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/EthVault.sol#L13>\n\n## [L-04] Front-runable initializer\n\nIf the initializer is not executed in the same transaction as the constructor, a malicious user can front-run the `initialize()` call, forcing the contract to be redeployed. Most other initializers in this project are protected, but this one appears not to be.\n\n```solidity\nFile: backd/contracts/AddressProvider.sol   #1\n\n53    function initialize(address roleManager) external initializer {\n54        AddressProviderMeta.Meta memory meta = AddressProviderMeta.Meta(true, true);\n55        _addressKeyMetas.set(AddressProviderKeys._ROLE_MANAGER_KEY, meta.toUInt());\n56        _setConfig(AddressProviderKeys._ROLE_MANAGER_KEY, roleManager);\n57    }\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/AddressProvider.sol#L53-L57>\n\n## [L-05] `safeApprove()` is deprecated\n\n[Deprecated](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/bfff03c0d2a59bcd8e2ead1da9aed9edf0080d05/contracts/token/ERC20/utils/SafeERC20.sol#L38-L45) in favor of `safeIncreaseAllowance()` and `safeDecreaseAllowance()`\n\nSee [original submission](https://github.com/code-423n4/2022-04-backd-findings/issues/182) for instances.\n\n## [L-06] Missing checks for `address(0x0)` when assigning values to `address` state variables\n\n```solidity\nFile: contracts/actions/topup/TopUpActionFeeHandler.sol   #1\n\n55         actionContract = _actionContract;\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpActionFeeHandler.sol#L55>\n\n```solidity\nFile: contracts/CvxCrvRewardsLocker.sol   #2\n\n151         treasury = _treasury;\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/CvxCrvRewardsLocker.sol#L151>\n\n```solidity\nFile: contracts/StakerVault.sol   #3\n\n66         token = _token;\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/StakerVault.sol#L66>\n\n```solidity\nFile: contracts/strategies/ConvexStrategyBase.sol   #4\n\n100         vault = vault_;\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L100>\n\n```solidity\nFile: contracts/strategies/ConvexStrategyBase.sol   #5\n\n101         _strategist = strategist_;\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L101>\n\n```solidity\nFile: contracts/strategies/ConvexStrategyBase.sol   #6\n\n182         communityReserve = _communityReserve;\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L182>\n\n```solidity\nFile: contracts/strategies/ConvexStrategyBase.sol   #7\n\n261         _strategist = strategist_;\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L261>\n\n## [L-07] `abi.encodePacked()` should not be used with dynamic types when passing the result to a hash function such as `keccak256()`\n\nUse `abi.encode()` instead which will pad items to 32 bytes, which will [prevent hash collisions](https://docs.soliditylang.org/en/v0.8.13/abi-spec.html#non-standard-packed-mode) (e.g. `abi.encodePacked(0x123,0x456)` => `0x123456` => `abi.encodePacked(0x1,0x23456)`, but `abi.encode(0x123,0x456)` => `0x0...1230...456`). \"Unless there is a compelling reason, `abi.encode` should be preferred\". If there is only one argument to `abi.encodePacked()` it can often be cast to `bytes()` or `bytes32()` [instead](https://ethereum.stackexchange.com/questions/30912/how-to-compare-strings-in-solidity#answer-82739).\n\n```solidity\nFile: contracts/actions/topup/handlers/CTokenRegistry.sol   #1\n\n67                 keccak256(abi.encodePacked(ctoken.symbol())) == keccak256(abi.encodePacked(\"cETH\"))\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CTokenRegistry.sol#L67>\n\n## [L-08] `address.call{value:x}()` should be used instead of `payable.transfer()`\n\nThe use of `payable.transfer()` is heavily frowned upon because it can lead to the locking of funds. The `transfer()` call requires that the recipient has a `payable` callback, only provides 2300 gas for its operation. This means the following cases can cause the transfer to fail:\n\n*   The contract does not have a `payable` callback\n*   The contract's `payable` callback spends more than 2300 gas (which is only enough to emit something)\n*   The contract is called through a proxy which itself uses up the 2300 gas\n\n```solidity\nFile: backd/contracts/vault/VaultReserve.sol   #1\n\n81            payable(msg.sender).transfer(amount);\n```\n\nuses the `onlyVault` modifier, and vaults currently have empty `payable` callbacks, so they don't currently revert\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/VaultReserve.sol#L81>\n\n```solidity\nFile: backd/contracts/vault/EthVault.sol   #2\n\n29        payable(to).transfer(amount);\n```\n\nuses the `onlyPoolOrGovernance` modifier, and pools currently have an empty `payable` callback, so they don't currently rever. Governance is currently deployed and not seeing issues, so presumably it also has an empty `payable` callback\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/EthVault.sol#L29>\n\n```solidity\nFile: backd/contracts/vault/EthVault.sol   #3\n\n37        payable(addressProvider.getTreasury()).transfer(amount);\n```\n\nthe treasury is currently deployed and not seeing issues, so presumably it also has an empty `payable` callback\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/EthVault.sol#L37>\n\n```solidity\nFile: backd/contracts/strategies/BkdEthCvx.sol   #4\n\n77            payable(vault).transfer(amount);\n```\n\nvaults currently have an empty `payable` callback\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/BkdEthCvx.sol#L77>\n\n```solidity\nFile: backd/contracts/strategies/BkdEthCvx.sol   #5\n\n93        payable(vault).transfer(amount);\n```\n\nvaults currently have an empty `payable` callback\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/BkdEthCvx.sol#L93>\n\n```solidity\nFile: backd/contracts/strategies/BkdEthCvx.sol   #6\n\n117        payable(vault).transfer(underlyingBalance);\n```\n\nvaults currently have an empty `payable` callback\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/BkdEthCvx.sol#L117>\n\n## [L-09] Upgradeable contract is missing a `__gap[50]` storage variable to allow for new storage variables in later versions\n\nSee [this](https://docs.openzeppelin.com/contracts/4.x/upgradeable#storage_gaps) link for a description of this storage variable. While some contracts may not currently be sub-classed, adding the variable now protects against forgetting to add it in the future.\n\n```solidity\nFile: contracts/LpToken.sol   #1\n\n10 contract LpToken is ILpToken, ERC20Upgradeable {\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/LpToken.sol#L10>\n\n## [L-10] Math library unnecessarily overflows during some operations\n\nIn the example below, `a + b` may overflow even though the division that comes later would prevent it. This particular case can be prevented by doing [`(a & b) + (a ^ b) / b`](https://github.com/fei-protocol/flywheel-v2/blob/77bfadf388db25cf5917d39cd9c0ad920f404aad/src/token/ERC20MultiVotes.sol#L92-L95). There are other functions with similar issues. See [this](https://github.com/barakman/solidity-math-utils/blob/master/project/contracts/IntegralMath.sol) library for ways of doing math without this sort of issue.\n\n```solidity\nFile: backd/libraries/ScaledMath.sol   #1\n\n40    function divRoundUp(uint256 a, uint256 b) internal pure returns (uint256) {\n41        return (a + b - 1) / b;\n42    }\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/libraries/ScaledMath.sol#L40-L42>\n\n## [N-01] `_prepareDeadline()`, `_setConfig()`, and `_executeDeadline()` should be `private`\n\nThese functions have the ability to bypass the timelocks of every setting. No contract besides the `Preparable` contract itself should need to call these functions, and having them available will lead to exploits. The contracts that currently call `_setConfig()` in their constructors should be given a new function `_initConfig()` for this purpose. The `Vault` [calls](https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/Vault.sol#L222) some of these functions as well, and should be changed to manually inspect the deadline rather than mucking with the internals, which is error-prone. The mappings should also be made `private`, and there should be public getters to read their values\n\n```solidity\nFile: backd/contracts/utils/Preparable.sol   #1\n\n115    /**\n116     * @notice Execute uint256 config update (with time delay enforced).\n117     * @dev Needs to be called after the update was prepared. Fails if called before time delay is met.\n118     * @return New value.\n119     */\n120    function _executeUInt256(bytes32 key) internal returns (uint256) {\n121        _executeDeadline(key);\n122        uint256 newValue = pendingUInts256[key];\n123        _setConfig(key, newValue);\n124        return newValue;\n125    }\n126\n127    /**\n128     * @notice Execute address config update (with time delay enforced).\n129     * @dev Needs to be called after the update was prepared. Fails if called before time delay is met.\n130     * @return New value.\n131     */\n132    function _executeAddress(bytes32 key) internal returns (address) {\n133        _executeDeadline(key);\n134        address newValue = pendingAddresses[key];\n135        _setConfig(key, newValue);\n136        return newValue;\n137    }\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/Preparable.sol#L115-L137>\n\n## [N-02] Open TODOs\n\nCode architecture, incentives, and error handling/reporting questions/issues should be resolved before deployment\n\n```solidity\nFile: contracts/actions/topup/TopUpAction.sol   #1\n\n713         // TODO: add constant gas consumed for transfer and tx prologue\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L713>\n\n```solidity\nFile: contracts/strategies/ConvexStrategyBase.sol   #2\n\n4 // TODO Add validation of curve pools\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L4>\n\n```solidity\nFile: contracts/strategies/ConvexStrategyBase.sol   #3\n\n5 // TODO Test validation\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/strategies/ConvexStrategyBase.sol#L5>\n\n## [N-03] `payable` function does not reject payments to ERC20 tokens\n\n```solidity\nFile: backd/contracts/vault/VaultReserve.sol   #1\n\n50        if (token == address(0)) {\n51            require(msg.value == amount, Error.INVALID_AMOUNT);\n52            _balances[msg.sender][token] += msg.value;\n53            return true;\n54        }\n55        uint256 balance = IERC20(token).balanceOf(address(this));\n```\n\nAfter the if-statement there should be a `require(0 == msg.value)` to ensure no Ether is being used when updating ERC20 balances. This is non-critical since the function has the `onlyVault` modifier, and presumably vaults would be coded never to deposit Ether to ERC20 tokens\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/VaultReserve.sol#L50-L55>\n\n## [N-04] Adding a `return` statement when the function defines a named return variable, is redundant\n\n```solidity\nFile: contracts/pool/PoolFactory.sol   #1\n\n216         return addrs;\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/PoolFactory.sol#L216>\n\n## [N-05] `public` functions not called by the contract should be declared `external` instead\n\nContracts [are allowed](https://docs.soliditylang.org/en/latest/contracts.html#function-overriding) to override their parents' functions and change the visibility from `external` to `public`.\n\n```solidity\nFile: contracts/actions/topup/TopUpAction.sol   #1\n\n742     function prepareTopUpHandler(bytes32 protocol, address newHandler)\n743         public\n744         onlyGovernance\n745         returns (bool)\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L742-L745>\n\n```solidity\nFile: contracts/CvxCrvRewardsLocker.sol   #2\n\n222     function withdraw(address token, uint256 amount) public onlyGovernance returns (bool) {\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/CvxCrvRewardsLocker.sol#L222>\n\n## [N-06] `constant`s should be defined rather than using magic numbers\n\nSee [original submission](https://github.com/code-423n4/2022-04-backd-findings/issues/182) for instances.\n\n## [N-07] Large multiples of ten should use scientific notation (e.g. `1e6`) rather than decimal literals (e.g. `1000000`), for readability\n\n```solidity\nFile: contracts/utils/CvxMintAmount.sol   #1\n\n7     uint256 private constant _CLIFF_SIZE = 100000 * 1e18; //new cliff every 100,000 tokens\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/CvxMintAmount.sol#L7>\n\n```solidity\nFile: contracts/utils/CvxMintAmount.sol   #2\n\n9     uint256 private constant _MAX_SUPPLY = 100000000 * 1e18; //100 mil max supply\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/CvxMintAmount.sol#L9>\n\n## [N-08] Use a more recent version of solidity\n\nUse a solidity version of at least 0.8.12 to get `string.concat()` to be used instead of `abi.encodePacked(,)`\n\n```solidity\nFile: contracts/actions/topup/handlers/CTokenRegistry.sol   #1\n\n2 pragma solidity 0.8.9;\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/handlers/CTokenRegistry.sol#L2>\n\n```solidity\nFile: contracts/actions/topup/TopUpActionFeeHandler.sol   #2\n\n2 pragma solidity 0.8.9;\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpActionFeeHandler.sol#L2>\n\n```solidity\nFile: contracts/actions/topup/TopUpAction.sol   #3\n\n2 pragma solidity 0.8.9;\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/actions/topup/TopUpAction.sol#L2>\n\n## [N-09] Constant redefined elsewhere\n\nConsider defining in only one contract so that values cannot become out of sync when only one location is updated. A [cheap way](https://medium.com/coinmonks/gas-cost-of-solidity-library-functions-dbe0cedd4678) to store constants in a single location is to create an `internal constant` in a `library`. If the variable is a local cache of another contract's value, consider making the cache variable internal or private, which will require external users to query the contract with the source of truth, so that callers don't get out of sync.\n\nSee [original submission](https://github.com/code-423n4/2022-04-backd-findings/issues/182) for instances.\n\n## [N-10] Inconsistent spacing in comments\n\nSome lines use `// x` and some use `//x`. The instances below point out the usages that don't follow the majority, within each file\n\n```solidity\nFile: contracts/utils/CvxMintAmount.sol   #1\n\n8     uint256 private constant _CLIFF_COUNT = 1000; // 1,000 cliffs\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/CvxMintAmount.sol#L8>\n\n```solidity\nFile: contracts/utils/CvxMintAmount.sol   #2\n\n11         IERC20(address(0x4e3FBD56CD56c3e72c1403e103b45Db9da5B9D2B)); // CVX Token\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/CvxMintAmount.sol#L11>\n\n## [N-11] Typos\n\nSee [original submission](https://github.com/code-423n4/2022-04-backd-findings/issues/182) for instances.\n\n## [N-12] File is missing NatSpec\n\n```solidity\nFile: contracts/access/Authorization.sol (various lines)   #1\n\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/access/Authorization.sol>\n\n```solidity\nFile: contracts/access/RoleManager.sol (various lines)   #2\n\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/access/RoleManager.sol>\n\n```solidity\nFile: contracts/oracles/ChainlinkUsdWrapper.sol (various lines)   #3\n\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/oracles/ChainlinkUsdWrapper.sol>\n\n```solidity\nFile: contracts/oracles/OracleProviderExtensions.sol (various lines)   #4\n\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/oracles/OracleProviderExtensions.sol>\n\n```solidity\nFile: contracts/pool/Erc20Pool.sol (various lines)   #5\n\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/Erc20Pool.sol>\n\n```solidity\nFile: contracts/pool/EthPool.sol (various lines)   #6\n\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/pool/EthPool.sol>\n\n```solidity\nFile: contracts/utils/CvxMintAmount.sol (various lines)   #7\n\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/utils/CvxMintAmount.sol>\n\n```solidity\nFile: contracts/vault/Erc20Vault.sol (various lines)   #8\n\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/Erc20Vault.sol>\n\n```solidity\nFile: contracts/vault/EthVault.sol (various lines)   #9\n\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/contracts/vault/EthVault.sol>\n\n```solidity\nFile: libraries/AddressProviderMeta.sol (various lines)   #10\n\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/libraries/AddressProviderMeta.sol>\n\n```solidity\nFile: libraries/Errors.sol (various lines)   #11\n\n```\n\n<https://github.com/code-423n4/2022-04-backd/blob/c856714a50437cb33240a5964b63687c9876275b/backd/libraries/Errors.sol>\n\n## [N-13] NatSpec is incomplete\n\nSee [original submission](https://github.com/code-423n4/2022-04-backd-findings/issues/182) for instances.\n\n## [N-14] Event is missing `indexed` fields\n\nEach `event` should use three `indexed` fields if there are three or more fields\n\nSee [original submission](https://github.com/code-423n4/2022-04-backd-findings/issues/182) for instances.\n\n**[chase-manning (Backd) resolved and commented](https://github.com/code-423n4/2022-04-backd-findings/issues/182#issuecomment-1112018709):**\n > I consider this report to be of particularly high quality.\n\n**[gzeon (judge) commented](https://github.com/code-423n4/2022-04-backd-findings/issues/182#issuecomment-1120478997):**\n > Nice submission, warden covered basically all the low risk and non-critical issues. Would be nice if there was an index.\n\n\n\n***\n\n# Gas Optimizations\n\nFor this contest, 35 reports were submitted by wardens detailing gas optimizations. The [report highlighted below](https://github.com/code-423n4/2022-04-backd-findings/issues/168) by **joestakey** received the top score from the judge.\n\n*The following wardens also submitted reports: [Tomio](https://github.com/code-423n4/2022-04-backd-findings/issues/57), [IllIllI](https://github.com/code-423n4/2022-04-backd-findings/issues/181), [Dravee](https://github.com/code-423n4/2022-04-backd-findings/issues/35), [catchup](https://github.com/code-423n4/2022-04-backd-findings/issues/103), [defsec](https://github.com/code-423n4/2022-04-backd-findings/issues/192), [securerodd](https://github.com/code-423n4/2022-04-backd-findings/issues/111), [0xkatana](https://github.com/code-423n4/2022-04-backd-findings/issues/62), [kenta](https://github.com/code-423n4/2022-04-backd-findings/issues/204), [robee](https://github.com/code-423n4/2022-04-backd-findings/issues/5), [slywaters](https://github.com/code-423n4/2022-04-backd-findings/issues/43), [sorrynotsorry](https://github.com/code-423n4/2022-04-backd-findings/issues/154), [0v3rf10w](https://github.com/code-423n4/2022-04-backd-findings/issues/30), [0x1f8b](https://github.com/code-423n4/2022-04-backd-findings/issues/156), [0x4non](https://github.com/code-423n4/2022-04-backd-findings/issues/79), [0xNazgul](https://github.com/code-423n4/2022-04-backd-findings/issues/16), [fatherOfBlocks](https://github.com/code-423n4/2022-04-backd-findings/issues/94), [Funen](https://github.com/code-423n4/2022-04-backd-findings/issues/105), [NoamYakov](https://github.com/code-423n4/2022-04-backd-findings/issues/136), [pauliax](https://github.com/code-423n4/2022-04-backd-findings/issues/174), [rfa](https://github.com/code-423n4/2022-04-backd-findings/issues/143), [saian](https://github.com/code-423n4/2022-04-backd-findings/issues/129), [TerrierLover](https://github.com/code-423n4/2022-04-backd-findings/issues/84), [WatchPug](https://github.com/code-423n4/2022-04-backd-findings/issues/116), [MaratCerby](https://github.com/code-423n4/2022-04-backd-findings/issues/113), [0xDjango](https://github.com/code-423n4/2022-04-backd-findings/issues/175), [0xmint](https://github.com/code-423n4/2022-04-backd-findings/issues/207), [hake](https://github.com/code-423n4/2022-04-backd-findings/issues/188), [horsefacts](https://github.com/code-423n4/2022-04-backd-findings/issues/202), [oyc_109](https://github.com/code-423n4/2022-04-backd-findings/issues/1), [rayn](https://github.com/code-423n4/2022-04-backd-findings/issues/135), [simon135](https://github.com/code-423n4/2022-04-backd-findings/issues/163), [Tadashi](https://github.com/code-423n4/2022-04-backd-findings/issues/82), [tin537](https://github.com/code-423n4/2022-04-backd-findings/issues/22), and [z3s](https://github.com/code-423n4/2022-04-backd-findings/issues/183).*\n\n## [G-01] Caching storage variables in memory to save gas\n\n### PROBLEM\n\nAnytime you are reading from storage more than once, it is cheaper in gas cost to cache the variable in memory: a SLOAD cost 100gas, while MLOAD and MSTORE cost 3 gas.\n\nIn particular, in `for` loops, when using the length of a storage array as the condition being checked after each loop, caching the array length in memory can yield significant gas savings if the array length is high.\n\n### PROOF OF CONCEPT\n\nInstances include:\n\n#### AaveHandler.sol\n\nscope: `topUp()`\n\n*   `weth` is read twice\n\n<!---->\n\n    AaveHandler.sol:44\n    AaveHandler.sol:45\n\n*   `lendingPool` is read 4 times\n\n<!---->\n\n    AaveHandler.sol:50\n    AaveHandler.sol:53\n    AaveHandler.sol:60\n    AaveHandler.sol:65\n\n#### CompoundHandler.sol\n\nscope: `_getAccountBorrowsAndSupply()`\n\n*   `comptroller` is read (2 + `assets.length`) times. Number of read depends on the length of `assets` as it is in a for loop\n\n<!---->\n\n    CompoundHandler.sol:132\n    CompoundHandler.sol:134\n    CompoundHandler.sol:142\n\n#### CTokenRegistry.sol\n\nscope: `  _isCTokenUsable() `\n\n*   `comptroller` is read  3 times\n\n<!---->\n\n    CTokenRegistry.sol:77\n    CTokenRegistry.sol:79\n    CTokenRegistry.sol:80\n\n#### TopUpAction.sol\n\nscope: `resetPosition()`\n\n*   `addressProvider` is read twice\n\n<!---->\n\n    TopUpAction.sol:284\n    TopUpAction.sol:295\n\nscope: `execute()`\n\n*   `addressProvider` is read 3 times\n\n<!---->\n\n    TopUpAction.sol:562\n    TopUpAction.sol:604\n    TopUpAction.sol:632\n\n#### BkdEthCvx.sol\n\nscope: `_withdraw()`\n\n*   `vault` is read twice\n\n<!---->\n\n    BkdEthCvx.sol:77\n    BkdEthCvx.sol:93\n\n#### BkdTriHopCvx.sol\n\nscope: `_withdraw()`\n\n*   `vault` is read twice\n\n<!---->\n\n    BkdTriHopCvx.sol:175\n    BkdTriHopCvx.sol:201\n\n#### ConvexStrategyBase.sol\n\nscope: `addRewardToken()`\n\n*   `_strategySwapper` is read twice\n\n<!---->\n\n    ConvexStrategyBase.sol:279\n    ConvexStrategyBase.sol:280\n\nscope: `harvestable()`\n\n*   `crvCommunityReserveShare` is read twice\n\n<!---->\n\n    ConvexStrategyBase.sol:307\n    ConvexStrategyBase.sol:311\n\n*   `_rewardTokens.length()` is read `_rewardTokens.length()` times. Number of read depends on the length of `_rewardsTokens` as it is in a for loop\n\n<!---->\n\n    ConvexStrategyBase.sol:313\n\nscope: `_harvest()`\n\n*   `_rewardTokens.length()` is read `_rewardTokens.length()` times. Number of read depends on the length of `_rewardsTokens` as it is in a for loop\n\n<!---->\n\n    ConvexStrategyBase.sol:380\n\nscope: `_sendCommunityReserveShare()`\n\n*   `cvxCommunityReserveShare` is read twice\n\n<!---->\n\n    ConvexStrategyBase.sol:398\n    ConvexStrategyBase.sol:409\n\n#### Vault.sol\n\nscope: `_handleExcessDebt()`\n\n*   `reserve` is read 3 times\n\n<!---->\n\n    Vault.sol:645\n    Vault.sol:648\n    Vault.sol:649\n\nscope: `_handleExcessDebt()`\n\n*   `totalDebt` is read twice\n\n<!---->\n\n    Vault.sol:657\n    Vault.sol:658\n\n#### Vault.sol\n\nscope: `stakeFor()`\n\n*   `token` is read 4 times\n\n<!---->\n\n    Vault.sol:324\n    Vault.sol:331\n    Vault.sol:338\n    Vault.sol:339\n\nscope: `unStakeFor()`\n\n*   `token` is read 4 times\n\n<!---->\n\n    Vault.sol:365\n    Vault.sol:376\n    Vault.sol:382\n    Vault.sol:384\n\n### MITIGATION\n\ncache these storage variables in memory\n\n## [G-02] Calldata instead of memory for RO function parameters\n\n### PROBLEM\n\nIf a reference type function parameter is read-only, it is cheaper in gas to use calldata instead of memory.\nCalldata is a non-modifiable, non-persistent area where function arguments are stored, and behaves mostly like memory.\n\nTry to use calldata as a data location because it will avoid copies and also makes sure that the data cannot be modified.\n\n### PROOF OF CONCEPT\n\nInstances include:\n\n#### RoleManager.sol\n\nscope: `hasAnyRole()`\n\n    RoleManager.sol:73: bytes32[] memory roles\n\n#### AaveHandler.sol\n\nscope: `topUp()`\n\n    AaveHandler.sol:40: bytes memory extra\n\n#### CompoundHandler.sol\n\nscope: `topUp()`\n\n    CompoundHandler.sol:54: bytes memory extra\n\n#### TopUpAction.sol\n\nscope: `getHealthFactor()`\n\n    TopUpAction.sol:760: bytes memory extra\n\n#### TopUpKeeperHelper.sol\n\nscope: `canExecute()`\n\n    TopUpKeeperHelper.sol:108: ITopUpAction.RecordKey memory key\n\nscope: `_canExecute()`\n\n    TopUpKeeperHelper.sol:131: ITopUpAction.RecordWithMeta memory position\n\nscope: `_positionToTopup()`\n\n    TopUpKeeperHelper.sol:145: ITopUpAction.RecordWithMeta memory position\n\nscope: `_shortenTopups()`\n\n    TopUpKeeperHelper.sol:159: TopupData[] memory topups\n\n#### Erc20Pool.sol\n\nscope: `initialize()`\n\n    Erc20Pool.sol:15: string memory name_\n\n#### EthPool.sol\n\nscope: `initialize()`\n\n    EthPool.sol:13: string memory name_\n\n#### LiquidityPool.sol\n\nscope: `initialize()`\n\n    LiquidityPool.sol:702: string memory name_\n\n#### LpToken.sol\n\nscope: `initialize()`\n\n    LpToken.sol:29: string memory name_\n    LpToken.sol:30: string memory symbol_\n\n### MITIGATION\n\nReplace `memory` with `calldata`\n\n## [G-03] Comparisons with zero for unsigned integers\n\n### PROBLEM\n\n`>0` is less gas efficient than `!0` if you enable the optimizer at 10k AND you’re in a require statement.\nDetailed explanation with the opcodes [here](https://twitter.com/gzeon/status/1485428085885640706)\n\n### PROOF OF CONCEPT\n\nInstances include:\n\n#### TopUpAction.sol\n\nscope: `register()`\n\n    TopUpAction.sol:210\n\nscope: `execute()`\n\n    TopUpAction.sol:554\n\n#### TopUpActionFeeHandler.sol\n\nscope: `claimKeeperFeesForPool()`\n\n    TopUpActionFeeHandler.sol:123\n\n#### LiquidityPool.sol\n\nscope: `updateDepositCap()`\n\n    LiquidityPool.sol:401\n\nscope: `calcRedeem()`\n\n    LiquidityPool.sol:471\n    LiquidityPool.sol:473\n\nscope: `redeem()`\n\n    LiquidityPool.sol:549\n\n#### Vault.sol\n\nscope: `withdrawFromReserve()`\n\n    Vault.sol:164\n\n#### BkdLocker.sol\n\nscope: `depositFees()`\n\n    BkdLocker.sol:90\n    BkdLocker.sol:91\n    BkdLocker.sol:136\n\n### MITIGATION\n\nReplace `> 0` with `!0`\n\n## [G-04] Comparison Operators\n\n### PROBLEM\n\nIn the EVM, there is no opcode for >= or <=.\nWhen using greater than or equal, two operations are performed: > and =.\n\nUsing strict comparison operators hence saves gas\n\n### PROOF OF CONCEPT\n\nInstances include:\n\n#### TopUpAction.sol\n\n    TopUpAction.sol:61\n    TopUpAction.sol:212\n    TopUpAction.sol:224\n    TopUpAction.sol:328\n    TopUpAction.sol:360\n    TopUpAction.sol:361\n    TopUpAction.sol:500\n    TopUpAction.sol:501\n    TopUpAction.sol:576\n    TopUpAction.sol:584\n    TopUpAction.sol:724\n\n#### TopUpActionFeeHandler.sol\n\n    TopUpActionFeeHandler.sol:54\n    TopUpActionFeeHandler.sol:151\n    TopUpActionFeeHandler.sol:163\n    TopUpActionFeeHandler.sol:196\n    TopUpActionFeeHandler.sol:208\n\n#### ChainLinkOracleProvider.sol\n\n    ChainLinkOracleProvider.sol:41\n    ChainLinkOracleProvider.sol:57\n\n#### EthPool.sol\n\n    EthPool.sol:442\n    EthPool.sol:208\n    EthPool.sol:518\n    EthPool.sol:525\n    EthPool.sol:551\n    EthPool.sol:562\n    EthPool.sol:690\n    EthPool.sol:811\n    EthPool.sol:812\n\n#### BkdEthCvx.sol\n\n    BkdEthCvx.sol:76\n\n#### BkdTriHopCvx.sol\n\n    BkdTriHopCvx.sol:174\n\n#### ConvexStrategyBase.sol\n\n    ConvexStrategyBase.sol:197\n    ConvexStrategyBase.sol:214\n\n#### StrategySwapper.sol\n\n    StrategySwapper.sol:110\n\n#### CvxMintAmount.sol\n\n    CvxMintAmount.sol:21\n\n#### Preparable.sol\n\n    Preparable.sol:29\n    Preparable.sol:110\n\n#### Vault.sol\n\n    Vault.sol:88\n    Vault.sol:89\n    Vault.sol:90\n    Vault.sol:167\n    Vault.sol:264\n    Vault.sol:323\n    Vault.sol:392\n    Vault.sol:437\n    Vault.sol:482\n    Vault.sol:712\n    Vault.sol:763\n\n#### VaultReserve.sol\n\n    VaultReserve.sol:59\n    VaultReserve.sol:75\n    VaultReserve.sol:103\n\n#### BkdLocker.sol\n\n    BkdLocker.sol:119\n    BkdLocker.sol:140\n    BkdLocker.sol:281\n\n#### Controller.sol\n\n    Controller:98\n\n#### CvxCrvRewardsLocker.sol\n\n    CvxCrvRewardsLocker:84\n\n#### GasBank.sol\n\n    GasBank:68\n    GasBank:76\n\n#### StakerVault.sol\n\n    StakerVault:107\n    StakerVault:150\n    StakerVault:153\n    StakerVault:324\n    StakerVault:368\n    StakerVault:371\n\n### MITIGATION\n\nReplace `<=` with `<`, and `>=` with `>`. Do not forget to increment/decrement the compared variable\n\nexample:\n\n    -require(maxFee >= minFee, Error.INVALID_AMOUNT);\n    +require(maxFee > minFee - 1, Error.INVALID_AMOUNT);\n\nWhen the comparison is with a constant storage variable, you can also do the increment in the storage variable declaration\n\nexample:\n\n    -require(maxFee <= _MAX_WITHDRAWAL_FEE, Error.INVALID_AMOUNT)\n    +require(maxFee < _MAX_WITHDRAWAL_FEE_PLUS_ONE, Error.INVALID_AMOUNT)\n\nHowever, when `1` is negligible compared to the variable (with is the case here as the variable is in the order of `10**16`), it is not necessary to increment.\n\n## [G-05] Custom Errors\n\n### PROBLEM\n\nCustom errors from Solidity 0.8.4 are cheaper than revert strings (cheaper deployment cost and runtime cost when the revert condition is met) while providing the same amount of information, as explained [here](https://blog.soliditylang.org/2021/04/21/custom-errors/)\n\nCustom errors are defined using the error statement\n\n### PROOF OF CONCEPT\n\nInstances include:\n\n#### RoleManager.sol\n\n    RoleManager.sol:44\n    RoleManager.sol:110\n    RoleManager.sol:111\n\n#### AaveHandler.sol\n\n    AaveHandler.sol:51\n\n#### CompoundHandler.sol\n\n    CompoundHandler.sol:74\n    CompoundHandler.sol:80\n    CompoundHandler.sol:123\n    CompoundHandler.sol:141\n    CompoundHandler.sol:148\n\n#### TopUpAction.sol\n\n    TopUpAction.sol:67\n    TopUpAction.sol:98\n    TopUpAction.sol:185\n    TopUpAction.sol:209\n    TopUpAction.sol:210\n    TopUpAction.sol:211\n    TopUpAction.sol:212\n    TopUpAction.sol:213\n    TopUpAction.sol:217\n    TopUpAction.sol:218\n    TopUpAction.sol:224\n    TopUpAction.sol:282\n    TopUpAction.sol:328\n    TopUpAction.sol:359\n    TopUpAction.sol:546\n    TopUpAction.sol:553\n    TopUpAction.sol:554\n    TopUpAction.sol:560\n    TopUpAction.sol:575\n    TopUpAction.sol:583\n    TopUpAction.sol:676\n    TopUpAction.sol:723\n    TopUpAction.sol:928\n\n#### TopUpActionFeeHandler.sol\n\n    TopUpActionFeeHandler.sol:67\n    TopUpActionFeeHandler.sol:68\n    TopUpActionFeeHandler.sol:87\n    TopUpActionFeeHandler.sol:123\n    TopUpActionFeeHandler.sol:151\n    TopUpActionFeeHandler.sol:161\n    TopUpActionFeeHandler.sol:196\n    TopUpActionFeeHandler.sol:206\n\n#### ChainLinkOracleProvider.sol\n\n    ChainLinkOracleProvider.sol:31\n    ChainLinkOracleProvider.sol:41\n    ChainLinkOracleProvider.sol:53\n    ChainLinkOracleProvider.sol:57\n    ChainLinkOracleProvider.sol:58\n\n#### Erc20Pool.sol\n\n    Erc20Pool.sol:20\n    Erc20Pool.sol:30\n\n#### EthPool.sol\n\n    EthPool.sol:25\n    EthPool.sol:26\n\n#### LiquidityPool.sol\n\n    LiquidityPool.sol:76\n    LiquidityPool.sol:136\n    LiquidityPool.sol:137\n    LiquidityPool.sol:155\n    LiquidityPool.sol:179\n    LiquidityPool.sol:208\n    LiquidityPool.sol:331\n    LiquidityPool.sol:333\n    LiquidityPool.sol:387\n    LiquidityPool.sol:399\n    LiquidityPool.sol:400\n    LiquidityPool.sol:401\n    LiquidityPool.sol:441\n    LiquidityPool.sol:471\n    LiquidityPool.sol:473\n    LiquidityPool.sol:517\n    LiquidityPool.sol:525\n    LiquidityPool.sol:549\n    LiquidityPool.sol:551\n    LiquidityPool.sol:562\n    LiquidityPool.sol:811\n    LiquidityPool.sol:812\n\n#### PoolFactory.sol\n\n    PoolFactory.sol:159\n    PoolFactory.sol:162\n    PoolFactory.sol:165\n    PoolFactory.sol:170\n    PoolFactory.sol:180\n    PoolFactory.sol:184\n\n#### BkdTriHopCvx.sol\n\n    BkdTriHopCvx.sol:133\n    BkdTriHopCvx.sol:147\n\n#### ConvexStrategyBase.sol\n\n    ConvexStrategyBase.sol:117\n    ConvexStrategyBase.sol:144\n    ConvexStrategyBase.sol:197\n    ConvexStrategyBase.sol:198\n    ConvexStrategyBase.sol:214\n    ConvexStrategyBase.sol:215\n    ConvexStrategyBase.sol:260\n    ConvexStrategyBase.sol:273\n\n#### StrategySwapper.sol\n\n    StrategySwapper.sol:69\n    StrategySwapper.sol:110\n    StrategySwapper.sol:111\n    StrategySwapper.sol:123\n    StrategySwapper.sol:124\n    StrategySwapper.sol:139\n\n#### Preparable.sol\n\n    Preparable.sol:28\n    Preparable.sol:29\n    Preparable.sol:86\n    Preparable.sol:98\n    Preparable.sol:110\n    Preparable.sol:111\n\n#### Erc20Vault.sol\n\n    Erc20Vault.sol:20\n\n#### Vault.sol\n\n    Vault.sol:88\n    Vault.sol:89\n    Vault.sol:90\n    Vault.sol:164\n    Vault.sol:165\n    Vault.sol:167\n    Vault.sol:194\n    Vault.sol:195\n    Vault.sol:198\n    Vault.sol:264\n    Vault.sol:392\n    Vault.sol:429\n    Vault.sol:762\n\n#### VaultReserve.sol\n\n    VaultReserve.sol:51\n    VaultReserve.sol:59\n    VaultReserve.sol:73\n    VaultReserve.sol:75\n\n#### AddressProvider.sol\n\n    AddressProvider.sol:64\n    AddressProvider.sol:70\n    AddressProvider.sol:96\n    AddressProvider.sol:100\n    AddressProvider.sol:170\n    AddressProvider.sol:179\n    AddressProvider.sol:188\n    AddressProvider.sol:230\n    AddressProvider.sol:231\n    AddressProvider.sol:249\n    AddressProvider.sol:259\n    AddressProvider.sol:284\n    AddressProvider.sol:285\n    AddressProvider.sol:314\n    AddressProvider.sol:417\n    AddressProvider.sol:423\n\n#### BkdLocker.sol\n\n    BkdLocker.sol:58\n    BkdLocker.sol:90\n    BkdLocker.sol:91\n    BkdLocker.sol:118\n    BkdLocker.sol:136\n    BkdLocker.sol:207\n\n#### Controller.sol\n\n    Controller:32\n    Controller:33\n    Controller:80\n\n#### CvxCrvRewardsLocker.sol\n\n    CvxCrvRewardsLocker:83\n    CvxCrvRewardsLocker:135\n\n#### GasBank.sol\n\n    GasBank:42\n    GasBank:68\n    GasBank:69\n    GasBank:76\n    GasBank:91\n\n#### LpToken.sol\n\n    LpToken:34\n\n#### StakerVault.sol\n\n    StakerVault:70\n    StakerVault:93\n    StakerVault:106\n    StakerVault:107\n    StakerVault:139\n    StakerVault:150\n    StakerVault:153\n    StakerVault:203\n    StakerVault:224\n    StakerVault:324\n    StakerVault:340\n    StakerVault:367\n    StakerVault:371\n\n#### SwapperRegistry.sol\n\n    SwapperRegistry:35\n\n### MITIGATION\n\nReplace require statements with custom errors.\n\n## [G-06] Default value initialization\n\n### PROBLEM\n\nIf a variable is not set/initialized, it is assumed to have the default value (0, false, 0x0 etc depending on the data type).\nExplicitly initializing it with its default value is an anti-pattern and wastes gas.\n\n### PROOF OF CONCEPT\n\nInstances include:\n\n#### RoleManager.sol\n\n    RoleManager.sol:80\n    RoleManager.sol:110\n    RoleManager.sol:111\n\n#### CompoundHandler.sol\n\n    CompoundHandler.sol:135\n\n#### CTokenRegistry.sol\n\n    CTokenRegistry.sol:61\n\n#### TopUpAction.sol\n\n    TopUpAction.sol:188\n    TopUpAction.sol:452\n    TopUpAction.sol:456\n    TopUpAction.sol:479\n    TopUpAction.sol:506\n    TopUpAction.sol:891\n\n#### TopUpActionKeeperHandler.sol\n\n    TopUpActionKeeperHandler.sol:43\n    TopUpActionKeeperHandler.sol:46\n    TopUpActionKeeperHandler.sol:72\n    TopUpActionKeeperHandler.sol:93\n    TopUpActionKeeperHandler.sol:165\n\n#### LiquidityPool.sol\n\n    LiquidityPool.sol:483\n\n#### ConvexStrategyBase.sol\n\n    ConvexStrategyBase.sol:313\n    ConvexStrategyBase.sol:380\n\n#### Vault.sol\n\n    Vault.sol:42\n    Vault.sol:135\n    Vault.sol:583\n\n#### BkdLocker.sol\n\n    BkdLocker.sol:133\n    BkdLocker.sol:310\n\n#### Controller.sol\n\n    Controller:114\n    Controller:117\n\n#### CvxCrvRewardsLocker.sol\n\n    CvxCrvRewardsLocker:43\n\n#### StakerVault.sol\n\n    StakerVault:144\n    StakerVault:260\n\n### MITIGATION\n\nRemove explicit initialization for default values.\n\n## [G-07] Prefix increments\n\n### PROBLEM\n\nPrefix increments are cheaper than postfix increments.\n\n### PROOF OF CONCEPT\n\nInstances include:\n\n#### RoleManager.sol\n\n    RoleManager.sol:80\n\n#### CompoundHandler.sol\n\n    CompoundHandler.sol:135\n\n#### CTokenRegistry.sol\n\n    CTokenRegistry.sol:61\n\n#### TopUpAction.sol\n\n    TopUpAction.sol:188\n    TopUpAction.sol:456\n    TopUpAction.sol:479\n    TopUpAction.sol:506\n    TopUpAction.sol:891\n\n#### TopUpActionKeeperHandler.sol\n\n    TopUpActionKeeperHandler.sol:43\n    TopUpActionKeeperHandler.sol:46\n    TopUpActionKeeperHandler.sol:50\n    TopUpActionKeeperHandler.sol:72\n    TopUpActionKeeperHandler.sol:93\n    TopUpActionKeeperHandler.sol:165\n\n#### ConvexStrategyBase.sol\n\n    ConvexStrategyBase.sol:313\n    ConvexStrategyBase.sol:380\n\n#### BkdLocker.sol\n\n    BkdLocker.sol:310\n\n#### Controller.sol\n\n    Controller:117\n\n#### StakerVault.sol\n\n    StakerVault:260\n\n### MITIGATION\n\nchange `variable++` to `++variable`\n\n## [G-08] Redundant code\n\n### IMPACT\n\nRedundant code should be avoided as it costs unnecessary gas\n\n### PROOF OF CONCEPT\n\nInstances include:\n\n#### Preparable.sol\n\n    Preparable.sol:140:\n    address oldValue = currentAddresses[key];\n    currentAddresses[key] = value;\n    pendingAddresses[key] = address(0);\n    deadlines[key] = 0;\n    emit ConfigUpdatedAddress(key, oldValue, value);\n    return value;\n\nWe can update `currentAddresses[key]` after emitting the event to save the gas of the declaration of `oldValue`:\n\n    +emit ConfigUpdatedAddress(key, currentAddresses[key], value);\n    pendingAddresses[key] = address(0);\n    deadlines[key] = 0;\n    currentAddresses[key] = value;\n    return value;\n\n### MITIGATION\n\nsee Proof of Concept for mitigation steps.\n\n## [G-09] Require instead of &&\n\n### IMPACT\n\nRequire statements including conditions with the `&&` operator can be broken down in multiple require statements to save gas.\n\n### PROOF OF CONCEPT\n\nInstances include:\n\n#### TopUpAction.sol\n\n    TopUpAction:360:\n    require(\n                newSwapperSlippage >= _MIN_SWAPPER_SLIPPAGE &&\n                    newSwapperSlippage <= _MAX_SWAPPER_SLIPPAGE,\n                Error.INVALID_AMOUNT\n            );\n\n#### ConvexStrategyBase.sol\n\n    ConvexStrategyBase:274:\n    require(\n                token_ != address(_CVX) && token_ != address(underlying) && token_ != address(_CRV),\n                Error.INVALID_TOKEN_TO_ADD\n            );\n\n#### SwapperRegistry.sol\n\n    SwapperRegistry:35:\n    require(\n                fromToken != toToken &&\n                    fromToken != address(0) &&\n                    toToken != address(0) &&\n                    newSwapper != address(0),\n                Error.INVALID_TOKEN_PAIR\n            );\n\n### MITIGATION\n\nBreakdown each condition in a separate `require` statement (though require statements should be [replaced with custom errors](#custom-errors))\n\n    require( newSwapperSlippage >=_MIN_SWAPPER_SLIPPAGE);\n    require(newSwapperSlippage <= _MAX_SWAPPER_SLIPPAGE,\n                Error.INVALID_AMOUNT)\n\n## [G-10] Tight Variable Packing\n\n### PROBLEM\n\nSolidity contracts have contiguous 32 bytes (256 bits) slots used in storage.\nBy arranging the variables, it is possible to minimize the number of slots used within a contract's storage and therefore reduce deployment costs.\n\naddress type variables are each of 20 bytes size (way less than 32 bytes). However, they here take up a whole 32 bytes slot (they are contiguous).\n\nAs bool type variables are of size 1 byte, there's a slot here that can get saved by moving them closer to an address\n\n### PROOF OF CONCEPT\n\nInstances include:\n\n#### VaultStorage.sol\n\n    VaultStorage.sol:11:\n    address public pool;\n    uint256 public totalDebt;\n    bool public strategyActive;\n\n### MITIGATION\n\nPlace `strategyActive` after `pool` to save one storage slot\n\n    address public pool;\n    +bool public strategyActive;\n    uint256 public totalDebt;\n\n## [G-11] Unchecked arithmetic\n\n### PROBLEM\n\nThe default \"checked\" behavior costs more gas when adding/diving/multiplying, because under-the-hood those checks are implemented as a series of opcodes that, prior to performing the actual arithmetic, check for under/overflow and revert if it is detected.\n\nif it can statically be determined there is no possible way for your arithmetic to under/overflow (such as a condition in an if statement), surrounding the arithmetic in an `unchecked` block will save gas\n\n### PROOF OF CONCEPT\n\nInstances include:\n\n#### LiquidityPool.sol\n\n    LiquidityPool.sol:751: underlyingBalance - underlyingToWithdraw; //because of the condition line 745, the underflow check is unnecessary\n\n#### BkdEthCvx.sol\n\n    BkdEthCvx.sol:83: uint256 requiredUnderlyingAmount = amount - underlyingBalance; //because of the condition line 76, the underflow check is unnecessary\n\n#### BkdTriHopCvx.sol\n\n    BkdTriHopCvx.sol:181: uint256 requiredUnderlyingAmount = amount - underlyingBalance; //because of the condition line 174, the underflow check is unnecessary\n\n#### CvxMintAmount.sol\n\n    CvxMintAmount.sol:24: uint256 remaining = _CLIFF_COUNT - currentCliff; //because of the condition line 21, the underflow check is unnecessary\n\n#### Vault.sol\n\n    Vault.sol:24: uint256 remaining = _CLIFF_COUNT - currentCliff; //because of the condition line 21, the underflow check is unnecessary\n\n    Vault.sol:125: uint256 requiredWithdrawal = amount - availableUnderlying_; //because of the condition line 122, the underflow check is unnecessary\n\n    Vault.sol:130: uint256 newTarget = (allocated - requiredWithdrawal) //because of the condition line 127, the underflow check is unnecessary\n\n    Vault.sol:141: uint256 totalUnderlyingAfterWithdraw = totalUnderlying - amount; //because of the condition line 122, the underflow check is unnecessary\n\n    Vault.sol:440: waitingForRemovalAllocated = _waitingForRemovalAllocated - withdrawn; //because of the condition line 437, the underflow check is unnecessary\n\n    Vault.sol:444: uint256 profit = withdrawn - allocated; //because of the condition line 443, the underflow check is unnecessary\n\n    Vault.sol:452: allocated -= withdrawn; //because of the condition line 443, the underflow check is unnecessary\n\n    Vault.sol:591: uint256 profit = allocatedUnderlying - amountAllocated; //because of the condition line 589, the underflow check is unnecessary\n\n    Vault.sol:595: profit -= currentDebt; //because of the condition line 593, the underflow check is unnecessary\n\n    Vault.sol:600: currentDebt -= profit; //because of the condition line 593, the underflow check is unnecessary\n\n    Vault.sol:605: uint256 loss = amountAllocated - allocatedUnderlying; //because of the condition line 603, the underflow check is unnecessary\n\n    Vault.sol:784: uint256 withdrawAmount = allocatedUnderlying - target; //because of the condition line 782, the underflow check is unnecessary\n\n    Vault.sol:790: uint256 depositAmount = target - allocatedUnderlying; //because of the condition line 788, the underflow check is unnecessary\n\n#### StakerVault.sol\n\n    StakerVault.sol:164: uint256 srcTokensNew = srcTokens - amount; //because of the condition line 153, the underflow check is unnecessary\n\n### MITIGATION\n\nPlace the arithmetic operations in an `unchecked` block\n\n**[chase-manning (Backd) resolved and commented](https://github.com/code-423n4/2022-04-backd-findings/issues/168#issuecomment-1111981824):**\n > I consider this report to be of particularly high quality.\n\n\n\n***\n\n# Disclosures\n\nC4 is an open organization governed by participants in the community.\n\nC4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.\n\nC4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.\n"
}