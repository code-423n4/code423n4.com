{
  "circa": {
    "title": "Yield Witch v2 contest",
    "sponsor": "Yield",
    "slug": "2022-07-yield",
    "date": "2022-10-03",
    "findings": "https://github.com/code-423n4/2022-07-yield-findings/issues",
    "contest": 147
  },
  "html": "<h1 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h1>\n<h2 id=\"about-c4\" style=\"position:relative;\"><a href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>About C4</h2>\n<p>Code4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.</p>\n<p>A C4 audit contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.</p>\n<p>During the audit contest outlined in this document, C4 conducted an analysis of the Yield Witch v2 smart contract system written in Solidity. The audit contest took place between July 14—July 17 2022.</p>\n<h2 id=\"wardens\" style=\"position:relative;\"><a href=\"#wardens\" aria-label=\"wardens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wardens</h2>\n<p>64 Wardens contributed reports to the Yield Witch v2 contest:</p>\n<ol>\n<li><a href=\"https://twitter.com/csanuragjain\">csanuragjain</a></li>\n<li><a href=\"https://github.com/antoncoding\">antonttc</a></li>\n<li>0x52</li>\n<li><a href=\"https://twitter.com/HickupH\">hickuphh3</a></li>\n<li>IllIllI</li>\n<li>horsefacts</li>\n<li>hake</li>\n<li>0x29A (0x4non and rotcivegaf)</li>\n<li>Meera</li>\n<li>Waze</li>\n<li>ak1</li>\n<li><a href=\"https://twitter.com/0xNazgul\">0xNazgul</a></li>\n<li><a href=\"https://twitter.com/rajat_beladiya\">rajatbeladiya</a></li>\n<li>__141345__</li>\n<li><a href=\"https://mobile.twitter.com/tomj_bb\">TomJ</a></li>\n<li>rbserver</li>\n<li>simon135</li>\n<li><a href=\"https://twitter.com/WahWaste\">wastewa</a></li>\n<li><a href=\"https://chom.dev\">Chom</a></li>\n<li>kyteg</li>\n<li><a href=\"https://twitter.com/c3ph_\">c3phas</a></li>\n<li>Trumpero</li>\n<li>ElKu</li>\n<li>karanctf</li>\n<li>cRat1st0s</li>\n<li><a href=\"twitter.com/rokinot\">rokinot</a></li>\n<li><a href=\"https://twitter.com/Deivitto\">Deivitto</a></li>\n<li><a href=\"https://twitter.com/father0fBl0cks\">fatherOfBlocks</a></li>\n<li>ReyAdmirado</li>\n<li>pashov</li>\n<li>SooYa</li>\n<li><a href=\"https://twitter.com/0xhyh\">hyh</a></li>\n<li>peritoflores</li>\n<li>ladboy233</li>\n<li><a href=\"https://twitter.com/KenzoAgada\">kenzo</a></li>\n<li><a href=\"https://github.com/exd0tpy\">exd0tpy</a></li>\n<li><a href=\"https://twitter.com/hansfriese\">hansfriese</a></li>\n<li><a href=\"https://twitter.com/JoeStakey\">joestakey</a></li>\n<li>asutorufos</li>\n<li>reassor</li>\n<li>delfin454000</li>\n<li><a href=\"https://instagram.com/vanensurya\">Funen</a></li>\n<li><a href=\"https://t.me/Road220\">m_Rassska</a></li>\n<li><a href=\"https://www.linkedin.com/in/georgi-nikolaev-georgiev-978253219\">gogo</a></li>\n<li>Limbooo</li>\n<li><a href=\"https://twitter.com/wookiemad\">MadWookie</a></li>\n<li><a href=\"https://github.com/0xKitsune\">0xKitsune</a></li>\n<li><a href=\"https://twitter.com/defsec_\">defsec</a></li>\n<li>samruna</li>\n<li><a href=\"https://twitter.com/sm4rtcontr4ct\">JC</a></li>\n<li>JohnSmith</li>\n<li>robee</li>\n<li>sashik_eth</li>\n<li><a href=\"https://github.com/Aymen1001\">Aymen0909</a></li>\n<li><a href=\"https://twitter.com/dediranTofunmi\">tofunmi</a></li>\n<li>ajtra</li>\n<li>0x1f8b</li>\n<li>bulej93</li>\n<li><a href=\"https://twitter.com/Sm4rty_\">Sm4rty</a></li>\n<li><a href=\"https://twitter.com/ROHANJH56009256\">Rohan16</a></li>\n<li><a href=\"https://twitter.com/0xheynacho\">ignacio</a></li>\n<li><a href=\"https://github.com/lyciumlee\">durianSausage</a></li>\n<li>Kaiziron</li>\n</ol>\n<p>This contest was judged by <a href=\"https://github.com/PierrickGT\">PierrickGT</a>.</p>\n<p>Final report assembled by <a href=\"https://twitter.com/liveactionllama\">liveactionllama</a>.</p>\n<h1 id=\"summary\" style=\"position:relative;\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h1>\n<p>The C4 analysis yielded an aggregated total of 2 unique vulnerabilities. Of these vulnerabilities, 2 received a risk rating in the category of HIGH severity and 0 received a risk rating in the category of MEDIUM severity.</p>\n<p>Additionally, C4 analysis included 40 reports detailing issues with a risk rating of LOW severity or non-critical. There were also 50 reports recommending gas optimizations.</p>\n<p>All of the issues presented here are linked back to their original finding.</p>\n<h1 id=\"scope\" style=\"position:relative;\"><a href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scope</h1>\n<p>The code under review can be found within the <a href=\"https://github.com/code-423n4/2022-07-yield\">C4 Yield Witch v2 contest repository</a>, and is composed of 1 smart contract written in the Solidity programming language and includes 527 lines of Solidity code.</p>\n<h1 id=\"severity-criteria\" style=\"position:relative;\"><a href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Severity Criteria</h1>\n<p>C4 assesses the severity of disclosed vulnerabilities according to a methodology based on <a href=\"https://owasp.org/www-community/OWASP_Risk_Rating_Methodology\">OWASP standards</a>.</p>\n<p>Vulnerabilities are divided into three primary risk categories: high, medium, and low/non-critical.</p>\n<p>High-level considerations for vulnerabilities span the following key areas when conducting assessments:</p>\n<ul>\n<li>Malicious Input Handling</li>\n<li>Escalation of privileges</li>\n<li>Arithmetic</li>\n<li>Gas use</li>\n</ul>\n<p>Further information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on <a href=\"https://code4rena.com\">the C4 website</a>.</p>\n<h1 id=\"high-risk-findings-2\" style=\"position:relative;\"><a href=\"#high-risk-findings-2\" aria-label=\"high risk findings 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>High Risk Findings (2)</h1>\n<h2 id=\"h-01--someone-can-create-non-liquidatable-auction-if-the-collateral-asset-fails-on-transferring-to-address0\" style=\"position:relative;\"><a href=\"#h-01--someone-can-create-non-liquidatable-auction-if-the-collateral-asset-fails-on-transferring-to-address0\" aria-label=\"h 01  someone can create non liquidatable auction if the collateral asset fails on transferring to address0 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/116\">[H-01]  Someone can create non-liquidatable auction if the collateral asset fails on transferring to <code>address(0)</code></a></h2>\n<p><em>Submitted by antonttc, also found by 0x52</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/main/contracts/Witch.sol#L176\">Witch.sol#L176</a><br>\n<a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L399\">Witch.sol#L399</a><br></p>\n<p>Might lead to systematic debt. Cause errors for liquidators to run normally.</p>\n<h3 id=\"proof-of-concept\" style=\"position:relative;\"><a href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>In the function <code>auction</code>, there is an input validation around whether the <code>to</code> is <code>address(0)</code> or not. And if the <code>auctioneerReward</code> is set to an value > 0 (as default),  each liquidate call will call <code>Join</code> module to pay out to <code>auctioneer</code> with the following line:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"jsx\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">auctioneerCut</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">ilkJoin</span><span class=\"mtk1\">.</span><span class=\"mtk11\">exit</span><span class=\"mtk1\">(</span><span class=\"mtk12\">auction_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">auctioneer</span><span class=\"mtk1\">, </span><span class=\"mtk12\">auctioneerCut</span><span class=\"mtk1\">.</span><span class=\"mtk11\">u128</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>This line will revert if <code>auctioneer</code> is set to <code>address(0)</code> on some tokens (revert on transferring to address(0) is a <a href=\"https://www.notion.so/Yield-Witch-555e6981c26b41008d03a504077b4770\">default behaviour of the OpenZeppelin template</a>). So if someone start an <code>auction</code> with <code>to = address(0)</code>, this auction becomes un-liquidatable.</p>\n<p>A malicious user can run a bot to monitor his own vault, and if they got underwater and they don’t have enough collateral to top up, they can immediately start an auction on their own vault and set actioneer to <code>0</code> to avoid actually being liquidated, which breaks the design of the system.</p>\n<h3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Add check while starting an auction:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"jsx\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">auction</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes12</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vaultId</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">to</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">external</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (DataTypes.Auction </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">auction_</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">require</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">to</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">), </span><span class=\"mtk8\">&quot;invalid auctioneer&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}\t\t</span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/116#issuecomment-1191312612\">alcueca (Yield) confirmed and commented</a>:</strong></p>\n<blockquote>\n<p>Best finding of the contest <img class=\"emoji-icon\" alt=\"emoji-trophy\" data-icon=\"emoji-trophy\" style=\"display: inline; margin: 0; margin-top: 1px; position: relative; top: 5px; width: 25px\" src=\"data:image/png;base64, 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\" title=\"emoji-trophy\" /> </p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/116#issuecomment-1204165927\">PierrickGT (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Most critical vulnerability found during the audit since a malicious user could open a vault and never get liquidated, it would force the protocol to take on bad debts.\nThe warden did a great job of describing the issue and providing the sponsor with a detailed fix.</p>\n</blockquote>\n<hr>\n<h2 id=\"h-02-incorrect-amount-of-collateral-moves-for-auction\" style=\"position:relative;\"><a href=\"#h-02-incorrect-amount-of-collateral-moves-for-auction\" aria-label=\"h 02 incorrect amount of collateral moves for auction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/123\">[H-02] Incorrect amount of Collateral moves for Auction</a></h2>\n<p><em>Submitted by csanuragjain</em></p>\n<p>It was observed that the debt and collateral which moves for Auction is calculated incorrectly. In case where <code>line.proportion</code> is set to small value, chances are art will become lower than min debt. This causes whole collateral to go for auction, which was not expected.</p>\n<h3 id=\"proof-of-concept-1\" style=\"position:relative;\"><a href=\"#proof-of-concept-1\" aria-label=\"proof of concept 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<ol>\n<li>Assume <code>line.proportion</code> is set to 10% which is a <a href=\"https://github.com/code-423n4/2022-07-yield/blob/main/contracts/Witch.sol#L108\">valid value</a></li>\n<li>Auction is started on Vault associated with collateral &#x26; base representing line from Step 1</li>\n<li>Now debt and collateral to be sold are calculated in <a href=\"https://github.com/code-423n4/2022-07-yield/blob/main/contracts/Witch.sol#L223\">_calcAuction</a></li>\n</ol>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">uint128 art = uint256(balances.art).wmul(line.proportion).u128();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        if (art &lt; debt.min * (10**debt.dec)) art = balances.art;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        uint128 ink = (art == balances.art)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            ? balances.ink</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            : uint256(balances.ink).wmul(line.proportion).u128();</span></span></code></pre>\n<ol start=\"4\">\n<li>Now lets say <strong>debt (art)</strong> on this vault was <strong>amount 10</strong>, <strong>collateral (ink)</strong> was <strong>amount 9</strong>, debt.min * (10**debt.dec) was <strong>amount 2</strong></li>\n<li>Below calculation occurs</li>\n</ol>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">uint128 art = uint256(balances.art).wmul(line.proportion).u128(); // which makes art = 10*10% =1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        if (art &lt; debt.min * (10**debt.dec)) art = balances.art;   // since 1&lt;2 so art=10</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        uint128 ink = (art == balances.art)                                 // Since art is 10 so ink=9</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            ? balances.ink</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            : uint256(balances.ink).wmul(line.proportion).u128();</span></span></code></pre>\n<ol start=\"6\">\n<li>So full collateral and full debt are placed for Auction even though only 10% was meant for Auction. Even if it was lower than min debt, auction amount should have only increased up to the point where minimum debt limit is reached</li>\n</ol>\n<h3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Revise the calculation like below</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">uint128 art = uint256(balances.art).wmul(line.proportion).u128();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">uint128 ink=0;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        if (art &lt; debt.min * (10**debt.dec)) </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">{</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">art = debt.min * (10**debt.dec);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">(balances.ink&lt;art) ? (ink=balances.ink) : (ink=art)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">} else {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ink=uint256(balances.ink).wmul(line.proportion).u128();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}</span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/123#issuecomment-1187535362\">hickuphh3 (warden) commented</a>:</strong></p>\n<blockquote>\n<blockquote>\n<p>debt.min * (10**debt.dec) was amount 2</p>\n</blockquote>\n<p>Only way for this to happen is for the token’s decimals to be 0, which is an edge case. </p>\n<p>Anyway, the issue is invalid because it is intended for the full collateral to be offered if it is below the minimum debt amount, ie. vault proportion is to be disregarded: <a href=\"https://github.com/code-423n4/2022-07-yield/blob/main/contracts/Witch.sol#L230\"><code>// We store the proportion of the vault to auction, which is the whole vault if the debt would be below dust.</code></a></p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/123#issuecomment-1191350641\">alcueca (Yield) confirmed and commented</a>:</strong></p>\n<blockquote>\n<p>The finding is valid, but it is a bit complicated.</p>\n<p>The behaviour should be:</p>\n<ol>\n<li>If the part of the vault for auction is below <code>dust</code>, increase to <code>dust</code>.</li>\n<li>If the remaining part of the vault is below <code>dust</code>, increase to 100%.</li>\n</ol>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/123#issuecomment-1204201695\">PierrickGT (judge) commented</a>:</strong></p>\n<blockquote>\n<p>This is the second most critical vulnerability found during the audit.<br>\nThis issue is less critical than <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/116\">H-01 (#116)</a> since the protocol would not take on bad debts but users may lose their entire collateral when only part of their collateral should have been put to auction.</p>\n</blockquote>\n<hr>\n<h1 id=\"low-risk-and-non-critical-issues\" style=\"position:relative;\"><a href=\"#low-risk-and-non-critical-issues\" aria-label=\"low risk and non critical issues permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Low Risk and Non-Critical Issues</h1>\n<p>For this contest, 40 reports were submitted by wardens detailing low risk and non-critical issues. The <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/33\">report highlighted below</a> by <strong>hickuphh3</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/111\">horsefacts</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/48\">IllIllI</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/64\">0x29A</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/50\">Waze</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/102\">ak1</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/42\">0xNazgul</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/52\">wastewa</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/37\">rajatbeladiya</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/100\">Meera</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/76\">__141345__</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/28\">hyh</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/166\">peritoflores</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/119\">simon135</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/135\">Chom</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/86\">rbserver</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/80\">ladboy233</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/40\">0x52</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/91\">kenzo</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/75\">exd0tpy</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/54\">hansfriese</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/103\">Trumpero</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/105\">karanctf</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/147\">c3phas</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/144\">csanuragjain</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/136\">asutorufos</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/177\">rokinot</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/176\">Deivitto</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/72\">cRat1st0s</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/89\">reassor</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/93\">TomJ</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/94\">delfin454000</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/27\">hake</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/87\">kyteg</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/31\">ReyAdmirado</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/96\">ElKu</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/58\">pashov</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/107\">Funen</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/18\">fatherOfBlocks</a>, and <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/174\">SooYa</a>.</em></p>\n<h2 id=\"codebase-impressions--summary\" style=\"position:relative;\"><a href=\"#codebase-impressions--summary\" aria-label=\"codebase impressions  summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Codebase Impressions &#x26; Summary</h2>\n<h3 id=\"functionality\" style=\"position:relative;\"><a href=\"#functionality\" aria-label=\"functionality permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Functionality</h3>\n<p>The revised witch (liquidation engine) contract includes the following improvements over the previous version. As stated in the README, they are:</p>\n<ol>\n<li>Greater flexibility in exploring different liquidation models.</li>\n<li>Making liquidations more profitable for liquidators by allowing payments in <code>fyToken</code>.</li>\n<li>Introduce a mechanism to reward starting an auction.</li>\n<li>Allow fine-tuning of all parameters for any collateral/underlying pair.</li>\n<li>Correct bugs.</li>\n</ol>\n<p>The liquidations flow was quite easy to follow as it consists of the following:</p>\n<ol>\n<li>Liquidation parameters are defined by governance functions (auction duration, vault proportion, auctioneer reward etc.)</li>\n<li>Starting an auction: <code>auction()</code></li>\n<li>Liquidators executing the liquidations: <code>payBase()</code> and <code>payFYToken()</code></li>\n<li>Either the entire vault collateral has been auctioned off, or <code>cancel()</code> is called to prematurely end the auction</li>\n</ol>\n<h3 id=\"documentation\" style=\"position:relative;\"><a href=\"#documentation\" aria-label=\"documentation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Documentation</h3>\n<p>The README was very extensive and thorough, and succinctly explained design considerations made. Flow diagrams were provided to help visualise the interactions required between different contracts. Inline comments were appropriate too, aided in understanding the functionality.</p>\n<h3 id=\"tests\" style=\"position:relative;\"><a href=\"#tests\" aria-label=\"tests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tests</h3>\n<p>All foundry tests passed as expected. One area of improvement is to have mainnet forking tests, since mocking is used for the external contracts. Running <code>forge coverage</code> unfortunately didn’t work. I suspect it is due to the instability of the feature rather than the fault of the tests.</p>\n<h3 id=\"gas-optimizations\" style=\"position:relative;\"><a href=\"#gas-optimizations\" aria-label=\"gas optimizations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gas Optimizations</h3>\n<p>Casting could be avoided if input / output params were defined appropriately. For instance, <code>inkOut</code>, <code>artIn</code> in <code>_updateAccounting()</code>, and <code>liquidatorCut</code> and <code>auctioneerCut</code> could have been <code>uint128</code> instead of <code>uint256</code>.</p>\n<h2 id=\"l-01-vaults-that-are-over-collateralised-after-partial-liquidation-are-possibly-subject-to-further-liquidations\" style=\"position:relative;\"><a href=\"#l-01-vaults-that-are-over-collateralised-after-partial-liquidation-are-possibly-subject-to-further-liquidations\" aria-label=\"l 01 vaults that are over collateralised after partial liquidation are possibly subject to further liquidations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-01] Vaults that are over-collateralised after partial liquidation are possibly subject to further liquidations</h2>\n<p>If a vault becomes over-collateralised after a partial liquidation, it is still subject to further liquidation as the auction isn’t closed. The vault owner has to call <code>cancel()</code> himself, or trust other altruistic actors to perform this action on his behalf. Liquidators will unlikely do it because they are economically incentivised not to do so.</p>\n<p>One can however argue that this is mitigated by the fact that protocol (governance) sets the vault proportion that can be auctioned. Regardless of whether the fact that the vault is over-collateralised after partial liquidations, the liquidators arguably are given the right to carry out further liquidations up to the proportion set.</p>\n<p>Nevertheless, a reason for a revised liquidations witch contract is that “More often than not, liquidated users have lost all their collateral as we have failed to make liquidations competitive.”. Hence, it might make sense to ensure that users need not lose more collateral than necessary.</p>\n<h3 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Consider checking if the vault is over-collateralized (maybe in <code>_updateAccounting()</code>) and close the auction if it is. This however adds complexity to the liquidation logic, as you have to update the cauldron first <code>cauldron.slurp()</code> before checking and updating the collateralization status. It will also break the CEI pattern, which might be unfavourable.</p>\n<h2 id=\"l-02-comparison-in-_calcpayout-should-include-equality\" style=\"position:relative;\"><a href=\"#l-02-comparison-in-_calcpayout-should-include-equality\" aria-label=\"l 02 comparison in _calcpayout should include equality permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-02] Comparison in <code>_calcPayout()</code> should include equality</h2>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L586\">Witch.sol#L586</a><br></p>\n<h3 id=\"tldr\" style=\"position:relative;\"><a href=\"#tldr\" aria-label=\"tldr permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TLDR</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- else if (elapsed &gt; duration)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+ else if (elapsed &gt;= duration)</span></span></span></code></pre>\n<h3 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h3>\n<p>In the case where <code>elapsed == duration</code>, <code>proportionNow</code> evaluates to <code>1e18</code>, which is the same result when <code>elapsed > duration</code>. Proof below.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">proportionNow</span><span class=\"mtk1\"> =</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk12\">initialProportion</span><span class=\"mtk1\">) +</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">uint256</span><span class=\"mtk1\">(</span><span class=\"mtk7\">1e18</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">initialProportion</span><span class=\"mtk1\">).</span><span class=\"mtk11\">wmul</span><span class=\"mtk1\">(</span><span class=\"mtk12\">elapsed</span><span class=\"mtk1\">.</span><span class=\"mtk11\">wdiv</span><span class=\"mtk1\">(</span><span class=\"mtk12\">duration</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// = initialProportion + (1e18 - initialProportion).wmul(1e18)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// = initialProportion + (1e18 - initialProportion) * 1e18 / 1e18</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// = initialProportion + 1e18 - initialProportion</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// = 1e18</span></span></span></code></pre>\n<p>Of slightly greater importance, this handles the edge case when <code>elapsed = duration = 0</code>, ie. the liquidation transaction is included in the same block / has the same timestamp as the auction initialization transaction</p>\n<h3 id=\"recommended-mitigation-steps-3\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-3\" aria-label=\"recommended mitigation steps 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>As per the TLDR.</p>\n<h3 id=\"ps-regarding-zero-duration-auctions\" style=\"position:relative;\"><a href=\"#ps-regarding-zero-duration-auctions\" aria-label=\"ps regarding zero duration auctions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>P.S. Regarding zero duration auctions</h3>\n<p>Since the proportion given for zero duration auctions is <code>1e18</code>, it is equivalent to an auction of infinite duration with 100% initial offer: <code>duration == type(uint32).max</code> and <code>line_.initialOffer = 1e18</code>.</p>\n<h2 id=\"l-03-incorrect-description-for-auctioneercut\" style=\"position:relative;\"><a href=\"#l-03-incorrect-description-for-auctioneercut\" aria-label=\"l 03 incorrect description for auctioneercut permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-03] Incorrect description for <code>auctioneerCut</code></h2>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L284\">Witch.sol#L284</a><br></p>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L342\">Witch.sol#L342</a><br></p>\n<h3 id=\"description-1\" style=\"position:relative;\"><a href=\"#description-1\" aria-label=\"description 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h3>\n<p>Technically, the <code>auctioneerCut</code> goes to the <code>to</code> address specified by the auctioneer when <code>auction()</code> is called, which, while unlikely, may not be the auctioneer himself. Also, the comparison is done against the <code>to</code> address specified, not the caller / <code>msg.sender</code> as the comment implies.</p>\n<h3 id=\"recommended-mitigation-steps-4\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-4\" aria-label=\"recommended mitigation steps 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- Amount paid to whomever started the auction. 0 if it&#39;s the same address that&#39;s calling this method</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+ Amount paid to address specified by whomever started the auction. 0 if it&#39;s the same as the `to` address</span></span></span></code></pre>\n<h2 id=\"l-04-incorrect-natspec-for-setlimit\" style=\"position:relative;\"><a href=\"#l-04-incorrect-natspec-for-setlimit\" aria-label=\"l 04 incorrect natspec for setlimit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-04] Incorrect natspec for <code>setLimit()</code></h2>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L118-L122\">Witch.sol#L118-L122</a><br></p>\n<h3 id=\"description-2\" style=\"position:relative;\"><a href=\"#description-2\" aria-label=\"description 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h3>\n<p>The comments seem outdated as the only parameter that is updated by the function is the maximum collateral that can be concurrently auctioned off.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">///  - the auction duration to calculate liquidation prices</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">///  - the proportion of the collateral that will be sold at auction start</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">///  - the maximum collateral that can be auctioned at the same time</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">///  - the minimum collateral that must be left when buying, unless buying all</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">///  - The decimals for maximum and minimum</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-5\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-5\" aria-label=\"recommended mitigation steps 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Suggest removing / updating the referenced comments.</p>\n<h2 id=\"n-01-modify-comment-to-soft-limit-check-for-clarity\" style=\"position:relative;\"><a href=\"#n-01-modify-comment-to-soft-limit-check-for-clarity\" aria-label=\"n 01 modify comment to soft limit check for clarity permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-01] Modify comment to soft limit check for clarity</h2>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L194-L196\">Witch.sol#L194-L196</a><br></p>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L200\">Witch.sol#L200</a><br></p>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L204\">Witch.sol#L204</a><br></p>\n<h3 id=\"description-3\" style=\"position:relative;\"><a href=\"#description-3\" aria-label=\"description 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h3>\n<p>The limit check is done before the summation to the total collateral allowable for liquidation. One may consider this to be a bug, but the README explains why this is the case:</p>\n<p><code>Note that the first auction to reach the limit is allowed to pass it, so that there is never the situation where a vault would be too big to ever be auctioned.</code></p>\n<p>The inline comments have this as well, but isn’t as clearly put as the README.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// There is a limit on how much collateral can be concurrently put at auction, but it is a soft limit.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// If the limit has been surpassed, no more vaults of that collateral can be put for auction.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// This avoids the scenario where some vaults might be too large to be auctioned.</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-6\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-6\" aria-label=\"recommended mitigation steps 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>For greater clarity, I would suggesting modifying the inline comment to be worded similar as the README.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">// There is a limit on how much collateral can be concurrently put at auction, but it is a soft limit.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- // If the limit has been surpassed, no more vaults of that collateral can be put for auction.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+ // The first auction to reach or exceed the limit is allowed to pass it, but subsequently, no more vaults of that collateral can be put for auction.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">// This avoids the scenario where some vaults might be too large to be auctioned.</span></span></span></code></pre>\n<h2 id=\"n-02-typos\" style=\"position:relative;\"><a href=\"#n-02-typos\" aria-label=\"n 02 typos permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-02] Typos</h2>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- bellow</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+ below</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- differente</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+ different</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">// Extra spacing</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- The Join  then dishes out</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+ The Join then dishes out</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">- quoutes hoy much ink</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+ quotes how much ink</span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/33#issuecomment-1192606755\">alcueca (Yield) confirmed and commented</a>:</strong></p>\n<blockquote>\n<p>This is a great QA report <img class=\"emoji-icon\" alt=\"emoji-heart\" data-icon=\"emoji-heart\" style=\"display: inline; margin: 0; margin-top: 1px; position: relative; top: 5px; width: 25px\" src=\"data:image/png;base64, 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\" title=\"emoji-heart\" /> </p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/33#issuecomment-1213319030\">PierrickGT (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Best QA report of this contest with clear description of the problems and comprehensive suggestions provided.</p>\n<p><strong>[L-01] Vaults that are over-collateralised after partial liquidation are possibly subject to further liquidations</strong><br></p>\n<p>Great suggestion and explanation of the risks induced by the smart contract architecture and design of the Witch contract.\nAs mentioned by the warden, their suggestion may complexify the code but they did a good job of outlining the risks and the sponsor can now decide to implement or not the suggestion.</p>\n<p><strong>[L-02] Comparison in _calcPayout() should include equality</strong><br></p>\n<p>Great find and recommendation that will cover the edge case when <code>elapsed = duration = 0</code>.</p>\n<p><strong>[L-03] Incorrect description for auctioneerCut</strong><br></p>\n<p>The comment was indeed not entirely clear and the suggestion provided by the warden should avoid any confusion in the future.</p>\n<p><strong>[L-04] Incorrect natspec for setLimit()</strong><br></p>\n<p>Good recommendation, it’s always best to write up to date Natspect documentations to avoid any confusion during a future refactor of the code.</p>\n<p><strong>[N-01] Modify comment to soft limit check for clarity</strong><br></p>\n<p>Not critical, but the suggestion from the warden adds a bit of clarity to the comment.</p>\n<p><strong>[N-02] Typos</strong><br></p>\n<p>It’s always best to avoid typos in the documentation of the code.</p>\n</blockquote>\n<hr>\n<h1 id=\"gas-optimizations-1\" style=\"position:relative;\"><a href=\"#gas-optimizations-1\" aria-label=\"gas optimizations 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gas Optimizations</h1>\n<p>For this contest, 50 reports were submitted by wardens detailing gas optimizations. The <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/47\">report highlighted below</a> by <strong>IllIllI</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/26\">hake</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/99\">Meera</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/117\">antonttc</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/60\">joestakey</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/56\">m_Rassska</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/148\">csanuragjain</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/92\">TomJ</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/113\">gogo</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/97\">rbserver</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/137\">Limbooo</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/173\">MadWookie</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/34\">hickuphh3</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/78\">kyteg</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/98\">ak1</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/79\">0xKitsune</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/149\">defsec</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/49\">Waze</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/95\">ElKu</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/2\">samruna</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/145\">c3phas</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/170\">JC</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/38\">rajatbeladiya</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/71\">cRat1st0s</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/51\">JohnSmith</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/14\">robee</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/156\">sashik_eth</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/77\">__141345__</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/120\">simon135</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/152\">Aymen0909</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/20\">fatherOfBlocks</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/162\">Deivitto</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/29\">tofunmi</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/41\">0xNazgul</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/151\">ajtra</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/61\">0x1f8b</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/32\">ReyAdmirado</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/59\">pashov</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/68\">bulej93</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/104\">Trumpero</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/125\">Sm4rty</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/131\">Rohan16</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/165\">rokinot</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/9\">ignacio</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/45\">durianSausage</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/65\">0x29A</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/101\">karanctf</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/167\">Kaiziron</a>, <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/143\">Chom</a>, and <a href=\"https://github.com/code-423n4/2022-07-yield-findings/issues/168\">SooYa</a>.</em></p>\n<h2 id=\"summary-1\" style=\"position:relative;\"><a href=\"#summary-1\" aria-label=\"summary 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h2>\n<table>\n<thead>\n<tr>\n<th></th>\n<th align=\"left\">Issue</th>\n<th align=\"center\">Instances</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>[G‑01]</td>\n<td align=\"left\">Multiple <code>address</code>/ID mappings can be combined into a single <code>mapping</code> of an <code>address</code>/ID to a <code>struct</code>, where appropriate</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td>[G‑02]</td>\n<td align=\"left\">Using <code>storage</code> instead of <code>memory</code> for structs/arrays saves gas</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td>[G‑03]</td>\n<td align=\"left\">The result of external function calls should be cached rather than re-calling the function</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td>[G‑04]</td>\n<td align=\"left\">Optimize names to save gas</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td>[G‑05]</td>\n<td align=\"left\">Using <code>bool</code>s for storage incurs overhead</td>\n<td align=\"center\">2</td>\n</tr>\n<tr>\n<td>[G‑06]</td>\n<td align=\"left\"><code>>=</code> costs less gas than <code>></code></td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td>[G‑07]</td>\n<td align=\"left\">Usage of <code>uints</code>/<code>ints</code> smaller than 32 bytes (256 bits) incurs overhead</td>\n<td align=\"center\">2</td>\n</tr>\n<tr>\n<td>[G‑08]</td>\n<td align=\"left\"><code>require()</code> or <code>revert()</code> statements that check input arguments should be at the top of the function</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td>[G‑09]</td>\n<td align=\"left\">Use custom errors rather than <code>revert()</code>/<code>require()</code> strings to save gas</td>\n<td align=\"center\">17</td>\n</tr>\n<tr>\n<td>[G‑10]</td>\n<td align=\"left\">Functions guaranteed to revert when called by normal users can be marked <code>payable</code></td>\n<td align=\"center\">6</td>\n</tr>\n</tbody>\n</table>\n<p>Total: 37 instances over 10 issues</p>\n<h2 id=\"g01--multiple-addressid-mappings-can-be-combined-into-a-single-mapping-of-an-addressid-to-a-struct-where-appropriate\" style=\"position:relative;\"><a href=\"#g01--multiple-addressid-mappings-can-be-combined-into-a-single-mapping-of-an-addressid-to-a-struct-where-appropriate\" aria-label=\"g01  multiple addressid mappings can be combined into a single mapping of an addressid to a struct where appropriate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑01]  Multiple <code>address</code>/ID mappings can be combined into a single <code>mapping</code> of an <code>address</code>/ID to a <code>struct</code>, where appropriate</h2>\n<p>Saves a storage slot for the mapping. Depending on the circumstances and sizes of types, can avoid a Gsset (<strong>20000 gas</strong>) per mapping combined. Reads and subsequent writes can also be cheaper when a function requires both values and they both fit in the same storage slot. Finally, if both fields are accessed in the same function, can save <strong>~42 gas per access</strong> due to <a href=\"https://gist.github.com/IllIllI000/ec23a57daa30a8f8ca8b9681c8ccefb0\">not having to recalculate the key’s keccak256 hash</a> (Gkeccak256 - 30 gas) and that calculation’s associated stack operations.</p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Witch</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">66</span><span class=\"mtk1\">        </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes6</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes6</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">DataTypes</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Line</span><span class=\"mtk1\">)) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">lines</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">67</span><span class=\"mtk1\">        </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes6</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes6</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">DataTypes</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Limits</span><span class=\"mtk1\">)) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">limits</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">68</span><span class=\"mtk1\">        </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">otherWitches</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">69</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes6</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes6</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">bool</span><span class=\"mtk1\">)) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ignoredPairs</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L66-L69\">Witch.sol#L66-L69</a><br></p>\n<h2 id=\"g02--using-storage-instead-of-memory-for-structsarrays-saves-gas\" style=\"position:relative;\"><a href=\"#g02--using-storage-instead-of-memory-for-structsarrays-saves-gas\" aria-label=\"g02  using storage instead of memory for structsarrays saves gas permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑02]  Using <code>storage</code> instead of <code>memory</code> for structs/arrays saves gas</h2>\n<p>When fetching data from a storage location, assigning the data to a <code>memory</code> variable causes all fields of the struct/array to be read from storage, which incurs a Gcoldsload (<strong>2100 gas</strong>) for <em>each</em> field of the struct/array. If the fields are read from the new memory variable, they incur an additional <code>MLOAD</code> rather than a cheap stack read. Instead of declearing the variable with the <code>memory</code> keyword, declaring the variable with the <code>storage</code> keyword and caching any fields that need to be re-read in stack variables, will be much cheaper, only incuring the Gcoldsload for the fields actually read. The only time it makes sense to read the whole struct/array into a <code>memory</code> variable, is if the full struct/array is being returned by the function, is being passed to a function that requires <code>memory</code>, or if the array/struct is being read from another <code>memory</code> array/struct</p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Witch</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">197</span><span class=\"mtk1\">           </span><span class=\"mtk12\">DataTypes</span><span class=\"mtk1\">.</span><span class=\"mtk12\">Limits</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">limits_</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">limits</span><span class=\"mtk1\">[</span><span class=\"mtk12\">vault</span><span class=\"mtk1\">.</span><span class=\"mtk12\">ilkId</span><span class=\"mtk1\">][</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">198</span><span class=\"mtk1\">               </span><span class=\"mtk12\">series</span><span class=\"mtk1\">.</span><span class=\"mtk12\">baseId</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">199</span><span class=\"mtk1\">:          ];</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L197-L199\">Witch.sol#L197-L199</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/contracts/Witch.sol b/contracts/Witch.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index f98dd6a..ccf9822 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/contracts/Witch.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/contracts/Witch.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -194,15 +194,15 @@ contract Witch is AccessControl {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         // There is a limit on how much collateral can be concurrently put at auction, but it is a soft limit.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         // If the limit has been surpassed, no more vaults of that collateral can be put for auction.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         // This avoids the scenario where some vaults might be too large to be auctioned.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-        DataTypes.Limits memory limits_ = limits[vault.ilkId][</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        DataTypes.Limits storage limits_ = limits[vault.ilkId][</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">             series.baseId</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         ];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-        require(limits_.sum &lt;= limits_.max, &quot;Collateral limit reached&quot;);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        uint128 lsum_ = limits_.sum;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        require(lsum_ &lt;= limits_.max, &quot;Collateral limit reached&quot;);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         auction_ = _calcAuction(vault, series, to, balances, debt);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-        limits_.sum += auction_.ink;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-        limits[vault.ilkId][series.baseId] = limits_;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        limits_.sum = lsum_ + auction_.ink;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         auctions[vaultId] = auction_;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span></code></pre>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/gas_before b/gas_after</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 68d894d..749b496 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/gas_before</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/gas_after</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -3,11 +3,11 @@</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ╞════════════════════════════════════╪═════════════════╪═══════╪════════╪═══════╪═════════╡</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> │ Deployment Cost                    ┆ Deployment Size ┆       ┆        ┆       ┆         │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-│ 3076398                            ┆ 15658           ┆       ┆        ┆       ┆         │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+│ 3062982                            ┆ 15591           ┆       ┆        ┆       ┆         │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> │ Function Name                      ┆ min             ┆ avg   ┆ median ┆ max   ┆ # calls │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-│ auction                            ┆ 4219            ┆ 70111 ┆ 81848  ┆ 91148 ┆ 30      │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+│ auction                            ┆ 4219            ┆ 69956 ┆ 81665  ┆ 90965 ┆ 30      │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> │ auctioneerReward                   ┆ 426             ┆ 426   ┆ 426    ┆ 426   ┆ 1       │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span></code></pre>\n<h2 id=\"g03--the-result-of-a-function-call-should-be-cached-rather-than-re-calling-the-function\" style=\"position:relative;\"><a href=\"#g03--the-result-of-a-function-call-should-be-cached-rather-than-re-calling-the-function\" aria-label=\"g03  the result of a function call should be cached rather than re calling the function permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑03]  The result of a function call should be cached rather than re-calling the function</h2>\n<p>The instances below point to the second+ call of the function within a single function</p>\n<p><em>There are 3 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Witch</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit inkOut.u128()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">450</span><span class=\"mtk1\">:                  </span><span class=\"mtk12\">limits_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sum</span><span class=\"mtk1\"> -= </span><span class=\"mtk12\">inkOut</span><span class=\"mtk1\">.</span><span class=\"mtk11\">u128</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit inkOut.u128()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit artIn.u128()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">458</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">cauldron</span><span class=\"mtk1\">.</span><span class=\"mtk11\">slurp</span><span class=\"mtk1\">(</span><span class=\"mtk12\">vaultId</span><span class=\"mtk1\">, </span><span class=\"mtk12\">inkOut</span><span class=\"mtk1\">.</span><span class=\"mtk11\">u128</span><span class=\"mtk1\">(), </span><span class=\"mtk12\">artIn</span><span class=\"mtk1\">.</span><span class=\"mtk11\">u128</span><span class=\"mtk1\">());</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L450\">Witch.sol#L450</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/contracts/Witch.sol b/contracts/Witch.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index f98dd6a..c2196e8 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/contracts/Witch.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/contracts/Witch.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -421,6 +421,7 @@ contract Witch is AccessControl {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         ];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         // Update local auction</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        uint128 io128_;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">             if (auction_.art == artIn) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 // If there is no debt left, return the vault with the collateral to the owner</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -428,6 +429,7 @@ contract Witch is AccessControl {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 // Update limits - reduce it by the whole auction</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 limits_.sum -= auction_.ink;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+                io128_ = inkOut.u128();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">             } else {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 // Ensure enough dust is left</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 DataTypes.Debt memory debt = cauldron.debt(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -439,15 +441,16 @@ contract Witch is AccessControl {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                     &quot;Leaves dust&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+                io128_ = inkOut.u128();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 // Update the auction</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-                auction_.ink -= inkOut.u128();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+                auction_.ink -= io128_;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 auction_.art -= artIn.u128();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 // Store auction changes</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 auctions[vaultId] = auction_;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 // Update limits - reduce it by whatever was bought</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-                limits_.sum -= inkOut.u128();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+                limits_.sum -= io128_;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">             }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -455,7 +458,7 @@ contract Witch is AccessControl {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         limits[auction_.ilkId][auction_.baseId] = limits_;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         // Update accounting at Cauldron</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-        cauldron.slurp(vaultId, inkOut.u128(), artIn.u128());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        cauldron.slurp(vaultId, io128_, artIn.u128());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     /// @dev Logs that a certain amount of a vault was liquidated</span></span></span></code></pre>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/gas_before b/gas_after</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 68d894d..7867bad 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/gas_before</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/gas_after</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -3,7 +3,7 @@</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ╞════════════════════════════════════╪═════════════════╪═══════╪════════╪═══════╪═════════╡</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> │ Deployment Cost                    ┆ Deployment Size ┆       ┆        ┆       ┆         │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-│ 3076398                            ┆ 15658           ┆       ┆        ┆       ┆         │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+│ 3075198                            ┆ 15652           ┆       ┆        ┆       ┆         │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> │ Function Name                      ┆ min             ┆ avg   ┆ median ┆ max   ┆ # calls │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -29,9 +29,9 @@</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> │ otherWitches                       ┆ 570             ┆ 570   ┆ 570    ┆ 570   ┆ 1       │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-│ payBase                            ┆ 7632            ┆ 20431 ┆ 22355  ┆ 26694 ┆ 10      │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+│ payBase                            ┆ 7632            ┆ 20373 ┆ 22357  ┆ 26544 ┆ 10      │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-│ payFYToken                         ┆ 7507            ┆ 19219 ┆ 20648  ┆ 27910 ┆ 10      │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+│ payFYToken                         ┆ 7504            ┆ 19161 ┆ 20654  ┆ 27760 ┆ 10      │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> │ point                              ┆ 2934            ┆ 5098  ┆ 2942   ┆ 9420  ┆ 3       │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span></code></pre>\n<h2 id=\"g04--optimize-names-to-save-gas\" style=\"position:relative;\"><a href=\"#g04--optimize-names-to-save-gas\" aria-label=\"g04  optimize names to save gas permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑04]  Optimize names to save gas</h2>\n<p><code>public</code>/<code>external</code> function names and <code>public</code> member variable names can be optimized to save gas. See <a href=\"https://gist.github.com/IllIllI000/a5d8b486a8259f9f77891a919febd1a9\">this</a> link for an example of how it works. Below are the interfaces/abstract contracts that can be optimized so that the most frequently-called functions use the least amount of gas possible during method lookup. Method IDs that have two leading zero bytes can save <strong>128 gas</strong> each during deployment, and renaming functions to have lower method IDs will save <strong>22 gas</strong> per call, <a href=\"https://medium.com/joyso/solidity-how-does-function-name-affect-gas-consumption-in-smart-contract-47d270d8ac92\">per sorted position shifted</a>.</p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"19\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Witch</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit point(), setLine(), setLimit(), setAnotherWitch(), setIgnoredPair(), setAuctioneerReward(), auction(), cancel(), payBase(), payFYToken(), calcPayout()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">19</span><span class=\"mtk1\">:   </span><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Witch</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span><span class=\"mtk12\">AccessControl</span><span class=\"mtk1\"> {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L19\">Witch.sol#L19</a><br></p>\n<h2 id=\"g05--using-bools-for-storage-incurs-overhead\" style=\"position:relative;\"><a href=\"#g05--using-bools-for-storage-incurs-overhead\" aria-label=\"g05  using bools for storage incurs overhead permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑05]  Using <code>bool</code>s for storage incurs overhead</h2>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"20\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Booleans are more expensive than uint256 or any type that takes up a full</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// word because each write operation emits an extra SLOAD to first read the</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// slot&#39;s contents, replace the bits taken up by the boolean, and then write</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// back. This is the compiler&#39;s defense against contract upgrades and</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// pointer aliasing, and it cannot be disabled.</span></span></span></code></pre>\n<p><a href=\"https://github.com/OpenZeppelin/openzeppelin-contracts/blob/58f635312aa21f947cae5f8578638a85aa2519f5/contracts/security/ReentrancyGuard.sol#L23-L27\">OpenZeppelin/ReentrancyGuard.sol#L23-L27</a><br>\nUse <code>uint256(1)</code> and <code>uint256(2)</code> for true/false to avoid a Gwarmaccess (<strong><a href=\"https://gist.github.com/IllIllI000/1b70014db712f8572a72378321250058\">100 gas</a></strong>) for the extra SLOAD, and to avoid Gsset (<strong>20000 gas</strong>) when changing from <code>false</code> to <code>true</code>, after having been <code>true</code> in the past</p>\n<p><em>There are 2 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"21\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Witch</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">68</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">otherWitches</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">69</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes6</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes6</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">bool</span><span class=\"mtk1\">)) </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ignoredPairs</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L68\">Witch.sol#L68</a><br></p>\n<h2 id=\"g06---costs-less-gas-than-\" style=\"position:relative;\"><a href=\"#g06---costs-less-gas-than-\" aria-label=\"g06   costs less gas than  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑06]  <code>>=</code> costs less gas than <code>></code></h2>\n<p>The compiler uses opcodes <code>GT</code> and <code>ISZERO</code> for solidity code that uses <code>></code>, but only requires <code>LT</code> for <code>>=</code>, <a href=\"https://gist.github.com/IllIllI000/3dc79d25acccfa16dee4e83ffdc6ffde\">which saves <strong>3 gas</strong></a></p>\n<p><em>There are 3 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"22\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Witch</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">308</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">artIn</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">artIn</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk12\">auction_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">art</span><span class=\"mtk1\"> ? </span><span class=\"mtk12\">auction_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">art</span><span class=\"mtk1\"> : </span><span class=\"mtk12\">artIn</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">361</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">artIn</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">maxArtIn</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk12\">auction_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">art</span><span class=\"mtk1\"> ? </span><span class=\"mtk12\">auction_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">art</span><span class=\"mtk1\"> : </span><span class=\"mtk12\">maxArtIn</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">556</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">artIn</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">maxArtIn</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk12\">auction_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">art</span><span class=\"mtk1\"> ? </span><span class=\"mtk12\">auction_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">art</span><span class=\"mtk1\"> : </span><span class=\"mtk12\">maxArtIn</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L308\">Witch.sol#L308</a><br></p>\n<h2 id=\"g07--usage-of-uintsints-smaller-than-32-bytes-256-bits-incurs-overhead\" style=\"position:relative;\"><a href=\"#g07--usage-of-uintsints-smaller-than-32-bytes-256-bits-incurs-overhead\" aria-label=\"g07  usage of uintsints smaller than 32 bytes 256 bits incurs overhead permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑07]  Usage of <code>uints</code>/<code>ints</code> smaller than 32 bytes (256 bits) incurs overhead</h2>\n<blockquote>\n<p>When using elements that are smaller than 32 bytes, your contract’s gas usage may be higher. This is because the EVM operates on 32 bytes at a time. Therefore, if the element is smaller than that, the EVM must use more operations in order to reduce the size of the element from 32 bytes to the desired size.</p>\n</blockquote>\n<p><a href=\"https://docs.soliditylang.org/en/v0.8.11/internals/layout_in_storage.html\">https://docs.soliditylang.org/en/v0.8.11/internals/layout_in_storage.html</a><br>\nEach operation involving a <code>uint8</code> costs an extra <a href=\"https://gist.github.com/IllIllI000/9388d20c70f9a4632eb3ca7836f54977\"><strong>28 gas</strong></a> as compared to ones involving <code>uint256</code>, due to the compiler having to clear the higher bits of the memory word before operating on the <code>uint8</code>, as well as the associated stack operations of doing so. Use a larger size then downcast where needed</p>\n<p><em>There are 2 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"23\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Witch</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit uint128 art</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">233</span><span class=\"mtk1\">:          </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">art</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">debt</span><span class=\"mtk1\">.</span><span class=\"mtk12\">min</span><span class=\"mtk1\"> * (</span><span class=\"mtk7\">10</span><span class=\"mtk1\">**</span><span class=\"mtk12\">debt</span><span class=\"mtk1\">.</span><span class=\"mtk12\">dec</span><span class=\"mtk1\">)) </span><span class=\"mtk12\">art</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">balances</span><span class=\"mtk1\">.</span><span class=\"mtk12\">art</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit uint128 artIn</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">308</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">artIn</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">artIn</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk12\">auction_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">art</span><span class=\"mtk1\"> ? </span><span class=\"mtk12\">auction_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">art</span><span class=\"mtk1\"> : </span><span class=\"mtk12\">artIn</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L233\">Witch.sol#L233</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"24\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/contracts/Witch.sol b/contracts/Witch.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index f98dd6a..066e912 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/contracts/Witch.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/contracts/Witch.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -229,11 +229,11 @@ contract Witch is AccessControl {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     ) internal view returns (DataTypes.Auction memory) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         // We store the proportion of the vault to auction, which is the whole vault if the debt would be below dust.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         DataTypes.Line storage line = lines[vault.ilkId][series.baseId];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-        uint128 art = uint256(balances.art).wmul(line.proportion).u128();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        uint256 art = uint256(balances.art).wmul(line.proportion);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         if (art &lt; debt.min * (10**debt.dec)) art = balances.art;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-        uint128 ink = (art == balances.art)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        uint256 ink = (art == balances.art)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">             ? balances.ink</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-            : uint256(balances.ink).wmul(line.proportion).u128();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+            : uint256(balances.ink).wmul(line.proportion);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         return</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">             DataTypes.Auction({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -242,8 +242,8 @@ contract Witch is AccessControl {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 seriesId: vault.seriesId,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 baseId: series.baseId,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 ilkId: vault.ilkId,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-                art: art,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-                ink: ink,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+                art: art.u128(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+                ink: ink.u128(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 auctioneer: to</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">             });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     }</span></span></span></code></pre>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"25\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/gas_before b/gas_after</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 68d894d..4f7212a 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/gas_before</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/gas_after</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -3,17 +3,17 @@</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ╞════════════════════════════════════╪═════════════════╪═══════╪════════╪═══════╪═════════╡</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> │ Deployment Cost                    ┆ Deployment Size ┆       ┆        ┆       ┆         │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-│ 3076398                            ┆ 15658           ┆       ┆        ┆       ┆         │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+│ 3077398                            ┆ 15663           ┆       ┆        ┆       ┆         │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> │ Function Name                      ┆ min             ┆ avg   ┆ median ┆ max   ┆ # calls │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-│ auction                            ┆ 4219            ┆ 70111 ┆ 81848  ┆ 91148 ┆ 30      │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+│ auction                            ┆ 4219            ┆ 70086 ┆ 81815  ┆ 91115 ┆ 30      │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> │ auctioneerReward                   ┆ 426             ┆ 426   ┆ 426    ┆ 426   ┆ 1       │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> │ auctions                           ┆ 1244            ┆ 1244  ┆ 1244   ┆ 1244  ┆ 20      │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-│ calcPayout                         ┆ 3627            ┆ 10420 ┆ 14603  ┆ 19151 ┆ 29      │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+│ calcPayout                         ┆ 3627            ┆ 10415 ┆ 14603  ┆ 19118 ┆ 29      │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> │ cancel                             ┆ 2736            ┆ 9683  ┆ 5675   ┆ 20639 ┆ 3       │</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤</span></span></span></code></pre>\n<h2 id=\"g08--require-or-revert-statements-that-check-input-arguments-should-be-at-the-top-of-the-function\" style=\"position:relative;\"><a href=\"#g08--require-or-revert-statements-that-check-input-arguments-should-be-at-the-top-of-the-function\" aria-label=\"g08  require or revert statements that check input arguments should be at the top of the function permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑08]  <code>require()</code> or <code>revert()</code> statements that check input arguments should be at the top of the function</h2>\n<p>Checks that involve constants should come before checks that involve state variables, function calls, and calculations. By doing these checks first, the function is able to revert before wasting a Gcoldsload (<strong>2100 gas</strong>*) in a function that may ultimately revert in the unhappy case.</p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"26\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Witch</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit expensive op on line 105</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">108</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proportion</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk7\">0.01e18</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Proportion below 1%&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L108\">Witch.sol#L108</a><br></p>\n<h2 id=\"g09--use-custom-errors-rather-than-revertrequire-strings-to-save-gas\" style=\"position:relative;\"><a href=\"#g09--use-custom-errors-rather-than-revertrequire-strings-to-save-gas\" aria-label=\"g09  use custom errors rather than revertrequire strings to save gas permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑09]  Use custom errors rather than <code>revert()</code>/<code>require()</code> strings to save gas</h2>\n<p>Custom errors are available from solidity version 0.8.4. Custom errors save <a href=\"https://gist.github.com/IllIllI000/ad1bd0d29a0101b25e57c293b4b0c746\"><strong>~50 gas</strong></a> each time they’re hit by <a href=\"https://blog.soliditylang.org/2021/04/21/custom-errors/#errors-in-depth\">avoiding having to allocate and store the revert string</a>. Not defining the strings also save deployment gas</p>\n<p><em>There are 17 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"27\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Witch</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">84</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">param</span><span class=\"mtk1\"> == </span><span class=\"mtk8\">&quot;ladle&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Unrecognized&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">102</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">initialOffer</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk7\">1e18</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;InitialOffer above 100%&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">103</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proportion</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk7\">1e18</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Proportion above 100%&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">104</span><span class=\"mtk1\">           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">105</span><span class=\"mtk1\">               </span><span class=\"mtk12\">initialOffer</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">initialOffer</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk7\">0.01e18</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">106</span><span class=\"mtk1\">               </span><span class=\"mtk8\">&quot;InitialOffer below 1%&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">107</span><span class=\"mtk1\">:          );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">108</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">proportion</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk7\">0.01e18</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Proportion below 1%&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">189</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">cauldron</span><span class=\"mtk1\">.</span><span class=\"mtk11\">level</span><span class=\"mtk1\">(</span><span class=\"mtk12\">vaultId</span><span class=\"mtk1\">) &lt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Not undercollateralized&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">200</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">limits_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sum</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk12\">limits_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">max</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Collateral limit reached&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">255</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">auction_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">start</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Vault not under auction&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">256</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">cauldron</span><span class=\"mtk1\">.</span><span class=\"mtk11\">level</span><span class=\"mtk1\">(</span><span class=\"mtk12\">vaultId</span><span class=\"mtk1\">) &gt;= </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Undercollateralized&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">300</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">auction_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">start</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Vault not under auction&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">313</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">liquidatorCut</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">minInkOut</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Not enough bought&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">328</span><span class=\"mtk1\">:              </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">baseJoin</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">IJoin</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)), </span><span class=\"mtk8\">&quot;Join not found&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">358</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">auction_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">start</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Vault not under auction&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">365</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">liquidatorCut</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">minInkOut</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Not enough bought&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">395</span><span class=\"mtk1\">:              </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ilkJoin</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">IJoin</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)), </span><span class=\"mtk8\">&quot;Join not found&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">416</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">auction_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">start</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Vault not under auction&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">437</span><span class=\"mtk1\">                   </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">438</span><span class=\"mtk1\">                       </span><span class=\"mtk12\">auction_</span><span class=\"mtk1\">.</span><span class=\"mtk12\">art</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">artIn</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">debt</span><span class=\"mtk1\">.</span><span class=\"mtk12\">min</span><span class=\"mtk1\"> * (</span><span class=\"mtk7\">10</span><span class=\"mtk1\">**</span><span class=\"mtk12\">debt</span><span class=\"mtk1\">.</span><span class=\"mtk12\">dec</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">439</span><span class=\"mtk1\">                       </span><span class=\"mtk8\">&quot;Leaves dust&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">440</span><span class=\"mtk1\">:                  );</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L84\">Witch.sol#L84</a><br></p>\n<h2 id=\"g10--functions-guaranteed-to-revert-when-called-by-normal-users-can-be-marked-payable\" style=\"position:relative;\"><a href=\"#g10--functions-guaranteed-to-revert-when-called-by-normal-users-can-be-marked-payable\" aria-label=\"g10  functions guaranteed to revert when called by normal users can be marked payable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑10]  Functions guaranteed to revert when called by normal users can be marked <code>payable</code></h2>\n<p>If a function modifier such as <code>onlyOwner</code> is used, the function will revert if a normal user tries to pay the function. Marking the function as <code>payable</code> will lower the gas cost for legitimate callers because the compiler will not include checks for whether a payment was provided. The extra opcodes avoided are\n<code>CALLVALUE</code>(2),<code>DUP1</code>(3),<code>ISZERO</code>(3),<code>PUSH2</code>(3),<code>JUMPI</code>(10),<code>PUSH1</code>(3),<code>DUP1</code>(3),<code>REVERT</code>(0),<code>JUMPDEST</code>(1),<code>POP</code>(2), which costs an average of about <strong>21 gas per call</strong> to the function, in addition to the extra deployment cost.</p>\n<p><em>There are 6 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"28\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Witch</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">83</span><span class=\"mtk1\">:       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">point</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">param</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">value</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">auth</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">95</span><span class=\"mtk1\">        </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setLine</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">96            </span><span class=\"mtk12\">bytes6</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ilkId</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">97            </span><span class=\"mtk12\">bytes6</span><span class=\"mtk1\"> </span><span class=\"mtk12\">baseId</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">98            </span><span class=\"mtk12\">uint32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">duration</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">99            </span><span class=\"mtk12\">uint64</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proportion</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">100           </span><span class=\"mtk12\">uint64</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initialOffer</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">101:      ) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">auth</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">126</span><span class=\"mtk1\">       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setLimit</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">127           </span><span class=\"mtk12\">bytes6</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ilkId</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">128           </span><span class=\"mtk12\">bytes6</span><span class=\"mtk1\"> </span><span class=\"mtk12\">baseId</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">129           </span><span class=\"mtk12\">uint128</span><span class=\"mtk1\"> </span><span class=\"mtk12\">max</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">130:      ) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">auth</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">141</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setAnotherWitch</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">value</span><span class=\"mtk1\">, </span><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">isWitch</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">auth</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">150</span><span class=\"mtk1\">       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setIgnoredPair</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">151           </span><span class=\"mtk12\">bytes6</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ilkId</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">152           </span><span class=\"mtk12\">bytes6</span><span class=\"mtk1\"> </span><span class=\"mtk12\">baseId</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">153           </span><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ignore</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">154:      ) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">auth</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">161</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setAuctioneerReward</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint128</span><span class=\"mtk1\"> </span><span class=\"mtk12\">auctioneerReward_</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">auth</span><span class=\"mtk1\"> {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L83\">Witch.sol#L83</a><br></p>\n<hr>\n<h1 id=\"disclosures\" style=\"position:relative;\"><a href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Disclosures</h1>\n<p>C4 is an open organization governed by participants in the community.</p>\n<p>C4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.</p>\n<p>C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>",
  "toc": "<ul>\n<li>\n<p><a href=\"#overview\">Overview</a></p>\n<ul>\n<li><a href=\"#about-c4\">About C4</a></li>\n<li><a href=\"#wardens\">Wardens</a></li>\n</ul>\n</li>\n<li><a href=\"#summary\">Summary</a></li>\n<li><a href=\"#scope\">Scope</a></li>\n<li><a href=\"#severity-criteria\">Severity Criteria</a></li>\n<li>\n<p><a href=\"#high-risk-findings-2\">High Risk Findings (2)</a></p>\n<ul>\n<li><a href=\"#h-01--someone-can-create-non-liquidatable-auction-if-the-collateral-asset-fails-on-transferring-to-address0\">[H-01]  Someone can create non-liquidatable auction if the collateral asset fails on transferring to <code>address(0)</code></a></li>\n<li><a href=\"#h-02-incorrect-amount-of-collateral-moves-for-auction\">[H-02] Incorrect amount of Collateral moves for Auction</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#low-risk-and-non-critical-issues\">Low Risk and Non-Critical Issues</a></p>\n<ul>\n<li><a href=\"#codebase-impressions--summary\">Codebase Impressions &#x26; Summary</a></li>\n<li><a href=\"#l-01-vaults-that-are-over-collateralised-after-partial-liquidation-are-possibly-subject-to-further-liquidations\">L-01 Vaults that are over-collateralised after partial liquidation are possibly subject to further liquidations</a></li>\n<li><a href=\"#l-02-comparison-in-_calcpayout-should-include-equality\">L-02 Comparison in <code>_calcPayout()</code> should include equality</a></li>\n<li><a href=\"#l-03-incorrect-description-for-auctioneercut\">L-03 Incorrect description for <code>auctioneerCut</code></a></li>\n<li><a href=\"#l-04-incorrect-natspec-for-setlimit\">L-04 Incorrect natspec for <code>setLimit()</code></a></li>\n<li><a href=\"#n-01-modify-comment-to-soft-limit-check-for-clarity\">N-01 Modify comment to soft limit check for clarity</a></li>\n<li><a href=\"#n-02-typos\">N-02 Typos</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#gas-optimizations-1\">Gas Optimizations</a></p>\n<ul>\n<li><a href=\"#summary-1\">Summary</a></li>\n<li><a href=\"#g01--multiple-addressid-mappings-can-be-combined-into-a-single-mapping-of-an-addressid-to-a-struct-where-appropriate\">[G‑01]  Multiple <code>address</code>/ID mappings can be combined into a single <code>mapping</code> of an <code>address</code>/ID to a <code>struct</code>, where appropriate</a></li>\n<li><a href=\"#g02--using-storage-instead-of-memory-for-structsarrays-saves-gas\">[G‑02]  Using <code>storage</code> instead of <code>memory</code> for structs/arrays saves gas</a></li>\n<li><a href=\"#g03--the-result-of-a-function-call-should-be-cached-rather-than-re-calling-the-function\">[G‑03]  The result of a function call should be cached rather than re-calling the function</a></li>\n<li><a href=\"#g04--optimize-names-to-save-gas\">[G‑04]  Optimize names to save gas</a></li>\n<li><a href=\"#g05--using-bools-for-storage-incurs-overhead\">[G‑05]  Using <code>bool</code>s for storage incurs overhead</a></li>\n<li><a href=\"#g06---costs-less-gas-than-\">[G‑06]  <code>>=</code> costs less gas than <code>></code></a></li>\n<li><a href=\"#g07--usage-of-uintsints-smaller-than-32-bytes-256-bits-incurs-overhead\">[G‑07]  Usage of <code>uints</code>/<code>ints</code> smaller than 32 bytes (256 bits) incurs overhead</a></li>\n<li><a href=\"#g08--require-or-revert-statements-that-check-input-arguments-should-be-at-the-top-of-the-function\">[G‑08]  <code>require()</code> or <code>revert()</code> statements that check input arguments should be at the top of the function</a></li>\n<li><a href=\"#g09--use-custom-errors-rather-than-revertrequire-strings-to-save-gas\">[G‑09]  Use custom errors rather than <code>revert()</code>/<code>require()</code> strings to save gas</a></li>\n<li><a href=\"#g10--functions-guaranteed-to-revert-when-called-by-normal-users-can-be-marked-payable\">[G‑10]  Functions guaranteed to revert when called by normal users can be marked <code>payable</code></a></li>\n</ul>\n</li>\n<li><a href=\"#disclosures\">Disclosures</a></li>\n</ul>",
  "md": "\n# Overview\n\n## About C4\n\nCode4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.\n\nA C4 audit contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.\n\nDuring the audit contest outlined in this document, C4 conducted an analysis of the Yield Witch v2 smart contract system written in Solidity. The audit contest took place between July 14—July 17 2022.\n\n## Wardens\n\n64 Wardens contributed reports to the Yield Witch v2 contest:\n\n  1. [csanuragjain](https://twitter.com/csanuragjain)\n  1. [antonttc](https://github.com/antoncoding)\n  1. 0x52\n  1. [hickuphh3](https://twitter.com/HickupH)\n  1. IllIllI\n  1. horsefacts\n  1. hake\n  1. 0x29A (0x4non and rotcivegaf)\n  1. Meera\n  1. Waze\n  1. ak1\n  1. [0xNazgul](https://twitter.com/0xNazgul)\n  1. [rajatbeladiya](https://twitter.com/rajat_beladiya)\n  1. &#95;&#95;141345&#95;&#95;\n  1. [TomJ](https://mobile.twitter.com/tomj_bb)\n  1. rbserver\n  1. simon135\n  1. [wastewa](https://twitter.com/WahWaste)\n  1. [Chom](https://chom.dev)\n  1. kyteg\n  1. [c3phas](https://twitter.com/c3ph_)\n  1. Trumpero\n  1. ElKu\n  1. karanctf\n  1. cRat1st0s\n  1. [rokinot](twitter.com/rokinot)\n  1. [Deivitto](https://twitter.com/Deivitto)\n  1. [fatherOfBlocks](https://twitter.com/father0fBl0cks)\n  1. ReyAdmirado\n  1. pashov\n  1. SooYa\n  1. [hyh](https://twitter.com/0xhyh)\n  1. peritoflores\n  1. ladboy233\n  1. [kenzo](https://twitter.com/KenzoAgada)\n  1. [exd0tpy](https://github.com/exd0tpy)\n  1. [hansfriese](https://twitter.com/hansfriese)\n  1. [joestakey](https://twitter.com/JoeStakey)\n  1. asutorufos\n  1. reassor\n  1. delfin454000\n  1. [Funen](https://instagram.com/vanensurya)\n  1. [m&#95;Rassska](https://t.me/Road220)\n  1. [gogo](https://www.linkedin.com/in/georgi-nikolaev-georgiev-978253219)\n  1. Limbooo\n  1. [MadWookie](https://twitter.com/wookiemad)\n  1. [0xKitsune](https://github.com/0xKitsune)\n  1. [defsec](https://twitter.com/defsec_)\n  1. samruna\n  1. [JC](https://twitter.com/sm4rtcontr4ct)\n  1. JohnSmith\n  1. robee\n  1. sashik&#95;eth\n  1. [Aymen0909](https://github.com/Aymen1001)\n  1. [tofunmi](https://twitter.com/dediranTofunmi)\n  1. ajtra\n  1. 0x1f8b\n  1. bulej93\n  1. [Sm4rty](https://twitter.com/Sm4rty_)\n  1. [Rohan16](https://twitter.com/ROHANJH56009256)\n  1. [ignacio](https://twitter.com/0xheynacho)\n  1. [durianSausage](https://github.com/lyciumlee)\n  1. Kaiziron\n\nThis contest was judged by [PierrickGT](https://github.com/PierrickGT).\n\nFinal report assembled by [liveactionllama](https://twitter.com/liveactionllama).\n\n# Summary\n\nThe C4 analysis yielded an aggregated total of 2 unique vulnerabilities. Of these vulnerabilities, 2 received a risk rating in the category of HIGH severity and 0 received a risk rating in the category of MEDIUM severity.\n\nAdditionally, C4 analysis included 40 reports detailing issues with a risk rating of LOW severity or non-critical. There were also 50 reports recommending gas optimizations.\n\nAll of the issues presented here are linked back to their original finding.\n\n# Scope\n\nThe code under review can be found within the [C4 Yield Witch v2 contest repository](https://github.com/code-423n4/2022-07-yield), and is composed of 1 smart contract written in the Solidity programming language and includes 527 lines of Solidity code.\n\n# Severity Criteria\n\nC4 assesses the severity of disclosed vulnerabilities according to a methodology based on [OWASP standards](https://owasp.org/www-community/OWASP_Risk_Rating_Methodology).\n\nVulnerabilities are divided into three primary risk categories: high, medium, and low/non-critical.\n\nHigh-level considerations for vulnerabilities span the following key areas when conducting assessments:\n\n- Malicious Input Handling\n- Escalation of privileges\n- Arithmetic\n- Gas use\n\nFurther information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on [the C4 website](https://code4rena.com).\n\n# High Risk Findings (2)\n## [[H-01]  Someone can create non-liquidatable auction if the collateral asset fails on transferring to `address(0)`](https://github.com/code-423n4/2022-07-yield-findings/issues/116)\n_Submitted by antonttc, also found by 0x52_\n\n[Witch.sol#L176](https://github.com/code-423n4/2022-07-yield/blob/main/contracts/Witch.sol#L176)<br>\n[Witch.sol#L399](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L399)<br>\n\nMight lead to systematic debt. Cause errors for liquidators to run normally.\n\n### Proof of Concept\n\nIn the function `auction`, there is an input validation around whether the `to` is `address(0)` or not. And if the `auctioneerReward` is set to an value > 0 (as default),  each liquidate call will call `Join` module to pay out to `auctioneer` with the following line:\n\n```jsx\nif (auctioneerCut > 0) {\n    ilkJoin.exit(auction_.auctioneer, auctioneerCut.u128());\n}\n```\n\nThis line will revert if `auctioneer` is set to `address(0)` on some tokens (revert on transferring to address(0) is a [default behaviour of the OpenZeppelin template](https://www.notion.so/Yield-Witch-555e6981c26b41008d03a504077b4770)). So if someone start an `auction` with `to = address(0)`, this auction becomes un-liquidatable.\n\nA malicious user can run a bot to monitor his own vault, and if they got underwater and they don’t have enough collateral to top up, they can immediately start an auction on their own vault and set actioneer to `0` to avoid actually being liquidated, which breaks the design of the system.\n\n### Recommended Mitigation Steps\n\nAdd check while starting an auction:\n\n```jsx\nfunction auction(bytes12 vaultId, address to)\n    external\n    returns (DataTypes.Auction memory auction_)\n{\n    require (to != address(0), \"invalid auctioneer\");\n\t\t...\n}\t\t\n```\n\n**[alcueca (Yield) confirmed and commented](https://github.com/code-423n4/2022-07-yield-findings/issues/116#issuecomment-1191312612):**\n > Best finding of the contest :trophy: \n\n**[PierrickGT (judge) commented](https://github.com/code-423n4/2022-07-yield-findings/issues/116#issuecomment-1204165927):**\n > Most critical vulnerability found during the audit since a malicious user could open a vault and never get liquidated, it would force the protocol to take on bad debts.\n> The warden did a great job of describing the issue and providing the sponsor with a detailed fix.\n\n\n\n***\n\n## [[H-02] Incorrect amount of Collateral moves for Auction](https://github.com/code-423n4/2022-07-yield-findings/issues/123)\n_Submitted by csanuragjain_\n\nIt was observed that the debt and collateral which moves for Auction is calculated incorrectly. In case where `line.proportion` is set to small value, chances are art will become lower than min debt. This causes whole collateral to go for auction, which was not expected.\n\n### Proof of Concept\n\n1.  Assume `line.proportion` is set to 10% which is a [valid value](https://github.com/code-423n4/2022-07-yield/blob/main/contracts/Witch.sol#L108)\n\n2.  Auction is started on Vault associated with collateral & base representing line from Step 1\n\n3.  Now debt and collateral to be sold are calculated in [\\_calcAuction](https://github.com/code-423n4/2022-07-yield/blob/main/contracts/Witch.sol#L223)\n\n<!---->\n\n    uint128 art = uint256(balances.art).wmul(line.proportion).u128();\n            if (art < debt.min * (10**debt.dec)) art = balances.art;\n            uint128 ink = (art == balances.art)\n                ? balances.ink\n                : uint256(balances.ink).wmul(line.proportion).u128();\n\n4.  Now lets say **debt (art)** on this vault was **amount 10**, **collateral (ink)** was **amount 9**, debt.min &ast; (10&ast;&ast;debt.dec) was **amount 2**\n\n5.  Below calculation occurs\n\n<!---->\n\n    uint128 art = uint256(balances.art).wmul(line.proportion).u128(); // which makes art = 10*10% =1\n            if (art < debt.min * (10**debt.dec)) art = balances.art;   // since 1<2 so art=10\n            uint128 ink = (art == balances.art)                                 // Since art is 10 so ink=9\n                ? balances.ink\n                : uint256(balances.ink).wmul(line.proportion).u128();\n\n6.  So full collateral and full debt are placed for Auction even though only 10% was meant for Auction. Even if it was lower than min debt, auction amount should have only increased up to the point where minimum debt limit is reached\n\n### Recommended Mitigation Steps\n\nRevise the calculation like below\n\n    uint128 art = uint256(balances.art).wmul(line.proportion).u128();\n    uint128 ink=0;\n            if (art < debt.min * (10**debt.dec)) \n    {\n    art = debt.min * (10**debt.dec);\n    (balances.ink<art) ? (ink=balances.ink) : (ink=art)\n    } else {\n    ink=uint256(balances.ink).wmul(line.proportion).u128();\n    }\n\n**[hickuphh3 (warden) commented](https://github.com/code-423n4/2022-07-yield-findings/issues/123#issuecomment-1187535362):**\n > > debt.min * (10**debt.dec) was amount 2\n> \n> Only way for this to happen is for the token's decimals to be 0, which is an edge case. \n> \n> Anyway, the issue is invalid because it is intended for the full collateral to be offered if it is below the minimum debt amount, ie. vault proportion is to be disregarded: [`// We store the proportion of the vault to auction, which is the whole vault if the debt would be below dust.`](https://github.com/code-423n4/2022-07-yield/blob/main/contracts/Witch.sol#L230)\n\n**[alcueca (Yield) confirmed and commented](https://github.com/code-423n4/2022-07-yield-findings/issues/123#issuecomment-1191350641):**\n > The finding is valid, but it is a bit complicated.\n> \n> The behaviour should be:\n>  1. If the part of the vault for auction is below `dust`, increase to `dust`.\n>  2. If the remaining part of the vault is below `dust`, increase to 100%.\n\n**[PierrickGT (judge) commented](https://github.com/code-423n4/2022-07-yield-findings/issues/123#issuecomment-1204201695):**\n > This is the second most critical vulnerability found during the audit.<br>\n> This issue is less critical than [H-01 (#116)](https://github.com/code-423n4/2022-07-yield-findings/issues/116) since the protocol would not take on bad debts but users may lose their entire collateral when only part of their collateral should have been put to auction.\n\n\n\n***\n\n# Low Risk and Non-Critical Issues\n\nFor this contest, 40 reports were submitted by wardens detailing low risk and non-critical issues. The [report highlighted below](https://github.com/code-423n4/2022-07-yield-findings/issues/33) by **hickuphh3** received the top score from the judge.\n\n*The following wardens also submitted reports: [horsefacts](https://github.com/code-423n4/2022-07-yield-findings/issues/111), [IllIllI](https://github.com/code-423n4/2022-07-yield-findings/issues/48), [0x29A](https://github.com/code-423n4/2022-07-yield-findings/issues/64), [Waze](https://github.com/code-423n4/2022-07-yield-findings/issues/50), [ak1](https://github.com/code-423n4/2022-07-yield-findings/issues/102), [0xNazgul](https://github.com/code-423n4/2022-07-yield-findings/issues/42), [wastewa](https://github.com/code-423n4/2022-07-yield-findings/issues/52), [rajatbeladiya](https://github.com/code-423n4/2022-07-yield-findings/issues/37), [Meera](https://github.com/code-423n4/2022-07-yield-findings/issues/100), [&#95;&#95;141345&#95;&#95;](https://github.com/code-423n4/2022-07-yield-findings/issues/76), [hyh](https://github.com/code-423n4/2022-07-yield-findings/issues/28), [peritoflores](https://github.com/code-423n4/2022-07-yield-findings/issues/166), [simon135](https://github.com/code-423n4/2022-07-yield-findings/issues/119), [Chom](https://github.com/code-423n4/2022-07-yield-findings/issues/135), [rbserver](https://github.com/code-423n4/2022-07-yield-findings/issues/86), [ladboy233](https://github.com/code-423n4/2022-07-yield-findings/issues/80), [0x52](https://github.com/code-423n4/2022-07-yield-findings/issues/40), [kenzo](https://github.com/code-423n4/2022-07-yield-findings/issues/91), [exd0tpy](https://github.com/code-423n4/2022-07-yield-findings/issues/75), [hansfriese](https://github.com/code-423n4/2022-07-yield-findings/issues/54), [Trumpero](https://github.com/code-423n4/2022-07-yield-findings/issues/103), [karanctf](https://github.com/code-423n4/2022-07-yield-findings/issues/105), [c3phas](https://github.com/code-423n4/2022-07-yield-findings/issues/147), [csanuragjain](https://github.com/code-423n4/2022-07-yield-findings/issues/144), [asutorufos](https://github.com/code-423n4/2022-07-yield-findings/issues/136), [rokinot](https://github.com/code-423n4/2022-07-yield-findings/issues/177), [Deivitto](https://github.com/code-423n4/2022-07-yield-findings/issues/176), [cRat1st0s](https://github.com/code-423n4/2022-07-yield-findings/issues/72), [reassor](https://github.com/code-423n4/2022-07-yield-findings/issues/89), [TomJ](https://github.com/code-423n4/2022-07-yield-findings/issues/93), [delfin454000](https://github.com/code-423n4/2022-07-yield-findings/issues/94), [hake](https://github.com/code-423n4/2022-07-yield-findings/issues/27), [kyteg](https://github.com/code-423n4/2022-07-yield-findings/issues/87), [ReyAdmirado](https://github.com/code-423n4/2022-07-yield-findings/issues/31), [ElKu](https://github.com/code-423n4/2022-07-yield-findings/issues/96), [pashov](https://github.com/code-423n4/2022-07-yield-findings/issues/58), [Funen](https://github.com/code-423n4/2022-07-yield-findings/issues/107), [fatherOfBlocks](https://github.com/code-423n4/2022-07-yield-findings/issues/18), and [SooYa](https://github.com/code-423n4/2022-07-yield-findings/issues/174).*\n\n## Codebase Impressions & Summary\n\n### Functionality\n\nThe revised witch (liquidation engine) contract includes the following improvements over the previous version. As stated in the README, they are:\n\n1.  Greater flexibility in exploring different liquidation models.\n2.  Making liquidations more profitable for liquidators by allowing payments in `fyToken`.\n3.  Introduce a mechanism to reward starting an auction.\n4.  Allow fine-tuning of all parameters for any collateral/underlying pair.\n5.  Correct bugs.\n\nThe liquidations flow was quite easy to follow as it consists of the following:\n\n1.  Liquidation parameters are defined by governance functions (auction duration, vault proportion, auctioneer reward etc.)\n2.  Starting an auction: `auction()`\n3.  Liquidators executing the liquidations: `payBase()` and `payFYToken()`\n4.  Either the entire vault collateral has been auctioned off, or `cancel()` is called to prematurely end the auction\n\n### Documentation\n\nThe README was very extensive and thorough, and succinctly explained design considerations made. Flow diagrams were provided to help visualise the interactions required between different contracts. Inline comments were appropriate too, aided in understanding the functionality.\n\n### Tests\n\nAll foundry tests passed as expected. One area of improvement is to have mainnet forking tests, since mocking is used for the external contracts. Running `forge coverage` unfortunately didn’t work. I suspect it is due to the instability of the feature rather than the fault of the tests.\n\n### Gas Optimizations\n\nCasting could be avoided if input / output params were defined appropriately. For instance, `inkOut`, `artIn` in `_updateAccounting()`, and `liquidatorCut` and `auctioneerCut` could have been `uint128` instead of `uint256`.\n\n## [L-01] Vaults that are over-collateralised after partial liquidation are possibly subject to further liquidations\n\nIf a vault becomes over-collateralised after a partial liquidation, it is still subject to further liquidation as the auction isn’t closed. The vault owner has to call `cancel()` himself, or trust other altruistic actors to perform this action on his behalf. Liquidators will unlikely do it because they are economically incentivised not to do so.\n\nOne can however argue that this is mitigated by the fact that protocol (governance) sets the vault proportion that can be auctioned. Regardless of whether the fact that the vault is over-collateralised after partial liquidations, the liquidators arguably are given the right to carry out further liquidations up to the proportion set.\n\nNevertheless, a reason for a revised liquidations witch contract is that “More often than not, liquidated users have lost all their collateral as we have failed to make liquidations competitive.”. Hence, it might make sense to ensure that users need not lose more collateral than necessary.\n\n### Recommended Mitigation Steps\n\nConsider checking if the vault is over-collateralized (maybe in `_updateAccounting()`) and close the auction if it is. This however adds complexity to the liquidation logic, as you have to update the cauldron first `cauldron.slurp()` before checking and updating the collateralization status. It will also break the CEI pattern, which might be unfavourable.\n\n## [L-02] Comparison in `_calcPayout()` should include equality\n\n[Witch.sol#L586](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L586)<br>\n\n### TLDR\n\n```diff\n- else if (elapsed > duration)\n+ else if (elapsed >= duration)\n```\n\n### Description\n\nIn the case where `elapsed == duration`, `proportionNow` evaluates to `1e18`, which is the same result when `elapsed > duration`. Proof below.\n\n```solidity\nproportionNow =\n  uint256(initialProportion) +\n  uint256(1e18 - initialProportion).wmul(elapsed.wdiv(duration));\n\n// = initialProportion + (1e18 - initialProportion).wmul(1e18)\n// = initialProportion + (1e18 - initialProportion) * 1e18 / 1e18\n// = initialProportion + 1e18 - initialProportion\n// = 1e18\n```\n\nOf slightly greater importance, this handles the edge case when `elapsed = duration = 0`, ie. the liquidation transaction is included in the same block / has the same timestamp as the auction initialization transaction\n\n### Recommended Mitigation Steps\n\nAs per the TLDR.\n\n### P.S. Regarding zero duration auctions\n\nSince the proportion given for zero duration auctions is `1e18`, it is equivalent to an auction of infinite duration with 100% initial offer: `duration == type(uint32).max` and `line_.initialOffer = 1e18`.\n\n## [L-03] Incorrect description for `auctioneerCut`\n\n[Witch.sol#L284](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L284)<br>\n\n[Witch.sol#L342](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L342)<br>\n\n### Description\n\nTechnically, the `auctioneerCut` goes to the `to` address specified by the auctioneer when `auction()` is called, which, while unlikely, may not be the auctioneer himself. Also, the comparison is done against the `to` address specified, not the caller / `msg.sender` as the comment implies.\n\n### Recommended Mitigation Steps\n\n```diff\n- Amount paid to whomever started the auction. 0 if it's the same address that's calling this method\n+ Amount paid to address specified by whomever started the auction. 0 if it's the same as the `to` address\n```\n\n## [L-04] Incorrect natspec for `setLimit()`\n\n[Witch.sol#L118-L122](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L118-L122)<br>\n\n### Description\n\nThe comments seem outdated as the only parameter that is updated by the function is the maximum collateral that can be concurrently auctioned off.\n\n```solidity\n///  - the auction duration to calculate liquidation prices\n///  - the proportion of the collateral that will be sold at auction start\n///  - the maximum collateral that can be auctioned at the same time\n///  - the minimum collateral that must be left when buying, unless buying all\n///  - The decimals for maximum and minimum\n```\n\n### Recommended Mitigation Steps\n\nSuggest removing / updating the referenced comments.\n\n## [N-01] Modify comment to soft limit check for clarity\n\n[Witch.sol#L194-L196](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L194-L196)<br>\n\n[Witch.sol#L200](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L200)<br>\n\n[Witch.sol#L204](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L204)<br>\n\n### Description\n\nThe limit check is done before the summation to the total collateral allowable for liquidation. One may consider this to be a bug, but the README explains why this is the case:\n\n`\nNote that the first auction to reach the limit is allowed to pass it, so that there is never the situation where a vault would be too big to ever be auctioned.\n`\n\nThe inline comments have this as well, but isn’t as clearly put as the README.\n\n```solidity\n// There is a limit on how much collateral can be concurrently put at auction, but it is a soft limit.\n// If the limit has been surpassed, no more vaults of that collateral can be put for auction.\n// This avoids the scenario where some vaults might be too large to be auctioned.\n```\n\n### Recommended Mitigation Steps\n\nFor greater clarity, I would suggesting modifying the inline comment to be worded similar as the README.\n\n```diff\n// There is a limit on how much collateral can be concurrently put at auction, but it is a soft limit.\n- // If the limit has been surpassed, no more vaults of that collateral can be put for auction.\n+ // The first auction to reach or exceed the limit is allowed to pass it, but subsequently, no more vaults of that collateral can be put for auction.\n// This avoids the scenario where some vaults might be too large to be auctioned.\n```\n\n## [N-02] Typos\n\n```diff\n- bellow\n+ below\n\n- differente\n+ different\n\n// Extra spacing\n- The Join  then dishes out\n+ The Join then dishes out\n\n- quoutes hoy much ink\n+ quotes how much ink\n```\n\n**[alcueca (Yield) confirmed and commented](https://github.com/code-423n4/2022-07-yield-findings/issues/33#issuecomment-1192606755):**\n > This is a great QA report :heart: \n\n**[PierrickGT (judge) commented](https://github.com/code-423n4/2022-07-yield-findings/issues/33#issuecomment-1213319030):**\n > Best QA report of this contest with clear description of the problems and comprehensive suggestions provided.\n> \n> **[L-01] Vaults that are over-collateralised after partial liquidation are possibly subject to further liquidations**<br>\n> \n> Great suggestion and explanation of the risks induced by the smart contract architecture and design of the Witch contract.\n> As mentioned by the warden, their suggestion may complexify the code but they did a good job of outlining the risks and the sponsor can now decide to implement or not the suggestion.\n> \n> **[L-02] Comparison in _calcPayout() should include equality**<br>\n> \n> Great find and recommendation that will cover the edge case when `elapsed = duration = 0`.\n> \n> **[L-03] Incorrect description for auctioneerCut**<br>\n> \n> The comment was indeed not entirely clear and the suggestion provided by the warden should avoid any confusion in the future.\n> \n> **[L-04] Incorrect natspec for setLimit()**<br>\n> \n> Good recommendation, it's always best to write up to date Natspect documentations to avoid any confusion during a future refactor of the code.\n> \n> **[N-01] Modify comment to soft limit check for clarity**<br>\n> \n> Not critical, but the suggestion from the warden adds a bit of clarity to the comment.\n> \n> **[N-02] Typos**<br>\n> \n> It's always best to avoid typos in the documentation of the code.\n\n\n\n***\n\n# Gas Optimizations\n\nFor this contest, 50 reports were submitted by wardens detailing gas optimizations. The [report highlighted below](https://github.com/code-423n4/2022-07-yield-findings/issues/47) by **IllIllI** received the top score from the judge.\n\n*The following wardens also submitted reports: [hake](https://github.com/code-423n4/2022-07-yield-findings/issues/26), [Meera](https://github.com/code-423n4/2022-07-yield-findings/issues/99), [antonttc](https://github.com/code-423n4/2022-07-yield-findings/issues/117), [joestakey](https://github.com/code-423n4/2022-07-yield-findings/issues/60), [m&#95;Rassska](https://github.com/code-423n4/2022-07-yield-findings/issues/56), [csanuragjain](https://github.com/code-423n4/2022-07-yield-findings/issues/148), [TomJ](https://github.com/code-423n4/2022-07-yield-findings/issues/92), [gogo](https://github.com/code-423n4/2022-07-yield-findings/issues/113), [rbserver](https://github.com/code-423n4/2022-07-yield-findings/issues/97), [Limbooo](https://github.com/code-423n4/2022-07-yield-findings/issues/137), [MadWookie](https://github.com/code-423n4/2022-07-yield-findings/issues/173), [hickuphh3](https://github.com/code-423n4/2022-07-yield-findings/issues/34), [kyteg](https://github.com/code-423n4/2022-07-yield-findings/issues/78), [ak1](https://github.com/code-423n4/2022-07-yield-findings/issues/98), [0xKitsune](https://github.com/code-423n4/2022-07-yield-findings/issues/79), [defsec](https://github.com/code-423n4/2022-07-yield-findings/issues/149), [Waze](https://github.com/code-423n4/2022-07-yield-findings/issues/49), [ElKu](https://github.com/code-423n4/2022-07-yield-findings/issues/95), [samruna](https://github.com/code-423n4/2022-07-yield-findings/issues/2), [c3phas](https://github.com/code-423n4/2022-07-yield-findings/issues/145), [JC](https://github.com/code-423n4/2022-07-yield-findings/issues/170), [rajatbeladiya](https://github.com/code-423n4/2022-07-yield-findings/issues/38), [cRat1st0s](https://github.com/code-423n4/2022-07-yield-findings/issues/71), [JohnSmith](https://github.com/code-423n4/2022-07-yield-findings/issues/51), [robee](https://github.com/code-423n4/2022-07-yield-findings/issues/14), [sashik&#95;eth](https://github.com/code-423n4/2022-07-yield-findings/issues/156), [&#95;&#95;141345&#95;&#95;](https://github.com/code-423n4/2022-07-yield-findings/issues/77), [simon135](https://github.com/code-423n4/2022-07-yield-findings/issues/120), [Aymen0909](https://github.com/code-423n4/2022-07-yield-findings/issues/152), [fatherOfBlocks](https://github.com/code-423n4/2022-07-yield-findings/issues/20), [Deivitto](https://github.com/code-423n4/2022-07-yield-findings/issues/162), [tofunmi](https://github.com/code-423n4/2022-07-yield-findings/issues/29), [0xNazgul](https://github.com/code-423n4/2022-07-yield-findings/issues/41), [ajtra](https://github.com/code-423n4/2022-07-yield-findings/issues/151), [0x1f8b](https://github.com/code-423n4/2022-07-yield-findings/issues/61), [ReyAdmirado](https://github.com/code-423n4/2022-07-yield-findings/issues/32), [pashov](https://github.com/code-423n4/2022-07-yield-findings/issues/59), [bulej93](https://github.com/code-423n4/2022-07-yield-findings/issues/68), [Trumpero](https://github.com/code-423n4/2022-07-yield-findings/issues/104), [Sm4rty](https://github.com/code-423n4/2022-07-yield-findings/issues/125), [Rohan16](https://github.com/code-423n4/2022-07-yield-findings/issues/131), [rokinot](https://github.com/code-423n4/2022-07-yield-findings/issues/165), [ignacio](https://github.com/code-423n4/2022-07-yield-findings/issues/9), [durianSausage](https://github.com/code-423n4/2022-07-yield-findings/issues/45), [0x29A](https://github.com/code-423n4/2022-07-yield-findings/issues/65), [karanctf](https://github.com/code-423n4/2022-07-yield-findings/issues/101), [Kaiziron](https://github.com/code-423n4/2022-07-yield-findings/issues/167), [Chom](https://github.com/code-423n4/2022-07-yield-findings/issues/143), and [SooYa](https://github.com/code-423n4/2022-07-yield-findings/issues/168).*\n\n## Summary\n\n|        | Issue                                                                                                                      | Instances |\n| ------ | :------------------------------------------------------------------------------------------------------------------------- | :-------: |\n| [G‑01] | Multiple `address`/ID mappings can be combined into a single `mapping` of an `address`/ID to a `struct`, where appropriate |     1     |\n| [G‑02] | Using `storage` instead of `memory` for structs/arrays saves gas                                                           |     1     |\n| [G‑03] | The result of external function calls should be cached rather than re-calling the function                                 |     3     |\n| [G‑04] | Optimize names to save gas                                                                                                 |     1     |\n| [G‑05] | Using `bool`s for storage incurs overhead                                                                                  |     2     |\n| [G‑06] | `>=` costs less gas than `>`                                                                                               |     3     |\n| [G‑07] | Usage of `uints`/`ints` smaller than 32 bytes (256 bits) incurs overhead                                                   |     2     |\n| [G‑08] | `require()` or `revert()` statements that check input arguments should be at the top of the function                       |     1     |\n| [G‑09] | Use custom errors rather than `revert()`/`require()` strings to save gas                                                   |     17    |\n| [G‑10] | Functions guaranteed to revert when called by normal users can be marked `payable`                                         |     6     |\n\nTotal: 37 instances over 10 issues\n\n## \\[G‑01]  Multiple `address`/ID mappings can be combined into a single `mapping` of an `address`/ID to a `struct`, where appropriate\n\nSaves a storage slot for the mapping. Depending on the circumstances and sizes of types, can avoid a Gsset (**20000 gas**) per mapping combined. Reads and subsequent writes can also be cheaper when a function requires both values and they both fit in the same storage slot. Finally, if both fields are accessed in the same function, can save **\\~42 gas per access** due to [not having to recalculate the key's keccak256 hash](https://gist.github.com/IllIllI000/ec23a57daa30a8f8ca8b9681c8ccefb0) (Gkeccak256 - 30 gas) and that calculation's associated stack operations.\n\n*There is 1 instance of this issue:*\n\n```solidity\nFile: contracts/Witch.sol\n\n66        mapping(bytes6 => mapping(bytes6 => DataTypes.Line)) public lines;\n67        mapping(bytes6 => mapping(bytes6 => DataTypes.Limits)) public limits;\n68        mapping(address => bool) public otherWitches;\n69:       mapping(bytes6 => mapping(bytes6 => bool)) public ignoredPairs;\n\n```\n\n[Witch.sol#L66-L69](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L66-L69)<br>\n\n## \\[G‑02]  Using `storage` instead of `memory` for structs/arrays saves gas\n\nWhen fetching data from a storage location, assigning the data to a `memory` variable causes all fields of the struct/array to be read from storage, which incurs a Gcoldsload (**2100 gas**) for *each* field of the struct/array. If the fields are read from the new memory variable, they incur an additional `MLOAD` rather than a cheap stack read. Instead of declearing the variable with the `memory` keyword, declaring the variable with the `storage` keyword and caching any fields that need to be re-read in stack variables, will be much cheaper, only incuring the Gcoldsload for the fields actually read. The only time it makes sense to read the whole struct/array into a `memory` variable, is if the full struct/array is being returned by the function, is being passed to a function that requires `memory`, or if the array/struct is being read from another `memory` array/struct\n\n*There is 1 instance of this issue:*\n\n```solidity\nFile: contracts/Witch.sol\n\n197           DataTypes.Limits memory limits_ = limits[vault.ilkId][\n198               series.baseId\n199:          ];\n\n```\n\n[Witch.sol#L197-L199](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L197-L199)<br>\n\n```diff\ndiff --git a/contracts/Witch.sol b/contracts/Witch.sol\nindex f98dd6a..ccf9822 100644\n--- a/contracts/Witch.sol\n+++ b/contracts/Witch.sol\n@@ -194,15 +194,15 @@ contract Witch is AccessControl {\n         // There is a limit on how much collateral can be concurrently put at auction, but it is a soft limit.\n         // If the limit has been surpassed, no more vaults of that collateral can be put for auction.\n         // This avoids the scenario where some vaults might be too large to be auctioned.\n-        DataTypes.Limits memory limits_ = limits[vault.ilkId][\n+        DataTypes.Limits storage limits_ = limits[vault.ilkId][\n             series.baseId\n         ];\n-        require(limits_.sum <= limits_.max, \"Collateral limit reached\");\n+        uint128 lsum_ = limits_.sum;\n+        require(lsum_ <= limits_.max, \"Collateral limit reached\");\n \n         auction_ = _calcAuction(vault, series, to, balances, debt);\n \n-        limits_.sum += auction_.ink;\n-        limits[vault.ilkId][series.baseId] = limits_;\n+        limits_.sum = lsum_ + auction_.ink;\n \n         auctions[vaultId] = auction_;\n \n```\n\n```diff\ndiff --git a/gas_before b/gas_after\nindex 68d894d..749b496 100644\n--- a/gas_before\n+++ b/gas_after\n@@ -3,11 +3,11 @@\n ╞════════════════════════════════════╪═════════════════╪═══════╪════════╪═══════╪═════════╡\n │ Deployment Cost                    ┆ Deployment Size ┆       ┆        ┆       ┆         │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n-│ 3076398                            ┆ 15658           ┆       ┆        ┆       ┆         │\n+│ 3062982                            ┆ 15591           ┆       ┆        ┆       ┆         │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n │ Function Name                      ┆ min             ┆ avg   ┆ median ┆ max   ┆ # calls │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n-│ auction                            ┆ 4219            ┆ 70111 ┆ 81848  ┆ 91148 ┆ 30      │\n+│ auction                            ┆ 4219            ┆ 69956 ┆ 81665  ┆ 90965 ┆ 30      │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n │ auctioneerReward                   ┆ 426             ┆ 426   ┆ 426    ┆ 426   ┆ 1       │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n```\n\n## \\[G‑03]  The result of a function call should be cached rather than re-calling the function\n\nThe instances below point to the second+ call of the function within a single function\n\n*There are 3 instances of this issue:*\n\n```solidity\nFile: contracts/Witch.sol\n\n/// @audit inkOut.u128()\n450:                  limits_.sum -= inkOut.u128();\n\n/// @audit inkOut.u128()\n/// @audit artIn.u128()\n458:          cauldron.slurp(vaultId, inkOut.u128(), artIn.u128());\n\n```\n\n[Witch.sol#L450](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L450)<br>\n\n```diff\ndiff --git a/contracts/Witch.sol b/contracts/Witch.sol\nindex f98dd6a..c2196e8 100644\n--- a/contracts/Witch.sol\n+++ b/contracts/Witch.sol\n@@ -421,6 +421,7 @@ contract Witch is AccessControl {\n         ];\n \n         // Update local auction\n+        uint128 io128_;\n         {\n             if (auction_.art == artIn) {\n                 // If there is no debt left, return the vault with the collateral to the owner\n@@ -428,6 +429,7 @@ contract Witch is AccessControl {\n \n                 // Update limits - reduce it by the whole auction\n                 limits_.sum -= auction_.ink;\n+                io128_ = inkOut.u128();\n             } else {\n                 // Ensure enough dust is left\n                 DataTypes.Debt memory debt = cauldron.debt(\n@@ -439,15 +441,16 @@ contract Witch is AccessControl {\n                     \"Leaves dust\"\n                 );\n \n+                io128_ = inkOut.u128();\n                 // Update the auction\n-                auction_.ink -= inkOut.u128();\n+                auction_.ink -= io128_;\n                 auction_.art -= artIn.u128();\n \n                 // Store auction changes\n                 auctions[vaultId] = auction_;\n \n                 // Update limits - reduce it by whatever was bought\n-                limits_.sum -= inkOut.u128();\n+                limits_.sum -= io128_;\n             }\n         }\n \n@@ -455,7 +458,7 @@ contract Witch is AccessControl {\n         limits[auction_.ilkId][auction_.baseId] = limits_;\n \n         // Update accounting at Cauldron\n-        cauldron.slurp(vaultId, inkOut.u128(), artIn.u128());\n+        cauldron.slurp(vaultId, io128_, artIn.u128());\n     }\n \n     /// @dev Logs that a certain amount of a vault was liquidated\n```\n\n```diff\ndiff --git a/gas_before b/gas_after\nindex 68d894d..7867bad 100644\n--- a/gas_before\n+++ b/gas_after\n@@ -3,7 +3,7 @@\n ╞════════════════════════════════════╪═════════════════╪═══════╪════════╪═══════╪═════════╡\n │ Deployment Cost                    ┆ Deployment Size ┆       ┆        ┆       ┆         │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n-│ 3076398                            ┆ 15658           ┆       ┆        ┆       ┆         │\n+│ 3075198                            ┆ 15652           ┆       ┆        ┆       ┆         │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n │ Function Name                      ┆ min             ┆ avg   ┆ median ┆ max   ┆ # calls │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n@@ -29,9 +29,9 @@\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n │ otherWitches                       ┆ 570             ┆ 570   ┆ 570    ┆ 570   ┆ 1       │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n-│ payBase                            ┆ 7632            ┆ 20431 ┆ 22355  ┆ 26694 ┆ 10      │\n+│ payBase                            ┆ 7632            ┆ 20373 ┆ 22357  ┆ 26544 ┆ 10      │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n-│ payFYToken                         ┆ 7507            ┆ 19219 ┆ 20648  ┆ 27910 ┆ 10      │\n+│ payFYToken                         ┆ 7504            ┆ 19161 ┆ 20654  ┆ 27760 ┆ 10      │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n │ point                              ┆ 2934            ┆ 5098  ┆ 2942   ┆ 9420  ┆ 3       │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n\n```\n\n## \\[G‑04]  Optimize names to save gas\n\n`public`/`external` function names and `public` member variable names can be optimized to save gas. See [this](https://gist.github.com/IllIllI000/a5d8b486a8259f9f77891a919febd1a9) link for an example of how it works. Below are the interfaces/abstract contracts that can be optimized so that the most frequently-called functions use the least amount of gas possible during method lookup. Method IDs that have two leading zero bytes can save **128 gas** each during deployment, and renaming functions to have lower method IDs will save **22 gas** per call, [per sorted position shifted](https://medium.com/joyso/solidity-how-does-function-name-affect-gas-consumption-in-smart-contract-47d270d8ac92).\n\n*There is 1 instance of this issue:*\n\n```solidity\nFile: contracts/Witch.sol\n\n/// @audit point(), setLine(), setLimit(), setAnotherWitch(), setIgnoredPair(), setAuctioneerReward(), auction(), cancel(), payBase(), payFYToken(), calcPayout()\n19:   contract Witch is AccessControl {\n\n```\n\n[Witch.sol#L19](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L19)<br>\n\n## \\[G‑05]  Using `bool`s for storage incurs overhead\n\n```solidity\n    // Booleans are more expensive than uint256 or any type that takes up a full\n    // word because each write operation emits an extra SLOAD to first read the\n    // slot's contents, replace the bits taken up by the boolean, and then write\n    // back. This is the compiler's defense against contract upgrades and\n    // pointer aliasing, and it cannot be disabled.\n```\n\n[OpenZeppelin/ReentrancyGuard.sol#L23-L27](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/58f635312aa21f947cae5f8578638a85aa2519f5/contracts/security/ReentrancyGuard.sol#L23-L27)<br>\nUse `uint256(1)` and `uint256(2)` for true/false to avoid a Gwarmaccess (**[100 gas](https://gist.github.com/IllIllI000/1b70014db712f8572a72378321250058)**) for the extra SLOAD, and to avoid Gsset (**20000 gas**) when changing from `false` to `true`, after having been `true` in the past\n\n*There are 2 instances of this issue:*\n\n```solidity\nFile: contracts/Witch.sol\n\n68:       mapping(address => bool) public otherWitches;\n\n69:       mapping(bytes6 => mapping(bytes6 => bool)) public ignoredPairs;\n\n```\n\n[Witch.sol#L68](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L68)<br>\n\n## \\[G‑06]  `>=` costs less gas than `>`\n\nThe compiler uses opcodes `GT` and `ISZERO` for solidity code that uses `>`, but only requires `LT` for `>=`, [which saves **3 gas**](https://gist.github.com/IllIllI000/3dc79d25acccfa16dee4e83ffdc6ffde)\n\n*There are 3 instances of this issue:*\n\n```solidity\nFile: contracts/Witch.sol\n\n308:          artIn = artIn > auction_.art ? auction_.art : artIn;\n\n361:          artIn = maxArtIn > auction_.art ? auction_.art : maxArtIn;\n\n556:          artIn = maxArtIn > auction_.art ? auction_.art : maxArtIn;\n\n```\n\n[Witch.sol#L308](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L308)<br>\n\n## \\[G‑07]  Usage of `uints`/`ints` smaller than 32 bytes (256 bits) incurs overhead\n\n> When using elements that are smaller than 32 bytes, your contract’s gas usage may be higher. This is because the EVM operates on 32 bytes at a time. Therefore, if the element is smaller than that, the EVM must use more operations in order to reduce the size of the element from 32 bytes to the desired size.\n\n<https://docs.soliditylang.org/en/v0.8.11/internals/layout_in_storage.html><br>\nEach operation involving a `uint8` costs an extra [**28 gas**](https://gist.github.com/IllIllI000/9388d20c70f9a4632eb3ca7836f54977) as compared to ones involving `uint256`, due to the compiler having to clear the higher bits of the memory word before operating on the `uint8`, as well as the associated stack operations of doing so. Use a larger size then downcast where needed\n\n*There are 2 instances of this issue:*\n\n```solidity\nFile: contracts/Witch.sol\n\n/// @audit uint128 art\n233:          if (art < debt.min * (10**debt.dec)) art = balances.art;\n\n/// @audit uint128 artIn\n308:          artIn = artIn > auction_.art ? auction_.art : artIn;\n\n```\n\n[Witch.sol#L233](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L233)<br>\n\n```diff\ndiff --git a/contracts/Witch.sol b/contracts/Witch.sol\nindex f98dd6a..066e912 100644\n--- a/contracts/Witch.sol\n+++ b/contracts/Witch.sol\n@@ -229,11 +229,11 @@ contract Witch is AccessControl {\n     ) internal view returns (DataTypes.Auction memory) {\n         // We store the proportion of the vault to auction, which is the whole vault if the debt would be below dust.\n         DataTypes.Line storage line = lines[vault.ilkId][series.baseId];\n-        uint128 art = uint256(balances.art).wmul(line.proportion).u128();\n+        uint256 art = uint256(balances.art).wmul(line.proportion);\n         if (art < debt.min * (10**debt.dec)) art = balances.art;\n-        uint128 ink = (art == balances.art)\n+        uint256 ink = (art == balances.art)\n             ? balances.ink\n-            : uint256(balances.ink).wmul(line.proportion).u128();\n+            : uint256(balances.ink).wmul(line.proportion);\n \n         return\n             DataTypes.Auction({\n@@ -242,8 +242,8 @@ contract Witch is AccessControl {\n                 seriesId: vault.seriesId,\n                 baseId: series.baseId,\n                 ilkId: vault.ilkId,\n-                art: art,\n-                ink: ink,\n+                art: art.u128(),\n+                ink: ink.u128(),\n                 auctioneer: to\n             });\n     }\n```\n\n```diff\ndiff --git a/gas_before b/gas_after\nindex 68d894d..4f7212a 100644\n--- a/gas_before\n+++ b/gas_after\n@@ -3,17 +3,17 @@\n ╞════════════════════════════════════╪═════════════════╪═══════╪════════╪═══════╪═════════╡\n │ Deployment Cost                    ┆ Deployment Size ┆       ┆        ┆       ┆         │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n-│ 3076398                            ┆ 15658           ┆       ┆        ┆       ┆         │\n+│ 3077398                            ┆ 15663           ┆       ┆        ┆       ┆         │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n │ Function Name                      ┆ min             ┆ avg   ┆ median ┆ max   ┆ # calls │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n-│ auction                            ┆ 4219            ┆ 70111 ┆ 81848  ┆ 91148 ┆ 30      │\n+│ auction                            ┆ 4219            ┆ 70086 ┆ 81815  ┆ 91115 ┆ 30      │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n │ auctioneerReward                   ┆ 426             ┆ 426   ┆ 426    ┆ 426   ┆ 1       │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n │ auctions                           ┆ 1244            ┆ 1244  ┆ 1244   ┆ 1244  ┆ 20      │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n-│ calcPayout                         ┆ 3627            ┆ 10420 ┆ 14603  ┆ 19151 ┆ 29      │\n+│ calcPayout                         ┆ 3627            ┆ 10415 ┆ 14603  ┆ 19118 ┆ 29      │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n │ cancel                             ┆ 2736            ┆ 9683  ┆ 5675   ┆ 20639 ┆ 3       │\n ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌┤\n\n```\n\n## \\[G‑08]  `require()` or `revert()` statements that check input arguments should be at the top of the function\n\nChecks that involve constants should come before checks that involve state variables, function calls, and calculations. By doing these checks first, the function is able to revert before wasting a Gcoldsload (**2100 gas**&ast;) in a function that may ultimately revert in the unhappy case.\n\n*There is 1 instance of this issue:*\n\n```solidity\nFile: contracts/Witch.sol\n\n/// @audit expensive op on line 105\n108:          require(proportion >= 0.01e18, \"Proportion below 1%\");\n\n```\n\n[Witch.sol#L108](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L108)<br>\n\n## \\[G‑09]  Use custom errors rather than `revert()`/`require()` strings to save gas\n\nCustom errors are available from solidity version 0.8.4. Custom errors save [**\\~50 gas**](https://gist.github.com/IllIllI000/ad1bd0d29a0101b25e57c293b4b0c746) each time they're hit by [avoiding having to allocate and store the revert string](https://blog.soliditylang.org/2021/04/21/custom-errors/#errors-in-depth). Not defining the strings also save deployment gas\n\n*There are 17 instances of this issue:*\n\n```solidity\nFile: contracts/Witch.sol\n\n84:           require(param == \"ladle\", \"Unrecognized\");\n\n102:          require(initialOffer <= 1e18, \"InitialOffer above 100%\");\n\n103:          require(proportion <= 1e18, \"Proportion above 100%\");\n\n104           require(\n105               initialOffer == 0 || initialOffer >= 0.01e18,\n106               \"InitialOffer below 1%\"\n107:          );\n\n108:          require(proportion >= 0.01e18, \"Proportion below 1%\");\n\n189:          require(cauldron.level(vaultId) < 0, \"Not undercollateralized\");\n\n200:          require(limits_.sum <= limits_.max, \"Collateral limit reached\");\n\n255:          require(auction_.start > 0, \"Vault not under auction\");\n\n256:          require(cauldron.level(vaultId) >= 0, \"Undercollateralized\");\n\n300:          require(auction_.start > 0, \"Vault not under auction\");\n\n313:          require(liquidatorCut >= minInkOut, \"Not enough bought\");\n\n328:              require(baseJoin != IJoin(address(0)), \"Join not found\");\n\n358:          require(auction_.start > 0, \"Vault not under auction\");\n\n365:          require(liquidatorCut >= minInkOut, \"Not enough bought\");\n\n395:              require(ilkJoin != IJoin(address(0)), \"Join not found\");\n\n416:          require(auction_.start > 0, \"Vault not under auction\");\n\n437                   require(\n438                       auction_.art - artIn >= debt.min * (10**debt.dec),\n439                       \"Leaves dust\"\n440:                  );\n\n```\n\n[Witch.sol#L84](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L84)<br>\n\n## \\[G‑10]  Functions guaranteed to revert when called by normal users can be marked `payable`\n\nIf a function modifier such as `onlyOwner` is used, the function will revert if a normal user tries to pay the function. Marking the function as `payable` will lower the gas cost for legitimate callers because the compiler will not include checks for whether a payment was provided. The extra opcodes avoided are\n`CALLVALUE`(2),`DUP1`(3),`ISZERO`(3),`PUSH2`(3),`JUMPI`(10),`PUSH1`(3),`DUP1`(3),`REVERT`(0),`JUMPDEST`(1),`POP`(2), which costs an average of about **21 gas per call** to the function, in addition to the extra deployment cost.\n\n*There are 6 instances of this issue:*\n\n```solidity\nFile: contracts/Witch.sol\n\n83:       function point(bytes32 param, address value) external auth {\n\n95        function setLine(\n96            bytes6 ilkId,\n97            bytes6 baseId,\n98            uint32 duration,\n99            uint64 proportion,\n100           uint64 initialOffer\n101:      ) external auth {\n\n126       function setLimit(\n127           bytes6 ilkId,\n128           bytes6 baseId,\n129           uint128 max\n130:      ) external auth {\n\n141:      function setAnotherWitch(address value, bool isWitch) external auth {\n\n150       function setIgnoredPair(\n151           bytes6 ilkId,\n152           bytes6 baseId,\n153           bool ignore\n154:      ) external auth {\n\n161:      function setAuctioneerReward(uint128 auctioneerReward_) external auth {\n\n```\n\n[Witch.sol#L83](https://github.com/code-423n4/2022-07-yield/blob/6ab092b8c10e4dabb470918ae15c6451c861655f/contracts/Witch.sol#L83)<br>\n\n\n\n***\n\n# Disclosures\n\nC4 is an open organization governed by participants in the community.\n\nC4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.\n\nC4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.\n"
}