{
  "circa": {
    "title": "Canto v2 contest",
    "sponsor": "Canto",
    "slug": "2022-06-canto-v2",
    "date": "2022-10-18",
    "findings": "https://github.com/code-423n4/2022-06-canto-v2-findings/issues",
    "contest": 141
  },
  "html": "<h1 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h1>\n<h2 id=\"about-c4\" style=\"position:relative;\"><a href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>About C4</h2>\n<p>Code4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.</p>\n<p>A C4 audit contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.</p>\n<p>During the audit contest outlined in this document, C4 conducted an analysis of the Canto v2 smart contract system written in Solidity. The audit contest took place between June 28—July 2 2022.</p>\n<p><em>Note: this audit contest originally ran under the name <code>New Blockchain v2</code>.</em></p>\n<h2 id=\"wardens\" style=\"position:relative;\"><a href=\"#wardens\" aria-label=\"wardens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wardens</h2>\n<p>51 Wardens contributed reports to the Canto v2 contest:</p>\n<ol>\n<li><a href=\"https://twitter.com/thePicodes\">Picodes</a></li>\n<li>0x1f8b</li>\n<li>ladboy233</li>\n<li>__141345__</li>\n<li>Lambda</li>\n<li>Critical</li>\n<li><a href=\"https://chom.dev\">Chom</a></li>\n<li>cccz</li>\n<li><a href=\"https://twitter.com/defsec_\">defsec</a></li>\n<li><a href=\"https://twitter.com/csanuragjain\">csanuragjain</a></li>\n<li>0x52</li>\n<li><a href=\"https://mobile.twitter.com/tomj_bb\">TomJ</a></li>\n<li><a href=\"https://www.instagram.com/riyan_rfa/\">rfa</a></li>\n<li><a href=\"https://instagram.com/vanensurya\">Funen</a></li>\n<li>Bnke0x0</li>\n<li>0x29A (0x4non and rotcivegaf)</li>\n<li><a href=\"https://twitter.com/c3ph_\">c3phas</a></li>\n<li><a href=\"https://twitter.com/father0fBl0cks\">fatherOfBlocks</a></li>\n<li>Soosh</li>\n<li><a href=\"https://twitter.com/ynnadt1\">ynnad</a></li>\n<li><a href=\"https://github.com/grGred\">grGred</a></li>\n<li><a href=\"https://veranos.io\">mrpathfindr</a></li>\n<li><a href=\"https://twitter.com/Sm4rty_\">Sm4rty</a></li>\n<li>slywaters</li>\n<li><a href=\"https://twitter.com/0xheynacho\">ignacio</a></li>\n<li>sach1r0</li>\n<li>samruna</li>\n<li><a href=\"https://twitter.com/_0v3rf10w\">0v3rf10w</a></li>\n<li>asutorufos</li>\n<li><a href=\"https://t.me/Road220\">m_Rassska</a></li>\n<li>Waze</li>\n<li><a href=\"https://github.com/0xarshia\">0xArshia</a></li>\n<li>ajtra</li>\n<li><a href=\"https://github.com/lyciumlee\">durianSausage</a></li>\n<li><a href=\"https://twitter.com/fitraldys\">Fitraldys</a></li>\n<li>Noah3o6</li>\n<li>RedOneN</li>\n<li><a href=\"https://twitter.com/ROHANJH56009256\">Rohan16</a></li>\n<li>zzzitron</li>\n<li><a href=\"https://twitter.com/andyfeili\">oyc_109</a></li>\n<li>AlleyCat</li>\n<li>Meera</li>\n<li><a href=\"https://github.com/0xKitsune\">0xKitsune</a></li>\n<li>TerrierLover</li>\n<li><a href=\"https://twitter.com/sm4rtcontr4ct\">JC</a></li>\n<li>hake</li>\n<li>aysha</li>\n<li>Limbooo</li>\n<li><a href=\"https://twitter.com/meidhiwirara\">Tomio</a></li>\n<li>cRat1st0s</li>\n</ol>\n<p>This contest was judged by <a href=\"https://twitter.com/GalloDaSballo\">Alex the Entreprenerd</a>.</p>\n<p>Final report assembled by <a href=\"https://twitter.com/liveactionllama\">liveactionllama</a>.</p>\n<h1 id=\"summary\" style=\"position:relative;\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h1>\n<p>The C4 analysis yielded an aggregated total of 14 unique vulnerabilities. Of these vulnerabilities, 8 received a risk rating in the category of HIGH severity and 6 received a risk rating in the category of MEDIUM severity.</p>\n<p>Additionally, C4 analysis included 34 reports detailing issues with a risk rating of LOW severity or non-critical. There were also 34 reports recommending gas optimizations.</p>\n<p>All of the issues presented here are linked back to their original finding.</p>\n<h1 id=\"scope\" style=\"position:relative;\"><a href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scope</h1>\n<p>The code under review can be found within the <a href=\"https://github.com/code-423n4/2022-06-canto-v2\">C4 Canto v2 contest repository</a>, and is composed of 15 smart contracts written in the Solidity programming language and includes 2,459 lines of Solidity code. One Cosmos SDK blockchain is also included.</p>\n<h1 id=\"severity-criteria\" style=\"position:relative;\"><a href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Severity Criteria</h1>\n<p>C4 assesses the severity of disclosed vulnerabilities according to a methodology based on <a href=\"https://owasp.org/www-community/OWASP_Risk_Rating_Methodology\">OWASP standards</a>.</p>\n<p>Vulnerabilities are divided into three primary risk categories: high, medium, and low/non-critical.</p>\n<p>High-level considerations for vulnerabilities span the following key areas when conducting assessments:</p>\n<ul>\n<li>Malicious Input Handling</li>\n<li>Escalation of privileges</li>\n<li>Arithmetic</li>\n<li>Gas use</li>\n</ul>\n<p>Further information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on <a href=\"https://code4rena.com\">the C4 website</a>.</p>\n<h1 id=\"high-risk-findings-8\" style=\"position:relative;\"><a href=\"#high-risk-findings-8\" aria-label=\"high risk findings 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>High Risk Findings (8)</h1>\n<h2 id=\"h-01-total-supply-can-be-incorrect-in-erc20\" style=\"position:relative;\"><a href=\"#h-01-total-supply-can-be-incorrect-in-erc20\" aria-label=\"h 01 total supply can be incorrect in erc20 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/88\">[H-01] Total supply can be incorrect in <code>ERC20</code></a></h2>\n<p><em>Submitted by Picodes</em></p>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/ERC20.sol#L33\">https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/ERC20.sol#L33</a>\n<a href=\"https://github.com/Plex-Engineer/lending-market/blob/ab31a612be354e252d72faead63d86b844172761/contracts/ERC20.sol#L95\">https://github.com/Plex-Engineer/lending-market/blob/ab31a612be354e252d72faead63d86b844172761/contracts/ERC20.sol#L95</a></p>\n<p><code>_totalSupply</code> can be initialized to something different than 0, which would lead to an inaccurate total supply, and could easily break integrations, computations of market cap, etc.</p>\n<h3 id=\"proof-of-concept\" style=\"position:relative;\"><a href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>If the constructor is called with _initialSupply = 1000, the <code>totalSupply</code> will be initialized to 1000.</p>\n<p>As all the others computations are correct, there will be for ever a discrepancy of 1000 between the real total supply and the one of the contract.</p>\n<h3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Remove <code>_initialSupply</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/88\">nivasan1 (Canto) acknowledged</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/88#issuecomment-1214474058\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Same bug as from Canto V1.\nRecommend the sponsor to just set to 0 and remove the assignment from the constructor</p>\n<p>See: <a href=\"https://github.com/code-423n4/2022-06-canto-findings/issues/108\">https://github.com/code-423n4/2022-06-canto-findings/issues/108</a></p>\n</blockquote>\n<p><strong>Please note: the following additional discussions took place after judging and awarding were finalized. As such, this report will leave this finding in its originally assessed risk category as it simply reflects a snapshot in time.</strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/88#issuecomment-1236024995\">shung (warden) commented</a>:</strong></p>\n<blockquote>\n<p>In the provided contracts, v2 repo is included: <a href=\"https://github.com/code-423n4/2022-06-canto-v2\">https://github.com/code-423n4/2022-06-canto-v2</a></p>\n<p>However, in this submission, the second line of code provided links to the v1 repo. The described issue only exists in v1 version. In v2 version the issue does not exist because msg.sender balance is updated along with the total supply: <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/ERC20.sol#L34\">https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/ERC20.sol#L34</a></p>\n<p>Therefore this finding seems invalid.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/88#issuecomment-1236132294\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>@shung - You’re right, I must have missed the line with the mitigation.</p>\n<p>The current code will update the <code>_totalSupply</code> and will give the balance to the deployer.</p>\n<p>This is a mistake on my part and the finding should have been closed as invalid as it was mitigated in the V2 code in scope.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/88#issuecomment-1236133140\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>While a nitpick I’d recommend changing the code to use <code>_mint</code> as it the code in scope will not emit an event which may cause issues if you’re tracking via theGraph or similar.</p>\n<p>Either way I made a mistake here, sorry about that.</p>\n</blockquote>\n<hr>\n<h2 id=\"h-02-deny-of-service-in-cnotedotransferout\" style=\"position:relative;\"><a href=\"#h-02-deny-of-service-in-cnotedotransferout\" aria-label=\"h 02 deny of service in cnotedotransferout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/43\">[H-02] Deny of service in <code>CNote.doTransferOut</code></a></h2>\n<p><em>Submitted by 0x1f8b, also found by Lambda</em></p>\n<p><a href=\"https://github.dev/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/CNote.sol#L148\">https://github.dev/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/CNote.sol#L148</a><br></p>\n<p>The <code>CNote.doTransferOut</code> method is susceptible to denial of service.</p>\n<h3 id=\"proof-of-concept-1\" style=\"position:relative;\"><a href=\"#proof-of-concept-1\" aria-label=\"proof of concept 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>The logic of the <code>doTransferOut</code> method in <code>CNote</code> is as follows:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">doTransferOut</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">payable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">) </span><span class=\"mtk11\">virtual</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_accountant</span><span class=\"mtk1\">) != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">EIP20Interface</span><span class=\"mtk1\"> </span><span class=\"mtk12\">token</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">EIP20Interface</span><span class=\"mtk1\">(</span><span class=\"mtk12\">underlying</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">to</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_accountant</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">err</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_accountant</span><span class=\"mtk1\">.</span><span class=\"mtk11\">supplyMarket</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">err</span><span class=\"mtk1\"> != </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) { </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">AccountantRedeemError</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\">); }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }   </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">success</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">assembly</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">switch</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returndatasize</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">case</span><span class=\"mtk1\"> </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> { success := </span><span class=\"mtk11\">not</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">) }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">case</span><span class=\"mtk1\"> </span><span class=\"mtk7\">32</span><span class=\"mtk1\"> { </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk11\">returndatacopy</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk7\">32</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    success := </span><span class=\"mtk11\">mload</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">default</span><span class=\"mtk1\"> { </span><span class=\"mtk11\">revert</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">success</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;TOKEN_TRANSFER_OUT_FAILED&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">token</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">)) == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;cNote::doTransferOut: TransferOut Failed&quot;</span><span class=\"mtk1\">); </span><span class=\"mtk3\">// &lt;-- ERROR</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>The <code>doTransferOut</code> method receives an <code>amount</code> which is transferred to <code>to</code>, after it the balance of the contract token is checked to be equal to zero or the transaction will be reverted.</p>\n<p>In the following cases a denial of service will occur:</p>\n<ul>\n<li>In the case that is used an <code>amount</code> different than the balance, the transaction will be reverted.</li>\n<li><strong>In the case that an attacker front-runs the transaction and sends one token more than the established by the <code>_accountant</code>.</strong></li>\n<li>In case of increasing balance tokens like <code>mDai</code> that constantly change their balance, the established by the <code>_accountant</code> will be different when the transaction is persisted.</li>\n</ul>\n<h3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<ul>\n<li>Use balance differences instead of the 0 check.</li>\n</ul>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/43\">nivasan1 (Canto) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/43#issuecomment-1216823120\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how, anyone, via a simple transfer of <code>underlying</code> can deny the functionality of <code>doTransferOut</code>.</p>\n<p>Because the function is used in multiple functions inherited from <code>CToken</code>, and the griefing can be easily run by anyone, I believe High Severity to be appropriate.</p>\n</blockquote>\n<hr>\n<h2 id=\"h-03-underlying-asset-price-oracle-for-ctoken-in-basev1-periphery-is-inaccurate\" style=\"position:relative;\"><a href=\"#h-03-underlying-asset-price-oracle-for-ctoken-in-basev1-periphery-is-inaccurate\" aria-label=\"h 03 underlying asset price oracle for ctoken in basev1 periphery is inaccurate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/134\">[H-03] Underlying asset price oracle for <code>CToken</code> in <code>BaseV1-periphery</code> is inaccurate</a></h2>\n<p><em>Submitted by ladboy233</em></p>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Stableswap/BaseV1-periphery.sol#L489\">https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Stableswap/BaseV1-periphery.sol#L489</a><br></p>\n<p>Underlying asset price oracle for CToken in BaseV1-periphery is inaccurate.</p>\n<h3 id=\"proof-of-concept-2\" style=\"position:relative;\"><a href=\"#proof-of-concept-2\" aria-label=\"proof of concept 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">    function getUnderlyingPrice(CToken ctoken) external override view returns(uint price) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        IBaseV1Pair pair;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        uint8 stable;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        bool stablePair;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        address underlying;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        if (compareStrings(ctoken.symbol(), &quot;cCANTO&quot;)) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            stable = 0;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            underlying = address(wcanto);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        } </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        //set price statically to 1 when the Comptroller is retrieving Price</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        else if (compareStrings(ctoken.symbol(), &quot;cNOTE&quot;) &amp;&amp; msg.sender == Comptroller) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            return 1; // Note price is fixed to 1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span></code></pre>\n<p>We should not be return 1. 1 is 1 wei. We should be 10 ** 18</p>\n<h3 id=\"tools-used\" style=\"position:relative;\"><a href=\"#tools-used\" aria-label=\"tools used permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>VIM</p>\n<h4 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h4>\n<p>We can return 10 ** 18</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/134\">nivasan1 (Canto) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/134#issuecomment-1216832609\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown what probably is a developer mistake, which will scale down the price of the cNOTE token to 1.</p>\n<p>The sponsor confirms.</p>\n<p>It should be noted that if cNOTE always returns 1e18 then the math for <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/NoteInterest.sol#L147-L148\"><code>diff</code></a> will always be zero, meaning the interest will exclusively be dictated by <code>baseRatePerYear</code>.</p>\n<p>Because the sponsor confirms, and because the comments point to values “scaled by 1e18” I believe the finding to be valid, and since the “math is wrong”, I do agree with High Severity.</p>\n</blockquote>\n<hr>\n<h2 id=\"h-04-oracle-periodsize-is-very-low-allowing-the-twap-price-to-be-easily-manipulated\" style=\"position:relative;\"><a href=\"#h-04-oracle-periodsize-is-very-low-allowing-the-twap-price-to-be-easily-manipulated\" aria-label=\"h 04 oracle periodsize is very low allowing the twap price to be easily manipulated permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/124\">[H-04] Oracle <code>periodSize</code> is very low allowing the TWAP price to be easily manipulated</a></h2>\n<p><em>Submitted by 0x52, also found by __141345__, Chom, csanuragjain, and ladboy233</em></p>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/Stableswap/BaseV1-core.sol#L72\">https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/Stableswap/BaseV1-core.sol#L72</a></p>\n<p>TWAP oracle easily manipulated.</p>\n<h3 id=\"proof-of-concept-3\" style=\"position:relative;\"><a href=\"#proof-of-concept-3\" aria-label=\"proof of concept 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>periodSize is set to 0 meaning that the oracle will take a new observation every single block, which would allow an attacker to easily flood the TWAP oracle and manipulate the price.</p>\n<h3 id=\"recommended-mitigation-steps-3\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-3\" aria-label=\"recommended mitigation steps 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Increase periodSize to be greater than 0, 1800 is typically standard.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/124\">nivasan1 (Canto) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/124#issuecomment-1216838068\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has identified a constant set to zero for the time in between TWAP observations.</p>\n<p>Because the code change:</p>\n<ul>\n<li>Is a mistake (evidenced by the comments)</li>\n<li>Causes the TWAP (already put into question in previous contest) to become a Spot Oracle</li>\n<li>There’s no way to remediate as the variable is constant</li>\n<li>The change will end up resulting in a manipulatable <code>quote</code> which will impact <code>getUnderlyingPrice</code></li>\n</ul>\n<p>I agree with High Severity.</p>\n</blockquote>\n<hr>\n<h2 id=\"h-05-the-lp-pair-underlying-price-quote-could-be-manipulated\" style=\"position:relative;\"><a href=\"#h-05-the-lp-pair-underlying-price-quote-could-be-manipulated\" aria-label=\"h 05 the lp pair underlying price quote could be manipulated permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/152\">[H-05] The LP pair underlying price quote could be manipulated</a></h2>\n<p><em>Submitted by __141345__</em></p>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/Stableswap/BaseV1-periphery.sol#L522-L526\">https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/Stableswap/BaseV1-periphery.sol#L522-L526</a><br>\n<a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/Stableswap/BaseV1-periphery.sol#L198-L217\">https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/Stableswap/BaseV1-periphery.sol#L198-L217</a></p>\n<p>The underlying price for LP pool pair can be manipulated. This kind of price mainpulation happened before, can be found here: <a href=\"https://rekt.news/warp-finance-rekt/\">Warp Fincance event</a>.</p>\n<p>Which may lead to the exploit of the pool by a malicious user.</p>\n<h3 id=\"proof-of-concept-4\" style=\"position:relative;\"><a href=\"#proof-of-concept-4\" aria-label=\"proof of concept 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>file: lending-market-v2/contracts/Stableswap/BaseV1-periphery.sol<br>\n522-526， 198-217:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">            uint price0 = (token0 != USDC) ? IBaseV1Pair(pairFor(USDC, token0, stable0)).quote(token0, 1, 8) : 1;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            uint price1 = (token1 != USDC) ? IBaseV1Pair(pairFor(USDC, token1, stable1)).quote(token1, 1, 8) : 1;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            // how much of each asset is 1 LP token redeemable for</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            (uint amt0, uint amt1) = quoteRemoveLiquidity(token0, token1, stablePair, 1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            price = amt0 * price0 + amt1 * price1;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    function quoteRemoveLiquidity(</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        address tokenA,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        address tokenB,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        bool stable,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        uint liquidity</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    ) public view returns (uint amountA, uint amountB) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        // create the pair if it doesn&quot;t exist yet</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        address _pair = IBaseV1Factory(factory).getPair(tokenA, tokenB, stable);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        if (_pair == address(0)) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            return (0,0);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        (uint reserveA, uint reserveB) = getReserves(tokenA, tokenB, stable);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        uint _totalSupply = erc20(_pair).totalSupply();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        amountA = liquidity * reserveA / _totalSupply; // using balances ensures pro-rata distribution</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        amountB = liquidity * reserveB / _totalSupply; // using balances ensures pro-rata distribution</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span></code></pre>\n<p>The price of the LP pair is determined by the TVL of the pool, given by:<br>\n<code>amt0 * price0 + amt1 * price1</code>. However, when a malicious user dumps large amount of any token into the pool, the whole TVL will be significantly increased, which leads to inproper calculation of the price.</p>\n<h3 id=\"recommended-mitigation-steps-4\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-4\" aria-label=\"recommended mitigation steps 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>A differenct approach to calculate the LP price can be found <a href=\"https://cmichel.io/pricing-lp-tokens/\">here</a>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/152\">nivasan1 (Canto) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/152#issuecomment-1216847622\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how the LP Token Pricing math is incorrect, this is a mispricing that historically has resulted in total loss of funds and the subject is well known.</p>\n<p>Remediation can be attained by following the guide linked:\n<a href=\"https://cmichel.io/pricing-lp-tokens/\">https://cmichel.io/pricing-lp-tokens/</a></p>\n<p>Because the:</p>\n<ul>\n<li>Math is incorrect</li>\n<li>Exploit allows anyone to inflate prices within 1 block (no risk)</li>\n</ul>\n<p>High Severity is appropriate.</p>\n</blockquote>\n<hr>\n<h2 id=\"h-06-getborrowrate-returns-rate-per-year-instead-of-per-block\" style=\"position:relative;\"><a href=\"#h-06-getborrowrate-returns-rate-per-year-instead-of-per-block\" aria-label=\"h 06 getborrowrate returns rate per year instead of per block permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/38\">[H-06] <code>getBorrowRate</code> returns rate per year instead of per block</a></h2>\n<p><em>Submitted by Lambda, also found by Chom</em></p>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/NoteInterest.sol#L118\">https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/NoteInterest.sol#L118</a><br>\n<a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/CToken.sol#L209\">https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/CToken.sol#L209</a></p>\n<p>According to the documentation in <code>InterestRateModel</code>, <code>getBorrowRate</code> has to return the borrow rate per block and the function <code>borrowRatePerBlock</code> in <code>CToken</code> directly returns the value of <code>getBorrowRate</code>. However, the rate per year is returned for <code>NoteInterest</code>. Therefore, using <code>NoteInterest</code> as an interest model will result in completely wrong values.</p>\n<h3 id=\"recommended-mitigation-steps-5\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-5\" aria-label=\"recommended mitigation steps 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Return <code>baseRatePerBlock</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/38\">nivasan1 (Canto) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/38#issuecomment-1216901711\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown that the borrowRate is returning per-year values instead of per-block values.</p>\n<p>The effect of this is that the accounting will be magnified massively.</p>\n<p>While impact should be mostly loss of value to interest and incorrect yield, due to the math being wrong I do agree with High Severity.</p>\n</blockquote>\n<hr>\n<h2 id=\"h-07-deny-of-service-in-accountantdelegatesweepinterest\" style=\"position:relative;\"><a href=\"#h-07-deny-of-service-in-accountantdelegatesweepinterest\" aria-label=\"h 07 deny of service in accountantdelegatesweepinterest permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/28\">[H-07] Deny of service in <code>AccountantDelegate.sweepInterest</code></a></h2>\n<p><em>Submitted by 0x1f8b, also found by Critical</em></p>\n<p><a href=\"https://github.dev/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Accountant/AccountantDelegate.sol#L101\">https://github.dev/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Accountant/AccountantDelegate.sol#L101</a></p>\n<p>The <code>sweepInterest</code> method is susceptible to denial of service.</p>\n<h3 id=\"proof-of-concept-5\" style=\"position:relative;\"><a href=\"#proof-of-concept-5\" aria-label=\"proof of concept 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>The logic of the <code>sweepInterest</code> method relative to the <code>treasury</code> is as follows:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">success</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">cnote</span><span class=\"mtk1\">.</span><span class=\"mtk11\">transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">treasury</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amtToSweep</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (!</span><span class=\"mtk12\">success</span><span class=\"mtk1\">) { </span><span class=\"mtk12\">revert</span><span class=\"mtk1\">  </span><span class=\"mtk11\">SweepError</span><span class=\"mtk1\">(</span><span class=\"mtk12\">treasury</span><span class=\"mtk1\"> , </span><span class=\"mtk12\">amtToSweep</span><span class=\"mtk1\">); }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk12\">TreasuryInterface</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Treas</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">TreasuryInterface</span><span class=\"mtk1\">(</span><span class=\"mtk12\">treasury</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk12\">Treas</span><span class=\"mtk1\">.</span><span class=\"mtk11\">redeem</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">cnote</span><span class=\"mtk1\">),</span><span class=\"mtk12\">amtToSweep</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">cnote</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">treasury</span><span class=\"mtk1\">) == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;AccountantDelegate::sweepInterestError&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>As you can see, <code>amtToSweep</code> is passed to it and <code>redeem</code> that amount. Later it is checked that the balance of <code>cnote</code> in the <code>treasury</code> address must be 0. However, all calculations related to <code>amtToSweep</code> come out of the balance of <a href=\"https://github.dev/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Accountant/AccountantDelegate.sol#L83-L84\">address(this)</a> so if a third party sends a single token <code>cnote</code> to the address of <code>treasury</code> the method will be denied.</p>\n<h3 id=\"recommended-mitigation-steps-6\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-6\" aria-label=\"recommended mitigation steps 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<ul>\n<li>Check that the balance is the same after and before the <code>bool success = cnote.transfer(treasury, amtToSweep);</code></li>\n</ul>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/28\">nivasan1 (Canto) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/28#issuecomment-1216930433\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how, due to an incorrect invariant (treasury having zero cNote), any griefer can permanently brick the <code>sweepInterest</code> function.</p>\n<p>The finding shows how a loss of yield can be achieved, so Medium Severity would be in order.</p>\n<p>However, because:</p>\n<ul>\n<li>an invariant was broken</li>\n<li>the tokens cannot be withdrawn via an alternative method</li>\n</ul>\n<p>I believe High Severity to be more appropriate.</p>\n</blockquote>\n<hr>\n<h2 id=\"h-08-accountantdelegate-the-sweepinterest-function-sweeps-an-incorrect-number-of-cnote\" style=\"position:relative;\"><a href=\"#h-08-accountantdelegate-the-sweepinterest-function-sweeps-an-incorrect-number-of-cnote\" aria-label=\"h 08 accountantdelegate the sweepinterest function sweeps an incorrect number of cnote permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/11\">[H-08] AccountantDelegate: The sweepInterest function sweeps an incorrect number of cnote</a></h2>\n<p><em>Submitted by cccz, also found by Critical</em></p>\n<p>In the sweepInterest function of the AccountantDelegate contract, the number of cnote sent to treasury should be cNoteToSweep instead of amtToSweep, as amtToSweep will normally be smaller than cNoteToSweep, which will cause the interest to be locked in the in the contract.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">\t\tuint amtToSweep = sub_(cNoteAmt, noteDiff); // amount to sweep in Note, </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">\t\tuint cNoteToSweep = div_(amtToSweep, exRate); // amount of cNote to sweep = amtToSweep(Note) / exRate</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">\t\tcNoteToSweep = (cNoteToSweep &gt; cNoteBal) ? cNoteBal :  cNoteToSweep; </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">\t\tbool success = cnote.transfer(treasury, amtToSweep);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">\t\tif (!success) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">\t\t\trevert  SweepError(treasury , amtToSweep); //handles if transfer of tokens is not successful</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">\t\t}</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">\t\tTreasuryInterface Treas = TreasuryInterface(treasury);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">\t\tTreas.redeem(address(cnote),amtToSweep);</span></span></code></pre>\n<h3 id=\"proof-of-concept-6\" style=\"position:relative;\"><a href=\"#proof-of-concept-6\" aria-label=\"proof of concept 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/Accountant/AccountantDelegate.sol#L80-L99\">https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/Accountant/AccountantDelegate.sol#L80-L99</a></p>\n<h3 id=\"recommended-mitigation-steps-7\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-7\" aria-label=\"recommended mitigation steps 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\tuint amtToSweep = sub_(cNoteAmt, noteDiff); // amount to sweep in Note, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\tuint cNoteToSweep = div_(amtToSweep, exRate); // amount of cNote to sweep = amtToSweep(Note) / exRate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\tcNoteToSweep = (cNoteToSweep &gt; cNoteBal) ? cNoteBal :  cNoteToSweep; </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-\t\tbool success = cnote.transfer(treasury, amtToSweep);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+               bool success = cnote.transfer(treasury, cNoteToSweep);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\tif (!success) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-\t\t\trevert  SweepError(treasury , amtToSweep); //handles if transfer of tokens is not successful</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+                       revert  SweepError(treasury , cNoteToSweep); //handles if transfer of tokens is not successful</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\tTreasuryInterface Treas = TreasuryInterface(treasury);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-\t\tTreas.redeem(address(cnote),amtToSweep);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+               Treas.redeem(address(cnote),cNoteToSweep);</span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/11\">nivasan1 (Canto) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/11#issuecomment-1216934462\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown that the wrong variable is being used as the transferAmount.</p>\n<p>Because <code>cNoteToSweep</code> &#x3C;&#x3C; <code>amtToSweep</code> there will be many instances in which the function will revert.</p>\n<p>Because the finding shows incorrect functionality, which can leave the tokens stuck indefinitely, I agree with High Severity.</p>\n</blockquote>\n<hr>\n<h1 id=\"medium-risk-findings-6\" style=\"position:relative;\"><a href=\"#medium-risk-findings-6\" aria-label=\"medium risk findings 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Medium Risk Findings (6)</h1>\n<h2 id=\"m-01-stableswap---deadline-do-not-work\" style=\"position:relative;\"><a href=\"#m-01-stableswap---deadline-do-not-work\" aria-label=\"m 01 stableswap   deadline do not work permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/90\">[M-01] Stableswap - Deadline do not work</a></h2>\n<p><em>Submitted by Picodes, also found by cccz, Funen, ladboy233, Soosh, and zzzitron</em></p>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/Stableswap/BaseV1-periphery.sol#L86\">https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/Stableswap/BaseV1-periphery.sol#L86</a><br></p>\n<p>The <code>ensure</code> modifier is commented, so deadlines will not work when passing orders, breaking this functionality.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/90\">nivasan1 (Canto) acknowledged</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/90#issuecomment-1214244667\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how, due to a comment, the modifier <code>deadline</code> doesn’t work.</p>\n<p>Because Front-running is a key aspect of AMM design, <code>deadline</code> is a useful tool to ensure that your tx cannot be “saved for later”.</p>\n<p>Due to the removal of the check, it may be more profitable for a miner to deny the transaction from being mined until the transaction incurs the maximum amount of slippage.</p>\n<p>The lack of deadline means that the tx can be withheld indefinitely at the advantage of the miner.</p>\n<p>For those reasons I agree with Medium Severity.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-02-multiple-initialization-in-noteinterest\" style=\"position:relative;\"><a href=\"#m-02-multiple-initialization-in-noteinterest\" aria-label=\"m 02 multiple initialization in noteinterest permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/49\">[M-02] Multiple initialization in <code>NoteInterest</code></a></h2>\n<p><em>Submitted by 0x1f8b, also found by oyc_109</em></p>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/NoteInterest.sol#L99\">https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/NoteInterest.sol#L99</a><br></p>\n<p>The <code>initialize</code> method of the contract <code>NoteInterest</code> can be initialized multiple times.</p>\n<h3 id=\"proof-of-concept-7\" style=\"position:relative;\"><a href=\"#proof-of-concept-7\" aria-label=\"proof of concept 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>The method <code>initialize</code> of the contract <code>NoteInterest</code> looks like this:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">initialize</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">cnoteAddr</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oracleAddress</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\"> != </span><span class=\"mtk12\">admin</span><span class=\"mtk1\"> ) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">revert</span><span class=\"mtk1\"> </span><span class=\"mtk11\">SenderNotAdmin</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }   </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">oldPriceOracle</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oracle</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">cNote</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">CErc20</span><span class=\"mtk1\">(</span><span class=\"mtk12\">cnoteAddr</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">oracle</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">PriceOracle</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oracleAddress</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">NewPriceOracle</span><span class=\"mtk1\">(</span><span class=\"mtk12\">oldPriceOracle</span><span class=\"mtk1\">, </span><span class=\"mtk12\">oracleAddress</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>Nothing prevents it from being initialized again and altering the initial values of the contract. This allows the government, unnecessarily, to be able to perform attacks such as altering the logic of the <code>updateBaseRate</code> method.</p>\n<h3 id=\"recommended-mitigation-steps-8\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-8\" aria-label=\"recommended mitigation steps 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Add a require to check that was not already initialized.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/49#issuecomment-1189651440\">nivasan1 (Canto) disputed and commented</a>:</strong></p>\n<blockquote>\n<p>It is not clear how governance would be able to modify the logic in updateBaseRate? All that could be changed is the price oracle that the NoteInterest Model references.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/49#issuecomment-1214473208\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown that the function <code>initialize</code> can be called multiple times by governance.</p>\n<p>This could cause undefined behaviour (e.g. change the token address), which could cause loss of funds.</p>\n<p>Because of the system setup, it would be best to make sure that <code>initialize</code> can only be called once.</p>\n<p>Because the finding can cause a loss, under specific circumstances, I believe Medium Severity is appropriate</p>\n</blockquote>\n<hr>\n<h2 id=\"m-03-non-view-function-is-called-with-staticcall-in-cerc20delegator\" style=\"position:relative;\"><a href=\"#m-03-non-view-function-is-called-with-staticcall-in-cerc20delegator\" aria-label=\"m 03 non view function is called with staticcall in cerc20delegator permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/112\">[M-03] Non view function is called with staticcall in <code>CErc20Delegator</code></a></h2>\n<p><em>Submitted by zzzitron</em></p>\n<h3 id=\"lines-of-code\" style=\"position:relative;\"><a href=\"#lines-of-code\" aria-label=\"lines of code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lines of code</h3>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/CErc20Delegator.sol#L237\">https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/CErc20Delegator.sol#L237</a><br>\n<a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/CErc20Delegator.sol#L246\">https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/CErc20Delegator.sol#L246</a></p>\n<p>When using CToken implementation with CErc20Delegator, the functions <code>borrowRatePerBlock</code> and <code>supplyRatePerBlock</code> will revert when the underlying functions try to update some states.</p>\n<h3 id=\"detail\" style=\"position:relative;\"><a href=\"#detail\" aria-label=\"detail permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Detail</h3>\n<p>The v1 of <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/CToken.sol#L208\">borrowRatePerBlock</a> and <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/CToken.sol#L216\">supplyRatePerBlock</a> were view functions, but they are not anymore. The <code>CErc20Delegator</code> is still using <code>delegateToViewImplementation</code> for those functions. Those functions can be used, as long as the implementation does not update any state variables, i.e. <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/NoteInterest.sol#L141\">the block number increase since the last update is less or equal to the <code>updateFrequency</code></a>. However, when these functions are called after sufficient blocks are mined, they are going to revert.<br>\nAlthough one can still call the implementation using <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/CErc20Delegator.sol#L437\"><code>delegateToImplementation</code></a>, it is not a good usability, especially if those functions are used for external user interface.</p>\n<h3 id=\"proof-of-concept-8\" style=\"position:relative;\"><a href=\"#proof-of-concept-8\" aria-label=\"proof of concept 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof Of Concept</h3>\n<p><a href=\"https://gist.github.com/zzzitron/37fb99cebed786b4c983d20a76e8793e#file-2022-06-newblockchain-v2-poc-ctoken-test-ts-L49-L62\">Gist for the test</a></p>\n<p>The gist shows a simple test. It calls <code>borrowRatePerBlock</code> and <code>supplyRatePerBlock</code> first time, it suceeds. Then, it mines for more than 300 times, which is the <code>updateFrequency</code> parameter. Then it calls again then fails.</p>\n<p>Notes on the test file:</p>\n<ul>\n<li>The setup is taken from <code>tests/Treasury/Accountant.test.ts</code></li>\n<li>\n<p>using <code>solidity</code> from ethereum-waffle for chai to use <code>reverted</code>\n// in hardhat.config.js\nimport chai from “chai”;\nimport { solidity } from “ethereum-waffle”;</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">chai.use(solidity);</span></span></code></pre>\n</li>\n</ul>\n<h3 id=\"tools-used-1\" style=\"position:relative;\"><a href=\"#tools-used-1\" aria-label=\"tools used 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>hardhat</p>\n<h3 id=\"recommended-mitigation-steps-9\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-9\" aria-label=\"recommended mitigation steps 9 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Instead of using <code>delegateToViewImplementation</code> use <code>delegateToImplementation</code>. Alternatively, implement view functions to query these rates in <code>NoteInterest.sol</code> and <code>CToken.sol</code>. It will enable to query the rates without spending gas.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/112\">nivasan1 (Canto) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/112#issuecomment-1216670039\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The warden has shown how, due to the usage of <code>delegateToViewImplementation</code> the function call to <code>borrowRatePerBlock</code> and <code>supplyRatePerBlock</code> will revert, provided some time has passed.</p>\n<p>There is no more severe loss of availability than a function that doesn’t work, however, at this time, because the functions are <code>view</code> and “niche”, the actual underlying functionality is still available via <code>delegateToViewImplementation</code>, and the internal accounting of the protocol is still functioning, I believe Medium Severity to be appropriate.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-04-missing-zero-address-check-can-cause-initialize-to-be-called-more-than-once\" style=\"position:relative;\"><a href=\"#m-04-missing-zero-address-check-can-cause-initialize-to-be-called-more-than-once\" aria-label=\"m 04 missing zero address check can cause initialize to be called more than once permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/14\">[M-04] Missing zero address check can cause initialize to be called more than once</a></h2>\n<p><em>Submitted by oyc_109</em></p>\n<p>There is potential to call initialize() on <code>AccountantDelegate.sol</code> more than once because the require statement only checks if the state variables != address(0)</p>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Accountant/AccountantDelegate.sol#L23-L25\">https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Accountant/AccountantDelegate.sol#L23-L25</a></p>\n<p>If initialize() was called the first with these parameters as address(0x0), then initialize can be called again</p>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Accountant/AccountantDelegate.sol#L17\">https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Accountant/AccountantDelegate.sol#L17</a></p>\n<h3 id=\"recommended-mitigation-steps-10\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-10\" aria-label=\"recommended mitigation steps 10 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>The require statement should also check if the parameters != zero address, similar to the check performed in <code>TreasuryDelegate.sol</code></p>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Treasury/TreasuryDelegate.sol#L23\">https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Treasury/TreasuryDelegate.sol#L23</a></p>\n<p>Or use openzepplen initializable.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/14#issuecomment-1189479463\">nivasan1 (Canto) acknowledged and commented</a>:</strong></p>\n<blockquote>\n<p>This will be a function called by admin (Governance), as such, it is the community’s responsibility to review the parameters of the inititalize method.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/14#issuecomment-1216685787\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>In contract to CantoV1, in this version of the code the <code>initializer</code> can be called multiple times.</p>\n<p>This is contingent on the admin calling it, however the impact of changing any variable will most likely be complete breaking of all accounting (an exception may be a complete fresh start).</p>\n<p>Given in the code in scope, and the conditionality (admin privilege), I believe Medium Severity to be appropriate.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-05-admin-can-break-all-functionality-through-weth-address\" style=\"position:relative;\"><a href=\"#m-05-admin-can-break-all-functionality-through-weth-address\" aria-label=\"m 05 admin can break all functionality through weth address permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/173\">[M-05] Admin Can Break All Functionality Through Weth Address</a></h2>\n<p><em>Submitted by defsec</em></p>\n<p>On the protocol, almost all functionality is constructed through WETH address. However, if the admin is set to WETH address mistakenly, user could not claim through <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/main/contracts/Comptroller.sol#L1381\">Comptroller.sol#L1381</a>. Admin can break the protocol.</p>\n<h3 id=\"proof-of-concept-9\" style=\"position:relative;\"><a href=\"#proof-of-concept-9\" aria-label=\"proof of concept 9 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/main/contracts/Comptroller.sol#L1479\">https://github.com/Plex-Engineer/lending-market-v2/blob/main/contracts/Comptroller.sol#L1479</a></p>\n<h3 id=\"recommended-mitigation-steps-11\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-11\" aria-label=\"recommended mitigation steps 11 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Set WETH address through initializer or change it through governance.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/173#issuecomment-1189682546\">nivasan1 (Canto) disputed and commented</a>:</strong></p>\n<blockquote>\n<p>The admin of the lending-market and LP will be cosmos-sdk governance, vis-a-vis, the community, as such it is expected that a malicious governance proposal will not be passed.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/173#issuecomment-1216868137\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Similarly to findings about <code>admin</code> re-initializing contracts, the warden has shown how, because the WETH address can be changed, accounting and functionality of the protocol and it’s interactions (in this case emission of rewards and all lending operations triggering a transfer of “COMP”), can be bricked.</p>\n<p>Because this is contingent on malicious governance, I believe Medium Severity to be appropriate.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-06-a-cap-is-needed-on-the-amount-of-note-than-can-be-borrowed\" style=\"position:relative;\"><a href=\"#m-06-a-cap-is-needed-on-the-amount-of-note-than-can-be-borrowed\" aria-label=\"m 06 a cap is needed on the amount of note than can be borrowed permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/92\">[M-06] A cap is needed on the amount of Note than can be borrowed</a></h2>\n<p><em>Submitted by Picodes</em></p>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/CNote.sol#L33\">https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/CNote.sol#L33</a><br>\n<a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/Note.sol#L14\">https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/Note.sol#L14</a></p>\n<p>The fact that there is no cap on the amount of Note that can be borrowed makes the Oracle Extractable Value unlimited. But as you intend to rely on TWAP, you need to make sure the cost of oracle manipulation is lower than the Oracle Extractable Value.</p>\n<h3 id=\"proof-of-concept-10\" style=\"position:relative;\"><a href=\"#proof-of-concept-10\" aria-label=\"proof of concept 10 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>By manipulating the TWAPs of the designated proxy used for Note (USDC ?) and its relative price to a given collateral(which would be highly costly), an attacker could borrow Note without limit, and empty all pools related to Note and all Note-related value, instantly killing the stablecoin.</p>\n<p>The value extractable by Oracle Manipulations is usually easily computable as it is the size of the lending market, but here, it’s more difficult to evaluate as it could potentially be any value linked to Note. This makes risk management harder and increase significantly the risk of attack.</p>\n<p>Therefore a cap on how many Notes can be borrowed needs to be added to mitigate this risk.</p>\n<p>The attack would be:</p>\n<ul>\n<li>Manipulate the USDC / Collateral TWAP to be able to borrow Note with less than 1$ of collateral, which would be costly.</li>\n<li>\n<p>Extract all the value possible linked to Note, for example:</p>\n<ul>\n<li>by buying all the tokens from pools Note / token at a discount</li>\n<li>by supplying Notes to the lending platform and borrow collaterals for which the Note price is still at 1$</li>\n<li>etc</li>\n</ul>\n</li>\n</ul>\n<p>Essentially as you have no cap on the amount of Note that could be borrowed in such a scenario, you cannot be sure that the potential attack profits are lower than the attack cost.</p>\n<h3 id=\"recommended-mitigation-steps-12\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-12\" aria-label=\"recommended mitigation steps 12 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>The governance needs to set a limit on how much Note can be borrowed to mitigate risks, or add for example an “hourly” borrowing limit.</p>\n<p>Easiest way to do this would be able to mint / burn from the accountant.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/92\">nivasan1 (Canto) acknowledged</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/92#issuecomment-1216895007\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>I don’t think you can manipulate the price of cNOTE per this code</p>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Stableswap/BaseV1-periphery.sol#L499-L502\">https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Stableswap/BaseV1-periphery.sol#L499-L502</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">//set price statically to 1 when the Comptroller is retrieving Price</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk11\">compareStrings</span><span class=\"mtk1\">(</span><span class=\"mtk12\">ctoken</span><span class=\"mtk1\">.</span><span class=\"mtk11\">symbol</span><span class=\"mtk1\">(), </span><span class=\"mtk8\">&quot;cNOTE&quot;</span><span class=\"mtk1\">) &amp;&amp; </span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">Comptroller</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">1</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// Note price is fixed to 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span></code></pre>\n<p>However, you can manipulate the price of another token against USDC</p>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Stableswap/BaseV1-periphery.sol#L529-L533\">https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Stableswap/BaseV1-periphery.sol#L529-L533</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">else</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">stablePair</span><span class=\"mtk1\"> = (</span><span class=\"mtk12\">stable</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) ? </span><span class=\"mtk4\">false</span><span class=\"mtk1\"> : </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">pair</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">IBaseV1Pair</span><span class=\"mtk1\">(</span><span class=\"mtk11\">pairFor</span><span class=\"mtk1\">(</span><span class=\"mtk12\">USDC</span><span class=\"mtk1\">, </span><span class=\"mtk12\">underlying</span><span class=\"mtk1\">, </span><span class=\"mtk12\">stablePair</span><span class=\"mtk1\">)); </span><span class=\"mtk3\">//get the pair for the USDC/underlying pool</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">price</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">pair</span><span class=\"mtk1\">.</span><span class=\"mtk11\">quote</span><span class=\"mtk1\">(</span><span class=\"mtk12\">underlying</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\">, </span><span class=\"mtk7\">8</span><span class=\"mtk1\">); </span><span class=\"mtk3\">//how much USDC is this token redeemable for</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span></code></pre>\n<p>The attack outlined by the warden would require an imbalance in the price of an asset against the given above code.</p>\n<p>It would also require oracle manipulation, which requires no external arbitrage nor intervention\nIt would require some value to be extractable from the system.</p>\n<p>For those reasons, I think Medium Severity is more appropriate.</p>\n</blockquote>\n<hr>\n<h1 id=\"low-risk-and-non-critical-issues\" style=\"position:relative;\"><a href=\"#low-risk-and-non-critical-issues\" aria-label=\"low risk and non critical issues permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Low Risk and Non-Critical Issues</h1>\n<p>For this contest, 34 reports were submitted by wardens detailing low risk and non-critical issues. The <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/113\">report highlighted below</a> by <strong>zzzitron</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/56\">0x1f8b</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/150\">TomJ</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/29\">AlleyCat</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/35\">Lambda</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/87\">Picodes</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/59\">Meera</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/155\">aysha</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/117\">c3phas</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/157\">0x29A</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/100\">__141345__</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/10\">oyc_109</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/60\">Bnke0x0</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/164\">defsec</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/174\">Chom</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/74\">fatherOfBlocks</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/23\">cccz</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/130\">ladboy233</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/160\">slywaters</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/50\">ignacio</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/170\">JC</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/122\">rfa</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/161\">Funen</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/125\">hake</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/53\">sach1r0</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/3\">samruna</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/85\">ynnad</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/146\">grGred</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/142\">TerrierLover</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/167\">0v3rf10w</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/127\">asutorufos</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/103\">Limbooo</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/79\">mrpathfindr</a>, and <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/82\">Sm4rty</a>.</em></p>\n<h2 id=\"l-01-price-not-scaled-by-the-base-in-basev1router01\" style=\"position:relative;\"><a href=\"#l-01-price-not-scaled-by-the-base-in-basev1router01\" aria-label=\"l 01 price not scaled by the base in basev1router01 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-01] Price not scaled by the BASE in <code>BaseV1Router01</code></h2>\n<ul>\n<li>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/ea5840de72eab58bec837bb51986ac73712fcfde/contracts/Stableswap/BaseV1-periphery.sol#L501\">BaseV1-periphery.sol:501</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">      else if (compareStrings(ctoken.symbol(), &quot;cNOTE&quot;) &amp;&amp; msg.sender == Comptroller) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">          return 1; // Note price is fixed to 1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      }</span></span></code></pre>\n</li>\n</ul>\n<p>The <code>getUnderlyingPrice</code> function returns 1, when Comptroller is calling with <code>CNote</code>. The Comptroller is using the given price as <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Comptroller.sol#L757\">mantissa</a>, which has <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Comptroller.sol#L757\">18 decimal precision</a>.</p>\n<h2 id=\"l-02-_acceptinitialadmindelegated-will-revert-in-governorbravodelegator\" style=\"position:relative;\"><a href=\"#l-02-_acceptinitialadmindelegated-will-revert-in-governorbravodelegator\" aria-label=\"l 02 _acceptinitialadmindelegated will revert in governorbravodelegator permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-02] <code>_acceptInitialAdminDelegated</code> will revert in <code>GovernorBravoDelegator</code></h2>\n<ul>\n<li>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Governance/GovernorBravoDelegator.sol#L49\">GovernorBravoDelegator.sol:49</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">      delegateTo(implementation, abi.encodeWithSignature(&quot;_acceptInitialAdmin()&quot;));</span></span></code></pre>\n</li>\n</ul>\n<p>When the <code>GovernorBravoDelegator</code> is used with <code>GovernorBravoDelegate</code> as the implementation, the function <code>_acceptInitialAdminDelegated</code> will revert since the <code>GovernorBravoDelegate</code> does not have <code>_acceptInitialAdmin</code> function.</p>\n<h2 id=\"l-03-desirable-underflow--overflow-in-basev1pair\" style=\"position:relative;\"><a href=\"#l-03-desirable-underflow--overflow-in-basev1pair\" aria-label=\"l 03 desirable underflow  overflow in basev1pair permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-03] Desirable underflow / overflow in <code>BaseV1Pair</code></h2>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Stableswap/BaseV1-core.sol#L160-L161\">BaseV1-core.sol:160-161</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Stableswap/BaseV1-core.sol#L186-L187\">BaseV1-core.sol:186-187</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Stableswap/BaseV1-core.sol#L200-L201\">BaseV1-core.sol:200-201</a></li>\n<li>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Stableswap/BaseV1-core.sol#L232-L233\">BaseV1-core.sol:232-233</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">          reserve0CumulativeLast += _reserve0 * timeElapsed;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">          reserve1CumulativeLast += _reserve1 * timeElapsed;</span></span></code></pre>\n</li>\n</ul>\n<p>The BaseV1-core is using solidity version 0.8.11, so it will revert when overflow or underflow happens. Upon cumulating the time weighted reserve, it is desired to overflow. Likewise it is desired to underflow calculating price average. It also saves gas usage, to use unchecked block for those calculations.</p>\n<h2 id=\"l-04-lack-of-zero-address-check\" style=\"position:relative;\"><a href=\"#l-04-lack-of-zero-address-check\" aria-label=\"l 04 lack of zero address check permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-04] Lack of zero address check</h2>\n<ul>\n<li>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/NoteInterest.sol#L104-L105\">NoteInterest.sol:104-105 in <code>initialize</code></a>\ncNote = CErc20(cnoteAddr);\noracle = PriceOracle(oracleAddress);</p>\n<ul>\n<li>the <code>cNote</code> and <code>oracle</code> was set without checking zero address</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/NoteInterest.sol#L113\">NoteInterest.sol:113 in <code>setAdmin</code></a>\nadmin = newAdmin;</p>\n<ul>\n<li>it is good to check admin for zero address, otherwise admin access will be lost forever. To renounce the admin, it is safer to add a separate function.</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"l-05-oracle-failure-check-in-noteratemodel\" style=\"position:relative;\"><a href=\"#l-05-oracle-failure-check-in-noteratemodel\" aria-label=\"l 05 oracle failure check in noteratemodel permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-05] Oracle failure check in <code>NoteRateModel</code></h2>\n<ul>\n<li>\n<p><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/NoteInterest.sol#L145\">NoteInterest.sol:145</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">          uint twapMantissa = oracle.getUnderlyingPrice(cNote); // returns price as mantissa</span></span></code></pre>\n</li>\n</ul>\n<p>It is good to check the returned value from oracle is sane (i.e. if it is zero) and prepare for a fallback.</p>\n<h2 id=\"l-06-storage-for-delegate-is-outside-of-storage-contract-in-cnote\" style=\"position:relative;\"><a href=\"#l-06-storage-for-delegate-is-outside-of-storage-contract-in-cnote\" aria-label=\"l 06 storage for delegate is outside of storage contract in cnote permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-06] Storage for delegate is outside of storage contract in <code>CNote</code></h2>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/CNote.sol#L14\">CNote.sol:14</a></li>\n</ul>\n<p>When updating an implementation for a proxy, it is important to keep the storage structure. Putting non-constant state variables in a dedicated storage contract is less error-prone approach. Although CErc20Delegate has a storage contract in its inheritance tree, a state variable <code>_accountant</code> was introduced in <code>CNote</code>. Therefore, extra care should be paid to the state variable.</p>\n<h2 id=\"n-01-cast-to-int-without-checking-in-noteratemodel\" style=\"position:relative;\"><a href=\"#n-01-cast-to-int-without-checking-in-noteratemodel\" aria-label=\"n 01 cast to int without checking in noteratemodel permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-01] Cast to <code>int</code> without checking in <code>NoteRateModel</code></h2>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/NoteInterest.sol#L147-L149\">NoteInterest.sol:147-149</a></li>\n</ul>\n<!---->\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">            int diff = BASE - int(twapMantissa); //possible annoyance if 1e18 - twapMantissa &gt; 2**255, differ</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            int InterestAdjust = (diff * int(adjusterCoefficient))/BASE;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            int ir = InterestAdjust + int(baseRatePerYear);</span></span></code></pre>\n<p>The uint256 variables are casted into <code>int</code> without checking for overflow. It is probably safe in this use case, but to be sure one may use <a href=\"https://github.com/OpenZeppelin/openzeppelin-contracts/blob/7a8f269457ca252605f03f8c2f8a333da6be1709/contracts/utils/math/SafeCast.sol#L1130-L1134\">SafeCast</a>.</p>\n<h2 id=\"n-02-meaningless-check-in-governorbravodelegate\" style=\"position:relative;\"><a href=\"#n-02-meaningless-check-in-governorbravodelegate\" aria-label=\"n 02 meaningless check in governorbravodelegate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-02] Meaningless check in <code>GovernorBravoDelegate</code></h2>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Governance/GovernorBravoDelegate.sol#L129\">GovernorBravoDelegate.sol:129</a></li>\n</ul>\n<p>The check <code>require(initialProposalId == 0, \"GovernorBravo::_initiate: can only initiate once\");</code> is not useful, as <code>initialProposalId</code> is never updated.</p>\n<h2 id=\"n-03-missing-param-in-natspec-in-ctoken\" style=\"position:relative;\"><a href=\"#n-03-missing-param-in-natspec-in-ctoken\" aria-label=\"n 03 missing param in natspec in ctoken permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-03] Missing param in NatSpec in <code>CToken</code></h2>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/CToken.sol#L23-L24\">CToken.sol:24</a></li>\n</ul>\n<p>Although a new argument <code>uint8 stable_</code> was added, the NatSpec for the parameter is missing.</p>\n<h2 id=\"n-04-misleading-natspec-in-accountantdelegator\" style=\"position:relative;\"><a href=\"#n-04-misleading-natspec-in-accountantdelegator\" aria-label=\"n 04 misleading natspec in accountantdelegator permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-04] Misleading NatSpec in <code>AccountantDelegator</code></h2>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Accountant/AccountantDelegator.sol#L50\">AccountantDelegator.sol:50 the NatSpec does not match the function</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/Accountant/AccountantDelegator.sol#L59\">AccountantDelegator.sol:59 the NatSpec does not match the function</a></li>\n</ul>\n<h2 id=\"n-05-typos\" style=\"position:relative;\"><a href=\"#n-05-typos\" aria-label=\"n 05 typos permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-05] Typos</h2>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/CToken.sol#L291\">CToken.sol: “efore” to “before”</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/443a8c0fed3c5018e95f3881a31b81a555c42b2d/contracts/CNote.sol#L41\">CNote.sol: “efore” to “before”</a></li>\n</ul>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/113#issuecomment-1214464717\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p><strong>[L-01] Price not scaled by the BASE in BaseV1Router01</strong><br>\nLow</p>\n<p><strong>[L-02] <code>_acceptInitialAdminDelegated</code> will revert in GovernorBravoDelegator</strong><br>\nValid Low (as the Sponsor uses another function to acceptAdmin)</p>\n<p><strong>[L-03] Desirable underflow / overflow in BaseV1Pair</strong><br>\nValid Low</p>\n<p><strong>[L-04] Lack of zero address check</strong><br>\nLow</p>\n<p><strong>[L-05] Oracle failure check in NoteRateModel</strong><br>\nLow</p>\n<p><strong>[L-06] Storage for delegate is outside of storage contract in CNote</strong><br>\nLow, there will be no risk unless the Sponsor changes the Delegate contract </p>\n<p><strong>[N-01] Cast to int without checking in NoteRateModel</strong><br>\nNC as it will never overflow but it’s a code-smell</p>\n<p><strong>[N-02] Meaningless check in GovernorBravoDelegate</strong><br>\nR</p>\n<p><strong>[N-03] &#x26; [N-04] Natspec</strong><br>\nNC</p>\n<p><strong>[N-05] Typos</strong><br>\nNC</p>\n<p>Really good report, there’s some personal opinion and style which helps it stand out. Also the quantity of findings is good, will give it bonus points.</p>\n</blockquote>\n<hr>\n<h1 id=\"gas-optimizations\" style=\"position:relative;\"><a href=\"#gas-optimizations\" aria-label=\"gas optimizations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gas Optimizations</h1>\n<p>For this contest, 34 reports were submitted by wardens detailing gas optimizations. The <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/55\">report highlighted below</a> by <strong>0x1f8b</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/121\">rfa</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/93\">0xKitsune</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/42\">Bnke0x0</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/158\">0x29A</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/163\">defsec</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/86\">Picodes</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/63\">Tomio</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/119\">TomJ</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/162\">Funen</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/132\">ladboy233</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/57\">Meera</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/73\">fatherOfBlocks</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/54\">m_Rassska</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/9\">oyc_109</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/139\">TerrierLover</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/106\">Waze</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/78\">mrpathfindr</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/129\">0xArshia</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/111\">ajtra</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/168\">c3phas</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/176\">Chom</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/46\">cRat1st0s</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/52\">durianSausage</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/171\">Fitraldys</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/145\">grGred</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/126\">hake</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/172\">JC</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/36\">Lambda</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/166\">Noah3o6</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/165\">RedOneN</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/156\">Rohan16</a>, <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/81\">Sm4rty</a>, and <a href=\"https://github.com/code-423n4/2022-06-NewBlockchain-v2-findings/issues/84\">ynnad</a>.</em></p>\n<h2 id=\"g-01-use-abiencodewithselector-instead-of-abiencodewithsignature\" style=\"position:relative;\"><a href=\"#g-01-use-abiencodewithselector-instead-of-abiencodewithsignature\" aria-label=\"g 01 use abiencodewithselector instead of abiencodewithsignature permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-01] Use <code>abi.encodeWithSelector</code> instead of <code>abi.encodeWithSignature</code></h2>\n<p><code>abi.encodeWithSelector</code> is much cheaper than <code>abi.encodeWithSignature</code> because it doesn’t require to compute the selector from the string.</p>\n<p>Reference:</p>\n<ul>\n<li><a href=\"https://docs.soliditylang.org/en/v0.8.15/units-and-global-variables.html#abi-encoding-and-decoding-functions\">https://docs.soliditylang.org/en/v0.8.15/units-and-global-variables.html#abi-encoding-and-decoding-functions</a></li>\n<li><a href=\"https://github.com/ConnorBlockchain/Solidity-Encode-Gas-Comparison\">https://github.com/ConnorBlockchain/Solidity-Encode-Gas-Comparison</a></li>\n</ul>\n<p>Affected source code:</p>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Accountant/AccountantDelegator.sol#L27\">AccountantDelegator.sol#L27</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Accountant/AccountantDelegator.sol#L54\">AccountantDelegator.sol#L54</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Accountant/AccountantDelegator.sol#L63\">AccountantDelegator.sol#L63</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Accountant/AccountantDelegator.sol#L71\">AccountantDelegator.sol#L71</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Accountant/AccountantDelegator.sol#L108\">AccountantDelegator.sol#L108</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Treasury/TreasuryDelegator.sol#L17\">TreasuryDelegator.sol#L17</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Treasury/TreasuryDelegator.sol#L45\">TreasuryDelegator.sol#L45</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Treasury/TreasuryDelegator.sol#L54\">TreasuryDelegator.sol#L54</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Treasury/TreasuryDelegator.sol#L64\">TreasuryDelegator.sol#L64</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Treasury/TreasuryDelegator.sol#L68\">TreasuryDelegator.sol#L68</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Treasury/TreasuryDelegator.sol#L89\">TreasuryDelegator.sol#L89</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorBravoDelegator.sol#L15\">GovernorBravoDelegator.sol#L15</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorBravoDelegator.sol#L41\">GovernorBravoDelegator.sol#L41</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorBravoDelegator.sol#L49\">GovernorBravoDelegator.sol#L49</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorBravoDelegator.sol#L57\">GovernorBravoDelegator.sol#L57</a></li>\n</ul>\n<h2 id=\"g-02-avoid-creating-unnecessary-variables\" style=\"position:relative;\"><a href=\"#g-02-avoid-creating-unnecessary-variables\" aria-label=\"g 02 avoid creating unnecessary variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-02] Avoid creating unnecessary variables</h2>\n<p>The creation of variables has an extra cost due to the required opcodes, in addition to the fact that the evm virtual machine is limited to the number of elements.</p>\n<p>Reference:</p>\n<ul>\n<li><a href=\"https://github.com/ethereum/solidity/issues/2693\">https://github.com/ethereum/solidity/issues/2693</a></li>\n</ul>\n<p>Affected source code:</p>\n<ul>\n<li>Return <code>address(this).balance</code> without create <code>treasuryCantoBalance</code> in <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Treasury/TreasuryDelegate.sol#L33-L36\">TreasuryDelegate.sol#L33-L36</a></li>\n<li>Return <code>note.balanceOf(address(this))</code> without create <code>treasuryNoteBalance</code> in <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Treasury/TreasuryDelegate.sol#L43-L44\">TreasuryDelegate.sol#L43-L44</a></li>\n<li>Send <code>msg.sender</code> instead of create <code>owner</code> var in <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/ERC20.sol#L92\">ERC20.sol#L92</a>, <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/ERC20.sol#L116\">ERC20.sol#L116</a>, <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/ERC20.sol#L162\">ERC20.sol#L162</a> and <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/ERC20.sol#L181\">ERC20.sol#L181</a></li>\n<li>Send <code>msg.sender</code> instead of create <code>src</code> var in <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/CToken.sol#L145\">CToken.sol#L145</a></li>\n</ul>\n<h2 id=\"g-03-reorder-structure-layout\" style=\"position:relative;\"><a href=\"#g-03-reorder-structure-layout\" aria-label=\"g 03 reorder structure layout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-03] Reorder structure layout</h2>\n<p>The following structs could be optimized moving the position of certains values in order to save slot storages:</p>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorBravoInterfaces.sol#L68-L95\">GovernorBravoInterfaces.sol#L68-L95</a> and <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorAlpha.sol#L69-L73\">GovernorAlpha.sol#L69-L73</a></li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">struct</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Proposal</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">id</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">proposer</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">eta</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">targets</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">values</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">string</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">signatures</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">calldatas</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">canceled</span><span class=\"mtk1\">;  </span><span class=\"mtk3\">// &lt;- Move these two bool close to the `proposer` address</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">executed</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h2 id=\"g-04-reduce-the-size-of-error-messages-long-revert-strings\" style=\"position:relative;\"><a href=\"#g-04-reduce-the-size-of-error-messages-long-revert-strings\" aria-label=\"g 04 reduce the size of error messages long revert strings permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-04] Reduce the size of error messages (Long revert Strings)</h2>\n<p>Shortening revert strings to fit in 32 bytes will decrease deployment time gas and will decrease runtime gas when the revert condition is met.</p>\n<p>Revert strings that are longer than 32 bytes require at least one additional mstore, along with additional overhead for computing memory offset, etc.</p>\n<p>I suggest shortening the revert strings to fit in 32 bytes, or that using custom errors as described next.</p>\n<h3 id=\"use-custom-errors-instead-of-revert-strings-to-save-gas\" style=\"position:relative;\"><a href=\"#use-custom-errors-instead-of-revert-strings-to-save-gas\" aria-label=\"use custom errors instead of revert strings to save gas permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Use Custom Errors instead of Revert Strings to save Gas</h3>\n<p>Custom errors from Solidity 0.8.4 are cheaper than revert strings (cheaper deployment cost and runtime cost when the revert condition is met)</p>\n<h4 id=\"source-custom-errors-in-solidity\" style=\"position:relative;\"><a href=\"#source-custom-errors-in-solidity\" aria-label=\"source custom errors in solidity permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Source Custom Errors in Solidity:</h4>\n<p>Starting from Solidity v0.8.4, there is a convenient and gas-efficient way to explain to users why an operation failed through the use of custom errors. Until now, you could already use strings to give more information about failures (e.g., revert(“Insufficient funds.”);), but they are rather expensive, especially when it comes to deploy cost, and it is difficult to use dynamic information in them.</p>\n<p>Custom errors are defined using the error statement, which can be used inside and outside of contracts (including interfaces and libraries).</p>\n<p>Below are some examples, but the code has a lot of them, it is recommended to change all <code>require</code> phrases to custom errors.</p>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorBravoDelegate.sol#L25-L27\">GovernorBravoDelegate.sol#L25-L27</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorBravoDelegate.sol#L46-L47\">GovernorBravoDelegate.sol#L46-L47</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorBravoDelegate.sol#L76\">GovernorBravoDelegate.sol#L76</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorBravoDelegate.sol#L85\">GovernorBravoDelegate.sol#L85</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorAlpha.sol#L137-L146\">GovernorAlpha.sol#L137-L146</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorAlpha.sol#L178\">GovernorAlpha.sol#L178</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorAlpha.sol#L189\">GovernorAlpha.sol#L189</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorAlpha.sol#L194\">GovernorAlpha.sol#L194</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorAlpha.sol#L205\">GovernorAlpha.sol#L205</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorAlpha.sol#L283-L298\">GovernorAlpha.sol#L283-L298</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/Comp.sol#L234-L238\">Comp.sol#L234-L238</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/ERC20.sol#L248-L251\">ERC20.sol#L248-L251</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/ERC20.sol#L276-L277\">ERC20.sol#L276-L277</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/CNote.sol#L17\">CNote.sol#L17</a></li>\n</ul>\n<h2 id=\"g-05-i-costs-less-gas-compared-to-i-or-i--1\" style=\"position:relative;\"><a href=\"#g-05-i-costs-less-gas-compared-to-i-or-i--1\" aria-label=\"g 05 i costs less gas compared to i or i  1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-05] <code>++i</code> costs less gas compared to <code>i++</code> or <code>i += 1</code></h2>\n<p><code>++i</code> costs less gas compared to <code>i++</code> or <code>i += 1</code> for unsigned integer, as pre-increment is cheaper (about 5 gas per iteration). This statement is true even with the optimizer enabled.</p>\n<p><code>i++</code> increments <code>i</code> and returns the initial value of <code>i</code>. Which means:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">1</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">i</span><span class=\"mtk1\">++; </span><span class=\"mtk3\">// == 1 but i == 2</span></span></span></code></pre>\n<p>But <code>++i</code> returns the actual incremented value:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">1</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">++</span><span class=\"mtk12\">i</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// == 2 and i == 2 too, so no need for a temporary variable</span></span></span></code></pre>\n<p>In the first case, the compiler has to create a temporary variable (when used) for returning <code>1</code> instead of <code>2</code>.<br>\nI suggest using <code>++i</code> instead of <code>i++</code> to increment the value of an uint variable. Same thing for <code>--i</code> and <code>i--</code></p>\n<p>Affected source code:</p>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorBravoDelegate.sol#L66\">GovernorBravoDelegate.sol#L66</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorBravoDelegate.sol#L88\">GovernorBravoDelegate.sol#L88</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorAlpha.sol#L181\">GovernorAlpha.sol#L181</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorAlpha.sol#L197\">GovernorAlpha.sol#L197</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorAlpha.sol#L211\">GovernorAlpha.sol#L211</a></li>\n</ul>\n<h2 id=\"g-06-use-external-visibility\" style=\"position:relative;\"><a href=\"#g-06-use-external-visibility\" aria-label=\"g 06 use external visibility permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-06] Use <code>external</code> visibility</h2>\n<p>The following methods could be improved if <code>external</code> visibility is used:</p>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorAlpha.sol#L136\">GovernorAlpha.sol#L136</a></li>\n</ul>\n<h2 id=\"g-07-theres-no-need-to-set-default-values-for-variables\" style=\"position:relative;\"><a href=\"#g-07-theres-no-need-to-set-default-values-for-variables\" aria-label=\"g 07 theres no need to set default values for variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-07] There’s no need to set default values for variables</h2>\n<p>If a variable is not set/initialized, the default value is assumed (0, <code>false</code>, 0x0 … depending on the data type). You are simply wasting gas if you directly initialize it with its default value.</p>\n<p>Affected source code:</p>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorBravoDelegate.sol#L66\">GovernorBravoDelegate.sol#L66</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorBravoDelegate.sol#L88\">GovernorBravoDelegate.sol#L88</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorAlpha.sol#L181\">GovernorAlpha.sol#L181</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorAlpha.sol#L197\">GovernorAlpha.sol#L197</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorAlpha.sol#L211\">GovernorAlpha.sol#L211</a></li>\n</ul>\n<h2 id=\"g-08-reduce-boolean-comparison\" style=\"position:relative;\"><a href=\"#g-08-reduce-boolean-comparison\" aria-label=\"g 08 reduce boolean comparison permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-08] Reduce boolean comparison</h2>\n<p>It’s compared a boolean value using <code>== true</code> or <code>== false</code>, instead of using the boolean value. <code>NOT</code> opcode, it’s cheaper to use <code>EQUAL</code> or <code>NOTEQUAL</code> when the value it’s false, or just the value without <code>== true</code> when it’s true, because it will use less opcodes inside the VM.</p>\n<p>Change <code>== false</code> by <code>!</code> in:</p>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/GovernorAlpha.sol#L266\">GovernorAlpha.sol#L266</a></li>\n</ul>\n<h2 id=\"g-09-unused-arguments\" style=\"position:relative;\"><a href=\"#g-09-unused-arguments\" aria-label=\"g 09 unused arguments permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-09] Unused arguments</h2>\n<p>Is not required to send the <code>nonce</code>, only is required for compute the signature.</p>\n<p>Affected source code:</p>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Governance/Comp.sol#L161\">Comp.sol#L161</a></li>\n</ul>\n<h2 id=\"g-10-gas-saving-using-immutable\" style=\"position:relative;\"><a href=\"#g-10-gas-saving-using-immutable\" aria-label=\"g 10 gas saving using immutable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-10] Gas saving using <code>immutable</code></h2>\n<p>It’s possible to avoid storage access a save gas using <code>immutable</code> keyword for the following variables:</p>\n<p>It’s also better to remove the initial values, because they will be set during the constructor.</p>\n<p>Affected source code:</p>\n<ul>\n<li>Remove <code>_setupDecimals</code> method and change <code>_decimals</code> to immutable. Decimals should never change in <a href=\"https://github.com/Plex-Engineer/manifest-v2/blob/3aedf21400a470a50c9be6e38f1ca57f061eca46/contracts/ERC20MinterBurnerDecimals.sol#L30\">ERC20MinterBurnerDecimals.sol#L30</a></li>\n<li><code>dripStart</code>, <code>dripRate</code>, <code>token</code> and <code>target</code> in <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Reservoir.sol#L34-L37\">Reservoir.sol#L34-L37</a></li>\n<li><code>_name</code>, <code>_symbol</code> and <code>_decimals</code> in <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/WETH.sol#L6-L8\">WETH.sol#L6-L8</a></li>\n<li><code>_name</code> and <code>_symbol</code> in <a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/ERC20.sol#L30-L31\">ERC20.sol#L30-L31</a></li>\n</ul>\n<h2 id=\"g-11-unused-import\" style=\"position:relative;\"><a href=\"#g-11-unused-import\" aria-label=\"g 11 unused import permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-11] Unused import</h2>\n<p>Importing pointless files costs gas during deployment and is a bad coding practice that is important to ignore.</p>\n<p>Remove the following imports:</p>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/Reservoir.sol#L103\">Reservoir.sol#L103</a></li>\n</ul>\n<h2 id=\"g-12-unckecked-keyword\" style=\"position:relative;\"><a href=\"#g-12-unckecked-keyword\" aria-label=\"g 12 unckecked keyword permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-12] <code>unckecked</code> keyword</h2>\n<p>It’s possible to save gas using the <code>unckecked</code> keyword. This will avoid the required checks to ensure that the variable won’t overflow.</p>\n<p>Reference:</p>\n<ul>\n<li><a href=\"https://docs.soliditylang.org/en/v0.8.0/control-structures.html#checked-or-unchecked-arithmetic\">https://docs.soliditylang.org/en/v0.8.0/control-structures.html#checked-or-unchecked-arithmetic</a></li>\n</ul>\n<p>The balance was checked before, it can be subtracted without checking overflows:</p>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/WETH.sol#L30\">WETH.sol#L30</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/WETH.sol#L73\">WETH.sol#L73</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/WETH.sol#L76\">WETH.sol#L76</a></li>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/ERC20.sol#L213\">ERC20.sol#L213</a></li>\n</ul>\n<h2 id=\"g-13-use-constant-instead-of-storage\" style=\"position:relative;\"><a href=\"#g-13-use-constant-instead-of-storage\" aria-label=\"g 13 use constant instead of storage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-13] use <code>constant</code> instead of storage</h2>\n<p>Use constant instead of storage and change from <code>uint256 MAX_INT = 2**256-1;</code> to <code>uint256 private constant MAX_INT = type(uint256).max;</code>:</p>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/ERC20.sol#L18\">ERC20.sol#L18</a></li>\n</ul>\n<h2 id=\"g-14-unrequired-method\" style=\"position:relative;\"><a href=\"#g-14-unrequired-method\" aria-label=\"g 14 unrequired method permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-14] Unrequired method</h2>\n<p>Method not necessary since the implemented logic only calls to obtain the current block.</p>\n<p>Affected source code:</p>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/CToken.sol#L201\">CToken.sol#L201</a></li>\n</ul>\n<h2 id=\"g-15-optimize-logic\" style=\"position:relative;\"><a href=\"#g-15-optimize-logic\" aria-label=\"g 15 optimize logic permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-15] Optimize logic</h2>\n<p>The logic of the <code>CToken.transferTokens</code> method can bypass the <code>startingAllowance</code> condition and the <code>allowanceNew</code> variable if the <code>spender</code> and <code>src</code> checks are done at the same time the tokens are subtracted.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">spender</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">src</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">transferAllowances</span><span class=\"mtk1\">[</span><span class=\"mtk12\">src</span><span class=\"mtk1\">][</span><span class=\"mtk12\">spender</span><span class=\"mtk1\">] -= </span><span class=\"mtk12\">tokens</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>Affected source code:</p>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/CToken.sol#L82\">CToken.sol#L82</a></li>\n</ul>\n<h2 id=\"g-16-use-memory-instead-of-storage\" style=\"position:relative;\"><a href=\"#g-16-use-memory-instead-of-storage\" aria-label=\"g 16 use memory instead of storage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-16] Use <code>memory</code> instead of <code>storage</code></h2>\n<p>Changing <code>storage</code> to <code>memory</code> we can save some storage access.</p>\n<p>Affected source code:</p>\n<ul>\n<li><a href=\"https://github.com/Plex-Engineer/lending-market-v2/blob/2646a7676b721db8a7754bf5503dcd712eab2f8a/contracts/CToken.sol#L255\">CToken.sol#L255</a></li>\n</ul>\n<p><strong><a href=\"https://github.com/code-423n4/2022-06-canto-v2-findings/issues/55#issuecomment-1215990506\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Packing<br>\n-> Will save in writing and reading, let’s say 2.1k * 2 for two saved SLOADs</p>\n<p>Immutables<br>\n9* 2100 (ignoring ERC20MinterBurnerDecimals as out of scope)</p>\n<p><strong>[G-13] Use constant instead of storage</strong><br>\n2.1k</p>\n<p>Rest seems minor.</p>\n<p>Big gas savings by reducing storage, nice finds.</p>\n<p>25200</p>\n</blockquote>\n<hr>\n<h1 id=\"disclosures\" style=\"position:relative;\"><a href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Disclosures</h1>\n<p>C4 is an open organization governed by participants in the community.</p>\n<p>C4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.</p>\n<p>C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>",
  "toc": "<ul>\n<li>\n<p><a href=\"#overview\">Overview</a></p>\n<ul>\n<li><a href=\"#about-c4\">About C4</a></li>\n<li><a href=\"#wardens\">Wardens</a></li>\n</ul>\n</li>\n<li><a href=\"#summary\">Summary</a></li>\n<li><a href=\"#scope\">Scope</a></li>\n<li><a href=\"#severity-criteria\">Severity Criteria</a></li>\n<li>\n<p><a href=\"#high-risk-findings-8\">High Risk Findings (8)</a></p>\n<ul>\n<li><a href=\"#h-01-total-supply-can-be-incorrect-in-erc20\">[H-01] Total supply can be incorrect in <code>ERC20</code></a></li>\n<li><a href=\"#h-02-deny-of-service-in-cnotedotransferout\">[H-02] Deny of service in <code>CNote.doTransferOut</code></a></li>\n<li><a href=\"#h-03-underlying-asset-price-oracle-for-ctoken-in-basev1-periphery-is-inaccurate\">[H-03] Underlying asset price oracle for <code>CToken</code> in <code>BaseV1-periphery</code> is inaccurate</a></li>\n<li><a href=\"#h-04-oracle-periodsize-is-very-low-allowing-the-twap-price-to-be-easily-manipulated\">[H-04] Oracle <code>periodSize</code> is very low allowing the TWAP price to be easily manipulated</a></li>\n<li><a href=\"#h-05-the-lp-pair-underlying-price-quote-could-be-manipulated\">[H-05] The LP pair underlying price quote could be manipulated</a></li>\n<li><a href=\"#h-06-getborrowrate-returns-rate-per-year-instead-of-per-block\">[H-06] <code>getBorrowRate</code> returns rate per year instead of per block</a></li>\n<li><a href=\"#h-07-deny-of-service-in-accountantdelegatesweepinterest\">[H-07] Deny of service in <code>AccountantDelegate.sweepInterest</code></a></li>\n<li><a href=\"#h-08-accountantdelegate-the-sweepinterest-function-sweeps-an-incorrect-number-of-cnote\">[H-08] AccountantDelegate: The sweepInterest function sweeps an incorrect number of cnote</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#medium-risk-findings-6\">Medium Risk Findings (6)</a></p>\n<ul>\n<li><a href=\"#m-01-stableswap---deadline-do-not-work\">[M-01] Stableswap - Deadline do not work</a></li>\n<li><a href=\"#m-02-multiple-initialization-in-noteinterest\">[M-02] Multiple initialization in <code>NoteInterest</code></a></li>\n<li><a href=\"#m-03-non-view-function-is-called-with-staticcall-in-cerc20delegator\">[M-03] Non view function is called with staticcall in <code>CErc20Delegator</code></a></li>\n<li><a href=\"#m-04-missing-zero-address-check-can-cause-initialize-to-be-called-more-than-once\">[M-04] Missing zero address check can cause initialize to be called more than once</a></li>\n<li><a href=\"#m-05-admin-can-break-all-functionality-through-weth-address\">[M-05] Admin Can Break All Functionality Through Weth Address</a></li>\n<li><a href=\"#m-06-a-cap-is-needed-on-the-amount-of-note-than-can-be-borrowed\">[M-06] A cap is needed on the amount of Note than can be borrowed</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#low-risk-and-non-critical-issues\">Low Risk and Non-Critical Issues</a></p>\n<ul>\n<li><a href=\"#l-01-price-not-scaled-by-the-base-in-basev1router01\">L-01 Price not scaled by the BASE in <code>BaseV1Router01</code></a></li>\n<li><a href=\"#l-02-_acceptinitialadmindelegated-will-revert-in-governorbravodelegator\">L-02 <code>_acceptInitialAdminDelegated</code> will revert in <code>GovernorBravoDelegator</code></a></li>\n<li><a href=\"#l-03-desirable-underflow--overflow-in-basev1pair\">L-03 Desirable underflow / overflow in <code>BaseV1Pair</code></a></li>\n<li><a href=\"#l-04-lack-of-zero-address-check\">L-04 Lack of zero address check</a></li>\n<li><a href=\"#l-05-oracle-failure-check-in-noteratemodel\">L-05 Oracle failure check in <code>NoteRateModel</code></a></li>\n<li><a href=\"#l-06-storage-for-delegate-is-outside-of-storage-contract-in-cnote\">L-06 Storage for delegate is outside of storage contract in <code>CNote</code></a></li>\n<li><a href=\"#n-01-cast-to-int-without-checking-in-noteratemodel\">N-01 Cast to <code>int</code> without checking in <code>NoteRateModel</code></a></li>\n<li><a href=\"#n-02-meaningless-check-in-governorbravodelegate\">N-02 Meaningless check in <code>GovernorBravoDelegate</code></a></li>\n<li><a href=\"#n-03-missing-param-in-natspec-in-ctoken\">N-03 Missing param in NatSpec in <code>CToken</code></a></li>\n<li><a href=\"#n-04-misleading-natspec-in-accountantdelegator\">N-04 Misleading NatSpec in <code>AccountantDelegator</code></a></li>\n<li><a href=\"#n-05-typos\">N-05 Typos</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#gas-optimizations\">Gas Optimizations</a></p>\n<ul>\n<li><a href=\"#g-01-use-abiencodewithselector-instead-of-abiencodewithsignature\">G-01 Use <code>abi.encodeWithSelector</code> instead of <code>abi.encodeWithSignature</code></a></li>\n<li><a href=\"#g-02-avoid-creating-unnecessary-variables\">G-02 Avoid creating unnecessary variables</a></li>\n<li><a href=\"#g-03-reorder-structure-layout\">G-03 Reorder structure layout</a></li>\n<li><a href=\"#g-04-reduce-the-size-of-error-messages-long-revert-strings\">G-04 Reduce the size of error messages (Long revert Strings)</a></li>\n<li><a href=\"#g-05-i-costs-less-gas-compared-to-i-or-i--1\">G-05 <code>++i</code> costs less gas compared to <code>i++</code> or <code>i += 1</code></a></li>\n<li><a href=\"#g-06-use-external-visibility\">G-06 Use <code>external</code> visibility</a></li>\n<li><a href=\"#g-07-theres-no-need-to-set-default-values-for-variables\">G-07 There’s no need to set default values for variables</a></li>\n<li><a href=\"#g-08-reduce-boolean-comparison\">G-08 Reduce boolean comparison</a></li>\n<li><a href=\"#g-09-unused-arguments\">G-09 Unused arguments</a></li>\n<li><a href=\"#g-10-gas-saving-using-immutable\">G-10 Gas saving using <code>immutable</code></a></li>\n<li><a href=\"#g-11-unused-import\">G-11 Unused import</a></li>\n<li><a href=\"#g-12-unckecked-keyword\">G-12 <code>unckecked</code> keyword</a></li>\n<li><a href=\"#g-13-use-constant-instead-of-storage\">G-13 use <code>constant</code> instead of storage</a></li>\n<li><a href=\"#g-14-unrequired-method\">G-14 Unrequired method</a></li>\n<li><a href=\"#g-15-optimize-logic\">G-15 Optimize logic</a></li>\n<li><a href=\"#g-16-use-memory-instead-of-storage\">G-16 Use <code>memory</code> instead of <code>storage</code></a></li>\n</ul>\n</li>\n<li><a href=\"#disclosures\">Disclosures</a></li>\n</ul>"
}