{
  "circa": {
    "title": "prePO Solo Audit by cccz",
    "sponsor": "prePO",
    "slug": "2022-08-prepo",
    "date": "2022-09-06",
    "findings": "",
    "contest": 158
  },
  "html": "<h1 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h1>\n<h2 id=\"about-c4\" style=\"position:relative;\"><a href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>About C4</h2>\n<p>Code4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts. </p>\n<p>A C4 Solo Audit is an event where a top Code4rena contributor, commonly referred to as a warden or a team, reviews, audits and analyzes smart contract logic in exchange for a bounty provided by sponsoring projects.</p>\n<p>During the Solo Audit outlined in this document, C4 conducted an analysis of the prePO code. The audit took place between August 23-31, 2022.</p>\n<p>Following the Solo Audit, warden cccz reviewed the mitigations for all identified issues; the mitigation review report is appended below the audit contest report. </p>\n<h2 id=\"wardens\" style=\"position:relative;\"><a href=\"#wardens\" aria-label=\"wardens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wardens</h2>\n<p>Audit and mitigation review completed by cccz.</p>\n<p>Final report assembled by <a href=\"https://twitter.com/itsmetechjay\">itsmetechjay</a>.</p>\n<h1 id=\"summary\" style=\"position:relative;\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h1>\n<p>The prePO Solo Audit yielded 4 MEDIUM vulnerabilities. There were also 3 informational findings and 13 gas optimizations reported.</p>\n<p>Of these, 3 vulnerabilities and 13 gas optimizations have been fixed. 3 informational findings have been acknowledged.  </p>\n<p>The codebase in question had already undergone one prior Code4rena contest. </p>\n<h1 id=\"scope\" style=\"position:relative;\"><a href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scope</h1>\n<p>Code reviewed consisted of the following files:</p>\n<ul>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/tree/chore/token-audit-version/apps/smart-contracts/token/contracts/ppo/PPO.sol\">PPO.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/tree/chore/token-audit-version/apps/smart-contracts/token/contracts/ppo/AccountList.sol\">AccountList.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/tree/chore/token-audit-version/apps/smart-contracts/token/contracts/ppo/BlocklistTransferHook.sol\">BlocklistTransferHook.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/tree/chore/token-audit-version/apps/smart-contracts/token/contracts/ppo/RestrictedTransferHook.sol\">RestrictedTransferHook.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/tree/chore/token-audit-version/apps/smart-contracts/token/contracts/mini-sales/MiniSales.sol\">MiniSales.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/tree/chore/token-audit-version/apps/smart-contracts/token/contracts/mini-sales/AllowlistPurchaseHook.sol\">AllowlistPurchaseHook.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/tree/chore/token-audit-version/apps/smart-contracts/token/contracts/vesting/Vesting.sol\">Vesting.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/tree/chore/token-audit-version/apps/smart-contracts/token/contracts/token-shop/TokenShop.sol\">TokenShop.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/tree/chore/token-audit-version/apps/smart-contracts/token/contracts/token-shop/PurchaseHook.sol\">PurchaseHook.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/tree/chore/token-audit-version/packages/prepo-shared-contracts/contracts/Pausable.sol\">Pausable.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/tree/chore/token-audit-version/packages/prepo-shared-contracts/contracts/SafeOwnable.sol\">SafeOwnable.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/tree/chore/token-audit-version/packages/prepo-shared-contracts/contracts/SafeOwnableUpgradeable.sol\">SafeOwnableUpgradeable.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/tree/chore/token-audit-version/packages/prepo-shared-contracts/contracts/SafeOwnableCaller.sol\">SafeOwnableCaller.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/blob/chore/token-audit-version/packages/prepo-shared-contracts/contracts/SafeAccessControlEnumerable.sol\">SafeAccessControlEnumerable.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/blob/chore/token-audit-version/packages/prepo-shared-contracts/contracts/SafeAccessControlEnumerableUpgradeable.sol\">SafeAccessControlEnumerableUpgradeable.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/blob/chore/token-audit-version/packages/prepo-shared-contracts/contracts/SafeAccessControlEnumerableCaller.sol\">SafeAccessControlEnumerableCaller.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/tree/chore/token-audit-version/packages/prepo-shared-contracts/contracts/WithdrawERC20.sol\">WithdrawERC20.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/tree/chore/token-audit-version/packages/prepo-shared-contracts/contracts/WithdrawERC721.sol\">WithdrawERC721.sol</a></li>\n<li><a href=\"https://github.com/prepo-io/prepo-monorepo/tree/chore/token-audit-version/packages/prepo-shared-contracts/contracts/WithdrawERC1155.sol\">WithdrawERC1155.sol</a></li>\n</ul>\n<h1 id=\"severity-criteria\" style=\"position:relative;\"><a href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Severity Criteria</h1>\n<p>C4 assesses the severity of disclosed vulnerabilities according to a methodology based on <a href=\"https://owasp.org/www-community/OWASP_Risk_Rating_Methodology\">OWASP standards</a>.</p>\n<p>Vulnerabilities are divided into three primary risk categories: high, medium, and low/non-critical.</p>\n<p>High-level considerations for vulnerabilities span the following key areas when conducting assessments:</p>\n<ul>\n<li>Malicious Input Handling</li>\n<li>Escalation of privileges</li>\n<li>Arithmetic</li>\n<li>Gas use</li>\n</ul>\n<p>Further information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on <a href=\"https://code4rena.com\">the C4 website</a>.</p>\n<h1 id=\"medium-risk-findings-4\" style=\"position:relative;\"><a href=\"#medium-risk-findings-4\" aria-label=\"medium risk findings 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Medium Risk Findings (4)</h1>\n<h2 id=\"m-01-token-transfers-do-not-verify-that-the-tokens-were-successfully-transferred\" style=\"position:relative;\"><a href=\"#m-01-token-transfers-do-not-verify-that-the-tokens-were-successfully-transferred\" aria-label=\"m 01 token transfers do not verify that the tokens were successfully transferred permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[M-01] Token transfers do not verify that the tokens were successfully transferred</h2>\n<p>Some tokens (like <a href=\"https://etherscan.io/token/0xe41d2489571d322189246dafa5ebde1f4699f498#code\">zrx</a>) do not revert the transaction when the transfer/transferfrom fails and return false, which requires us to check the return value after calling the transfer/transferfrom function. </p>\n<p>In the purchase functions of MiniSales and TokenShop contracts, if _paymentToken is such a token, the user can purchase _saleToken and NFT without spending any tokens.</p>\n<p>In the claim function of the Vesting contract, if _token is such a token, the user may lose his vested tokens.</p>\n<h3 id=\"proof-of-concept\" style=\"position:relative;\"><a href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/apps/smart-contracts/token/contracts/mini-sales/MiniSales.sol#L25-L26\">https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/apps/smart-contracts/token/contracts/mini-sales/MiniSales.sol#L25-L26</a></p>\n<p><a href=\"https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/apps/smart-contracts/token/contracts/token-shop/TokenShop.sol#L41-L42\">https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/apps/smart-contracts/token/contracts/token-shop/TokenShop.sol#L41-L42</a></p>\n<p><a href=\"https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/apps/smart-contracts/token/contracts/vesting/Vesting.sol#L66-L67\">https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/apps/smart-contracts/token/contracts/vesting/Vesting.sol#L66-L67</a></p>\n<h3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Use SafeERC20’s safeTransfer/safeTransferFrom functions</p>\n<p><a href=\"https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/utils/SafeERC20.sol\">https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/utils/SafeERC20.sol</a></p>\n<p><strong>cccz (warden) commented:</strong></p>\n<blockquote>\n<p>Only security-compliant tokens such as USDC and PPO are currently planned to be used in the contracts.</p>\n</blockquote>\n<h2 id=\"m-02-tokenshop-purchase-function-should-add-_purchaseprices-parameter\" style=\"position:relative;\"><a href=\"#m-02-tokenshop-purchase-function-should-add-_purchaseprices-parameter\" aria-label=\"m 02 tokenshop purchase function should add _purchaseprices parameter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[M-02] TokenShop: purchase function should add _purchasePrices parameter</h2>\n<p>In the purchase function of the TokenShop contract, the price of the NFT is represented by _contractToIdToPrice, and _contractToIdToPrice can be set by the owner in the setContractToIdToPrice function.</p>\n<p>If setContractToIdToPrice and the purchase function are executed in the same block, the user may suffer a loss due to the new _contractToIdToPrice.</p>\n<p>Consider the following scenarios:</p>\n<p>The current _contractToIdToPrice is 500. the user likes the price, and the purchase function is called.</p>\n<p>But at this time, the setContractToIdToPrice function is called, setting the _contractToIdToPrice to 1000, and this transaction occurs before executing the purchase function, causing the user to execute the purchase function in the case of _contractToIdToPrice 1000.</p>\n<h3 id=\"proof-of-concept-1\" style=\"position:relative;\"><a href=\"#proof-of-concept-1\" aria-label=\"proof of concept 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/apps/smart-contracts/token/contracts/token-shop/TokenShop.sol#L35-L41\">https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/apps/smart-contracts/token/contracts/token-shop/TokenShop.sol#L35-L41</a></p>\n<p><a href=\"https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/apps/smart-contracts/token/contracts/token-shop/TokenShop.sol#L26-L31\">https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/apps/smart-contracts/token/contracts/token-shop/TokenShop.sol#L26-L31</a></p>\n<h3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Add the <em>purchasePrices parameter to the purchase function of TokenShop, and verify that _purchasePrices[i] >= _contractToIdToPrice[</em>tokenContracts[i]][_ids[i]]</p>\n<p><strong>prePO (sponsor) confirmed and resolved:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/355\">PR 355</a>.</p>\n</blockquote>\n<p><strong>cccz (warden) reviewed mitigation:</strong></p>\n<blockquote>\n<p>Fixed by adding <code>purchasePrices</code> parameter in <code>purchase()</code> to avoid race condition and ensure that tokens are not purchased at higher prices than the user intended.</p>\n</blockquote>\n<h2 id=\"m-03-safeaccesscontrolenumerablecaller-and-safeownablecaller-contracts-lack-access-control\" style=\"position:relative;\"><a href=\"#m-03-safeaccesscontrolenumerablecaller-and-safeownablecaller-contracts-lack-access-control\" aria-label=\"m 03 safeaccesscontrolenumerablecaller and safeownablecaller contracts lack access control permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[M-03] SafeAccessControlEnumerableCaller and SafeOwnableCaller contracts lack access control</h2>\n<p>The SafeAccessControlEnumerableCaller and SafeOwnableCaller contracts are abstract contracts that are used to call privileged functions in the SafeAccessControlEnumerable and SafeOwnable contracts. </p>\n<p>Contracts that inherit from *caller are required to override the non-view functions in the *caller contract to prevent anyone from calling privileged functions in *caller.</p>\n<p>But once the inheriting contract does not override all the non-view functions, anyone can call the unoverridden privileged functions in the *caller.</p>\n<p>Since the functions implemented in the abstract contract are no longer forced to be implemented again by the inheriting contract, the contract can be deployed even if the inheriting contract does not override all the non-view functions.</p>\n<h3 id=\"proof-of-concept-2\" style=\"position:relative;\"><a href=\"#proof-of-concept-2\" aria-label=\"proof of concept 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/packages/prepo-shared-contracts/contracts/SafeAccessControlEnumerableCaller.sol#L8-L55\">https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/packages/prepo-shared-contracts/contracts/SafeAccessControlEnumerableCaller.sol#L8-L55</a></p>\n<p><a href=\"https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/packages/prepo-shared-contracts/contracts/SafeOwnableCaller.sol#L7-L23\">https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/packages/prepo-shared-contracts/contracts/SafeOwnableCaller.sol#L7-L23</a></p>\n<h3 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Consider adding simple access control to the *caller contract.\nOr instead of implementing functions in the *caller, provide the code as comments or documentation for use in inheriting contracts.</p>\n<p><strong>prePO (sponsor) confirmed and resolved:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/352\">PR 352</a>.</p>\n</blockquote>\n<p><strong>cccz (warden) reviewed mitigation:</strong></p>\n<blockquote>\n<p>Fixed by removing all write methods from <code>SafeOwnableCaller</code> <code>and SafeAccessControlEnumerableCaller</code> to ensure that the inheriting contracts need to override all write methods. This will avoid missing out of access control on some critical write methods.</p>\n</blockquote>\n<h2 id=\"m-04-no-storage-gap-for-upgradeable-contracts\" style=\"position:relative;\"><a href=\"#m-04-no-storage-gap-for-upgradeable-contracts\" aria-label=\"m 04 no storage gap for upgradeable contracts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[M-04] No storage gap for upgradeable contracts</h2>\n<p>For SafeAccessControlEnumerableUpgradeable and SafeOwnableUpgradeable, which are upgradeable abstract contracts, inheriting contracts may introduce new variables. In order to be able to add new variables to the upgradeable abstract contract without causing storage collisions, a storage gap should be added to the upgradeable abstract contract.</p>\n<p>If no storage gap is added, when the upgradable abstract contract introduces new variables, it may override the variables in the inheriting contract.</p>\n<h3 id=\"proof-of-concept-3\" style=\"position:relative;\"><a href=\"#proof-of-concept-3\" aria-label=\"proof of concept 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/packages/prepo-shared-contracts/contracts/SafeAccessControlEnumerableUpgradeable.sol#L7-L9\">https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/packages/prepo-shared-contracts/contracts/SafeAccessControlEnumerableUpgradeable.sol#L7-L9</a></p>\n<p><a href=\"https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/packages/prepo-shared-contracts/contracts/SafeOwnableUpgradeable.sol#L7-L8\">https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/packages/prepo-shared-contracts/contracts/SafeOwnableUpgradeable.sol#L7-L8</a></p>\n<h3 id=\"recommended-mitigation-steps-3\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-3\" aria-label=\"recommended mitigation steps 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Consider adding a storage gap at the end of the upgradeable abstract contract</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">uint256[50] private __gap;</span></span></code></pre>\n<p><strong>prePO (sponsor) confirmed and resolved:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/356\">PR 356</a>.</p>\n</blockquote>\n<p><strong>cccz (warden) reviewed mitigation:</strong></p>\n<blockquote>\n<p>Fixed by adding uint256[50]  <code>private __gap</code> in abstract upgradeable smart contracts to ensure no storage shifting down storage in the inheritance chain of the inheriting contracts.</p>\n</blockquote>\n<hr>\n<h1 id=\"informational-findings-3\" style=\"position:relative;\"><a href=\"#informational-findings-3\" aria-label=\"informational findings 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Informational Findings (3)</h1>\n<h2 id=\"info-01-tokenshop-_contracttoidtoprice-should-be-reset-after-user-purchases-nft\" style=\"position:relative;\"><a href=\"#info-01-tokenshop-_contracttoidtoprice-should-be-reset-after-user-purchases-nft\" aria-label=\"info 01 tokenshop _contracttoidtoprice should be reset after user purchases nft permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[Info-01] TokenShop: _contractToIdToPrice should be reset after user purchases NFT</h2>\n<p>In the purchase function of a TokenShop contract, <code>_contractToIdToPrice</code> is not reset after the NFT is sold. In some cases this may cause the contract to suffer a loss.</p>\n<p>Consider the following scenario:</p>\n<ul>\n<li>The TokenShop contract sells an NFT for 1000 USDC. </li>\n<li>After some time, the price of the NFT rises to 3000 USDC.</li>\n<li>The owner of the TokenShop contract buys the NFT again from the market and sends it to the contract to be sold.</li>\n<li>Since the current _contractToIdToPrice of the NFT is still 1000 USDC, the user can buy the NFT at 1000 USDC before the owner sets a new price.</li>\n</ul>\n<h3 id=\"proof-of-concept-4\" style=\"position:relative;\"><a href=\"#proof-of-concept-4\" aria-label=\"proof of concept 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/apps/smart-contracts/token/contracts/token-shop/TokenShop.sol#L35-L53\">https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/apps/smart-contracts/token/contracts/token-shop/TokenShop.sol#L35-L53</a></p>\n<h3 id=\"recommended-mitigation-steps-4\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-4\" aria-label=\"recommended mitigation steps 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>For ERC721, reset <code>_contractToIdToPrice</code> when the id is sold.</p>\n<p>For ERC1155, reset <code>_contractToIdToPrice</code> when the id has a balance of 0 in the contract</p>\n<h2 id=\"info-02-withdrawerc721-using-the-transferfrom-function-of-an-erc721-contract-may-freeze-the-users-nft\" style=\"position:relative;\"><a href=\"#info-02-withdrawerc721-using-the-transferfrom-function-of-an-erc721-contract-may-freeze-the-users-nft\" aria-label=\"info 02 withdrawerc721 using the transferfrom function of an erc721 contract may freeze the users nft permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[Info-02] WithdrawERC721: Using the transferFrom function of an ERC721 contract may freeze the user’s NFT</h2>\n<p>When using the <code>transferFrom</code> function of an ERC721 contract to send an NFT, if the receiving address is a smart contract and does not support ERC721, the NFT can be frozen in the contract.</p>\n<h3 id=\"proof-of-concept-5\" style=\"position:relative;\"><a href=\"#proof-of-concept-5\" aria-label=\"proof of concept 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/packages/prepo-shared-contracts/contracts/WithdrawERC721.sol#L14-L15\">https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/packages/prepo-shared-contracts/contracts/WithdrawERC721.sol#L14-L15</a></p>\n<h3 id=\"recommended-mitigation-steps-5\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-5\" aria-label=\"recommended mitigation steps 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Use the ERC721 contract’s <code>safeTransferFrom</code> function to send NFTs.</p>\n<h2 id=\"info-03-centralization-problems-in-vesting-contract\" style=\"position:relative;\"><a href=\"#info-03-centralization-problems-in-vesting-contract\" aria-label=\"info 03 centralization problems in vesting contract permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[Info-03] Centralization problems in Vesting contract</h2>\n<p>In the Vesting contract, there are some centralization problems:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">\ta) The owner can change _token at any time</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">\tb) The owner can reduce the recipient&#39;s vested amount at any time</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">\tc) The owner can withdraw the vested tokens in the contract at any time</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">\td) The owner can extend the vesting end time indefinitely</span></span></code></pre>\n<p>Since these problems can cause the recipient to suffer losses, the recipient may not trust the Vesting Contract.</p>\n<h3 id=\"proof-of-concept-6\" style=\"position:relative;\"><a href=\"#proof-of-concept-6\" aria-label=\"proof of concept 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/apps/smart-contracts/token/contracts/vesting/Vesting.sol#L23-L59\">https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/apps/smart-contracts/token/contracts/vesting/Vesting.sol#L23-L59</a></p>\n<p><a href=\"https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/packages/prepo-shared-contracts/contracts/WithdrawERC20.sol#L14-L19\">https://github.com/prepo-io/prepo-monorepo/blob/9ed5587e557a1189df6c5bb0229ad8c171eaabce/packages/prepo-shared-contracts/contracts/WithdrawERC20.sol#L14-L19</a></p>\n<h3 id=\"recommended-mitigation-steps-6\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-6\" aria-label=\"recommended mitigation steps 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Consider limiting the owner’s abilities.</p>\n<hr>\n<h1 id=\"gas-optimizations-13\" style=\"position:relative;\"><a href=\"#gas-optimizations-13\" aria-label=\"gas optimizations 13 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gas Optimizations [13]</h1>\n<h2 id=\"g-01-minisalespurchase-should-use-memory-instead-of-storage-variable\" style=\"position:relative;\"><a href=\"#g-01-minisalespurchase-should-use-memory-instead-of-storage-variable\" aria-label=\"g 01 minisalespurchase should use memory instead of storage variable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-01] MiniSales.purchase(): SHOULD USE MEMORY INSTEAD OF STORAGE VARIABLE</h2>\n<p>See @audit tag</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">  function purchase(address _recipient, uint256 _saleTokenAmount, uint256 _purchasePrice, bytes calldata _data) external override nonReentrant {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    require(_purchasePrice == _price, &quot;Price mismatch&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    if (address(_purchaseHook) != address(0)) { _purchaseHook.hook(_msgSender(), _recipient, _saleTokenAmount, _price, _data); } // @audit gas: should use  ..._saleTokenAmount, _purchasePrice, _data) </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    uint256 _paymentTokenAmount = (_saleTokenAmount * _price) / _saleTokenDecimals; // // @audit gas: should use  _saleTokenAmount * _purchasePrice</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    _paymentToken.transferFrom(_msgSender(), address(this), _paymentTokenAmount);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    _saleToken.transfer(_recipient, _saleTokenAmount);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    emit Purchase(_msgSender(), _recipient, _saleTokenAmount, _price); // @audit gas: should use  ..._saleTokenAmount, _purchasePrice)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  }</span></span></code></pre>\n<p><strong>prePO (sponsor) confirmed and resolved:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/357\">PR 357</a>.</p>\n</blockquote>\n<p><strong>cccz (warden) reviewed mitigation:</strong></p>\n<blockquote>\n<p>Fixed by using <code>_purchasePrice</code> (memory variable) instead of <code>_price</code> (storage variable).</p>\n</blockquote>\n<h2 id=\"g-02-minisalespurchase-_purchasehook-should-get-cached\" style=\"position:relative;\"><a href=\"#g-02-minisalespurchase-_purchasehook-should-get-cached\" aria-label=\"g 02 minisalespurchase _purchasehook should get cached permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-02] MiniSales.purchase(): _purchaseHook SHOULD GET CACHED</h2>\n<p>See @audit tag</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">  function purchase(address _recipient, uint256 _saleTokenAmount, uint256 _purchasePrice, bytes calldata _data) external override nonReentrant {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    require(_purchasePrice == _price, &quot;Price mismatch&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    if (address(_purchaseHook) != address(0)) // //@audit gas: should cache &quot;_purchaseHook&quot; (SLOAD 1)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">\t{ _purchaseHook.hook(_msgSender(), _recipient, _saleTokenAmount, _price, _data); } //@audit gas: should cache &quot;_purchaseHook&quot; (SLOAD 2)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    uint256 _paymentTokenAmount = (_saleTokenAmount * _price) / _saleTokenDecimals;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    _paymentToken.transferFrom(_msgSender(), address(this), _paymentTokenAmount);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    _saleToken.transfer(_recipient, _saleTokenAmount);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    emit Purchase(_msgSender(), _recipient, _saleTokenAmount, _price);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  }</span></span></code></pre>\n<p><strong>prePO (sponsor) confirmed and resolved:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/357\">PR 357</a>.</p>\n</blockquote>\n<p><strong>cccz (warden) reviewed mitigation:</strong></p>\n<blockquote>\n<p>Fixed along with [G-01] in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/357\">PR#357</a> by caching <code>_purchaseHook</code> (storage variable loaded twice).</p>\n</blockquote>\n<h2 id=\"g-03-tokenshoppurchase-_purchasehook-should-get-cached\" style=\"position:relative;\"><a href=\"#g-03-tokenshoppurchase-_purchasehook-should-get-cached\" aria-label=\"g 03 tokenshoppurchase _purchasehook should get cached permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-03] TokenShop.purchase(): _purchaseHook SHOULD GET CACHED</h2>\n<p>See @audit tag</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">  function purchase(address[] memory _tokenContracts, uint256[] memory _ids, uint256[] memory _amounts) external override nonReentrant whenNotPaused {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    require(_tokenContracts.length == _amounts.length &amp;&amp; _ids.length == _amounts.length, &quot;Array length mismatch&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    require(address(_purchaseHook) != address(0), &quot;Purchase hook not set&quot;); //@audit gas: should cache &quot;_purchaseHook&quot; (SLOAD 1)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    for (uint256 i; i &lt; _tokenContracts.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      require(_contractToIdToPrice[_tokenContracts[i]][_ids[i]] != 0, &quot;Non-purchasable item&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      uint256 _totalPaymentAmount = _contractToIdToPrice[_tokenContracts[i]][_ids[i]] * _amounts[i];</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      _paymentToken.transferFrom(_msgSender(), address(this), _totalPaymentAmount);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      bool _isERC1155 = IERC1155(_tokenContracts[i]).supportsInterface(type(IERC1155).interfaceId);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      if (_isERC1155) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _purchaseHook.hookERC1155(msg.sender, _tokenContracts[i], _ids[i], _amounts[i]); //@audit gas: should cache &quot;_purchaseHook&quot; (SLOAD IN LOOP)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _userToERC1155ToIdToPurchaseCount[msg.sender][_tokenContracts[i]][_ids[i]] += _amounts[i];</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        IERC1155(_tokenContracts[i]).safeTransferFrom(address(this), _msgSender(), _ids[i], _amounts[i], &quot;&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      } else {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _purchaseHook.hookERC721(msg.sender, _tokenContracts[i], _ids[i]); //@audit gas: should cache &quot;_purchaseHook&quot; (SLOAD IN LOOP)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        ++_userToERC721ToPurchaseCount[msg.sender][_tokenContracts[i]];</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        IERC721(_tokenContracts[i]).safeTransferFrom(address(this), _msgSender(), _ids[i]);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  }</span></span></code></pre>\n<p><strong>prePO (sponsor) confirmed and resolved:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/358\">PR 358</a>.</p>\n</blockquote>\n<p><strong>cccz (warden) reviewed mitigation:</strong></p>\n<blockquote>\n<p>Fixed by caching <code>_purchaseHook</code> (storage variable used in Loop).</p>\n</blockquote>\n<h2 id=\"g-04-tokenshoppurchase-_contracttoidtoprice-should-get-cached\" style=\"position:relative;\"><a href=\"#g-04-tokenshoppurchase-_contracttoidtoprice-should-get-cached\" aria-label=\"g 04 tokenshoppurchase _contracttoidtoprice should get cached permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-04] TokenShop.purchase(): _contractToIdToPrice SHOULD GET CACHED</h2>\n<p>See @audit tag</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">  function purchase(address[] memory _tokenContracts, uint256[] memory _ids, uint256[] memory _amounts) external override nonReentrant whenNotPaused {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    require(_tokenContracts.length == _amounts.length &amp;&amp; _ids.length == _amounts.length, &quot;Array length mismatch&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    require(address(_purchaseHook) != address(0), &quot;Purchase hook not set&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    for (uint256 i; i &lt; _tokenContracts.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      require(_contractToIdToPrice[_tokenContracts[i]][_ids[i]] != 0, &quot;Non-purchasable item&quot;); //@audit gas: should cache &quot;_contractToIdToPrice&quot; (SLOAD 1)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      uint256 _totalPaymentAmount = _contractToIdToPrice[_tokenContracts[i]][_ids[i]] * _amounts[i]; //@audit gas: should cache &quot;_contractToIdToPrice&quot; (SLOAD 2)</span></span></code></pre>\n<p><strong>cccz (warden) reviewed mitigation:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/355\">PR#355</a> by caching <code>_contractToIdToPrice</code>[<em>tokenContracts[i]][</em>ids[i]] to local <code>variable _price</code>.</p>\n</blockquote>\n<h2 id=\"g-05-blocklisttransferhookhook-_blocklist-should-get-cached\" style=\"position:relative;\"><a href=\"#g-05-blocklisttransferhookhook-_blocklist-should-get-cached\" aria-label=\"g 05 blocklisttransferhookhook _blocklist should get cached permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-05] BlocklistTransferHook.hook(): _blocklist SHOULD GET CACHED</h2>\n<p>See @audit tag</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">  function hook(address _from, address _to, uint256 _amount) public virtual override {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    require(!_blocklist.isIncluded(_from), &quot;Sender blocked&quot;); //@audit gas: should cache &quot;_blocklist&quot; (SLOAD 1)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    require(!_blocklist.isIncluded(_to), &quot;Recipient blocked&quot;); //@audit gas: should cache &quot;_blocklist&quot; (SLOAD 2)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  }</span></span></code></pre>\n<p><strong>prePO (sponsor) confirmed and resolved:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/359\">PR 359</a>.</p>\n</blockquote>\n<p><strong>cccz (warden) reviewed mitigation:</strong></p>\n<blockquote>\n<p>Fixed by caching<code>_blocklist</code> (storage variable loaded twice).</p>\n</blockquote>\n<h2 id=\"g-06-purchasehookhookerc721-_tokenshop-should-get-cached\" style=\"position:relative;\"><a href=\"#g-06-purchasehookhookerc721-_tokenshop-should-get-cached\" aria-label=\"g 06 purchasehookhookerc721 _tokenshop should get cached permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-06] PurchaseHook.hookERC721(): _tokenShop SHOULD GET CACHED</h2>\n<p>See @audit tag</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">  function hookERC721(address _user, address _tokenContract, uint256 _tokenId) external view override {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    require(address(_tokenShop) != address(0), &quot;Token shop not set in hook&quot;); //@audit gas: should cache &quot;_tokenShop&quot; (SLOAD 1)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    uint256 _maxPurchaseAmount = _erc721ToMaxPurchasesPerUser[_tokenContract];</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    if (_maxPurchaseAmount != 0) { </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      require(</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _tokenShop.getERC721PurchaseCount(_user, _tokenContract) &lt; //@audit gas: should cache &quot;_tokenShop&quot; (SLOAD 2)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">          _maxPurchaseAmount,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        &quot;ERC721 purchase limit reached&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      );</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  }</span></span></code></pre>\n<p><strong>prePO (sponsor) confirmed and resolved:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/360\">PR 360</a>.</p>\n</blockquote>\n<p><strong>cccz (warden) reviewed mitigation:</strong></p>\n<blockquote>\n<p>Fixed by caching <code>_tokenShop</code> (storage variable loaded twice) in <code>hookERC1155()</code>.</p>\n</blockquote>\n<h2 id=\"g-07-purchasehookhookerc1155-_tokenshop-should-get-cached\" style=\"position:relative;\"><a href=\"#g-07-purchasehookhookerc1155-_tokenshop-should-get-cached\" aria-label=\"g 07 purchasehookhookerc1155 _tokenshop should get cached permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-07] PurchaseHook.hookERC1155(): _tokenShop SHOULD GET CACHED</h2>\n<p>See @audit tag</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">  function hookERC1155(address _user, address _tokenContract, uint256 _tokenId, uint256 _amount) external override {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    require(address(_tokenShop) != address(0), &quot;Token shop not set in hook&quot;); //@audit gas: should cache &quot;_tokenShop&quot; (SLOAD 1)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    uint256 _maxPurchaseAmount = _erc1155ToIdToMaxPurchasesPerUser[</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      _tokenContract</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    ][_tokenId];</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    if (_maxPurchaseAmount != 0) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      require(</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        _tokenShop.getERC1155PurchaseCount(_user, _tokenContract, _tokenId) + //@audit gas: should cache &quot;_tokenShop&quot; (SLOAD 2)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">          _amount &lt;=</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">          _maxPurchaseAmount,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        &quot;ERC1155 purchase limit reached&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      );</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  }</span></span></code></pre>\n<p><strong>prePO (sponsor) confirmed and resolved:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/360\">PR 360</a>.</p>\n</blockquote>\n<p><strong>cccz (warden) reviewed mitigation:</strong></p>\n<blockquote>\n<p>Fixed by caching <code>_tokenShop</code> (storage variable loaded twice) in <code>hookERC721()</code>.</p>\n</blockquote>\n<h2 id=\"g-08-vestingclaim-_token-should-get-cached\" style=\"position:relative;\"><a href=\"#g-08-vestingclaim-_token-should-get-cached\" aria-label=\"g 08 vestingclaim _token should get cached permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-08] Vesting.claim(): _token SHOULD GET CACHED</h2>\n<p>See @audit tag</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">  function claim() external override nonReentrant whenNotPaused {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    uint256 _claimableAmount = getClaimableAmount(msg.sender);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    require(_claimableAmount &gt; 0, &quot;Claimable amount = 0&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    require(_token.balanceOf(address(this)) &gt;= _claimableAmount, &quot;Insufficient balance in contract&quot;); //@audit gas: should cache &quot;_token&quot; (SLOAD 1)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    _recipientToClaimedAmount[msg.sender] += _claimableAmount;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    _token.transfer(msg.sender, _claimableAmount); //@audit gas: should cache &quot;_token&quot; (SLOAD 2)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    emit Claim(msg.sender, _claimableAmount);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  }</span></span></code></pre>\n<p><strong>prePO (sponsor) confirmed and resolved:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/361\">PR 361</a>.</p>\n</blockquote>\n<p><strong>cccz (warden) reviewed mitigation:</strong></p>\n<blockquote>\n<p>Fixed by caching _token (storage variable loaded twice) in claim().</p>\n</blockquote>\n<h2 id=\"g-09-withdrawerc20withdrawerc20--owner-should-get-cached\" style=\"position:relative;\"><a href=\"#g-09-withdrawerc20withdrawerc20--owner-should-get-cached\" aria-label=\"g 09 withdrawerc20withdrawerc20  owner should get cached permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-09] WithdrawERC20.WithdrawERC20 : owner() SHOULD GET CACHED</h2>\n<p>See @audit tag</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">  function withdrawERC20(address[] calldata _erc20Tokens, uint256[] calldata _amounts) external override onlyOwner nonReentrant {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    require(_erc20Tokens.length == _amounts.length, &quot;Array length mismatch&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    for (uint256 i; i &lt; _erc20Tokens.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      IERC20(_erc20Tokens[i]).safeTransfer(owner(), _amounts[i]); // @audit gas: should cache &quot;owner()&quot; (CALL IN LOOP)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  }</span></span></code></pre>\n<p><strong>prePO (sponsor) confirmed and resolved:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/362\">PR 362</a>.</p>\n</blockquote>\n<p><strong>cccz (warden) reviewed mitigation:</strong></p>\n<blockquote>\n<p>Fixed by caching <code>owner()</code> (storage variable loaded in loop) in <code>withdrawERC20()</code>. </p>\n</blockquote>\n<h2 id=\"g-10-vestingsetallocations-l50-and-l52-should-be-unchecked-due-to-l49\" style=\"position:relative;\"><a href=\"#g-10-vestingsetallocations-l50-and-l52-should-be-unchecked-due-to-l49\" aria-label=\"g 10 vestingsetallocations l50 and l52 should be unchecked due to l49 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-10] Vesting.setAllocations(): L50 AND L52 SHOULD BE UNCHECKED DUE TO L49</h2>\n<p>Solidity version 0.8+ comes with implicit overflow and underflow checks on unsigned integers. When an overflow or an underflow isn’t possible (as an example, when a comparison is made before the arithmetic operation), some gas can be saved by using an unchecked block: <a href=\"https://docs.soliditylang.org/en/v0.8.7/control-structures.html#checked-or-unchecked-arithmetic\">https://docs.soliditylang.org/en/v0.8.7/control-structures.html#checked-or-unchecked-arithmetic</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">  function setAllocations(address[] calldata _recipients, uint256[] calldata _amounts) external override onlyOwner {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    require(_recipients.length == _amounts.length, &quot;Array length mismatch&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    uint256 _newTotalAllocatedSupply = _totalAllocatedSupply;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    for (uint256 i; i &lt; _recipients.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      uint256 _amount = _amounts[i];</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      address _recipient = _recipients[i];</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      uint256 _prevAllocatedAmount = _recipientToAllocatedAmount[_recipient];</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      /**</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">       * If the new allocation amount is greater than _prevAllocatedAmount,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">       * the absolute difference is added to</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">       * _newTotalAllocatedSupply, otherwise it is subtracted.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">       */</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">49:      if (_amount &gt; _prevAllocatedAmount) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">50:        _newTotalAllocatedSupply += _amount - _prevAllocatedAmount;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">51:      } else {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">52:        _newTotalAllocatedSupply -= _prevAllocatedAmount - _amount;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      }</span></span></code></pre>\n<p><strong>prePO (sponsor) confirmed and resolved:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/361\">PR 361</a>.</p>\n</blockquote>\n<p><strong>cccz (warden) reviewed mitigation:</strong></p>\n<blockquote>\n<p>Fixed along with [G-08] in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/361\">PR#361</a> by using unchecked for calculation of <code>_newTotalAllocatedSupply</code> in <code>setAllocations()</code>.</p>\n</blockquote>\n<h2 id=\"g-11-increments-can-be-unchecked\" style=\"position:relative;\"><a href=\"#g-11-increments-can-be-unchecked\" aria-label=\"g 11 increments can be unchecked permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-11] INCREMENTS CAN BE UNCHECKED</h2>\n<p>In Solidity 0.8+, there’s a default overflow check on unsigned integers. It’s possible to uncheck this in for-loops and save some gas at each iteration, but at the cost of some code readability, as this uncheck cannot be made inline.</p>\n<p><a href=\"https://github.com/ethereum/solidity/issues/10695\">https://github.com/ethereum/solidity/issues/10695</a></p>\n<p>Instances include:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">AccountList.set():\t\tfor (uint256 i; i &lt; _accounts.length; ++i)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AccountList.reset():\tfor (uint256 i; i &lt; _newIncludedAccounts.length; ++i)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">PurchaseHook.setMaxERC721PurchasesPerUser():\tfor (uint256 i; i &lt; _contracts.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">PurchaseHook.setMaxERC1155PurchasesPerUser():\tfor (uint256 i; i &lt; _contracts.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TokenShop.setContractToIdToPrice():\tfor (uint256 i; i &lt; _tokenContracts.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TokenShop.purchase():\tfor (uint256 i; i &lt; _tokenContracts.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vesting.setAllocations():\tfor (uint256 i; i &lt; _recipients.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">WithdrawERC20.WithdrawERC20():\tfor (uint256 i; i &lt; _erc20Tokens.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">withdrawERC721.withdrawERC721():\tfor (uint256 i; i &lt; _erc721Tokens.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">withdrawERC1155.withdrawERC1155():\tfor (uint256 i; i &lt; _erc1155Tokens.length; ++i) {</span></span></code></pre>\n<p>The code would go from:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">for (uint256 i; i &lt; numIterations; ++i) {  </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> // ...  </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}  </span></span></code></pre>\n<p>to</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">for (uint256 i; i &lt; numIterations;) {  </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> // ...  </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> unchecked { ++i; }  </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}  </span></span></code></pre>\n<p><strong>prePO (sponsor) confirmed and resolved:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/365\">PR 365</a>.</p>\n</blockquote>\n<p><strong>cccz (warden) reviewed mitigation:</strong></p>\n<blockquote>\n<p>Fixed by using unchecked{ ++i;} in loop to save around 80 gas per iteration.</p>\n</blockquote>\n<h2 id=\"g-12-vestingclaim--0-is-less-efficient-than--0-for-unsigned-integers\" style=\"position:relative;\"><a href=\"#g-12-vestingclaim--0-is-less-efficient-than--0-for-unsigned-integers\" aria-label=\"g 12 vestingclaim  0 is less efficient than  0 for unsigned integers permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-12] Vesting.claim(): > 0 IS LESS EFFICIENT THAN != 0 FOR UNSIGNED INTEGERS</h2>\n<p>!= 0 costs less gas compared to > 0 for unsigned integers in require statements with the optimizer enabled (6 gas)</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">  function claim() external override nonReentrant whenNotPaused {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    uint256 _claimableAmount = getClaimableAmount(msg.sender);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    require(_claimableAmount &gt; 0, &quot;Claimable amount = 0&quot;); // @audit: should use require(_claimableAmount != 0,...</span></span></code></pre>\n<p><strong>prePO (sponsor) confirmed and resolved:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/361\">PR 361</a>.</p>\n</blockquote>\n<p><strong>cccz (warden) reviewed mitigation:</strong></p>\n<blockquote>\n<p>Fixed along with [G-08] in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/361\">PR#361</a> by using <code>!= 0</code> instead of <code>>0</code> in <code>claim()</code>.</p>\n</blockquote>\n<h2 id=\"g-13-an-arrays-length-should-be-cached-to-save-gas-in-for-loops\" style=\"position:relative;\"><a href=\"#g-13-an-arrays-length-should-be-cached-to-save-gas-in-for-loops\" aria-label=\"g 13 an arrays length should be cached to save gas in for loops permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-13] AN ARRAY’S LENGTH SHOULD BE CACHED TO SAVE GAS IN FOR-LOOPS</h2>\n<p>Reading array length at each iteration of the loop takes 6 gas (3 for mload and 3 to place memory_offset) in the stack.</p>\n<p>Caching the array length in the stack saves around 3 gas per iteration.</p>\n<p>Here, I suggest storing the array’s length in a variable before the for-loop, and use it instead:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">AccountList.set():\t\tfor (uint256 i; i &lt; _accounts.length; ++i)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">AccountList.reset():\tfor (uint256 i; i &lt; _newIncludedAccounts.length; ++i)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">PurchaseHook.setMaxERC721PurchasesPerUser():\tfor (uint256 i; i &lt; _contracts.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">PurchaseHook.setMaxERC1155PurchasesPerUser():\tfor (uint256 i; i &lt; _contracts.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TokenShop.setContractToIdToPrice():\tfor (uint256 i; i &lt; _tokenContracts.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TokenShop.purchase():\tfor (uint256 i; i &lt; _tokenContracts.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Vesting.setAllocations():\tfor (uint256 i; i &lt; _recipients.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">WithdrawERC20.WithdrawERC20():\tfor (uint256 i; i &lt; _erc20Tokens.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">withdrawERC721.withdrawERC721():\tfor (uint256 i; i &lt; _erc721Tokens.length; ++i) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">withdrawERC1155.withdrawERC1155():\tfor (uint256 i; i &lt; _erc1155Tokens.length; ++i) {</span></span></code></pre>\n<p><strong>prePO (sponsor) confirmed and resolved:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/363\">PR 363</a>.</p>\n</blockquote>\n<p><strong>cccz (warden) reviewed mitigation:</strong></p>\n<blockquote>\n<p>Fixed by caching the array length in the stack to save around 3 gas per iteration.</p>\n</blockquote>\n<h1 id=\"mitigation-review\" style=\"position:relative;\"><a href=\"#mitigation-review\" aria-label=\"mitigation review permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mitigation Review</h1>\n<p><em>Mitigation review by cccz</em></p>\n<h2 id=\"mitigation-overview\" style=\"position:relative;\"><a href=\"#mitigation-overview\" aria-label=\"mitigation overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mitigation Overview</h2>\n<p>The following is a high-level overview of the core changes introduced as the mitigation, arranged per the report findings.</p>\n<ul>\n<li>[M-01] Acknowledged. Only security-compliant tokens such as USDC and PPO are currently planned to be used in the contracts.</li>\n<li>[M-02] Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/355\">PR#355</a>. Adding purchasePrices parameter in purchase() to avoid race condition and ensure that tokens are not purchased at higher prices than the user intended.</li>\n<li>[M-03] Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/352\">PR#352</a>. Removing all write methods from SafeOwnableCaller and SafeAccessControlEnumerableCaller to ensure that the inheriting contracts need to override all write methods. This will avoid missing out of access control on some critical write methods.</li>\n<li>[M-04] Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/356\">PR#356</a>. Adding uint256[50] private __gap in abstract upgradeable smart contracts to ensure no storage shifting down storage in the inheritance chain of the inheriting contracts.</li>\n<li>[Info-01] Acknowledged.</li>\n<li>[Info-02] Acknowledged.</li>\n<li>[Info-03] Acknowledged.</li>\n<li>[G-01] Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/357\">PR#357</a>. Using _purchasePrice (memory variable) instead of _price (storage variable)</li>\n<li>[G-02] Fixed along with [G-01] in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/357\">PR#357</a>. Caching _purchaseHook (storage variable loaded twice)</li>\n<li>[G-03] Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/358\">PR#358</a>. Caching _purchaseHook (storage variable used in Loop)</li>\n<li>[G-04] Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/355\">PR#355</a>. Cached <em>contractToIdToPrice[</em>tokenContracts[i]][_ids[i]] to local variable _price.</li>\n<li>[G-05] Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/359\">PR#359</a>. Caching _blocklist (storage variable loaded twice)</li>\n<li>[G-06] Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/360\">PR#360</a>. Caching _tokenShop (storage variable loaded twice) in hookERC1155()</li>\n<li>[G-07] Fixed along with [G-06] in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/360\">PR#360</a>. Caching _tokenShop (storage variable loaded twice) in hookERC721().</li>\n<li>[G-08] Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/361\">PR#361</a>. Caching _token (storage variable loaded twice) in claim()</li>\n<li>[G-09] Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/362\">PR#352</a>. Caching owner() (storage variable loaded in loop) in withdrawERC20()</li>\n<li>[G-10] Fixed along with [G-08] in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/361\">PR#361</a>. Using unchecked for calculation of _newTotalAllocatedSupply in setAllocations().</li>\n<li>[G-11] Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/365\">PR#365</a>. Using unchecked{ ++i;} in loop to save around 80 gas per iteration.</li>\n<li>[G-12] Fixed along with [G-08] in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/361\">PR#361</a>. Using != 0 instead of >0 in claim()</li>\n<li>[G-13] Fixed in <a href=\"https://github.com/prepo-io/prepo-monorepo/pull/363\">PR#363</a>. Caching the array length in the stack to save around 3 gas per iteration.</li>\n</ul>\n<hr>\n<h1 id=\"disclosures\" style=\"position:relative;\"><a href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Disclosures</h1>\n<p>C4 is an open organization governed by participants in the community.</p>\n<p>C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>",
  "toc": "<ul>\n<li>\n<p><a href=\"#overview\">Overview</a></p>\n<ul>\n<li><a href=\"#about-c4\">About C4</a></li>\n<li><a href=\"#wardens\">Wardens</a></li>\n</ul>\n</li>\n<li><a href=\"#summary\">Summary</a></li>\n<li><a href=\"#scope\">Scope</a></li>\n<li><a href=\"#severity-criteria\">Severity Criteria</a></li>\n<li>\n<p><a href=\"#medium-risk-findings-4\">Medium Risk Findings (4)</a></p>\n<ul>\n<li><a href=\"#m-01-token-transfers-do-not-verify-that-the-tokens-were-successfully-transferred\">M-01 Token transfers do not verify that the tokens were successfully transferred</a></li>\n<li><a href=\"#m-02-tokenshop-purchase-function-should-add-_purchaseprices-parameter\">M-02 TokenShop: purchase function should add _purchasePrices parameter</a></li>\n<li><a href=\"#m-03-safeaccesscontrolenumerablecaller-and-safeownablecaller-contracts-lack-access-control\">M-03 SafeAccessControlEnumerableCaller and SafeOwnableCaller contracts lack access control</a></li>\n<li><a href=\"#m-04-no-storage-gap-for-upgradeable-contracts\">M-04 No storage gap for upgradeable contracts</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#informational-findings-3\">Informational Findings (3)</a></p>\n<ul>\n<li><a href=\"#info-01-tokenshop-_contracttoidtoprice-should-be-reset-after-user-purchases-nft\">Info-01 TokenShop: _contractToIdToPrice should be reset after user purchases NFT</a></li>\n<li><a href=\"#info-02-withdrawerc721-using-the-transferfrom-function-of-an-erc721-contract-may-freeze-the-users-nft\">Info-02 WithdrawERC721: Using the transferFrom function of an ERC721 contract may freeze the user’s NFT</a></li>\n<li><a href=\"#info-03-centralization-problems-in-vesting-contract\">Info-03 Centralization problems in Vesting contract</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#gas-optimizations-13\">Gas Optimizations 13</a></p>\n<ul>\n<li><a href=\"#g-01-minisalespurchase-should-use-memory-instead-of-storage-variable\">G-01 MiniSales.purchase(): SHOULD USE MEMORY INSTEAD OF STORAGE VARIABLE</a></li>\n<li><a href=\"#g-02-minisalespurchase-_purchasehook-should-get-cached\">G-02 MiniSales.purchase(): _purchaseHook SHOULD GET CACHED</a></li>\n<li><a href=\"#g-03-tokenshoppurchase-_purchasehook-should-get-cached\">G-03 TokenShop.purchase(): _purchaseHook SHOULD GET CACHED</a></li>\n<li><a href=\"#g-04-tokenshoppurchase-_contracttoidtoprice-should-get-cached\">G-04 TokenShop.purchase(): _contractToIdToPrice SHOULD GET CACHED</a></li>\n<li><a href=\"#g-05-blocklisttransferhookhook-_blocklist-should-get-cached\">G-05 BlocklistTransferHook.hook(): _blocklist SHOULD GET CACHED</a></li>\n<li><a href=\"#g-06-purchasehookhookerc721-_tokenshop-should-get-cached\">G-06 PurchaseHook.hookERC721(): _tokenShop SHOULD GET CACHED</a></li>\n<li><a href=\"#g-07-purchasehookhookerc1155-_tokenshop-should-get-cached\">G-07 PurchaseHook.hookERC1155(): _tokenShop SHOULD GET CACHED</a></li>\n<li><a href=\"#g-08-vestingclaim-_token-should-get-cached\">G-08 Vesting.claim(): _token SHOULD GET CACHED</a></li>\n<li><a href=\"#g-09-withdrawerc20withdrawerc20--owner-should-get-cached\">G-09 WithdrawERC20.WithdrawERC20 : owner() SHOULD GET CACHED</a></li>\n<li><a href=\"#g-10-vestingsetallocations-l50-and-l52-should-be-unchecked-due-to-l49\">G-10 Vesting.setAllocations(): L50 AND L52 SHOULD BE UNCHECKED DUE TO L49</a></li>\n<li><a href=\"#g-11-increments-can-be-unchecked\">G-11 INCREMENTS CAN BE UNCHECKED</a></li>\n<li><a href=\"#g-12-vestingclaim--0-is-less-efficient-than--0-for-unsigned-integers\">G-12 Vesting.claim(): > 0 IS LESS EFFICIENT THAN != 0 FOR UNSIGNED INTEGERS</a></li>\n<li><a href=\"#g-13-an-arrays-length-should-be-cached-to-save-gas-in-for-loops\">G-13 AN ARRAY’S LENGTH SHOULD BE CACHED TO SAVE GAS IN FOR-LOOPS</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#mitigation-review\">Mitigation Review</a></p>\n<ul>\n<li><a href=\"#mitigation-overview\">Mitigation Overview</a></li>\n</ul>\n</li>\n<li><a href=\"#disclosures\">Disclosures</a></li>\n</ul>"
}