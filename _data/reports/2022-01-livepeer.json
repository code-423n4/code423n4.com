{
  "circa": {
    "title": "Livepeer contest",
    "sponsor": "Livepeer",
    "slug": "2022-01-livepeer",
    "date": "2022-02-11",
    "findings": "https://github.com/code-423n4/2022-01-livepeer-findings/issues",
    "contest": 73
  },
  "html": "<h1 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h1>\n<h2 id=\"about-c4\" style=\"position:relative;\"><a href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>About C4</h2>\n<p>Code4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.</p>\n<p>A C4 code contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.</p>\n<p>During the code contest outlined in this document, C4 conducted an analysis of Livepeer contest smart contract system written in Solidity. The code contest took place between January 13—January 19 2022.</p>\n<h2 id=\"wardens\" style=\"position:relative;\"><a href=\"#wardens\" aria-label=\"wardens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wardens</h2>\n<p>31 Wardens contributed reports to the Livepeer contest:</p>\n<ol>\n<li>WatchPug (<a href=\"https://github.com/jack-the-pug\">jtp</a> and <a href=\"https://github.com/mingwatch\">ming</a>)</li>\n<li><a href=\"https://twitter.com/gzeon\">gzeon</a></li>\n<li>harleythedog</li>\n<li><a href=\"https://twitter.com/0xruhum\">Ruhum</a></li>\n<li><a href=\"https://twitter.com/JustDravee\">Dravee</a></li>\n<li>0x1f8b</li>\n<li>cccz</li>\n<li><a href=\"https://twitter.com/defsec_\">defsec</a></li>\n<li><a href=\"https://twitter.com/SirH4shalot\">sirhashalot</a></li>\n<li>hyh</li>\n<li><a href=\"https://twitter.com/danbinnun\">danb</a></li>\n<li>robee</li>\n<li><a href=\"https://twitter.com/SolidityDev\">pauliax</a></li>\n<li><a href=\"https://twitter.com/meidhiwirara\">Tomio</a></li>\n<li><a href=\"https://twitter.com/k3mmio\">kemmio</a></li>\n<li>egjlmn1</li>\n<li>Jujic</li>\n<li>byterocket (<a href=\"https://twitter.com/merkleplant_eth\">pmerkleplant</a> and <a href=\"https://binbash.sh\">pseudorandom</a>)</li>\n<li>0x0x0x</li>\n<li><a href=\"https://twitter.com/_ye0lde\">ye0lde</a></li>\n<li><a href=\"https://www.instagram.com/riyan_rfa/\">rfa</a></li>\n<li>p4st13r4 (0xb4bb4 and <a href=\"https://github.com/0x69e8\">0x69e8</a>)</li>\n<li><a href=\"https://twitter.com/ori_dabush\">OriDabush</a></li>\n<li>aga7hokakological</li>\n<li><a href=\"https://twitter.com/_0v3rf10w\">0v3rf10w</a></li>\n<li>jayjonah8</li>\n<li>SolidityScan (<a href=\"https://twitter.com/cyberboyIndia\">cyberboy</a> and <a href=\"https://blog.dixitaditya.com/\">zombie</a>)</li>\n</ol>\n<p>This contest was judged by <a href=\"https://twitter.com/liam_eastwood13\">0xleastwood</a>.</p>\n<p>Final report assembled by <a href=\"https://twitter.com/itsmetechjay\">itsmetechjay</a> and <a href=\"https://twitter.com/CloudEllie1\">CloudEllie</a>.</p>\n<h1 id=\"summary\" style=\"position:relative;\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h1>\n<p>The C4 analysis yielded an aggregated total of 20 unique vulnerabilities and 82 total findings. All of the issues presented here are linked back to their original finding.</p>\n<p>Of these vulnerabilities, 1 received a risk rating in the category of HIGH severity, 8 received a risk rating in the category of MEDIUM severity, and 11 received a risk rating in the category of LOW severity.</p>\n<p>C4 analysis also identified 24 non-critical recommendations and 38 gas optimizations.</p>\n<h1 id=\"scope\" style=\"position:relative;\"><a href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scope</h1>\n<p>The code under review can be found within the <a href=\"https://github.com/code-423n4/2022-01-livepeer\">C4 Livepeer contest repository</a>, and is composed of 16 smart contracts written in the Solidity programming language and includes 1928 lines of Solidity code.</p>\n<h1 id=\"severity-criteria\" style=\"position:relative;\"><a href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Severity Criteria</h1>\n<p>C4 assesses the severity of disclosed vulnerabilities according to a methodology based on <a href=\"https://owasp.org/www-community/OWASP_Risk_Rating_Methodology\">OWASP standards</a>.</p>\n<p>Vulnerabilities are divided into three primary risk categories: high, medium, and low.</p>\n<p>High-level considerations for vulnerabilities span the following key areas when conducting assessments:</p>\n<ul>\n<li>Malicious Input Handling</li>\n<li>Escalation of privileges</li>\n<li>Arithmetic</li>\n<li>Gas use</li>\n</ul>\n<p>Further information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on <a href=\"https://code423n4.com\">the C4 website</a>.</p>\n<h1 id=\"high-risk-findings-1\" style=\"position:relative;\"><a href=\"#high-risk-findings-1\" aria-label=\"high risk findings 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>High Risk Findings (1)</h1>\n<h2 id=\"h-01-wp-h5-l1migratorsolmigrateeth-does-not-send-bridgeminters-eth-to-l2-causing-eth-get-frozen-in-the-contract\" style=\"position:relative;\"><a href=\"#h-01-wp-h5-l1migratorsolmigrateeth-does-not-send-bridgeminters-eth-to-l2-causing-eth-get-frozen-in-the-contract\" aria-label=\"h 01 wp h5 l1migratorsolmigrateeth does not send bridgeminters eth to l2 causing eth get frozen in the contract permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/205\">[H-01] [WP-H5] <code>L1Migrator.sol#migrateETH()</code> does not send <code>bridgeMinter</code>’s ETH to L2 causing ETH get frozen in the contract</a></h2>\n<p><em>Submitted by WatchPug, also found by gzeon, harleythedog, and Ruhum</em>.</p>\n<p>Per the <code>arb-bridge-eth</code> code:</p>\n<blockquote>\n<p>all msg.value will deposited to callValueRefundAddress on L2</p>\n</blockquote>\n<ul>\n<li><a href=\"https://github.com/OffchainLabs/arbitrum/blob/78118ba205854374ed280a27415cb62c37847f72/packages/arb-bridge-eth/contracts/bridge/Inbox.sol#L313\">https://github.com/OffchainLabs/arbitrum/blob/78118ba205854374ed280a27415cb62c37847f72/packages/arb-bridge-eth/contracts/bridge/Inbox.sol#L313</a></li>\n<li><a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/gateway/L1ArbitrumMessenger.sol#L65-L74\">https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/gateway/L1ArbitrumMessenger.sol#L65-L74</a></li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">seqNum</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">inbox</span><span class=\"mtk1\">.</span><span class=\"mtk12\">createRetryableTicket</span><span class=\"mtk1\">{value: </span><span class=\"mtk12\">_l1CallValue</span><span class=\"mtk1\">}(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">target</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">_l2CallValue</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">maxSubmissionCost</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">from</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">from</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">maxGas</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">gasPriceBid</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">data</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>At L308-L309, ETH held by <code>BridgeMinter</code> is withdrawn to L1Migrator:</p>\n<p><a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/gateway/L1Migrator.sol#L308-L309\">https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/gateway/L1Migrator.sol#L308-L309</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">IBridgeMinter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bridgeMinterAddr</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    .</span><span class=\"mtk11\">withdrawETHToL1Migrator</span><span class=\"mtk1\">();</span></span></span></code></pre>\n<p>However, when calling <code>sendTxToL2()</code> the parameter <code>_l1CallValue</code> is only the <code>msg.value</code>, therefore, the ETH transferred to L2 does not include any funds from <code>bridgeMinter</code>.</p>\n<p><a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/gateway/L1Migrator.sol#L318-L327\">https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/gateway/L1Migrator.sol#L318-L327</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">sendTxToL2</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">l2MigratorAddr</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">), </span><span class=\"mtk3\">// L2 alias of this contract will receive refunds</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">value</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">_maxSubmissionCost</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">_maxGas</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">_gasPriceBid</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk8\">&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">)</span></span></span></code></pre>\n<p>As a result, due to lack of funds, <code>call</code> with value = amount to <code>l2MigratorAddr</code> will always fail on L2.</p>\n<p>Since there is no other way to send ETH to L2, all the ETH from <code>bridgeMinter</code> is now frozen in the contract.</p>\n<h4 id=\"recommendation\" style=\"position:relative;\"><a href=\"#recommendation\" aria-label=\"recommendation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommendation</h4>\n<p>Change to:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">sendTxToL2</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">l2MigratorAddr</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">), </span><span class=\"mtk3\">// L2 alias of this contract will receive refunds</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">value</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">, </span><span class=\"mtk3\">// the `amount` withdrawn from BridgeMinter should be added</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">_maxSubmissionCost</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">_maxGas</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">_gasPriceBid</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk8\">&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">)</span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/205#issuecomment-1021378858\">yondonfu (Livepeer) confirmed and resolved</a>:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/pull/51\">https://github.com/livepeer/arbitrum-lpt-bridge/pull/51</a></p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/205#issuecomment-1025008573\">0xleastwood (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Awesome find!</p>\n</blockquote>\n<h1 id=\"medium-risk-findings-8\" style=\"position:relative;\"><a href=\"#medium-risk-findings-8\" aria-label=\"medium risk findings 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Medium Risk Findings (8)</h1>\n<h2 id=\"m-01-l1migratormigratelpt-can-be-used-to-take-away-protocols-access-to-lpt-tokens-in-bridgeminter\" style=\"position:relative;\"><a href=\"#m-01-l1migratormigratelpt-can-be-used-to-take-away-protocols-access-to-lpt-tokens-in-bridgeminter\" aria-label=\"m 01 l1migratormigratelpt can be used to take away protocols access to lpt tokens in bridgeminter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/97\">[M-01] L1Migrator.migrateLPT` can be used to take away protocol’s access to LPT tokens in BridgeMinter</a></h2>\n<p><em>Submitted by Ruhum, also found by gzeon and harleythedog</em>.</p>\n<p>Same thing as the ETH issue I reported earlier. I wasn’t sure if those are supposed to be a single issue or not. The concept is the same. But, now you lose LPT tokens.</p>\n<p>The <code>L1Migrator.migrateLPT()</code> function can be called by <strong>anyone</strong>. It pulls all the LPT from the <code>BridgeMinter</code> contract and starts the process of moving the funds to L2. First of all, this function is only executable once. The RetryableTicket created with the first call is the only chance of moving the funds to L2.</p>\n<p>The attacker can call the function with <a href=\"https://developer.offchainlabs.com/docs/l1_l2_messages#parameters\">parameters</a> that make the creation of the RetryableTicket on L2 fail. Thus, the LPT sits in the L1Migrator contract with no way of moving it to L2 or anywhere else. Effectively, the funds are lost.</p>\n<h4 id=\"proof-of-concept\" style=\"position:relative;\"><a href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h4>\n<p>The function is only executable once because it uses the <code>amount</code> returned by <code>IBridgeMinter(bridgeMinterAddr).withdrawLPTToL1Migrator()</code> to specify the amount of LPT to be sent to L2: <a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/blob/main/contracts/L1/gateway/L1Migrator.sol#L342\">https://github.com/livepeer/arbitrum-lpt-bridge/blob/main/contracts/L1/gateway/L1Migrator.sol#L342</a></p>\n<p>After the first call to <code>migrateLPT()</code> that function will always return 0 since the <code>BridgeMinter</code> won’t have any more LPT: <a href=\"https://github.com/livepeer/protocol/blob/streamflow/contracts/token/BridgeMinter.sol#L107\">https://github.com/livepeer/protocol/blob/streamflow/contracts/token/BridgeMinter.sol#L107</a></p>\n<p>So after the attacker called <code>migrateLPT()</code> with insufficient funds to create a RetryableTicket on L2 we have the following state:</p>\n<ul>\n<li>BridgeMinter has 0 LPT</li>\n<li>L1Migrator has X amount of LPT that is not accessible. There are no functions to get the LPT out of there.</li>\n<li>1 failed RetryTicket</li>\n</ul>\n<p>The same thing can also be triggered by a non-malicious caller by simply providing insufficient funds. The whole design of only being able to try once is the issue here.</p>\n<h4 id=\"recommended-mitigation-steps\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h4>\n<p>Instead of using the <code>amount</code> returned by <code>IBridgeMinter(bridgeMinterAddr).withdrawLPTToL1Migrator()</code> you should use the balance of the <code>L1Migrator</code> contract.</p>\n<p>It might also make sense to <strong>not</strong> allow anybody to call the function. I don’t see the benefit of that.</p>\n<p>Actually, the funds aren’t lost. The funds are sent to the Escrow contract which can be used to transfer the funds back to the BridgeMinter contract. Thus, you could reset the whole thing to its initial state and call <code>L1Migrator.migrateLPT()</code> again. But, a really persistent attacker has the ability to DoS the function by frontrunning any call to it which results in the RetryableTicket failing again. Thus, you’d have to transfer the funds from the Escrow contract to the BrigeMinter again and so on.</p>\n<p>So the same scenario I’ve outlined earlier is still viable. It’s just a bit more difficult now since it has a higher cost for the attacker now. Because of that I think it’s an medium issue instead of high.</p>\n<p>Also, the mitigation steps I’ve given aren’t valid. You can’t use the <code>L1Migrator</code> contract’s balance since it will always be 0 (the funds are sent to the Escrow contract). Thus the best solution would be to just limit the access to the function.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/97#issuecomment-1025008823\">0xleastwood (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Nice find! The warden has outlined a potential DOS attack which can lead to funds lost which are only recoverable by the transferring the funds in the escrow contract back to the bridge minter contract.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/97#issuecomment-1026222409\">yondonfu (Livepeer) confirmed and resolved</a>:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/commit/5b6a349ad8f4e53c01d2e43eda36bbbf3037a3c9\">https://github.com/livepeer/arbitrum-lpt-bridge/commit/5b6a349ad8f4e53c01d2e43eda36bbbf3037a3c9</a></p>\n</blockquote>\n<h2 id=\"m-02-wp-h3-l1migratorsolmigrateeth-improper-implementation-of-l1migrator-causing-migrateeth-always-reverts-can-lead-to-eth-in-bridgeminter-getting-stuck-in-the-contract\" style=\"position:relative;\"><a href=\"#m-02-wp-h3-l1migratorsolmigrateeth-improper-implementation-of-l1migrator-causing-migrateeth-always-reverts-can-lead-to-eth-in-bridgeminter-getting-stuck-in-the-contract\" aria-label=\"m 02 wp h3 l1migratorsolmigrateeth improper implementation of l1migrator causing migrateeth always reverts can lead to eth in bridgeminter getting stuck in the contract permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/198\">[M-02] [WP-H3] <code>L1Migrator.sol#migrateETH()</code> Improper implementation of <code>L1Migrator</code> causing <code>migrateETH()</code> always reverts, can lead to ETH in <code>BridgeMinter</code> getting stuck in the contract</a></h2>\n<p><em>Submitted by WatchPug, also found by gzeon</em>.</p>\n<p><a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/gateway/L1Migrator.sol#L308-L310\">https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/gateway/L1Migrator.sol#L308-L310</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">IBridgeMinter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bridgeMinterAddr</span><span class=\"mtk1\">).</span><span class=\"mtk11\">withdrawETHToL1Migrator</span><span class=\"mtk1\">();</span></span></span></code></pre>\n<p><code>L1Migrator.sol#migrateETH()</code> will call <code>IBridgeMinter(bridgeMinterAddr).withdrawETHToL1Migrator()</code> to withdraw ETH from <code>BridgeMinter</code>.</p>\n<p>However, the current implementation of <code>L1Migrator</code> is unable to receive ETH.</p>\n<p><a href=\"https://github.com/livepeer/protocol/blob/20e7ebb86cdb4fe9285bf5fea02eb603e5d48805/contracts/token/BridgeMinter.sol#L94-L94\">https://github.com/livepeer/protocol/blob/20e7ebb86cdb4fe9285bf5fea02eb603e5d48805/contracts/token/BridgeMinter.sol#L94-L94</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">(</span><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ok</span><span class=\"mtk1\">, ) = </span><span class=\"mtk12\">l1MigratorAddr</span><span class=\"mtk1\">.</span><span class=\"mtk12\">call</span><span class=\"mtk1\">.</span><span class=\"mtk11\">value</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">).</span><span class=\"mtk12\">balance</span><span class=\"mtk1\">)(</span><span class=\"mtk8\">&quot;&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>A contract receiving Ether must have at least one of the functions below:</p>\n<ul>\n<li><code>receive() external payable</code></li>\n<li><code>fallback() external payable</code></li>\n</ul>\n<p><code>receive()</code> is called if <code>msg.data</code> is empty, otherwise <code>fallback()</code> is called.</p>\n<p>Because <code>L1Migrator</code> implement neither <code>receive()</code> or <code>fallback()</code>, the <code>call</code> at L94 will always revert.</p>\n<h4 id=\"impact\" style=\"position:relative;\"><a href=\"#impact\" aria-label=\"impact permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h4>\n<p>All the ETH held by the <code>BridgeMinter</code> can get stuck in the contract.</p>\n<h4 id=\"recommendation-1\" style=\"position:relative;\"><a href=\"#recommendation-1\" aria-label=\"recommendation 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommendation</h4>\n<p>Add <code>receive() external payable {}</code> in <code>L1Migrator</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/198#issuecomment-1019663325\">yondonfu (Livepeer) confirmed and disagreed with severity</a>:</strong></p>\n<blockquote>\n<p>Severity: 2 (Med)</p>\n<p>We’ll fix this, but noting that the funds are recoverable because the BridgeMinter can set a new L1Migrator that does have the receive() function which is why the suggested severity is 2 (Med).</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/198#issuecomment-1021379439\">yondonfu (Livepeer) resolved</a>:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/pull/50\">https://github.com/livepeer/arbitrum-lpt-bridge/pull/50</a></p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/198#issuecomment-1025009024\">0xleastwood (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Agree with sponsor, these funds are recoverable. However, the warden has identified a DOS attack, which is a valid <code>medium</code> severity issue.</p>\n</blockquote>\n<h2 id=\"m-03-fund-loss-when-insufficient-call-value-to-cover-fee\" style=\"position:relative;\"><a href=\"#m-03-fund-loss-when-insufficient-call-value-to-cover-fee\" aria-label=\"m 03 fund loss when insufficient call value to cover fee permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/238\">[M-03] Fund loss when insufficient call value to cover fee</a></h2>\n<p><em>Submitted by gzeon</em>.</p>\n<p>Fund can be lost if the L1 call value provided is insufficient to cover <code>_maxSubmissionCost</code>, or stuck if insufficient to cover <code>_maxSubmissionCost + (_maxGas * _gasPriceBid)</code>.</p>\n<h4 id=\"proof-of-concept-1\" style=\"position:relative;\"><a href=\"#proof-of-concept-1\" aria-label=\"proof of concept 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h4>\n<p><code>outboundTransfer</code> in <code>L1LPTGateway</code> does not check if the call value is sufficient, if it is <code>&#x3C; _maxSubmissionCost</code> the retryable ticket creation will fail and fund is lost; if it is <code>&#x3C;_maxSubmissionCost + (_maxGas * _gasPriceBid)</code> the ticket would require manual execution.</p>\n<p><a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/gateway/L1LPTGateway.sol#L80\">https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/gateway/L1LPTGateway.sol#L80</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">outboundTransfer</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_l1Token</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_maxGas</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_gasPriceBid</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">calldata</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_data</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">payable</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">whenNotPaused</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_l1Token</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">l1Lpt</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;TOKEN_NOT_LPT&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// nested scope to avoid stack too deep errors</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">from</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">seqNum</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">extraData</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">maxSubmissionCost</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        (</span><span class=\"mtk12\">from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">maxSubmissionCost</span><span class=\"mtk1\">, </span><span class=\"mtk12\">extraData</span><span class=\"mtk1\">) = </span><span class=\"mtk11\">parseOutboundData</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_data</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">extraData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;CALL_HOOK_DATA_NOT_ALLOWED&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// transfer tokens to escrow</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">TokenLike</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_l1Token</span><span class=\"mtk1\">).</span><span class=\"mtk11\">transferFrom</span><span class=\"mtk1\">(</span><span class=\"mtk12\">from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">l1LPTEscrow</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">outboundCalldata</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">getOutboundCalldata</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">_l1Token</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">from</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">extraData</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">seqNum</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">sendTxToL2</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">l2Counterpart</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">from</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">maxSubmissionCost</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">_maxGas</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">_gasPriceBid</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">outboundCalldata</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">DepositInitiated</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_l1Token</span><span class=\"mtk1\">, </span><span class=\"mtk12\">from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">seqNum</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">abi</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encode</span><span class=\"mtk1\">(</span><span class=\"mtk12\">seqNum</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h4 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h4>\n<p>Add check similar to the one used in <code>L1GatewayRouter</code> provided by Arbitrum team</p>\n<p><a href=\"https://github.com/OffchainLabs/arbitrum/blob/b8366005a697000dda1f57a78a7bdb2313db8fe2/packages/arb-bridge-peripherals/contracts/tokenbridge/ethereum/gateway/L1GatewayRouter.sol#L236\">https://github.com/OffchainLabs/arbitrum/blob/b8366005a697000dda1f57a78a7bdb2313db8fe2/packages/arb-bridge-peripherals/contracts/tokenbridge/ethereum/gateway/L1GatewayRouter.sol#L236</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">expectedEth</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_maxSubmissionCost</span><span class=\"mtk1\"> + (</span><span class=\"mtk12\">_maxGas</span><span class=\"mtk1\"> * </span><span class=\"mtk12\">_gasPriceBid</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_maxSubmissionCost</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;NO_SUBMISSION_COST&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">value</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">expectedEth</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;WRONG_ETH_VALUE&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/238#issuecomment-1018693125\">yondonfu (Livepeer) confirmed and disagreed with severity</a>:</strong></p>\n<blockquote>\n<p>Labeled as disagree with severity because we think this is a 2 - Med finding. We think that the likelihood of this occurring is low because in almost all cases users should be interacting with this contract using an application that handles calculating the maxSubmissionCost properly which would prevent the reported issue. However, we do think that the impact <em>if</em> this occurs is high since LPT <em>and</em> ETH could be lost if the reported issue happens. Thus, we think 2 - Med is appropriate given that assets are not at direct risk, but there is a low probability path for assets to be lost.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/238#issuecomment-1025009724\">0xleastwood (judge) commented</a>:</strong></p>\n<blockquote>\n<p>I agree, there is potential for unintentional loss of funds, however, the attack vector makes assumptions on how this might occur. Due to the unlikely nature, I agree that this should be a <code>medium</code> severity issue..</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/238#issuecomment-1026220888\">yondonfu (Livepeer) resolved</a>:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/commit/6615bb8ce0fced895acd0e5d3e826c1e7b5d0138\">https://github.com/livepeer/arbitrum-lpt-bridge/commit/6615bb8ce0fced895acd0e5d3e826c1e7b5d0138</a></p>\n</blockquote>\n<h2 id=\"m-04-wp-m0-minter_role-can-be-granted-by-the-deployer-of-l2livepeertoken-and-mint-arbitrary-amount-of-tokens\" style=\"position:relative;\"><a href=\"#m-04-wp-m0-minter_role-can-be-granted-by-the-deployer-of-l2livepeertoken-and-mint-arbitrary-amount-of-tokens\" aria-label=\"m 04 wp m0 minter_role can be granted by the deployer of l2livepeertoken and mint arbitrary amount of tokens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/193\">[M-04] [WP-M0] <code>MINTER_ROLE</code> can be granted by the deployer of L2LivepeerToken and mint arbitrary amount of tokens</a></h2>\n<p><em>Submitted by WatchPug</em>.</p>\n<p><a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L2/token/LivepeerToken.sol#L23-L30\">https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L2/token/LivepeerToken.sol#L23-L30</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">mint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">external</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">onlyRole</span><span class=\"mtk1\">(</span><span class=\"mtk12\">MINTER_ROLE</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">_mint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Mint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>Using the <code>mint()</code> function of <code>L2LivepeerToken</code>, an address with <code>MINTER_ROLE</code> can burn an arbitrary amount of tokens.</p>\n<p>If the private key of the deployer or an address with the <code>MINTER_ROLE</code> is compromised, the attacker will be able to mint an unlimited amount of LPT tokens.</p>\n<p>We believe this is unnecessary and poses a serious centralization risk.</p>\n<h4 id=\"recommendation-2\" style=\"position:relative;\"><a href=\"#recommendation-2\" aria-label=\"recommendation 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommendation</h4>\n<p>Consider removing the <code>MINTER_ROLE</code>, make the <code>L2LivepeerToken</code> only mintable by the owner, and make the L2Minter contract to be the owner and therefore the only minter.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/193#issuecomment-1019660423\">yondonfu (Livepeer) acknowledged</a>:</strong></p>\n<blockquote>\n<p>Planning on keeping the role since the L2LPTGateway needs to be given minting rights as well in addition to the L2 Minter.</p>\n</blockquote>\n<h2 id=\"m-05-wp-m1-burner_role-can-burn-any-amount-of-l2livepeertoken-from-an-arbitrary-address\" style=\"position:relative;\"><a href=\"#m-05-wp-m1-burner_role-can-burn-any-amount-of-l2livepeertoken-from-an-arbitrary-address\" aria-label=\"m 05 wp m1 burner_role can burn any amount of l2livepeertoken from an arbitrary address permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/194\">[M-05] [WP-M1] <code>BURNER_ROLE</code> can burn any amount of L2LivepeerToken from an arbitrary address</a></h2>\n<p><em>Submitted by WatchPug, also found by cccz</em>.</p>\n<p><a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L2/token/LivepeerToken.sol#L36-L43\">https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L2/token/LivepeerToken.sol#L36-L43</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">burn</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">external</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">onlyRole</span><span class=\"mtk1\">(</span><span class=\"mtk12\">BURNER_ROLE</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">_burn</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Burn</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>Using the <code>burn()</code> function of <code>L2LivepeerToken</code>, an address with <code>BURNER_ROLE</code> can burn an arbitrary amount of tokens from any address.</p>\n<p>We believe this is unnecessary and poses a serious centralization risk.</p>\n<p>A malicious or compromised <code>BURNER_ROLE</code> address can take advantage of this, burn the balance of a Uniswap pool and effectively steal almost all the funds from the liquidity pool (eg, Uniswap LPT-WETH Pool).</p>\n<h4 id=\"recommendation-3\" style=\"position:relative;\"><a href=\"#recommendation-3\" aria-label=\"recommendation 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommendation</h4>\n<p>Consider removing the <code>BURNER_ROLE</code> and change <code>burn()</code> function to:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">burn</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">external</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">_burn</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Burn</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/blob/49cf5401b0514511675d781a1e29d6b0325cfe88/contracts/L2/gateway/L2LPTGateway.sol#L34-L45\">https://github.com/livepeer/arbitrum-lpt-bridge/blob/49cf5401b0514511675d781a1e29d6b0325cfe88/contracts/L2/gateway/L2LPTGateway.sol#L34-L45</a></p>\n<p><code>Mintable(l2Lpt).burn(from, _amount);</code> in <code>L2LPTGateway.sol#outboundTransfer()</code> should also be replaced with:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">Mintable</span><span class=\"mtk1\">(</span><span class=\"mtk12\">l2Lpt</span><span class=\"mtk1\">).</span><span class=\"mtk11\">transferFrom</span><span class=\"mtk1\">(</span><span class=\"mtk12\">from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">Mintable</span><span class=\"mtk1\">(</span><span class=\"mtk12\">l2Lpt</span><span class=\"mtk1\">).</span><span class=\"mtk11\">burn</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/194#issuecomment-1021377760\">yondonfu (Livepeer) confirmed and resolved</a>:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/pull/52\">https://github.com/livepeer/arbitrum-lpt-bridge/pull/52</a></p>\n</blockquote>\n<h2 id=\"m-06-wp-m2-default_admin_role-can-approve-arbitrary-address-to-spend-any-amount-from-the-l1escrow-contract\" style=\"position:relative;\"><a href=\"#m-06-wp-m2-default_admin_role-can-approve-arbitrary-address-to-spend-any-amount-from-the-l1escrow-contract\" aria-label=\"m 06 wp m2 default_admin_role can approve arbitrary address to spend any amount from the l1escrow contract permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/195\">[M-06] [WP-M2] <code>DEFAULT_ADMIN_ROLE</code> can approve arbitrary address to spend any amount from the <code>L1Escrow</code> contract</a></h2>\n<p><em>Submitted by WatchPug</em>.</p>\n<p><a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/escrow/L1Escrow.sol#L21-L28\">https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/escrow/L1Escrow.sol#L21-L28</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">approve</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_token</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_spender</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_value</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyRole</span><span class=\"mtk1\">(</span><span class=\"mtk12\">DEFAULT_ADMIN_ROLE</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">ApproveLike</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_token</span><span class=\"mtk1\">).</span><span class=\"mtk11\">approve</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_spender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_value</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Approve</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_token</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_spender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_value</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><code>L1Escrow.sol#approve()</code> allows an address with <code>DEFAULT_ADMIN_ROLE</code> can approve an arbitrary amount of tokens to any address.</p>\n<p>We believe this is unnecessary and poses a serious centralization risk.</p>\n<p>A malicious or compromised <code>DEFAULT_ADMIN_ROLE</code> address can take advantage of this, and steal all the funds from the <code>L1Escrow</code> contract.</p>\n<h4 id=\"recommendation-4\" style=\"position:relative;\"><a href=\"#recommendation-4\" aria-label=\"recommendation 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommendation</h4>\n<p>Consider removing <code>approve()</code> function and approve <code>l1LPT</code> to <code>l1Gateway</code> in the constructor.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/195#issuecomment-1019662710\">yondonfu (Livepeer) acknowledged</a>:</strong></p>\n<blockquote>\n<p>Likely won’t change as we want to preserve the ability for protocol governance to move the LPT from the L1Escrow in the event of a L2 failure.</p>\n</blockquote>\n<h2 id=\"m-07-wp-m4-unable-to-use-l2gatewayrouter-to-withdraw-lpt-from-l2-to-l1-as-l2lptgateway-does-not-implement-l2gatewayrouter-expected-method\" style=\"position:relative;\"><a href=\"#m-07-wp-m4-unable-to-use-l2gatewayrouter-to-withdraw-lpt-from-l2-to-l1-as-l2lptgateway-does-not-implement-l2gatewayrouter-expected-method\" aria-label=\"m 07 wp m4 unable to use l2gatewayrouter to withdraw lpt from l2 to l1 as l2lptgateway does not implement l2gatewayrouter expected method permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/202\">[M-07] [WP-M4] Unable to use <code>L2GatewayRouter</code> to withdraw LPT from L2 to L1, as <code>L2LPTGateway</code> does not implement <code>L2GatewayRouter</code> expected method</a></h2>\n<p><em>Submitted by WatchPug</em>.</p>\n<p>Per the document: <a href=\"https://github.com/code-423n4/2022-01-livepeer#l2---l1-lpt-withdrawal\">https://github.com/code-423n4/2022-01-livepeer#l2---l1-lpt-withdrawal</a></p>\n<blockquote>\n<p>The following occurs when LPT is withdrawn from L2 to L1:</p>\n</blockquote>\n<blockquote>\n<p>The user initiates a withdrawal for X LPT. This can be done in two ways: a. Call outboundTransfer() on L2GatewayRouter which will call outboundTransfer() on L2LPTGateway b. Call outboundTransfer() directly on L2LPTGateway</p>\n</blockquote>\n<p>The method (a) described above won’t work in the current implementation due to the missing interface on <code>L2LPTGateway</code>.</p>\n<p>When initiate a withdraw from the Arbitrum Gateway Router, <code>L2GatewayRouter</code> will call <code>outboundTransfer(address,address,uint256,uint256,uint256,bytes)</code> on <code>ITokenGateway(gateway)</code>:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">outboundTransfer</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_token</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_maxGas</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_gasPriceBid</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">calldata</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_data</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">payable</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/OffchainLabs/arbitrum/blob/b8366005a697000dda1f57a78a7bdb2313db8fe2/packages/arb-bridge-peripherals/contracts/tokenbridge/arbitrum/gateway/L2GatewayRouter.sol#L57-L64\">https://github.com/OffchainLabs/arbitrum/blob/b8366005a697000dda1f57a78a7bdb2313db8fe2/packages/arb-bridge-peripherals/contracts/tokenbridge/arbitrum/gateway/L2GatewayRouter.sol#L57-L64</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">outboundTransfer</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_l1Token</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">calldata</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_data</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">payable</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">outboundTransfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_l1Token</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">, </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_data</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><a href=\"https://github.com/OffchainLabs/arbitrum/blob/b8366005a697000dda1f57a78a7bdb2313db8fe2/packages/arb-bridge-peripherals/contracts/tokenbridge/libraries/gateway/GatewayRouter.sol#L78-L102\">https://github.com/OffchainLabs/arbitrum/blob/b8366005a697000dda1f57a78a7bdb2313db8fe2/packages/arb-bridge-peripherals/contracts/tokenbridge/libraries/gateway/GatewayRouter.sol#L78-L102</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">outboundTransfer</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_token</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_maxGas</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_gasPriceBid</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">calldata</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_data</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">payable</span><span class=\"mtk1\"> </span><span class=\"mtk11\">virtual</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">gateway</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">getGateway</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_token</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">gatewayData</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">GatewayMessageHandler</span><span class=\"mtk1\">.</span><span class=\"mtk11\">encodeFromRouterToGateway</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">_data</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">TransferRouted</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_token</span><span class=\"mtk1\">, </span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">gateway</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">return</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">ITokenGateway</span><span class=\"mtk1\">(</span><span class=\"mtk12\">gateway</span><span class=\"mtk1\">).</span><span class=\"mtk12\">outboundTransfer</span><span class=\"mtk1\">{ value: </span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">value</span><span class=\"mtk1\"> }(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">_token</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">_maxGas</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">_gasPriceBid</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">gatewayData</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>However, <code>L2LPTGateway</code> dose not implement <code>outboundTransfer(address,address,uint256,uint256,uint256,bytes)</code> but only <code>outboundTransfer(address,address,uint256,bytes)</code>:</p>\n<p><a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L2/gateway/L2LPTGateway.sol#L65-L89\">https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L2/gateway/L2LPTGateway.sol#L65-L89</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">outboundTransfer</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_l1Token</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">calldata</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_data</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">whenNotPaused</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">res</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>Therefore, the desired feature to withdraw LPT from L2 to L1 via Arbitrum Router will not be working properly.</p>\n<h4 id=\"recommendation-5\" style=\"position:relative;\"><a href=\"#recommendation-5\" aria-label=\"recommendation 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommendation</h4>\n<p>Consider implementing the method used by  Arbitrum Router.</p>\n<p>See also the implementation of L2DaiGateway by arbitrum-dai-bridge: <a href=\"https://github.com/makerdao/arbitrum-dai-bridge/blob/master/contracts/l2/L2DaiGateway.sol#L88-L95\">https://github.com/makerdao/arbitrum-dai-bridge/blob/master/contracts/l2/L2DaiGateway.sol#L88-L95</a></p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/202#issuecomment-1026222951\">yondonfu (Livepeer) confirmed and resolved</a>:</strong></p>\n<blockquote>\n<p>Fixed in <a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/pull/57\">https://github.com/livepeer/arbitrum-lpt-bridge/pull/57</a></p>\n</blockquote>\n<h2 id=\"m-08-admin-can-rug-l2-escrow-tokens-leading-to-reputation-risk\" style=\"position:relative;\"><a href=\"#m-08-admin-can-rug-l2-escrow-tokens-leading-to-reputation-risk\" aria-label=\"m 08 admin can rug l2 escrow tokens leading to reputation risk permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/165\">[M-08] Admin can rug L2 Escrow tokens leading to reputation risk</a></h2>\n<p><em>Submitted by harleythedog</em>.</p>\n<p>The <code>L1Escrow</code> contract has the function <code>approve</code> that is callable by the admin to approve an arbitrary spender with an arbitrary amount (so they can steal all of the escrow’s holdings if they want). Even if the admin is well intended, the contract can still be called out which would degrade the reputation of the protocol (e.g. see here: <a href=\"https://twitter.com/RugDocIO/status/1411732108029181960\">https://twitter.com/RugDocIO/status/1411732108029181960</a>). LPT is valuable on the Ethereum mainnet, so this rug vector should be mitigated. It would be best to restrict this function’s power by only allowing approvals to other trusted protocol contracts (like L1LPTGateway, which I believe uses the escrow’s approval).</p>\n<p>NOTE: Even if the admin is under a timelock, this is still an issue, as users have to wait a whole week to withdraw from L2 -> L1 due to the dispute period.</p>\n<h4 id=\"proof-of-concept-2\" style=\"position:relative;\"><a href=\"#proof-of-concept-2\" aria-label=\"proof of concept 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h4>\n<p>See the <code>approve</code> function <a href=\"https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/escrow/L1Escrow.sol#L21\">here</a></p>\n<h4 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h4>\n<p>Restrict the power of this <code>approve</code> function so that the admin isn’t able to steal funds. This can be accomplished by only allowing approvals to other protocol functions (instead of arbitrary approvals).</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/165\">yondonfu (Livepeer) acknowledged</a></strong> </p>\n<h1 id=\"low-risk-findings-11\" style=\"position:relative;\"><a href=\"#low-risk-findings-11\" aria-label=\"low risk findings 11 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Low Risk Findings (11)</h1>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/121\">[L-01] No checks around poll voting mechanism</a> <em>Submitted by sirhashalot</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/142\">[L-02] Signature authentication bypass for ZERO address</a> <em>Submitted by kemmio, also found by 0x1f8b, danb, gzeon, and pauliax</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/91\">[L-03] Front running in LivepeerToken</a> <em>Submitted by 0x1f8b</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/87\">[L-04] Possible frozen gateway</a> <em>Submitted by 0x1f8b</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/190\">[L-05] <code>DelegatorPool.sol#claim()</code> Inaccurate check of <code>claimedInitialStake &#x3C; initialStake</code></a> <em>Submitted by WatchPug, also found by danb</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/112\">[L-06] <code>initialize</code> function can be called by everyone and front-run in <code>DelegatorPool.sol</code></a> <em>Submitted by Dravee, also found by cccz, defsec, and robee</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/140\">[L-07] Missing <code>_from</code> param comment on <code>LivepeerToken.sol:burn()</code></a> <em>Submitted by Dravee</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/149\">[L-08] In <code>L2Migrator.sol:finalizeMigrateDelegator()</code>, Account <code>l2Addr</code>’s existence should be checked before call</a> <em>Submitted by Dravee</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/167\">[L-09] Missing setter function for l2MigratorAddr</a> <em>Submitted by defsec</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/203\">[L-10] <code>L1LPTGateway</code>, <code>L2LPTGateway</code> should start off paused after deployed</a> <em>Submitted by WatchPug, also found by Ruhum</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/153\">[L-11] L2Migrator.claimStake attempts fee transfer without checking its possibility</a> <em>Submitted by hyh</em>.</li>\n</ul>\n<h1 id=\"non-critical-findings-24\" style=\"position:relative;\"><a href=\"#non-critical-findings-24\" aria-label=\"non critical findings 24 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Non-Critical Findings (24)</h1>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/4\">[N-01] Missing 0 address check</a> <em>Submitted by cccz, also found by 0v3rf10w, 0x1f8b, defsec, Dravee, hyh, jayjonah8, OriDabush, SolidityScan, and Tomio</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/85\">[N-02] ERC20 Approval Race Condition</a> <em>Submitted by 0x1f8b</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/83\">[N-03] Lack of event</a> <em>Submitted by 0x1f8b</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/200\">[N-04] The    initialize    function   does   not   check   for   non-zero   address and emit event</a> <em>Submitted by Jujic</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/107\">[N-05] Missing event &#x26; timelock for critical only* functions</a> <em>Submitted by cccz, also found by 0v3rf10w and WatchPug</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/40\">[N-06] L1Escrow.approve should be called before calling L1LPTGateway.finalizeInboundTransfer</a> <em>Submitted by cccz</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/2\">[N-07] No check that the amount arg that is being minted is larger than 0</a> <em>Submitted by jayjonah8</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/25\">[N-08] burn() function does not check that _amount is larger than 0</a> <em>Submitted by jayjonah8</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/27\">[N-09] value argument in approve() function not required to be greater than 0</a> <em>Submitted by jayjonah8</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/38\">[N-10] _token arg should be from a whitelisted group to avoid use of malicious tokens</a> <em>Submitted by jayjonah8</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/44\">[N-11] no check that _amount arg is greater than 0 in outboundTransfer() function </a> <em>Submitted by jayjonah8</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/111\">[N-12] Prevent accidentally burning tokens</a> <em>Submitted by Dravee</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/143\">[N-13] <code>Manager.sol:setController()</code> should be a two-step process</a> <em>Submitted by Dravee, also found by pauliax</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/122\">[N-14] <code>BridgeMinter.sol:migrateToNewMinter()</code>’s <code>transferOwnership</code> should be a two-step process</a> <em>Submitted by Dravee</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/138\">[N-15] Group related data into separate structs</a> <em>Submitted by Dravee</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/47\">[N-16] Protocol uses floating pragmas </a> <em>Submitted by jayjonah8, also found by hyh</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/155\">[N-17] MixinWrappers.batchRedeemWinningTickets doesn’t check for supplied arrays length</a> <em>Submitted by hyh</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/234\">[N-18] Migrate old balance on setToken</a> <em>Submitted by pauliax</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/8\">[N-19] Not verified function inputs of public / external functions</a> <em>Submitted by robee</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/157\">[N-20] L2LPTGateway descriptions to be corrected</a> <em>Submitted by hyh, also found by sirhashalot</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/119\">[N-21] Name reuse</a> <em>Submitted by sirhashalot</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/118\">[N-22] EIP2612 in token problematic</a> <em>Submitted by sirhashalot</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/207\">[N-23] Don’t use deprecated library functions</a> <em>Submitted by byterocket</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/10\">[N-24] Solidity compiler versions mismatch</a> <em>Submitted by robee</em>.</li>\n</ul>\n<h1 id=\"gas-optimizations-38\" style=\"position:relative;\"><a href=\"#gas-optimizations-38\" aria-label=\"gas optimizations 38 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gas Optimizations (38)</h1>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/184\">[G-01] Cache and read storage variables from the stack can save gas</a> <em>Submitted by WatchPug, also found by Dravee</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/21\">[G-02] Public functions to external</a> <em>Submitted by robee</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/124\">[G-03] Setting <code>uint256</code> variables to <code>0</code> is redundant</a> <em>Submitted by WatchPug, also found by 0x0x0x, defsec, Dravee, Jujic, robee, and ye0lde</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/77\">[G-04] Cache array length in for loops can save gas</a> <em>Submitted by defsec, also found by byterocket, Dravee, robee, and WatchPug</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/215\">[G-05] Don’t assign default values</a> <em>Submitted by 0x0x0x, also found by sirhashalot</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/19\">[G-06] Prefix increments are cheaper than postfix increments</a> <em>Submitted by robee, also found by 0x1f8b, defsec, Dravee, Jujic, OriDabush, and WatchPug</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/92\">[G-07] Gas optimization - remove method in DelegatorPool</a> <em>Submitted by 0x1f8b</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/137\">[G-08] Gas: Control flow optimization in <code>L2LPTDataCache.sol:decreaseL2SupplyFromL1()</code></a> <em>Submitted by Dravee, also found by pauliax</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/141\">[G-09] Gas: Missing checks for non-zero transfer value calls</a> <em>Submitted by Dravee</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/146\">[G-10] Gas: <code>DelegatorPool.sol:claim()</code>, a repetitive arithmetic operation should be cached</a> <em>Submitted by Dravee</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/131\">[G-11] <code>DelegatorPool.sol#claim()</code> Use inline expression can save gas</a> <em>Submitted by WatchPug, also found by Dravee</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/150\">[G-12] Gas: <code>L2LPTDataCache.sol:l1CirculatingSupply()</code>, strict comparison can avoid expensive operation</a> <em>Submitted by Dravee, also found by WatchPug</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/151\">[G-13] Gas: <code>L2LPTDataCache.sol:l1CirculatingSupply()</code>, Storage variables should be cached</a> <em>Submitted by Dravee, also found by Jujic</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/163\">[G-14] Gas: Mark functions as payable when users can’t mistakenly send ETH</a> <em>Submitted by Dravee</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/243\">[G-15] Gas: use <code>msg.sender</code> instead of OpenZeppelin’s <code>_msgSender()</code> when GSN capabilities aren’t used</a> <em>Submitted by Dravee, also found by defsec and rfa</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/244\">[G-16] Gas: Use <code>msg.sender</code> directly instead of caching it in a variable</a> <em>Submitted by Dravee</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/14\">[G-17] Upgrade pragma to at least 0.8.4</a> <em>Submitted by robee, also found by defsec, Dravee, and gzeon</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/172\">[G-18] Constant variables using keccak can be immutable</a> <em>Submitted by ye0lde, also found by byterocket, defsec, Dravee, Jujic, p4st13r4, and pauliax</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/115\">[G-19] Revert string > 32 bytes</a> <em>Submitted by sirhashalot, also found by aga7hokakological, defsec, Dravee, gzeon, Jujic, p4st13r4, robee, and WatchPug</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/61\">[G-20] Gas: Use <code>calldata</code> instead of <code>memory</code> for external functions where the function argument is read-only.</a> <em>Submitted by Dravee, also found by defsec</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/62\">[G-21] Gas: Internal functions can be private if the contract is not herited</a> <em>Submitted by Dravee</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/63\">[G-22] Gas: Consider making some constants as non-public to save gas</a> <em>Submitted by Dravee</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/6\">[G-23] Named return issue</a> <em>Submitted by robee, also found by Dravee, WatchPug, and ye0lde</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/173\">[G-24] Save Gas With The Unchecked Keyword (L2LPTDataCache.sol)</a> <em>Submitted by ye0lde, also found by defsec, Dravee, gzeon, Jujic, and WatchPug</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/103\">[G-25] Drop the token parameter from since it can only be the same value</a> <em>Submitted by Ruhum</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/135\">[G-26] Avoiding unnecessary repeated account balance read can save gas</a> <em>Submitted by WatchPug, also found by gzeon, hyh, and Tomio</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/30\">[G-27] using empty String which is already default 0x</a> <em>Submitted by Tomio</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/51\">[G-28] double storage call in function decreaseL2SupplyFromL1</a> <em>Submitted by Tomio</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/127\">[G-29] Check of <code>!migratedDelegators[delegator]</code> can be done earlier to save gas</a> <em>Submitted by WatchPug</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/129\">[G-30] Changing bool to uint256 can save gas</a> <em>Submitted by WatchPug</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/133\">[G-31] Inline unnecessary internal function can make the code simpler and save some gas</a> <em>Submitted by WatchPug</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/180\">[G-32] Using immutable variables rather than local variables is cheaper</a> <em>Submitted by WatchPug</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/196\">[G-33] Remove redundant <code>_setRoleAdmin()</code> can save gas</a> <em>Submitted by WatchPug, also found by byterocket</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/204\">[G-34] Unnecessary checked arithmetic in for loops</a> <em>Submitted by WatchPug</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/225\">[G-35] Use abi.encodePacked for gas optimization</a> <em>Submitted by defsec</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/192\">[G-36] redundant function argument</a> <em>Submitted by egjlmn1</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/154\">[G-37] DelegatorPool.claim subtraction can be unchecked and done once</a> <em>Submitted by hyh, also found by pauliax</em>.</li>\n<li><a href=\"https://github.com/code-423n4/2022-01-livepeer-findings/issues/116\">[G-38] Custom GOVERNOR_ROLE unnecessary</a> <em>Submitted by sirhashalot</em>.</li>\n</ul>\n<h1 id=\"disclosures\" style=\"position:relative;\"><a href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Disclosures</h1>\n<p>C4 is an open organization governed by participants in the community.</p>\n<p>C4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.</p>\n<p>C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>",
  "toc": "<ul>\n<li>\n<p><a href=\"#overview\">Overview</a></p>\n<ul>\n<li><a href=\"#about-c4\">About C4</a></li>\n<li><a href=\"#wardens\">Wardens</a></li>\n</ul>\n</li>\n<li><a href=\"#summary\">Summary</a></li>\n<li><a href=\"#scope\">Scope</a></li>\n<li><a href=\"#severity-criteria\">Severity Criteria</a></li>\n<li>\n<p><a href=\"#high-risk-findings-1\">High Risk Findings (1)</a></p>\n<ul>\n<li><a href=\"#h-01-wp-h5-l1migratorsolmigrateeth-does-not-send-bridgeminters-eth-to-l2-causing-eth-get-frozen-in-the-contract\">[H-01] [WP-H5] <code>L1Migrator.sol#migrateETH()</code> does not send <code>bridgeMinter</code>’s ETH to L2 causing ETH get frozen in the contract</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#medium-risk-findings-8\">Medium Risk Findings (8)</a></p>\n<ul>\n<li><a href=\"#m-01-l1migratormigratelpt-can-be-used-to-take-away-protocols-access-to-lpt-tokens-in-bridgeminter\">[M-01] L1Migrator.migrateLPT` can be used to take away protocol’s access to LPT tokens in BridgeMinter</a></li>\n<li><a href=\"#m-02-wp-h3-l1migratorsolmigrateeth-improper-implementation-of-l1migrator-causing-migrateeth-always-reverts-can-lead-to-eth-in-bridgeminter-getting-stuck-in-the-contract\">[M-02] [WP-H3] <code>L1Migrator.sol#migrateETH()</code> Improper implementation of <code>L1Migrator</code> causing <code>migrateETH()</code> always reverts, can lead to ETH in <code>BridgeMinter</code> getting stuck in the contract</a></li>\n<li><a href=\"#m-03-fund-loss-when-insufficient-call-value-to-cover-fee\">[M-03] Fund loss when insufficient call value to cover fee</a></li>\n<li><a href=\"#m-04-wp-m0-minter_role-can-be-granted-by-the-deployer-of-l2livepeertoken-and-mint-arbitrary-amount-of-tokens\">[M-04] [WP-M0] <code>MINTER_ROLE</code> can be granted by the deployer of L2LivepeerToken and mint arbitrary amount of tokens</a></li>\n<li><a href=\"#m-05-wp-m1-burner_role-can-burn-any-amount-of-l2livepeertoken-from-an-arbitrary-address\">[M-05] [WP-M1] <code>BURNER_ROLE</code> can burn any amount of L2LivepeerToken from an arbitrary address</a></li>\n<li><a href=\"#m-06-wp-m2-default_admin_role-can-approve-arbitrary-address-to-spend-any-amount-from-the-l1escrow-contract\">[M-06] [WP-M2] <code>DEFAULT_ADMIN_ROLE</code> can approve arbitrary address to spend any amount from the <code>L1Escrow</code> contract</a></li>\n<li><a href=\"#m-07-wp-m4-unable-to-use-l2gatewayrouter-to-withdraw-lpt-from-l2-to-l1-as-l2lptgateway-does-not-implement-l2gatewayrouter-expected-method\">[M-07] [WP-M4] Unable to use <code>L2GatewayRouter</code> to withdraw LPT from L2 to L1, as <code>L2LPTGateway</code> does not implement <code>L2GatewayRouter</code> expected method</a></li>\n<li><a href=\"#m-08-admin-can-rug-l2-escrow-tokens-leading-to-reputation-risk\">[M-08] Admin can rug L2 Escrow tokens leading to reputation risk</a></li>\n</ul>\n</li>\n<li><a href=\"#low-risk-findings-11\">Low Risk Findings (11)</a></li>\n<li><a href=\"#non-critical-findings-24\">Non-Critical Findings (24)</a></li>\n<li><a href=\"#gas-optimizations-38\">Gas Optimizations (38)</a></li>\n<li><a href=\"#disclosures\">Disclosures</a></li>\n</ul>",
  "md": "\n# Overview\n\n## About C4\n\nCode4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.\n\nA C4 code contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.\n\nDuring the code contest outlined in this document, C4 conducted an analysis of Livepeer contest smart contract system written in Solidity. The code contest took place between January 13—January 19 2022.\n\n## Wardens\n\n31 Wardens contributed reports to the Livepeer contest:\n\n1. WatchPug ([jtp](https://github.com/jack-the-pug) and [ming](https://github.com/mingwatch))\n1. [gzeon](https://twitter.com/gzeon)\n1. harleythedog\n1. [Ruhum](https://twitter.com/0xruhum)\n1. [Dravee](https://twitter.com/JustDravee)\n1. 0x1f8b\n1. cccz\n1. [defsec](https://twitter.com/defsec_)\n1. [sirhashalot](https://twitter.com/SirH4shalot)\n1. hyh\n1. [danb](https://twitter.com/danbinnun)\n1. robee\n1. [pauliax](https://twitter.com/SolidityDev)\n1. [Tomio](https://twitter.com/meidhiwirara)\n1. [kemmio](https://twitter.com/k3mmio)\n1. egjlmn1\n1. Jujic\n1. byterocket ([pmerkleplant](https://twitter.com/merkleplant_eth) and [pseudorandom](https://binbash.sh))\n1. 0x0x0x\n1. [ye0lde](https://twitter.com/_ye0lde)\n1. [rfa](https://www.instagram.com/riyan_rfa/)\n1. p4st13r4 (0xb4bb4 and [0x69e8](https://github.com/0x69e8))\n1. [OriDabush](https://twitter.com/ori_dabush)\n1. aga7hokakological\n1. [0v3rf10w](https://twitter.com/_0v3rf10w)\n1. jayjonah8\n1. SolidityScan ([cyberboy](https://twitter.com/cyberboyIndia) and [zombie](https://blog.dixitaditya.com/))\n\nThis contest was judged by [0xleastwood](https://twitter.com/liam_eastwood13).\n\nFinal report assembled by [itsmetechjay](https://twitter.com/itsmetechjay) and [CloudEllie](https://twitter.com/CloudEllie1).\n\n# Summary\n\nThe C4 analysis yielded an aggregated total of 20 unique vulnerabilities and 82 total findings. All of the issues presented here are linked back to their original finding.\n\nOf these vulnerabilities, 1 received a risk rating in the category of HIGH severity, 8 received a risk rating in the category of MEDIUM severity, and 11 received a risk rating in the category of LOW severity.\n\nC4 analysis also identified 24 non-critical recommendations and 38 gas optimizations.\n\n# Scope\n\nThe code under review can be found within the [C4 Livepeer contest repository](https://github.com/code-423n4/2022-01-livepeer), and is composed of 16 smart contracts written in the Solidity programming language and includes 1928 lines of Solidity code.\n\n# Severity Criteria\n\nC4 assesses the severity of disclosed vulnerabilities according to a methodology based on [OWASP standards](https://owasp.org/www-community/OWASP_Risk_Rating_Methodology).\n\nVulnerabilities are divided into three primary risk categories: high, medium, and low.\n\nHigh-level considerations for vulnerabilities span the following key areas when conducting assessments:\n\n- Malicious Input Handling\n- Escalation of privileges\n- Arithmetic\n- Gas use\n\nFurther information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on [the C4 website](https://code423n4.com).\n\n# High Risk Findings (1)\n## [[H-01] [WP-H5] `L1Migrator.sol#migrateETH()` does not send `bridgeMinter`'s ETH to L2 causing ETH get frozen in the contract](https://github.com/code-423n4/2022-01-livepeer-findings/issues/205)\n_Submitted by WatchPug, also found by gzeon, harleythedog, and Ruhum_.\n\nPer the `arb-bridge-eth` code:\n\n> all msg.value will deposited to callValueRefundAddress on L2\n\n- <https://github.com/OffchainLabs/arbitrum/blob/78118ba205854374ed280a27415cb62c37847f72/packages/arb-bridge-eth/contracts/bridge/Inbox.sol#L313>\n\n- <https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/gateway/L1ArbitrumMessenger.sol#L65-L74>\n\n```solidity\nuint256 seqNum = inbox.createRetryableTicket{value: _l1CallValue}(\n    target,\n    _l2CallValue,\n    maxSubmissionCost,\n    from,\n    from,\n    maxGas,\n    gasPriceBid,\n    data\n);\n```\n\nAt L308-L309, ETH held by `BridgeMinter` is withdrawn to L1Migrator:\n\n<https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/gateway/L1Migrator.sol#L308-L309>\n\n```solidity\nuint256 amount = IBridgeMinter(bridgeMinterAddr)\n    .withdrawETHToL1Migrator();\n```\n\nHowever, when calling `sendTxToL2()` the parameter `_l1CallValue` is only the `msg.value`, therefore, the ETH transferred to L2 does not include any funds from `bridgeMinter`.\n\n<https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/gateway/L1Migrator.sol#L318-L327>\n\n```solidity\nsendTxToL2(\n    l2MigratorAddr,\n    address(this), // L2 alias of this contract will receive refunds\n    msg.value,\n    amount,\n    _maxSubmissionCost,\n    _maxGas,\n    _gasPriceBid,\n    \"\"\n)\n```\n\nAs a result, due to lack of funds, `call` with value = amount to `l2MigratorAddr` will always fail on L2.\n\nSince there is no other way to send ETH to L2, all the ETH from `bridgeMinter` is now frozen in the contract.\n\n#### Recommendation\n\nChange to:\n\n```solidity\nsendTxToL2(\n    l2MigratorAddr,\n    address(this), // L2 alias of this contract will receive refunds\n    msg.value + amount, // the `amount` withdrawn from BridgeMinter should be added\n    amount,\n    _maxSubmissionCost,\n    _maxGas,\n    _gasPriceBid,\n    \"\"\n)\n```\n\n**[yondonfu (Livepeer) confirmed and resolved](https://github.com/code-423n4/2022-01-livepeer-findings/issues/205#issuecomment-1021378858):**\n > Fixed in https://github.com/livepeer/arbitrum-lpt-bridge/pull/51\n\n**[0xleastwood (judge) commented](https://github.com/code-423n4/2022-01-livepeer-findings/issues/205#issuecomment-1025008573):**\n > Awesome find!\n\n\n\n \n# Medium Risk Findings (8)\n## [[M-01] L1Migrator.migrateLPT` can be used to take away protocol's access to LPT tokens in BridgeMinter](https://github.com/code-423n4/2022-01-livepeer-findings/issues/97)\n_Submitted by Ruhum, also found by gzeon and harleythedog_.\n\nSame thing as the ETH issue I reported earlier. I wasn't sure if those are supposed to be a single issue or not. The concept is the same. But, now you lose LPT tokens.\n\nThe `L1Migrator.migrateLPT()` function can be called by **anyone**. It pulls all the LPT from the `BridgeMinter` contract and starts the process of moving the funds to L2. First of all, this function is only executable once. The RetryableTicket created with the first call is the only chance of moving the funds to L2.\n\nThe attacker can call the function with [parameters](https://developer.offchainlabs.com/docs/l1\\_l2\\_messages#parameters) that make the creation of the RetryableTicket on L2 fail. Thus, the LPT sits in the L1Migrator contract with no way of moving it to L2 or anywhere else. Effectively, the funds are lost.\n\n#### Proof of Concept\n\nThe function is only executable once because it uses the `amount` returned by `IBridgeMinter(bridgeMinterAddr).withdrawLPTToL1Migrator()` to specify the amount of LPT to be sent to L2: <https://github.com/livepeer/arbitrum-lpt-bridge/blob/main/contracts/L1/gateway/L1Migrator.sol#L342>\n\nAfter the first call to `migrateLPT()` that function will always return 0 since the `BridgeMinter` won't have any more LPT: <https://github.com/livepeer/protocol/blob/streamflow/contracts/token/BridgeMinter.sol#L107>\n\nSo after the attacker called `migrateLPT()` with insufficient funds to create a RetryableTicket on L2 we have the following state:\n\n*   BridgeMinter has 0 LPT\n*   L1Migrator has X amount of LPT that is not accessible. There are no functions to get the LPT out of there.\n*   1 failed RetryTicket\n\nThe same thing can also be triggered by a non-malicious caller by simply providing insufficient funds. The whole design of only being able to try once is the issue here.\n\n#### Recommended Mitigation Steps\n\nInstead of using the `amount` returned by `IBridgeMinter(bridgeMinterAddr).withdrawLPTToL1Migrator()` you should use the balance of the `L1Migrator` contract.\n\nIt might also make sense to **not** allow anybody to call the function. I don't see the benefit of that.\n\nActually, the funds aren't lost. The funds are sent to the Escrow contract which can be used to transfer the funds back to the BridgeMinter contract. Thus, you could reset the whole thing to its initial state and call `L1Migrator.migrateLPT()` again. But, a really persistent attacker has the ability to DoS the function by frontrunning any call to it which results in the RetryableTicket failing again. Thus, you'd have to transfer the funds from the Escrow contract to the BrigeMinter again and so on.\n\nSo the same scenario I've outlined earlier is still viable. It's just a bit more difficult now since it has a higher cost for the attacker now. Because of that I think it's an medium issue instead of high.\n\nAlso, the mitigation steps I've given aren't valid. You can't use the `L1Migrator` contract's balance since it will always be 0 (the funds are sent to the Escrow contract). Thus the best solution would be to just limit the access to the function.\n\n**[0xleastwood (judge) commented](https://github.com/code-423n4/2022-01-livepeer-findings/issues/97#issuecomment-1025008823):**\n > Nice find! The warden has outlined a potential DOS attack which can lead to funds lost which are only recoverable by the transferring the funds in the escrow contract back to the bridge minter contract.\n\n**[yondonfu (Livepeer) confirmed and resolved](https://github.com/code-423n4/2022-01-livepeer-findings/issues/97#issuecomment-1026222409):**\n > Fixed in https://github.com/livepeer/arbitrum-lpt-bridge/commit/5b6a349ad8f4e53c01d2e43eda36bbbf3037a3c9\n\n\n\n## [[M-02] [WP-H3] `L1Migrator.sol#migrateETH()` Improper implementation of `L1Migrator` causing `migrateETH()` always reverts, can lead to ETH in `BridgeMinter` getting stuck in the contract](https://github.com/code-423n4/2022-01-livepeer-findings/issues/198)\n_Submitted by WatchPug, also found by gzeon_.\n\n<https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/gateway/L1Migrator.sol#L308-L310>\n\n```solidity\nuint256 amount = IBridgeMinter(bridgeMinterAddr).withdrawETHToL1Migrator();\n```\n\n`L1Migrator.sol#migrateETH()` will call `IBridgeMinter(bridgeMinterAddr).withdrawETHToL1Migrator()` to withdraw ETH from `BridgeMinter`.\n\nHowever, the current implementation of `L1Migrator` is unable to receive ETH.\n\n<https://github.com/livepeer/protocol/blob/20e7ebb86cdb4fe9285bf5fea02eb603e5d48805/contracts/token/BridgeMinter.sol#L94-L94>\n\n```solidity\n(bool ok, ) = l1MigratorAddr.call.value(address(this).balance)(\"\");\n```\n\nA contract receiving Ether must have at least one of the functions below:\n\n*   `receive() external payable`\n*   `fallback() external payable`\n\n`receive()` is called if `msg.data` is empty, otherwise `fallback()` is called.\n\nBecause `L1Migrator` implement neither `receive()` or `fallback()`, the `call` at L94 will always revert.\n\n#### Impact\n\nAll the ETH held by the `BridgeMinter` can get stuck in the contract.\n\n#### Recommendation\n\nAdd `receive() external payable {}` in `L1Migrator`.\n\n**[yondonfu (Livepeer) confirmed and disagreed with severity](https://github.com/code-423n4/2022-01-livepeer-findings/issues/198#issuecomment-1019663325):**\n > Severity: 2 (Med)\n> \n> We'll fix this, but noting that the funds are recoverable because the BridgeMinter can set a new L1Migrator that does have the receive() function which is why the suggested severity is 2 (Med).\n\n**[yondonfu (Livepeer) resolved](https://github.com/code-423n4/2022-01-livepeer-findings/issues/198#issuecomment-1021379439):**\n > Fixed in https://github.com/livepeer/arbitrum-lpt-bridge/pull/50\n\n**[0xleastwood (judge) commented](https://github.com/code-423n4/2022-01-livepeer-findings/issues/198#issuecomment-1025009024):**\n > Agree with sponsor, these funds are recoverable. However, the warden has identified a DOS attack, which is a valid `medium` severity issue.\n\n\n\n## [[M-03] Fund loss when insufficient call value to cover fee](https://github.com/code-423n4/2022-01-livepeer-findings/issues/238)\n_Submitted by gzeon_.\n\nFund can be lost if the L1 call value provided is insufficient to cover `_maxSubmissionCost`, or stuck if insufficient to cover `_maxSubmissionCost + (_maxGas * _gasPriceBid)`.\n\n#### Proof of Concept\n\n`outboundTransfer` in `L1LPTGateway` does not check if the call value is sufficient, if it is `< _maxSubmissionCost` the retryable ticket creation will fail and fund is lost; if it is `<_maxSubmissionCost + (_maxGas * _gasPriceBid)` the ticket would require manual execution.\n\n<https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/gateway/L1LPTGateway.sol#L80>\n```solidity\nfunction outboundTransfer(\n    address _l1Token,\n    address _to,\n    uint256 _amount,\n    uint256 _maxGas,\n    uint256 _gasPriceBid,\n    bytes calldata _data\n) external payable override whenNotPaused returns (bytes memory) {\n    require(_l1Token == l1Lpt, \"TOKEN_NOT_LPT\");\n\n    // nested scope to avoid stack too deep errors\n    address from;\n    uint256 seqNum;\n    bytes memory extraData;\n    {\n        uint256 maxSubmissionCost;\n        (from, maxSubmissionCost, extraData) = parseOutboundData(_data);\n        require(extraData.length == 0, \"CALL_HOOK_DATA_NOT_ALLOWED\");\n\n        // transfer tokens to escrow\n        TokenLike(_l1Token).transferFrom(from, l1LPTEscrow, _amount);\n\n        bytes memory outboundCalldata = getOutboundCalldata(\n            _l1Token,\n            from,\n            _to,\n            _amount,\n            extraData\n        );\n\n        seqNum = sendTxToL2(\n            l2Counterpart,\n            from,\n            maxSubmissionCost,\n            _maxGas,\n            _gasPriceBid,\n            outboundCalldata\n        );\n    }\n\n    emit DepositInitiated(_l1Token, from, _to, seqNum, _amount);\n\n    return abi.encode(seqNum);\n}\n```\n#### Recommended Mitigation Steps\n\nAdd check similar to the one used in `L1GatewayRouter` provided by Arbitrum team\n\n<https://github.com/OffchainLabs/arbitrum/blob/b8366005a697000dda1f57a78a7bdb2313db8fe2/packages/arb-bridge-peripherals/contracts/tokenbridge/ethereum/gateway/L1GatewayRouter.sol#L236>\n```solidity\nuint256 expectedEth = _maxSubmissionCost + (_maxGas * _gasPriceBid);\nrequire(_maxSubmissionCost > 0, \"NO_SUBMISSION_COST\");\nrequire(msg.value == expectedEth, \"WRONG_ETH_VALUE\");\n```\n\n**[yondonfu (Livepeer) confirmed and disagreed with severity](https://github.com/code-423n4/2022-01-livepeer-findings/issues/238#issuecomment-1018693125):**\n > Labeled as disagree with severity because we think this is a 2 - Med finding. We think that the likelihood of this occurring is low because in almost all cases users should be interacting with this contract using an application that handles calculating the maxSubmissionCost properly which would prevent the reported issue. However, we do think that the impact *if* this occurs is high since LPT *and* ETH could be lost if the reported issue happens. Thus, we think 2 - Med is appropriate given that assets are not at direct risk, but there is a low probability path for assets to be lost.\n\n**[0xleastwood (judge) commented](https://github.com/code-423n4/2022-01-livepeer-findings/issues/238#issuecomment-1025009724):**\n > I agree, there is potential for unintentional loss of funds, however, the attack vector makes assumptions on how this might occur. Due to the unlikely nature, I agree that this should be a `medium` severity issue..\n\n**[yondonfu (Livepeer) resolved](https://github.com/code-423n4/2022-01-livepeer-findings/issues/238#issuecomment-1026220888):**\n > Fixed in https://github.com/livepeer/arbitrum-lpt-bridge/commit/6615bb8ce0fced895acd0e5d3e826c1e7b5d0138\n\n\n\n## [[M-04] [WP-M0] `MINTER_ROLE` can be granted by the deployer of L2LivepeerToken and mint arbitrary amount of tokens](https://github.com/code-423n4/2022-01-livepeer-findings/issues/193)\n_Submitted by WatchPug_.\n\n<https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L2/token/LivepeerToken.sol#L23-L30>\n\n```solidity\nfunction mint(address _to, uint256 _amount)\n    external\n    override\n    onlyRole(MINTER_ROLE)\n{\n    _mint(_to, _amount);\n    emit Mint(_to, _amount);\n}\n```\n\nUsing the `mint()` function of `L2LivepeerToken`, an address with `MINTER_ROLE` can burn an arbitrary amount of tokens.\n\nIf the private key of the deployer or an address with the `MINTER_ROLE` is compromised, the attacker will be able to mint an unlimited amount of LPT tokens.\n\nWe believe this is unnecessary and poses a serious centralization risk.\n\n#### Recommendation\n\nConsider removing the `MINTER_ROLE`, make the `L2LivepeerToken` only mintable by the owner, and make the L2Minter contract to be the owner and therefore the only minter.\n\n**[yondonfu (Livepeer) acknowledged](https://github.com/code-423n4/2022-01-livepeer-findings/issues/193#issuecomment-1019660423):**\n > Planning on keeping the role since the L2LPTGateway needs to be given minting rights as well in addition to the L2 Minter.\n\n\n\n## [[M-05] [WP-M1] `BURNER_ROLE` can burn any amount of L2LivepeerToken from an arbitrary address](https://github.com/code-423n4/2022-01-livepeer-findings/issues/194)\n_Submitted by WatchPug, also found by cccz_.\n\n<https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L2/token/LivepeerToken.sol#L36-L43>\n\n```solidity\nfunction burn(address _from, uint256 _amount)\n    external\n    override\n    onlyRole(BURNER_ROLE)\n{\n    _burn(_from, _amount);\n    emit Burn(_from, _amount);\n}\n```\n\nUsing the `burn()` function of `L2LivepeerToken`, an address with `BURNER_ROLE` can burn an arbitrary amount of tokens from any address.\n\nWe believe this is unnecessary and poses a serious centralization risk.\n\nA malicious or compromised `BURNER_ROLE` address can take advantage of this, burn the balance of a Uniswap pool and effectively steal almost all the funds from the liquidity pool (eg, Uniswap LPT-WETH Pool).\n\n#### Recommendation\n\nConsider removing the `BURNER_ROLE` and change `burn()` function to:\n\n```solidity\nfunction burn(uint256 _amount)\n    external\n    override\n{\n    _burn(msg.sender, _amount);\n    emit Burn(msg.sender, _amount);\n}\n```\n\n<https://github.com/livepeer/arbitrum-lpt-bridge/blob/49cf5401b0514511675d781a1e29d6b0325cfe88/contracts/L2/gateway/L2LPTGateway.sol#L34-L45>\n\n`Mintable(l2Lpt).burn(from, _amount);` in `L2LPTGateway.sol#outboundTransfer()` should also be replaced with:\n\n```solidity\nMintable(l2Lpt).transferFrom(from, _amount);\nMintable(l2Lpt).burn(_amount);\n```\n\n**[yondonfu (Livepeer) confirmed and resolved](https://github.com/code-423n4/2022-01-livepeer-findings/issues/194#issuecomment-1021377760):**\n > Fixed in https://github.com/livepeer/arbitrum-lpt-bridge/pull/52\n\n\n\n## [[M-06] [WP-M2] `DEFAULT_ADMIN_ROLE` can approve arbitrary address to spend any amount from the `L1Escrow` contract](https://github.com/code-423n4/2022-01-livepeer-findings/issues/195)\n_Submitted by WatchPug_.\n\n<https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/escrow/L1Escrow.sol#L21-L28>\n\n```solidity\nfunction approve(\n    address _token,\n    address _spender,\n    uint256 _value\n) public onlyRole(DEFAULT_ADMIN_ROLE) {\n    ApproveLike(_token).approve(_spender, _value);\n    emit Approve(_token, _spender, _value);\n}\n```\n\n`L1Escrow.sol#approve()` allows an address with `DEFAULT_ADMIN_ROLE` can approve an arbitrary amount of tokens to any address.\n\nWe believe this is unnecessary and poses a serious centralization risk.\n\nA malicious or compromised `DEFAULT_ADMIN_ROLE` address can take advantage of this, and steal all the funds from the `L1Escrow` contract.\n\n#### Recommendation\n\nConsider removing `approve()` function and approve `l1LPT` to `l1Gateway` in the constructor.\n\n**[yondonfu (Livepeer) acknowledged](https://github.com/code-423n4/2022-01-livepeer-findings/issues/195#issuecomment-1019662710):**\n > Likely won't change as we want to preserve the ability for protocol governance to move the LPT from the L1Escrow in the event of a L2 failure.\n\n\n\n## [[M-07] [WP-M4] Unable to use `L2GatewayRouter` to withdraw LPT from L2 to L1, as `L2LPTGateway` does not implement `L2GatewayRouter` expected method](https://github.com/code-423n4/2022-01-livepeer-findings/issues/202)\n_Submitted by WatchPug_.\n\nPer the document: <https://github.com/code-423n4/2022-01-livepeer#l2---l1-lpt-withdrawal>\n\n> The following occurs when LPT is withdrawn from L2 to L1:\n\n> The user initiates a withdrawal for X LPT. This can be done in two ways: a. Call outboundTransfer() on L2GatewayRouter which will call outboundTransfer() on L2LPTGateway b. Call outboundTransfer() directly on L2LPTGateway\n\nThe method (a) described above won't work in the current implementation due to the missing interface on `L2LPTGateway`.\n\nWhen initiate a withdraw from the Arbitrum Gateway Router, `L2GatewayRouter` will call `outboundTransfer(address,address,uint256,uint256,uint256,bytes)` on `ITokenGateway(gateway)`:\n\n```solidity\nfunction outboundTransfer(\n    address _token,\n    address _to,\n    uint256 _amount,\n    uint256 _maxGas,\n    uint256 _gasPriceBid,\n    bytes calldata _data\n) external payable returns (bytes memory);\n```\n\n<https://github.com/OffchainLabs/arbitrum/blob/b8366005a697000dda1f57a78a7bdb2313db8fe2/packages/arb-bridge-peripherals/contracts/tokenbridge/arbitrum/gateway/L2GatewayRouter.sol#L57-L64>\n\n```solidity\nfunction outboundTransfer(\n    address _l1Token,\n    address _to,\n    uint256 _amount,\n    bytes calldata _data\n) public payable returns (bytes memory) {\n    return outboundTransfer(_l1Token, _to, _amount, 0, 0, _data);\n}\n```\n\n<https://github.com/OffchainLabs/arbitrum/blob/b8366005a697000dda1f57a78a7bdb2313db8fe2/packages/arb-bridge-peripherals/contracts/tokenbridge/libraries/gateway/GatewayRouter.sol#L78-L102>\n\n```solidity\nfunction outboundTransfer(\n    address _token,\n    address _to,\n    uint256 _amount,\n    uint256 _maxGas,\n    uint256 _gasPriceBid,\n    bytes calldata _data\n) public payable virtual override returns (bytes memory) {\n    address gateway = getGateway(_token);\n    bytes memory gatewayData = GatewayMessageHandler.encodeFromRouterToGateway(\n        msg.sender,\n        _data\n    );\n\n    emit TransferRouted(_token, msg.sender, _to, gateway);\n    return\n        ITokenGateway(gateway).outboundTransfer{ value: msg.value }(\n            _token,\n            _to,\n            _amount,\n            _maxGas,\n            _gasPriceBid,\n            gatewayData\n        );\n}\n```\n\nHowever, `L2LPTGateway` dose not implement `outboundTransfer(address,address,uint256,uint256,uint256,bytes)` but only `outboundTransfer(address,address,uint256,bytes)`:\n\n<https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L2/gateway/L2LPTGateway.sol#L65-L89>\n\n```solidity\nfunction outboundTransfer(\n    address _l1Token,\n    address _to,\n    uint256 _amount,\n    bytes calldata _data\n) public override whenNotPaused returns (bytes memory res) {\n    // ...\n}\n```\n\nTherefore, the desired feature to withdraw LPT from L2 to L1 via Arbitrum Router will not be working properly.\n\n#### Recommendation\n\nConsider implementing the method used by  Arbitrum Router.\n\nSee also the implementation of L2DaiGateway by arbitrum-dai-bridge: <https://github.com/makerdao/arbitrum-dai-bridge/blob/master/contracts/l2/L2DaiGateway.sol#L88-L95>\n\n**[yondonfu (Livepeer) confirmed and resolved](https://github.com/code-423n4/2022-01-livepeer-findings/issues/202#issuecomment-1026222951):**\n > Fixed in https://github.com/livepeer/arbitrum-lpt-bridge/pull/57\n\n\n\n## [[M-08] Admin can rug L2 Escrow tokens leading to reputation risk](https://github.com/code-423n4/2022-01-livepeer-findings/issues/165)\n_Submitted by harleythedog_.\n\nThe `L1Escrow` contract has the function `approve` that is callable by the admin to approve an arbitrary spender with an arbitrary amount (so they can steal all of the escrow's holdings if they want). Even if the admin is well intended, the contract can still be called out which would degrade the reputation of the protocol (e.g. see here: <https://twitter.com/RugDocIO/status/1411732108029181960>). LPT is valuable on the Ethereum mainnet, so this rug vector should be mitigated. It would be best to restrict this function's power by only allowing approvals to other trusted protocol contracts (like L1LPTGateway, which I believe uses the escrow's approval).\n\nNOTE: Even if the admin is under a timelock, this is still an issue, as users have to wait a whole week to withdraw from L2 -> L1 due to the dispute period.\n\n#### Proof of Concept\n\nSee the `approve` function [here](https://github.com/livepeer/arbitrum-lpt-bridge/blob/ebf68d11879c2798c5ec0735411b08d0bea4f287/contracts/L1/escrow/L1Escrow.sol#L21)\n\n#### Recommended Mitigation Steps\n\nRestrict the power of this `approve` function so that the admin isn't able to steal funds. This can be accomplished by only allowing approvals to other protocol functions (instead of arbitrary approvals).\n\n**[yondonfu (Livepeer) acknowledged](https://github.com/code-423n4/2022-01-livepeer-findings/issues/165)** \n\n# Low Risk Findings (11)\n- [[L-01] No checks around poll voting mechanism](https://github.com/code-423n4/2022-01-livepeer-findings/issues/121) _Submitted by sirhashalot_.\n- [[L-02] Signature authentication bypass for ZERO address](https://github.com/code-423n4/2022-01-livepeer-findings/issues/142) _Submitted by kemmio, also found by 0x1f8b, danb, gzeon, and pauliax_.\n- [[L-03] Front running in LivepeerToken](https://github.com/code-423n4/2022-01-livepeer-findings/issues/91) _Submitted by 0x1f8b_.\n- [[L-04] Possible frozen gateway](https://github.com/code-423n4/2022-01-livepeer-findings/issues/87) _Submitted by 0x1f8b_.\n- [[L-05] `DelegatorPool.sol#claim()` Inaccurate check of `claimedInitialStake < initialStake`](https://github.com/code-423n4/2022-01-livepeer-findings/issues/190) _Submitted by WatchPug, also found by danb_.\n- [[L-06] `initialize` function can be called by everyone and front-run in `DelegatorPool.sol`](https://github.com/code-423n4/2022-01-livepeer-findings/issues/112) _Submitted by Dravee, also found by cccz, defsec, and robee_.\n- [[L-07] Missing `_from` param comment on `LivepeerToken.sol:burn()`](https://github.com/code-423n4/2022-01-livepeer-findings/issues/140) _Submitted by Dravee_.\n- [[L-08] In `L2Migrator.sol:finalizeMigrateDelegator()`, Account `l2Addr`'s existence should be checked before call](https://github.com/code-423n4/2022-01-livepeer-findings/issues/149) _Submitted by Dravee_.\n- [[L-09] Missing setter function for l2MigratorAddr](https://github.com/code-423n4/2022-01-livepeer-findings/issues/167) _Submitted by defsec_.\n- [[L-10] `L1LPTGateway`, `L2LPTGateway` should start off paused after deployed](https://github.com/code-423n4/2022-01-livepeer-findings/issues/203) _Submitted by WatchPug, also found by Ruhum_.\n- [[L-11] L2Migrator.claimStake attempts fee transfer without checking its possibility](https://github.com/code-423n4/2022-01-livepeer-findings/issues/153) _Submitted by hyh_.\n\n# Non-Critical Findings (24)\n- [[N-01] Missing 0 address check](https://github.com/code-423n4/2022-01-livepeer-findings/issues/4) _Submitted by cccz, also found by 0v3rf10w, 0x1f8b, defsec, Dravee, hyh, jayjonah8, OriDabush, SolidityScan, and Tomio_.\n- [[N-02] ERC20 Approval Race Condition](https://github.com/code-423n4/2022-01-livepeer-findings/issues/85) _Submitted by 0x1f8b_.\n- [[N-03] Lack of event](https://github.com/code-423n4/2022-01-livepeer-findings/issues/83) _Submitted by 0x1f8b_.\n- [[N-04] The    initialize    function   does   not   check   for   non-zero   address and emit event](https://github.com/code-423n4/2022-01-livepeer-findings/issues/200) _Submitted by Jujic_.\n- [[N-05] Missing event & timelock for critical only* functions](https://github.com/code-423n4/2022-01-livepeer-findings/issues/107) _Submitted by cccz, also found by 0v3rf10w and WatchPug_.\n- [[N-06] L1Escrow.approve should be called before calling L1LPTGateway.finalizeInboundTransfer](https://github.com/code-423n4/2022-01-livepeer-findings/issues/40) _Submitted by cccz_.\n- [[N-07] No check that the amount arg that is being minted is larger than 0](https://github.com/code-423n4/2022-01-livepeer-findings/issues/2) _Submitted by jayjonah8_.\n- [[N-08] burn() function does not check that _amount is larger than 0](https://github.com/code-423n4/2022-01-livepeer-findings/issues/25) _Submitted by jayjonah8_.\n- [[N-09] value argument in approve() function not required to be greater than 0](https://github.com/code-423n4/2022-01-livepeer-findings/issues/27) _Submitted by jayjonah8_.\n- [[N-10] _token arg should be from a whitelisted group to avoid use of malicious tokens](https://github.com/code-423n4/2022-01-livepeer-findings/issues/38) _Submitted by jayjonah8_.\n- [[N-11] no check that _amount arg is greater than 0 in outboundTransfer() function ](https://github.com/code-423n4/2022-01-livepeer-findings/issues/44) _Submitted by jayjonah8_.\n- [[N-12] Prevent accidentally burning tokens](https://github.com/code-423n4/2022-01-livepeer-findings/issues/111) _Submitted by Dravee_.\n- [[N-13] `Manager.sol:setController()` should be a two-step process](https://github.com/code-423n4/2022-01-livepeer-findings/issues/143) _Submitted by Dravee, also found by pauliax_.\n- [[N-14] `BridgeMinter.sol:migrateToNewMinter()`'s `transferOwnership` should be a two-step process](https://github.com/code-423n4/2022-01-livepeer-findings/issues/122) _Submitted by Dravee_.\n- [[N-15] Group related data into separate structs](https://github.com/code-423n4/2022-01-livepeer-findings/issues/138) _Submitted by Dravee_.\n- [[N-16] Protocol uses floating pragmas ](https://github.com/code-423n4/2022-01-livepeer-findings/issues/47) _Submitted by jayjonah8, also found by hyh_.\n- [[N-17] MixinWrappers.batchRedeemWinningTickets doesn't check for supplied arrays length](https://github.com/code-423n4/2022-01-livepeer-findings/issues/155) _Submitted by hyh_.\n- [[N-18] Migrate old balance on setToken](https://github.com/code-423n4/2022-01-livepeer-findings/issues/234) _Submitted by pauliax_.\n- [[N-19] Not verified function inputs of public / external functions](https://github.com/code-423n4/2022-01-livepeer-findings/issues/8) _Submitted by robee_.\n- [[N-20] L2LPTGateway descriptions to be corrected](https://github.com/code-423n4/2022-01-livepeer-findings/issues/157) _Submitted by hyh, also found by sirhashalot_.\n- [[N-21] Name reuse](https://github.com/code-423n4/2022-01-livepeer-findings/issues/119) _Submitted by sirhashalot_.\n- [[N-22] EIP2612 in token problematic](https://github.com/code-423n4/2022-01-livepeer-findings/issues/118) _Submitted by sirhashalot_.\n- [[N-23] Don't use deprecated library functions](https://github.com/code-423n4/2022-01-livepeer-findings/issues/207) _Submitted by byterocket_.\n- [[N-24] Solidity compiler versions mismatch](https://github.com/code-423n4/2022-01-livepeer-findings/issues/10) _Submitted by robee_.\n\n# Gas Optimizations (38)\n- [[G-01] Cache and read storage variables from the stack can save gas](https://github.com/code-423n4/2022-01-livepeer-findings/issues/184) _Submitted by WatchPug, also found by Dravee_.\n- [[G-02] Public functions to external](https://github.com/code-423n4/2022-01-livepeer-findings/issues/21) _Submitted by robee_.\n- [[G-03] Setting `uint256` variables to `0` is redundant](https://github.com/code-423n4/2022-01-livepeer-findings/issues/124) _Submitted by WatchPug, also found by 0x0x0x, defsec, Dravee, Jujic, robee, and ye0lde_.\n- [[G-04] Cache array length in for loops can save gas](https://github.com/code-423n4/2022-01-livepeer-findings/issues/77) _Submitted by defsec, also found by byterocket, Dravee, robee, and WatchPug_.\n- [[G-05] Don't assign default values](https://github.com/code-423n4/2022-01-livepeer-findings/issues/215) _Submitted by 0x0x0x, also found by sirhashalot_.\n- [[G-06] Prefix increments are cheaper than postfix increments](https://github.com/code-423n4/2022-01-livepeer-findings/issues/19) _Submitted by robee, also found by 0x1f8b, defsec, Dravee, Jujic, OriDabush, and WatchPug_.\n- [[G-07] Gas optimization - remove method in DelegatorPool](https://github.com/code-423n4/2022-01-livepeer-findings/issues/92) _Submitted by 0x1f8b_.\n- [[G-08] Gas: Control flow optimization in `L2LPTDataCache.sol:decreaseL2SupplyFromL1()`](https://github.com/code-423n4/2022-01-livepeer-findings/issues/137) _Submitted by Dravee, also found by pauliax_.\n- [[G-09] Gas: Missing checks for non-zero transfer value calls](https://github.com/code-423n4/2022-01-livepeer-findings/issues/141) _Submitted by Dravee_.\n- [[G-10] Gas: `DelegatorPool.sol:claim()`, a repetitive arithmetic operation should be cached](https://github.com/code-423n4/2022-01-livepeer-findings/issues/146) _Submitted by Dravee_.\n- [[G-11] `DelegatorPool.sol#claim()` Use inline expression can save gas](https://github.com/code-423n4/2022-01-livepeer-findings/issues/131) _Submitted by WatchPug, also found by Dravee_.\n- [[G-12] Gas: `L2LPTDataCache.sol:l1CirculatingSupply()`, strict comparison can avoid expensive operation](https://github.com/code-423n4/2022-01-livepeer-findings/issues/150) _Submitted by Dravee, also found by WatchPug_.\n- [[G-13] Gas: `L2LPTDataCache.sol:l1CirculatingSupply()`, Storage variables should be cached](https://github.com/code-423n4/2022-01-livepeer-findings/issues/151) _Submitted by Dravee, also found by Jujic_.\n- [[G-14] Gas: Mark functions as payable when users can't mistakenly send ETH](https://github.com/code-423n4/2022-01-livepeer-findings/issues/163) _Submitted by Dravee_.\n- [[G-15] Gas: use `msg.sender` instead of OpenZeppelin's `_msgSender()` when GSN capabilities aren't used](https://github.com/code-423n4/2022-01-livepeer-findings/issues/243) _Submitted by Dravee, also found by defsec and rfa_.\n- [[G-16] Gas: Use `msg.sender` directly instead of caching it in a variable](https://github.com/code-423n4/2022-01-livepeer-findings/issues/244) _Submitted by Dravee_.\n- [[G-17] Upgrade pragma to at least 0.8.4](https://github.com/code-423n4/2022-01-livepeer-findings/issues/14) _Submitted by robee, also found by defsec, Dravee, and gzeon_.\n- [[G-18] Constant variables using keccak can be immutable](https://github.com/code-423n4/2022-01-livepeer-findings/issues/172) _Submitted by ye0lde, also found by byterocket, defsec, Dravee, Jujic, p4st13r4, and pauliax_.\n- [[G-19] Revert string > 32 bytes](https://github.com/code-423n4/2022-01-livepeer-findings/issues/115) _Submitted by sirhashalot, also found by aga7hokakological, defsec, Dravee, gzeon, Jujic, p4st13r4, robee, and WatchPug_.\n- [[G-20] Gas: Use `calldata` instead of `memory` for external functions where the function argument is read-only.](https://github.com/code-423n4/2022-01-livepeer-findings/issues/61) _Submitted by Dravee, also found by defsec_.\n- [[G-21] Gas: Internal functions can be private if the contract is not herited](https://github.com/code-423n4/2022-01-livepeer-findings/issues/62) _Submitted by Dravee_.\n- [[G-22] Gas: Consider making some constants as non-public to save gas](https://github.com/code-423n4/2022-01-livepeer-findings/issues/63) _Submitted by Dravee_.\n- [[G-23] Named return issue](https://github.com/code-423n4/2022-01-livepeer-findings/issues/6) _Submitted by robee, also found by Dravee, WatchPug, and ye0lde_.\n- [[G-24] Save Gas With The Unchecked Keyword (L2LPTDataCache.sol)](https://github.com/code-423n4/2022-01-livepeer-findings/issues/173) _Submitted by ye0lde, also found by defsec, Dravee, gzeon, Jujic, and WatchPug_.\n- [[G-25] Drop the token parameter from since it can only be the same value](https://github.com/code-423n4/2022-01-livepeer-findings/issues/103) _Submitted by Ruhum_.\n- [[G-26] Avoiding unnecessary repeated account balance read can save gas](https://github.com/code-423n4/2022-01-livepeer-findings/issues/135) _Submitted by WatchPug, also found by gzeon, hyh, and Tomio_.\n- [[G-27] using empty String which is already default 0x](https://github.com/code-423n4/2022-01-livepeer-findings/issues/30) _Submitted by Tomio_.\n- [[G-28] double storage call in function decreaseL2SupplyFromL1](https://github.com/code-423n4/2022-01-livepeer-findings/issues/51) _Submitted by Tomio_.\n- [[G-29] Check of `!migratedDelegators[delegator]` can be done earlier to save gas](https://github.com/code-423n4/2022-01-livepeer-findings/issues/127) _Submitted by WatchPug_.\n- [[G-30] Changing bool to uint256 can save gas](https://github.com/code-423n4/2022-01-livepeer-findings/issues/129) _Submitted by WatchPug_.\n- [[G-31] Inline unnecessary internal function can make the code simpler and save some gas](https://github.com/code-423n4/2022-01-livepeer-findings/issues/133) _Submitted by WatchPug_.\n- [[G-32] Using immutable variables rather than local variables is cheaper](https://github.com/code-423n4/2022-01-livepeer-findings/issues/180) _Submitted by WatchPug_.\n- [[G-33] Remove redundant `_setRoleAdmin()` can save gas](https://github.com/code-423n4/2022-01-livepeer-findings/issues/196) _Submitted by WatchPug, also found by byterocket_.\n- [[G-34] Unnecessary checked arithmetic in for loops](https://github.com/code-423n4/2022-01-livepeer-findings/issues/204) _Submitted by WatchPug_.\n- [[G-35] Use abi.encodePacked for gas optimization](https://github.com/code-423n4/2022-01-livepeer-findings/issues/225) _Submitted by defsec_.\n- [[G-36] redundant function argument](https://github.com/code-423n4/2022-01-livepeer-findings/issues/192) _Submitted by egjlmn1_.\n- [[G-37] DelegatorPool.claim subtraction can be unchecked and done once](https://github.com/code-423n4/2022-01-livepeer-findings/issues/154) _Submitted by hyh, also found by pauliax_.\n- [[G-38] Custom GOVERNOR_ROLE unnecessary](https://github.com/code-423n4/2022-01-livepeer-findings/issues/116) _Submitted by sirhashalot_.\n\n# Disclosures\n\nC4 is an open organization governed by participants in the community.\n\nC4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.\n\nC4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.\n"
}