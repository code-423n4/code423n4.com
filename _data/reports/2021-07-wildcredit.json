{
  "circa": {
    "title": "Wild Credit",
    "sponsor": "Wild Credit",
    "slug": "2021-07-wildcredit",
    "date": "2021-08-17",
    "findings": "https://github.com/code-423n4/https://github.com/code-423n4/2021-07-wildcredit-findings/issues",
    "contest": 18
  },
  "html": "<h1 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h1>\n<h2 id=\"about-c4\" style=\"position:relative;\"><a href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>About C4</h2>\n<p>Code 432n4 (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.</p>\n<p>A C4 code contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.</p>\n<p>During the code contest outlined in this document, C4 conducted an analysis of the Wild Credit smart contract system written in Solidity. The code contest took place between July 7—July 14 2021.</p>\n<h2 id=\"wardens\" style=\"position:relative;\"><a href=\"#wardens\" aria-label=\"wardens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wardens</h2>\n<p>12 Wardens contributed reports to the Wild Credit code contest:</p>\n<ul>\n<li><a href=\"https://twitter.com/cmichelio\">cmichel</a></li>\n<li><a href=\"https://twitter.com/greiart\">greiart</a></li>\n<li><a href=\"https://twitter.com/SolidityDev\">paulius.eth</a></li>\n<li><a href=\"https://twitter.com/0xRajeev\">0xRajeev</a></li>\n<li><a href=\"https://github.com/x9453\">shw</a></li>\n<li><a href=\"https://twitter.com/MukeshJ_eth\">Jmukesh</a></li>\n<li><a href=\"https://twitter.com/gpersoon\">gpersoon</a></li>\n<li><a href=\"https://twitter.com/defsec_\">defsec</a></li>\n<li><a href=\"https://twitter.com/AshiqAmien\">toastedsteaksandwich</a></li>\n<li><a href=\"https://twitter.com/a_delamo\">a_dlamo</a></li>\n<li><a href=\"https://twitter.com/jonah1005w\">jonah1005</a></li>\n<li><a href=\"https://twitter.com/_hrkrshnn\">hrkrshnn</a></li>\n<li><a href=\"https://github.com/0xsanson\">0xsanson</a></li>\n</ul>\n<p>This contest was judged by <a href=\"https://twitter.com/ghoulsol\">ghoul.sol</a>.</p>\n<p>Final report assembled by <a href=\"https://twitter.com/money_lego\">moneylegobatman</a> and <a href=\"https://twitter.com/_ninek_\">ninek</a>.</p>\n<h1 id=\"summary\" style=\"position:relative;\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h1>\n<p>The C4 analysis yielded an aggregated total of 19 unique vulnerabilities. All of the issues presented here are linked back to their original finding</p>\n<p>Of these vulnerabilities, 3 received a risk rating in the category of HIGH severity, 4 received a risk rating in the category of MEDIUM severity, and 12 received a risk rating in the category of LOW severity.</p>\n<p>C4 analysis also identified 40 non-critical recommendations.</p>\n<h1 id=\"scope\" style=\"position:relative;\"><a href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scope</h1>\n<p>The code under review can be found within the <a href=\"https://github.com/code-423n4/2021-07-wildcredit\">C4 Wild Credit code contest repository</a> and is comprised of 29 smart contracts written in the Solidity programming language.</p>\n<h1 id=\"severity-criteria\" style=\"position:relative;\"><a href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Severity Criteria</h1>\n<p>C4 assesses the severity of disclosed vulnerabilities according to a methodology based on <a href=\"https://owasp.org/www-community/OWASP_Risk_Rating_Methodology\">OWASP standards</a>.</p>\n<p>Vulnerabilities are divided into three primary risk categories: high, medium, and low.</p>\n<p>High-level considerations for vulnerabilities span the following key areas when conducting assessments:</p>\n<ul>\n<li>Malicious Input Handling</li>\n<li>Escalation of privileges</li>\n<li>Arithmetic</li>\n<li>Gas use</li>\n</ul>\n<p>Further information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on <a href=\"https://code423n4.com\">the C4 website</a>.</p>\n<h1 id=\"high-risk-findings\" style=\"position:relative;\"><a href=\"#high-risk-findings\" aria-label=\"high risk findings permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>High Risk Findings</h1>\n<h2 id=\"h-01-reward-computation-is-wrong\" style=\"position:relative;\"><a href=\"#h-01-reward-computation-is-wrong\" aria-label=\"h 01 reward computation is wrong permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/116\">[H-01] Reward computation is wrong</a></h2>\n<p><em>Submitted by cmichel</em></p>\n<p>The <code>LendingPair.accrueAccount</code> function distributes rewards <strong>before</strong> updating the cumulative supply / borrow indexes as well as the index + balance for the user (by minting supply tokens / debt).\nThis means the percentage of the user’s balance to the total is not correct as the total can be updated several times in between.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">accrueAccount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_account</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">// distributes before updating accrual state</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">_distributeReward</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_account</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">accrue</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">_accrueAccountInterest</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_account</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_account</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">feeRecipient</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">_accrueAccountInterest</span><span class=\"mtk1\">(</span><span class=\"mtk11\">feeRecipient</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><strong>Example</strong>: Two users deposit the same amounts in the same block. Thus, after some time they should receive the same tokens.</p>\n<ol>\n<li>User A and B deposit 1000 tokens (in the same block) and are minted 1000 tokens in return. Total supply = <code>2000</code></li>\n<li>Assume after 50,000 blocks, <code>A</code> calls <code>accrueAccount(A)</code> which first calls <code>_distributeReward</code>. A is paid out 1000/2000 = 50% of the 50,000 blocks reward since deposit. Afterwards, <code>accrue</code> + <code>_accrueAccountInterest(A)</code> is called and <code>A</code> is minted 200 more tokens due to supplier lending rate. The supply <strong>totalSupply is now 2200</strong>.</li>\n<li>After another 50,000 blocks, <code>A</code> calls <code>accrueAccount(A)</code> again. which first calls <code>_distributeReward</code>. A is paid out 1200/2200 = <strong>54.5454% of the 50,000 blocks reward since deposit.</strong></li>\n</ol>\n<p>From here, you can already see that <code>A</code> receives more than 50% of the 100,000 block rewards although they deposited at the same time as <code>B</code> and didn’t deposit or withdraw any funds.\n<code>B</code> will receive <code>~1000/2200 = 45%</code> (ignoring any new LP supply tokens minted for <code>A</code>’s second claim.)</p>\n<p>The impact is that wrong rewards will be minted users which do not represent their real fair share. Usually, users will get fewer rewards than they should receive, as their individual interest was not updated yet, but the totals (total debt and total supply) could have been updated by other accounts in between.</p>\n<p>There are two issues that both contribute to it:</p>\n<ul>\n<li>total LP supply and total debt must be updated by the <strong>total new interest</strong> when <code>accrue</code> is called, not only increased by an <strong>individual user</strong>’s interest. See my other issue “Reward computation is wrong” that goes into more depth</li>\n<li>Lending/borrow accrual must happen before reward distribution</li>\n</ul>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/116#issuecomment-880581152\">talegift (Wild Credit) acknowledged but disagreed with severity</a>:</strong></p>\n<blockquote>\n<p><em>Assets not at direct risk, but the function of the protocol or its availability could be impacted, or <strong>leak value</strong> with a hypothetical attack path with stated assumptions, but <strong>external requirements</strong>.</em></p>\n<p>Update to severity - 2</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/116#issuecomment-890597758\">ghoul-sol (Judge) commented</a>:</strong></p>\n<blockquote>\n<p>Disagree with sponsor about severity, this is significant accounting error.</p>\n</blockquote>\n<h2 id=\"h-02-lendingpairliquidateaccount-does-not-accrue-and-update-cumulativeinterestrate\" style=\"position:relative;\"><a href=\"#h-02-lendingpairliquidateaccount-does-not-accrue-and-update-cumulativeinterestrate\" aria-label=\"h 02 lendingpairliquidateaccount does not accrue and update cumulativeinterestrate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/122\">[H-02] <code>LendingPair.liquidateAccount</code> does not accrue and update <code>cumulativeInterestRate</code></a></h2>\n<p><em>Submitted by cmichel</em></p>\n<p>The <code>LendingPair.liquidateAccount</code> function does not accrue and update the <code>cumulativeInterestRate</code> first, it only calls <code>_accrueAccountInterest</code> which does not update and instead uses the old <code>cumulativeInterestRate</code>.</p>\n<p>The liquidatee (borrower)‘s state will not be up-to-date.\nI could skip some interest payments by liquidating myself instead of repaying if I’m under-water.\nAs the market interest index is not accrued, the borrower does not need to pay any interest accrued from the time of the last accrual until now.</p>\n<p>Recommend calling <code>accrueAccount</code> instead of <code>_accrueAccountInterest</code></p>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/122#issuecomment-880580414\">talegift (Wild Credit) confirmed but disagreed with severity</a>:</strong></p>\n<blockquote>\n<p><em>Assets not at direct risk, but the function of the protocol or its availability could be impacted, or <strong>leak value</strong> with a hypothetical attack path with stated assumptions, but <strong>external requirements</strong>.</em></p>\n<p>Update to severity - 2</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/122#issuecomment-890597983\">ghoul-sol (Judge) commented</a>:</strong></p>\n<blockquote>\n<p>No funds are lost however a user can steal “unpaid interest” from the protocol. Keeping high risk.</p>\n</blockquote>\n<h2 id=\"h-03-lendingpairliquidateaccount-fails-if-tokens-are-lent-out\" style=\"position:relative;\"><a href=\"#h-03-lendingpairliquidateaccount-fails-if-tokens-are-lent-out\" aria-label=\"h 03 lendingpairliquidateaccount fails if tokens are lent out permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/123\">[H-03] <code>LendingPair.liquidateAccount</code> fails if tokens are lent out</a></h2>\n<p><em>Submitted by cmichel</em></p>\n<p>The <code>LendingPair.liquidateAccount</code> function tries to pay out underlying supply tokens to the liquidator using <code>_safeTransfer(IERC20(supplyToken), msg.sender, supplyOutput)</code> but there’s no reason why there should be enough <code>supplyOutput</code> amount in the contract, the contract only ensures <code>minReserve</code>.</p>\n<p>As a result, no liquidations can be performed if all tokens are lent out.\n<strong>Example:</strong> User A supplies 1k$ WETH, User B supplies 1.5k$ DAI and borrows the ~1k$ WETH (only leaves <code>minReserve</code>). The ETH price drops but user B cannot be liquidated as there’s not enough WETH in the pool anymore to pay out the liquidator.</p>\n<p>Recommend minting LP supply tokens to <code>msg.sender</code> instead, these are the LP supply tokens that were burnt from the borrower. This way the liquidator basically seizes the borrower’s LP tokens.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/123#issuecomment-880580148\">talegift (Wild Credit) confirmed but disagreed with severity</a>:</strong></p>\n<blockquote>\n<p><em>Assets not at direct risk, but the function of the protocol or its availability could be impacted, or <strong>leak value</strong> with a hypothetical attack path with stated assumptions, but <strong>external requirements</strong>.</em></p>\n<p>Update to severity - 2</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/123#issuecomment-890598465\">ghoul-sol (Judge) commented</a>:</strong></p>\n<blockquote>\n<p>If liquidation is impossible, there’s insolvency risk and that creates a risk to lose user funds. Keeping high severity.</p>\n</blockquote>\n<h1 id=\"medium-risk-findings\" style=\"position:relative;\"><a href=\"#medium-risk-findings\" aria-label=\"medium risk findings permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Medium Risk Findings</h1>\n<h2 id=\"m-01-chainlink---use-latestrounddata-instead-of-latestanswer-to-run-more-validations\" style=\"position:relative;\"><a href=\"#m-01-chainlink---use-latestrounddata-instead-of-latestanswer-to-run-more-validations\" aria-label=\"m 01 chainlink   use latestrounddata instead of latestanswer to run more validations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/75\">[M-01] Chainlink - Use <code>latestRoundData</code> instead of <code>latestAnswer</code> to run more validations</a></h2>\n<p><em>Submitted by a</em>delamo, also found by 0xRajeev, cmichel, greiart, and shw_</p>\n<p><code>UniswapV3Oracle.sol</code> is calling <code>latestAnswer</code> to get the last WETH price. This method will return the last value, but you won’t be able to check if the data is fresh.\nOn the other hand, calling the method <code>latestRoundData</code> allow you to run some extra validations</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">roundId</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">rawPrice</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">updateTime</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">answeredInRound</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  ) = </span><span class=\"mtk11\">AggregatorV3Interface</span><span class=\"mtk1\">(</span><span class=\"mtk12\">XXXXX</span><span class=\"mtk1\">).</span><span class=\"mtk11\">latestRoundData</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">rawPrice</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Chainlink price &lt;= 0&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">updateTime</span><span class=\"mtk1\"> != </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Incomplete round&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">answeredInRound</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">roundId</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Stale price&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>See the chainlink <a href=\"https://docs.chain.link/docs/faq/#how-can-i-check-if-the-answer-to-a-round-is-being-carried-over-from-a-previous-round\">documentation</a> for more information.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/75\">talegift (Wild Credit) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/75#issuecomment-890584877\">ghoul-sol (Judge) commented</a>:</strong></p>\n<blockquote>\n<p>Since slate prices could have quite serious consequences, I’ll bump it to medium risk.</p>\n</blockquote>\n<h2 id=\"m-02-safetransferfrom-in-transferhelper-is-not-safetransferfrom\" style=\"position:relative;\"><a href=\"#m-02-safetransferfrom-in-transferhelper-is-not-safetransferfrom\" aria-label=\"m 02 safetransferfrom in transferhelper is not safetransferfrom permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/67\">[M-02] <code>safeTransferFrom</code> in <code>TransferHelper</code> is not <code>safeTransferFrom</code></a></h2>\n<p><em>Submitted by jonah1005, also found by 0xRajeev, shw, JMukesh, and cmichel</em></p>\n<p>A non standard ERC20 token would always raise error when calling <code>_safeTransferFrom</code>.  If a user creates a USDT/DAI pool and deposit into the pool he would find out there’s never a counterpart deposit. See <code>TransferHelper.sol</code> <a href=\"https://github.com/code-423n4/2021-07-wildcredit/blob/82c48d73fd27a9d4d5d4a395b3affcef4ef6c5c8/contracts/TransferHelper.sol#L19\">#L19</a>.</p>\n<p><code>TransferHelper</code> does not uses <code>SafeERC20</code> library as the function name implies.</p>\n<p>A sample POC:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">usdt</span><span class=\"mtk1\">.</span><span class=\"mtk12\">functions</span><span class=\"mtk1\">.</span><span class=\"mtk11\">approve</span><span class=\"mtk1\">(</span><span class=\"mtk12\">lending_pair</span><span class=\"mtk1\">.</span><span class=\"mtk12\">address</span><span class=\"mtk1\">, </span><span class=\"mtk12\">deposit_amount</span><span class=\"mtk1\">).</span><span class=\"mtk11\">transact</span><span class=\"mtk1\">({</span><span class=\"mtk8\">&#39;from&#39;</span><span class=\"mtk12\">:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">w3</span><span class=\"mtk1\">.</span><span class=\"mtk12\">eth</span><span class=\"mtk1\">.</span><span class=\"mtk12\">accounts</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">]})</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">lending_pair</span><span class=\"mtk1\">.</span><span class=\"mtk12\">functions</span><span class=\"mtk1\">.</span><span class=\"mtk11\">deposit</span><span class=\"mtk1\">(</span><span class=\"mtk12\">w3</span><span class=\"mtk1\">.</span><span class=\"mtk12\">eth</span><span class=\"mtk1\">.</span><span class=\"mtk12\">accounts</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">], </span><span class=\"mtk12\">usdt</span><span class=\"mtk1\">.</span><span class=\"mtk12\">address</span><span class=\"mtk1\">, </span><span class=\"mtk12\">deposit_amount</span><span class=\"mtk1\">).</span><span class=\"mtk11\">transact</span><span class=\"mtk1\">({</span><span class=\"mtk8\">&#39;from&#39;</span><span class=\"mtk12\">:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">w3</span><span class=\"mtk1\">.</span><span class=\"mtk12\">eth</span><span class=\"mtk1\">.</span><span class=\"mtk12\">accounts</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">]})</span></span></span></code></pre>\n<p>Error Message:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  Error: </span><span class=\"mtk12\">Transaction</span><span class=\"mtk1\"> reverted: </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returned</span><span class=\"mtk1\"> </span><span class=\"mtk11\">an</span><span class=\"mtk1\"> </span><span class=\"mtk11\">unexpected</span><span class=\"mtk1\"> </span><span class=\"mtk11\">amount</span><span class=\"mtk1\"> </span><span class=\"mtk11\">of</span><span class=\"mtk1\"> </span><span class=\"mtk11\">data</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk11\">at</span><span class=\"mtk1\"> </span><span class=\"mtk11\">LendingPair</span><span class=\"mtk1\">.</span><span class=\"mtk11\">_safeTransferFrom</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/TransferHelper.sol:</span><span class=\"mtk7\">20</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk11\">at</span><span class=\"mtk1\"> </span><span class=\"mtk11\">LendingPair</span><span class=\"mtk1\">.</span><span class=\"mtk11\">deposit</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/LendingPair.sol:</span><span class=\"mtk7\">95</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<p>Recommend using <code>openzeppelin</code> <code>SafeERC20</code> in <code>transferHelper</code> (and any other contract that uses IERC20).</p>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/67\">talegift (Wild Credit) confirmed</a></strong></p>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/67#issuecomment-890585396\">ghoul-sol (Judge) commented</a>:</strong></p>\n<blockquote>\n<p>This can effect deposits so it’s a medium risk.</p>\n</blockquote>\n<h2 id=\"m-03-_wethwithdrawto-is-vulnerable-re-entrancy\" style=\"position:relative;\"><a href=\"#m-03-_wethwithdrawto-is-vulnerable-re-entrancy\" aria-label=\"m 03 _wethwithdrawto is vulnerable re entrancy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/71\">[M-03] <code>_wethWithdrawTo</code> is vulnerable re-entrancy</a></h2>\n<p><em>Submitted by pauliax</em></p>\n<p>The function <code>withdrawBorrowETH</code> invokes <code>_wethWithdrawTo</code> and later <code>_checkMinReserve</code>, however, the check of reserve is not necessary here, as function <code>_wethWithdrawTo</code> also does that after transferring the ether. However, this reserve check might be bypassed as <code>TransferHelper</code>.<code>_wethWithdrawTo</code> uses a low level call that is vulnerable to re-entrancy attacks. As this <code>MIN_RESERVE</code> sounds like an important value, you should consider preventing re-entrancy attacks here.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">// Prevents division by zero and other undesirable behavior</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">constant</span><span class=\"mtk1\"> </span><span class=\"mtk12\">MIN_RESERVE</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">1000</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p>Recommend considering using <a href=\"https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/security/ReentrancyGuard.sol\">re-entrancy guard</a> on all main action functions (e.g. <code>deposit</code>, <code>withdraw</code>, <code>borrow</code>,<code>repay</code>, etc…):</p>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/71\">talegift (Wild Credit) confirmed</a></strong></p>\n<h2 id=\"m-04-total-lp-supply--total-debt-accrual-is-wrong\" style=\"position:relative;\"><a href=\"#m-04-total-lp-supply--total-debt-accrual-is-wrong\" aria-label=\"m 04 total lp supply  total debt accrual is wrong permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/115\">[M-04] Total LP supply &#x26; total debt accrual is wrong</a></h2>\n<p><em>Submitted by cmichel</em></p>\n<p>The total debt and total supply only increase when debt/supply is minted to the user when it should increase by the entire new interest amount on each accrual.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">accrueAccount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_account</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">_distributeReward</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_account</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">// accrue only updates cumulativeInterestRate to the newInterest</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">// newInterest is not added to total debt or total LP supply!</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">accrue</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">// instead total debt / total LP supply is increased here by a much smaller amount, the new interest specific for the updating user</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">_accrueAccountInterest</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_account</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">_account</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">feeRecipient</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">_accrueAccountInterest</span><span class=\"mtk1\">(</span><span class=\"mtk11\">feeRecipient</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>The borrow rates (see <code>borrowRatePerBlock</code>) are wrong due to the wrong utilization ratio: The borrow utilization rate uses <code>LPToken.totalSupply</code>. Assume there’s a single lender supplying $100k, another single borrower borrows $70k (ignoring irrelevant details like liquidation and the borrower not putting up collateral for the sake of the argument).\nAfter some time debt accrued and the supplier “updates” by calling <code>accrue</code> (but the borrower does not update), this increases the LP total supply to, say, $110k, while total debt is not updated. The utilization rate and thus the borrow rate is now less than before (from 70/100=70% to 70/110=63%). In reality, it should have increased as the supplier interest is only a fraction of the borrower accumulated debt. From now on less debt than expected accrues until the borrower is updated and total debt is increased.\nTo get the correct borrow rates in the current system, every borrower and every supplier would need to be updated on every accrual which is infeasible.</p>\n<p>Recommend doing it like Compound/Aave, increase total debt and total supply on each accrual by the <strong>total</strong> new interest (not by the specific user’s interest only).\nThis might require a bigger refactor because the LP token is treated as a (“lazy-evaluated”) rebasing token and the total supply is indeed the total tokens in circulation <code>LP.totalSupply()</code> and one cannot mint the new interest to all users at once in each <code>accrue</code>.\nThat’s why Compound uses an interest-bearing token and tracks total supply separately and Aave uses a real rebasing token that dynamically scales the balance in <code>balanceOf</code> and must not be updated individually for each user.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/115#issuecomment-880577179\">talegift (Wild Credit) confirmed but disagreed with severity</a>:</strong></p>\n<blockquote>\n<p>The issue seems to only impact interest rate calculation. It doesn’t allow anyone to steal the funds.</p>\n<p>Severity should be set to 1.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/115#issuecomment-890597388\">ghoul-sol (Judge) commented</a>:</strong></p>\n<blockquote>\n<p>I’m making this medium risk as no funds are lost but the accounting is basically incorrect.</p>\n</blockquote>\n<h1 id=\"low-risk-findings\" style=\"position:relative;\"><a href=\"#low-risk-findings\" aria-label=\"low risk findings permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Low Risk Findings</h1>\n<h2 id=\"l-01-no-check-of-max_liq_fees-in-contructor-of-controller\" style=\"position:relative;\"><a href=\"#l-01-no-check-of-max_liq_fees-in-contructor-of-controller\" aria-label=\"l 01 no check of max_liq_fees in contructor of controller permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/24\">[L-01] No check of <code>MAX_LIQ_FEES</code> in contructor of <code>Controller</code></a></h2>\n<p><em>Submitted by gpersoon, also found by 0xRajeev</em></p>\n<p>Both the functions <code>setLiqParamsToken</code> and <code>setLiqParamsDefault</code> have a check to make sure that\n<code>_liqFeeCaller</code> + <code>_liqFeeSystem</code> &#x3C;= <code>MAX_LIQ_FEES</code></p>\n<p>However the constructor of <code>Controller</code> sets the same parameters and doesn’t have this check.\nIt seems logical to also do the check in the <code>controller</code>, otherwise the parameters could be set outside of the wanted range.</p>\n<p><code>Controller.sol</code> <a href=\"https://github.com/code-423n4/2021-07-wildcredit/blob/main/contracts/Controller.sol#L49\">#L49</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">constructor</span><span class=\"mtk1\">( </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_interestRateModel</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_liqFeeSystemDefault</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_liqFeeCallerDefault</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">liqFeeSystemDefault</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_liqFeeSystemDefault</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">liqFeeCallerDefault</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_liqFeeCallerDefault</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setLiqParamsToken</span><span class=\"mtk1\">( </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_token</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint</span><span class=\"mtk1\">    </span><span class=\"mtk12\">_liqFeeSystem</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint</span><span class=\"mtk1\">    </span><span class=\"mtk12\">_liqFeeCaller</span><span class=\"mtk1\"> ) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyOwner</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_liqFeeCaller</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">_liqFeeSystem</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk8\">`MAX_LIQ_FEES`</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Controller: fees too high&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">liqFeeSystemToken</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_token</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">_liqFeeSystem</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">liqFeeCallerToken</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_token</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">_liqFeeCaller</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setLiqParamsDefault</span><span class=\"mtk1\">( </span><span class=\"mtk12\">uint</span><span class=\"mtk1\">    </span><span class=\"mtk12\">_liqFeeSystem</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint</span><span class=\"mtk1\">    </span><span class=\"mtk12\">_liqFeeCaller</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyOwner</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_liqFeeCaller</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">_liqFeeSystem</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk12\">MAX_LIQ_FEES</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Controller: fees too high&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">liqFeeSystemDefault</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_liqFeeSystem</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">liqFeeCallerDefault</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_liqFeeCaller</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p>Recommend adding something like the following in the constructor of <code>Controller</code></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">liqFeeCallerDefault</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">liqFeeSystemDefault</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk12\">MAX_LIQ_FEES</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Controller: fees too high&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><strong>- <a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/24\">talegift (Wild Credit) confirmed</a></strong></p>\n<h2 id=\"l-02-uniswap-oracle-assumes-pairtoken--weth-liquidity\" style=\"position:relative;\"><a href=\"#l-02-uniswap-oracle-assumes-pairtoken--weth-liquidity\" aria-label=\"l 02 uniswap oracle assumes pairtoken  weth liquidity permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/118\">[L-02] Uniswap oracle assumes <code>PairToken &#x3C;> WETH</code> liquidity</a></h2>\n<p><em>Submitted by cmichel</em></p>\n<p>The <code>UniswapV3Oracle.tokenPrice</code> function gets the price by combining the chainlink ETH price with the TWAP prices of the <code>token &#x3C;> pairToken</code> and <code>pairToken &#x3C;> WETH</code> pools.\nIt is therefore required that the <code>pairToken &#x3C;> WETH</code> pool exists and has sufficient liquidity to be tamper-proof.</p>\n<p>When listing lending pairs for tokens that have a WETH pair with low liquidity (at 0.3% fees) the prices can be easily manipulated leading to liquidations or underpriced borrows.\nThis can happen for tokens that don’t use <code>WETH</code> as their default trading pair, for example, if they prefer a stablecoin, or <code>WBTC</code>.</p>\n<p>Recommend ensuring there’s enough liquidity on the <code>pairToken &#x3C;> WETH</code> Uniswap V3 0.3% pair, either manually or programmatically.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/118#issuecomment-880607813\">talegift (Wild Credit) acknowledged</a>:</strong></p>\n<blockquote>\n<p>This is a known &#x26; documented risk: <a href=\"https://wild-credit.gitbook.io/wild-credit/advanced-concepts/price-oracles\">https://wild-credit.gitbook.io/wild-credit/advanced-concepts/price-oracles</a></p>\n</blockquote>\n<h2 id=\"l-03-simple-interest-formula-is-used\" style=\"position:relative;\"><a href=\"#l-03-simple-interest-formula-is-used\" aria-label=\"l 03 simple interest formula is used permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/119\">[L-03] Simple interest formula is used</a></h2>\n<p><em>Submitted by cmichel</em></p>\n<p>The <code>_accrueInterest</code> function uses a simple interest formula to compute the accrued debt, instead of a compounding formula. This means the actual borrow rate and interest for suppliers depend on how often updates are made. This difference should be negligible in highly active markets, but it could lead to a lower borrow rate in low-activity markets.</p>\n<p>Recommend ensuring that the lending pairs is accrued regularly, or switching to a compound interest formula (which has a higher gas cost due to exponentiation, but can be approximated, see Aave).</p>\n<p><strong>- <a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/119\">talegift (Wild Credit) acknowledged</a></strong></p>\n<h2 id=\"l-04-lendingpairpendingsupplyinterest-is-not-accurate\" style=\"position:relative;\"><a href=\"#l-04-lendingpairpendingsupplyinterest-is-not-accurate\" aria-label=\"l 04 lendingpairpendingsupplyinterest is not accurate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/124\">[L-04] <code>LendingPair.pendingSupplyInterest</code> is not accurate</a></h2>\n<p><em>Submitted by cmichel</em></p>\n<p>The <code>LendingPair.pendingSupplyInterest</code> does not accrue the new interest since the last update and therefor the returned value is not accurate.</p>\n<p>Recommend accruing it first such that <code>cumulativeInterestRate</code> updates and <code>_newInterest</code> returns the updated value.</p>\n<p><strong>- <a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/124\">talegift (Wild Credit) confirmed</a></strong></p>\n<h2 id=\"l-05-migrate-rewards-without-distribution\" style=\"position:relative;\"><a href=\"#l-05-migrate-rewards-without-distribution\" aria-label=\"l 05 migrate rewards without distribution permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/102\">[L-05] Migrate Rewards Without Distribution</a></h2>\n<p><em>Submitted by defsec</em></p>\n<p>With the <code>migrateRewards</code> function, owner can transfer all reward token into other address. Owner should distribute reward balance before migrating rewards.</p>\n<ol>\n<li>Navigate to ”<a href=\"https://github.com/code-423n4/2021-07-wildcredit/blob/82c48d73fd27a9d4d5d4a395b3affcef4ef6c5c8/contracts/RewardDistribution.sol\">https://github.com/code-423n4/2021-07-wildcredit/blob/82c48d73fd27a9d4d5d4a395b3affcef4ef6c5c8/contracts/RewardDistribution.sol</a>”</li>\n<li>See functionality on the ”<code>migrateRewards</code>” function.</li>\n<li>According to function, owner can transfer all  reward balance to another address.</li>\n</ol>\n<p>Recommend that owner should distribute reward balance before migrating rewards.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/102#issuecomment-880582702\">talegift (Wild Credit) acknowledged</a>:</strong></p>\n<blockquote>\n<p>This is technically not possible to distribute all pending rewards to all users due to the block gas limit and the fact that rewards accrue with each new block.</p>\n<p>If the rewards are ever migrated (and it’s not urgent), we would likely notify users upfront and give them some time to claim &#x26; unstake.</p>\n</blockquote>\n<h2 id=\"l-06-minborrowusd-not-initialized-in-the-contract\" style=\"position:relative;\"><a href=\"#l-06-minborrowusd-not-initialized-in-the-contract\" aria-label=\"l 06 minborrowusd not initialized in the contract permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/25\">[L-06] <code>minBorrowUSD</code> not initialized in the contract</a></h2>\n<p><em>Submitted by gpersoon</em></p>\n<p>The parameter <code>minBorrowUSD</code> of the contract <code>Controller</code> isn’t initialized.\nIf someone is able to Borrow before the function <code>setMinBorrowUSD</code> is called, he might be able to borrow a very small amount. This might be unwanted.</p>\n<p><code>Controller.sol</code> <a href=\"https://github.com/code-423n4/2021-07-wildcredit/blob/main/contracts/Controller.sol#L27\">#L27</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">public</span><span class=\"mtk1\"> </span><span class=\"mtk12\">minBorrowUSD</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setMinBorrowUSD</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_value</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyOwner</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk12\">minBorrowUSD</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_value</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p><code>LendingPair.sol</code> <a href=\"https://github.com/code-423n4/2021-07-wildcredit/blob/main/contracts/LendingPair.sol#L553\">#L553</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_checkBorrowLimits</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_token</span><span class=\"mtk1\">, </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_account</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">accountBorrowUSD</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">controller</span><span class=\"mtk1\">.</span><span class=\"mtk11\">minBorrowUSD</span><span class=\"mtk1\">(), </span><span class=\"mtk8\">&quot;LendingPair: borrow amount below minimum&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>Recommend Initializing <code>minBorrowUSD</code> via the constructor or set a reasonable default in the contract.</p>\n<p><strong>- <a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/25\">talegift (Wild Credit) confirmed</a></strong></p>\n<h2 id=\"l-07-lendingpair-avoid-rounding-error-in-_accrueaccountsupply\" style=\"position:relative;\"><a href=\"#l-07-lendingpair-avoid-rounding-error-in-_accrueaccountsupply\" aria-label=\"l 07 lendingpair avoid rounding error in _accrueaccountsupply permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/37\">[L-07] <code>LendingPair</code>: Avoid rounding error in <code>_accrueAccountSupply()</code></a></h2>\n<p><em>Submitted by greiart</em></p>\n<p><code>supplyInterest</code> is split between the account and the system, ie. <code>supplyInterest = newSupplyAccount + newSupplySystem</code>. Hence, an additional call to the <code>_systemRate</code> can be avoided in the calculation of <code>newSupplySystem</code>, as well as potential rounding errors. See <a href=\"https://github.com/code-423n4/2021-07-wildcredit/blob/main/contracts/LendingPair.sol#L401-L403\">L401-L403</a> in <code>LendingPair.sol</code> .</p>\n<p>Recommend that L403 be changed to <code>newSupplySystem = supplyInterest - newSupplyAccount;</code></p>\n<p><strong>- <a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/37\">talegift (Wild Credit) acknowledged</a></strong></p>\n<h2 id=\"l-08-uniswapv3oracle-reduce-minobservations-to-uint16\" style=\"position:relative;\"><a href=\"#l-08-uniswapv3oracle-reduce-minobservations-to-uint16\" aria-label=\"l 08 uniswapv3oracle reduce minobservations to uint16 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/55\">[L-08] <code>UniswapV3Oracle</code>: Reduce <code>minObservations</code> to uint16</a></h2>\n<p><em>Submitted by greiart</em></p>\n<p>Reducing <code>minObservations</code> to uint16 will help prevent erroneous <code>minObservations</code> values from being set (ie. <code>> 65535</code>) by the owner without needing checks. Otherwise, the <code>isPoolValid</code> will always return false, causing reverts in calling <code>tokenPrice</code> and <code>addPool</code> functions (and other functions calling these). See <a href=\"https://github.com/code-423n4/2021-07-wildcredit/blob/main/contracts/UniswapV3Oracle.sol#L25\">L25</a> and <a href=\"https://github.com/code-423n4/2021-07-wildcredit/blob/main/contracts/UniswapV3Oracle.sol#L101\">L101</a> of <code>UniswapV3Oracle.sol</code>.</p>\n<p>The maximum number of observations available is 65535 (see <a href=\"https://github.com/Uniswap/uniswap-v3-core/blob/main/contracts/UniswapV3Pool.sol#L39\"><code>UniswapV3Pool.sol</code> L39</a>), which is equivalent to <code>type(uint16).max</code>.</p>\n<p>Hence,</p>\n<ul>\n<li><code>uint public minObservations</code> can be reduced to <code>uint16 public minObservations</code></li>\n<li><code>(, , , , uint observationSlots , ,) = IUniswapV3Pool(poolAddress).slot0();</code> becomes <code>(, , , , uint16 observationSlots , ,) = IUniswapV3Pool(poolAddress).slot0();</code></li>\n</ul>\n<p><strong>- <a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/55\">talegift (Wild Credit) confirmed</a></strong></p>\n<h2 id=\"l-09-repayall-and-repayalleth-vulnerable-to-front-running\" style=\"position:relative;\"><a href=\"#l-09-repayall-and-repayalleth-vulnerable-to-front-running\" aria-label=\"l 09 repayall and repayalleth vulnerable to front running permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/125\">[L-09] <code>repayAll()</code> and <code>repayAllETH()</code> vulnerable to front-running</a></h2>\n<p><em>Submitted by toastedsteaksandwich</em></p>\n<p>The <code>repayAll()</code> and <code>repayAllETH()</code> functions allow any user to pay off debt of another user. Since all of the debt is going to be paid, no amount is specified, allowing the recipient of the repayment to front-run the transaction to increase their debt. The risk of this issued was lowered as it depended on the user having enough tokens and allowance in the case of <code>repayAll()</code>, or having a <code>msg.sender</code> higher than the current debt in the case of <code>repayAllEth()</code>.</p>\n<p>The affected lines are <code>LendingPair.sol</code> <a href=\"https://github.com/code-423n4/2021-07-wildcredit/blob/main/contracts/LendingPair.sol#L147\">#L14</a> and <a href=\"https://github.com/code-423n4/2021-07-wildcredit/blob/main/contracts/LendingPair.sol#L156\">#L156</a>.</p>\n<p>The scenario for <code>repayAll()</code> is the following:</p>\n<ol>\n<li>Alice pays off 5 of Bob’s Dai debt using <code>repayAll()</code>.</li>\n<li>Bob monitors the mempool for Alice’s transaction, and front-runs it by taking out as much debt as Alice’s allowance (and therefore balance) to the contract.</li>\n<li><code>debtOf[_token][_account]</code> now returns the higher amount and pays off Bob’s new debt.</li>\n</ol>\n<p>The scenario for <code>repayAllEth()</code> is similar:</p>\n<ol>\n<li>Alice pays off 0.5 of Bob’s Weth debt using <code>repayAllEth()</code>.</li>\n<li>Bob monitors the mempool for Alice’s transaction, and front-runs it by taking out as much debt as Alice’s <code>msg.value</code> amount used.</li>\n<li><code>debtOf[address(WETH)][_account]</code> now returns the higher amount and pays off Bob’s new debt.</li>\n</ol>\n<p>This issue can be mitigated by enforcing a minimum time to hold debt - e.g. not allowing to repay debt for at least 6 blocks. Alternatively, the <code>repay()</code> function could be used to replace the 2 affected functions by passing in the <code>_amount</code> as the total debt (looked up off-chain and used in the dapp, for example) so that only up to a certain amount of debt is paid. This also means the <code>repay()</code> function would need to be made <code>payable</code>, and that the <code>msg.value</code> is validated to be equal to the <code>_amount</code> parameter.</p>\n<p><strong>- <a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/125\">talegift (Wild Credit) confirmed</a></strong></p>\n<h2 id=\"l-10-critical-protocol-parameter-configurationchanges-should-have-sanitythreshold-checks\" style=\"position:relative;\"><a href=\"#l-10-critical-protocol-parameter-configurationchanges-should-have-sanitythreshold-checks\" aria-label=\"l 10 critical protocol parameter configurationchanges should have sanitythreshold checks permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/85\">[L-10] Critical protocol parameter configuration/changes should have sanity/threshold checks</a></h2>\n<p><em>Submitted by 0xRajeev</em></p>\n<p>Input validation on key function parameters is a best-practice. Not applying sanity/threshold checks will allow incorrect values to be set accidentally/maliciously and may significantly affect the security/functionality of the protocol.</p>\n<p>Except for checks on liquidation fees and collaterization factor, the codebase does not have input validation (sanity/threshold checks) on key protocol parameters in setter functions that are callable only by contract owners. Given that the fundamental value proposition of the protocol is to address risk management using isolated lending pairs, it becomes even more important to enforce sanity/threshold validation on protocol parameters in order to increase confidence in them, reduce risk and prevent accidental/malicious changes that increases risk significantly. The sanity/threshold values may be configurable in a time-delayed manner by owner/governance instead of hardcoding and enforcing unilaterally.</p>\n<p><strong>Scenario:</strong> Protocol is initialized/configured with absurd/unreasonable (i.e. very low/high) values of critical parameters such as <code>depositLimit</code>, <code>borrowLimit</code>, <code>minBorrowUSD</code>, pool allocation points, <code>totalRewardPerBlock</code>, <code>poolFee</code>, <code>twapPeriod</code> or <code>minObservations</code>. Owners/users fail to check or understand the impact of these absurd values until the protocol’s functionality or profitability is affected significantly.</p>\n<p>See similar high-severity finding from <a href=\"https://consensys.net/diligence/audits/2020/06/shell-protocol/#certain-functions-lack-input-validation-routines\">Consensys Diligence Audit of Shell Protocol</a>. See issue page for referenced code.</p>\n<p>Recommend enforcing sanity/threshold checks in all <code>onlyOwner</code> setters.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/85#issuecomment-881130601\">talegift (Wild Credit) acknowledged but disagreed with severity</a>:</strong></p>\n<blockquote>\n<p>Severity should be 1.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/85#issuecomment-890591788\">ghoul-sol (Judge) commented</a>:</strong></p>\n<blockquote>\n<p>Agree with sponsor, this is low risk at most.</p>\n</blockquote>\n<h2 id=\"l-11-erc20-race-condition-for-allowance\" style=\"position:relative;\"><a href=\"#l-11-erc20-race-condition-for-allowance\" aria-label=\"l 11 erc20 race condition for allowance permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/96\">[L-11] Erc20 Race condition for allowance</a></h2>\n<p><em>Submitted by JMukesh</em></p>\n<p>Due to the implementation of the <code>approve()</code> function in <code>LPTokenMaster.sol</code>  it’s possible for a user to over spend their allowance in certain situations. See <a href=\"https://www.adrianhetman.com/unboxing-erc20-approve-issues/\">unboxing erc20 approve issues</a>.</p>\n<p>Recommend that, instead of having a direct setter for allowances, <code>decreaseAllowance</code> and <code>increaseAllowance</code> functions should be exposed which decreases and increases allowances for a recipient respectively.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/96#issuecomment-880425868\">talegift (Wild Credit) disputed</a>:</strong></p>\n<blockquote>\n<p>This is not possible. Solidity 8 checks for underflow.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/96#issuecomment-890592674\">ghoul-sol (Judge) commented</a>:</strong></p>\n<blockquote>\n<p>Warden, please provide more explicit explanation of the exploit in the future so we don’t have to guess. Providing an article link is not the way to do it. Making this a low risk as this is a well known issue and the protocol doesn’t really depend on it.</p>\n</blockquote>\n<h2 id=\"l-12-the-interest-rate-is-calculated-based-on-assumptions-on-the-block-time\" style=\"position:relative;\"><a href=\"#l-12-the-interest-rate-is-calculated-based-on-assumptions-on-the-block-time\" aria-label=\"l 12 the interest rate is calculated based on assumptions on the block time permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/142\">[L-12] The interest rate is calculated based on assumptions on the block time</a></h2>\n<p><em>Submitted by shw</em></p>\n<p>The <code>InterestRateModel</code> contract assumes that the average block time is 13.2 seconds. However, the block time could range from 13.0 to 30.27, as we have seen in the past. The use of inaccurate block time could cause inaccurate borrow and supply rates. See <code>InterestRateModel.sol</code> <a href=\"https://github.com/code-423n4/2021-07-wildcredit/blob/main/contracts/InterestRateModel.sol#L17-L18\">#L17-L18</a> and <a href=\"https://etherscan.io/chart/blocktime\">Ethereum Average Block Time Chart (Etherscan.io)</a></p>\n<p>Recommend allowing authorized parties to set the values of the <code>LOW_RATE</code> and <code>HIGH_RATE</code> variables. Or, designing them to be dynamically adjusted when the block time changes drastically. Alternatively, also recommend calculating the interests and rewards based on <code>block.timestamp</code> instead of <code>block.number</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/142#issuecomment-880603313\">talegift (Wild Credit) acknowledged but disagreed with severity</a>:</strong></p>\n<blockquote>\n<p><code>block.timestamp</code> could be manipulated by miners.</p>\n<p>This can be considered an acceptable risk. If the block time changes, we can swap the interest rate model in the controller quickly.</p>\n<p>Severity should be set to 1.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/142#issuecomment-890594471\">ghoul-sol (Judge) commented</a>:</strong></p>\n<blockquote>\n<p>I don’t see a direct exploit here. If blocks are produced faster, interest rate is calculated faster, if slower it’s lower. This can be an issue however I agree it’s a low risk.</p>\n</blockquote>\n<h1 id=\"non-critical-findings-24\" style=\"position:relative;\"><a href=\"#non-critical-findings-24\" aria-label=\"non critical findings 24 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Non-Critical Findings (24)</h1>\n<ul>\n<li><a href=\"https://github.com/code-423n4/\">[N-01] Unused imported interface in <code>LendingPair</code></a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/130\">[N-02] typo: <code>totalAccountBorrrow</code></a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/131\">[N-03] typo in revert</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/132\">[N-04] Boolean to constant comparison</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/133\">[N-05] <code>Math.max</code> can be used</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/109\">[N-06] when setting new value for <code>feeRecepient</code>/<code>totalRewardPerBlock</code> ensure that new value is different from old one</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/1\">[N-07] Undefined Event</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/28\">[N-08] Use immutable keyword</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/32\">[N-09] difference between <code>_safeTransferFrom</code> and <code>_safeTransfer</code></a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/36\">[N-10] <code>InterestRateModel</code>: Use constant for 100e18</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/40\">[N-11] <code>LendingPair</code>: Error Messages can be improved</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/53\">[N-12] UniswapV3Oracle: No events emitted for setUniPriceConverter, setTwapPeriod, setMinObservations</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/60\">[N-13] <code>LendingPair</code>: Missing validation check for ETH methods [Updated]</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/70\">[N-14] setReward does not check if pid exists</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/45\">[N-15] LPTokenMaster: CEI Pattern</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/108\">[N-16] Lack of zero address validation</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/99\">[N-17] Use of Floating Pragma</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/113\">[N-18] LPTokenMaster does not implement <code>IERC20</code></a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/64\">[N-19] Code size exceed limit</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/68\">[N-20] addPool emits PoolUpdate with wrong pid</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/138\">[N-21] Add a proper revert message in <code>transferFrom</code> of <code>LPTokenMaster</code></a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/140\">[N-22] Unimplemented methods in several interfaces</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/82\">[N-23] Single-step process for critical ownership transfers is risky</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/112\">[N-24] Interest model is non-continuous</a></li>\n</ul>\n<h1 id=\"gas-optimizations-16\" style=\"position:relative;\"><a href=\"#gas-optimizations-16\" aria-label=\"gas optimizations 16 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gas Optimizations (16)</h1>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/59\">[G-01] <code>LendingPair</code>: Unnecessary Casting</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/26\">[G-02] redundant call to <code>_checkMinReserve</code> in <code>withdrawBorrowETH</code> </a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/56\">[G-03] External call does not have amount check in <code>TransferHelper</code></a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/35\">[G-04] <code>InterestRateModel</code>: Infallible logic</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/103\">[G-05] Packing of  variable in controller.sol</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/74\">[G-06] Gas optimizations - Use bytesX instead of string</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/76\">[G-07] Gas optimizations - Check first If <code>blocksElapsed == 0</code> in <code>_pendingRewardPerToken</code></a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/77\">[G-08] Gas optimizations - optimize reads in <code>_distributeReward</code> </a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/38\">[G-09] <code>LendingPair</code>: Cache token decimals</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/43\">[G-10] <code>LendingPair</code>: Optimise liquidation parameter calculations</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/46\">[G-11] <code>LPTokenMaster</code>: <code>underlying()</code> → address <code>underlyingToken</code></a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/47\">[G-12] <code>RewardDistribution</code>: Avoid 0 pid to drop boolean flag use</a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/48\">[G-13] <code>RewardDistribution</code>: Redundant boolean flag check in <code>_getPid()</code></a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/50\">[G-14] <code>RewardDistribution</code>: Optimise <code>_getPid</code></a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/51\">[G-15] <code>RewardDistribution</code>: Optimise <code>pendingSupplyReward</code>, <code>pendingBorrowReward</code>, <code>_distributeReward</code> and <code>_poolRewardRate</code></a></li>\n<li><a href=\"https://github.com/code-423n4/2021-07-wildcredit-findings/issues/110\">[G-16] Variables that can be converted into immutables</a></li>\n</ul>\n<h1 id=\"disclosures\" style=\"position:relative;\"><a href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Disclosures</h1>\n<p>C4 is an open organization governed by participants in the community.</p>\n<p>C4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.</p>\n<p>C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>",
  "toc": "<ul>\n<li>\n<p><a href=\"#overview\">Overview</a></p>\n<ul>\n<li><a href=\"#about-c4\">About C4</a></li>\n<li><a href=\"#wardens\">Wardens</a></li>\n</ul>\n</li>\n<li><a href=\"#summary\">Summary</a></li>\n<li><a href=\"#scope\">Scope</a></li>\n<li><a href=\"#severity-criteria\">Severity Criteria</a></li>\n<li>\n<p><a href=\"#high-risk-findings\">High Risk Findings</a></p>\n<ul>\n<li><a href=\"#h-01-reward-computation-is-wrong\">[H-01] Reward computation is wrong</a></li>\n<li><a href=\"#h-02-lendingpairliquidateaccount-does-not-accrue-and-update-cumulativeinterestrate\">[H-02] <code>LendingPair.liquidateAccount</code> does not accrue and update <code>cumulativeInterestRate</code></a></li>\n<li><a href=\"#h-03-lendingpairliquidateaccount-fails-if-tokens-are-lent-out\">[H-03] <code>LendingPair.liquidateAccount</code> fails if tokens are lent out</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#medium-risk-findings\">Medium Risk Findings</a></p>\n<ul>\n<li><a href=\"#m-01-chainlink---use-latestrounddata-instead-of-latestanswer-to-run-more-validations\">[M-01] Chainlink - Use <code>latestRoundData</code> instead of <code>latestAnswer</code> to run more validations</a></li>\n<li><a href=\"#m-02-safetransferfrom-in-transferhelper-is-not-safetransferfrom\">[M-02] <code>safeTransferFrom</code> in <code>TransferHelper</code> is not <code>safeTransferFrom</code></a></li>\n<li><a href=\"#m-03-_wethwithdrawto-is-vulnerable-re-entrancy\">[M-03] <code>_wethWithdrawTo</code> is vulnerable re-entrancy</a></li>\n<li><a href=\"#m-04-total-lp-supply--total-debt-accrual-is-wrong\">[M-04] Total LP supply &#x26; total debt accrual is wrong</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#low-risk-findings\">Low Risk Findings</a></p>\n<ul>\n<li><a href=\"#l-01-no-check-of-max_liq_fees-in-contructor-of-controller\">[L-01] No check of <code>MAX_LIQ_FEES</code> in contructor of <code>Controller</code></a></li>\n<li><a href=\"#l-02-uniswap-oracle-assumes-pairtoken--weth-liquidity\">[L-02] Uniswap oracle assumes <code>PairToken &#x3C;> WETH</code> liquidity</a></li>\n<li><a href=\"#l-03-simple-interest-formula-is-used\">[L-03] Simple interest formula is used</a></li>\n<li><a href=\"#l-04-lendingpairpendingsupplyinterest-is-not-accurate\">[L-04] <code>LendingPair.pendingSupplyInterest</code> is not accurate</a></li>\n<li><a href=\"#l-05-migrate-rewards-without-distribution\">[L-05] Migrate Rewards Without Distribution</a></li>\n<li><a href=\"#l-06-minborrowusd-not-initialized-in-the-contract\">[L-06] <code>minBorrowUSD</code> not initialized in the contract</a></li>\n<li><a href=\"#l-07-lendingpair-avoid-rounding-error-in-_accrueaccountsupply\">[L-07] <code>LendingPair</code>: Avoid rounding error in <code>_accrueAccountSupply()</code></a></li>\n<li><a href=\"#l-08-uniswapv3oracle-reduce-minobservations-to-uint16\">[L-08] <code>UniswapV3Oracle</code>: Reduce <code>minObservations</code> to uint16</a></li>\n<li><a href=\"#l-09-repayall-and-repayalleth-vulnerable-to-front-running\">[L-09] <code>repayAll()</code> and <code>repayAllETH()</code> vulnerable to front-running</a></li>\n<li><a href=\"#l-10-critical-protocol-parameter-configurationchanges-should-have-sanitythreshold-checks\">[L-10] Critical protocol parameter configuration/changes should have sanity/threshold checks</a></li>\n<li><a href=\"#l-11-erc20-race-condition-for-allowance\">[L-11] Erc20 Race condition for allowance</a></li>\n<li><a href=\"#l-12-the-interest-rate-is-calculated-based-on-assumptions-on-the-block-time\">[L-12] The interest rate is calculated based on assumptions on the block time</a></li>\n</ul>\n</li>\n<li><a href=\"#non-critical-findings-24\">Non-Critical Findings (24)</a></li>\n<li><a href=\"#gas-optimizations-16\">Gas Optimizations (16)</a></li>\n<li><a href=\"#disclosures\">Disclosures</a></li>\n</ul>"
}