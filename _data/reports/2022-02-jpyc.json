{
  "circa": {
    "title": "JPYC contest",
    "sponsor": "JPYC",
    "slug": "2022-02-jpyc",
    "date": "2022-04-11",
    "findings": "https://github.com/code-423n4/2022-02-jpyc-findings/issues",
    "contest": 95
  },
  "html": "<h1 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h1>\n<h2 id=\"about-c4\" style=\"position:relative;\"><a href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>About C4</h2>\n<p>Code4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.</p>\n<p>A C4 audit contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.</p>\n<p>During the audit contest outlined in this document, C4 conducted an analysis of the JPYC smart contract system written in Solidity. The audit contest took place between February 24—February 26 2022.</p>\n<h2 id=\"wardens\" style=\"position:relative;\"><a href=\"#wardens\" aria-label=\"wardens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wardens</h2>\n<p>28 Wardens contributed reports to the JPYC contest:</p>\n<ol>\n<li><a href=\"https://twitter.com/HickupH\">hickuphh3</a></li>\n<li><a href=\"https://twitter.com/liam_eastwood13\">leastwood</a></li>\n<li><a href=\"https://twitter.com/defsec_\">defsec</a></li>\n<li><a href=\"https://twitter.com/cmichelio\">cmichel</a></li>\n<li>TerrierLover</li>\n<li>kyliek</li>\n<li><a href=\"https://twitter.com/gzeon\">gzeon</a></li>\n<li><a href=\"https://twitter.com/JustDravee\">Dravee</a></li>\n<li>IllIllI</li>\n<li>peritoflores</li>\n<li>kenta</li>\n<li>robee</li>\n<li><a href=\"https://twitter.com/csanuragjain\">csanuragjain</a></li>\n<li>0xwags</li>\n<li><a href=\"https://twitter.com/rhynorater\">Rhynorater</a></li>\n<li><a href=\"https://twitter.com/securerodd\">securerodd</a></li>\n<li>0x1f8b</li>\n<li><a href=\"https://twitter.com/omikomikomik\">Omik</a></li>\n<li>minhquanym</li>\n<li>pedroais</li>\n<li><a href=\"https://twitter.com/0xruhum\">Ruhum</a></li>\n<li>jayjonah8</li>\n<li>cccz</li>\n<li><a href=\"https://twitter.com/kirkthebaird\">kirk-baird</a></li>\n<li><a href=\"https://twitter.com/_ye0lde\">ye0lde</a></li>\n<li><a href=\"https://www.instagram.com/riyan_rfa/\">rfa</a></li>\n<li>sorrynotsorry</li>\n<li><a href=\"https://twitter.com/meidhiwirara\">Tomio</a></li>\n</ol>\n<p>This contest was judged by <a href=\"https://github.com/jack-the-pug\">Jack the Pug</a>.</p>\n<p>Final report assembled by <a href=\"https://twitter.com/liveactionllama\">liveactionllama</a>.</p>\n<h1 id=\"summary\" style=\"position:relative;\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h1>\n<p>The C4 analysis included reports from 24 wardens detailing recommendations that fall under the risk rating of LOW severity or non-critical. There were also reports from 17 wardens describing gas optimizations. All of the submissions presented here are linked back to their original reports.</p>\n<p>Notably, 0 vulnerabilities were found during this audit contest that received a risk rating in the category of HIGH or MEDIUM severity.</p>\n<h1 id=\"scope\" style=\"position:relative;\"><a href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scope</h1>\n<p>The code under review can be found within the <a href=\"https://github.com/code-423n4/2022-02-jpyc\">C4 JPYC contest repository</a>, and is composed of 23 smart contracts written in the Solidity programming language and includes 1552 lines of Solidity code.</p>\n<h1 id=\"severity-criteria\" style=\"position:relative;\"><a href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Severity Criteria</h1>\n<p>C4 assesses the severity of disclosed vulnerabilities according to a methodology based on <a href=\"https://owasp.org/www-community/OWASP_Risk_Rating_Methodology\">OWASP standards</a>.</p>\n<p>Vulnerabilities are divided into three primary risk categories: high, medium, and low.</p>\n<p>High-level considerations for vulnerabilities span the following key areas when conducting assessments:</p>\n<ul>\n<li>Malicious Input Handling</li>\n<li>Escalation of privileges</li>\n<li>Arithmetic</li>\n<li>Gas use</li>\n</ul>\n<p>Further information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on <a href=\"https://code423n4.com\">the C4 website</a>.</p>\n<h1 id=\"low-risk-and-non-critical-issues\" style=\"position:relative;\"><a href=\"#low-risk-and-non-critical-issues\" aria-label=\"low risk and non critical issues permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Low Risk and Non-Critical Issues</h1>\n<p>For this contest, 24 wardens submitted reports detailing low risk and non-critical issues. The <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/35\">report highlighted below</a> by warden <strong>hickuphh3</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/16\">leastwood</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/47\">defsec</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/34\">cmichel</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/52\">TerrierLover</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/24\">kyliek</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/39\">gzeon</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/44\">peritoflores</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/19\">IllIllI</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/26\">Dravee</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/3\">robee</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/8\">csanuragjain</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/41\">0xwags</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/62\">Rhynorater</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/10\">minhquanym</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/31\">securerodd</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/25\">Ruhum</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/15\">kenta</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/30\">0x1f8b</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/18\">jayjonah8</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/58\">Omik</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/5\">cccz</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/1\">kirk-baird</a>, and <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/56\">pedroais</a>.</em></p>\n<h2 id=\"codebase-impressions--summary\" style=\"position:relative;\"><a href=\"#codebase-impressions--summary\" aria-label=\"codebase impressions  summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Codebase Impressions &#x26; Summary</h2>\n<p>Overall, code quality for the JPYC contracts is very high. Supporting documentation provided adequate information on design choices made, such as why the UUPS proxy was chosen over the transparent proxy pattern.</p>\n<p>The test suite could be easily run, and are rather comprehensive. One thing that stood out and that I’m impressed with was a <a href=\"https://github.com/code-423n4/2022-02-jpyc/blob/main/test/README.md\">test checklist</a>. すばらしい! Test coverage was close to 100% with the following functions / branches missed (not significant IMO):</p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v1/EIP712Domain.sol#L45\">else case in <code>EIP712Domain._domainSeparatorV4()</code></a></li>\n<li><a href=\"https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L596-L600\">upgrading of FiatTokenV2</a></li>\n</ul>\n<p>I could be mistaken, but I would like to mention that while the coverage tool highlights that <a href=\"https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L85-L100\">zero inputs for FiatTokenV2’s initializer</a> weren’t tested, they actually are in the <a href=\"https://github.com/code-423n4/2022-02-jpyc/blob/main/test/v2_proxy/FiatTokenV2_proxy.test.js#L316-L324\">FiatTokenV2_proxy test file</a>.</p>\n<p>The findings I made revolved around the upgradeability aspect of the contracts. I also made recommendations on adding / removing functionality when the contract is paused.</p>\n<h2 id=\"l-01-add-constructor-initializer-in-implementation-contracts\" style=\"position:relative;\"><a href=\"#l-01-add-constructor-initializer-in-implementation-contracts\" aria-label=\"l 01 add constructor initializer in implementation contracts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-01] Add constructor initializer in implementation contracts</h2>\n<h3 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h3>\n<p>As per <a href=\"https://forum.openzeppelin.com/t/uupsupgradeable-vulnerability-post-mortem/15680/6\">OpenZeppelin’s (OZ) recommendation</a>, “The guidelines are now to make it impossible for <em>anyone</em> to run <code>initialize</code> on an implementation contract, by adding an empty constructor with the <code>initializer</code> modifier. So the implementation contract gets initialized automatically upon deployment.”</p>\n<p>Note that this behaviour is also incorporated the <a href=\"https://wizard.openzeppelin.com/\">OZ Wizard</a> since the UUPS vulnerability discovery: “Additionally, we modified the code generated by the <a href=\"https://wizard.openzeppelin.com/\">Wizard 19</a> to include a constructor that automatically initializes the implementation when deployed.”</p>\n<p>Furthermore, <strong>this thwarts any attempts to frontrun the <a href=\"https://github.com/code-423n4/2022-02-jpyc/blob/main/test/v2_proxy/FiatTokenV2_proxy.test.js#L79-L89\">initialization tx of the implementation contract</a></strong>.</p>\n<p>Incorporating this change would require inheriting the <code>Initializable</code> contract instead of having an explicit <code>initialized</code> variable.</p>\n<h3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p><code>FiatTokenV1</code>, <code>FiatTokenV2</code> and subsequent implementation contracts should inherit OZ’s <code>Initializable</code> contract and have the following constructor method:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">import</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// TODO: remove bool internal initialized;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// TODO: remove initialized = true;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">FiatTokenV1</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk12\">Initializable</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk3\">/// @custom:oz-upgrades-unsafe-allow constructor</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk11\">constructor</span><span class=\"mtk1\">() </span><span class=\"mtk12\">initializer</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk3\">// so that users won&#39;t accidentally send JPYC to the implementation contract</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t\t</span><span class=\"mtk12\">blocklisted</span><span class=\"mtk1\">[</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">)] = </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h2 id=\"l-02-use-oz-upgrades-hardhat-plugin-to-handle-proxy-deployments-and-upgrades\" style=\"position:relative;\"><a href=\"#l-02-use-oz-upgrades-hardhat-plugin-to-handle-proxy-deployments-and-upgrades\" aria-label=\"l 02 use oz upgrades hardhat plugin to handle proxy deployments and upgrades permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-02] Use OZ upgrades (hardhat) plugin to handle proxy deployments and upgrades</h2>\n<h3 id=\"description-1\" style=\"position:relative;\"><a href=\"#description-1\" aria-label=\"description 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h3>\n<p>The project manually deploys and manages their own proxy contract and upgrades. I strongly recommend that the team use the upgrades plugin from OpenZeppelin instead, because it provides an important feature of validating that the incoming implementations are upgrade safe.</p>\n<p>I note that the plugin is part of <a href=\"https://github.com/code-423n4/2022-02-jpyc/blob/main/package.json#L14\"><code>package.json</code></a> and was imported into <a href=\"https://github.com/code-423n4/2022-02-jpyc/blob/main/hardhat.config.js#L7\">hardhat config</a> file, but am puzzled why it wasn’t used (at least in tests).</p>\n<h3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Strongly consider using the <a href=\"https://github.com/OpenZeppelin/openzeppelin-upgrades\">OZ upgrades plugin</a> to manage deployments. More information about its usage can be found in <a href=\"https://docs.openzeppelin.com/upgrades-plugins/1.x/\">their documentation</a> and <a href=\"https://forum.openzeppelin.com/t/uups-proxies-tutorial-solidity-javascript/7786\">UUPS Proxy</a> guide.</p>\n<p>An example is provided below:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"jsx\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">const</span><span class=\"mtk1\"> { </span><span class=\"mtk12\">ethers</span><span class=\"mtk1\">, </span><span class=\"mtk12\">upgrades</span><span class=\"mtk1\"> } = </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;hardhat&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">contract</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;TestDeploymentAndUpgrade&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">async</span><span class=\"mtk1\"> </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">accounts</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">minter</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">accounts</span><span class=\"mtk1\">[</span><span class=\"mtk7\">6</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">masterMinter</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">accounts</span><span class=\"mtk1\">[</span><span class=\"mtk7\">3</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">pauser</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">accounts</span><span class=\"mtk1\">[</span><span class=\"mtk7\">4</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">blocklister</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">accounts</span><span class=\"mtk1\">[</span><span class=\"mtk7\">5</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">it</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;should do deployment and upgrades&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">async</span><span class=\"mtk1\"> () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Deploying</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">FiatTokenV1</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ethers</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getContractFactory</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;FiatTokenV1&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">instance</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">upgrades</span><span class=\"mtk1\">.</span><span class=\"mtk11\">deployProxy</span><span class=\"mtk1\">(</span><span class=\"mtk12\">FiatTokenV1</span><span class=\"mtk1\">, [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk8\">&#39;JPY Coin&#39;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk8\">&#39;JPYC&#39;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk8\">&#39;JPY&#39;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">18</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">masterMinter</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">pauser</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">blocklister</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">minter</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      ],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      { </span><span class=\"mtk12\">kind:</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&#39;uups&#39;</span><span class=\"mtk1\"> });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">instance</span><span class=\"mtk1\">.</span><span class=\"mtk11\">deployed</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\">// Upgrading</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">FiatTokenV2</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ethers</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getContractFactory</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;FiatTokenV2&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">upgraded</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">upgrades</span><span class=\"mtk1\">.</span><span class=\"mtk11\">upgradeProxy</span><span class=\"mtk1\">(</span><span class=\"mtk12\">instance</span><span class=\"mtk1\">.</span><span class=\"mtk12\">address</span><span class=\"mtk1\">, </span><span class=\"mtk12\">FiatTokenV2</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">});</span></span></span></code></pre>\n<h2 id=\"l-03-contracts-are-not-using-their-oz-upgradeable-counterparts\" style=\"position:relative;\"><a href=\"#l-03-contracts-are-not-using-their-oz-upgradeable-counterparts\" aria-label=\"l 03 contracts are not using their oz upgradeable counterparts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-03] Contracts are not using their OZ upgradeable counterparts</h2>\n<h3 id=\"tools-used\" style=\"position:relative;\"><a href=\"#tools-used\" aria-label=\"tools used permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>Diffchecker</p>\n<h3 id=\"description-2\" style=\"position:relative;\"><a href=\"#description-2\" aria-label=\"description 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h3>\n<p>The non-upgradeable standard version of OpenZeppelin’s library, such as <code>Ownable</code>, <code>Pausable</code>, <code>Address</code>, <code>Context</code>, <code>SafeERC20</code>, <code>ERC1967Upgrade</code> etc, are inherited / used by both the proxy and the implementation contracts.</p>\n<p>As a result, when attempting to use the upgrades plugin mentioned, the following errors are raised:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">Error: </span><span class=\"mtk12\">Contract</span><span class=\"mtk1\"> </span><span class=\"mtk8\">`FiatTokenV1`</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span><span class=\"mtk12\">not</span><span class=\"mtk1\"> </span><span class=\"mtk12\">upgrade</span><span class=\"mtk1\"> </span><span class=\"mtk12\">safe</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">v1</span><span class=\"mtk1\">/</span><span class=\"mtk12\">FiatTokenV1</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">:</span><span class=\"mtk7\">58</span><span class=\"mtk1\">: </span><span class=\"mtk12\">Variable</span><span class=\"mtk1\"> </span><span class=\"mtk8\">`totalSupply_`</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span><span class=\"mtk12\">assigned</span><span class=\"mtk1\"> </span><span class=\"mtk12\">an</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initial</span><span class=\"mtk1\"> </span><span class=\"mtk12\">value</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk12\">Move</span><span class=\"mtk1\"> </span><span class=\"mtk12\">the</span><span class=\"mtk1\"> </span><span class=\"mtk12\">assignment</span><span class=\"mtk1\"> </span><span class=\"mtk12\">to</span><span class=\"mtk1\"> </span><span class=\"mtk12\">the</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initializer</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  https:</span><span class=\"mtk3\">//zpl.in/upgrades/error-004</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">v1</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Pausable</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">:</span><span class=\"mtk7\">49</span><span class=\"mtk1\">: </span><span class=\"mtk12\">Variable</span><span class=\"mtk1\"> </span><span class=\"mtk8\">`paused`</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span><span class=\"mtk12\">assigned</span><span class=\"mtk1\"> </span><span class=\"mtk12\">an</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initial</span><span class=\"mtk1\"> </span><span class=\"mtk12\">value</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk12\">Move</span><span class=\"mtk1\"> </span><span class=\"mtk12\">the</span><span class=\"mtk1\"> </span><span class=\"mtk12\">assignment</span><span class=\"mtk1\"> </span><span class=\"mtk12\">to</span><span class=\"mtk1\"> </span><span class=\"mtk12\">the</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initializer</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  https:</span><span class=\"mtk3\">//zpl.in/upgrades/error-004</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">v1</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Ownable</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">:</span><span class=\"mtk7\">28</span><span class=\"mtk1\">: </span><span class=\"mtk12\">Contract</span><span class=\"mtk1\"> </span><span class=\"mtk8\">`Ownable`</span><span class=\"mtk1\"> </span><span class=\"mtk12\">has</span><span class=\"mtk1\"> </span><span class=\"mtk12\">a</span><span class=\"mtk1\"> </span><span class=\"mtk12\">constructor</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk12\">Define</span><span class=\"mtk1\"> </span><span class=\"mtk12\">an</span><span class=\"mtk1\"> </span><span class=\"mtk12\">initializer</span><span class=\"mtk1\"> </span><span class=\"mtk12\">instead</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  https:</span><span class=\"mtk3\">//zpl.in/upgrades/error-001</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">util</span><span class=\"mtk1\">/</span><span class=\"mtk12\">Address</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\">:</span><span class=\"mtk7\">186</span><span class=\"mtk1\">: </span><span class=\"mtk12\">Use</span><span class=\"mtk1\"> </span><span class=\"mtk4\">of</span><span class=\"mtk1\"> </span><span class=\"mtk12\">delegatecall</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span><span class=\"mtk12\">not</span><span class=\"mtk1\"> </span><span class=\"mtk12\">allowed</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  https:</span><span class=\"mtk3\">//zpl.in/upgrades/error-002</span></span></span></code></pre>\n<p>Having reviewed these errors, none had any adversarial impact:</p>\n<ul>\n<li><code>totalSupply_</code> and <code>paused</code> are explictly assigned the default values <code>0</code> and <code>false</code></li>\n<li>the implementation contracts utilises the internal <code>_transferOwnership()</code> in the initializer, thus transferring ownership to <code>newOwner</code> regardless of who the current owner is</li>\n<li><code>Address</code>’s <code>delegatecall</code> is only used by the <code>ERC1967Upgrade</code> contract. Comparing both the <code>Address</code> and <code>ERC1967Upgrade</code> contracts against their upgradeable counterparts show similar behaviour (differences are some refactoring done to shift the delegatecall into the <code>ERC1967Upgrade</code> contract).</li>\n</ul>\n<p>Nevertheless, it would be safer to use the upgradeable versions of the library contracts to avoid unexpected behaviour.</p>\n<h3 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Where applicable, use the contracts from <code>@openzeppelin/contracts-upgradeable</code> instead of <code>@openzeppelin/contracts</code>.</p>\n<h2 id=\"l-04-fiattokenv1--v2-remove-whennotpaused-modifier-from-cancelauthorization-and-decreaseallowance-functions\" style=\"position:relative;\"><a href=\"#l-04-fiattokenv1--v2-remove-whennotpaused-modifier-from-cancelauthorization-and-decreaseallowance-functions\" aria-label=\"l 04 fiattokenv1  v2 remove whennotpaused modifier from cancelauthorization and decreaseallowance functions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-04] FiatTokenV1 / V2: Remove <code>whenNotPaused</code> modifier from <code>cancelAuthorization()</code> and <code>decreaseAllowance()</code> functions</h2>\n<h3 id=\"line-references\" style=\"position:relative;\"><a href=\"#line-references\" aria-label=\"line references permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Line References</h3>\n<p><a href=\"https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v1/FiatTokenV1.sol#L409-L414\">https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v1/FiatTokenV1.sol#L409-L414</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v1/FiatTokenV1.sol#L535-L541\">https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v1/FiatTokenV1.sol#L535-L541</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L420-L425\">https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L420-L425</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L558-L564\">https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L558-L564</a></p>\n<h3 id=\"description-3\" style=\"position:relative;\"><a href=\"#description-3\" aria-label=\"description 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h3>\n<p>Just like how <code>removeMinter()</code> doesn’t have the <code>whenNotPaused</code> modifier, it would be very beneficial useful (eg. when a hack / rug pull occurs) to allow users to revoke allowances and cancel authorizations whilst having transfers paused.</p>\n<h3 id=\"recommended-mitigation-steps-3\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-3\" aria-label=\"recommended mitigation steps 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Remove the <code>whenNotPaused</code> modifiers for the <code>cancelAuthorization()</code> and <code>decreaseAllowance()</code> functions.</p>\n<h2 id=\"l-05-fiattokenv2-whitelist-should-be-unusable-if-contract-is-paused\" style=\"position:relative;\"><a href=\"#l-05-fiattokenv2-whitelist-should-be-unusable-if-contract-is-paused\" aria-label=\"l 05 fiattokenv2 whitelist should be unusable if contract is paused permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-05] FiatTokenV2: <code>whitelist()</code> should be unusable if contract is paused</h2>\n<h3 id=\"line-references-1\" style=\"position:relative;\"><a href=\"#line-references-1\" aria-label=\"line references 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Line References</h3>\n<p><a href=\"https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L645\">https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L645</a></p>\n<h3 id=\"description-4\" style=\"position:relative;\"><a href=\"#description-4\" aria-label=\"description 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h3>\n<p>Should the contract be paused, it would be safer to prevent additional addresses from being whitelisted.</p>\n<h3 id=\"recommended-mitigation-steps-4\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-4\" aria-label=\"recommended mitigation steps 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Add the <code>whenNotPaused</code> modifier for the <code>whitelist()</code> function.</p>\n<h2 id=\"l-06-incorrect-versioning-of-fiattokenv2\" style=\"position:relative;\"><a href=\"#l-06-incorrect-versioning-of-fiattokenv2\" aria-label=\"l 06 incorrect versioning of fiattokenv2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-06] Incorrect versioning of <code>FiatTokenV2</code></h2>\n<h3 id=\"line-references-2\" style=\"position:relative;\"><a href=\"#line-references-2\" aria-label=\"line references 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Line References</h3>\n<p><a href=\"https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L111\">https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L111</a></p>\n<p><a href=\"https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L114\">https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L114</a></p>\n<h3 id=\"description-5\" style=\"position:relative;\"><a href=\"#description-5\" aria-label=\"description 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h3>\n<p>Since V2 is an upgrade of V1, its versioning should be updated to reflect the upgrade as well. It is important for the correct version to be reflected since it also part of the EIP712 data to be signed, which is used by EIP2612 and EIP3009 for fungible asset transfer authorizations. Authorizations given for outdated versions should rightfully be made invalid.</p>\n<h4 id=\"recommended-mitigation-steps-5\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-5\" aria-label=\"recommended mitigation steps 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h4>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"jsx\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">DOMAIN_SEPARATOR</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">EIP712</span><span class=\"mtk1\">.</span><span class=\"mtk11\">makeDomainSeparator</span><span class=\"mtk1\">(</span><span class=\"mtk12\">name</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;2&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">VERSION</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;2&quot;</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<h2 id=\"n-01-bump-oz-packages-to-450\" style=\"position:relative;\"><a href=\"#n-01-bump-oz-packages-to-450\" aria-label=\"n 01 bump oz packages to 450 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-01] Bump OZ packages to <code>^4.5.0</code>.</h2>\n<h3 id=\"line-reference\" style=\"position:relative;\"><a href=\"#line-reference\" aria-label=\"line reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Line Reference</h3>\n<p><a href=\"https://github.com/code-423n4/2022-02-jpyc#about-soliditys-version\">https://github.com/code-423n4/2022-02-jpyc#about-soliditys-version</a></p>\n<p><a href=\"https://github.com/OpenZeppelin/openzeppelin-contracts/commit/e192fac2769386b7d4b61a3541073ab47bb7723a\">https://github.com/OpenZeppelin/openzeppelin-contracts/commit/e192fac2769386b7d4b61a3541073ab47bb7723a</a></p>\n<h3 id=\"description-6\" style=\"position:relative;\"><a href=\"#description-6\" aria-label=\"description 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h3>\n<p>The section referenced referred to a change in the <code>UUPSUpgradeable</code> and <code>ERC1967Upgrade</code> contracts that are only included in the latest package version of the OZ npm packages . However, the version specified in <code>package-lock.json</code> is <code>4.4.1</code>, which does <strong>not</strong> include this change (and hence I assume was manually imported).</p>\n<p>I can verify that the installed version is <code>4.4.1</code> by executing the following commands:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"jsx\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">yarn</span><span class=\"mtk1\"> </span><span class=\"mtk12\">install</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">yarn</span><span class=\"mtk1\"> </span><span class=\"mtk12\">list</span><span class=\"mtk1\"> @</span><span class=\"mtk12\">openzeppelin</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-6\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-6\" aria-label=\"recommended mitigation steps 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Update the versions of <code>@openzeppelin/contracts</code> and <code>@openzeppelin/contracts-upgradeable</code> to be the latest in <code>package.json</code>. I also recommend double checking the versions of other dependencies as a precaution, as they may include important bug fixes.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/35#issuecomment-1055101096\">0xywzx (JPYC) commented</a>:</strong></p>\n<blockquote>\n<p>Thank you for your report. It is very helpful. ありがとうございます！</p>\n<h4 id=\"l01\" style=\"position:relative;\"><a href=\"#l01\" aria-label=\"l01 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>L01</h4>\n<p>Your solution looks good.\nWe will change the code to use initializable for constructor.</p>\n<h4 id=\"l02\" style=\"position:relative;\"><a href=\"#l02\" aria-label=\"l02 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>L02</h4>\n<p>Since we don’t use the hardhat plugin in the actual deployment, we didn’t use it in the test code.\nBy the way, if you know how to deploy in a secure way, I would appreciate it if you could us me know.</p>\n<h4 id=\"l03\" style=\"position:relative;\"><a href=\"#l03\" aria-label=\"l03 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>L03</h4>\n<p>We have compliant USDC, so the code is looks like.\nHowever, ‘functionDelegateCall()’ was deleted from OZ upgradable contract, so we will check it.</p>\n<h4 id=\"l04\" style=\"position:relative;\"><a href=\"#l04\" aria-label=\"l04 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>L04</h4>\n<p>We didn’t include ‘whenNotPaused()’ for whitelist because it doesn’t have a significant impact on the contract itself.</p>\n<h4 id=\"l5--l6\" style=\"position:relative;\"><a href=\"#l5--l6\" aria-label=\"l5  l6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>L5 &#x26; L6</h4>\n<p>We agree with your advice.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/35#issuecomment-1081346666\">thurendous (JPYC) resolved and commented</a>:</strong></p>\n<blockquote>\n<blockquote>\n<p>Incorrect versioning of FiatTokenV2</p>\n</blockquote>\n<p>Fixed and thanks!</p>\n<p>The change can be viewed <a href=\"https://github.com/jcam1/JPYCv2/commit/63373b0dc20fca9581333583ab945d1e8269e654\">here</a>.</p>\n</blockquote>\n<hr>\n<h1 id=\"gas-optimizations\" style=\"position:relative;\"><a href=\"#gas-optimizations\" aria-label=\"gas optimizations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gas Optimizations</h1>\n<p>For this contest, 17 wardens submitted reports detailing gas optimizations. The <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/27\">report highlighted below</a> by warden <strong>Dravee</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/17\">kenta</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/20\">IllIllI</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/28\">ye0lde</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/55\">defsec</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/40\">gzeon</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/2\">robee</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/57\">Omik</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/32\">securerodd</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/51\">TerrierLover</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/61\">pedroais</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/49\">rfa</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/36\">sorrynotsorry</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/29\">0x1f8b</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/45\">peritoflores</a>, <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/60\">Rhynorater</a>, and <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/38\">Tomio</a>.</em></p>\n<h2 id=\"foreword\" style=\"position:relative;\"><a href=\"#foreword\" aria-label=\"foreword permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Foreword</h2>\n<ul>\n<li><strong>Storage-reading optimizations</strong></li>\n</ul>\n<blockquote>\n<p>The code can be optimized by minimising the number of SLOADs. SLOADs are expensive (100 gas) compared to MLOADs/MSTOREs (3 gas). In the paragraphs below, please see the <code>@audit-issue</code> tags in the pieces of code’s comments for more information about SLOADs that could be saved by caching the mentioned <strong>storage</strong> variables in <strong>memory</strong> variables.</p>\n</blockquote>\n<ul>\n<li><strong>Unchecking arithmetics operations that can’t underflow/overflow</strong></li>\n</ul>\n<blockquote>\n<p>Solidity version 0.8+ comes with implicit overflow and underflow checks on unsigned integers. When an overflow or an underflow isn’t possible (as an example, when a comparison is made before the arithmetic operation, or the operation doesn’t depend on user input), some gas can be saved by using an <code>unchecked</code> block: <a href=\"https://docs.soliditylang.org/en/v0.8.10/control-structures.html#checked-or-unchecked-arithmetic\">https://docs.soliditylang.org/en/v0.8.10/control-structures.html#checked-or-unchecked-arithmetic</a></p>\n</blockquote>\n<ul>\n<li><strong><code>@audit</code> tags</strong></li>\n</ul>\n<blockquote>\n<p>The code is annotated at multiple places with <code>//@audit</code> comments to pinpoint the issues. Please, pay attention to them for more details.</p>\n</blockquote>\n<h2 id=\"g-01-file-erc1967proxysol\" style=\"position:relative;\"><a href=\"#g-01-file-erc1967proxysol\" aria-label=\"g 01 file erc1967proxysol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-01] File: ERC1967Proxy.sol</h2>\n<h3 id=\"function-_implementation\" style=\"position:relative;\"><a href=\"#function-_implementation\" aria-label=\"function _implementation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function _implementation()</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">ERC1967Proxy</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">30</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_implementation</span><span class=\"mtk1\">() </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">virtual</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">impl</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">31</span><span class=\"mtk1\">:         </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ERC1967Upgrade</span><span class=\"mtk1\">.</span><span class=\"mtk11\">_getImplementation</span><span class=\"mtk1\">(); </span><span class=\"mtk3\">//@audit unused named returns</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">32</span><span class=\"mtk1\">:     }</span></span></span></code></pre>\n<h4 id=\"using-both-named-returns-and-a-return-statement-isnt-necessary\" style=\"position:relative;\"><a href=\"#using-both-named-returns-and-a-return-statement-isnt-necessary\" aria-label=\"using both named returns and a return statement isnt necessary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using both named returns and a return statement isn’t necessary</h4>\n<p>Removing unused named returns variables can reduce gas usage (MSTOREs/MLOADs) and improve code clarity. To save gas and improve code quality: consider using only one of those.</p>\n<h2 id=\"g-02-file-uupsupgradeablesol\" style=\"position:relative;\"><a href=\"#g-02-file-uupsupgradeablesol\" aria-label=\"g 02 file uupsupgradeablesol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-02] File: UUPSUpgradeable.sol</h2>\n<h3 id=\"function-upgradetoandcall\" style=\"position:relative;\"><a href=\"#function-upgradetoandcall\" aria-label=\"function upgradetoandcall permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function upgradeToAndCall()</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">UUPSUpgradeable</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">095</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">upgradeToAndCall</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">newImplementation</span><span class=\"mtk1\">, </span><span class=\"mtk12\">bytes</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">data</span><span class=\"mtk1\">) </span><span class=\"mtk3\">//@audit can be calldata</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">096:         </span><span class=\"mtk11\">external</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">097:         </span><span class=\"mtk11\">payable</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">098:         </span><span class=\"mtk11\">virtual</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">099:         </span><span class=\"mtk11\">onlyProxy</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">100:     {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">101</span><span class=\"mtk1\">:         </span><span class=\"mtk11\">_authorizeUpgrade</span><span class=\"mtk1\">(</span><span class=\"mtk12\">newImplementation</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">102</span><span class=\"mtk1\">:         </span><span class=\"mtk11\">_upgradeToAndCallUUPS</span><span class=\"mtk1\">(</span><span class=\"mtk12\">newImplementation</span><span class=\"mtk1\">, </span><span class=\"mtk12\">data</span><span class=\"mtk1\">, </span><span class=\"mtk4\">true</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">103</span><span class=\"mtk1\">:     }</span></span></span></code></pre>\n<h3 id=\"use-calldata-instead-of-memory-for-external-functions-where-the-function-argument-is-read-only\" style=\"position:relative;\"><a href=\"#use-calldata-instead-of-memory-for-external-functions-where-the-function-argument-is-read-only\" aria-label=\"use calldata instead of memory for external functions where the function argument is read only permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Use <code>calldata</code> instead of <code>memory</code> for external functions where the function argument is read-only</h3>\n<p>Here, <code>bytes memory data</code> should be <code>bytes calldata data</code></p>\n<h2 id=\"g-03-file-blocklistablesol\" style=\"position:relative;\"><a href=\"#g-03-file-blocklistablesol\" aria-label=\"g 03 file blocklistablesol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-03] File: Blocklistable.sol</h2>\n<h3 id=\"function-updateblocklister\" style=\"position:relative;\"><a href=\"#function-updateblocklister\" aria-label=\"function updateblocklister permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function updateBlocklister()</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">Blocklistable</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">90</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">updateBlocklister</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_newBlocklister</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyOwner</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">91</span><span class=\"mtk1\">:         </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">92</span><span class=\"mtk1\">:             </span><span class=\"mtk12\">_newBlocklister</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">93</span><span class=\"mtk1\">:             </span><span class=\"mtk8\">&quot;Blocklistable: new blocklister is the zero address&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">94</span><span class=\"mtk1\">:         );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">95</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">blocklister</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_newBlocklister</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">96</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">BlocklisterChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">blocklister</span><span class=\"mtk1\">); </span><span class=\"mtk3\">//@audit emitting storage value</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">97</span><span class=\"mtk1\">:     }</span></span></span></code></pre>\n<h4 id=\"emitting-a-storage-value-blocklister-vs-_newblocklister\" style=\"position:relative;\"><a href=\"#emitting-a-storage-value-blocklister-vs-_newblocklister\" aria-label=\"emitting a storage value blocklister vs _newblocklister permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Emitting a storage value (<code>blocklister</code> vs <code>_newBlocklister</code>)</h4>\n<p>I suggest going from</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">96</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">BlocklisterChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">blocklister</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>to</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">96</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">BlocklisterChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_newBlocklister</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<h2 id=\"g-04-file-eip3009sol\" style=\"position:relative;\"><a href=\"#g-04-file-eip3009sol\" aria-label=\"g 04 file eip3009sol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-04] File: EIP3009.sol</h2>\n<h3 id=\"function-_requirevalidauthorization\" style=\"position:relative;\"><a href=\"#function-_requirevalidauthorization\" aria-label=\"function _requirevalidauthorization permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function _requireValidAuthorization()</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">EIP3009</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">219</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_requireValidAuthorization</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">220:         </span><span class=\"mtk10\">address</span><span class=\"mtk1\"> </span><span class=\"mtk10\">authorizer</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">221:         </span><span class=\"mtk10\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk10\">nonce</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">222:         </span><span class=\"mtk10\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk10\">validAfter</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">223:         </span><span class=\"mtk10\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk10\">validBefore</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">224</span><span class=\"mtk1\">:     ) </span><span class=\"mtk11\">private</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">225</span><span class=\"mtk1\">:         </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">226</span><span class=\"mtk1\">:             </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk12\">validAfter</span><span class=\"mtk1\">, </span><span class=\"mtk3\">//@audit make it inclusive</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">227</span><span class=\"mtk1\">:             </span><span class=\"mtk8\">&quot;FEIP3009: authorization is not yet valid&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">228</span><span class=\"mtk1\">:         );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">229</span><span class=\"mtk1\">:         </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">230</span><span class=\"mtk1\">:             </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">validBefore</span><span class=\"mtk1\">,</span><span class=\"mtk3\">//@audit make it inclusive</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">231</span><span class=\"mtk1\">:             </span><span class=\"mtk8\">&quot;EIP3009: authorization is expired&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">232</span><span class=\"mtk1\">:         );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">233</span><span class=\"mtk1\">:         </span><span class=\"mtk11\">_requireUnusedAuthorization</span><span class=\"mtk1\">(</span><span class=\"mtk12\">authorizer</span><span class=\"mtk1\">, </span><span class=\"mtk12\">nonce</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">234</span><span class=\"mtk1\">:     }</span></span></span></code></pre>\n<h4 id=\"non-strict-inequalities-are-cheaper-than-strict-ones-1\" style=\"position:relative;\"><a href=\"#non-strict-inequalities-are-cheaper-than-strict-ones-1\" aria-label=\"non strict inequalities are cheaper than strict ones 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Non-strict inequalities are cheaper than strict ones (1)</h4>\n<p>It’s possible to save 3 gas on <code>block.timestamp > validAfter</code> by making it inclusive: <code>block.timestamp >= validAfter</code>. I believe it wouldn’t change much functionally here.</p>\n<h4 id=\"non-strict-inequalities-are-cheaper-than-strict-ones-2\" style=\"position:relative;\"><a href=\"#non-strict-inequalities-are-cheaper-than-strict-ones-2\" aria-label=\"non strict inequalities are cheaper than strict ones 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Non-strict inequalities are cheaper than strict ones (2)</h4>\n<p>It’s possible to save 3 gas on <code>block.timestamp &#x3C; validBefore</code> by making it inclusive: <code>block.timestamp &#x3C;= validBefore</code>. I believe it wouldn’t change much functionally here.</p>\n<h2 id=\"g-05-file-fiattokenv1sol\" style=\"position:relative;\"><a href=\"#g-05-file-fiattokenv1sol\" aria-label=\"g 05 file fiattokenv1sol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-05] File: FiatTokenV1.sol</h2>\n<h3 id=\"function-initialize\" style=\"position:relative;\"><a href=\"#function-initialize\" aria-label=\"function initialize permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function initialize()</h3>\n<h4 id=\"use-tokenname-instead-of-name\" style=\"position:relative;\"><a href=\"#use-tokenname-instead-of-name\" aria-label=\"use tokenname instead of name permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Use <code>tokenName</code> instead of <code>name</code></h4>\n<p>This can save 2 SLOADs (around 200 gas).\nReplace:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">FiatTokenV1</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">96</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">name</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">tokenName</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">105</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">DOMAIN_SEPARATOR</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">EIP712</span><span class=\"mtk1\">.</span><span class=\"mtk11\">makeDomainSeparator</span><span class=\"mtk1\">(</span><span class=\"mtk12\">name</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;1&quot;</span><span class=\"mtk1\">); </span><span class=\"mtk3\">//@audit name SLOAD </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">106</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">CHAIN_ID</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">chainid</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">107</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">NAME</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">name</span><span class=\"mtk1\">;</span><span class=\"mtk3\">//@audit name SLOAD</span></span></span></code></pre>\n<p>with</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">105</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">DOMAIN_SEPARATOR</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">EIP712</span><span class=\"mtk1\">.</span><span class=\"mtk11\">makeDomainSeparator</span><span class=\"mtk1\">(</span><span class=\"mtk12\">tokenName</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;1&quot;</span><span class=\"mtk1\">); </span><span class=\"mtk3\">//@audit tokenName MLOAD </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">107</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">NAME</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">tokenName</span><span class=\"mtk1\">;</span><span class=\"mtk3\">//@audit tokenName MLOAD</span></span></span></code></pre>\n<p>Additionally, <code>EIP712.makeDomainSeparator()</code> signature is as such:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">EIP712</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">40</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">makeDomainSeparator</span><span class=\"mtk1\">(</span><span class=\"mtk12\">string</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">name</span><span class=\"mtk1\">, </span><span class=\"mtk12\">string</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">version</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<p>As the first argument is a <code>memory</code> and not a <code>storage</code>, passing the storage <code>name</code> instead of the memory <code>tokenName</code> would imply another copy in memory</p>\n<h3 id=\"function-mint\" style=\"position:relative;\"><a href=\"#function-mint\" aria-label=\"function mint permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function mint()</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">FiatTokenV1</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">127</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">mint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">139:         </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">140:             </span><span class=\"mtk10\">_amount</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk10\">mintingAllowedAmount</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">146</span><span class=\"mtk1\">:         </span><span class=\"mtk10\">minterAllowed</span><span class=\"mtk1\">[</span><span class=\"mtk10\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk10\">sender</span><span class=\"mtk1\">] = </span><span class=\"mtk10\">mintingAllowedAmount</span><span class=\"mtk1\"> - </span><span class=\"mtk10\">_amount</span><span class=\"mtk1\">;</span><span class=\"mtk3\">//@audit should be unchecked (see L140)</span></span></span></code></pre>\n<h4 id=\"unchecked-block-l146\" style=\"position:relative;\"><a href=\"#unchecked-block-l146\" aria-label=\"unchecked block l146 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unchecked block L146</h4>\n<p>This line can’t underflow due to L140. Therefore, it should be wrapped in an <code>unchecked</code> block.</p>\n<h3 id=\"function-transferfrom\" style=\"position:relative;\"><a href=\"#function-transferfrom\" aria-label=\"function transferfrom permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function transferFrom()</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">FiatTokenV1</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">258</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">transferFrom</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">271:         </span><span class=\"mtk10\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">272</span><span class=\"mtk1\">:             </span><span class=\"mtk10\">value</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk10\">allowed</span><span class=\"mtk1\">[</span><span class=\"mtk10\">from</span><span class=\"mtk1\">][</span><span class=\"mtk10\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk10\">sender</span><span class=\"mtk1\">], </span><span class=\"mtk3\">//@audit allowed[from][msg.sender] SLOAD 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">273</span><span class=\"mtk1\">:             </span><span class=\"mtk8\">&quot;ERC20: transfer amount exceeds allowance&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">274</span><span class=\"mtk1\">:         );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">275</span><span class=\"mtk1\">:         </span><span class=\"mtk10\">_transfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">from</span><span class=\"mtk1\">, </span><span class=\"mtk12\">to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">value</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">276</span><span class=\"mtk1\">:         </span><span class=\"mtk10\">allowed</span><span class=\"mtk1\">[</span><span class=\"mtk10\">from</span><span class=\"mtk1\">][</span><span class=\"mtk10\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk10\">sender</span><span class=\"mtk1\">] = </span><span class=\"mtk10\">allowed</span><span class=\"mtk1\">[</span><span class=\"mtk10\">from</span><span class=\"mtk1\">][</span><span class=\"mtk10\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk10\">sender</span><span class=\"mtk1\">] - </span><span class=\"mtk10\">value</span><span class=\"mtk1\">; </span><span class=\"mtk3\">//@audit should be unchecked (see L272) //@audit allowed[from][msg.sender] SLOAD 2</span></span></span></code></pre>\n<h4 id=\"unchecked-block-l276\" style=\"position:relative;\"><a href=\"#unchecked-block-l276\" aria-label=\"unchecked block l276 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unchecked block L276</h4>\n<p>This line can’t underflow due to L272. Therefore, it should be wrapped in an <code>unchecked</code> block.</p>\n<h4 id=\"cache-allowedfrommsgsender\" style=\"position:relative;\"><a href=\"#cache-allowedfrommsgsender\" aria-label=\"cache allowedfrommsgsender permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cache <code>allowed[from][msg.sender]</code></h4>\n<p>Caching this in memory can save around 1 SLOAD.\nThis is similar to an already implemented optimization in <code>L361: function burn()</code> for <code>uint256 balance = balances[msg.sender]</code></p>\n<h3 id=\"function-_transfer\" style=\"position:relative;\"><a href=\"#function-_transfer\" aria-label=\"function _transfer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function _transfer()</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">FiatTokenV1</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">304</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_transfer</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">311:         </span><span class=\"mtk10\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">312</span><span class=\"mtk1\">:             </span><span class=\"mtk10\">value</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk10\">balances</span><span class=\"mtk1\">[</span><span class=\"mtk10\">from</span><span class=\"mtk1\">],</span><span class=\"mtk3\">//@audit SLOAD 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">313</span><span class=\"mtk1\">:             </span><span class=\"mtk8\">&quot;ERC20: transfer amount exceeds balance&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">314</span><span class=\"mtk1\">:         );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">315</span><span class=\"mtk1\">: </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">316</span><span class=\"mtk1\">:         </span><span class=\"mtk10\">balances</span><span class=\"mtk1\">[</span><span class=\"mtk10\">from</span><span class=\"mtk1\">] = </span><span class=\"mtk10\">balances</span><span class=\"mtk1\">[</span><span class=\"mtk10\">from</span><span class=\"mtk1\">] - </span><span class=\"mtk10\">value</span><span class=\"mtk1\">; </span><span class=\"mtk3\">//@audit should be unchecked (see L312) //@audit SLOAD 2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">317</span><span class=\"mtk1\">:         </span><span class=\"mtk10\">balances</span><span class=\"mtk1\">[</span><span class=\"mtk10\">to</span><span class=\"mtk1\">] = </span><span class=\"mtk10\">balances</span><span class=\"mtk1\">[</span><span class=\"mtk10\">to</span><span class=\"mtk1\">] + </span><span class=\"mtk10\">value</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<h4 id=\"unchecked-block-l316\" style=\"position:relative;\"><a href=\"#unchecked-block-l316\" aria-label=\"unchecked block l316 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unchecked block L316</h4>\n<p>This line can’t underflow due to L312. Therefore, it should be wrapped in an <code>unchecked</code> block.</p>\n<h4 id=\"cache-balancesfrom\" style=\"position:relative;\"><a href=\"#cache-balancesfrom\" aria-label=\"cache balancesfrom permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cache <code>balances[from]</code></h4>\n<p>Caching this in memory can save around 1 SLOAD.\nThis is similar to an already implemented optimization in <code>L361: function burn()</code> for <code>uint256 balance = balances[msg.sender]</code></p>\n<h3 id=\"function-burn\" style=\"position:relative;\"><a href=\"#function-burn\" aria-label=\"function burn permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function burn()</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">FiatTokenV1</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">361</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">burn</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">369:         </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">balance</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;FiatToken: burn amount exceeds balance&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">370</span><span class=\"mtk1\">: </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">371</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">totalSupply_</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">totalSupply_</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">372</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">balances</span><span class=\"mtk1\">[</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">balance</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">; </span><span class=\"mtk3\">//@audit should be unchecked (see L369)</span></span></span></code></pre>\n<h4 id=\"unchecked-block-l372\" style=\"position:relative;\"><a href=\"#unchecked-block-l372\" aria-label=\"unchecked block l372 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unchecked block L372</h4>\n<p>This line can’t underflow due to L369. Therefore, it should be wrapped in an <code>unchecked</code> block.</p>\n<h3 id=\"function-updatemasterminter\" style=\"position:relative;\"><a href=\"#function-updatemasterminter\" aria-label=\"function updatemasterminter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function updateMasterMinter()</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">FiatTokenV1</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">377</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">updateMasterMinter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_newMasterMinter</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyOwner</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">378</span><span class=\"mtk1\">:         </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">379</span><span class=\"mtk1\">:             </span><span class=\"mtk12\">_newMasterMinter</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">380</span><span class=\"mtk1\">:             </span><span class=\"mtk8\">&quot;FiatToken: new masterMinter is the zero address&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">381</span><span class=\"mtk1\">:         );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">382</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">masterMinter</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_newMasterMinter</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">383</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MasterMinterChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">masterMinter</span><span class=\"mtk1\">); </span><span class=\"mtk3\">//@audit emitting storage value</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">384</span><span class=\"mtk1\">:     }</span></span></span></code></pre>\n<h4 id=\"emitting-a-storage-value-masterminter-vs-_newmasterminter\" style=\"position:relative;\"><a href=\"#emitting-a-storage-value-masterminter-vs-_newmasterminter\" aria-label=\"emitting a storage value masterminter vs _newmasterminter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Emitting a storage value (<code>masterMinter</code> vs <code>_newMasterMinter</code>)</h4>\n<p>I suggest going from</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"19\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">383</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MasterMinterChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">masterMinter</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>to</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"20\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">383</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MasterMinterChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_newMasterMinter</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<h3 id=\"function-_decreaseallowance\" style=\"position:relative;\"><a href=\"#function-_decreaseallowance\" aria-label=\"function _decreaseallowance permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function _decreaseAllowance()</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"21\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">FiatTokenV1</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">440</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_decreaseAllowance</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">445:         </span><span class=\"mtk10\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">446</span><span class=\"mtk1\">:             </span><span class=\"mtk10\">decrement</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk10\">allowed</span><span class=\"mtk1\">[</span><span class=\"mtk10\">owner</span><span class=\"mtk1\">][</span><span class=\"mtk10\">spender</span><span class=\"mtk1\">],</span><span class=\"mtk3\">//@audit SLOAD 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">447</span><span class=\"mtk1\">:             </span><span class=\"mtk8\">&quot;ERC20: decreased allowance below zero&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">448</span><span class=\"mtk1\">:         );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">449</span><span class=\"mtk1\">:         </span><span class=\"mtk10\">_approve</span><span class=\"mtk1\">(</span><span class=\"mtk12\">owner</span><span class=\"mtk1\">, </span><span class=\"mtk12\">spender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">allowed</span><span class=\"mtk1\">[</span><span class=\"mtk12\">owner</span><span class=\"mtk1\">][</span><span class=\"mtk12\">spender</span><span class=\"mtk1\">] - </span><span class=\"mtk12\">decrement</span><span class=\"mtk1\">); </span><span class=\"mtk3\">//@audit should be unchecked (see L446) //@audit SLOAD 2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">450</span><span class=\"mtk1\">:     }</span></span></span></code></pre>\n<h4 id=\"unchecked-block-l449\" style=\"position:relative;\"><a href=\"#unchecked-block-l449\" aria-label=\"unchecked block l449 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unchecked block L449</h4>\n<p>This line can’t underflow due to L446. Therefore, it should be wrapped in an <code>unchecked</code> block.</p>\n<h4 id=\"cache-allowedownerspender\" style=\"position:relative;\"><a href=\"#cache-allowedownerspender\" aria-label=\"cache allowedownerspender permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cache <code>allowed[owner][spender]</code></h4>\n<p>Caching this in memory can save around 1 SLOAD.\nThis is similar to an already implemented optimization in <code>L361: function burn()</code> for <code>uint256 balance = balances[msg.sender]</code></p>\n<h2 id=\"g-06-file-fiattokenv2sol\" style=\"position:relative;\"><a href=\"#g-06-file-fiattokenv2sol\" aria-label=\"g 06 file fiattokenv2sol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-06] File: FiatTokenV2.sol</h2>\n<h3 id=\"function-initialize-1\" style=\"position:relative;\"><a href=\"#function-initialize-1\" aria-label=\"function initialize 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function initialize()</h3>\n<h4 id=\"use-tokenname-instead-of-name-1\" style=\"position:relative;\"><a href=\"#use-tokenname-instead-of-name-1\" aria-label=\"use tokenname instead of name 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Use <code>tokenName</code> instead of <code>name</code></h4>\n<p>This can save 2 SLOADs (around 200 gas).\nThe explanation is the same as <a href=\"#use-tokenname-instead-of-name\">Use <code>tokenName</code> instead of <code>name</code></a></p>\n<h3 id=\"function-mint-1\" style=\"position:relative;\"><a href=\"#function-mint-1\" aria-label=\"function mint 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function mint()</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"22\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">FiatTokenV2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">133</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">mint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_to</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">146:         </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">147:             </span><span class=\"mtk10\">_amount</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk10\">mintingAllowedAmount</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">153</span><span class=\"mtk1\">:         </span><span class=\"mtk10\">minterAllowed</span><span class=\"mtk1\">[</span><span class=\"mtk10\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk10\">sender</span><span class=\"mtk1\">] = </span><span class=\"mtk10\">mintingAllowedAmount</span><span class=\"mtk1\"> - </span><span class=\"mtk10\">_amount</span><span class=\"mtk1\">; </span><span class=\"mtk3\">//@audit should be unchecked (see L147)</span></span></span></code></pre>\n<h4 id=\"unchecked-block-l153\" style=\"position:relative;\"><a href=\"#unchecked-block-l153\" aria-label=\"unchecked block l153 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unchecked block L153</h4>\n<p>This line can’t underflow due to L147. Therefore, it should be wrapped in an <code>unchecked</code> block.</p>\n<h3 id=\"function-transferfrom-1\" style=\"position:relative;\"><a href=\"#function-transferfrom-1\" aria-label=\"function transferfrom 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function transferFrom()</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"23\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">FiatTokenV2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">266</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">transferFrom</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">280:         </span><span class=\"mtk10\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">281</span><span class=\"mtk1\">:             </span><span class=\"mtk10\">value</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk10\">allowed</span><span class=\"mtk1\">[</span><span class=\"mtk10\">from</span><span class=\"mtk1\">][</span><span class=\"mtk10\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk10\">sender</span><span class=\"mtk1\">],</span><span class=\"mtk3\">//@audit allowed[from][msg.sender] SLOAD 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">285</span><span class=\"mtk1\">:         </span><span class=\"mtk10\">allowed</span><span class=\"mtk1\">[</span><span class=\"mtk10\">from</span><span class=\"mtk1\">][</span><span class=\"mtk10\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk10\">sender</span><span class=\"mtk1\">] = </span><span class=\"mtk10\">allowed</span><span class=\"mtk1\">[</span><span class=\"mtk10\">from</span><span class=\"mtk1\">][</span><span class=\"mtk10\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk10\">sender</span><span class=\"mtk1\">] - </span><span class=\"mtk10\">value</span><span class=\"mtk1\">; </span><span class=\"mtk3\">//@audit should be unchecked (see L281) //@audit allowed[from][msg.sender] SLOAD 2</span></span></span></code></pre>\n<h4 id=\"unchecked-block-l285\" style=\"position:relative;\"><a href=\"#unchecked-block-l285\" aria-label=\"unchecked block l285 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unchecked block L285</h4>\n<p>This line can’t underflow due to L281. Therefore, it should be wrapped in an <code>unchecked</code> block.</p>\n<h4 id=\"cache-allowedfrommsgsender-1\" style=\"position:relative;\"><a href=\"#cache-allowedfrommsgsender-1\" aria-label=\"cache allowedfrommsgsender 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cache <code>allowed[from][msg.sender]</code></h4>\n<p>Caching this in memory can save around 1 SLOAD.</p>\n<h3 id=\"function-_transfer-1\" style=\"position:relative;\"><a href=\"#function-_transfer-1\" aria-label=\"function _transfer 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function _transfer()</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"24\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">FiatTokenV2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">314</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_transfer</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...   </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">321:         </span><span class=\"mtk10\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">322</span><span class=\"mtk1\">:             </span><span class=\"mtk10\">value</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk10\">balances</span><span class=\"mtk1\">[</span><span class=\"mtk10\">from</span><span class=\"mtk1\">],</span><span class=\"mtk3\">//@audit SLOAD 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">323</span><span class=\"mtk1\">:             </span><span class=\"mtk8\">&quot;ERC20: transfer amount exceeds balance&quot;</span><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">326</span><span class=\"mtk1\">:         </span><span class=\"mtk10\">balances</span><span class=\"mtk1\">[</span><span class=\"mtk10\">from</span><span class=\"mtk1\">] = </span><span class=\"mtk10\">balances</span><span class=\"mtk1\">[</span><span class=\"mtk10\">from</span><span class=\"mtk1\">] - </span><span class=\"mtk10\">value</span><span class=\"mtk1\">; </span><span class=\"mtk3\">//@audit should be unchecked (see L322) //@audit SLOAD 2</span></span></span></code></pre>\n<h4 id=\"unchecked-block-l326\" style=\"position:relative;\"><a href=\"#unchecked-block-l326\" aria-label=\"unchecked block l326 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unchecked block L326</h4>\n<p>This line can’t underflow due to L322. Therefore, it should be wrapped in an <code>unchecked</code> block.</p>\n<h4 id=\"cache-balancesfrom-1\" style=\"position:relative;\"><a href=\"#cache-balancesfrom-1\" aria-label=\"cache balancesfrom 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cache <code>balances[from]</code></h4>\n<p>Caching this in memory can save around 1 SLOAD.</p>\n<h3 id=\"function-burn-1\" style=\"position:relative;\"><a href=\"#function-burn-1\" aria-label=\"function burn 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function burn()</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"25\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">FiatTokenV2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">371</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">burn</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">379:         </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">balance</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;FiatToken: burn amount exceeds balance&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">382</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">balances</span><span class=\"mtk1\">[</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">balance</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">_amount</span><span class=\"mtk1\">; </span><span class=\"mtk3\">//@audit should be unchecked (see L379)</span></span></span></code></pre>\n<h4 id=\"unchecked-block-l382\" style=\"position:relative;\"><a href=\"#unchecked-block-l382\" aria-label=\"unchecked block l382 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unchecked block L382</h4>\n<p>This line can’t underflow due to L379. Therefore, it should be wrapped in an <code>unchecked</code> block.</p>\n<h3 id=\"function-updatemasterminter-1\" style=\"position:relative;\"><a href=\"#function-updatemasterminter-1\" aria-label=\"function updatemasterminter 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function updateMasterMinter()</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"26\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">FiatTokenV2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">387</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">updateMasterMinter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_newMasterMinter</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyOwner</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">388</span><span class=\"mtk1\">:         </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">389</span><span class=\"mtk1\">:             </span><span class=\"mtk12\">_newMasterMinter</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">390</span><span class=\"mtk1\">:             </span><span class=\"mtk8\">&quot;FiatToken: new masterMinter is the zero address&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">391</span><span class=\"mtk1\">:         );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">392</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">masterMinter</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_newMasterMinter</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">393</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MasterMinterChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">masterMinter</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">394</span><span class=\"mtk1\">:     }</span></span></span></code></pre>\n<h4 id=\"emitting-a-storage-value-masterminter-vs-_newmasterminter-1\" style=\"position:relative;\"><a href=\"#emitting-a-storage-value-masterminter-vs-_newmasterminter-1\" aria-label=\"emitting a storage value masterminter vs _newmasterminter 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Emitting a storage value (<code>masterMinter</code> vs <code>_newMasterMinter</code>)</h4>\n<p>I suggest going from</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"27\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">393</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MasterMinterChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">masterMinter</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>to</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"28\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">393</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">MasterMinterChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_newMasterMinter</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<h3 id=\"function-_decreaseallowance-1\" style=\"position:relative;\"><a href=\"#function-_decreaseallowance-1\" aria-label=\"function _decreaseallowance 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function _decreaseAllowance()</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"29\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">FiatTokenV2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">451</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_decreaseAllowance</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">452:         </span><span class=\"mtk10\">address</span><span class=\"mtk1\"> </span><span class=\"mtk10\">owner</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">453:         </span><span class=\"mtk10\">address</span><span class=\"mtk1\"> </span><span class=\"mtk10\">spender</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">454:         </span><span class=\"mtk10\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk10\">decrement</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">455</span><span class=\"mtk1\">:     ) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">456</span><span class=\"mtk1\">:         </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">457</span><span class=\"mtk1\">:             </span><span class=\"mtk12\">decrement</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk12\">allowed</span><span class=\"mtk1\">[</span><span class=\"mtk12\">owner</span><span class=\"mtk1\">][</span><span class=\"mtk12\">spender</span><span class=\"mtk1\">],</span><span class=\"mtk3\">//@audit SLOAD 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">458</span><span class=\"mtk1\">:             </span><span class=\"mtk8\">&quot;ERC20: decreased allowance below zero&quot;</span><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">459</span><span class=\"mtk1\">:         );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">460</span><span class=\"mtk1\">:         </span><span class=\"mtk11\">_approve</span><span class=\"mtk1\">(</span><span class=\"mtk12\">owner</span><span class=\"mtk1\">, </span><span class=\"mtk12\">spender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">allowed</span><span class=\"mtk1\">[</span><span class=\"mtk12\">owner</span><span class=\"mtk1\">][</span><span class=\"mtk12\">spender</span><span class=\"mtk1\">] - </span><span class=\"mtk12\">decrement</span><span class=\"mtk1\">); </span><span class=\"mtk3\">//@audit should be unchecked (see L457) //@audit SLOAD 2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">461</span><span class=\"mtk1\">:     }</span></span></span></code></pre>\n<h4 id=\"unchecked-block-l460\" style=\"position:relative;\"><a href=\"#unchecked-block-l460\" aria-label=\"unchecked block l460 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unchecked block L460</h4>\n<p>This line can’t underflow due to L457. Therefore, it should be wrapped in an <code>unchecked</code> block.</p>\n<h4 id=\"cache-allowedownerspender-1\" style=\"position:relative;\"><a href=\"#cache-allowedownerspender-1\" aria-label=\"cache allowedownerspender 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cache <code>allowed[owner][spender]</code></h4>\n<p>Caching this in memory can save around 1 SLOAD.</p>\n<h3 id=\"function-updatewhitelister\" style=\"position:relative;\"><a href=\"#function-updatewhitelister\" aria-label=\"function updatewhitelister permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function updateWhitelister()</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"30\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">FiatTokenV2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">659</span><span class=\"mtk1\">:     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">updateWhitelister</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_newWhitelister</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyOwner</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">660</span><span class=\"mtk1\">:         </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">661</span><span class=\"mtk1\">:             </span><span class=\"mtk12\">_newWhitelister</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">662</span><span class=\"mtk1\">:             </span><span class=\"mtk8\">&quot;Whitelistable: new whitelister is the zero address&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">663</span><span class=\"mtk1\">:         );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">664</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">whitelister</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_newWhitelister</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">665</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">WhitelisterChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">whitelister</span><span class=\"mtk1\">); </span><span class=\"mtk3\">//@audit emitting storage value</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">666</span><span class=\"mtk1\">:     }</span></span></span></code></pre>\n<h4 id=\"emitting-a-storage-value-whitelister-vs-_newwhitelister\" style=\"position:relative;\"><a href=\"#emitting-a-storage-value-whitelister-vs-_newwhitelister\" aria-label=\"emitting a storage value whitelister vs _newwhitelister permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Emitting a storage value (<code>whitelister</code> vs <code>_newWhitelister</code>)</h4>\n<p>I suggest going from</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"31\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">665</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">WhitelisterChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">whitelister</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p>to</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"32\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">665</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">WhitelisterChanged</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_newWhitelister</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<h2 id=\"g-07-general-recommendations\" style=\"position:relative;\"><a href=\"#g-07-general-recommendations\" aria-label=\"g 07 general recommendations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-07] General Recommendations</h2>\n<h3 id=\"variables\" style=\"position:relative;\"><a href=\"#variables\" aria-label=\"variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Variables</h3>\n<h4 id=\"no-need-to-explicitly-initialize-variables-with-default-values\" style=\"position:relative;\"><a href=\"#no-need-to-explicitly-initialize-variables-with-default-values\" aria-label=\"no need to explicitly initialize variables with default values permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>No need to explicitly initialize variables with default values</h4>\n<p>If a variable is not set/initialized, it is assumed to have the default value (<code>0</code> for <code>uint</code>, <code>false</code> for <code>bool</code>, <code>address(0)</code> for address…). Explicitly initializing it with its default value is an anti-pattern and wastes gas.</p>\n<p>As an example: <code>for (uint256 i = 0; i &#x3C; numIterations; ++i) {</code> should be replaced with <code>for (uint256 i; i &#x3C; numIterations; ++i) {</code></p>\n<p>Instances include:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"33\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">v1/FiatTokenV1.sol:58:    uint256 internal totalSupply_ = 0;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">v1/Pausable.sol:49:    bool public paused = false;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">v2/FiatTokenV2.sol:58:    uint256 internal totalSupply_ = 0;</span></span></code></pre>\n<p>I suggest removing explicit initializations for default values.</p>\n<h4 id=\"pre-increments-cost-less-gas-compared-to-post-increments\" style=\"position:relative;\"><a href=\"#pre-increments-cost-less-gas-compared-to-post-increments\" aria-label=\"pre increments cost less gas compared to post increments permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pre-increments cost less gas compared to post-increments</h4>\n<h3 id=\"comparisons\" style=\"position:relative;\"><a href=\"#comparisons\" aria-label=\"comparisons permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Comparisons</h3>\n<h4 id=\"-0-is-less-efficient-than--0-for-unsigned-integers-with-proof\" style=\"position:relative;\"><a href=\"#-0-is-less-efficient-than--0-for-unsigned-integers-with-proof\" aria-label=\" 0 is less efficient than  0 for unsigned integers with proof permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code>> 0</code> is less efficient than <code>!= 0</code> for unsigned integers (with proof)</h4>\n<p><code>!= 0</code> costs less gas compared to <code>> 0</code> for unsigned integers in <code>require</code> statements with the optimizer enabled (6 gas)</p>\n<p>Proof: While it may seem that <code>> 0</code> is cheaper than <code>!=</code>, this is only true without the optimizer enabled and outside a require statement. If you enable the optimizer at 10k AND you’re in a <code>require</code> statement, this will save gas. You can see this tweet for more proofs: <a href=\"https://twitter.com/gzeon/status/1485428085885640706\">https://twitter.com/gzeon/status/1485428085885640706</a></p>\n<p>I suggest changing <code>> 0</code> with <code>!= 0</code> here:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"34\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">v1/FiatTokenV1.sol:136:        require(_amount &gt; 0, &quot;FiatToken: mint amount not greater than 0&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">v1/FiatTokenV1.sol:368:        require(_amount &gt; 0, &quot;FiatToken: burn amount not greater than 0&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">v2/FiatTokenV2.sol:143:        require(_amount &gt; 0, &quot;FiatToken: mint amount not greater than 0&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">v2/FiatTokenV2.sol:378:        require(_amount &gt; 0, &quot;FiatToken: burn amount not greater than 0&quot;);</span></span></code></pre>\n<p>Also, please enable the Optimizer.</p>\n<h3 id=\"visibility\" style=\"position:relative;\"><a href=\"#visibility\" aria-label=\"visibility permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Visibility</h3>\n<h3 id=\"errors\" style=\"position:relative;\"><a href=\"#errors\" aria-label=\"errors permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Errors</h3>\n<h4 id=\"reduce-the-size-of-error-messages-long-revert-strings\" style=\"position:relative;\"><a href=\"#reduce-the-size-of-error-messages-long-revert-strings\" aria-label=\"reduce the size of error messages long revert strings permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reduce the size of error messages (Long revert Strings)</h4>\n<p>Shortening revert strings to fit in 32 bytes will decrease deployment time gas and will decrease runtime gas when the revert condition is met.</p>\n<p>Revert strings that are longer than 32 bytes require at least one additional mstore, along with additional overhead for computing memory offset, etc.</p>\n<p>For strings > 32 bytes, see <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/27\">issue page</a> for details.</p>\n<p>I suggest shortening the revert strings to fit in 32 bytes, or that using custom errors as described next.</p>\n<h4 id=\"use-custom-errors-instead-of-revert-strings-to-save-gas\" style=\"position:relative;\"><a href=\"#use-custom-errors-instead-of-revert-strings-to-save-gas\" aria-label=\"use custom errors instead of revert strings to save gas permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Use Custom Errors instead of Revert Strings to save Gas</h4>\n<p>Custom errors from Solidity 0.8.4 are cheaper than revert strings (cheaper deployment cost and runtime cost when the revert condition is met)</p>\n<p>Source: <a href=\"https://blog.soliditylang.org/2021/04/21/custom-errors/\">https://blog.soliditylang.org/2021/04/21/custom-errors/</a>:</p>\n<blockquote>\n<p>Starting from <a href=\"https://github.com/ethereum/solidity/releases/tag/v0.8.4\">Solidity v0.8.4</a>, there is a convenient and gas-efficient way to explain to users why an operation failed through the use of custom errors. Until now, you could already use strings to give more information about failures (e.g., <code>revert(\"Insufficient funds.\");</code>), but they are rather expensive, especially when it comes to deploy cost, and it is difficult to use dynamic information in them.</p>\n</blockquote>\n<p>Custom errors are defined using the <code>error</code> statement, which can be used inside and outside of contracts (including interfaces and libraries).</p>\n<p>For instances included, see <a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/27\">issue page</a> for details.</p>\n<p>I suggest replacing revert strings with custom errors.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/27#issuecomment-1056169854\">thurendous (JPYC) commented</a>:</strong></p>\n<blockquote>\n<blockquote>\n<p>function _implementation()<br>\nFile: UUPSUpgradeable.sol</p>\n</blockquote>\n<p>We used OpenZeppelin’s library and it is like this. Should we change this? </p>\n<blockquote>\n<p>File: Blocklistable.sol<br>\nEmitting a storage value (blocklister vs _newBlocklister)</p>\n</blockquote>\n<p>We will fix this. </p>\n<blockquote>\n<p>File: EIP3009.sol<br>\nNon-strict inequalities are cheaper than strict ones (1)</p>\n</blockquote>\n<p>We are not sure about this. Is this true? </p>\n<blockquote>\n<p>File: FiatTokenV1.sol<br>\nfunction initialize()</p>\n</blockquote>\n<p>This can be true. But the initialize function is rarely called. We keep it this way.</p>\n<blockquote>\n<p>File: FiatTokenV1.sol<br>\nFile: FiatTokenV2.sol<br>\nUnchecked block L146<br>\nUnchecked block L276<br>\nUnchecked block L316<br>\nUnchecked block L372<br>\nUnchecked block L449<br>\nCache allowed[from][msg.sender]<br>\nCache balances[from]</p>\n</blockquote>\n<p>We maybe will fix this after checking in detail. </p>\n<blockquote>\n<p>function updateMasterMinter()<br>\nEmitting a storage value (masterMinter vs _newMasterMinter)</p>\n</blockquote>\n<p>We will fix this. </p>\n<blockquote>\n<p>0 is less efficient than != 0 for unsigned integers (with proof)</p>\n</blockquote>\n<p>Thank you for the proof. </p>\n<blockquote>\n<p>Reduce the size of error messages (Long revert Strings)</p>\n</blockquote>\n<p>We maybe will fix this after checking in detail. Do you suggest do this strongly? </p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-02-jpyc-findings/issues/27#issuecomment-1081349224\">thurendous (JPYC) resolved and commented</a>:</strong></p>\n<blockquote>\n<blockquote>\n<p>No need to explicitly initialize variables with default values<br>\nCache allowedfrom<br>\nCache allowed[from][msg.sender]<br>\nCache balances[from]<br>\nCache allowed[owner][spender]<br></p>\n</blockquote>\n<p>Above issues were fixed and thanks!</p>\n<p>Final change can be viewed <a href=\"https://github.com/jcam1/JPYCv2/commit/63373b0dc20fca9581333583ab945d1e8269e654\">here</a>.</p>\n</blockquote>\n<hr>\n<h1 id=\"disclosures\" style=\"position:relative;\"><a href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Disclosures</h1>\n<p>C4 is an open organization governed by participants in the community.</p>\n<p>C4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.</p>\n<p>C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk10 { color: #4EC9B0; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>",
  "toc": "<ul>\n<li>\n<p><a href=\"#overview\">Overview</a></p>\n<ul>\n<li><a href=\"#about-c4\">About C4</a></li>\n<li><a href=\"#wardens\">Wardens</a></li>\n</ul>\n</li>\n<li><a href=\"#summary\">Summary</a></li>\n<li><a href=\"#scope\">Scope</a></li>\n<li><a href=\"#severity-criteria\">Severity Criteria</a></li>\n<li>\n<p><a href=\"#low-risk-and-non-critical-issues\">Low Risk and Non-Critical Issues</a></p>\n<ul>\n<li><a href=\"#codebase-impressions--summary\">Codebase Impressions &#x26; Summary</a></li>\n<li><a href=\"#l-01-add-constructor-initializer-in-implementation-contracts\">L-01 Add constructor initializer in implementation contracts</a></li>\n<li><a href=\"#l-02-use-oz-upgrades-hardhat-plugin-to-handle-proxy-deployments-and-upgrades\">L-02 Use OZ upgrades (hardhat) plugin to handle proxy deployments and upgrades</a></li>\n<li><a href=\"#l-03-contracts-are-not-using-their-oz-upgradeable-counterparts\">L-03 Contracts are not using their OZ upgradeable counterparts</a></li>\n<li><a href=\"#l-04-fiattokenv1--v2-remove-whennotpaused-modifier-from-cancelauthorization-and-decreaseallowance-functions\">L-04 FiatTokenV1 / V2: Remove <code>whenNotPaused</code> modifier from <code>cancelAuthorization()</code> and <code>decreaseAllowance()</code> functions</a></li>\n<li><a href=\"#l-05-fiattokenv2-whitelist-should-be-unusable-if-contract-is-paused\">L-05 FiatTokenV2: <code>whitelist()</code> should be unusable if contract is paused</a></li>\n<li><a href=\"#l-06-incorrect-versioning-of-fiattokenv2\">L-06 Incorrect versioning of <code>FiatTokenV2</code></a></li>\n<li><a href=\"#n-01-bump-oz-packages-to-450\">N-01 Bump OZ packages to <code>^4.5.0</code>.</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#gas-optimizations\">Gas Optimizations</a></p>\n<ul>\n<li><a href=\"#foreword\">Foreword</a></li>\n<li><a href=\"#g-01-file-erc1967proxysol\">G-01 File: ERC1967Proxy.sol</a></li>\n<li><a href=\"#g-02-file-uupsupgradeablesol\">G-02 File: UUPSUpgradeable.sol</a></li>\n<li><a href=\"#g-03-file-blocklistablesol\">G-03 File: Blocklistable.sol</a></li>\n<li><a href=\"#g-04-file-eip3009sol\">G-04 File: EIP3009.sol</a></li>\n<li><a href=\"#g-05-file-fiattokenv1sol\">G-05 File: FiatTokenV1.sol</a></li>\n<li><a href=\"#g-06-file-fiattokenv2sol\">G-06 File: FiatTokenV2.sol</a></li>\n<li><a href=\"#g-07-general-recommendations\">G-07 General Recommendations</a></li>\n</ul>\n</li>\n<li><a href=\"#disclosures\">Disclosures</a></li>\n</ul>",
  "md": "\n# Overview\n\n## About C4\n\nCode4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.\n\nA C4 audit contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.\n\nDuring the audit contest outlined in this document, C4 conducted an analysis of the JPYC smart contract system written in Solidity. The audit contest took place between February 24—February 26 2022.\n\n## Wardens\n\n28 Wardens contributed reports to the JPYC contest:\n\n  1. [hickuphh3](https://twitter.com/HickupH)\n  1. [leastwood](https://twitter.com/liam_eastwood13)\n  1. [defsec](https://twitter.com/defsec_)\n  1. [cmichel](https://twitter.com/cmichelio)\n  1. TerrierLover\n  1. kyliek\n  1. [gzeon](https://twitter.com/gzeon)\n  1. [Dravee](https://twitter.com/JustDravee)\n  1. IllIllI\n  1. peritoflores\n  1. kenta\n  1. robee\n  1. [csanuragjain](https://twitter.com/csanuragjain)\n  1. 0xwags\n  1. [Rhynorater](https://twitter.com/rhynorater)\n  1. [securerodd](https://twitter.com/securerodd)\n  1. 0x1f8b\n  1. [Omik](https://twitter.com/omikomikomik)\n  1. minhquanym\n  1. pedroais\n  1. [Ruhum](https://twitter.com/0xruhum)\n  1. jayjonah8\n  1. cccz\n  1. [kirk-baird](https://twitter.com/kirkthebaird)\n  1. [ye0lde](https://twitter.com/_ye0lde)\n  1. [rfa](https://www.instagram.com/riyan_rfa/)\n  1. sorrynotsorry\n  1. [Tomio](https://twitter.com/meidhiwirara)\n\nThis contest was judged by [Jack the Pug](https://github.com/jack-the-pug).\n\nFinal report assembled by [liveactionllama](https://twitter.com/liveactionllama).\n\n# Summary\n\nThe C4 analysis included reports from 24 wardens detailing recommendations that fall under the risk rating of LOW severity or non-critical. There were also reports from 17 wardens describing gas optimizations. All of the submissions presented here are linked back to their original reports.\n\nNotably, 0 vulnerabilities were found during this audit contest that received a risk rating in the category of HIGH or MEDIUM severity.\n\n# Scope\n\nThe code under review can be found within the [C4 JPYC contest repository](https://github.com/code-423n4/2022-02-jpyc), and is composed of 23 smart contracts written in the Solidity programming language and includes 1552 lines of Solidity code.\n\n# Severity Criteria\n\nC4 assesses the severity of disclosed vulnerabilities according to a methodology based on [OWASP standards](https://owasp.org/www-community/OWASP_Risk_Rating_Methodology).\n\nVulnerabilities are divided into three primary risk categories: high, medium, and low.\n\nHigh-level considerations for vulnerabilities span the following key areas when conducting assessments:\n\n- Malicious Input Handling\n- Escalation of privileges\n- Arithmetic\n- Gas use\n\nFurther information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on [the C4 website](https://code423n4.com).\n\n\n\n# Low Risk and Non-Critical Issues\n\nFor this contest, 24 wardens submitted reports detailing low risk and non-critical issues. The [report highlighted below](https://github.com/code-423n4/2022-02-jpyc-findings/issues/35) by warden **hickuphh3** received the top score from the judge.\n\n_The following wardens also submitted reports: [leastwood](https://github.com/code-423n4/2022-02-jpyc-findings/issues/16), [defsec](https://github.com/code-423n4/2022-02-jpyc-findings/issues/47), [cmichel](https://github.com/code-423n4/2022-02-jpyc-findings/issues/34), [TerrierLover](https://github.com/code-423n4/2022-02-jpyc-findings/issues/52), [kyliek](https://github.com/code-423n4/2022-02-jpyc-findings/issues/24), [gzeon](https://github.com/code-423n4/2022-02-jpyc-findings/issues/39), [peritoflores](https://github.com/code-423n4/2022-02-jpyc-findings/issues/44), [IllIllI](https://github.com/code-423n4/2022-02-jpyc-findings/issues/19), [Dravee](https://github.com/code-423n4/2022-02-jpyc-findings/issues/26), [robee](https://github.com/code-423n4/2022-02-jpyc-findings/issues/3), [csanuragjain](https://github.com/code-423n4/2022-02-jpyc-findings/issues/8), [0xwags](https://github.com/code-423n4/2022-02-jpyc-findings/issues/41), [Rhynorater](https://github.com/code-423n4/2022-02-jpyc-findings/issues/62), [minhquanym](https://github.com/code-423n4/2022-02-jpyc-findings/issues/10), [securerodd](https://github.com/code-423n4/2022-02-jpyc-findings/issues/31), [Ruhum](https://github.com/code-423n4/2022-02-jpyc-findings/issues/25), [kenta](https://github.com/code-423n4/2022-02-jpyc-findings/issues/15), [0x1f8b](https://github.com/code-423n4/2022-02-jpyc-findings/issues/30), [jayjonah8](https://github.com/code-423n4/2022-02-jpyc-findings/issues/18), [Omik](https://github.com/code-423n4/2022-02-jpyc-findings/issues/58), [cccz](https://github.com/code-423n4/2022-02-jpyc-findings/issues/5), [kirk-baird](https://github.com/code-423n4/2022-02-jpyc-findings/issues/1), and [pedroais](https://github.com/code-423n4/2022-02-jpyc-findings/issues/56)._\n\n## Codebase Impressions & Summary\n\nOverall, code quality for the JPYC contracts is very high. Supporting documentation provided adequate information on design choices made, such as why the UUPS proxy was chosen over the transparent proxy pattern.\n\nThe test suite could be easily run, and are rather comprehensive. One thing that stood out and that I’m impressed with was a [test checklist](https://github.com/code-423n4/2022-02-jpyc/blob/main/test/README.md). すばらしい! Test coverage was close to 100% with the following functions / branches missed (not significant IMO):\n\n*   [else case in `EIP712Domain._domainSeparatorV4()`](https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v1/EIP712Domain.sol#L45)\n*   [upgrading of FiatTokenV2](https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L596-L600)\n\nI could be mistaken, but I would like to mention that while the coverage tool highlights that [zero inputs for FiatTokenV2’s initializer](https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L85-L100) weren’t tested, they actually are in the [FiatTokenV2\\_proxy test file](https://github.com/code-423n4/2022-02-jpyc/blob/main/test/v2\\_proxy/FiatTokenV2\\_proxy.test.js#L316-L324).\n\nThe findings I made revolved around the upgradeability aspect of the contracts. I also made recommendations on adding / removing functionality when the contract is paused.\n\n## [L-01] Add constructor initializer in implementation contracts\n\n### Description\n\nAs per [OpenZeppelin’s (OZ) recommendation](https://forum.openzeppelin.com/t/uupsupgradeable-vulnerability-post-mortem/15680/6), “The guidelines are now to make it impossible for *anyone* to run `initialize` on an implementation contract, by adding an empty constructor with the `initializer` modifier. So the implementation contract gets initialized automatically upon deployment.”\n\nNote that this behaviour is also incorporated the [OZ Wizard](https://wizard.openzeppelin.com/) since the UUPS vulnerability discovery: “Additionally, we modified the code generated by the [Wizard 19](https://wizard.openzeppelin.com/) to include a constructor that automatically initializes the implementation when deployed.”\n\nFurthermore, **this thwarts any attempts to frontrun the [initialization tx of the implementation contract](https://github.com/code-423n4/2022-02-jpyc/blob/main/test/v2\\_proxy/FiatTokenV2\\_proxy.test.js#L79-L89)**.\n\nIncorporating this change would require inheriting the `Initializable` contract instead of having an explicit `initialized` variable.\n\n### Recommended Mitigation Steps\n\n`FiatTokenV1`, `FiatTokenV2` and subsequent implementation contracts should inherit OZ’s `Initializable` contract and have the following constructor method:\n\n```solidity\nimport \"@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol\";\n\n// TODO: remove bool internal initialized;\n// TODO: remove initialized = true;\ncontract FiatTokenV1 is \n\tInitializable\n\t...\n{\n\t...\n\t/// @custom:oz-upgrades-unsafe-allow constructor\n\tconstructor() initializer {\n\t\t// so that users won't accidentally send JPYC to the implementation contract\n\t\tblocklisted[address(this)] = true;\n\t}\n}\n```\n\n## [L-02] Use OZ upgrades (hardhat) plugin to handle proxy deployments and upgrades\n\n### Description\n\nThe project manually deploys and manages their own proxy contract and upgrades. I strongly recommend that the team use the upgrades plugin from OpenZeppelin instead, because it provides an important feature of validating that the incoming implementations are upgrade safe.\n\nI note that the plugin is part of [`package.json`](https://github.com/code-423n4/2022-02-jpyc/blob/main/package.json#L14) and was imported into [hardhat config](https://github.com/code-423n4/2022-02-jpyc/blob/main/hardhat.config.js#L7) file, but am puzzled why it wasn’t used (at least in tests).\n\n### Recommended Mitigation Steps\n\nStrongly consider using the [OZ upgrades plugin](https://github.com/OpenZeppelin/openzeppelin-upgrades) to manage deployments. More information about its usage can be found in [their documentation](https://docs.openzeppelin.com/upgrades-plugins/1.x/) and [UUPS Proxy](https://forum.openzeppelin.com/t/uups-proxies-tutorial-solidity-javascript/7786) guide.\n\nAn example is provided below:\n\n```jsx\nconst { ethers, upgrades } = require(\"hardhat\");\n\ncontract('TestDeploymentAndUpgrade', async function (accounts) {\n  const minter = accounts[6];\n  const masterMinter = accounts[3];\n  const pauser = accounts[4];\n  const blocklister = accounts[5];\n\n  it('should do deployment and upgrades', async () => {\n    // Deploying\n    const FiatTokenV1 = await ethers.getContractFactory(\"FiatTokenV1\");\n    const instance = await upgrades.deployProxy(FiatTokenV1, [\n      'JPY Coin',\n      'JPYC',\n      'JPY',\n      18,\n      masterMinter,\n      pauser,\n      blocklister,\n      minter\n      ],\n      { kind: 'uups' });\n      await instance.deployed();\n\t\n      // Upgrading\n      const FiatTokenV2 = await ethers.getContractFactory(\"FiatTokenV2\");\n      const upgraded = await upgrades.upgradeProxy(instance.address, FiatTokenV2);\n    });\n});\n```\n\n## [L-03] Contracts are not using their OZ upgradeable counterparts\n\n### Tools Used\n\nDiffchecker\n\n### Description\n\nThe non-upgradeable standard version of OpenZeppelin’s library, such as `Ownable`, `Pausable`, `Address`, `Context`, `SafeERC20`, `ERC1967Upgrade` etc, are inherited / used by both the proxy and the implementation contracts.\n\nAs a result, when attempting to use the upgrades plugin mentioned, the following errors are raised:\n\n```solidity\nError: Contract `FiatTokenV1` is not upgrade safe\n\ncontracts/v1/FiatTokenV1.sol:58: Variable `totalSupply_` is assigned an initial value\n  Move the assignment to the initializer\n  https://zpl.in/upgrades/error-004\n\ncontracts/v1/Pausable.sol:49: Variable `paused` is assigned an initial value\n  Move the assignment to the initializer\n  https://zpl.in/upgrades/error-004\n\ncontracts/v1/Ownable.sol:28: Contract `Ownable` has a constructor\n  Define an initializer instead\n  https://zpl.in/upgrades/error-001\n\ncontracts/util/Address.sol:186: Use of delegatecall is not allowed\n  https://zpl.in/upgrades/error-002\n```\n\nHaving reviewed these errors, none had any adversarial impact:\n\n*   `totalSupply_` and `paused` are explictly assigned the default values `0` and `false`\n*   the implementation contracts utilises the internal `_transferOwnership()` in the initializer, thus transferring ownership to `newOwner` regardless of who the current owner is\n*   `Address`'s `delegatecall` is only used by the `ERC1967Upgrade` contract. Comparing both the `Address` and `ERC1967Upgrade` contracts against their upgradeable counterparts show similar behaviour (differences are some refactoring done to shift the delegatecall into the `ERC1967Upgrade` contract).\n\nNevertheless, it would be safer to use the upgradeable versions of the library contracts to avoid unexpected behaviour.\n\n### Recommended Mitigation Steps\n\nWhere applicable, use the contracts from `@openzeppelin/contracts-upgradeable` instead of `@openzeppelin/contracts`.\n\n## [L-04] FiatTokenV1 / V2: Remove `whenNotPaused` modifier from `cancelAuthorization()` and `decreaseAllowance()` functions\n\n### Line References\n\n<https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v1/FiatTokenV1.sol#L409-L414>\n\n<https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v1/FiatTokenV1.sol#L535-L541>\n\n<https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L420-L425>\n\n<https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L558-L564>\n\n### Description\n\nJust like how `removeMinter()` doesn’t have the `whenNotPaused` modifier, it would be very beneficial useful (eg. when a hack / rug pull occurs) to allow users to revoke allowances and cancel authorizations whilst having transfers paused.\n\n### Recommended Mitigation Steps\n\nRemove the `whenNotPaused` modifiers for the `cancelAuthorization()` and `decreaseAllowance()` functions.\n\n## [L-05] FiatTokenV2: `whitelist()` should be unusable if contract is paused\n\n### Line References\n\n<https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L645>\n\n### Description\n\nShould the contract be paused, it would be safer to prevent additional addresses from being whitelisted.\n\n### Recommended Mitigation Steps\n\nAdd the `whenNotPaused` modifier for the `whitelist()` function.\n\n## [L-06] Incorrect versioning of `FiatTokenV2`\n\n### Line References\n\n<https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L111>\n\n<https://github.com/code-423n4/2022-02-jpyc/blob/main/contracts/v2/FiatTokenV2.sol#L114>\n\n### Description\n\nSince V2 is an upgrade of V1, its versioning should be updated to reflect the upgrade as well. It is important for the correct version to be reflected since it also part of the EIP712 data to be signed, which is used by EIP2612 and EIP3009 for fungible asset transfer authorizations. Authorizations given for outdated versions should rightfully be made invalid.\n\n#### Recommended Mitigation Steps\n\n```jsx\nDOMAIN_SEPARATOR = EIP712.makeDomainSeparator(name, \"2\");\nVERSION = \"2\";\n```\n\n## [N-01] Bump OZ packages to `^4.5.0`.\n\n### Line Reference\n\n<https://github.com/code-423n4/2022-02-jpyc#about-soliditys-version>\n\n<https://github.com/OpenZeppelin/openzeppelin-contracts/commit/e192fac2769386b7d4b61a3541073ab47bb7723a>\n\n### Description\n\nThe section referenced referred to a change in the `UUPSUpgradeable` and `ERC1967Upgrade` contracts that are only included in the latest package version of the OZ npm packages . However, the version specified in `package-lock.json` is `4.4.1`, which does **not** include this change (and hence I assume was manually imported).\n\nI can verify that the installed version is `4.4.1` by executing the following commands:\n\n```jsx\nyarn install\nyarn list @openzeppelin/contracts\n```\n\n### Recommended Mitigation Steps\n\nUpdate the versions of `@openzeppelin/contracts` and `@openzeppelin/contracts-upgradeable` to be the latest in `package.json`. I also recommend double checking the versions of other dependencies as a precaution, as they may include important bug fixes.\n\n**[0xywzx (JPYC) commented](https://github.com/code-423n4/2022-02-jpyc-findings/issues/35#issuecomment-1055101096):**\n > Thank you for your report. It is very helpful. ありがとうございます！\n> \n> #### L01\n> Your solution looks good.\n> We will change the code to use initializable for constructor.\n> \n> #### L02\n> Since we don't use the hardhat plugin in the actual deployment, we didn't use it in the test code.\n> By the way, if you know how to deploy in a secure way, I would appreciate it if you could us me know.\n> \n> #### L03\n> We have compliant USDC, so the code is looks like.\n> However, 'functionDelegateCall()' was deleted from OZ upgradable contract, so we will check it.\n> \n> #### L04\n> We didn't include 'whenNotPaused()' for whitelist because it doesn't have a significant impact on the contract itself.\n> \n> #### L5 & L6\n> We agree with your advice.\n> \n\n**[thurendous (JPYC) resolved and commented](https://github.com/code-423n4/2022-02-jpyc-findings/issues/35#issuecomment-1081346666):**\n > > Incorrect versioning of FiatTokenV2\n> \n> Fixed and thanks!\n> \n> The change can be viewed [here](https://github.com/jcam1/JPYCv2/commit/63373b0dc20fca9581333583ab945d1e8269e654).\n\n\n\n***\n\n\n\n# Gas Optimizations\n\nFor this contest, 17 wardens submitted reports detailing gas optimizations. The [report highlighted below](https://github.com/code-423n4/2022-02-jpyc-findings/issues/27) by warden **Dravee** received the top score from the judge.\n\n_The following wardens also submitted reports: [kenta](https://github.com/code-423n4/2022-02-jpyc-findings/issues/17), [IllIllI](https://github.com/code-423n4/2022-02-jpyc-findings/issues/20), [ye0lde](https://github.com/code-423n4/2022-02-jpyc-findings/issues/28), [defsec](https://github.com/code-423n4/2022-02-jpyc-findings/issues/55), [gzeon](https://github.com/code-423n4/2022-02-jpyc-findings/issues/40), [robee](https://github.com/code-423n4/2022-02-jpyc-findings/issues/2), [Omik](https://github.com/code-423n4/2022-02-jpyc-findings/issues/57), [securerodd](https://github.com/code-423n4/2022-02-jpyc-findings/issues/32), [TerrierLover](https://github.com/code-423n4/2022-02-jpyc-findings/issues/51), [pedroais](https://github.com/code-423n4/2022-02-jpyc-findings/issues/61), [rfa](https://github.com/code-423n4/2022-02-jpyc-findings/issues/49), [sorrynotsorry](https://github.com/code-423n4/2022-02-jpyc-findings/issues/36), [0x1f8b](https://github.com/code-423n4/2022-02-jpyc-findings/issues/29), [peritoflores](https://github.com/code-423n4/2022-02-jpyc-findings/issues/45), [Rhynorater](https://github.com/code-423n4/2022-02-jpyc-findings/issues/60), and [Tomio](https://github.com/code-423n4/2022-02-jpyc-findings/issues/38)._\n\n## Foreword\n\n*   **Storage-reading optimizations**\n\n> The code can be optimized by minimising the number of SLOADs. SLOADs are expensive (100 gas) compared to MLOADs/MSTOREs (3 gas). In the paragraphs below, please see the `@audit-issue` tags in the pieces of code's comments for more information about SLOADs that could be saved by caching the mentioned **storage** variables in **memory** variables.\n\n*   **Unchecking arithmetics operations that can't underflow/overflow**\n\n> Solidity version 0.8+ comes with implicit overflow and underflow checks on unsigned integers. When an overflow or an underflow isn't possible (as an example, when a comparison is made before the arithmetic operation, or the operation doesn't depend on user input), some gas can be saved by using an `unchecked` block: <https://docs.soliditylang.org/en/v0.8.10/control-structures.html#checked-or-unchecked-arithmetic>\n\n*   **`@audit` tags**\n\n> The code is annotated at multiple places with `//@audit` comments to pinpoint the issues. Please, pay attention to them for more details.\n\n## [G-01] File: ERC1967Proxy.sol\n\n### function \\_implementation()\n```solidity\nFile: ERC1967Proxy.sol\n30:     function _implementation() internal view virtual override returns (address impl) {\n31:         return ERC1967Upgrade._getImplementation(); //@audit unused named returns\n32:     }\n```\n\n#### Using both named returns and a return statement isn't necessary\n\nRemoving unused named returns variables can reduce gas usage (MSTOREs/MLOADs) and improve code clarity. To save gas and improve code quality: consider using only one of those.\n\n## [G-02] File: UUPSUpgradeable.sol\n\n### function upgradeToAndCall()\n```solidity\nFile: UUPSUpgradeable.sol\n095:     function upgradeToAndCall(address newImplementation, bytes memory data) //@audit can be calldata\n096:         external\n097:         payable\n098:         virtual\n099:         onlyProxy\n100:     {\n101:         _authorizeUpgrade(newImplementation);\n102:         _upgradeToAndCallUUPS(newImplementation, data, true);\n103:     }\n```\n\n### Use `calldata` instead of `memory` for external functions where the function argument is read-only\n\nHere, `bytes memory data` should be `bytes calldata data`\n\n## [G-03] File: Blocklistable.sol\n\n### function updateBlocklister()\n```solidity\nFile: Blocklistable.sol\n90:     function updateBlocklister(address _newBlocklister) external onlyOwner {\n91:         require(\n92:             _newBlocklister != address(0),\n93:             \"Blocklistable: new blocklister is the zero address\"\n94:         );\n95:         blocklister = _newBlocklister;\n96:         emit BlocklisterChanged(blocklister); //@audit emitting storage value\n97:     }\n```\n\n#### Emitting a storage value (`blocklister` vs `_newBlocklister`)\n\nI suggest going from\n```solidity\n96:         emit BlocklisterChanged(blocklister);\n```\n\nto\n```solidity\n96:         emit BlocklisterChanged(_newBlocklister);\n```\n## [G-04] File: EIP3009.sol\n\n### function \\_requireValidAuthorization()\n```solidity\nFile: EIP3009.sol\n219:     function _requireValidAuthorization(\n220:         address authorizer,\n221:         bytes32 nonce,\n222:         uint256 validAfter,\n223:         uint256 validBefore\n224:     ) private view {\n225:         require(\n226:             block.timestamp > validAfter, //@audit make it inclusive\n227:             \"FEIP3009: authorization is not yet valid\"\n228:         );\n229:         require(\n230:             block.timestamp < validBefore,//@audit make it inclusive\n231:             \"EIP3009: authorization is expired\"\n232:         );\n233:         _requireUnusedAuthorization(authorizer, nonce);\n234:     }\n```\n#### Non-strict inequalities are cheaper than strict ones (1)\n\nIt's possible to save 3 gas on `block.timestamp > validAfter` by making it inclusive: `block.timestamp >= validAfter`. I believe it wouldn't change much functionally here.\n\n#### Non-strict inequalities are cheaper than strict ones (2)\n\nIt's possible to save 3 gas on `block.timestamp < validBefore` by making it inclusive: `block.timestamp <= validBefore`. I believe it wouldn't change much functionally here.\n\n## [G-05] File: FiatTokenV1.sol\n\n### function initialize()\n\n#### Use `tokenName` instead of `name`\n\nThis can save 2 SLOADs (around 200 gas).\nReplace:\n```solidity\nFile: FiatTokenV1.sol\n96:         name = tokenName;\n...\n105:         DOMAIN_SEPARATOR = EIP712.makeDomainSeparator(name, \"1\"); //@audit name SLOAD \n106:         CHAIN_ID = block.chainid;\n107:         NAME = name;//@audit name SLOAD\n```\n\nwith\n```solidity\n105:         DOMAIN_SEPARATOR = EIP712.makeDomainSeparator(tokenName, \"1\"); //@audit tokenName MLOAD \n...\n107:         NAME = tokenName;//@audit tokenName MLOAD\n```\n\nAdditionally, `EIP712.makeDomainSeparator()` signature is as such:\n```solidity\nFile: EIP712.sol\n40:     function makeDomainSeparator(string memory name, string memory version)\n```\n\nAs the first argument is a `memory` and not a `storage`, passing the storage `name` instead of the memory `tokenName` would imply another copy in memory\n\n### function mint()\n\n```solidity\nFile: FiatTokenV1.sol\n127:     function mint(address _to, uint256 _amount)\n...\n139:         require(\n140:             _amount <= mintingAllowedAmount,\n...\n146:         minterAllowed[msg.sender] = mintingAllowedAmount - _amount;//@audit should be unchecked (see L140)\n\n```\n\n#### Unchecked block L146\n\nThis line can't underflow due to L140. Therefore, it should be wrapped in an `unchecked` block.\n\n### function transferFrom()\n```solidity\nFile: FiatTokenV1.sol\n258:     function transferFrom(\n...\n271:         require(\n272:             value <= allowed[from][msg.sender], //@audit allowed[from][msg.sender] SLOAD 1\n273:             \"ERC20: transfer amount exceeds allowance\"\n274:         );\n275:         _transfer(from, to, value);\n276:         allowed[from][msg.sender] = allowed[from][msg.sender] - value; //@audit should be unchecked (see L272) //@audit allowed[from][msg.sender] SLOAD 2\n```\n\n#### Unchecked block L276\n\nThis line can't underflow due to L272. Therefore, it should be wrapped in an `unchecked` block.\n\n#### Cache `allowed[from][msg.sender]`\n\nCaching this in memory can save around 1 SLOAD.\nThis is similar to an already implemented optimization in `L361: function burn()` for `uint256 balance = balances[msg.sender]`\n\n### function \\_transfer()\n```solidity\nFile: FiatTokenV1.sol\n304:     function _transfer(\n...\n311:         require(\n312:             value <= balances[from],//@audit SLOAD 1\n313:             \"ERC20: transfer amount exceeds balance\"\n314:         );\n315: \n316:         balances[from] = balances[from] - value; //@audit should be unchecked (see L312) //@audit SLOAD 2\n317:         balances[to] = balances[to] + value;\n```\n\n#### Unchecked block L316\n\nThis line can't underflow due to L312. Therefore, it should be wrapped in an `unchecked` block.\n\n#### Cache `balances[from]`\n\nCaching this in memory can save around 1 SLOAD.\nThis is similar to an already implemented optimization in `L361: function burn()` for `uint256 balance = balances[msg.sender]`\n\n### function burn()\n```solidity\nFile: FiatTokenV1.sol\n361:     function burn(uint256 _amount)\n...\n369:         require(balance >= _amount, \"FiatToken: burn amount exceeds balance\");\n370: \n371:         totalSupply_ = totalSupply_ - _amount;\n372:         balances[msg.sender] = balance - _amount; //@audit should be unchecked (see L369)\n```\n#### Unchecked block L372\n\nThis line can't underflow due to L369. Therefore, it should be wrapped in an `unchecked` block.\n\n### function updateMasterMinter()\n```solidity\nFile: FiatTokenV1.sol\n377:     function updateMasterMinter(address _newMasterMinter) external onlyOwner {\n378:         require(\n379:             _newMasterMinter != address(0),\n380:             \"FiatToken: new masterMinter is the zero address\"\n381:         );\n382:         masterMinter = _newMasterMinter;\n383:         emit MasterMinterChanged(masterMinter); //@audit emitting storage value\n384:     }\n```\n#### Emitting a storage value (`masterMinter` vs `_newMasterMinter`)\n\nI suggest going from\n```solidity\n383:         emit MasterMinterChanged(masterMinter);\n```\nto\n```solidity\n383:         emit MasterMinterChanged(_newMasterMinter);\n```\n### function \\_decreaseAllowance()\n```solidity\nFile: FiatTokenV1.sol\n440:     function _decreaseAllowance(\n...\n445:         require(\n446:             decrement <= allowed[owner][spender],//@audit SLOAD 1\n447:             \"ERC20: decreased allowance below zero\"\n448:         );\n449:         _approve(owner, spender, allowed[owner][spender] - decrement); //@audit should be unchecked (see L446) //@audit SLOAD 2\n450:     }\n```\n\n#### Unchecked block L449\n\nThis line can't underflow due to L446. Therefore, it should be wrapped in an `unchecked` block.\n\n#### Cache `allowed[owner][spender]`\n\nCaching this in memory can save around 1 SLOAD.\nThis is similar to an already implemented optimization in `L361: function burn()` for `uint256 balance = balances[msg.sender]`\n\n## [G-06] File: FiatTokenV2.sol\n\n### function initialize()\n\n#### Use `tokenName` instead of `name`\n\nThis can save 2 SLOADs (around 200 gas).\nThe explanation is the same as [Use `tokenName` instead of `name`](#use-tokenname-instead-of-name)\n\n### function mint()\n```solidity\nFile: FiatTokenV2.sol\n133:     function mint(address _to, uint256 _amount)\n...\n146:         require(\n147:             _amount <= mintingAllowedAmount,\n...\n153:         minterAllowed[msg.sender] = mintingAllowedAmount - _amount; //@audit should be unchecked (see L147)\n```\n\n#### Unchecked block L153\n\nThis line can't underflow due to L147. Therefore, it should be wrapped in an `unchecked` block.\n\n### function transferFrom()\n```solidity\nFile: FiatTokenV2.sol\n266:     function transferFrom(\n...\n280:         require(\n281:             value <= allowed[from][msg.sender],//@audit allowed[from][msg.sender] SLOAD 1\n...\n285:         allowed[from][msg.sender] = allowed[from][msg.sender] - value; //@audit should be unchecked (see L281) //@audit allowed[from][msg.sender] SLOAD 2\n```\n\n\n#### Unchecked block L285\n\nThis line can't underflow due to L281. Therefore, it should be wrapped in an `unchecked` block.\n\n#### Cache `allowed[from][msg.sender]`\n\nCaching this in memory can save around 1 SLOAD.\n\n### function \\_transfer()\n```solidity\nFile: FiatTokenV2.sol\n314:     function _transfer(\n...   \n321:         require(\n322:             value <= balances[from],//@audit SLOAD 1\n323:             \"ERC20: transfer amount exceeds balance\" \n...\n326:         balances[from] = balances[from] - value; //@audit should be unchecked (see L322) //@audit SLOAD 2\n```\n\n#### Unchecked block L326\n\nThis line can't underflow due to L322. Therefore, it should be wrapped in an `unchecked` block.\n\n#### Cache `balances[from]`\n\nCaching this in memory can save around 1 SLOAD.\n\n### function burn()\n\n```solidity\nFile: FiatTokenV2.sol\n371:     function burn(uint256 _amount)\n...\n379:         require(balance >= _amount, \"FiatToken: burn amount exceeds balance\");\n...\n382:         balances[msg.sender] = balance - _amount; //@audit should be unchecked (see L379)\n\n```\n\n#### Unchecked block L382\n\nThis line can't underflow due to L379. Therefore, it should be wrapped in an `unchecked` block.\n\n### function updateMasterMinter()\n```solidity\nFile: FiatTokenV2.sol\n387:     function updateMasterMinter(address _newMasterMinter) external onlyOwner {\n388:         require(\n389:             _newMasterMinter != address(0),\n390:             \"FiatToken: new masterMinter is the zero address\"\n391:         );\n392:         masterMinter = _newMasterMinter;\n393:         emit MasterMinterChanged(masterMinter);\n394:     }\n```\n\n#### Emitting a storage value (`masterMinter` vs `_newMasterMinter`)\n\nI suggest going from\n```solidity\n393:         emit MasterMinterChanged(masterMinter);\n```\n\nto\n```solidity\n393:         emit MasterMinterChanged(_newMasterMinter);\n```\n\n### function \\_decreaseAllowance()\n```solidity\nFile: FiatTokenV2.sol\n451:     function _decreaseAllowance(\n452:         address owner,\n453:         address spender,\n454:         uint256 decrement\n455:     ) internal override {\n456:         require(\n457:             decrement <= allowed[owner][spender],//@audit SLOAD 1\n458:             \"ERC20: decreased allowance below zero\" \n459:         );\n460:         _approve(owner, spender, allowed[owner][spender] - decrement); //@audit should be unchecked (see L457) //@audit SLOAD 2\n461:     }\n```\n\n#### Unchecked block L460\n\nThis line can't underflow due to L457. Therefore, it should be wrapped in an `unchecked` block.\n\n#### Cache `allowed[owner][spender]`\n\nCaching this in memory can save around 1 SLOAD.\n\n### function updateWhitelister()\n```solidity\nFile: FiatTokenV2.sol\n659:     function updateWhitelister(address _newWhitelister) external onlyOwner {\n660:         require(\n661:             _newWhitelister != address(0),\n662:             \"Whitelistable: new whitelister is the zero address\"\n663:         );\n664:         whitelister = _newWhitelister;\n665:         emit WhitelisterChanged(whitelister); //@audit emitting storage value\n666:     }\n```\n\n\n#### Emitting a storage value (`whitelister` vs `_newWhitelister`)\n\nI suggest going from\n```solidity\n665:         emit WhitelisterChanged(whitelister);\n```\n\nto\n```solidity\n665:         emit WhitelisterChanged(_newWhitelister);\n```\n\n## [G-07] General Recommendations\n\n### Variables\n\n#### No need to explicitly initialize variables with default values\n\nIf a variable is not set/initialized, it is assumed to have the default value (`0` for `uint`, `false` for `bool`, `address(0)` for address...). Explicitly initializing it with its default value is an anti-pattern and wastes gas.\n\nAs an example: `for (uint256 i = 0; i < numIterations; ++i) {` should be replaced with `for (uint256 i; i < numIterations; ++i) {`\n\nInstances include:\n\n    v1/FiatTokenV1.sol:58:    uint256 internal totalSupply_ = 0;\n    v1/Pausable.sol:49:    bool public paused = false;\n    v2/FiatTokenV2.sol:58:    uint256 internal totalSupply_ = 0;\n\nI suggest removing explicit initializations for default values.\n\n#### Pre-increments cost less gas compared to post-increments\n\n### Comparisons\n\n#### `> 0` is less efficient than `!= 0` for unsigned integers (with proof)\n\n`!= 0` costs less gas compared to `> 0` for unsigned integers in `require` statements with the optimizer enabled (6 gas)\n\nProof: While it may seem that `> 0` is cheaper than `!=`, this is only true without the optimizer enabled and outside a require statement. If you enable the optimizer at 10k AND you're in a `require` statement, this will save gas. You can see this tweet for more proofs: <https://twitter.com/gzeon/status/1485428085885640706>\n\nI suggest changing `> 0` with `!= 0` here:\n\n    v1/FiatTokenV1.sol:136:        require(_amount > 0, \"FiatToken: mint amount not greater than 0\");\n    v1/FiatTokenV1.sol:368:        require(_amount > 0, \"FiatToken: burn amount not greater than 0\");\n    v2/FiatTokenV2.sol:143:        require(_amount > 0, \"FiatToken: mint amount not greater than 0\");\n    v2/FiatTokenV2.sol:378:        require(_amount > 0, \"FiatToken: burn amount not greater than 0\");\n\nAlso, please enable the Optimizer.\n\n### Visibility\n\n### Errors\n\n#### Reduce the size of error messages (Long revert Strings)\n\nShortening revert strings to fit in 32 bytes will decrease deployment time gas and will decrease runtime gas when the revert condition is met.\n\nRevert strings that are longer than 32 bytes require at least one additional mstore, along with additional overhead for computing memory offset, etc.\n\nFor strings > 32 bytes, see [issue page](https://github.com/code-423n4/2022-02-jpyc-findings/issues/27) for details.\n\nI suggest shortening the revert strings to fit in 32 bytes, or that using custom errors as described next.\n\n#### Use Custom Errors instead of Revert Strings to save Gas\n\nCustom errors from Solidity 0.8.4 are cheaper than revert strings (cheaper deployment cost and runtime cost when the revert condition is met)\n\nSource: <https://blog.soliditylang.org/2021/04/21/custom-errors/>:\n\n> Starting from [Solidity v0.8.4](https://github.com/ethereum/solidity/releases/tag/v0.8.4), there is a convenient and gas-efficient way to explain to users why an operation failed through the use of custom errors. Until now, you could already use strings to give more information about failures (e.g., `revert(\"Insufficient funds.\");`), but they are rather expensive, especially when it comes to deploy cost, and it is difficult to use dynamic information in them.\n\nCustom errors are defined using the `error` statement, which can be used inside and outside of contracts (including interfaces and libraries).\n\nFor instances included, see [issue page](https://github.com/code-423n4/2022-02-jpyc-findings/issues/27) for details.\n\nI suggest replacing revert strings with custom errors.\n\n**[thurendous (JPYC) commented](https://github.com/code-423n4/2022-02-jpyc-findings/issues/27#issuecomment-1056169854):**\n > > function _implementation()<br>\n> > File: UUPSUpgradeable.sol\n> \n> We used OpenZeppelin's library and it is like this. Should we change this? \n> \n> > File: Blocklistable.sol<br>\n> > Emitting a storage value (blocklister vs _newBlocklister)\n> \n> We will fix this. \n> \n> > File: EIP3009.sol<br>\n> > Non-strict inequalities are cheaper than strict ones (1)\n> \n> We are not sure about this. Is this true? \n> \n> > File: FiatTokenV1.sol<br>\n> > function initialize()\n> \n> This can be true. But the initialize function is rarely called. We keep it this way.\n> \n> \n> > File: FiatTokenV1.sol<br>\n> > File: FiatTokenV2.sol<br>\n> > Unchecked block L146<br>\n> > Unchecked block L276<br>\n> > Unchecked block L316<br>\n> > Unchecked block L372<br>\n> > Unchecked block L449<br>\n> > Cache allowed[from][msg.sender]<br>\n> > Cache balances[from]\n> \n> We maybe will fix this after checking in detail. \n> \n> > function updateMasterMinter()<br>\n> > Emitting a storage value (masterMinter vs _newMasterMinter)\n> \n> We will fix this. \n> \n> > 0 is less efficient than != 0 for unsigned integers (with proof)\n> \n> Thank you for the proof. \n> \n> > Reduce the size of error messages (Long revert Strings)\n> \n> We maybe will fix this after checking in detail. Do you suggest do this strongly? \n\n**[thurendous (JPYC) resolved and commented](https://github.com/code-423n4/2022-02-jpyc-findings/issues/27#issuecomment-1081349224):**\n > > No need to explicitly initialize variables with default values<br>\n> > Cache allowedfrom<br>\n> > Cache allowed[from][msg.sender]<br>\n> > Cache balances[from]<br>\n> > Cache allowed[owner][spender]<br>\n> \n> \n> Above issues were fixed and thanks!\n> \n> Final change can be viewed [here](https://github.com/jcam1/JPYCv2/commit/63373b0dc20fca9581333583ab945d1e8269e654).\n\n***\n\n# Disclosures\n\nC4 is an open organization governed by participants in the community.\n\nC4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.\n\nC4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.\n"
}