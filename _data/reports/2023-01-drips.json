{
  "circa": {
    "title": "Drips Protocol contest",
    "sponsor": "Drips Protocol",
    "slug": "2023-01-drips",
    "date": "2023-03-10",
    "findings": "https://github.com/code-423n4/2023-01-drips-findings/issues",
    "contest": 209
  },
  "html": "<h1 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h1>\n<h2 id=\"about-c4\" style=\"position:relative;\"><a href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>About C4</h2>\n<p>Code4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.</p>\n<p>A C4 audit contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.</p>\n<p>During the audit contest outlined in this document, C4 conducted an analysis of the Drips Protocol smart contract system written in Solidity. The audit contest took place between January 25—February 3 2023.</p>\n<h2 id=\"wardens\" style=\"position:relative;\"><a href=\"#wardens\" aria-label=\"wardens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wardens</h2>\n<p>26 Wardens contributed reports to the Drips Protocol contest:</p>\n<ol>\n<li>0xA5DF</li>\n<li><a href=\"https://twitter.com/0xSmartContract\">0xSmartContract</a></li>\n<li>0xbepresent</li>\n<li><a href=\"https://github.com/Aymen1001\">Aymen0909</a></li>\n<li><a href=\"https://twitter.com/Deivitto\">Deivitto</a></li>\n<li>HollaDieWaldfee</li>\n<li>IllIllI</li>\n<li>NoamYakov</li>\n<li>ReyAdmirado</li>\n<li>Rolezn</li>\n<li>SleepingBugs (<a href=\"https://twitter.com/Deivitto\">Deivitto</a> and 0xLovesleep)</li>\n<li><a href=\"https://twitter.com/berndartmueller\">berndartmueller</a></li>\n<li>btk</li>\n<li>chaduke</li>\n<li>cryptostellar5</li>\n<li>descharre</li>\n<li>evan</li>\n<li>fs0c</li>\n<li><a href=\"https://twitter.com/hansfriese\">hansfriese</a></li>\n<li>hihen</li>\n<li><a href=\"https://twitter.com/Xc1008Cu\">ladboy233</a></li>\n<li>matrix_0wl</li>\n<li>nalus</li>\n<li>rbserver</li>\n<li>zzzitron</li>\n</ol>\n<p>This contest was judged by <a href=\"https://twitter.com/GalloDaSballo\">Alex the Entreprenerd</a>.</p>\n<p>Final report assembled by <a href=\"https://twitter.com/itsmetechjay\">itsmetechjay</a>.</p>\n<h1 id=\"summary\" style=\"position:relative;\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h1>\n<p>The C4 analysis yielded an aggregated total of 3 unique vulnerabilities. Of these vulnerabilities, 1 received a risk rating in the category of HIGH severity and 2 received a risk rating in the category of MEDIUM severity.</p>\n<p>Additionally, C4 analysis included 15 reports detailing issues with a risk rating of LOW severity or non-critical. There were also 11 reports recommending gas optimizations.</p>\n<p>All of the issues presented here are linked back to their original finding.</p>\n<h1 id=\"scope\" style=\"position:relative;\"><a href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scope</h1>\n<p>The code under review can be found within the <a href=\"https://github.com/code-423n4/2023-01-drips\">C4 Drips Protocol contest repository</a>, and is composed of 8 smart contracts written in the Solidity programming language and includes 1,503 lines of Solidity code.</p>\n<h1 id=\"severity-criteria\" style=\"position:relative;\"><a href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Severity Criteria</h1>\n<p>C4 assesses the severity of disclosed vulnerabilities based on three primary risk categories: high, medium, and low/non-critical.</p>\n<p>High-level considerations for vulnerabilities span the following key areas when conducting assessments:</p>\n<ul>\n<li>Malicious Input Handling</li>\n<li>Escalation of privileges</li>\n<li>Arithmetic</li>\n<li>Gas use</li>\n</ul>\n<p>For more information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on <a href=\"https://code4rena.com\">the C4 website</a>, specifically our section on <a href=\"https://docs.code4rena.com/awarding/judging-criteria/severity-categorization\">Severity Categorization</a>.</p>\n<h1 id=\"high-risk-findings-1\" style=\"position:relative;\"><a href=\"#high-risk-findings-1\" aria-label=\"high risk findings 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>High Risk Findings (1)</h1>\n<h2 id=\"h-01-drips-that-end-after-the-current-cycle-but-before-its-creation-can-allow-users-to-profit-from-squeezing\" style=\"position:relative;\"><a href=\"#h-01-drips-that-end-after-the-current-cycle-but-before-its-creation-can-allow-users-to-profit-from-squeezing\" aria-label=\"h 01 drips that end after the current cycle but before its creation can allow users to profit from squeezing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/315\">[H-01] Drips that end after the current cycle but before its creation can allow users to profit from squeezing</a></h2>\n<p><em>Submitted by <a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/315\">evan</a>, also found by <a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/66\">HollaDieWaldfee</a></em></p>\n<p>By creating a drip that ends after the current cycle but before its creation time and immediately removing it, the sender doesn’t have to put in any assets but the receiver can still squeeze this drip.</p>\n<p>By setting a receiver that the sender controls, the sender can drain an arbitrary asset from the contract.</p>\n<h3 id=\"proof-of-concept\" style=\"position:relative;\"><a href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Let the cycle length be 10 seconds. By i-th second I mean the i-th second of the cycle.</p>\n<p>At the 5th second, sender creates a drip that starts at 0th second and lasts for 2 seconds.</p>\n<p>At the 6th second, sender removes this drip.</p>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L569\">https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L569</a></p>\n<p>Since the drip ends before it was created, the dripped amount is 0, so the sender can retrieve their full balance.</p>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L425-L430\">https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L425-L430</a> </p>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L490-L496\">https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L490-L496</a></p>\n<p>Now the receiver squeezes from this drip. </p>\n<p><code>SqueezeStartCap = \\_currCycleStart() = 0th second, squeezeEndCap = 6th second</code>, so the receiver can still squeeze out the full amount even though the sender has withdrawn all of his balance.</p>\n<p>Please add the following test to DripsHub.t.sol. It verifies that the sender has retrieved all of his assets but the receiver can still squeeze.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">    function customSetDrips(</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        uint256 forUser,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        uint128 balanceFrom,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        uint128 balanceTo,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        DripsReceiver[] memory newReceivers</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    ) internal {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        int128 balanceDelta = int128(balanceTo) - int128(balanceFrom);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        DripsReceiver[] memory currReceivers = loadDrips(forUser);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.prank(driver);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        int128 realBalanceDelta =</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            dripsHub.setDrips(forUser, erc20, currReceivers, balanceDelta, newReceivers, 0, 0);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        storeDrips(forUser, newReceivers);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    function testExploitSqueeze() public {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        skipToCycleEnd();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        // Start dripping</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        DripsReceiver[] memory receivers = new DripsReceiver[](1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        receivers[0] = DripsReceiver(</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            receiver,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            DripsConfigImpl.create(0, uint160(1 * dripsHub.AMT_PER_SEC_MULTIPLIER()), uint32(block.timestamp), 2)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        );</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        DripsHistory[] memory history = new DripsHistory[](2);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        uint256 balanceBefore = balance();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        skip(5);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        customSetDrips(user, 0, 2, receivers);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        (,, uint32 lastUpdate,, uint32 maxEnd) = dripsHub.dripsState(user, erc20);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        history[0] = DripsHistory(0, receivers, lastUpdate, maxEnd);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        skip(1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        receivers = dripsReceivers();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        customSetDrips(user, 2, 0, receivers);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        (,, lastUpdate,, maxEnd) = dripsHub.dripsState(user, erc20);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        history[1] = DripsHistory(0, receivers, lastUpdate, maxEnd);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        assertBalance(balanceBefore);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        // Squeeze</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        vm.prank(driver);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        uint128 amt = dripsHub.squeezeDrips(receiver, erc20, user, 0, history);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        assertEq(amt, 2, &quot;Invalid squeezed amt&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span></code></pre>\n<h3 id=\"tools-used\" style=\"position:relative;\"><a href=\"#tools-used\" aria-label=\"tools used permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>VS Code, Foundry</p>\n<h3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L426\">https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L426</a></p>\n<p>One potential solution is to add an additional check after this line. Something along the lines of:</p>\n<p><code>if (squeezeStartCap &#x3C; drips.updateTime) squeezeStartCap = drips.updateTime;</code></p>\n<p><strong><a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/315#issuecomment-1426376190\">CodeSandwich (Drips) confirmed and commented</a>:</strong></p>\n<blockquote>\n<p>Great job! This is a critical protocol breaker.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/315#issuecomment-1439673302\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>The Warden has shown a way to trick the contract into disbursing out funds without the upfront payment.</p>\n<p>Because this shows a way to steal the principal, I agree with High Severity.</p>\n</blockquote>\n<hr>\n<h1 id=\"medium-risk-findings-2\" style=\"position:relative;\"><a href=\"#medium-risk-findings-2\" aria-label=\"medium risk findings 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Medium Risk Findings (2)</h1>\n<h2 id=\"m-01-squeezing-drips-from-a-sender-can-be-front-run-and-prevented-by-the-sender\" style=\"position:relative;\"><a href=\"#m-01-squeezing-drips-from-a-sender-can-be-front-run-and-prevented-by-the-sender\" aria-label=\"m 01 squeezing drips from a sender can be front run and prevented by the sender permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/276\">[M-01] Squeezing drips from a sender can be front-run and prevented by the sender</a></h2>\n<p><em>Submitted by <a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/276\">berndartmueller</a></em></p>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/9fd776b50f4be23ca038b1d0426e63a69c7a511d/src/Drips.sol#L411\">https://github.com/code-423n4/2023-01-drips/blob/9fd776b50f4be23ca038b1d0426e63a69c7a511d/src/Drips.sol#L411</a> </p>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/9fd776b50f4be23ca038b1d0426e63a69c7a511d/src/Drips.sol#L461\">https://github.com/code-423n4/2023-01-drips/blob/9fd776b50f4be23ca038b1d0426e63a69c7a511d/src/Drips.sol#L461</a></p>\n<p>Squeezing drips from a sender requires providing the sequence of drips configurations (see NatSpec description in <a href=\"https://github.com/code-423n4/2023-01-drips/blob/9fd776b50f4be23ca038b1d0426e63a69c7a511d/src/Drips.sol#L337-L338\">L337-L338</a>):</p>\n<blockquote>\n<p>/// It can start at an arbitrary past configuration, but must describe all the configurations\n/// which have been used since then including the current one, in the chronological order.</p>\n</blockquote>\n<p>The provided history entries are hashed and verified against the sender’s <code>dripsHistoryHash</code>.</p>\n<p>However, the sender can prevent a receiver from squeezing drips by front-running the squeeze transaction and adding a new configuration. Adding a new configuration updates the current <code>dripsHistoryHash</code> and invalidates the <code>historyHash</code> provided by the receiver when squeezing. The receiver will then fail the drips history verification in <a href=\"https://github.com/code-423n4/2023-01-drips/blob/9fd776b50f4be23ca038b1d0426e63a69c7a511d/src/Drips.sol#L461\">L461</a> and the squeeze will fail.</p>\n<h3 id=\"impact\" style=\"position:relative;\"><a href=\"#impact\" aria-label=\"impact permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>A sender can prevent its drip receivers from squeezing by front-running the squeeze transaction and adding a new configuration.</p>\n<h3 id=\"proof-of-concept-1\" style=\"position:relative;\"><a href=\"#proof-of-concept-1\" aria-label=\"proof of concept 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/9fd776b50f4be23ca038b1d0426e63a69c7a511d/src/Drips.sol#L411\">Drips.sol#L411</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">392</span><span class=\"mtk1\">: </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_squeezeDripsResult</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">393:     </span><span class=\"mtk10\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk10\">userId</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">394:     </span><span class=\"mtk10\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk10\">assetId</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">395:     </span><span class=\"mtk10\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk10\">senderId</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">396:     </span><span class=\"mtk10\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk10\">historyHash</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">397:     </span><span class=\"mtk10\">DripsHistory</span><span class=\"mtk1\">[] </span><span class=\"mtk10\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk10\">dripsHistory</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">398</span><span class=\"mtk1\">: )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">399:     </span><span class=\"mtk11\">internal</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">400:     </span><span class=\"mtk11\">view</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">401:     </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">402:         </span><span class=\"mtk10\">uint128</span><span class=\"mtk1\"> </span><span class=\"mtk10\">amt</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">403:         </span><span class=\"mtk10\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk10\">squeezedNum</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">404:         </span><span class=\"mtk10\">uint256</span><span class=\"mtk1\">[] </span><span class=\"mtk10\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk10\">squeezedRevIdxs</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">405:         </span><span class=\"mtk10\">bytes32</span><span class=\"mtk1\">[] </span><span class=\"mtk10\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk10\">historyHashes</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">406:         </span><span class=\"mtk10\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk10\">currCycleConfigs</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">407</span><span class=\"mtk1\">:     )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">408: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">409</span><span class=\"mtk1\">:     {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">410</span><span class=\"mtk12\">:</span><span class=\"mtk1\">         </span><span class=\"mtk12\">DripsState</span><span class=\"mtk1\"> </span><span class=\"mtk12\">storage</span><span class=\"mtk1\"> </span><span class=\"mtk12\">sender</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">_dripsStorage</span><span class=\"mtk1\">().</span><span class=\"mtk12\">states</span><span class=\"mtk1\">[</span><span class=\"mtk12\">assetId</span><span class=\"mtk1\">][</span><span class=\"mtk12\">senderId</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">411</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">historyHashes</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">_verifyDripsHistory</span><span class=\"mtk1\">(</span><span class=\"mtk12\">historyHash</span><span class=\"mtk1\">, </span><span class=\"mtk12\">dripsHistory</span><span class=\"mtk1\">, </span><span class=\"mtk12\">sender</span><span class=\"mtk1\">.</span><span class=\"mtk12\">dripsHistoryHash</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">412</span><span class=\"mtk1\">:         </span><span class=\"mtk3\">// If the last update was not in the current cycle,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">413</span><span class=\"mtk1\">:         </span><span class=\"mtk3\">// there&#39;s only the single latest history entry to squeeze in the current cycle.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">414</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">currCycleConfigs</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">1</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">415</span><span class=\"mtk1\">:         </span><span class=\"mtk3\">// slither-disable-next-line timestamp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">416</span><span class=\"mtk1\">:         </span><span class=\"mtk11\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">.</span><span class=\"mtk12\">updateTime</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk11\">_currCycleStart</span><span class=\"mtk1\">()) </span><span class=\"mtk12\">currCycleConfigs</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">sender</span><span class=\"mtk1\">.</span><span class=\"mtk12\">currCycleConfigs</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">417</span><span class=\"mtk1\">:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...      </span><span class=\"mtk3\">// [...]</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/9fd776b50f4be23ca038b1d0426e63a69c7a511d/src/Drips.sol#L461\">Drips.sol#L461</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">444</span><span class=\"mtk1\">: </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_verifyDripsHistory</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">445:     </span><span class=\"mtk10\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk10\">historyHash</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">446:     </span><span class=\"mtk10\">DripsHistory</span><span class=\"mtk1\">[] </span><span class=\"mtk10\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk10\">dripsHistory</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">447:     </span><span class=\"mtk10\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk10\">finalHistoryHash</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">448</span><span class=\"mtk1\">: ) </span><span class=\"mtk11\">private</span><span class=\"mtk1\"> </span><span class=\"mtk11\">pure</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">historyHashes</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">449</span><span class=\"mtk1\">:     </span><span class=\"mtk12\">historyHashes</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">bytes32</span><span class=\"mtk1\">[](</span><span class=\"mtk12\">dripsHistory</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">450</span><span class=\"mtk1\">:     </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">0</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">dripsHistory</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\">++) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">451</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">DripsHistory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">drips</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">dripsHistory</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">452</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">dripsHash</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">drips</span><span class=\"mtk1\">.</span><span class=\"mtk12\">dripsHash</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">453</span><span class=\"mtk1\">:         </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">drips</span><span class=\"mtk1\">.</span><span class=\"mtk12\">receivers</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> != </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">454</span><span class=\"mtk1\">:             </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">dripsHash</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Drips history entry with hash and receivers&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">455</span><span class=\"mtk1\">:             </span><span class=\"mtk12\">dripsHash</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">_hashDrips</span><span class=\"mtk1\">(</span><span class=\"mtk12\">drips</span><span class=\"mtk1\">.</span><span class=\"mtk12\">receivers</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">456</span><span class=\"mtk1\">:         }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">457</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">historyHashes</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">historyHash</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">458</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">historyHash</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">_hashDripsHistory</span><span class=\"mtk1\">(</span><span class=\"mtk12\">historyHash</span><span class=\"mtk1\">, </span><span class=\"mtk12\">dripsHash</span><span class=\"mtk1\">, </span><span class=\"mtk12\">drips</span><span class=\"mtk1\">.</span><span class=\"mtk12\">updateTime</span><span class=\"mtk1\">, </span><span class=\"mtk12\">drips</span><span class=\"mtk1\">.</span><span class=\"mtk12\">maxEnd</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">459</span><span class=\"mtk1\">:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">460</span><span class=\"mtk1\">:     </span><span class=\"mtk3\">// slither-disable-next-line incorrect-equality,timestamp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">461</span><span class=\"mtk1\">:     </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">historyHash</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">finalHistoryHash</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Invalid drips history&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">462</span><span class=\"mtk1\">: }</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Consider allowing a receiver to squeeze drips from a sender up until the current timestamp.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/276#issuecomment-1425726115\">xmxanuel (Drips) commented</a>:</strong></p>\n<blockquote>\n<p>Technically the described attack would work.</p>\n<p>It is also related to the trust assumption between the sender an receiver. Which are anyway given in a certain form. </p>\n<p>I am unsure about the proposed solutions.  Currently, we only store the latest dripsHistory hash on-chain. For allowing to squeeze until a specific timestamp, it might be necessary to have the full list of historic hashes on-chain.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/276#issuecomment-1427007648\">CodeSandwich (Drips) disagreed with severity and commented</a>:</strong></p>\n<blockquote>\n<p>This attack is in fact possible, but it only allows postponing collecting funds until the end of the cycle. The proposed solution would probably require a lot of storage, so it’s probably not worth introducing.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/276#issuecomment-1450276738\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>In order to judge this issue I spoke with 4 other judges as well as the Sponsor.</p>\n<p>This is a difficult decision because of the unclear expectations as to whether the sender is bening towards the receiver or not.</p>\n<p>Because of the uncertainty, and the possibility of performing the grief, the finding is valid.</p>\n<p>The issue is in terms of determining it’s severity.</p>\n<p><strong>The attacker doesn’t gain anything</strong></p>\n<p>One of the most interesting arguments is the idea that “the attacker doesn’t gain anything”, which can be falsified in scenarios in which squeezing would have helped reach a threshold of tokens in circulation, out of vesting or for similar purposes.</p>\n<p>If we try hard enough, through multiple people’s effort, we can come up with a scenario in which squeezing could make a difference between having enough votes for a Governance Operation, or could offer enough collateral to avoid a liquidation or some level of risk.</p>\n<p>Those scenarios, while unlikely, can help discredit the idea that “the attacker doesn’t gain anything”.</p>\n<p><strong>The grief is limited</strong></p>\n<p>On the other hand, we must acknowledge that the attack / griefing, is limited:</p>\n<ul>\n<li>The <code>sender</code> is the only privileged account that can perform the grief</li>\n<li>Squeezing is denied until the next cycle, which based on configuration, will be known, and will be between 1 week and 1 month.</li>\n</ul>\n<p>These can be viewed as additional external requirements, which reduce the impact / likelihood of the finding</p>\n<p><strong>The Squeeze is Squoze</strong></p>\n<p>In spite of the external requirements, the finding is showing how the functionality of Squeezing can be denied by the sender.</p>\n<p>I believe that if anybody could grief squeezing, we would not hesitate in awarding Medium Severity and perhaps we’d be discussing around Med / High.</p>\n<p>However, in this case, the only account that can perform the grief is the sender.</p>\n<p>At the same time, the goal of the system is to allow Squeezing, which per the discussion above, given the finding can be prevented until a drip has moved to a newer crycle.</p>\n<p><strong>Last Minute Coding</strong></p>\n<p>I went into the tests and wrote the following illustratory cases</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">testSenderCanStopAfter</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint128</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amt</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">cycleSecs</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">setDrips</span><span class=\"mtk1\">(</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amt</span><span class=\"mtk1\">, </span><span class=\"mtk11\">recv</span><span class=\"mtk1\">(</span><span class=\"mtk12\">receiver</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\">), </span><span class=\"mtk12\">cycleSecs</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">DripsHistory</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">history</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">hist</span><span class=\"mtk1\">(</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">skip</span><span class=\"mtk1\">(</span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">squeezeDrips</span><span class=\"mtk1\">(</span><span class=\"mtk12\">receiver</span><span class=\"mtk1\">, </span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">history</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">setDrips</span><span class=\"mtk1\">(</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amt</span><span class=\"mtk1\"> - </span><span class=\"mtk7\">1</span><span class=\"mtk1\">, </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk11\">recv</span><span class=\"mtk1\">(</span><span class=\"mtk12\">receiver</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\">), </span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Squeeze again</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">DripsHistory</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">history2</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">hist</span><span class=\"mtk1\">(</span><span class=\"mtk12\">history</span><span class=\"mtk1\">, </span><span class=\"mtk12\">sender</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">squeezeDrips</span><span class=\"mtk1\">(</span><span class=\"mtk12\">receiver</span><span class=\"mtk1\">, </span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">history2</span><span class=\"mtk1\">, </span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">skipToCycleEnd</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">receiveDrips</span><span class=\"mtk1\">(</span><span class=\"mtk12\">receiver</span><span class=\"mtk1\">, </span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">testSenderCannotChangeTheirMind</span><span class=\"mtk1\">() </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint128</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amt</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">cycleSecs</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">setDrips</span><span class=\"mtk1\">(</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amt</span><span class=\"mtk1\">, </span><span class=\"mtk11\">recv</span><span class=\"mtk1\">(</span><span class=\"mtk12\">receiver</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\">), </span><span class=\"mtk12\">cycleSecs</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">DripsHistory</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">history</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">hist</span><span class=\"mtk1\">(</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">skip</span><span class=\"mtk1\">(</span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">setDrips</span><span class=\"mtk1\">(</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amt</span><span class=\"mtk1\"> - </span><span class=\"mtk7\">1</span><span class=\"mtk1\">, </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk11\">recv</span><span class=\"mtk1\">(</span><span class=\"mtk12\">receiver</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\">), </span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Squeeze First time</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">DripsHistory</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">history2</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">hist</span><span class=\"mtk1\">(</span><span class=\"mtk12\">history</span><span class=\"mtk1\">, </span><span class=\"mtk12\">sender</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">squeezeDrips</span><span class=\"mtk1\">(</span><span class=\"mtk12\">receiver</span><span class=\"mtk1\">, </span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">history2</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">skipToCycleEnd</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">receiveDrips</span><span class=\"mtk1\">(</span><span class=\"mtk12\">receiver</span><span class=\"mtk1\">, </span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>Ultimately we can see that what is owed to the recipient can never be taken back, however the sender can, through the grief shown in the above finding, prevent the tokens from being received until the end.</p>\n<p><strong>Conclusion</strong></p>\n<p>Given the information above, being mindful of:</p>\n<ul>\n<li>A potentially severe risk, with very low likelyhood</li>\n<li>The temporary breaking of the functionality of squeezing, which was meant to allow by-the-second claims.</li>\n</ul>\n<p>I agree with Medium Severity.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-02-unauthorize-can-be-front-run-so-that-the-malicious-authorized-user-would-get-their-authority-back\" style=\"position:relative;\"><a href=\"#m-02-unauthorize-can-be-front-run-so-that-the-malicious-authorized-user-would-get-their-authority-back\" aria-label=\"m 02 unauthorize can be front run so that the malicious authorized user would get their authority back permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/163\">[M-02] <code>unauthorize()</code> can be front-run so that the malicious authorized user would get their authority back</a></h2>\n<p><em>Submitted by <a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/163\">0xA5DF</a>, also found by <a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/124\">0xbepresent</a> and <a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/34\">ladboy233</a></em></p>\n<p>The <code>Caller</code> contract enables users to authorize other users to execute tx on their behalf.\nThis option enables the authorized/delegated user to add more users to the authorized users list.\nIn case the original user is trying to remove an authorized user (i.e. run <code>unauthorize()</code>), the delegated user can simply front run that tx to add another user, then after <code>unauthorized()</code> is executed the delegated can use the added user to gain his authority back.</p>\n<p>This would allow the malicious delegated user to keep executing txs on behalf of the original user and cause them a loss of funds (e.g. collecting funds on their behalf and sending it to the attacker’s address).</p>\n<h3 id=\"proof-of-concept-2\" style=\"position:relative;\"><a href=\"#proof-of-concept-2\" aria-label=\"proof of concept 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>The test below demonstrates such a scenario:</p>\n<ul>\n<li>Alice authorizes Bob</li>\n<li>Bob becomes malicious and Alice now wants to remove him</li>\n<li>Bob noticed the tx to unauthorize him and front runs it by authorizing Eve</li>\n<li>Alice <code>unauthorize()</code> tx is executed</li>\n<li>Bob now authorizes himself back again via Eve’s account</li>\n</ul>\n<p>Front running can be done either by sending a tx with a higher gas price (usually tx are ordered in a block by the gas price / total fee), or by paying an additional fee to the validator if they manage to run their tx without reverting (i.e. by sending additional ETH to <code>block.coinbase</code>, hoping validator will notice it).\nIt’s true that Alice can run <code>unauthorize()</code> again and again and needs to succeed only once, but:</p>\n<ul>\n<li>Bob can keep adding other users and Alice would have to keep removing them all</li>\n<li>This is an ongoing battle that can last forever, and Alice might not have enough knowledge, resources and time to deal with it right away. This might take hours or days, and in the meanwhile Alice might be receiving a significant amount of drips that would be stolen by Bob.</li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/test/Caller.t.sol b/test/Caller.t.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index 861b351..3e4be22 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/test/Caller.t.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/test/Caller.t.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -125,6 +125,24 @@ contract CallerTest is Test {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         vm.expectRevert(ERROR_UNAUTHORIZED);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         caller.callAs(sender, address(target), data);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    function testFrontRunUnauthorize() public {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        bytes memory data = abi.encodeWithSelector(target.run.selector, 1);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        address bob = address(0xbab);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        address eve = address(0xefe);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        // Bob is authorized by Alice</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        authorize(sender, bob);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        // Bob became malicious and Alice now wants to remove him</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        // Bob sees the `unauthorize()` call and front runs it with authorizing Eve</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        authorizeCallAs(sender, bob, eve);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        unauthorize(sender, bob);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        // Eve can now give Bob his authority back</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        authorizeCallAs(sender, eve, bob);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     function testAuthorizingAuthorizedReverts() public {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         authorize(sender, address(this));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -257,6 +275,13 @@ contract CallerTest is Test {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         assertTrue(caller.isAuthorized(authorizing, authorized), &quot;Authorization failed&quot;);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    function authorizeCallAs(address originalUser,address delegated, address authorized) internal {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        bytes memory data = abi.encodeWithSelector(Caller.authorize.selector, authorized);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        vm.prank(delegated);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        caller.callAs(originalUser, address(caller),  data);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+        assertTrue(caller.isAuthorized(originalUser, authorized), &quot;Authorization failed&quot;);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     function unauthorize(address authorizing, address unauthorized) internal {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         vm.prank(authorizing);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         caller.unauthorize(unauthorized);</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Don’t allow authorized users to call <code>authorize()</code> on behalf of the original user.</p>\n<p>This can be done by replacing <code>_msgSender()</code> with <code>msg.sender</code> at <code>authorize()</code>, if the devs want to enable authorizing by signing I think the best way would be to add a dedicated function for that (other ways to prevent calling <code>authorize()</code> from <code>callAs()</code> can increase gas cost for normal calls, esp. since we’ll need to cover all edge cases of recursive calls with <code>callBatched()</code>).</p>\n<p><strong><a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/163#issuecomment-1424324859\">xmxanuel (Drips) commented</a>:</strong></p>\n<blockquote>\n<p>Known behavior. I think it is debatable. The <code>authorize</code> means an other address is completely trusted in terms of access to funds.\nIn most cases this will be the same actor like Alice. Just another address of Alice.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/163#issuecomment-1426357093\">CodeSandwich (Drips) disagreed with severity and commented</a>:</strong></p>\n<blockquote>\n<p>Like Manuel said, this is known, authorizing somebody gives them extreme privileges anyway, like stealing all the funds available for the user in the protocol.</p>\n<p>I disagree that it’s a High severity issue, because the attacked user with some effort can defend themselves. In a single batch they need to authorize a contract that would iterate over all addresses returned by <code>allAuthorized</code> and for each of them to call <code>unauthorize</code> on behalf of the attacked user.</p>\n<p>I think that the above emergency defense mechanism could be built right into <code>Caller</code>’s API to make it cheaper and easier to run, basically adding an <code>unauthorizeAll</code> function that will clear the authorized addresses list. That’s why I agree that it <strong>is</strong> an issue to solve, but a low severity one, it’s only a quality of life improvement.</p>\n<p>The proposed mitigation of banning authorized users from authorizing others is too heavy handed, because it hurts use cases like a slow DAO authorizing a trusted operator, who then needs to rotate keys or authorize a “script contract” performing automated operations on Drips protocol. Authorization by signing hurts all non-EOA addresses like DAOs or multisigs which don’t have private keys.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/163#issuecomment-1441660411\">Alex the Entreprenerd (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>Because of the fact that the only requirement for the attack is for the authorized to be malicious, I have considered High Severity.</p>\n<p>After further reflection, because of the ability to remove the malicious attacker via a Macro, per the Sponsor’s comment above, I believe Medium Severity to be the most appropriate.</p>\n<p>The approval should be considered an extremely dangerous operation, which can cause drastic losses, however, a malicious approved can eventually be unapproved via a macro contract.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/163#issuecomment-1441675954\">xmxanuel commented</a>:</strong></p>\n<blockquote>\n<blockquote>\n<p>The approval should be considered an extremely dangerous operation, which can cause drastic losses, however, a malicious approval can eventually be unapproved via a macro contract</p>\n</blockquote>\n<p>Yes, we agree here. We envision it more like the same actor/organization is using multiple\naddresses. </p>\n<p>Like the multi-sig of an organization is used as the main address (address with the ens name) but not all actions might require multiple signatures. Therefore, they can approve another address. etc.</p>\n<p>However, we assume full trust. </p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/163#issuecomment-1445444330\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Confirming Medium severity because:</p>\n<ul>\n<li>The risk is not in giving the approval, that is the feature offered</li>\n<li>The risk is in not being able to revoke an approval, due to a lack of <code>revokeAll</code> or similar functionality, which can create a temporary grief</li>\n</ul>\n<p>Because that can cause a denial of functionality which is limited in time, I believe Medium Severity to be the most appropriate.</p>\n</blockquote>\n<hr>\n<h1 id=\"low-risk-and-non-critical-issues\" style=\"position:relative;\"><a href=\"#low-risk-and-non-critical-issues\" aria-label=\"low risk and non critical issues permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Low Risk and Non-Critical Issues</h1>\n<p>For this contest, 13 reports were submitted by wardens detailing low risk and non-critical issues. The <a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/282\">report highlighted below</a> by <strong>berndartmueller</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/324\">SleepingBugs</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/298\">rbserver</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/288\">hansfriese</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/266\">IllIllI</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/256\">0xSmartContract</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/244\">nalus</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/221\">zzzitron</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/213\">0xA5DF</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/184\">fs0c</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/61\">chaduke</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/49\">btk</a>, and\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/32\">HollaDieWaldfee</a>\n.</em></p>\n<h2 id=\"l-01-an-authorized-user-can-unauthorize-other-authorized-users-of-the-same-sender\" style=\"position:relative;\"><a href=\"#l-01-an-authorized-user-can-unauthorize-other-authorized-users-of-the-same-sender\" aria-label=\"l 01 an authorized user can unauthorize other authorized users of the same sender permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-01] An authorized user can unauthorize other authorized users of the same sender</h2>\n<p>A user can grant authorization to another address to make calls on their behalf via the <code>Caller.callAs</code> function. The <code>Caller.unauthorize</code> function allows the user to revoke the authorization of another address.</p>\n<p>An authorized user can revoke the authorization of another authorized user of the same sender. This is because the authorized user can call the <code>Caller.unauthorize</code> function on behalf of the sender.</p>\n<h3 id=\"findings\" style=\"position:relative;\"><a href=\"#findings\" aria-label=\"findings permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Findings</h3>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/9fd776b50f4be23ca038b1d0426e63a69c7a511d/src/Caller.sol#L114-L118\">Caller.sol#L114-L118</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">114</span><span class=\"mtk1\">: </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">unauthorize</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">user</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">115</span><span class=\"mtk1\">:     </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">sender</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">116</span><span class=\"mtk1\">:     </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_authorized</span><span class=\"mtk1\">[</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">].</span><span class=\"mtk11\">remove</span><span class=\"mtk1\">(</span><span class=\"mtk12\">user</span><span class=\"mtk1\">), </span><span class=\"mtk8\">&quot;Address is not authorized&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">117</span><span class=\"mtk1\">:     </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Unauthorized</span><span class=\"mtk1\">(</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">user</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">118</span><span class=\"mtk1\">: }</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-3\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-3\" aria-label=\"recommended mitigation steps 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Consider preventing calls to the <code>Caller</code> contract address from within the <code>_call</code> function.</p>\n<h2 id=\"l-02-lack-of-reasonable-boundaries-for-cycle-secs\" style=\"position:relative;\"><a href=\"#l-02-lack-of-reasonable-boundaries-for-cycle-secs\" aria-label=\"l 02 lack of reasonable boundaries for cycle secs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-02] Lack of reasonable boundaries for cycle secs</h2>\n<p>If <code>_cycleSecs</code> is set too low, for example, to a value less than the Ethereum block time of 12 sec, it will not be possible to squeeze. If set too high, e.g., larger than the current <code>block.timestamp</code>, it will not be possible to receive drips - only squeezing will be possible.</p>\n<h3 id=\"findings-1\" style=\"position:relative;\"><a href=\"#findings-1\" aria-label=\"findings 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Findings</h3>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/9fd776b50f4be23ca038b1d0426e63a69c7a511d/src/Drips.sol#L221\">Drips.sol#L221</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">219</span><span class=\"mtk1\">: </span><span class=\"mtk11\">constructor</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">cycleSecs</span><span class=\"mtk1\">, </span><span class=\"mtk12\">bytes32</span><span class=\"mtk1\"> </span><span class=\"mtk12\">dripsStorageSlot</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">220</span><span class=\"mtk1\">:     </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">cycleSecs</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">1</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Cycle length too low&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">221</span><span class=\"mtk1\">:     </span><span class=\"mtk12\">_cycleSecs</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">cycleSecs</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">222</span><span class=\"mtk1\">:     </span><span class=\"mtk12\">_dripsStorageSlot</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">dripsStorageSlot</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">223</span><span class=\"mtk1\">: }</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-4\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-4\" aria-label=\"recommended mitigation steps 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Consider adding an appropriate upper limit for <code>_cycleSecs</code>.</p>\n<h2 id=\"l-03-unused-dripid-of-receiver-config-is-used-considered-while-sorting-receivers\" style=\"position:relative;\"><a href=\"#l-03-unused-dripid-of-receiver-config-is-used-considered-while-sorting-receivers\" aria-label=\"l 03 unused dripid of receiver config is used considered while sorting receivers permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-03] Unused <code>dripId</code> of receiver config is used considered while sorting receivers</h2>\n<p>The <code>Drips._isOrdered</code> function compares two given receivers. The receiver config can include the prefixed <code>dripId</code> in the 32 most significant bits. This allows using the <code>dripId</code> for changing the order of receivers when setting a new drips configuration without violating the sorting requirement, <em>First compares their <code>amtPerSec</code>s, then their <code>start</code>s and then their <code>duration</code>s</em> (<a href=\"https://github.com/code-423n4/2023-01-drips/blob/9fd776b50f4be23ca038b1d0426e63a69c7a511d/src/Drips.sol#L93\">see Drips.sol#L93</a>).</p>\n<p>While no harmful effects are expected, it can be used in the <code>Drips._setDrips</code> function to control if delta amounts of receivers are first removed, added, or updated, are expected.</p>\n<h3 id=\"findings-2\" style=\"position:relative;\"><a href=\"#findings-2\" aria-label=\"findings 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Findings</h3>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/9fd776b50f4be23ca038b1d0426e63a69c7a511d/src/Drips.sol#L1069\">Drips.sol#L1069</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">1061</span><span class=\"mtk1\">: </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_isOrdered</span><span class=\"mtk1\">(</span><span class=\"mtk12\">DripsReceiver</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prev</span><span class=\"mtk1\">, </span><span class=\"mtk12\">DripsReceiver</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">next</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">1062:     </span><span class=\"mtk11\">private</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">1063:     </span><span class=\"mtk11\">pure</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">1064:     </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">1065: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">1066</span><span class=\"mtk1\">:     </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">prev</span><span class=\"mtk1\">.</span><span class=\"mtk12\">userId</span><span class=\"mtk1\"> != </span><span class=\"mtk12\">next</span><span class=\"mtk1\">.</span><span class=\"mtk12\">userId</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">1067</span><span class=\"mtk1\">:         </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prev</span><span class=\"mtk1\">.</span><span class=\"mtk12\">userId</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">next</span><span class=\"mtk1\">.</span><span class=\"mtk12\">userId</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">1068</span><span class=\"mtk1\">:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">1069</span><span class=\"mtk1\">:     </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prev</span><span class=\"mtk1\">.</span><span class=\"mtk12\">config</span><span class=\"mtk1\">.</span><span class=\"mtk11\">lt</span><span class=\"mtk1\">(</span><span class=\"mtk12\">next</span><span class=\"mtk1\">.</span><span class=\"mtk12\">config</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">1070</span><span class=\"mtk1\">: }</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-5\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-5\" aria-label=\"recommended mitigation steps 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Consider omitting the <code>dripId</code> from the receiver config when comparing the receivers.</p>\n<h2 id=\"l-04-collecting-funds-should-be-usable-while-the-dripshub-contract-is-paused\" style=\"position:relative;\"><a href=\"#l-04-collecting-funds-should-be-usable-while-the-dripshub-contract-is-paused\" aria-label=\"l 04 collecting funds should be usable while the dripshub contract is paused permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-04] Collecting funds should be usable while the <code>DripsHub</code> contract is paused</h2>\n<p>The <code>DripsHub.collect</code> function is only callable when the <code>DripsHub</code> contract is not paused. This prevents a user from collecting accumulated funds. The admin of the <code>DripsHub</code> contract can potentially pause the contracts at any time, locking users out of their honestly earned funds.</p>\n<h3 id=\"findings-3\" style=\"position:relative;\"><a href=\"#findings-3\" aria-label=\"findings 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Findings</h3>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/9fd776b50f4be23ca038b1d0426e63a69c7a511d/src/DripsHub.sol#L388\">DripsHub.sol#L388</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">386</span><span class=\"mtk1\">: </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">collect</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">userId</span><span class=\"mtk1\">, </span><span class=\"mtk12\">IERC20</span><span class=\"mtk1\"> </span><span class=\"mtk12\">erc20</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">387:     </span><span class=\"mtk11\">public</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">388:     </span><span class=\"mtk11\">whenNotPaused</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">389:     </span><span class=\"mtk11\">onlyDriver</span><span class=\"mtk1\">(</span><span class=\"mtk12\">userId</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">390:     </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint128</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amt</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">391: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">392</span><span class=\"mtk1\">:     </span><span class=\"mtk12\">amt</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Splits</span><span class=\"mtk1\">.</span><span class=\"mtk11\">_collect</span><span class=\"mtk1\">(</span><span class=\"mtk12\">userId</span><span class=\"mtk1\">, </span><span class=\"mtk11\">_assetId</span><span class=\"mtk1\">(</span><span class=\"mtk12\">erc20</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">393</span><span class=\"mtk1\">:     </span><span class=\"mtk11\">_decreaseTotalBalance</span><span class=\"mtk1\">(</span><span class=\"mtk12\">erc20</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amt</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">394</span><span class=\"mtk1\">:     </span><span class=\"mtk12\">erc20</span><span class=\"mtk1\">.</span><span class=\"mtk11\">safeTransfer</span><span class=\"mtk1\">(</span><span class=\"mtk12\">msg</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sender</span><span class=\"mtk1\">, </span><span class=\"mtk12\">amt</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">395</span><span class=\"mtk1\">: }</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-6\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-6\" aria-label=\"recommended mitigation steps 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Consider removing the <code>whenNotPaused</code> modifier to allow collecting funds while the <code>DripsHub</code> contract is paused.</p>\n<h2 id=\"l-05-an-immutable-split-is-unable-to-collect-funds-if-it-has-itself-set-as-a-split-receiver\" style=\"position:relative;\"><a href=\"#l-05-an-immutable-split-is-unable-to-collect-funds-if-it-has-itself-set-as-a-split-receiver\" aria-label=\"l 05 an immutable split is unable to collect funds if it has itself set as a split receiver permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[L-05] An immutable split is unable to collect funds if it has itself set as a split receiver</h2>\n<p>An immutable split cannot collect funds if it has itself set as a split receiver. This is because the <code>ImmutableSplitsDriver</code> contract lacks the functionality to collect available funds.</p>\n<h3 id=\"findings-4\" style=\"position:relative;\"><a href=\"#findings-4\" aria-label=\"findings 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Findings</h3>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/9fd776b50f4be23ca038b1d0426e63a69c7a511d/src/ImmutableSplitsDriver.sol#L66\">ImmutableSplitsDriver.sol#L66</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">53</span><span class=\"mtk1\">: </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">createSplits</span><span class=\"mtk1\">(</span><span class=\"mtk12\">SplitsReceiver</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">calldata</span><span class=\"mtk1\"> </span><span class=\"mtk12\">receivers</span><span class=\"mtk1\">, </span><span class=\"mtk12\">UserMetadata</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">calldata</span><span class=\"mtk1\"> </span><span class=\"mtk12\">userMetadata</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">54:     </span><span class=\"mtk11\">public</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">55:     </span><span class=\"mtk11\">whenNotPaused</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">56:     </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">userId</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">57: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">58</span><span class=\"mtk1\">:     </span><span class=\"mtk12\">userId</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">nextUserId</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">59</span><span class=\"mtk1\">:     </span><span class=\"mtk12\">StorageSlot</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getUint256Slot</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_counterSlot</span><span class=\"mtk1\">).</span><span class=\"mtk12\">value</span><span class=\"mtk1\">++;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">60</span><span class=\"mtk1\">:     </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">weightSum</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">61</span><span class=\"mtk1\">:     </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">0</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">receivers</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\">++) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">62</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">weightSum</span><span class=\"mtk1\"> += </span><span class=\"mtk12\">receivers</span><span class=\"mtk1\">[</span><span class=\"mtk12\">i</span><span class=\"mtk1\">].</span><span class=\"mtk12\">weight</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">63</span><span class=\"mtk1\">:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">64</span><span class=\"mtk1\">:     </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">weightSum</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">totalSplitsWeight</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;Invalid total receivers weight&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">65</span><span class=\"mtk1\">:     </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">CreatedSplits</span><span class=\"mtk1\">(</span><span class=\"mtk12\">userId</span><span class=\"mtk1\">, </span><span class=\"mtk12\">dripsHub</span><span class=\"mtk1\">.</span><span class=\"mtk11\">hashSplits</span><span class=\"mtk1\">(</span><span class=\"mtk12\">receivers</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">66</span><span class=\"mtk1\">:     </span><span class=\"mtk12\">dripsHub</span><span class=\"mtk1\">.</span><span class=\"mtk11\">setSplits</span><span class=\"mtk1\">(</span><span class=\"mtk12\">userId</span><span class=\"mtk1\">, </span><span class=\"mtk12\">receivers</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">67</span><span class=\"mtk1\">:     </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">userMetadata</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) </span><span class=\"mtk12\">dripsHub</span><span class=\"mtk1\">.</span><span class=\"mtk11\">emitUserMetadata</span><span class=\"mtk1\">(</span><span class=\"mtk12\">userId</span><span class=\"mtk1\">, </span><span class=\"mtk12\">userMetadata</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">68</span><span class=\"mtk1\">: }</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-7\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-7\" aria-label=\"recommended mitigation steps 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Consider preventing setting one of the receivers to the user ID of the newly created immutable split.</p>\n<h2 id=\"n-01-the-natspec-comment-of-the-dripsconfigimpllt-function-neglects-to-sorting-of-dripid\" style=\"position:relative;\"><a href=\"#n-01-the-natspec-comment-of-the-dripsconfigimpllt-function-neglects-to-sorting-of-dripid\" aria-label=\"n 01 the natspec comment of the dripsconfigimpllt function neglects to sorting of dripid permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[N-01] The NatSpec comment of the <code>DripsConfigImpl.lt</code> function neglects to sorting of <code>dripId</code></h2>\n<p>According to the NatSpec comment of the <code>DripsConfigImpl.lt</code> function, the <code>DripsConfig</code> struct is sorted by <code>amtPerSec</code>, then <code>start</code> and then <code>duration</code>. However, the <code>dripId</code> is not mentioned in the comment:</p>\n<blockquote>\n<p>/// First compares their <code>amtPerSec</code>s, then their <code>start</code>s and then their <code>duration</code>s.</p>\n</blockquote>\n<h3 id=\"findings-5\" style=\"position:relative;\"><a href=\"#findings-5\" aria-label=\"findings 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Findings</h3>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/9fd776b50f4be23ca038b1d0426e63a69c7a511d/src/Drips.sol#L93\">Drips.sol#L93</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">92</span><span class=\"mtk1\">: </span><span class=\"mtk3\">/// @notice Compares two `DripsConfig`s.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">93</span><span class=\"mtk1\">: </span><span class=\"mtk3\">/// First compares their `amtPerSec`s, then their `start`s and then their `duration`s.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">94</span><span class=\"mtk1\">: </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">lt</span><span class=\"mtk1\">(</span><span class=\"mtk12\">DripsConfig</span><span class=\"mtk1\"> </span><span class=\"mtk12\">config</span><span class=\"mtk1\">, </span><span class=\"mtk12\">DripsConfig</span><span class=\"mtk1\"> </span><span class=\"mtk12\">otherConfig</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">pure</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">95</span><span class=\"mtk1\">:     </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">DripsConfig</span><span class=\"mtk1\">.</span><span class=\"mtk11\">unwrap</span><span class=\"mtk1\">(</span><span class=\"mtk12\">config</span><span class=\"mtk1\">) &lt; </span><span class=\"mtk12\">DripsConfig</span><span class=\"mtk1\">.</span><span class=\"mtk11\">unwrap</span><span class=\"mtk1\">(</span><span class=\"mtk12\">otherConfig</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">96</span><span class=\"mtk1\">: }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/9fd776b50f4be23ca038b1d0426e63a69c7a511d/src/Drips.sol#L1069\">Drips.sol#L1069</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">1061</span><span class=\"mtk1\">: </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_isOrdered</span><span class=\"mtk1\">(</span><span class=\"mtk12\">DripsReceiver</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prev</span><span class=\"mtk1\">, </span><span class=\"mtk12\">DripsReceiver</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">next</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">1062:     </span><span class=\"mtk11\">private</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">1063:     </span><span class=\"mtk11\">pure</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">1064:     </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">bool</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">1065: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">1066</span><span class=\"mtk1\">:     </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">prev</span><span class=\"mtk1\">.</span><span class=\"mtk12\">userId</span><span class=\"mtk1\"> != </span><span class=\"mtk12\">next</span><span class=\"mtk1\">.</span><span class=\"mtk12\">userId</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">1067</span><span class=\"mtk1\">:         </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prev</span><span class=\"mtk1\">.</span><span class=\"mtk12\">userId</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">next</span><span class=\"mtk1\">.</span><span class=\"mtk12\">userId</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">1068</span><span class=\"mtk1\">:     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">1069</span><span class=\"mtk1\">:     </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">prev</span><span class=\"mtk1\">.</span><span class=\"mtk12\">config</span><span class=\"mtk1\">.</span><span class=\"mtk11\">lt</span><span class=\"mtk1\">(</span><span class=\"mtk12\">next</span><span class=\"mtk1\">.</span><span class=\"mtk12\">config</span><span class=\"mtk1\">); </span><span class=\"mtk3\">// @audit-info `dripId` of receiver config (The 32 most significant bits) is considered while sorting receivers</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">1070</span><span class=\"mtk1\">: }</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-8\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-8\" aria-label=\"recommended mitigation steps 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Consider updating the NatSpec comment to include the <code>dripId</code> in the sorting order.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/282#issuecomment-1430315911\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p><em>(Note: See <a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/282#issuecomment-1430315911\">original submission</a> for judge’s full commentary.)</em></p>\n<p>9 Low, 1 Refactoring +3</p>\n<p>(includes  downgraded findings, see: <a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/274\">#274</a>, <a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/278\">#278</a>, <a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/280\">#280</a>, <a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/281\">#281</a>)</p>\n<p>Summing up all findings, this report is by far the most interesting, well done!</p>\n</blockquote>\n<hr>\n<h1 id=\"gas-optimizations\" style=\"position:relative;\"><a href=\"#gas-optimizations\" aria-label=\"gas optimizations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gas Optimizations</h1>\n<p>For this contest, 11 reports were submitted by wardens detailing gas optimizations. The <a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/81\">report highlighted below</a> by <strong>descharre</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/322\">NoamYakov</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/318\">Deivitto</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/297\">Aymen0909</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/270\">0xSmartContract</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/267\">matrix_0wl</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/237\">cryptostellar5</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/231\">0xA5DF</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/112\">ReyAdmirado</a>,\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/92\">Rolezn</a>, and\n<a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/62\">chaduke</a>\n.</em></p>\n<h2 id=\"gas-optimizations-summary\" style=\"position:relative;\"><a href=\"#gas-optimizations-summary\" aria-label=\"gas optimizations summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gas Optimizations Summary</h2>\n<table>\n<thead>\n<tr>\n<th align=\"center\">ID</th>\n<th align=\"left\">Finding</th>\n<th align=\"center\">Gas saved</th>\n<th align=\"center\">Instances</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">G-01</td>\n<td align=\"left\">Make for loop unchecked</td>\n<td align=\"center\">644</td>\n<td align=\"center\">13</td>\n</tr>\n<tr>\n<td align=\"center\">G-02</td>\n<td align=\"left\">Use an unchecked block when operands can’t underflow/overflow</td>\n<td align=\"center\">688</td>\n<td align=\"center\">7</td>\n</tr>\n<tr>\n<td align=\"center\">G-03</td>\n<td align=\"left\">Write element of storage struct to memory when used more than once</td>\n<td align=\"center\">10</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td align=\"center\">G-04</td>\n<td align=\"left\">Call block.timestamp direclty instead of function</td>\n<td align=\"center\">22</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td align=\"center\">G-05</td>\n<td align=\"left\">Make 3 event parameters indexed when possible</td>\n<td align=\"center\">1059</td>\n<td align=\"center\">2</td>\n</tr>\n<tr>\n<td align=\"center\">G-06</td>\n<td align=\"left\">Transfer erc20 immediately to Dripshub</td>\n<td align=\"center\">57824</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td align=\"center\">G-07</td>\n<td align=\"left\">Transfer ERC20 immediately to the user</td>\n<td align=\"center\">22112</td>\n<td align=\"center\">1</td>\n</tr>\n<tr>\n<td align=\"center\">G-08</td>\n<td align=\"left\">Use double if statements instead of &#x26;&#x26;</td>\n<td align=\"center\">4</td>\n<td align=\"center\">40</td>\n</tr>\n<tr>\n<td align=\"center\">G-09</td>\n<td align=\"left\">Miscellaneous</td>\n<td align=\"center\">100</td>\n<td align=\"center\">3</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"g-01-make-for-loop-unchecked\" style=\"position:relative;\"><a href=\"#g-01-make-for-loop-unchecked\" aria-label=\"g 01 make for loop unchecked permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-01] Make for loop unchecked</h2>\n<p>The risk of for loops getting overflowed is extremely low. Because it always increments by 1 and is limited to the arrays length. Even if the arrays are extremely long, it will take a massive amount of time and gas to let the for loop overflow.</p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Caller.sol#L196-L199\">Caller.sol#L196-L199</a>: <code>callBatched()</code> gas saved: 76</li>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/ImmutableSplitsDriver.sol#L61-L63\">ImmutableSplitsDriver.sol#L61-L63</a>: <code>createSplits()</code> gas saved: 92</li>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L247-L249\">Drips.sol#L247-L249</a>: <code>DripsHub: receiveDrips()</code> gas saved: 58 </li>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L287-L291\">Drips.sol#L287-L291</a>: <code>DripsHub: receiveDripsResult()</code> gas saved: 54</li>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L357-L364\">Drips.sol#L357-L364</a>: <code>DripsHub: squeezeDrips()</code> gas saved: 32</li>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L450-L459\">Drips.sol#L450-L459</a>: <code>DripsHub: squeezeDripsResult()</code> gas saved: 71</li>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L490-L497\">Drips.sol#L490-L497</a>: <code>DripsHub: squeezeDripsResult()</code> gas saved: 29</li>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L563-L573\">Drips.sol#L563-L573</a>: <code>DripsHub: balanceAt()</code> gas saved: 59</li>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L662-L668\">Drips.sol#L662-L668</a>: <code>DripsHub: setDrips()</code> gas saved: 31</li>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/DripsHub.sol#L613-L616\">DripsHub.sol#L613-L616</a>: <code>emitUserMetadata()</code> gas saved: 59</li>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Splits.sol#L127-L129\">Splits.sol#L127-L129</a>: <code>DripsHub: splitResult()</code> gas saved: 10</li>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Splits.sol#L158-L166\">Splits.sol#L158-L166</a>: <code>DripsHub: split()</code> gas saved: 10</li>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Splits.sol#L231-L243\">Splits.sol#L231-L243</a>: <code>DripsHub: setSplits()</code> gas saved: 63</li>\n</ul>\n<p>There are 2 ways to make a for loop unchecked in a safe way:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-       for (uint256 i = 0; i &lt; calls.length; i++) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-       for (uint256 i = 0; i &lt; calls.length;) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            Call memory call = calls[i];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            returnData[i] = _call(sender, call.to, call.data, call.value);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+           unchecked{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+              i++</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+           } </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span></code></pre>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       function unchecked_inc(uint256 x) private pure returns (uint256) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+          unchecked {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+             return x + 1;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+          }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-       for (uint256 i = 0; i &lt; calls.length; i++) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       for (uint256 i = 0; i &lt; calls.length;  i = unchecked_inc(i)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            Call memory call = calls[i];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            returnData[i] = _call(sender, call.to, call.data, call.value);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span></code></pre>\n<h2 id=\"g-02-use-an-unchecked-block-when-operands-cant-underflowoverflow\" style=\"position:relative;\"><a href=\"#g-02-use-an-unchecked-block-when-operands-cant-underflowoverflow\" aria-label=\"g 02 use an unchecked block when operands cant underflowoverflow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-02] Use an unchecked block when operands can’t underflow/overflow</h2>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L480\">Drips.sol#L480</a></p>\n<p>Division can’t overflow or underflow unless the divisor is -1. Which is not the case here. <code>DripsHub: squeezeDripsResult()</code> gas saved: 60</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">idxMid</span><span class=\"mtk1\"> = (</span><span class=\"mtk12\">idx</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">idxCap</span><span class=\"mtk1\">) / </span><span class=\"mtk7\">2</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L655\">Drips.sol#L655</a></p>\n<p>There is no possibility of overflowing when incrementing by one. currCycleConfigs is a uint32 but even for that will take a massive amount of time to make it overflow. <code>DripsHub: setDrips()</code> gas saved: 215</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">state</span><span class=\"mtk1\">.</span><span class=\"mtk12\">currCycleConfigs</span><span class=\"mtk1\">++;</span></span></span></code></pre>\n<p>For ++, the same applies to:</p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L428\">Drips.sol#L428</a> <code>DripsHub: squeezeDrips()</code> gas saved: 28</li>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L959\">Drips.sol#L959</a> and <a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L962\">Drips.sol#L962</a>: <code>DripsHub: setDrips()</code> gas saved: 35</li>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/DripsHub.sol#L136\">DripsHub.sol#L136</a> <code>DripsHub: registerDriver()</code> gas saved: 200</li>\n</ul>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/DripsHub.sol#L632\">DripsHub.sol#L632</a>: because of the require statement above, it can’t overflow. <code>give()</code> gas saved: 54</p>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/DripsHub.sol#L636\">DripsHub.sol#L636</a>: amount will never be larger than the total balance: <code>collect()</code> gas saved: 96</p>\n<h2 id=\"g-03-write-element-of-storage-struct-to-memory-when-used-more-than-once\" style=\"position:relative;\"><a href=\"#g-03-write-element-of-storage-struct-to-memory-when-used-more-than-once\" aria-label=\"g 03 write element of storage struct to memory when used more than once permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-03] Write element of storage struct to memory when used more than once</h2>\n<p>When a struct contains a nested mapping, it’s not possible to save it in memory. But it’s possible to save one element of the struct to memory when it’s used more than once. <code>DripsHub: balanceAt()</code> gas saved: 10</p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L539-L542\">Drips.sol#L539-L542</a></li>\n</ul>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        DripsState storage state = _dripsStorage().states[assetId][userId];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       uint32 updateTime = state.updateTime;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-       require(timestamp &gt;= state.updateTime, &quot;Timestamp before last drips update&quot;);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       require(timestamp &gt;= updateTime, &quot;Timestamp before last drips update&quot;);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        require(_hashDrips(receivers) == state.dripsHash, &quot;Invalid current drips list&quot;);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-       return _balanceAt(state.balance, state.updateTime, state.maxEnd, receivers, timestamp);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       return _balanceAt(state.balance, updateTime, state.maxEnd, receivers, timestamp);</span></span></span></code></pre>\n<h2 id=\"g-04-call-blocktimestamp-direclty-instead-of-function\" style=\"position:relative;\"><a href=\"#g-04-call-blocktimestamp-direclty-instead-of-function\" aria-label=\"g 04 call blocktimestamp direclty instead of function permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-04] Call block.timestamp direclty instead of function</h2>\n<p>The <code>_currTimestamp()</code> function casts the <code>block.timestamp</code> to a uint32. However it’s not always necessary to have a uint32.</p>\n<p>In the example below you are assigning the timestamp to a uint256. Which makes it unnecessary to cast the timestamp to uint32. So it’s better to call <code>block.timestamp</code> directly.</p>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L689\">Drips.sol#L689</a>: <code>DripsHub: setDrips()</code> gas saved: 22</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-    uint256 enoughEnd = _currTimestamp();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    uint256 enoughEnd = block.timestamp;</span></span></span></code></pre>\n<h2 id=\"g-05-make-3-event-parameters-indexed-when-possible\" style=\"position:relative;\"><a href=\"#g-05-make-3-event-parameters-indexed-when-possible\" aria-label=\"g 05 make 3 event parameters indexed when possible permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-05] Make 3 event parameters indexed when possible</h2>\n<p>It’s the most gas efficient to make up to 3 event parameters indexed. If there are less than 3 parameters, you need to make all parameters indexed.</p>\n<ul>\n<li>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/DripsHub.sol#L93\">DripsHub.sol#L93</a></p>\n<pre><code class=\"language-diff\"></code></pre>\n</li>\n<li>event UserMetadataEmitted(uint256 indexed userId, bytes32 indexed key, bytes value);</li>\n<li>\n<p>event UserMetadataEmitted(uint256 indexed userId, bytes32 indexed key, bytes indexed value);</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">The event is used in the function emitUserMetaData, this function is used multiple times. The gas saved for making all the parameters indexed is:</span></span></code></pre>\n</li>\n<li>DripsHub.sol: <code>emitUserMetadata()</code> gas saved: 364</li>\n<li>AddressDriver.sol: <code>emitUserMetadata()</code> gas saved: 208</li>\n<li>ImmutableSplitsDriver.sol: <code>createSplits()</code> gas saved: 139</li>\n<li>NFTDriver.sol: <code>emitUserMetadata()</code> gas saved: 139</li>\n<li>NFTDriver.sol: <code>safeMint()</code> gas saved: 209</li>\n</ul>\n<p>The same extra indexed parameter can be applied to:</p>\n<ul>\n<li>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L153\">Drips.sol#L153</a> <code>DripsHub: setDrips()</code></p>\n<h2 id=\"g-06-transfer-erc20-immediately-to-dripshub\" style=\"position:relative;\"><a href=\"#g-06-transfer-erc20-immediately-to-dripshub\" aria-label=\"g 06 transfer erc20 immediately to dripshub permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-06] Transfer erc20 immediately to Dripshub</h2>\n</li>\n<li><code>Dripshub: give()</code> gas saved: 9449</li>\n<li><code>AddressDriver: give()</code> gas saved: 29439</li>\n<li><code>NFTDriver: give()</code> gas saved: 18936</li>\n</ul>\n<p>When you call the <code>give()</code> function in the Address or NFTDriver. The erc20 token are first getting send to those contracts and afterwards to the DripsHub contract. It’s also possible to send the tokens directly to the dripsHub contract.</p>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/AddressDriver.sol#L170-L176\">AddressDriver.sol#L170-L176</a> <a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/NFTDriver.sol#L285-L291\">NFTDriver.sol#L285-L291</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"19\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    function _transferFromCaller(IERC20 erc20, uint128 amt) internal {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-       erc20.safeTransferFrom(_msgSender(), address(this), amt);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       erc20.safeTransferFrom(_msgSender(), address(dripsHub), amt);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        // Approval is done only on the first usage of the ERC-20 token in DripsHub by the driver</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-       if (erc20.allowance(address(this), address(dripsHub)) == 0) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-           erc20.safeApprove(address(dripsHub), type(uint256).max);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/DripsHub.sol#L417\">DripsHub.sol#L417</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"20\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    function give(uint256 userId, uint256 receiver, IERC20 erc20, uint128 amt)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        public</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        whenNotPaused</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        onlyDriver(userId)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        _increaseTotalBalance(erc20, amt);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        Splits._give(userId, receiver, _assetId(erc20), amt);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-       erc20.safeTransferFrom(msg.sender, address(this), amt);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>setDrips need to be adjusted or you can create a seperate function for that.</p>\n<h2 id=\"g-07-transfer-erc20-immediately-to-the-user\" style=\"position:relative;\"><a href=\"#g-07-transfer-erc20-immediately-to-the-user\" aria-label=\"g 07 transfer erc20 immediately to the user permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-07] Transfer ERC20 immediately to the user</h2>\n<ul>\n<li><code>AddressDriver: collect()</code> gas saved: 12954</li>\n<li><code>NFTDriver: collect()</code> gas saved: 9158</li>\n</ul>\n<p>The same thing can be done for the <code>collect()</code> function. Instead of transferring first to the address or NFTdriver. You can instantly transfer to the user.\n<a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/DripsHub.sol#L386-L395\">DripsHub.sol#L386-L395)</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"21\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-   function collect(uint256 userId, IERC20 erc20)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+   function collect(uint256 userId, IERC20 erc20, address transferTo)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        public</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        whenNotPaused</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        onlyDriver(userId)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        returns (uint128 amt)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        amt = Splits._collect(userId, _assetId(erc20));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        _decreaseTotalBalance(erc20, amt);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-       erc20.safeTransfer(msg.sender, amt);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       erc20.safeTransfer(transferTo, amt);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/AddressDriver.sol#L60-L63\">AddressDriver.sol#L60-L63</a></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"22\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    function collect(IERC20 erc20, address transferTo) public whenNotPaused returns (uint128 amt) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-       amt = dripsHub.collect(callerUserId(), erc20);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       amt = dripsHub.collect(callerUserId(), erc20, transferTo);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-       erc20.safeTransfer(transferTo, amt);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<h2 id=\"g-08-use-double-if-statements-instead-of-\" style=\"position:relative;\"><a href=\"#g-08-use-double-if-statements-instead-of-\" aria-label=\"g 08 use double if statements instead of  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-08] Use double if statements instead of &#x26;&#x26;</h2>\n<p>If the if statement has a logical AND and is not followed by an else statement, it can be replaced with 2 if statements.</p>\n<ul>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L700\">Drips.sol#L700</a></li>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L709\">Drips.sol#L709</a></li>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L909\">Drips.sol#L909</a></li>\n<li><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L929\">Drips.sol#L929</a></li>\n</ul>\n<h2 id=\"g-09-miscellaneous\" style=\"position:relative;\"><a href=\"#g-09-miscellaneous\" aria-label=\"g 09 miscellaneous permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G-09] Miscellaneous</h2>\n<h3 id=\"dont-call-a-function-when-initializing-an-immutable-variable\" style=\"position:relative;\"><a href=\"#dont-call-a-function-when-initializing-an-immutable-variable\" aria-label=\"dont call a function when initializing an immutable variable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Don’t call a function when initializing an immutable variable</h3>\n<p>Saves a little bit of deployment gas</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"23\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-   bytes32 private immutable _counterSlot = _erc1967Slot(&quot;eip1967.immutableSplitsDriver.storage&quot;);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+   bytes32 private immutable _counterSlot = bytes32(uint256(keccak256(bytes(&quot;eip1967.immutableSplitsDriver.storage&quot;))) - 1);</span></span></span></code></pre>\n<h3 id=\"use-a-mapping-type-of-a-struct-directly-instead-of-assigning-it-to-another-storage-variable\" style=\"position:relative;\"><a href=\"#use-a-mapping-type-of-a-struct-directly-instead-of-assigning-it-to-another-storage-variable\" aria-label=\"use a mapping type of a struct directly instead of assigning it to another storage variable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Use a mapping type of a struct directly instead of assigning it to another storage variable</h3>\n<ul>\n<li>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L246-L254\">Drips.sol#L246-L254</a></p>\n<pre><code class=\"language-diff\"></code></pre>\n</li>\n<li>mapping(uint32 => AmtDelta) storage amtDeltas = state.amtDeltas;\nfor (uint32 cycle = fromCycle; cycle &#x3C; toCycle; cycle++) {</li>\n<li>delete amtDeltas[cycle];</li>\n<li>delete state.amtDeltas[cycle];\n}\n// The next cycle delta must be relative to the last received cycle, which got zeroed.\n// In other words the next cycle delta must be an absolute value.\nif (finalAmtPerCycle != 0) {</li>\n<li>amtDeltas[toCycle].thisCycle += finalAmtPerCycle;</li>\n<li>\n<p>state.amtDeltas[toCycle].thisCycle += finalAmtPerCycle;\n}</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"24\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">### If statement can be adjusted</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">In the `_receiveDrips()` function you can change the check to `receivedAmt != 0`. Because when fromCycle and toCycle are the same. ReceivedAmt will be 0.</span></span></code></pre>\n</li>\n</ul>\n<p><a href=\"https://github.com/code-423n4/2023-01-drips/blob/main/src/Drips.sol#L243\">Drips.sol#L243</a> <code>receiveDrips()</code> gas saved: 75</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"25\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        (receivedAmt, receivableCycles, fromCycle, toCycle, finalAmtPerCycle) =</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            _receiveDripsResult(userId, assetId, maxCycles);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-       if (fromCycle != toCycle) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+       if (receivedAmt != 0) {</span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2023-01-drips-findings/issues/81#issuecomment-1431565422\">Alex the Entreprenerd (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Best because the savings are high impact and tangible.</p>\n<p>[G-01]\tMake for loop unchecked\t644\t13</p>\n<p>Let’s say 260 gas (13 * 20)</p>\n<p>[G-02]\tUse an unchecked block when operands can’t underflow/overflow\t688\t7</p>\n<p>20 * 7 = 140</p>\n<p>[G-03]\tWrite element of storage struct to memory when used more than once\t10\t1</p>\n<p>100 gas</p>\n<p>[G-04]\tCall block.timestamp direclty instead of function\t22\t1</p>\n<p>16</p>\n<p>[G-06]\tTransfer erc20 immediately to Dripshub\t57824\t1</p>\n<p>5k</p>\n<p>[G-07]\tTransfer ERC20 immediately to the user\t22112\t1</p>\n<p>5k</p>\n<p>Rest is marginal</p>\n<p>10k+</p>\n</blockquote>\n<hr>\n<h1 id=\"disclosures\" style=\"position:relative;\"><a href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Disclosures</h1>\n<p>C4 is an open organization governed by participants in the community.</p>\n<p>C4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.</p>\n<p>C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk10 { color: #4EC9B0; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>",
  "toc": "<ul>\n<li>\n<p><a href=\"#overview\">Overview</a></p>\n<ul>\n<li><a href=\"#about-c4\">About C4</a></li>\n<li><a href=\"#wardens\">Wardens</a></li>\n</ul>\n</li>\n<li><a href=\"#summary\">Summary</a></li>\n<li><a href=\"#scope\">Scope</a></li>\n<li><a href=\"#severity-criteria\">Severity Criteria</a></li>\n<li>\n<p><a href=\"#high-risk-findings-1\">High Risk Findings (1)</a></p>\n<ul>\n<li><a href=\"#h-01-drips-that-end-after-the-current-cycle-but-before-its-creation-can-allow-users-to-profit-from-squeezing\">[H-01] Drips that end after the current cycle but before its creation can allow users to profit from squeezing</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#medium-risk-findings-2\">Medium Risk Findings (2)</a></p>\n<ul>\n<li><a href=\"#m-01-squeezing-drips-from-a-sender-can-be-front-run-and-prevented-by-the-sender\">[M-01] Squeezing drips from a sender can be front-run and prevented by the sender</a></li>\n<li><a href=\"#m-02-unauthorize-can-be-front-run-so-that-the-malicious-authorized-user-would-get-their-authority-back\">[M-02] <code>unauthorize()</code> can be front-run so that the malicious authorized user would get their authority back</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#low-risk-and-non-critical-issues\">Low Risk and Non-Critical Issues</a></p>\n<ul>\n<li><a href=\"#l-01-an-authorized-user-can-unauthorize-other-authorized-users-of-the-same-sender\">L-01 An authorized user can unauthorize other authorized users of the same sender</a></li>\n<li><a href=\"#l-02-lack-of-reasonable-boundaries-for-cycle-secs\">L-02 Lack of reasonable boundaries for cycle secs</a></li>\n<li><a href=\"#l-03-unused-dripid-of-receiver-config-is-used-considered-while-sorting-receivers\">L-03 Unused <code>dripId</code> of receiver config is used considered while sorting receivers</a></li>\n<li><a href=\"#l-04-collecting-funds-should-be-usable-while-the-dripshub-contract-is-paused\">L-04 Collecting funds should be usable while the <code>DripsHub</code> contract is paused</a></li>\n<li><a href=\"#l-05-an-immutable-split-is-unable-to-collect-funds-if-it-has-itself-set-as-a-split-receiver\">L-05 An immutable split is unable to collect funds if it has itself set as a split receiver</a></li>\n<li><a href=\"#n-01-the-natspec-comment-of-the-dripsconfigimpllt-function-neglects-to-sorting-of-dripid\">N-01 The NatSpec comment of the <code>DripsConfigImpl.lt</code> function neglects to sorting of <code>dripId</code></a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#gas-optimizations\">Gas Optimizations</a></p>\n<ul>\n<li><a href=\"#gas-optimizations-summary\">Gas Optimizations Summary</a></li>\n<li><a href=\"#g-01-make-for-loop-unchecked\">G-01 Make for loop unchecked</a></li>\n<li><a href=\"#g-02-use-an-unchecked-block-when-operands-cant-underflowoverflow\">G-02 Use an unchecked block when operands can’t underflow/overflow</a></li>\n<li><a href=\"#g-03-write-element-of-storage-struct-to-memory-when-used-more-than-once\">G-03 Write element of storage struct to memory when used more than once</a></li>\n<li><a href=\"#g-04-call-blocktimestamp-direclty-instead-of-function\">G-04 Call block.timestamp direclty instead of function</a></li>\n<li><a href=\"#g-05-make-3-event-parameters-indexed-when-possible\">G-05 Make 3 event parameters indexed when possible</a></li>\n<li><a href=\"#g-07-transfer-erc20-immediately-to-the-user\">G-07 Transfer ERC20 immediately to the user</a></li>\n<li><a href=\"#g-08-use-double-if-statements-instead-of-\">G-08 Use double if statements instead of &#x26;&#x26;</a></li>\n<li><a href=\"#g-09-miscellaneous\">G-09 Miscellaneous</a></li>\n</ul>\n</li>\n<li><a href=\"#disclosures\">Disclosures</a></li>\n</ul>"
}