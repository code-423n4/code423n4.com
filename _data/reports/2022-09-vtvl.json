{
  "circa": {
    "title": "VTVL contest",
    "sponsor": "VTVL",
    "slug": "2022-09-vtvl",
    "date": "2022-11-01",
    "findings": "https://github.com/code-423n4/2022-09-vtvl-findings/issues",
    "contest": 164
  },
  "html": "<h1 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h1>\n<h2 id=\"about-c4\" style=\"position:relative;\"><a href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>About C4</h2>\n<p>Code4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.</p>\n<p>A C4 audit contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.</p>\n<p>During the audit contest outlined in this document, C4 conducted an analysis of the VTVL smart contract system written in Solidity. The audit contest took place between September 20—September 23 2022.</p>\n<h2 id=\"wardens\" style=\"position:relative;\"><a href=\"#wardens\" aria-label=\"wardens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wardens</h2>\n<p>208 Wardens contributed reports to the VTVL contest:</p>\n<ol>\n<li>pashov</li>\n<li>sorrynotsorry</li>\n<li><a href=\"https://twitter.com/RespxR\">Respx</a></li>\n<li><a href=\"https://twitter.com/father0fBl0cks\">fatherOfBlocks</a></li>\n<li>m9800</li>\n<li>wagmi</li>\n<li>CertoraInc (egjlmn1, <a href=\"https://twitter.com/ori_dabush\">OriDabush</a>, ItayG, shakedwinder, and RoiEvenHaim)</li>\n<li><a href=\"https://twitter.com/csanuragjain\">csanuragjain</a></li>\n<li><a href=\"https://mobile.twitter.com/tomj_bb\">TomJ</a></li>\n<li><a href=\"https://twitter.com/hansfriese\">hansfriese</a></li>\n<li>ayeslick</li>\n<li>Lambda</li>\n<li>rbserver</li>\n<li>KIntern_NA (TrungOre and duc)</li>\n<li>neko_nyaa</li>\n<li><a href=\"twitter.com/rokinot\">rokinot</a></li>\n<li>0xSky</li>\n<li>neumo</li>\n<li><a href=\"https://twitter.com/bin2chen\">bin2chen</a></li>\n<li><a href=\"https://twitter.com/trust__90\">Trust</a></li>\n<li><a href=\"https://twitter.com/WahWaste\">wastewa</a></li>\n<li>datapunk</li>\n<li>0xhunter</li>\n<li>dipp</li>\n<li><a href=\"https://twitter.com/wuwe19\">wuwe1</a></li>\n<li>IllIllI</li>\n<li><a href=\"https://twitter.com/0xruhum\">Ruhum</a></li>\n<li><a href=\"https://twitter.com/zachobront\">obront</a></li>\n<li>RustyRabbit</li>\n<li><a href=\"https://twitter.com/0xSmartContract\">0xSmartContract</a></li>\n<li>0xA5DF</li>\n<li><a href=\"https://twitter.com/Pedroais2/\">pedroais</a></li>\n<li><a href=\"https://twitter.com/pcarranzav\">pcarranzav</a></li>\n<li><a href=\"https://twitter.com/ElKu_crypto\">ElKu</a></li>\n<li><a href=\"https://twitter.com/_Czar102\">Czar102</a></li>\n<li>sashik_eth</li>\n<li><a href=\"https://twitter.com/SolidityDev\">pauliax</a></li>\n<li>0x52</li>\n<li><a href=\"https://twitter.com/0xdapper_\">0xdapper</a></li>\n<li>eierina</li>\n<li>AkshaySrivastav</li>\n<li>JohnSmith</li>\n<li>__141345__</li>\n<li>djxploit</li>\n<li><a href=\"https://decorativepineapple.github.io/\">0xDecorativePineapple</a></li>\n<li>zzzitron</li>\n<li><a href=\"https://twitter.com/0xhyh\">hyh</a></li>\n<li><a href=\"https://milotruck.github.io/\">MiloTruck</a></li>\n<li>rotcivegaf</li>\n<li>JLevick</li>\n<li><a href=\"https://github.com/Aymen1001\">Aymen0909</a></li>\n<li><a href=\"https://twitter.com/harshit16024263\">supernova</a></li>\n<li>0x4non</li>\n<li><a href=\"https://chom.dev\">Chom</a></li>\n<li>ak1</li>\n<li><a href=\"https://twitter.com/0xNazgul\">0xNazgul</a></li>\n<li>0x1f8b</li>\n<li><a href=\"https://twitter.com/rajat_beladiya\">rajatbeladiya</a></li>\n<li><a href=\"https://twitter.com/JoeStakey\">joestakey</a></li>\n<li><a href=\"https://twitter.com/berndartmueller\">berndartmueller</a></li>\n<li><a href=\"https://twitter.com/c3ph_\">c3phas</a></li>\n<li>lukris02</li>\n<li><a href=\"https://t.me/pfahard\">pfapostol</a></li>\n<li>ajtra</li>\n<li>imare</li>\n<li>cryptostellar5</li>\n<li><a href=\"https://twitter.com/Deivitto\">Deivitto</a></li>\n<li><a href=\"https://www.linkedin.com/in/georgi-nikolaev-georgiev-978253219\">gogo</a></li>\n<li>Bnke0x0</li>\n<li><a href=\"https://twitter.com/andyfeili\">oyc_109</a></li>\n<li><a href=\"https://twitter.com/sm4rtcontr4ct\">JC</a></li>\n<li><a href=\"https://github.com/lyciumlee\">durianSausage</a></li>\n<li>Diana</li>\n<li>brgltd</li>\n<li>ladboy233</li>\n<li><a href=\"https://tom-sol.notion.site/Who-am-I-3b4dc28e77b647eb90794735a94dd38e\">Tomo</a></li>\n<li>Rolezn</li>\n<li><a href=\"https://twitter.com/seynixyz\">seyni</a></li>\n<li>0xbepresent</li>\n<li>peanuts</li>\n<li>OptimismSec (<a href=\"http://seanseefried.org/blog\">sseefried</a> and <a href=\"https://twitter.com/dediranTofunmi\">tofunmi</a>)</li>\n<li>d3e4</li>\n<li>RockingMiles (robee and pants)</li>\n<li>Waze</li>\n<li>tnevler</li>\n<li><a href=\"https://instagram.com/vanensurya\">Funen</a></li>\n<li><a href=\"https://twitter.com/a12jmx\">a12jmx</a></li>\n<li><a href=\"https://twitter.com/prasantgupta52\">prasantgupta52</a></li>\n<li><a href=\"https://twitter.com/Sm4rty_\">Sm4rty</a></li>\n<li><a href=\"https://github.com/martin-petrov03\">martin</a></li>\n<li>delfin454000</li>\n<li>leosathya</li>\n<li>RaymondFam</li>\n<li><a href=\"https://twitter.com/ROHANJH56009256\">Rohan16</a></li>\n<li>erictee</li>\n<li>millersplanet</li>\n<li>aysha</li>\n<li>ChristianKuri</li>\n<li>V_B (Barichek and vlad_bochok)</li>\n<li>CodingNameKiki</li>\n<li>karanctf</li>\n<li><a href=\"https://twitter.com/ret2basic\">ret2basic</a></li>\n<li><a href=\"https://twitter.com/mehmeddukov\">medikko</a></li>\n<li>slowmoses</li>\n<li>ReyAdmirado</li>\n<li>B2</li>\n<li>peiw</li>\n<li>0x040</li>\n<li>carrotsmuggler</li>\n<li>ikbkln</li>\n<li>async</li>\n<li>sach1r0</li>\n<li>rvierdiiev</li>\n<li>eighty</li>\n<li><a href=\"https://twitter.com/0xheynacho\">ignacio</a></li>\n<li>bobirichman</li>\n<li>got_targ</li>\n<li>nalus</li>\n<li>cryptphi</li>\n<li>SooYa</li>\n<li>tibthecat</li>\n<li><a href=\"https://twitter.com/natzuu33\">natzuu</a></li>\n<li><a href=\"https://twitter.com/krenkmet\">indijanc</a></li>\n<li>2997ms</li>\n<li><a href=\"https://github.com/exd0tpy\">exd0tpy</a></li>\n<li>MasterCookie</li>\n<li>StevenL</li>\n<li>bulej93</li>\n<li>Diraco</li>\n<li><a href=\"https://twitter.com/_0v3rf10w\">0v3rf10w</a></li>\n<li>0x85102</li>\n<li>Yiko</li>\n<li>Bahurum</li>\n<li>chatch</li>\n<li>0xmatt</li>\n<li>cccz</li>\n<li><a href=\"https://twitter.com/innertia_jp\">innertia</a></li>\n<li>reassor</li>\n<li>zzykxx</li>\n<li>0x5rings</li>\n<li>ubermensch</li>\n<li>0xf15ers (remora and twojoy)</li>\n<li><a href=\"https://twitter.com/BowTiedDravee\">Dravee</a></li>\n<li>JohnnyTime</li>\n<li>Aeros</li>\n<li>yongskiws</li>\n<li>romand</li>\n<li>dic0de</li>\n<li>peritoflores</li>\n<li>sikorico</li>\n<li>Margaret</li>\n<li>pedr02b2</li>\n<li><a href=\"https://twitter.com/ch13fd357r0y3r\">ch13fd357r0y3r</a></li>\n<li>Junnon</li>\n<li>Atarpara</li>\n<li>jag</li>\n<li>DimitarDimitrov</li>\n<li><a href=\"https://github.com/romeroadrian\">adriro</a></li>\n<li><a href=\"https://zishansami102.github.io/\">zishansami</a></li>\n<li>ch0bu</li>\n<li>SnowMan</li>\n<li>Saintcode_</li>\n<li>0xsam</li>\n<li>gianganhnguyen</li>\n<li><a href=\"https://twitter.com/WilliamAmbrozic\">WilliamAmbrozic</a></li>\n<li><a href=\"https://twitter.com/meidhiwirara\">Tomio</a></li>\n<li>samruna</li>\n<li>yaemsobak</li>\n<li>emrekocak</li>\n<li><a href=\"https://github.com/htadashi\">Tadashi</a></li>\n<li>tgolding55</li>\n<li><a href=\"https://twitter.com/bluenights004\">Ocean_Sky</a></li>\n<li>caventa</li>\n<li>beardofginger</li>\n<li><a href=\"https://twitter.com/im_Dharma09\">dharma09</a></li>\n<li>malinariy</li>\n<li>lucacez</li>\n<li>subtle77</li>\n<li><a href=\"https://twitter.com/DanielCawleyDev\">0xDanielC</a></li>\n<li>mics</li>\n<li>w0Lfrum</li>\n<li>hxzy</li>\n<li>Amithuddar</li>\n<li>Tagir2003</li>\n<li>0xc0ffEE</li>\n<li><a href=\"https://twitter/@Satyam33sharma\">Satyam_Sharma</a></li>\n<li>Noah3o6</li>\n<li>jpserrat</li>\n<li>Matin</li>\n<li>Sta1400</li>\n<li><a href=\"https://veranos.io\">mrpathfindr</a></li>\n<li>francoHacker</li>\n<li>cRat1st0s</li>\n<li>cryptonue</li>\n<li><a href=\"https://franfran.dev/\">Franfran</a></li>\n<li>GimelSec (<a href=\"https://twitter.com/rayn731\">rayn</a> and sces60107)</li>\n<li>JGcarv</li>\n<li>Soosh</li>\n</ol>\n<p>This contest was judged by <a href=\"https://github.com/0xean\">0xean</a>.</p>\n<p>Final report assembled by <a href=\"https://twitter.com/liveactionllama\">liveactionllama</a>.</p>\n<h1 id=\"summary\" style=\"position:relative;\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h1>\n<p>The C4 analysis yielded an aggregated total of 12 unique vulnerabilities. Of these vulnerabilities, 2 received a risk rating in the category of HIGH severity and 10 received a risk rating in the category of MEDIUM severity.</p>\n<p>Additionally, C4 analysis included 135 reports detailing issues with a risk rating of LOW severity or non-critical. There were also 141 reports recommending gas optimizations.</p>\n<p>All of the issues presented here are linked back to their original finding.</p>\n<h1 id=\"scope\" style=\"position:relative;\"><a href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scope</h1>\n<p>The code under review can be found within the <a href=\"https://github.com/code-423n4/2022-09-vtvl\">C4 VTVL contest repository</a>, and is composed of 4 smart contracts written in the Solidity programming language and includes 239 lines of Solidity code.</p>\n<h1 id=\"severity-criteria\" style=\"position:relative;\"><a href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Severity Criteria</h1>\n<p>C4 assesses the severity of disclosed vulnerabilities according to a methodology based on <a href=\"https://owasp.org/www-community/OWASP_Risk_Rating_Methodology\">OWASP standards</a>.</p>\n<p>Vulnerabilities are divided into three primary risk categories: high, medium, and low/non-critical.</p>\n<p>High-level considerations for vulnerabilities span the following key areas when conducting assessments:</p>\n<ul>\n<li>Malicious Input Handling</li>\n<li>Escalation of privileges</li>\n<li>Arithmetic</li>\n<li>Gas use</li>\n</ul>\n<p>Further information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on <a href=\"https://code4rena.com\">the C4 website</a>.</p>\n<h1 id=\"high-risk-findings-2\" style=\"position:relative;\"><a href=\"#high-risk-findings-2\" aria-label=\"high risk findings 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>High Risk Findings (2)</h1>\n<h2 id=\"h-01-loss-of-vested-amounts\" style=\"position:relative;\"><a href=\"#h-01-loss-of-vested-amounts\" aria-label=\"h 01 loss of vested amounts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/475\">[H-01] Loss of vested amounts</a></h2>\n<p><em>Submitted by eierina, also found by 0x52, 0xA5DF, 0xdapper, ElKu, obront, pauliax, pcarranzav, pedroais, rbserver, Ruhum, RustyRabbit, and TomJ</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L418\">VTVLVesting.sol#L418</a><br>\n<a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L147-L151\">VTVLVesting.sol#L147-L151</a><br>\n<a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L364\">VTVLVesting.sol#L364</a><br></p>\n<p>Vesting is a legal term that means the point in time where property is earned or gained by some person.<br>\nThe VTVLVesting contract defines:</p>\n<ul>\n<li>a start time (<code>Claim::startTimestamp</code>) and an end time (<code>Claim::endTimestamp</code>) at which vesting starts and ends for a entitled user</li>\n<li>the calculated points in time when the fractions of the total amount are released and therefore can be withdrawn (which are defined by <code>Claim::releaseIntervalSecs</code>).</li>\n</ul>\n<p>The entitled user can either withdraw after each interval elapses, or after the whole vesting period is over or any variant of the two options.</p>\n<p>The administrator of the contract can revoke the claim for a user at any time, which for vesting assets is expected. For example an employee with a vesting stock allocation of 1000 shares vesting at each quarter over a period of 4 years, may resign after 2 years and therefore the only half of the shares would be vested and therefore sold by the employee. The employee can either sell them at each quarter, or before, or after resigning, in any case the half of the shares have vested and are by legal right owned by the employee.</p>\n<p>The VTVLContract revoke has the following defects:</p>\n<ul>\n<li>it ignores the amount already vested and now yet withdrawn</li>\n<li>if called, say half-way the total period, just after claimer withdraws the already vested amount, it revokes only the right to vest the remaining part in future.</li>\n<li>if called, say half-way the total period, right before the claimer withdraws the already vested amount, it revokes both the already vested amount and the right to vest the remaining part in future.</li>\n</ul>\n<p>Raising as high impact because it actually causes:</p>\n<ul>\n<li>loss of already vested amounts of a user with a valid claim that has already righteously vested a part but not withdrawn</li>\n<li>different outcomes depending on the order in which withdraw and revokeClaim functions are called which means that one of the two behavoiurs is certainly in conflict with the other causing a loss on one of the two sides, contract or claimer (by definition of Vesting rights, the claimer).</li>\n<li>lack of trust by the potential claimers/users whch can be at any time deprived of righteously vested amounts.</li>\n</ul>\n<h3 id=\"proof-of-concept\" style=\"position:relative;\"><a href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>The following two tests prove the behaviour difference when the order by which revokeClaim vs withdraw are called, whch shows that the vesting right is not guaranteed.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">// NOTE: USES ORIGINAL REVOKE BEHAVIOUR</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">it</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;sample revoke use case USER LOSE: employee withdraw immediately after resignation&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">async</span><span class=\"mtk1\"> () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> {</span><span class=\"mtk12\">tokenContract</span><span class=\"mtk1\">, </span><span class=\"mtk12\">vestingContract</span><span class=\"mtk1\">} = </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk11\">createPrefundedVestingContract</span><span class=\"mtk1\">({</span><span class=\"mtk12\">tokenName</span><span class=\"mtk1\">, </span><span class=\"mtk12\">tokenSymbol</span><span class=\"mtk1\">, </span><span class=\"mtk12\">initialSupplyTokens</span><span class=\"mtk1\">});</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">startTimestamp</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk11\">getLastBlockTs</span><span class=\"mtk1\">() + </span><span class=\"mtk7\">100</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">endTimestamp</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">startTimestamp</span><span class=\"mtk1\"> + </span><span class=\"mtk7\">2000</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">terminationTimestamp</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">startTimestamp</span><span class=\"mtk1\"> + </span><span class=\"mtk7\">1000</span><span class=\"mtk1\"> + </span><span class=\"mtk7\">50</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// half-way vesting, plus half release interval which shall be discarded</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">releaseIntervalSecs</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">100</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vestingContract</span><span class=\"mtk1\">.</span><span class=\"mtk11\">createClaim</span><span class=\"mtk1\">(</span><span class=\"mtk12\">owner2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">address</span><span class=\"mtk1\">, </span><span class=\"mtk12\">startTimestamp</span><span class=\"mtk1\">, </span><span class=\"mtk12\">endTimestamp</span><span class=\"mtk1\">, </span><span class=\"mtk12\">cliffReleaseTimestamp</span><span class=\"mtk1\">, </span><span class=\"mtk12\">releaseIntervalSecs</span><span class=\"mtk1\">, </span><span class=\"mtk12\">linearVestAmount</span><span class=\"mtk1\">, </span><span class=\"mtk12\">cliffAmount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// move clock to termination timestamp (half-way the vesting period plus a bit, but less than release interval seconds)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ethers</span><span class=\"mtk1\">.</span><span class=\"mtk12\">provider</span><span class=\"mtk1\">.</span><span class=\"mtk11\">send</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;evm_mine&quot;</span><span class=\"mtk1\">, [</span><span class=\"mtk12\">terminationTimestamp</span><span class=\"mtk1\">]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">let</span><span class=\"mtk1\"> </span><span class=\"mtk12\">availableAmt</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vestingContract</span><span class=\"mtk1\">.</span><span class=\"mtk11\">claimableAmount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">owner2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">address</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// revoke the claim preserving the &quot;already vested but not yet withdrawn amount&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> (</span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vestingContract</span><span class=\"mtk1\">.</span><span class=\"mtk11\">revokeClaim</span><span class=\"mtk1\">(</span><span class=\"mtk12\">owner2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">address</span><span class=\"mtk1\">)).</span><span class=\"mtk11\">wait</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">let</span><span class=\"mtk1\"> </span><span class=\"mtk12\">userBalanceBefore</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tokenContract</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">owner2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">address</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk11\">expect</span><span class=\"mtk1\">(</span><span class=\"mtk12\">vestingContract</span><span class=\"mtk1\">.</span><span class=\"mtk11\">connect</span><span class=\"mtk1\">(</span><span class=\"mtk12\">owner2</span><span class=\"mtk1\">).</span><span class=\"mtk11\">withdraw</span><span class=\"mtk1\">()).</span><span class=\"mtk12\">to</span><span class=\"mtk1\">.</span><span class=\"mtk12\">be</span><span class=\"mtk1\">.</span><span class=\"mtk11\">revertedWith</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;NO_ACTIVE_CLAIM&#39;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">let</span><span class=\"mtk1\"> </span><span class=\"mtk12\">userBalanceAfter</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tokenContract</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">owner2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">address</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// move the clock to the programmed end of vesting period</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ethers</span><span class=\"mtk1\">.</span><span class=\"mtk12\">provider</span><span class=\"mtk1\">.</span><span class=\"mtk11\">send</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;evm_mine&quot;</span><span class=\"mtk1\">, [</span><span class=\"mtk12\">endTimestamp</span><span class=\"mtk1\">]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// cliffTimestamp &lt; startTimestamp &lt; terminationTimestamp, hence expected cliffAmount + (1/2 * anlinearVestAmount)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">let</span><span class=\"mtk1\"> </span><span class=\"mtk12\">expectedVestedAmount</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">cliffAmount</span><span class=\"mtk1\">.</span><span class=\"mtk11\">add</span><span class=\"mtk1\">(</span><span class=\"mtk12\">linearVestAmount</span><span class=\"mtk1\">.</span><span class=\"mtk11\">div</span><span class=\"mtk1\">(</span><span class=\"mtk7\">2</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// RESIGNING EMPLOYEE LOSES HIS VESTED AMOUNT BECAUSE OF WITHDRAWING IMMEDIATELY AFTER RESIGNATION</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">expect</span><span class=\"mtk1\">(</span><span class=\"mtk12\">userBalanceAfter</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sub</span><span class=\"mtk1\">(</span><span class=\"mtk12\">userBalanceBefore</span><span class=\"mtk1\">)).</span><span class=\"mtk12\">to</span><span class=\"mtk1\">.</span><span class=\"mtk12\">be</span><span class=\"mtk1\">.</span><span class=\"mtk11\">equal</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// VTVLVesting CONTRACT TOOK ALREADY VESTED AMOUNT FROM OWNER2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">expect</span><span class=\"mtk1\">(</span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vestingContract</span><span class=\"mtk1\">.</span><span class=\"mtk11\">finalClaimableAmount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">owner2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">address</span><span class=\"mtk1\">)).</span><span class=\"mtk12\">to</span><span class=\"mtk1\">.</span><span class=\"mtk12\">be</span><span class=\"mtk1\">.</span><span class=\"mtk11\">equal</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">// NOTE: USES ORIGINAL REVOKE BEHAVIOUR</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk11\">it</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;sample revoke use case USER WIN: employee withdraw immediately before resignation&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">async</span><span class=\"mtk1\"> () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> {</span><span class=\"mtk12\">tokenContract</span><span class=\"mtk1\">, </span><span class=\"mtk12\">vestingContract</span><span class=\"mtk1\">} = </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk11\">createPrefundedVestingContract</span><span class=\"mtk1\">({</span><span class=\"mtk12\">tokenName</span><span class=\"mtk1\">, </span><span class=\"mtk12\">tokenSymbol</span><span class=\"mtk1\">, </span><span class=\"mtk12\">initialSupplyTokens</span><span class=\"mtk1\">});</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">startTimestamp</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk11\">getLastBlockTs</span><span class=\"mtk1\">() + </span><span class=\"mtk7\">100</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">endTimestamp</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">startTimestamp</span><span class=\"mtk1\"> + </span><span class=\"mtk7\">2000</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">terminationTimestamp</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">startTimestamp</span><span class=\"mtk1\"> + </span><span class=\"mtk7\">1000</span><span class=\"mtk1\"> + </span><span class=\"mtk7\">50</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// half-way vesting, plus half release interval which shall be discarded</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">releaseIntervalSecs</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">100</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vestingContract</span><span class=\"mtk1\">.</span><span class=\"mtk11\">createClaim</span><span class=\"mtk1\">(</span><span class=\"mtk12\">owner2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">address</span><span class=\"mtk1\">, </span><span class=\"mtk12\">startTimestamp</span><span class=\"mtk1\">, </span><span class=\"mtk12\">endTimestamp</span><span class=\"mtk1\">, </span><span class=\"mtk12\">cliffReleaseTimestamp</span><span class=\"mtk1\">, </span><span class=\"mtk12\">releaseIntervalSecs</span><span class=\"mtk1\">, </span><span class=\"mtk12\">linearVestAmount</span><span class=\"mtk1\">, </span><span class=\"mtk12\">cliffAmount</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// move clock to termination timestamp (half-way the vesting period plus a bit, but less than release interval seconds)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ethers</span><span class=\"mtk1\">.</span><span class=\"mtk12\">provider</span><span class=\"mtk1\">.</span><span class=\"mtk11\">send</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;evm_mine&quot;</span><span class=\"mtk1\">, [</span><span class=\"mtk12\">terminationTimestamp</span><span class=\"mtk1\">]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">let</span><span class=\"mtk1\"> </span><span class=\"mtk12\">userBalanceBefore</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tokenContract</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">owner2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">address</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> (</span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vestingContract</span><span class=\"mtk1\">.</span><span class=\"mtk11\">connect</span><span class=\"mtk1\">(</span><span class=\"mtk12\">owner2</span><span class=\"mtk1\">).</span><span class=\"mtk11\">withdraw</span><span class=\"mtk1\">()).</span><span class=\"mtk11\">wait</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">let</span><span class=\"mtk1\"> </span><span class=\"mtk12\">userBalanceAfter</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">tokenContract</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">owner2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">address</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// revoke the claim preserving the &quot;already vested but not yet withdrawn amount&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> (</span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vestingContract</span><span class=\"mtk1\">.</span><span class=\"mtk11\">revokeClaim</span><span class=\"mtk1\">(</span><span class=\"mtk12\">owner2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">address</span><span class=\"mtk1\">)).</span><span class=\"mtk11\">wait</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// move the clock to the programmed end of vesting period</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ethers</span><span class=\"mtk1\">.</span><span class=\"mtk12\">provider</span><span class=\"mtk1\">.</span><span class=\"mtk11\">send</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;evm_mine&quot;</span><span class=\"mtk1\">, [</span><span class=\"mtk12\">endTimestamp</span><span class=\"mtk1\">]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">console</span><span class=\"mtk1\">.</span><span class=\"mtk11\">log</span><span class=\"mtk1\">(</span><span class=\"mtk12\">userBalanceAfter</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sub</span><span class=\"mtk1\">(</span><span class=\"mtk12\">userBalanceBefore</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// RESIGNING EMPLOYEE RECEIVES HIS VESTED AMOUNT BY WITHDRAWING IMMEDIATELY BEFORE RESIGNATION</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">expect</span><span class=\"mtk1\">(</span><span class=\"mtk12\">userBalanceAfter</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sub</span><span class=\"mtk1\">(</span><span class=\"mtk12\">userBalanceBefore</span><span class=\"mtk1\">)).</span><span class=\"mtk12\">to</span><span class=\"mtk1\">.</span><span class=\"mtk12\">be</span><span class=\"mtk1\">.</span><span class=\"mtk11\">greaterThan</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">expect</span><span class=\"mtk1\">(</span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vestingContract</span><span class=\"mtk1\">.</span><span class=\"mtk11\">finalClaimableAmount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">owner2</span><span class=\"mtk1\">.</span><span class=\"mtk12\">address</span><span class=\"mtk1\">)).</span><span class=\"mtk12\">to</span><span class=\"mtk1\">.</span><span class=\"mtk12\">be</span><span class=\"mtk1\">.</span><span class=\"mtk11\">equal</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  });</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Below are, in order, a test and a diff/patch for a proposed fix. The proposed fix is just an idea at how to fix, or in other words, a way to preserve the already vested amount when claim is revoked.</p>\n<p>The diff/patch add a deactivationTimestamp to claim, and a new revokeClaimProper that shall replace the revokeClaim function to correct the behaviour.\nThe deactivationTimestamp is used to track the deactivation time for the claim in order to preserve the amount vested so far and allow the user to withdraw the amount righteously earned so far. The _baseVestedAmount and hasActiveClaim have been updated to do proper math when isActive is false but deactivationTimestamp is greater than 0.</p>\n<p>The finalVestedAmount has been update to show the “what would be” amount if the vesting would have reached the claim endTimestamp while the finalClaimableAmount takes into consideration the deactivationTimestamp if the claim has been revoked.</p>\n<p>The test shows that the already vested amount (cliff + half way linear vesting) is preserved.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">diff</span><span class=\"mtk1\"> --</span><span class=\"mtk12\">git</span><span class=\"mtk1\"> </span><span class=\"mtk12\">a</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span><span class=\"mtk1\"> </span><span class=\"mtk12\">b</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">index</span><span class=\"mtk1\"> 133</span><span class=\"mtk12\">f19f</span><span class=\"mtk1\">..7</span><span class=\"mtk12\">ab955c</span><span class=\"mtk1\"> </span><span class=\"mtk7\">100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">--- </span><span class=\"mtk12\">a</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+++ </span><span class=\"mtk12\">b</span><span class=\"mtk1\">/</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -</span><span class=\"mtk7\">34</span><span class=\"mtk1\">,</span><span class=\"mtk7\">6</span><span class=\"mtk1\"> +</span><span class=\"mtk7\">34</span><span class=\"mtk1\">,</span><span class=\"mtk7\">7</span><span class=\"mtk1\"> @@ </span><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Context</span><span class=\"mtk1\">, </span><span class=\"mtk12\">AccessProtected</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk3\">// Gives us a range from 1 Jan 1970 (Unix epoch) up to approximately 35 thousand years from then (2^40 / (365 * 24 * 60 * 60) ~= 35k)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">startTimestamp</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// When does the vesting start (40 bits is enough for TS)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">endTimestamp</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// When does the vesting end - the vesting goes linearly between the start and end timestamps</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+        </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">deactivationTimestamp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">cliffReleaseTimestamp</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// At which timestamp is the cliffAmount released. This must be &lt;= startTimestamp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">releaseIntervalSecs</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// Every how many seconds does the vested amount increase. </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -</span><span class=\"mtk7\">108</span><span class=\"mtk1\">,</span><span class=\"mtk7\">7</span><span class=\"mtk1\"> +</span><span class=\"mtk7\">109</span><span class=\"mtk1\">,</span><span class=\"mtk7\">7</span><span class=\"mtk1\"> @@ </span><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Context</span><span class=\"mtk1\">, </span><span class=\"mtk12\">AccessProtected</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk3\">// We however still need the active check, since (due to the name of the function)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk3\">// we want to only allow active claims</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">-        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">isActive</span><span class=\"mtk1\"> == </span><span class=\"mtk4\">true</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;NO_ACTIVE_CLAIM&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">isActive</span><span class=\"mtk1\"> == </span><span class=\"mtk4\">true</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">deactivationTimestamp</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;NO_ACTIVE_CLAIM&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk3\">// Save gas, omit further checks</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk3\">// require(_claim.linearVestAmount + _claim.cliffAmount &gt; 0, &quot;INVALID_VESTED_AMOUNT&quot;);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -</span><span class=\"mtk7\">144</span><span class=\"mtk1\">,</span><span class=\"mtk7\">20</span><span class=\"mtk1\"> +</span><span class=\"mtk7\">145</span><span class=\"mtk1\">,</span><span class=\"mtk7\">20</span><span class=\"mtk1\"> @@ </span><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Context</span><span class=\"mtk1\">, </span><span class=\"mtk12\">AccessProtected</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     @</span><span class=\"mtk12\">param</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\"> </span><span class=\"mtk12\">The</span><span class=\"mtk1\"> </span><span class=\"mtk12\">claim</span><span class=\"mtk1\"> </span><span class=\"mtk4\">in</span><span class=\"mtk1\"> </span><span class=\"mtk12\">question</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     @</span><span class=\"mtk12\">param</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_referenceTs</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Timestamp</span><span class=\"mtk1\"> </span><span class=\"mtk12\">for</span><span class=\"mtk1\"> </span><span class=\"mtk12\">which</span><span class=\"mtk1\"> </span><span class=\"mtk12\">we</span><span class=\"mtk8\">&#39;re calculatin</span><span class=\"mtk14\">g</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">-    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_baseVestedAmount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Claim</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_referenceTs</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">pure</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint112</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_baseVestedAmount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">Claim</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_referenceTs</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vestEndTimestamp</span><span class=\"mtk1\">) </span><span class=\"mtk11\">internal</span><span class=\"mtk1\"> </span><span class=\"mtk11\">pure</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint112</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk12\">uint112</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vestAmt</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">0</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">-        </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">-        </span><span class=\"mtk3\">// the condition to have anything vested is to be active</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">-        </span><span class=\"mtk15\">if</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">isActive</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+            </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+        </span><span class=\"mtk15\">if</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">isActive</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">deactivationTimestamp</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">             </span><span class=\"mtk3\">// no point of looking past the endTimestamp as nothing should vest afterwards</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">             </span><span class=\"mtk3\">// So if we&#39;re past the end, just get the ref frame back to the end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">-            </span><span class=\"mtk15\">if</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_referenceTs</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">endTimestamp</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">-                </span><span class=\"mtk12\">_referenceTs</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">endTimestamp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+            </span><span class=\"mtk15\">if</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_referenceTs</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk12\">vestEndTimestamp</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+                </span><span class=\"mtk12\">_referenceTs</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">vestEndTimestamp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">             }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">             </span><span class=\"mtk3\">// If we&#39;re past the cliffReleaseTimestamp, we release the cliffAmount</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">             </span><span class=\"mtk3\">// We don&#39;t check here that cliffReleaseTimestamp is after the startTimestamp </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">-            </span><span class=\"mtk15\">if</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_referenceTs</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">cliffReleaseTimestamp</span><span class=\"mtk1\">) { </span><span class=\"mtk3\">// @audit is _claim.require(cliffReleaseTimestamp &lt; _claim.endTimestamp) ?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+            </span><span class=\"mtk15\">if</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_referenceTs</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">cliffReleaseTimestamp</span><span class=\"mtk1\">) {  </span><span class=\"mtk3\">// @audit note  cliffReleaseTimestamp cannot? be zero without cliffamoutn being zero</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+                </span><span class=\"mtk3\">// @audit NOTE: (cliffReleaseTimestamp is always &lt;= _startTimestamp &lt;= endTimestamp, or 0 if no vesting)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                 </span><span class=\"mtk12\">vestAmt</span><span class=\"mtk1\"> += </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">cliffAmount</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">             }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -</span><span class=\"mtk7\">195</span><span class=\"mtk1\">,</span><span class=\"mtk7\">7</span><span class=\"mtk1\"> +</span><span class=\"mtk7\">196</span><span class=\"mtk1\">,</span><span class=\"mtk7\">8</span><span class=\"mtk1\"> @@ </span><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Context</span><span class=\"mtk1\">, </span><span class=\"mtk12\">AccessProtected</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">vestedAmount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_referenceTs</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint112</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk12\">Claim</span><span class=\"mtk1\"> </span><span class=\"mtk12\">storage</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">claims</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">-        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_baseVestedAmount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_referenceTs</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+        </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vestEndTimestamp</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">isActive</span><span class=\"mtk1\"> ? </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">endTimestamp</span><span class=\"mtk1\"> : </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">deactivationTimestamp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_baseVestedAmount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_referenceTs</span><span class=\"mtk1\">, </span><span class=\"mtk12\">vestEndTimestamp</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">@@ -205,7 +207,18 @@ contract VTVLVesting is Context, AccessProtected {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">      */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">finalVestedAmount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint112</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk12\">Claim</span><span class=\"mtk1\"> </span><span class=\"mtk12\">storage</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">claims</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">-        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_baseVestedAmount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">endTimestamp</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_baseVestedAmount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">endTimestamp</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">endTimestamp</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+    </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+    </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Calculates how much wil be possible to claim at the end of vesting date, by subtracting the already withdrawn</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+            amount from the vestedAmount at this moment. Vesting date is either the end timestamp or the deactivation timestamp.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+    </span><span class=\"mtk4\">@param</span><span class=\"mtk3\"> </span><span class=\"mtk12\">_recipient</span><span class=\"mtk3\"> - The address for whom we&#39;re calculating</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+    */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">finalClaimableAmount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint112</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+        </span><span class=\"mtk12\">Claim</span><span class=\"mtk1\"> </span><span class=\"mtk12\">storage</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">claims</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+        </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vestEndTimestamp</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">isActive</span><span class=\"mtk1\"> ? </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">endTimestamp</span><span class=\"mtk1\"> : </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">deactivationTimestamp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_baseVestedAmount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">, </span><span class=\"mtk12\">vestEndTimestamp</span><span class=\"mtk1\">, </span><span class=\"mtk12\">vestEndTimestamp</span><span class=\"mtk1\">) - </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">amountWithdrawn</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     </span><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">@@ -214,7 +227,8 @@ contract VTVLVesting is Context, AccessProtected {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">     */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">claimableAmount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint112</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk12\">Claim</span><span class=\"mtk1\"> </span><span class=\"mtk12\">storage</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">claims</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">-        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_baseVestedAmount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">, </span><span class=\"mtk11\">uint40</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">)) - </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">amountWithdrawn</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+        </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">vestEndTimestamp</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">isActive</span><span class=\"mtk1\"> ? </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">endTimestamp</span><span class=\"mtk1\"> : </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">deactivationTimestamp</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">+        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_baseVestedAmount</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">, </span><span class=\"mtk11\">uint40</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">), </span><span class=\"mtk12\">vestEndTimestamp</span><span class=\"mtk1\">) - </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">amountWithdrawn</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     </span><span class=\"mtk3\">/** </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">@@ -280,6 +294,7 @@ contract VTVLVesting is Context, AccessProtected {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">         Claim memory _claim = Claim({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">             startTimestamp: _startTimestamp,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">             endTimestamp: _endTimestamp,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+            deactivationTimestamp: 0,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">             cliffReleaseTimestamp: _cliffReleaseTimestamp,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">             releaseIntervalSecs: _releaseIntervalSecs,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">             cliffAmount: _cliffAmount,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">@@ -436,6 +451,30 @@ contract VTVLVesting is Context, AccessProtected {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">         emit ClaimRevoked(_recipient, amountRemaining, uint40(block.timestamp), _claim);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">     }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+    function revokeClaimProper(address _recipient) external onlyAdmin hasActiveClaim(_recipient) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+        // Fetch the claim</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+        Claim storage _claim = claims[_recipient];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+        // Calculate what the claim should finally vest to</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+        uint112 finalVestAmt = finalVestedAmount(_recipient);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+        // No point in revoking something that has been fully consumed</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+        // so require that there be unconsumed amount</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+        require( _claim.amountWithdrawn &lt; finalVestAmt, &quot;NO_UNVESTED_AMOUNT&quot;);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+        _claim.isActive = false;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+        _claim.deactivationTimestamp = uint40(block.timestamp);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+        uint112 vestedSoFarAmt = vestedAmount(_recipient, uint40(block.timestamp));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+        // The amount that is &quot;reclaimed&quot; is equal to the total allocation less what was already</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+        // vested without the part that was already withdrawn.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+        uint112 amountRemaining = finalVestAmt - (vestedSoFarAmt - _claim.amountWithdrawn);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+        numTokensReservedForVesting -= amountRemaining; // Reduces the allocation</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+        // Tell everyone a claim has been revoked.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+        emit ClaimRevoked(_recipient, amountRemaining, uint40(block.timestamp), _claim);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">     /**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">     </span><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Withdraw a token which isn&#39;t controlled by the vesting contract.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">     </span><span class=\"mtk4\">@dev</span><span class=\"mtk3\"> This contract controls/vests token at &quot;tokenAddress&quot;. However, someone might send a different token. </span></span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/475#issuecomment-1271750623\">lawrencehui (VTVL) confirmed and commented</a>:</strong></p>\n<blockquote>\n<p>Thank you warden for the findings. We did think about adding a grace withdrawing period to further strengthen the users’ trust to the admin. I would argue that severity is medium in the case as in practical sense we would assume admin will inform the receivers upon revocation and therefore withdrawAdmin was designed to be separated from revokeClaim. </p>\n<p>I acknowledge that some malicious admin might abuse this right and to claimed the receiver’s already earned token before they claimed (as described in the scenario in this findings) and therefore we will consider adding the grace period to restrict admin to act maliciously.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/475#issuecomment-1272152502\">0xean (judge) commented</a>:</strong></p>\n<blockquote>\n<p>I am going to stick with High, even a non malicious admin would have no choice but to kindly ask a user to claim before they revoked all their other tokens. If the user didn’t comply, the admin has no option but to either “steal” their tokens or allow them to keep vesting. </p>\n</blockquote>\n<hr>\n<h2 id=\"h-02-permanent-freeze-of-vested-tokens-due-to-overflow-in-_basevestedamount\" style=\"position:relative;\"><a href=\"#h-02-permanent-freeze-of-vested-tokens-due-to-overflow-in-_basevestedamount\" aria-label=\"h 02 permanent freeze of vested tokens due to overflow in _basevestedamount permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/95\">[H-02] Permanent freeze of vested tokens due to overflow in <code>_baseVestedAmount</code></a></h2>\n<p><em>Submitted by Trust, also found by 0xSky, bin2chen, CertoraInc, hansfriese, KIntern_NA, neko_nyaa, neumo, rokinot, and wastewa</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L176\">VTVLVesting.sol#L176</a><br></p>\n<p>The _baseVestedAmount() function calculates vested amount for some (claim, timestamp) pair. It is wrapped by several functions, like vestedAmount, which is used in withdraw() to calculate how much a user can retrieve from their claim. Therefore, it is critical that this function will calculate correctly for users to receive their funds.</p>\n<p>Below is the calculation of the linear vest amount:</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">uint112 linearVestAmount = _claim.linearVestAmount * truncatedCurrentVestingDurationSecs / finalVestingDurationSecs;</span></span></code></pre>\n<p>Importantly, _claim.linearVestAmount is of type uint112 and truncatedCurrentVestingDurationSecs is of type uint40. Using compiler >= 0.8.0,  the product cannot exceed uint112 or else the function reverts due to overflow. In fact, we can show that uint112 is an inadequate size for this calculation.</p>\n<p>The max value for uint112 is 5192296858534827628530496329220096.<br>\nSeconds in year = 3600 * 24 * 365 = 31536000<br>\nTokens that inherit from ERC20 like the ones used in VTVL have 18 decimal places -> 1000000000000000000<br>\nThis means the maximum number of tokens that are safe to vest for one year is 2**112 / 10e18 / (3600 * 24 * 365) = just 16,464,665 tokens.\nThis is definitely not a very large amount and it is expected that some projects will mint a similar or larger amount for vesting for founders / early employees. For 4 year vesting, the safe amount drops to 4,116,166.<br>\nProjects that are not forewarned about this size limit are likely to suffer from freeze of funds of employees, which will require very patchy manual revocation and restructuring of the vesting to not overflow.</p>\n<h3 id=\"impact\" style=\"position:relative;\"><a href=\"#impact\" aria-label=\"impact permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>Employees/founders do not have access to their vested tokens.</p>\n<h3 id=\"proof-of-concept-1\" style=\"position:relative;\"><a href=\"#proof-of-concept-1\" aria-label=\"proof of concept 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Below is a test that demonstrates the overflow issue, 1 year after 17,000,000 tokens have matured.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">describe(&#39;Long vest fail&#39;, async () =&gt; {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  let vestingContract: VestingContractType;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  // Default params</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  // linearly Vest 10000, every 1s, between TS 1000 and 2000</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  // additionally, cliff vests another 5000, at TS = 900</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  const recipientAddress = await randomAddress();</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  const startTimestamp = BigNumber.from(1000);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  const endTimestamp = BigNumber.from(1000 + 3600 * 24 * 365);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  const midTimestamp = BigNumber.from(1000 + (3600 * 24 * 365) / 2);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  const cliffReleaseTimestamp = BigNumber.from(0);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  const linearVestAmount = BigNumber.from(&#39;170000000000000000000000000&#39;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  const cliffAmount = BigNumber.from(0);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  const releaseIntervalSecs = BigNumber.from(5);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  before(async () =&gt; {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    const {vestingContract: _vc} = await createPrefundedVestingContract({tokenName, tokenSymbol, initialSupplyTokens});</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    vestingContract = _vc;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    await vestingContract.createClaim(recipientAddress, startTimestamp, endTimestamp, cliffReleaseTimestamp, releaseIntervalSecs, linearVestAmount, cliffAmount);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  });</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  it(&#39;half term works&#39;, async() =&gt; {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    expect(await vestingContract.vestedAmount(recipientAddress, midTimestamp)).to.be.equal(&#39;85000000000000000000000000&#39;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  });</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  it(&#39;full term fails&#39;, async() =&gt; {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    // Note: at exactly the cliff time, linear vested amount won&#39;t yet come in play as we&#39;re only at second 0</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    await expect(vestingContract.vestedAmount(recipientAddress, endTimestamp)).to.be.revertedWithPanic(0x11</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    );</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  });</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">});</span></span></code></pre>\n<h3 id=\"tools-used\" style=\"position:relative;\"><a href=\"#tools-used\" aria-label=\"tools used permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools Used</h3>\n<p>Manual audit, hardhat / chai.</p>\n<h3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Perform the intermediate calculation of linearVestAmount using the uint256 type.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">uint112 linearVestAmount = uint112( uint256(_claim.linearVestAmount) * truncatedCurrentVestingDurationSecs / finalVestingDurationSecs);</span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/95#issuecomment-1271760558\">lawrencehui (VTVL) confirmed and commented</a>:</strong></p>\n<blockquote>\n<p>This finding is very useful and appreciate all wardens that flagged the potential risk of overflowing.</p>\n</blockquote>\n<hr>\n<h1 id=\"medium-risk-findings-10\" style=\"position:relative;\"><a href=\"#medium-risk-findings-10\" aria-label=\"medium risk findings 10 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Medium Risk Findings (10)</h1>\n<h2 id=\"m-01-supply-cap-of-variablesupplyerc20token-is-not-properly-enforced\" style=\"position:relative;\"><a href=\"#m-01-supply-cap-of-variablesupplyerc20token-is-not-properly-enforced\" aria-label=\"m 01 supply cap of variablesupplyerc20token is not properly enforced permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/3\">[M-01] Supply cap of <code>VariableSupplyERC20Token</code> is not properly enforced</a></h2>\n<p><em>Submitted by Czar102, also found by __141345__, 0xbepresent, 0xDecorativePineapple, 0xmatt, 0xNazgul, 0xSky, adriro, ajtra, Atarpara, Bahurum, bin2chen, cccz, cRat1st0s, cryptonue, d3e4, DimitarDimitrov, Franfran, GimelSec, innertia, jag, JGcarv, JLevick, joestakey, Junnon, neumo, obront, OptimismSec, pashov, pauliax, pcarranzav, peanuts, rajatbeladiya, rbserver, reassor, Rolezn, Ruhum, seyni, Soosh, Tomo, Trust, wagmi, zzykxx, and zzzitron</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/main/contracts/token/VariableSupplyERC20Token.sol#L36-L46\">VariableSupplyERC20Token.sol#L36-L46</a><br></p>\n<p>The admin of the token is not constrained to minting <code>maxSupply_</code>, they can mint any number of tokens.</p>\n<h3 id=\"proof-of-concept-2\" style=\"position:relative;\"><a href=\"#proof-of-concept-2\" aria-label=\"proof of concept 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"js\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// If we&#39;re using maxSupply, we need to make sure we respect it</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// mintableSupply = 0 means mint at will</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">if</span><span class=\"mtk1\">(</span><span class=\"mtk12\">mintableSupply</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk12\">mintableSupply</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_AMOUNT&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk3\">// We need to reduce the amount only if we&#39;re using the limit, if not just leave it be</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk12\">mintableSupply</span><span class=\"mtk1\"> -= </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>The logic is as follows: if the amount that can be minted is zero, treat this as an infinite mint. Else require that the minted amount is not larger than mintable supply.</p>\n<p>One can note that it is possible to mint all mintable supply. Then the mintable supply will be <code>0</code> which will be interpreted as infinity and any number of tokens will be possible to be minted.</p>\n<h3 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Treat <code>2 ** 256 - 1</code> as infinity instead of <code>0</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/3#issuecomment-1256802394\">0xean (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>The warden’s logic is correct, but given that this is behind an admin only flag, there are some external factors that would need to come into play for this to be realized. Downgrading to Medium severity. </p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/3\">lawrencehui (VTVL) confirmed</a></strong></p>\n<hr>\n<h2 id=\"m-02-_basevestedamount-and-vestedamount-return-incorrect-historical-values\" style=\"position:relative;\"><a href=\"#m-02-_basevestedamount-and-vestedamount-return-incorrect-historical-values\" aria-label=\"m 02 _basevestedamount and vestedamount return incorrect historical values permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/104\">[M-02] <code>_baseVestedAmount()</code> and <code>vestedAmount()</code> Return Incorrect Historical Values</a></h2>\n<p><em>Submitted by Respx, also found by m9800</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L183-L187\">VTVLVesting.sol#L183-L187</a><br>\n<a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L198\">VTVLVesting.sol#L198</a><br></p>\n<p>As the comments in <code>_baseVestedAmount()</code> explain, once there is any <code>_claim.amountWithdrawn</code>, it will be returned if it is greater than the calculated value <code>vestAmt</code>. However, <code>vestAmt</code> takes account of time, <code>_referenceTs</code>, whereas <code>_claim.amountWithdrawn</code> is always the amount withdrawn to date. Therefore, for all historical values below <code>_claim.amountWithdrawn</code>, including timestamps before <code>_claim.startTimestamp</code> and before <code>_claim.cliffReleaseTimestamp</code>, <code>_claim.amountWithdrawn</code> will be returned.</p>\n<h3 id=\"impact-1\" style=\"position:relative;\"><a href=\"#impact-1\" aria-label=\"impact 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>Given that VTVL is intended to be an accessible platform for use by a wide variety of users, this behaviour does create a security risk. Consider these scenarios:</p>\n<ul>\n<li>A protocol relies on VTVL as an off-the-shelf solution for vesting, but builds other systems (escrow, NFT grants, access, airdrops) that work by checking the value of <code>vestedAmount()</code>. Airdrops are especially likely to be interested in historical values. These values would be distorted by how much users have claimed and so would result in an undesirable distribution of resources.</li>\n<li>Even if the above does not occur, consider that VTVL might be passed over as a vesting solution precisely because its historical data is inaccurate.</li>\n<li>A contract could be built that inherits from <code>VTVLVesting</code> and attempts to use <code>_baseVestedAmount()</code> (which is <code>internal</code> and so can be used by inheriting contracts). The inheriting contract might apportion rewards based on historical usage.</li>\n<li>VTVL itself might wish to inherit from <code>VTVLVesting</code> in future.</li>\n</ul>\n<h3 id=\"proof-of-concept-3\" style=\"position:relative;\"><a href=\"#proof-of-concept-3\" aria-label=\"proof of concept 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">diff --git a/test/VTVLVesting.ts b/test/VTVLVestingPOC.ts</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">index bb609fb..073e53f 100644</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">--- a/test/VTVLVesting.ts</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">+++ b/test/VTVLVestingPOC.ts</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@@ -500,14 +500,37 @@ describe(&#39;Revoke Claim&#39;, async () =&gt; {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">   const recipientAddress = await randomAddress();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">   const [owner, owner2] = await ethers.getSigners();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-  it(&#39;allows admin to revoke a valid claim&#39;, async () =&gt; {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+  it(&#39;POC: WITHDRAWN DATA IS UNRELIABLE&#39;, async () =&gt; {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">     const {vestingContract} = await createPrefundedVestingContract({tokenName, tokenSymbol, initialSupplyTokens});</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-    await vestingContract.createClaim(recipientAddress, startTimestamp, endTimestamp, cliffReleaseTimestamp, releaseIntervalSecs, linearVestAmount, cliffAmount);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    const startTimestamp2 = startTimestamp.add(releaseIntervalSecs.mul(100));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    const endTimestamp2 = endTimestamp.add(releaseIntervalSecs.mul(100));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    const cliffReleaseTimestamp2 = cliffReleaseTimestamp.add(releaseIntervalSecs.mul(100));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    await vestingContract.createClaim(owner2.address, startTimestamp2, endTimestamp2, cliffReleaseTimestamp2, releaseIntervalSecs, linearVestAmount, cliffAmount);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    // Fast forward to middle of claim</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    const halfWay = startTimestamp2.toNumber() + (endTimestamp2.toNumber()-startTimestamp2.toNumber())/2;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    await ethers.provider.send(&quot;evm_mine&quot;, [halfWay]);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    let vestAmt = await vestingContract.vestedAmount(owner2.address, startTimestamp);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    console.log(&quot;NO WITHDRAWAL, BEFORE VEST START: &quot;,vestAmt.toString());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    vestAmt = await vestingContract.vestedAmount(owner2.address, startTimestamp2);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    console.log(&quot;NO WITHDRAWAL, AT VEST START: &quot;,vestAmt.toString());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    vestAmt = await vestingContract.vestedAmount(owner2.address, halfWay);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    console.log(&quot;NO WITHDRAWAL, HALF WAY THROUGH VEST: &quot;,vestAmt.toString());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    vestAmt = await vestingContract.vestedAmount(owner2.address, endTimestamp2);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    console.log(&quot;NO WITHDRAWAL, AT VEST END: &quot;,vestAmt.toString());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    await (await vestingContract.connect(owner2).withdraw()).wait();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-    (await vestingContract.revokeClaim(recipientAddress)).wait();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    vestAmt = await vestingContract.vestedAmount(owner2.address, startTimestamp);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    console.log(&quot;WITHDRAWAL, BEFORE VEST START: &quot;,vestAmt.toString());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    vestAmt = await vestingContract.vestedAmount(owner2.address, startTimestamp2);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    console.log(&quot;WITHDRAWAL, AT VEST START: &quot;,vestAmt.toString());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    vestAmt = await vestingContract.vestedAmount(owner2.address, halfWay);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    console.log(&quot;WITHDRAWAL, HALF WAY THROUGH VEST: &quot;,vestAmt.toString());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    vestAmt = await vestingContract.vestedAmount(owner2.address, endTimestamp2);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">+    console.log(&quot;WITHDRAWAL, AT VEST END: &quot;,vestAmt.toString());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-    // Make sure it gets reverted</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">-    expect(await (await vestingContract.getClaim(recipientAddress)).isActive).to.be.equal(false);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">   });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">   it(&#39;prohibits a random user from revoking a valid claim&#39;, async () =&gt; {</span></span></span></code></pre>\n<h3 id=\"recommended-mitigation-steps-3\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-3\" aria-label=\"recommended mitigation steps 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>For active claims, there is no reason to consider <code>_claim.amountWithdrawn</code>, as it will always have been below or equal to <code>vestAmt</code> at any point in time. So only consider <code>vestAmt</code> for inactive claims. For them, return the lowest of <code>vestAmt</code> and  <code>_claim.amountWithdrawn</code>. This will keep the values monotonic with time without distorting the historical values. It will act as though <code>_claim.amountWithdrawn</code> was withdrawn and the claim was revoked in the block when <code>vestAmt</code> reached <code>_claim.amountWithdrawn</code>. That is a distortion,0xean but it is required to provide monotonicity.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/104#issuecomment-1257255246\">0xean (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Good find. </p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/104\">lawrencehui (VTVL) confirmed</a></strong></p>\n<hr>\n<h2 id=\"m-03-possible-dos-on-vestingrecipients-due-to-lack-of-disposal-mechanism\" style=\"position:relative;\"><a href=\"#m-03-possible-dos-on-vestingrecipients-due-to-lack-of-disposal-mechanism\" aria-label=\"m 03 possible dos on vestingrecipients due to lack of disposal mechanism permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/128\">[M-03] Possible DoS on <code>vestingRecipients</code> due to lack of disposal mechanism</a></h2>\n<p><em>Submitted by fatherOfBlocks, also found by wagmi</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L224\">VTVLVesting.sol#L224</a><br>\n<a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L245\">VTVLVesting.sol#L245</a><br>\n<a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L302\">VTVLVesting.sol#L302</a><br>\n<a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L317\">VTVLVesting.sol#L317</a><br></p>\n<p>When the smart contracts start to be used, the variable in storage vestingRecipients will start to be filled with addresses, as there is no mechanism to eliminate elements, this will cause the <code>allVestingRecipients()</code> function to generate a DoS yes has many addressess.</p>\n<h3 id=\"recommended-mitigation-steps-4\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-4\" aria-label=\"recommended mitigation steps 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>In the <code>withdraw()</code> function you could remove the element from <code>vestingRecipients</code> that no longer has vesting. This would make the variable not grow without reducing elements.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/128#issuecomment-1257069235\">0xean (judge) commented</a>:</strong></p>\n<blockquote>\n<p>On the fence on this one.  I agree with the warden, but in the current implementation <code>allVestingRecipients</code> is unused and assumed to be for external, off chain uses so the impact is hard to determine. Going to leave as Medium, pending sponsor review.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/128#issuecomment-1270859394\">lawrencehui (VTVL) confirmed and commented</a>:</strong></p>\n<blockquote>\n<p>I would agree with the warden on the lack of control for an ever-growing array size could be an issue. I will tag this as an enhancement. </p>\n<p>On the side, I want to check what is the allowed max size of the array in this case? <code>2**256 -1</code>? but theoretically calling a large array would exceed the the block gas limit when retrieving it?</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/128#issuecomment-1272143412\">0xean (judge) commented</a>:</strong></p>\n<blockquote>\n<p>@lawrencehui - Yes retrieval will eventually fail, long before you populate the array fully. You could pass in an index range to retrieve portions of the array to avoid this failure mode. </p>\n<p>And yes <code>2**256 -1</code> is my understanding of the theoretical limit. </p>\n</blockquote>\n<hr>\n<h2 id=\"m-04-not-able-to-create-claim\" style=\"position:relative;\"><a href=\"#m-04-not-able-to-create-claim\" aria-label=\"m 04 not able to create claim permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/140\">[M-04] not able to create claim</a></h2>\n<p><em>Submitted by rajatbeladiya, also found by 0x4non, ak1, berndartmueller, CertoraInc, Chom, imare, JLevick, joestakey, JohnSmith, KIntern_NA, obront, rbserver, rotcivegaf, Ruhum, RustyRabbit, and supernova</em></p>\n<p>If admin revoked any recipient’s claim, admin can not create claim for the same recipient because <code>startTimestamp</code> is not updated to initial value on revoke claim.<br>\nThere will be a need to create a claim again for any reason like: 1) mistakenly revoked claim, 2) wrong info provided to claim, 3) new vesting period starts, etc.</p>\n<h3 id=\"proof-of-concept-4\" style=\"position:relative;\"><a href=\"#proof-of-concept-4\" aria-label=\"proof of concept 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<ol>\n<li>Alice creates claim for Bob</li>\n<li>\n<p>Alice revokes claim of Bob</p>\n<ul>\n<li>On <code>revokeClaim()</code>, claim’s <code>isActive</code> will be false, but <code>startTimestamp</code> will remain as it is</li>\n<li><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L418-L437\">VTVLVesting.sol#L418-L437</a></li>\n</ul>\n</li>\n<li>Alice tries to create claim for Bob but claim will not create because it has modifier <code>hasNoClaim()</code> which is checked for claim should not active and it checks for <code>require(_claim.startTimestamp == 0, \"CLAIM_ALREADY_EXISTS\");</code></li>\n<li><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L245-L253\">VTVLVesting.sol#L245-L253</a></li>\n<li><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L123-L140\">VTVLVesting.sol#L123-L140</a></li>\n</ol>\n<h3 id=\"recommended-mitigation-steps-5\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-5\" aria-label=\"recommended mitigation steps 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Update <code>startTimestamp to 0</code> on <code>revokeClaim()</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/140#issuecomment-1257040023\">0xean (judge) decreased severity to Low and commented</a>:</strong></p>\n<blockquote>\n<p>Downgrading to low severity. While true, why wouldn’t the employee just use a different address?  There is no residual benefit to using the old address (unless it was a smart contract, which the warden doesn’t mention as part of their POC).  The sponsor may want to fix this, since the fix is simple, but it poses very little risk and certainly no direct loss of funds. </p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/140#issuecomment-1257197630\">0xean (judge) increased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>Spent a bit more time thinking about this one and do think that it qualifies as Medium severity since it does affect the availability of the protocol in a number of ways. Going to go ahead and revise to Medium. </p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/140#issuecomment-1270868222\">lawrencehui (VTVL) acknowledged, but disagreed with severity and commented</a>:</strong></p>\n<blockquote>\n<p>The vesting contract is designed to be created and used in a one-off manner and the revoke function is to prevent any mistakes made upon creation (wrong address / amount / timestamp etc.). In practical sense, if a claim (or the recipient address) is revoked, one (the admin) can always create a new vesting contract with the correct claim parameters. </p>\n<p>I therefore think that it is by design that the address is only able be claimable once per vesting contract, in all circumstance, the admin can re-create a new vesting contract to mitigate this issue and therefore this is a low risk / non-critical issue. </p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/140#issuecomment-1272144853\">0xean (judge) commented</a>:</strong></p>\n<blockquote>\n<p>I don’t think the tactic of deploying a new contract is the correct one here simply to be able to set up vesting for one botched person or someone whose vesting token amount changes for example. I am going to stick with the Medium severity on this one, but do appreciate the response and thoughts on possible mitigations.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/140#issuecomment-1279883877\">ak1 (warden) commented</a>:</strong></p>\n<blockquote>\n<p>I have explained one of the real use case scenarios where this protocol will fail to serve many. Refer to <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/384\">issue 384</a>.<br>\nIt is not always contract address or EOA which will decide the identity of a person. Each one will have unique ID. That id is going to be used in all the places.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-05-tokens-with-lower-number-of-decimals-can-result-in-postponed-linear-vesting-for-user\" style=\"position:relative;\"><a href=\"#m-05-tokens-with-lower-number-of-decimals-can-result-in-postponed-linear-vesting-for-user\" aria-label=\"m 05 tokens with lower number of decimals can result in postponed linear vesting for user permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/191\">[M-05] Tokens with lower number of decimals can result in postponed linear vesting for user</a></h2>\n<p><em>Submitted by pashov</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/69da6e96f94ff3e02b9bb6175e6de2b3e71d3eb0/contracts/VTVLVesting.sol#L174\">VTVLVesting.sol#L174</a><br></p>\n<p>In the <code>_baseVestedAmount</code> of <code>VTVLVesting.sol</code> we see the following code</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">finalVestingDurationSecs</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">endTimestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">startTimestamp</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// length of the interval</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">uint112</span><span class=\"mtk1\"> </span><span class=\"mtk12\">linearVestAmount</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">linearVestAmount</span><span class=\"mtk1\"> * </span><span class=\"mtk12\">truncatedCurrentVestingDurationSecs</span><span class=\"mtk1\"> / </span><span class=\"mtk12\">finalVestingDurationSecs</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p>Let’s look at <code>truncatedCurrentVestingDurationSecs</code> as just the duration passed from the start of the vesting period for the PoC (this doesn’t omit important data in this context).</p>\n<p>Now think of the following scenario:</p>\n<p>We have a token <code>$TKN</code> that has 6 decimals (those are the decimals of both USDT &#x26; USDC). We want to distribute 10,000 of those tokens to a user vested over a 10 year period.</p>\n<p>10 years in seconds is 315360000 ****(this is <code>finalVestingDurationSecs</code>)</p>\n<p>This means that we will distribute 10,000 * 10^6 = 10 000 000 000 fractions of a token for 315360000 seconds, meaning we will distribute 310 fractions of a token each second - this is <code>linearVestAmount</code></p>\n<p>Now, since <code>finalVestingDurationSecs</code> is so big (315360000) it will almost always round <code>linearVestAmount</code> to zero when dividing by it, up until</p>\n<p><code>_claim.linearVestAmount * truncatedCurrentVestingDurationSecs</code> becomes a bigger number than 315360000, but since <code>_claim.linearVestAmount</code> is 310 we will need the current vesting duration to be at least 1 017 290 seconds which is <strong>12</strong> days postponed vesting. 12 days in a moving market can make a big difference if the user was expecting the tokens to start vesting from the first day.</p>\n<h3 id=\"impact-2\" style=\"position:relative;\"><a href=\"#impact-2\" aria-label=\"impact 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Impact</h3>\n<p>Unexpected postponing of vesting can result in waiting times for users to receive their must-be-vested tokens. This period can be used by other token holders to dump the token and decrease the price of it, resulting in a loss of capital for the vesting receiver.</p>\n<h3 id=\"recommended-mitigation-steps-6\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-6\" aria-label=\"recommended mitigation steps 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Enforce the contract to work with only 18 decimal tokens with a <code>require</code> statement in the constructor.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/191#issuecomment-1257051653\">0xean (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>Downgrading to Medium, there are a lot of external factors presented here by the warden to line up to a loss of funds.  </p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/191#issuecomment-1270955314\">lawrencehui (VTVL) acknowledged, but disagreed with severity and commented</a>:</strong></p>\n<blockquote>\n<p>I acknowledge the warden’s concern of the rounding, but I think the result of loss of funds is one of the extreme edge cases. I would suggest instead of restricting only to 18 decimal tokens (which is impractical as we would also want to include USDC and USDT for vesting too!), I would implement the rounding checking in the frontend UI and prompt user of potential delay caused by rounding / truncation as described in this issue.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/191#issuecomment-1272146188\">0xean (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Given that smart contracts can be interacted with in any number of ways (etherscan, programmatically, etc), I don’t think the mitigation negates the risk entirely and am going to stick with the Medium severity here.  The wardens demonstrates clearly the way in which this can happen. While it may be a bit outside of the normal vesting schedule expected, I do think it’s valuable to understand the bounds of the math you have employed here.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-06-variable-balance-token-causing-fund-lock-and-loss\" style=\"position:relative;\"><a href=\"#m-06-variable-balance-token-causing-fund-lock-and-loss\" aria-label=\"m 06 variable balance token causing fund lock and loss permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/278\">[M-06] Variable balance token causing fund lock and loss</a></h2>\n<p><em>Submitted by __141345__, also found by 0xDecorativePineapple, CertoraInc, djxploit, hyh, IllIllI, JohnSmith, MiloTruck, rbserver, and zzzitron</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L295\">VTVLVesting.sol#L295</a><br>\n<a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L388\">VTVLVesting.sol#L388</a><br></p>\n<p>Some ERC20 token’s balance could change, one example is stETH. The balance could become insufficient at the time of <code>withdraw()</code>. User’s fund will be locked due to DoS. The way to take the fund out is to send more token into the contract, causing fund loss to the protocol. And there is no guarantee that until the end time the balance would stay above the needed amount, the lock and loss issue persist.</p>\n<h3 id=\"proof-of-concept-5\" style=\"position:relative;\"><a href=\"#proof-of-concept-5\" aria-label=\"proof of concept 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>For stETH like tokens, the <code>balanceOf()</code> value might go up or down, even without transfer.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// stETH</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">who</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">override</span><span class=\"mtk1\"> </span><span class=\"mtk11\">view</span><span class=\"mtk1\"> </span><span class=\"mtk11\">returns</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_shareBalances</span><span class=\"mtk1\">[</span><span class=\"mtk12\">who</span><span class=\"mtk1\">].</span><span class=\"mtk11\">div</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_sharesPerToken</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>In <code>VTVLVesting</code>, the <code>require</code> check for the spot <code>balanceOf()</code> value will pass, but it is possible that as time goes on, the value become smaller and fail the transfer. As a result, the <code>withdraw()</code> call will revert, causing DoS, and lock user’s fund.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// contracts/VTVLVesting.sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_createClaimUnchecked</span><span class=\"mtk1\">() </span><span class=\"mtk11\">private</span><span class=\"mtk1\">  </span><span class=\"mtk11\">hasNoClaim</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">tokenAddress</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">)) &gt;= </span><span class=\"mtk12\">numTokensReservedForVesting</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">allocatedAmount</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INSUFFICIENT_BALANCE&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">withdraw</span><span class=\"mtk1\">() </span><span class=\"mtk11\">hasActiveClaim</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_msgSender</span><span class=\"mtk1\">()) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">tokenAddress</span><span class=\"mtk1\">.</span><span class=\"mtk11\">safeTransfer</span><span class=\"mtk1\">(</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">(), </span><span class=\"mtk12\">amountRemaining</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<h3 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h3>\n<p><a href=\"https://etherscan.io/address/0x312ca0592a39a5fa5c87bb4f1da7b77544a91b87#code\">https://etherscan.io/address/0x312ca0592a39a5fa5c87bb4f1da7b77544a91b87#code</a></p>\n<h3 id=\"recommended-mitigation-steps-7\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-7\" aria-label=\"recommended mitigation steps 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Disallow such kind of variable balance token.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/278#issuecomment-1257053341\">0xean (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>stETH only rebases up, not down.  So that is a poor example.</p>\n<p>The sponsor’s README does say they will support any ERC20 token, so that could include Fee on Transfer or downward rebasing tokens which could lead to less tokens in the contract than expected and transfers to revert due to balances being lower than expected. </p>\n<p>Downgrading to Medium as the external requirement is using these contracts on tokens that are known to have variable supply.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/278#issuecomment-1270993220\">lawrencehui (VTVL) confirmed and commented</a>:</strong></p>\n<blockquote>\n<p>Thanks for reporting this and I will add this as a feature enhancement to cater / avoid for tokens with rebasing supplies. </p>\n<p>Question: Is there a straight forward way to detect rebasing tokens? Or on the flip side, restricting erc20 tokens that do not exhibit rebasing behaviour?</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/278#issuecomment-1272148124\">0xean (judge) commented</a>:</strong></p>\n<blockquote>\n<p>@lawrencehui - Great question.  There isn’t a great way to detect this functionality in any generic manner unfortunately. </p>\n<p>Most contracts that want to handle FOT tokens will do something like (in pseudocode)</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">uint256 balBefore = ERC20.balanceOf(address(this));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ERC20.transferFrom(...);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">uint256 balAfter= ERC20.balanceOf(address(this));</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">uint256 actualBalChange = balAfter - balBefore;</span></span></code></pre>\n<p>Rebasing tokens are different again, and the easiest way to handle them is to create shares to track the internal math.  The shares track the % ownership of the entire balance of the contract.  Probably more than I can explain here, but would be happy to work with you if this is something you are interested in.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-07-vesting-schedule-start-and-end-time-can-be-set-in-the-past-\" style=\"position:relative;\"><a href=\"#m-07-vesting-schedule-start-and-end-time-can-be-set-in-the-past-\" aria-label=\"m 07 vesting schedule start and end time can be set in the past  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/292\">[M-07] Vesting Schedule Start and End Time can be Set in the Past </a></h2>\n<p><em>Submitted by TomJ, also found by ayeslick, csanuragjain, and pashov</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L245-L304\">VTVLVesting.sol#L245-L304</a><br></p>\n<p>There is no check whether <code>_startTimestamp</code> and <code>_endTimestamp</code> is greater than <code>block.timestamp</code>\nat <code>VTVLVesting.sol</code> <code>_createClaimUnchecked</code> function. Therefore it is possible for administrators to accidentally create\nvesting schedule that starts and ends in the past without noticing it. When administrators does this and this transaction goes\nthrough, then the vesting recipients can withdraw their entire vest amount which is not what administrators intended to do.\nAdd require check that force <code>_startTimestamp</code> to be greater than <code>block.timestamp</code>.</p>\n<p>Team comments as below on line 260</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">// -&gt; Conclusion: we want to allow this, for founders that might have forgotten to add some users, or to avoid issues with </span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">transactions not going through because of discoordination between block.timestamp and sender&#39;s local time</span></span></code></pre>\n<p>However this is not an issue by adding <code>require(_startTimestamp > uint40(block.timestamp))</code> since this will revert\ntransaction if _startTimestamp is less than block.timestamp so administrators can simply try again with correct time.\nOn the other hand, it is more dangerous to not include this check because transaction will simply succeed even though\n_startTimestamp is set to past which means that there is a chance of administrators not noticing this.</p>\n<h3 id=\"proof-of-concept-6\" style=\"position:relative;\"><a href=\"#proof-of-concept-6\" aria-label=\"proof of concept 6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<ol>\n<li>Admin creates new vesting schedule using <code>createClaim</code> function. However admin mistakenly set <code>_startTimestamp</code> and <code>_endTimestamp</code> in the past.</li>\n<li>Since there is no check of <code>require(_startTimestamp > uint40(block.timestamp))</code>, this transaction is valid and claim\nis created.</li>\n<li>Vesting recipients calls the <code>withdraw</code> function and receive entire vest amount.</li>\n</ol>\n<h3 id=\"recommended-mitigation-steps-8\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-8\" aria-label=\"recommended mitigation steps 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Add following check in <code>VTVLVesting.sol:_createClaimUnchecked</code> function.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">require(_startTimestamp &gt; uint40(block.timestamp), &quot;INVALID_START_TIMESTAMP&quot;)</span></span></code></pre>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/292#issuecomment-1257257193\">0xean (judge) commented</a>:</strong></p>\n<blockquote>\n<p>Going to use this issue for encompassing a few different reports that all revolve around adding some better validation around timestamps.  These include a few different potential fixes that the sponsor can review, but ultimately point to the same underlying issues.</p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/292#issuecomment-1270998197\">lawrencehui (VTVL) acknowledged, but disagreed with severity and commented</a>:</strong></p>\n<blockquote>\n<p>As described in the documentation, this back dated (<code>startTimestamp &#x3C; block.timestamp</code>) feature is indeed intended as there are many real life cases that founders want to reward their employees in the way the vesting period starts well before Token Generation Event (TGE). </p>\n<p>We appreciate wardens’ feedback on additional checking (both start and end time) and in our actual application, we would include multiple layer of checking / approval processes in front and backend before the transaction signing happens and therefore the risk is low in our opinion. </p>\n</blockquote>\n<hr>\n<h2 id=\"m-08-two-address-tokens-can-be-withdrawn-by-the-admin-even-if-they-are-vested\" style=\"position:relative;\"><a href=\"#m-08-two-address-tokens-can-be-withdrawn-by-the-admin-even-if-they-are-vested\" aria-label=\"m 08 two address tokens can be withdrawn by the admin even if they are vested permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/429\">[M-08] Two address tokens can be withdrawn by the admin even if they are vested</a></h2>\n<p><em>Submitted by CertoraInc, also found by 0xhunter, datapunk, dipp, Lambda, and wuwe1</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L446-L451\">VTVLVesting.sol#L446-L451</a><br></p>\n<p>Two address tokens exist in the blockchain. For example, Synthetix’s <code>ProxyERC20</code> contract is such a token which exists in many forms (sUSD, sBTC…). Tokens as such can be vested, but the admin can withdraw them even if they are vested by providing the other address to the <code>withdrawOtherToken</code> function. The only check in this function is that <code>_otherTokenAddress != tokenAddress</code>, which is irrelevant in the case of two address tokens.</p>\n<p>This can make the admin be able to withdraw the vested funds and break the system, because the balance of the contract can be less than the vested amount.</p>\n<h3 id=\"proof-of-concept-7\" style=\"position:relative;\"><a href=\"#proof-of-concept-7\" aria-label=\"proof of concept 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<ol>\n<li>The <code>VTVLVesting</code> is deployed with the <code>sUSD</code> contract, using its main (proxy) address - <code>0x57Ab1ec28D129707052df4dF418D58a2D46d5f51</code>.</li>\n<li>A claim is created for Alice, vesting 1000 sUSD in linear vesting. Assuming this is the only claim currently, the balance of the contract is 1000 sUSD and the value of <code>numTokensReservedForVesting</code> is <code>1000e18</code>.</li>\n<li>The admin calls the <code>withdrawOtherToken</code> for 1000e18 sUSD, providing its second address - <code>0x57Ab1ec28D129707052df4dF418D58a2D46d5f51</code>. The value of <code>numTokensReservedForVesting</code> is still <code>1000e18</code>, but the balance of the contract is now 0 sUSD.</li>\n<li>Alice waits for her vest to end, calls the withdraw function, but the function reverts on the call to <code>safeTransfer()</code> because there is insufficient balance of sUSD. Alice can’t receive her funds.</li>\n</ol>\n<h3 id=\"recommended-mitigation-steps-9\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-9\" aria-label=\"recommended mitigation steps 9 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Replace the address check with a balance check - record the vesting token balance of the contract before and after the transfer and assert that they are equal.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/429#issuecomment-1257055160\">0xean (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>Downgrading to Medium. The fix is a good idea, but this is a pretty rare token implementation and definitely qualifies as an external factor. </p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/429#issuecomment-1271301629\">lawrencehui (VTVL) acknowledged and commented</a>:</strong></p>\n<blockquote>\n<p>Yes, agreed with @0xean that this is very rare and appreciate warden’s suggestion on the fix on balance checking.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-09-_releaseintervalsecs-is-not-validated\" style=\"position:relative;\"><a href=\"#m-09-_releaseintervalsecs-is-not-validated\" aria-label=\"m 09 _releaseintervalsecs is not validated permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/448\">[M-09] <code>_releaseIntervalSecs</code> is not validated</a></h2>\n<p><em>Submitted by sorrynotsorry</em></p>\n<p>VTVLVesting.sol has <code>_createClaimUnchecked</code> function to create the claims internally while validating parameters with the users’ allocations.<br>\nHowever, <code>_releaseIntervalSecs</code> is not validated comparing to user’s  <code>_linearVestAmount</code> and <code>_startTimestamp</code> <code>_endTimestamp</code>.\nTheoretically, <code>_linearVestAmount</code> should be equal to <code>((_endTimestamp - _startTimestamp) * _releaseIntervalSecs)</code> so the <code>_releaseIntervalSecs</code> = <code>_linearVestAmount / ((_endTimestamp - _startTimestamp)</code>.<br>\nBut this check was never done.</p>\n<p>If the <code>_releaseIntervalSecs</code> is validated either to a higher or to a lower amount, it will create unfair distributions amongst the users during withdrawals due to being higher/lower than it should be. And also it may end up with the last withdrawals can be reverted due to the calculation board not matching.</p>\n<h3 id=\"proof-of-concept-8\" style=\"position:relative;\"><a href=\"#proof-of-concept-8\" aria-label=\"proof of concept 8 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">_createClaimUnchecked</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_startTimestamp</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_endTimestamp</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_cliffReleaseTimestamp</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_releaseIntervalSecs</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">uint112</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_linearVestAmount</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">uint112</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_cliffAmount</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                ) </span><span class=\"mtk11\">private</span><span class=\"mtk1\">  </span><span class=\"mtk11\">hasNoClaim</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">), </span><span class=\"mtk8\">&quot;INVALID_ADDRESS&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_linearVestAmount</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">_cliffAmount</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_VESTED_AMOUNT&quot;</span><span class=\"mtk1\">); </span><span class=\"mtk3\">// Actually only one of linearvested/cliff amount must be 0, not necessarily both</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_startTimestamp</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_START_TIMESTAMP&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Do we need to check whether _startTimestamp is greater than the current block.timestamp? </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Or do we allow schedules that started in the past? </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// -&gt; Conclusion: we want to allow this, for founders that might have forgotten to add some users, or to avoid issues with transactions not going through because of discoordination between block.timestamp and sender&#39;s local time</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// require(_endTimestamp &gt; 0, &quot;_endTimestamp must be valid&quot;); // not necessary because of the next condition (transitively)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_startTimestamp</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">_endTimestamp</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_END_TIMESTAMP&quot;</span><span class=\"mtk1\">); </span><span class=\"mtk3\">// _endTimestamp must be after _startTimestamp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_releaseIntervalSecs</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_RELEASE_INTERVAL&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">((</span><span class=\"mtk12\">_endTimestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">_startTimestamp</span><span class=\"mtk1\">) % </span><span class=\"mtk12\">_releaseIntervalSecs</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_INTERVAL_LENGTH&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Potential TODO: sanity check, if _linearVestAmount == 0, should we perhaps force that start and end ts are the same?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// No point in allowing cliff TS without the cliff amount or vice versa.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Both or neither of _cliffReleaseTimestamp and _cliffAmount must be set. If cliff is set, _cliffReleaseTimestamp must be before or at the _startTimestamp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">( </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">_cliffReleaseTimestamp</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> &amp;&amp; </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">_cliffAmount</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> &amp;&amp; </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">_cliffReleaseTimestamp</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk12\">_startTimestamp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            ) || (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">_cliffReleaseTimestamp</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> &amp;&amp; </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">_cliffAmount</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        ), </span><span class=\"mtk8\">&quot;INVALID_CLIFF&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">Claim</span><span class=\"mtk1\"> </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">Claim</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">startTimestamp:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_startTimestamp</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">endTimestamp:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_endTimestamp</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">cliffReleaseTimestamp:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_cliffReleaseTimestamp</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">releaseIntervalSecs:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_releaseIntervalSecs</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">cliffAmount:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_cliffAmount</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">linearVestAmount:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_linearVestAmount</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">amountWithdrawn:</span><span class=\"mtk1\"> </span><span class=\"mtk7\">0</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">isActive:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Our total allocation is simply the full sum of the two amounts, _cliffAmount + _linearVestAmount</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Not necessary to use the more complex logic from _baseVestedAmount</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">uint112</span><span class=\"mtk1\"> </span><span class=\"mtk12\">allocatedAmount</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_cliffAmount</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">_linearVestAmount</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Still no effects up to this point (and tokenAddress is selected by contract deployer and is immutable), so no reentrancy risk </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">tokenAddress</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">)) &gt;= </span><span class=\"mtk12\">numTokensReservedForVesting</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">allocatedAmount</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INSUFFICIENT_BALANCE&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Done with checks</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// Effects limited to lines below</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">claims</span><span class=\"mtk1\">[</span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\">] = </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// store the claim</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">numTokensReservedForVesting</span><span class=\"mtk1\"> += </span><span class=\"mtk12\">allocatedAmount</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// track the allocated amount</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">vestingRecipients</span><span class=\"mtk1\">.</span><span class=\"mtk11\">push</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\">); </span><span class=\"mtk3\">// add the vesting recipient to the list</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">ClaimCreated</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\">, </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">); </span><span class=\"mtk3\">// let everyone know</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L245-L304\">Permalink</a></p>\n<h3 id=\"recommended-mitigation-steps-10\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-10\" aria-label=\"recommended mitigation steps 10 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>The <code>_releaseIntervalSecs</code> should be validated comparing to user’s  <code>_linearVestAmount</code> and <code>_startTimestamp</code> <code>_endTimestamp</code>.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/448#issuecomment-1257056265\">0xean (judge) decreased severity to Medium and commented</a>:</strong></p>\n<blockquote>\n<p>This is fair, but due to it being behind only admin functionality and coming down to input sanitization, going to downgrade to Medium.  </p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/448#issuecomment-1271710784\">lawrencehui (VTVL) acknowledged, but disagreed with severity and commented</a>:</strong></p>\n<blockquote>\n<p>I agree with @0xean that the risk in this case is low given the onlyAdmin modifier and the input will be validated from the frontend anyway. Appreciate the finding and we will take consideration of adding additional checking of <code>_releaseIntervalSecs</code>.</p>\n</blockquote>\n<hr>\n<h2 id=\"m-10-reentrancy-may-allow-an-admin-to-steal-funds\" style=\"position:relative;\"><a href=\"#m-10-reentrancy-may-allow-an-admin-to-steal-funds\" aria-label=\"m 10 reentrancy may allow an admin to steal funds permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/6\">[M-10] Reentrancy may allow an admin to steal funds</a></h2>\n<p><em>Submitted by Czar102, also found by 0xSmartContract, csanuragjain, hansfriese, Lambda, Respx, and sashik_eth</em></p>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/main/contracts/VTVLVesting.sol#L394-L411\">VTVLVesting.sol#L394-L411</a><br></p>\n<p>If the token is reentrant, an admin can steal all tokens locked in the <code>VTVLVesting</code> contract while having active locks.</p>\n<p>In other words, due to this exploit possibility, the contract may be insolvent with respect to <em>active</em> vestings. Note that revoking claim doesn’t break this invariant since the vesting is closed in that case.</p>\n<h3 id=\"proof-of-concept-9\" style=\"position:relative;\"><a href=\"#proof-of-concept-9\" aria-label=\"proof of concept 9 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>The reentrancy in the vested token can be used by an admin if the execution can be hijacked before the balance change occurs.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"js\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">@notice</span><span class=\"mtk3\"> Admin withdrawal of the unallocated tokens.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">@param</span><span class=\"mtk3\"> </span><span class=\"mtk12\">_amountRequested</span><span class=\"mtk3\"> - the amount that we want to withdraw</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">\t*/</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">withdrawAdmin</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint112</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_amountRequested</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyAdmin</span><span class=\"mtk1\"> {    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk3\">// Allow the owner to withdraw any balance not currently tied up in contracts.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amountRemaining</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">tokenAddress</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">)) - </span><span class=\"mtk12\">numTokensReservedForVesting</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amountRemaining</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">_amountRequested</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INSUFFICIENT_BALANCE&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk3\">// Actually withdraw the tokens</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk3\">// Reentrancy note - this operation doesn&#39;t touch any of the internal vars, simply transfers</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk3\">// Also following Checks-effects-interactions pattern</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk12\">tokenAddress</span><span class=\"mtk1\">.</span><span class=\"mtk11\">safeTransfer</span><span class=\"mtk1\">(</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">(), </span><span class=\"mtk12\">_amountRequested</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk3\">// Let the withdrawal known to everyone</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">AdminWithdrawn</span><span class=\"mtk1\">(</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">(), </span><span class=\"mtk12\">_amountRequested</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>Let’s consider function <code>withdrawAdmin</code>. Firstly, the balance is checked and then if there is enough token surplus to withdraw, the withdrawal is allowed. The surplus is based on two values: <code>numTokensReservedForVesting</code> which isn’t changed by this function and the balance of the contract.</p>\n<p>If the owner hijacks the execution before the balance change in the token transfer (which is possible in, for example, ERC777), an admin can call this function again and it will allow for an invocation of another transfer since the token balance hasn’t changed yet.</p>\n<p>For example, if there is <code>$1m</code> in vestings in the contract, an admin can send <code>$100k</code> to it in tokens and recursively invoke <code>withdrawalAdmin</code> with the amount of <code>$100k</code> eleven times so that the whole contract balance will be drained.</p>\n<h3 id=\"recommended-mitigation-steps-11\" style=\"position:relative;\"><a href=\"#recommended-mitigation-steps-11\" aria-label=\"recommended mitigation steps 11 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recommended Mitigation Steps</h3>\n<p>Add <code>ReentrancyGuard</code>’s <code>nonReentrant</code> to the <code>withdrawAdmin</code> function.</p>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/6#issuecomment-1257063808\">0xean (judge) commented</a>:</strong></p>\n<blockquote>\n<p>This would require a number of assumptions to be the case including a malicious admin which the sponsors called out of scope.  Because it is obviously not intended functionality, I am going to leave as Medium pending sponsor review. I think the non-reentrant modifier is worth adding. </p>\n</blockquote>\n<p><strong><a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/6#issuecomment-1271726987\">lawrencehui (VTVL) acknowledged and commented</a>:</strong></p>\n<blockquote>\n<p>Will consider adding ReentrancyGuard as suggested.</p>\n</blockquote>\n<hr>\n<h1 id=\"low-risk-and-non-critical-issues\" style=\"position:relative;\"><a href=\"#low-risk-and-non-critical-issues\" aria-label=\"low risk and non critical issues permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Low Risk and Non-Critical Issues</h1>\n<p>For this contest, 135 reports were submitted by wardens detailing low risk and non-critical issues. The <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/277\">report highlighted below</a> by <strong>AkshaySrivastav</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/273\">rbserver</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/251\">IllIllI</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/367\">0xNazgul</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/44\">0x1f8b</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/349\">lukris02</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/189\">rotcivegaf</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/358\">ajtra</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/442\">cryptostellar5</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/270\">0xSmartContract</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/441\">Deivitto</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/76\">Bahurum</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/359\">brgltd</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/445\">Diana</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/459\">c3phas</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/303\">chatch</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/9\">ladboy233</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/34\">supernova</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/32\">RockingMiles</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/199\">Waze</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/344\">tnevler</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/375\">a12jmx</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/466\">Funen</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/20\">pcarranzav</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/201\">0x4non</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/212\">KIntern_NA</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/151\">__141345__</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/330\">delfin454000</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/341\">0x5rings</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/436\">Aymen0909</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/11\">ubermensch</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/268\">Rolezn</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/326\">leosathya</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/376\">0xf15ers</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/438\">gogo</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/467\">CodingNameKiki</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/471\">V_B</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/487\">aysha</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/216\">seyni</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/25\">Dravee</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/27\">ChristianKuri</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/284\">JLevick</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/435\">CertoraInc</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/93\">JohnnyTime</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/46\">Bnke0x0</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/82\">Lambda</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/102\">Respx</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/118\">RaymondFam</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/141\">rajatbeladiya</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/161\">ikbkln</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/171\">neumo</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/337\">TomJ</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/347\">0xA5DF</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/377\">0xSky</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/423\">Aeros</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/446\">sorrynotsorry</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/215\">async</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/324\">prasantgupta52</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/395\">0xDecorativePineapple</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/56\">rvierdiiev</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/131\">sach1r0</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/158\">ElKu</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/174\">slowmoses</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/203\">neko_nyaa</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/116\">Tomo</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/110\">bin2chen</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/165\">innertia</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/355\">yongskiws</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/207\">ignacio</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/394\">djxploit</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/415\">JohnSmith</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/443\">got_targ</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/493\">joestakey</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/227\">csanuragjain</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/248\">rokinot</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/255\">cryptphi</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/295\">ayeslick</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/310\">romand</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/327\">peanuts</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/340\">RustyRabbit</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/348\">0xbepresent</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/361\">hansfriese</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/380\">Chom</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/398\">berndartmueller</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/401\">dic0de</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/422\">peritoflores</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/58\">zzzitron</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/65\">cccz</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/92\">obront</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/99\">reassor</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/68\">bobirichman</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/72\">sikorico</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/73\">Margaret</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/107\">datapunk</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/120\">karanctf</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/127\">fatherOfBlocks</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/266\">0xmatt</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/294\">nalus</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/308\">eighty</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/313\">ret2basic</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/180\">Ruhum</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/386\">Sm4rty</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/492\">Rohan16</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/193\">pedr02b2</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/354\">ReyAdmirado</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/399\">indijanc</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/412\">SooYa</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/483\">pedroais</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/485\">d3e4</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/439\">ak1</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/97\">zzykxx</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/15\">erictee</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/63\">oyc_109</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/87\">ch13fd357r0y3r</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/100\">millersplanet</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/177\">martin</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/181\">2997ms</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/242\">B2</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/254\">tibthecat</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/262\">OptimismSec</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/302\">exd0tpy</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/306\">medikko</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/312\">peiw</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/497\">JC</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/134\">StevenL</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/147\">durianSausage</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/388\">0v3rf10w</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/405\">0x040</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/488\">natzuu</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/49\">Yiko</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/111\">carrotsmuggler</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/133\">0x85102</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/143\">MasterCookie</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/168\">bulej93</a>, and <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/210\">Diraco</a>.</em></p>\n<h2 id=\"01\" style=\"position:relative;\"><a href=\"#01\" aria-label=\"01 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[01]</h2>\n<p>The <code>setAdmin()</code> function in AccessProtected.sol can be used to revoke all admins. This could be a feature to completely renounce ownership of the contract after all claims are set or could be a bug in which one admin either intentionally or unintentionally removes all admin (or all other admins except himself).</p>\n<h2 id=\"02\" style=\"position:relative;\"><a href=\"#02\" aria-label=\"02 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[02]</h2>\n<p>Line 161 in <code>VTVLVesting._baseVestedAmount()</code> function should not get executed when <code>cliffAmount</code> is 0. In the case of no cliff amount, i.e. where <code>cliffReleaseTimestamp</code> and <code>cliffAmount</code> are both set as 0, the program execution should not enter the <code>if</code> block.<br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">160    if(_referenceTs &gt;= _claim.cliffReleaseTimestamp) {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">161        vestAmt += _claim.cliffAmount;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">162    }</span></span></code></pre>\n<h2 id=\"03\" style=\"position:relative;\"><a href=\"#03\" aria-label=\"03 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[03]</h2>\n<p>Solidity pragma versioning should be upgraded to latest available version. Currently the solidity version in contracts is ^0.8.14 which was found to possess some bugs.</p>\n<h2 id=\"04\" style=\"position:relative;\"><a href=\"#04\" aria-label=\"04 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[04]</h2>\n<p>Solidity pragma versioning should be exactly same in all contracts. Currently some contracts use ^0.8.14 but some are fixed to 0.8.14.</p>\n<h2 id=\"05\" style=\"position:relative;\"><a href=\"#05\" aria-label=\"05 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[05]</h2>\n<p>No need to re-inherit Context contract in <a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L11\">VTVLVesting</a> smart contract as Context is already inherited by <a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/AccessProtected.sol#L11\">AccessProtected</a> contract.</p>\n<h2 id=\"06\" style=\"position:relative;\"><a href=\"#06\" aria-label=\"06 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[06]</h2>\n<p>Ownable smart contract is unnecessarily imported in <a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/AccessProtected.sol#L5\">AccessProtected.sol</a> while it is never used. Unnecessary imports decreases the readability of smart contract code.</p>\n<h2 id=\"07\" style=\"position:relative;\"><a href=\"#07\" aria-label=\"07 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[07]</h2>\n<p>Unnecessary imports are also present in <a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L5-L7\">VTVLVesting.sol</a>. The compilation works completely fine with just importing SafeERC20.sol and AccessProtected.sol.</p>\n<h2 id=\"08\" style=\"position:relative;\"><a href=\"#08\" aria-label=\"08 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[08]</h2>\n<p>AccessProtected - contract docs do not match implementaion. The implementation only has multiple equal rights admins and no <code>owner</code> field is present while the docs states something else.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">7</span><span class=\"mtk1\">    </span><span class=\"mtk3\">/** </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">8        </span><span class=\"mtk4\">@title</span><span class=\"mtk3\"> Access Limiter to multiple owner-specified accounts.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">9        </span><span class=\"mtk4\">@dev</span><span class=\"mtk3\"> Exposes the onlyAdmin modifier, which will revert (ADMIN_ACCESS_REQUIRED) if the caller is not the owner nor the admin.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">10    */</span></span></span></code></pre>\n<h2 id=\"09\" style=\"position:relative;\"><a href=\"#09\" aria-label=\"09 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[09]</h2>\n<p><code>VariableSupplyERC20Token.constructor()</code> has an empty <code>@dev</code> tag.</p>\n<h2 id=\"10\" style=\"position:relative;\"><a href=\"#10\" aria-label=\"10 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[10]</h2>\n<p>VariableSupplyERC20Token contract mentions an incorrect comment</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">48</span><span class=\"mtk1\">    </span><span class=\"mtk3\">// We can&#39;t really have burn, because that could make our vesting contract not work.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">49</span><span class=\"mtk1\">    </span><span class=\"mtk3\">// Example: if the user can burn tokens already assigned to vesting schedules, it could be unable to pay its obligations.</span></span></span></code></pre>\n<p>Token can be made burnable in which users can be allowed to burn their own tokens.</p>\n<h2 id=\"11\" style=\"position:relative;\"><a href=\"#11\" aria-label=\"11 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[11]</h2>\n<p>Line 159 in <code>VTVLVesting._baseVestedAmount()</code> contains a misleading comment</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">159</span><span class=\"mtk1\">        </span><span class=\"mtk3\">// We don&#39;t check here that cliffReleaseTimestamp is after the startTimestamp </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">160</span><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_referenceTs</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">cliffReleaseTimestamp</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">161</span><span class=\"mtk1\">            </span><span class=\"mtk12\">vestAmt</span><span class=\"mtk1\"> += </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">cliffAmount</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">162</span><span class=\"mtk1\">        }</span></span></span></code></pre>\n<p><code>cliffReleaseTimestamp</code> can never be after <code>startTimestamp</code> as per the <a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L274\"><code>require</code></a> statements of <code>_createClaimUnchecked()</code>.</p>\n<h2 id=\"12\" style=\"position:relative;\"><a href=\"#12\" aria-label=\"12 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[12]</h2>\n<p>As per the implementation of vesting contract, Line 21 in VTVLVesting.sol should mention <em>greater than or equal</em> instead of just <em>greater than</em>.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"19\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">21</span><span class=\"mtk1\">    </span><span class=\"mtk3\">/// @dev Our balance of the token must always be greater than this amount.</span></span></span></code></pre>\n<h2 id=\"13\" style=\"position:relative;\"><a href=\"#13\" aria-label=\"13 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[13]</h2>\n<p><code>VTVLVesting.ClaimCreated</code> and <code>VTVLVesting.ClaimRevoked</code> events should also log the admin’s address so it can be easily queried which admin created and revoked the claim.</p>\n<h2 id=\"14\" style=\"position:relative;\"><a href=\"#14\" aria-label=\"14 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[14]</h2>\n<p>In VTVLVesting contract, before revoking a claim the contract should transfer all the pending/partially vested rewards. Otherwise the entire vesting amount will get revoked.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"20\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">It is at the discretion of protocol development team to decide whether the current behaviour is intended or not.</span></span></code></pre>\n<h2 id=\"15\" style=\"position:relative;\"><a href=\"#15\" aria-label=\"15 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[15]</h2>\n<p>At <a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L82\">Line 82</a> of <code>VTVLVesting.constructor()</code>, a better check would be to do <code>_tokenAddress.totalSupply()</code>. As this will also ensure that the input address in indeed a token’s address and perform the zero address check as well.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"21\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">82    require(address(_tokenAddress) != address(0), &quot;INVALID_ADDRESS&quot;);</span></span></code></pre>\n<h2 id=\"16\" style=\"position:relative;\"><a href=\"#16\" aria-label=\"16 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[16]</h2>\n<p>The <code>tokenAddress</code> state variable of VTVLVesting should be renamed to <code>token</code> as this variable represents an <code>IERC20</code> interface rather that just an address. Renaming it to <code>token</code> aligns better with its usage.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"22\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">17    IERC20 public immutable tokenAddress;</span></span></code></pre>\n<h2 id=\"17\" style=\"position:relative;\"><a href=\"#17\" aria-label=\"17 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[17]</h2>\n<p>There should be a factory contract for VTVLVesting contract which can keep track of all vesting contracts deployed by different founders. The Factory contract aligns better with the business usecase of VTVL protocol owners.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"23\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">From the spec, &quot;The core function of VTVL is to allow users to generate and deploy token vesting smart contracts through our platform.&quot;</span></span></code></pre>\n<h2 id=\"18\" style=\"position:relative;\"><a href=\"#18\" aria-label=\"18 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[18]</h2>\n<p>In <code>VariableSupplyERC20Token.mint()</code> function, non-zero input validation check should be done similar to <code>FullPremintERC20Token.constructor()</code>.</p>\n<h2 id=\"19\" style=\"position:relative;\"><a href=\"#19\" aria-label=\"19 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[19]</h2>\n<p>In all solidity files, license keyword should be mentioned as <code>// SPDX-License-Identifier: UNLICENSED</code>.</p>\n<h2 id=\"20\" style=\"position:relative;\"><a href=\"#20\" aria-label=\"20 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[20]</h2>\n<p>All the actors interacting with a VTVLVesting contract need to fully trust all of its admins. Any one of the potentially infinite admins of VTVLVesting contract has the power to (either intentionally or unintentionally):\n*   revoke claims of all recipients and withdraw all tokens, resulting in a rugpull attack.\n*   give or take back the admin rights to or from any ethereum address.\n*   withdraw any other ERC20 token from the vesting contract.</p>\n<hr>\n<h1 id=\"gas-optimizations\" style=\"position:relative;\"><a href=\"#gas-optimizations\" aria-label=\"gas optimizations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gas Optimizations</h1>\n<p>For this contest, 141 reports were submitted by wardens detailing gas optimizations. The <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/253\">report highlighted below</a> by <strong>IllIllI</strong> received the top score from the judge.</p>\n<p><em>The following wardens also submitted reports: <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/383\">Aymen0909</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/272\">pfapostol</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/457\">c3phas</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/282\">JLevick</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/432\">Deivitto</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/437\">gogo</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/481\">CertoraInc</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/491\">JC</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/43\">Bnke0x0</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/62\">oyc_109</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/146\">durianSausage</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/150\">__141345__</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/188\">rotcivegaf</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/274\">0xSmartContract</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/299\">ajtra</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/385\">Sm4rty</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/397\">cryptostellar5</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/407\">Diana</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/414\">JohnSmith</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/115\">Tomo</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/170\">zishansami</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/176\">martin</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/185\">ch0bu</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/305\">SnowMan</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/323\">prasantgupta52</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/13\">erictee</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/17\">millersplanet</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/363\">djxploit</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/484\">Rohan16</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/42\">0x1f8b</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/114\">RaymondFam</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/202\">0x4non</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/259\">rbserver</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/269\">Rolezn</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/332\">TomJ</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/364\">brgltd</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/366\">0xNazgul</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/86\">Saintcode_</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/119\">karanctf</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/301\">medikko</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/314\">ret2basic</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/16\">0xsam</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/353\">ReyAdmirado</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/356\">seyni</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/36\">gianganhnguyen</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/50\">Ruhum</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/112\">carrotsmuggler</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/173\">slowmoses</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/182\">WilliamAmbrozic</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/240\">B2</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/311\">peiw</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/318\">0x040</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/321\">leosathya</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/328\">delfin454000</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/345\">Tomio</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/2\">samruna</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/351\">lukris02</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/482\">aysha</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/204\">yaemsobak</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/246\">Junnon</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/320\">imare</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/309\">eighty</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/329\">0xA5DF</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/8\">ladboy233</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/22\">emrekocak</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/346\">tnevler</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/461\">pauliax</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/79\">ikbkln</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/152\">neko_nyaa</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/223\">jag</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/252\">Tadashi</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/260\">Atarpara</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/276\">tgolding55</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/331\">0xbepresent</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/336\">Ocean_Sky</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/339\">peanuts</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/258\">caventa</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/31\">RockingMiles</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/33\">supernova</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/409\">SooYa</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/410\">beardofginger</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/468\">natzuu</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/479\">pedroais</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/69\">bobirichman</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/70\">dharma09</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/117\">DimitarDimitrov</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/130\">sach1r0</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/198\">Waze</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/205\">ignacio</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/217\">async</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/257\">tibthecat</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/263\">OptimismSec</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/279\">AkshaySrivastav</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/304\">malinariy</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/325\">lucacez</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/26\">ChristianKuri</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/408\">Chom</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/465\">Funen</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/489\">d3e4</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/496\">subtle77</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/126\">fatherOfBlocks</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/382\">0xDanielC</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/387\">indijanc</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/425\">ak1</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/440\">got_targ</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/71\">mics</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/81\">Lambda</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/213\">KIntern_NA</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/281\">w0Lfrum</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/19\">hxzy</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/391\">Amithuddar</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/470\">V_B</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/74\">Tagir2003</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/80\">0xc0ffEE</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/101\">Respx</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/142\">MasterCookie</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/160\">Satyam_Sharma</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/183\">Noah3o6</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/249\">rokinot</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/293\">nalus</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/317\">jpserrat</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/421\">CodingNameKiki</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/37\">Matin</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/57\">rvierdiiev</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/75\">adriro</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/136\">StevenL</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/167\">bulej93</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/178\">2997ms</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/211\">Diraco</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/234\">csanuragjain</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/352\">Sta1400</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/389\">0v3rf10w</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/132\">0x85102</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/196\">mrpathfindr</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/300\">exd0tpy</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/357\">cryptphi</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/370\">a12jmx</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/378\">francoHacker</a>, <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/495\">m9800</a>, and <a href=\"https://github.com/code-423n4/2022-09-vtvl-findings/issues/48\">Yiko</a>.</em></p>\n<h2 id=\"summary-1\" style=\"position:relative;\"><a href=\"#summary-1\" aria-label=\"summary 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h2>\n<table>\n<thead>\n<tr>\n<th></th>\n<th align=\"left\">Issue</th>\n<th align=\"center\">Instances</th>\n<th align=\"center\">Total Gas Saved</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>[G‑01]</td>\n<td align=\"left\">Save gas by not requring non-zero interval if no linear amount</td>\n<td align=\"center\">1</td>\n<td align=\"center\">17100</td>\n</tr>\n<tr>\n<td>[G‑02]</td>\n<td align=\"left\">Results of calls to <code>_msgSender()</code> not cached</td>\n<td align=\"center\">4</td>\n<td align=\"center\">64</td>\n</tr>\n<tr>\n<td>[G‑03]</td>\n<td align=\"left\">Using <code>calldata</code> instead of <code>memory</code> for read-only arguments in <code>external</code> functions saves gas</td>\n<td align=\"center\">7</td>\n<td align=\"center\">840</td>\n</tr>\n<tr>\n<td>[G‑04]</td>\n<td align=\"left\">State variables should be cached in stack variables rather than re-reading them from storage</td>\n<td align=\"center\">1</td>\n<td align=\"center\">97</td>\n</tr>\n<tr>\n<td>[G‑05]</td>\n<td align=\"left\"><code>&#x3C;x> += &#x3C;y></code> costs more gas than <code>&#x3C;x> = &#x3C;x> + &#x3C;y></code> for state variables</td>\n<td align=\"center\">4</td>\n<td align=\"center\">452</td>\n</tr>\n<tr>\n<td>[G‑06]</td>\n<td align=\"left\">Add <code>unchecked {}</code> for subtractions where the operands cannot underflow because of a previous <code>require()</code> or <code>if</code>-statement</td>\n<td align=\"center\">4</td>\n<td align=\"center\">340</td>\n</tr>\n<tr>\n<td>[G‑07]</td>\n<td align=\"left\"><code>++i</code>/<code>i++</code> should be <code>unchecked{++i}</code>/<code>unchecked{i++}</code> when it is not possible for them to overflow, as is the case when used in <code>for</code>- and <code>while</code>-loops</td>\n<td align=\"center\">1</td>\n<td align=\"center\">60</td>\n</tr>\n<tr>\n<td>[G‑08]</td>\n<td align=\"left\">Optimize names to save gas</td>\n<td align=\"center\">3</td>\n<td align=\"center\">66</td>\n</tr>\n<tr>\n<td>[G‑09]</td>\n<td align=\"left\">Using <code>bool</code>s for storage incurs overhead</td>\n<td align=\"center\">1</td>\n<td align=\"center\">20000</td>\n</tr>\n<tr>\n<td>[G‑10]</td>\n<td align=\"left\"><code>++i</code> costs less gas than <code>i++</code>, especially when it’s used in <code>for</code>-loops (<code>--i</code>/<code>i--</code> too)</td>\n<td align=\"center\">1</td>\n<td align=\"center\">10</td>\n</tr>\n<tr>\n<td>[G‑11]</td>\n<td align=\"left\">Splitting <code>require()</code> statements that use <code>&#x26;&#x26;</code> saves gas</td>\n<td align=\"center\">1</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td>[G‑12]</td>\n<td align=\"left\">Don’t compare boolean expressions to boolean literals</td>\n<td align=\"center\">1</td>\n<td align=\"center\">9</td>\n</tr>\n<tr>\n<td>[G‑13]</td>\n<td align=\"left\">Use custom errors rather than <code>revert()</code>/<code>require()</code> strings to save gas</td>\n<td align=\"center\">24</td>\n<td align=\"center\">-</td>\n</tr>\n<tr>\n<td>[G‑14]</td>\n<td align=\"left\">Functions guaranteed to revert when called by normal users can be marked <code>payable</code></td>\n<td align=\"center\">7</td>\n<td align=\"center\">147</td>\n</tr>\n<tr>\n<td>[G‑15]</td>\n<td align=\"left\">Don’t use <code>_msgSender()</code> if not supporting EIP-2771</td>\n<td align=\"center\">13</td>\n<td align=\"center\">208</td>\n</tr>\n</tbody>\n</table>\n<p>Total: 73 instances over 15 issues with <strong>39396 gas</strong> saved</p>\n<p>Gas totals use lower bounds of ranges and count two iterations of each <code>for</code>-loop. All values above are runtime, not deployment, values.</p>\n<h2 id=\"g01--save-gas-by-not-requring-non-zero-interval-if-no-linear-amount\" style=\"position:relative;\"><a href=\"#g01--save-gas-by-not-requring-non-zero-interval-if-no-linear-amount\" aria-label=\"g01  save gas by not requring non zero interval if no linear amount permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑01]  Save gas by not requring non-zero interval if no linear amount</h2>\n<p>If there is no linear amount, a Gsset for the claim’s interval can be converted to a Gsreset, saving <strong>17100 gas</strong>.</p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"24\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: /</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">263</span><span class=\"mtk1\">          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_releaseIntervalSecs</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_RELEASE_INTERVAL&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">264</span><span class=\"mtk1\">:         </span><span class=\"mtk11\">require</span><span class=\"mtk1\">((</span><span class=\"mtk12\">_endTimestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">_startTimestamp</span><span class=\"mtk1\">) % </span><span class=\"mtk12\">_releaseIntervalSecs</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_INTERVAL_LENGTH&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L263-L264\">VTVLVesting.sol#L263-L264</a></p>\n<h2 id=\"g02--results-of-calls-to-_msgsender-not-cached\" style=\"position:relative;\"><a href=\"#g02--results-of-calls-to-_msgsender-not-cached\" aria-label=\"g02  results of calls to _msgsender not cached permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑02]  Results of calls to <code>_msgSender()</code> not cached</h2>\n<p>Saves at least <strong>16 gas</strong> per call skipped.</p>\n<p><em>There are 4 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"25\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: /</span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">371</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">uint112</span><span class=\"mtk1\"> </span><span class=\"mtk12\">allowance</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">vestedAmount</span><span class=\"mtk1\">(</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">(), </span><span class=\"mtk11\">uint40</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">388</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">tokenAddress</span><span class=\"mtk1\">.</span><span class=\"mtk11\">safeTransfer</span><span class=\"mtk1\">(</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">(), </span><span class=\"mtk12\">amountRemaining</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">391</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Claimed</span><span class=\"mtk1\">(</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">(), </span><span class=\"mtk12\">amountRemaining</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">410</span><span class=\"mtk1\">:         </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">AdminWithdrawn</span><span class=\"mtk1\">(</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">(), </span><span class=\"mtk12\">_amountRequested</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L371\">VTVLVesting.sol#L371</a></p>\n<h2 id=\"g03--using-calldata-instead-of-memory-for-read-only-arguments-in-external-functions-saves-gas\" style=\"position:relative;\"><a href=\"#g03--using-calldata-instead-of-memory-for-read-only-arguments-in-external-functions-saves-gas\" aria-label=\"g03  using calldata instead of memory for read only arguments in external functions saves gas permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑03]  Using <code>calldata</code> instead of <code>memory</code> for read-only arguments in <code>external</code> functions saves gas</h2>\n<p>When a function with a <code>memory</code> array is called externally, the <code>abi.decode()</code> step has to use a for-loop to copy each index of the <code>calldata</code> to the <code>memory</code> index. <strong>Each iteration of this for-loop costs at least 60 gas</strong> (i.e. <code>60 * &#x3C;mem_array>.length</code>). Using <code>calldata</code> directly, obliviates the need for such a loop in the contract code and runtime execution. Note that even if an interface defines a function as having <code>memory</code> arguments, it’s still valid for implementation contracs to use <code>calldata</code> arguments instead.</p>\n<p>If the array is passed to an <code>internal</code> function which passes the array to another internal function where the array is modified and therefore <code>memory</code> is used in the <code>external</code> call, it’s still more gass-efficient to use <code>calldata</code> when the <code>external</code> function uses modifiers, since the modifiers may prevent the internal functions from being called. Structs have the same overhead as an array of length one.</p>\n<p>Note that I’ve also flagged instances where the function is <code>public</code> but can be marked as <code>external</code> since it’s not called by the contract, and cases where a constructor is involved.</p>\n<p><em>There are 7 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"26\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit _recipients</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit _startTimestamps</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit _endTimestamps</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit _cliffReleaseTimestamps</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit _releaseIntervalsSecs</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit _linearVestAmounts</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit _cliffAmounts</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">333</span><span class=\"mtk1\">       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">createClaimsBatch</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">334           </span><span class=\"mtk12\">address</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_recipients</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">335           </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_startTimestamps</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">336           </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_endTimestamps</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">337           </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_cliffReleaseTimestamps</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">338           </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_releaseIntervalsSecs</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">339           </span><span class=\"mtk12\">uint112</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_linearVestAmounts</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">340           </span><span class=\"mtk12\">uint112</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_cliffAmounts</span><span class=\"mtk1\">) </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">341:          </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyAdmin</span><span class=\"mtk1\"> {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L333-L341\">VTVLVesting.sol#L333-L341</a><br></p>\n<h2 id=\"g04--state-variables-should-be-cached-in-stack-variables-rather-than-re-reading-them-from-storage\" style=\"position:relative;\"><a href=\"#g04--state-variables-should-be-cached-in-stack-variables-rather-than-re-reading-them-from-storage\" aria-label=\"g04  state variables should be cached in stack variables rather than re reading them from storage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑04]  State variables should be cached in stack variables rather than re-reading them from storage</h2>\n<p>The instances below point to the second+ access of a state variable within a function. Caching of a state variable replace each Gwarmaccess (<strong>100 gas</strong>) with a much cheaper stack read. Other less obvious fixes/optimizations include having local memory caches of state variable structs, or having local caches of state variable contracts/addresses.</p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"27\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">token</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VariableSupplyERC20Token</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit mintableSupply on line 40</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">41</span><span class=\"mtk1\">:               </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk12\">mintableSupply</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_AMOUNT&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/token/VariableSupplyERC20Token.sol#L41\">VariableSupplyERC20Token.sol#L41</a><br></p>\n<h2 id=\"g05--x--y-costs-more-gas-than-x--x--y-for-state-variables\" style=\"position:relative;\"><a href=\"#g05--x--y-costs-more-gas-than-x--x--y-for-state-variables\" aria-label=\"g05  x  y costs more gas than x  x  y for state variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑05]  <code>&#x3C;x> += &#x3C;y></code> costs more gas than <code>&#x3C;x> = &#x3C;x> + &#x3C;y></code> for state variables</h2>\n<p>Using the addition operator instead of plus-equals saves <strong><a href=\"https://gist.github.com/IllIllI000/cbbfb267425b898e5be734d4008d4fe8\">113 gas</a></strong>.</p>\n<p><em>There are 4 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"28\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">token</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VariableSupplyERC20Token</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">43</span><span class=\"mtk1\">:               </span><span class=\"mtk12\">mintableSupply</span><span class=\"mtk1\"> -= </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/token/VariableSupplyERC20Token.sol#L43\">VariableSupplyERC20Token.sol#L43</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"29\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">301</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">numTokensReservedForVesting</span><span class=\"mtk1\"> += </span><span class=\"mtk12\">allocatedAmount</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// track the allocated amount</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">383</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">numTokensReservedForVesting</span><span class=\"mtk1\"> -= </span><span class=\"mtk12\">amountRemaining</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">433</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">numTokensReservedForVesting</span><span class=\"mtk1\"> -= </span><span class=\"mtk12\">amountRemaining</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// Reduces the allocation</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L301\">VTVLVesting.sol#L301</a><br></p>\n<h2 id=\"g06--add-unchecked--for-subtractions-where-the-operands-cannot-underflow-because-of-a-previous-require-or-if-statement\" style=\"position:relative;\"><a href=\"#g06--add-unchecked--for-subtractions-where-the-operands-cannot-underflow-because-of-a-previous-require-or-if-statement\" aria-label=\"g06  add unchecked  for subtractions where the operands cannot underflow because of a previous require or if statement permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑06]  Add <code>unchecked {}</code> for subtractions where the operands cannot underflow because of a previous <code>require()</code> or <code>if</code>-statement</h2>\n<p><code>require(a &#x3C;= b); x = b - a</code> => <code>require(a &#x3C;= b); unchecked { x = b - a }</code></p>\n<p><em>There are 4 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"30\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit require() on line 262</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">264</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">((</span><span class=\"mtk12\">_endTimestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">_startTimestamp</span><span class=\"mtk1\">) % </span><span class=\"mtk12\">_releaseIntervalSecs</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_INTERVAL_LENGTH&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit require() on line 374</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">377</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">uint112</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amountRemaining</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">allowance</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">usrClaim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">amountWithdrawn</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit require() on line 426</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">429</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">uint112</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amountRemaining</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">finalVestAmt</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">amountWithdrawn</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit if-condition on line 166</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">167</span><span class=\"mtk1\">:                  </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">currentVestingDurationSecs</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">_referenceTs</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">startTimestamp</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// How long since the start</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L264\">VTVLVesting.sol#L264</a><br></p>\n<h2 id=\"g07--ii-should-be-uncheckediuncheckedi-when-it-is-not-possible-for-them-to-overflow-as-is-the-case-when-used-in-for--and-while-loops\" style=\"position:relative;\"><a href=\"#g07--ii-should-be-uncheckediuncheckedi-when-it-is-not-possible-for-them-to-overflow-as-is-the-case-when-used-in-for--and-while-loops\" aria-label=\"g07  ii should be uncheckediuncheckedi when it is not possible for them to overflow as is the case when used in for  and while loops permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑07]  <code>++i</code>/<code>i++</code> should be <code>unchecked{++i}</code>/<code>unchecked{i++}</code> when it is not possible for them to overflow, as is the case when used in <code>for</code>- and <code>while</code>-loops</h2>\n<p>The <code>unchecked</code> keyword is new in solidity version 0.8.0, so this only applies to that version or higher, which these instances are. This saves <strong>30-40 gas <a href=\"https://gist.github.com/hrkrshnn/ee8fabd532058307229d65dcd5836ddc#the-increment-in-for-loop-post-condition-can-be-made-unchecked\">per loop</a></strong>.</p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"31\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">353</span><span class=\"mtk1\">:          </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">0</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">length</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\">++) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L353\">VTVLVesting.sol#L353</a><br></p>\n<h2 id=\"g08--optimize-names-to-save-gas\" style=\"position:relative;\"><a href=\"#g08--optimize-names-to-save-gas\" aria-label=\"g08  optimize names to save gas permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑08]  Optimize names to save gas</h2>\n<p><code>public</code>/<code>external</code> function names and <code>public</code> member variable names can be optimized to save gas. See <a href=\"https://gist.github.com/IllIllI000/a5d8b486a8259f9f77891a919febd1a9\">this</a> link for an example of how it works. Below are the interfaces/abstract contracts that can be optimized so that the most frequently-called functions use the least amount of gas possible during method lookup. Method IDs that have two leading zero bytes can save <strong>128 gas</strong> each during deployment, and renaming functions to have lower method IDs will save <strong>22 gas</strong> per call, <a href=\"https://medium.com/joyso/solidity-how-does-function-name-affect-gas-consumption-in-smart-contract-47d270d8ac92\">per sorted position shifted</a>.</p>\n<p><em>There are 3 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"32\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AccessProtected</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit isAdmin(), setAdmin()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">11</span><span class=\"mtk1\">:   </span><span class=\"mtk12\">abstract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">AccessProtected</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Context</span><span class=\"mtk1\"> {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/AccessProtected.sol#L11\">AccessProtected.sol#L11</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"33\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">token</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VariableSupplyERC20Token</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit mint()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">10</span><span class=\"mtk1\">:   </span><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">VariableSupplyERC20Token</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ERC20</span><span class=\"mtk1\">, </span><span class=\"mtk12\">AccessProtected</span><span class=\"mtk1\"> {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/token/VariableSupplyERC20Token.sol#L10\">VariableSupplyERC20Token.sol#L10</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"34\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/// @audit getClaim(), vestedAmount(), finalVestedAmount(), claimableAmount(), allVestingRecipients(), numVestingRecipients(), createClaim(), createClaimsBatch(), withdraw(), withdrawAdmin(), revokeClaim(), withdrawOtherToken()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">11</span><span class=\"mtk1\">:   </span><span class=\"mtk12\">contract</span><span class=\"mtk1\"> </span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\"> </span><span class=\"mtk12\">is</span><span class=\"mtk1\"> </span><span class=\"mtk12\">Context</span><span class=\"mtk1\">, </span><span class=\"mtk12\">AccessProtected</span><span class=\"mtk1\"> {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L11\">VTVLVesting.sol#L11</a><br></p>\n<h2 id=\"g09--using-bools-for-storage-incurs-overhead\" style=\"position:relative;\"><a href=\"#g09--using-bools-for-storage-incurs-overhead\" aria-label=\"g09  using bools for storage incurs overhead permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑09]  Using <code>bool</code>s for storage incurs overhead</h2>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"35\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Booleans are more expensive than uint256 or any type that takes up a full</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// word because each write operation emits an extra SLOAD to first read the</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// slot&#39;s contents, replace the bits taken up by the boolean, and then write</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// back. This is the compiler&#39;s defense against contract upgrades and</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// pointer aliasing, and it cannot be disabled.</span></span></span></code></pre>\n<p><a href=\"https://github.com/OpenZeppelin/openzeppelin-contracts/blob/58f635312aa21f947cae5f8578638a85aa2519f5/contracts/security/ReentrancyGuard.sol#L23-L27\">OpenZeppelin/ReentrancyGuard.sol#L23-L27</a><br>\nUse <code>uint256(1)</code> and <code>uint256(2)</code> for true/false to avoid a Gwarmaccess (<strong><a href=\"https://gist.github.com/IllIllI000/1b70014db712f8572a72378321250058\">100 gas</a></strong>) for the extra SLOAD, and to avoid Gsset (<strong>20000 gas</strong>) when changing from <code>false</code> to <code>true</code>, after having been <code>true</code> in the past.</p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"36\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AccessProtected</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">12</span><span class=\"mtk1\">:       </span><span class=\"mtk11\">mapping</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">bool</span><span class=\"mtk1\">) </span><span class=\"mtk12\">private</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_admins</span><span class=\"mtk1\">; </span><span class=\"mtk3\">// user address =&gt; admin? mapping</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/AccessProtected.sol#L12\">AccessProtected.sol#L12</a><br></p>\n<h2 id=\"g10--i-costs-less-gas-than-i-especially-when-its-used-in-for-loops---ii---too\" style=\"position:relative;\"><a href=\"#g10--i-costs-less-gas-than-i-especially-when-its-used-in-for-loops---ii---too\" aria-label=\"g10  i costs less gas than i especially when its used in for loops   ii   too permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑10]  <code>++i</code> costs less gas than <code>i++</code>, especially when it’s used in <code>for</code>-loops (<code>--i</code>/<code>i--</code> too)</h2>\n<p>Saves <strong>5 gas per loop</strong>.</p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"37\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">353</span><span class=\"mtk1\">:          </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">0</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">length</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\">++) {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L353\">VTVLVesting.sol#L353</a><br></p>\n<h2 id=\"g11--splitting-require-statements-that-use--saves-gas\" style=\"position:relative;\"><a href=\"#g11--splitting-require-statements-that-use--saves-gas\" aria-label=\"g11  splitting require statements that use  saves gas permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑11]  Splitting <code>require()</code> statements that use <code>&#x26;&#x26;</code> saves gas</h2>\n<p>See <a href=\"https://github.com/code-423n4/2022-01-xdefi-findings/issues/128\">this issue</a> which describes the fact that there is a larger deployment gas cost, but with enough runtime calls, the change ends up being cheaper by <strong>3 gas</strong>.</p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"38\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">344</span><span class=\"mtk1\">           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_startTimestamps</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">length</span><span class=\"mtk1\"> &amp;&amp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">345</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">_endTimestamps</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">length</span><span class=\"mtk1\"> &amp;&amp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">346</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">_cliffReleaseTimestamps</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">length</span><span class=\"mtk1\"> &amp;&amp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">347</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">_releaseIntervalsSecs</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">length</span><span class=\"mtk1\"> &amp;&amp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">348</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">_linearVestAmounts</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">length</span><span class=\"mtk1\"> &amp;&amp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">349</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">_cliffAmounts</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">length</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">350</span><span class=\"mtk1\">                   </span><span class=\"mtk8\">&quot;ARRAY_LENGTH_MISMATCH&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">351</span><span class=\"mtk1\">:          );</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L344-L351\">VTVLVesting.sol#L344-L351</a><br></p>\n<h2 id=\"g12--dont-compare-boolean-expressions-to-boolean-literals\" style=\"position:relative;\"><a href=\"#g12--dont-compare-boolean-expressions-to-boolean-literals\" aria-label=\"g12  dont compare boolean expressions to boolean literals permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑12]  Don’t compare boolean expressions to boolean literals</h2>\n<p><code>if (&#x3C;x> == true)</code> => <code>if (&#x3C;x>)</code>, <code>if (&#x3C;x> == false)</code> => <code>if (!&#x3C;x>)</code></p>\n<p><em>There is 1 instance of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"39\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">111</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">isActive</span><span class=\"mtk1\"> == </span><span class=\"mtk4\">true</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;NO_ACTIVE_CLAIM&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L111\">VTVLVesting.sol#L111</a><br></p>\n<h2 id=\"g13--use-custom-errors-rather-than-revertrequire-strings-to-save-gas\" style=\"position:relative;\"><a href=\"#g13--use-custom-errors-rather-than-revertrequire-strings-to-save-gas\" aria-label=\"g13  use custom errors rather than revertrequire strings to save gas permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑13]  Use custom errors rather than <code>revert()</code>/<code>require()</code> strings to save gas</h2>\n<p>Custom errors are available from solidity version 0.8.4. Custom errors save <a href=\"https://gist.github.com/IllIllI000/ad1bd0d29a0101b25e57c293b4b0c746\"><strong>~50 gas</strong></a> each time they’re hit by <a href=\"https://blog.soliditylang.org/2021/04/21/custom-errors/#errors-in-depth\">avoiding having to allocate and store the revert string</a>. Not defining the strings also save deployment gas.</p>\n<p><em>There are 24 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"40\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AccessProtected</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">25</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_admins</span><span class=\"mtk1\">[</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">()], </span><span class=\"mtk8\">&quot;ADMIN_ACCESS_REQUIRED&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">40</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">admin</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">), </span><span class=\"mtk8\">&quot;INVALID_ADDRESS&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/AccessProtected.sol#L25\">AccessProtected.sol#L25</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"41\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">token</span><span class=\"mtk1\">/</span><span class=\"mtk12\">FullPremintERC20Token</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">11</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">supply_</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;NO_ZERO_MINT&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/token/FullPremintERC20Token.sol#L11\">FullPremintERC20Token.sol#L11</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"42\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">token</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VariableSupplyERC20Token</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">27</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">initialSupply_</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> || </span><span class=\"mtk12\">maxSupply_</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_AMOUNT&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">37</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">account</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">), </span><span class=\"mtk8\">&quot;INVALID_ADDRESS&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">41</span><span class=\"mtk1\">:               </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amount</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk12\">mintableSupply</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_AMOUNT&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/token/VariableSupplyERC20Token.sol#L27\">VariableSupplyERC20Token.sol#L27</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"43\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">82</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_tokenAddress</span><span class=\"mtk1\">) != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">), </span><span class=\"mtk8\">&quot;INVALID_ADDRESS&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">107</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">startTimestamp</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;NO_ACTIVE_CLAIM&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">111</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">isActive</span><span class=\"mtk1\"> == </span><span class=\"mtk4\">true</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;NO_ACTIVE_CLAIM&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">129</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">startTimestamp</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;CLAIM_ALREADY_EXISTS&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">255</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\"> != </span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk7\">0</span><span class=\"mtk1\">), </span><span class=\"mtk8\">&quot;INVALID_ADDRESS&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">256</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_linearVestAmount</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">_cliffAmount</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_VESTED_AMOUNT&quot;</span><span class=\"mtk1\">); </span><span class=\"mtk3\">// Actually only one of linearvested/cliff amount must be 0, not necessarily both</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">257</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_startTimestamp</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_START_TIMESTAMP&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">262</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_startTimestamp</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">_endTimestamp</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_END_TIMESTAMP&quot;</span><span class=\"mtk1\">); </span><span class=\"mtk3\">// _endTimestamp must be after _startTimestamp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">263</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_releaseIntervalSecs</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_RELEASE_INTERVAL&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">264</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">((</span><span class=\"mtk12\">_endTimestamp</span><span class=\"mtk1\"> - </span><span class=\"mtk12\">_startTimestamp</span><span class=\"mtk1\">) % </span><span class=\"mtk12\">_releaseIntervalSecs</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_INTERVAL_LENGTH&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">270</span><span class=\"mtk1\">           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">( </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">271</span><span class=\"mtk1\">               (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">272</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">_cliffReleaseTimestamp</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> &amp;&amp; </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">273</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">_cliffAmount</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> &amp;&amp; </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">274</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">_cliffReleaseTimestamp</span><span class=\"mtk1\"> &lt;= </span><span class=\"mtk12\">_startTimestamp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">275</span><span class=\"mtk1\">               ) || (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">276</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">_cliffReleaseTimestamp</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span><span class=\"mtk1\"> &amp;&amp; </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">277</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">_cliffAmount</span><span class=\"mtk1\"> == </span><span class=\"mtk7\">0</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">278</span><span class=\"mtk1\">:          ), </span><span class=\"mtk8\">&quot;INVALID_CLIFF&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">295</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">tokenAddress</span><span class=\"mtk1\">.</span><span class=\"mtk11\">balanceOf</span><span class=\"mtk1\">(</span><span class=\"mtk11\">address</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">)) &gt;= </span><span class=\"mtk12\">numTokensReservedForVesting</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">allocatedAmount</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INSUFFICIENT_BALANCE&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">344</span><span class=\"mtk1\">           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_startTimestamps</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">length</span><span class=\"mtk1\"> &amp;&amp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">345</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">_endTimestamps</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">length</span><span class=\"mtk1\"> &amp;&amp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">346</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">_cliffReleaseTimestamps</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">length</span><span class=\"mtk1\"> &amp;&amp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">347</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">_releaseIntervalsSecs</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">length</span><span class=\"mtk1\"> &amp;&amp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">348</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">_linearVestAmounts</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">length</span><span class=\"mtk1\"> &amp;&amp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">349</span><span class=\"mtk1\">                   </span><span class=\"mtk12\">_cliffAmounts</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> == </span><span class=\"mtk12\">length</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">350</span><span class=\"mtk1\">                   </span><span class=\"mtk8\">&quot;ARRAY_LENGTH_MISMATCH&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">351</span><span class=\"mtk1\">:          );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">374</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">allowance</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk12\">usrClaim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">amountWithdrawn</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;NOTHING_TO_WITHDRAW&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">402</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">amountRemaining</span><span class=\"mtk1\"> &gt;= </span><span class=\"mtk12\">_amountRequested</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INSUFFICIENT_BALANCE&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">426</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">( </span><span class=\"mtk12\">_claim</span><span class=\"mtk1\">.</span><span class=\"mtk12\">amountWithdrawn</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk12\">finalVestAmt</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;NO_UNVESTED_AMOUNT&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">447</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_otherTokenAddress</span><span class=\"mtk1\"> != </span><span class=\"mtk12\">tokenAddress</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INVALID_TOKEN&quot;</span><span class=\"mtk1\">); </span><span class=\"mtk3\">// tokenAddress address is already sure to be nonzero due to constructor</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">449</span><span class=\"mtk1\">:          </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bal</span><span class=\"mtk1\"> &gt; </span><span class=\"mtk7\">0</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&quot;INSUFFICIENT_BALANCE&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L82\">VTVLVesting.sol#L82</a><br></p>\n<h2 id=\"g14--functions-guaranteed-to-revert-when-called-by-normal-users-can-be-marked-payable\" style=\"position:relative;\"><a href=\"#g14--functions-guaranteed-to-revert-when-called-by-normal-users-can-be-marked-payable\" aria-label=\"g14  functions guaranteed to revert when called by normal users can be marked payable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑14]  Functions guaranteed to revert when called by normal users can be marked <code>payable</code></h2>\n<p>If a function modifier such as <code>onlyOwner</code> is used, the function will revert if a normal user tries to pay the function. Marking the function as <code>payable</code> will lower the gas cost for legitimate callers because the compiler will not include checks for whether a payment was provided. The extra opcodes avoided are <code>CALLVALUE</code>(2),<code>DUP1</code>(3),<code>ISZERO</code>(3),<code>PUSH2</code>(3),<code>JUMPI</code>(10),<code>PUSH1</code>(3),<code>DUP1</code>(3),<code>REVERT</code>(0),<code>JUMPDEST</code>(1),<code>POP</code>(2), which costs an average of about <strong>21 gas per call</strong> to the function, in addition to the extra deployment cost.</p>\n<p><em>There are 7 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"44\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AccessProtected</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">39</span><span class=\"mtk1\">:       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">setAdmin</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">admin</span><span class=\"mtk1\">, </span><span class=\"mtk12\">bool</span><span class=\"mtk1\"> </span><span class=\"mtk12\">isEnabled</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyAdmin</span><span class=\"mtk1\"> {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/AccessProtected.sol#L39\">AccessProtected.sol#L39</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"45\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">token</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VariableSupplyERC20Token</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">36</span><span class=\"mtk1\">:       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">mint</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">account</span><span class=\"mtk1\">, </span><span class=\"mtk12\">uint256</span><span class=\"mtk1\"> </span><span class=\"mtk12\">amount</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyAdmin</span><span class=\"mtk1\"> {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/token/VariableSupplyERC20Token.sol#L36\">VariableSupplyERC20Token.sol#L36</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"46\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">317</span><span class=\"mtk1\">       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">createClaim</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">318               </span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">319               </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_startTimestamp</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">320               </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_endTimestamp</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">321               </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_cliffReleaseTimestamp</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">322               </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_releaseIntervalSecs</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">323               </span><span class=\"mtk12\">uint112</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_linearVestAmount</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">324               </span><span class=\"mtk12\">uint112</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_cliffAmount</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">325:                  ) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyAdmin</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">333</span><span class=\"mtk1\">       </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">createClaimsBatch</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">334           </span><span class=\"mtk12\">address</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_recipients</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">335           </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_startTimestamps</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">336           </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_endTimestamps</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">337           </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_cliffReleaseTimestamps</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">338           </span><span class=\"mtk12\">uint40</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_releaseIntervalsSecs</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">339           </span><span class=\"mtk12\">uint112</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_linearVestAmounts</span><span class=\"mtk1\">, </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">340           </span><span class=\"mtk12\">uint112</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">memory</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_cliffAmounts</span><span class=\"mtk1\">) </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">341:          </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyAdmin</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">398</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">withdrawAdmin</span><span class=\"mtk1\">(</span><span class=\"mtk12\">uint112</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_amountRequested</span><span class=\"mtk1\">) </span><span class=\"mtk11\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyAdmin</span><span class=\"mtk1\"> {    </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">418</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">revokeClaim</span><span class=\"mtk1\">(</span><span class=\"mtk12\">address</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyAdmin</span><span class=\"mtk1\"> </span><span class=\"mtk11\">hasActiveClaim</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_recipient</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">446</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">withdrawOtherToken</span><span class=\"mtk1\">(</span><span class=\"mtk12\">IERC20</span><span class=\"mtk1\"> </span><span class=\"mtk12\">_otherTokenAddress</span><span class=\"mtk1\">) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> </span><span class=\"mtk11\">onlyAdmin</span><span class=\"mtk1\"> {</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L317-L325\">VTVLVesting.sol#L317-L325</a><br></p>\n<h2 id=\"g15--dont-use-_msgsender-if-not-supporting-eip-2771\" style=\"position:relative;\"><a href=\"#g15--dont-use-_msgsender-if-not-supporting-eip-2771\" aria-label=\"g15  dont use _msgsender if not supporting eip 2771 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[G‑15]  Don’t use <code>_msgSender()</code> if not supporting EIP-2771</h2>\n<p>Use <code>msg.sender</code> if the code does not implement <a href=\"https://eips.ethereum.org/EIPS/eip-2771\">EIP-2771 trusted forwarder</a> support.</p>\n<p><em>There are 13 instances of this issue:</em></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"47\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">AccessProtected</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">17</span><span class=\"mtk1\">:           </span><span class=\"mtk12\">_admins</span><span class=\"mtk1\">[</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">()] = </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">18</span><span class=\"mtk1\">:           </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">AdminAccessSet</span><span class=\"mtk1\">(</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">(), </span><span class=\"mtk4\">true</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">25</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">require</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_admins</span><span class=\"mtk1\">[</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">()], </span><span class=\"mtk8\">&quot;ADMIN_ACCESS_REQUIRED&quot;</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/AccessProtected.sol#L17\">AccessProtected.sol#L17</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"48\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">token</span><span class=\"mtk1\">/</span><span class=\"mtk12\">FullPremintERC20Token</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">12</span><span class=\"mtk1\">:           </span><span class=\"mtk11\">_mint</span><span class=\"mtk1\">(</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">(), </span><span class=\"mtk12\">supply_</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/token/FullPremintERC20Token.sol#L12\">FullPremintERC20Token.sol#L12</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"49\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">token</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VariableSupplyERC20Token</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">32</span><span class=\"mtk1\">:               </span><span class=\"mtk11\">mint</span><span class=\"mtk1\">(</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">(), </span><span class=\"mtk12\">initialSupply_</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/token/VariableSupplyERC20Token.sol#L32\">VariableSupplyERC20Token.sol#L32</a><br></p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"50\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">File: </span><span class=\"mtk12\">contracts</span><span class=\"mtk1\">/</span><span class=\"mtk12\">VTVLVesting</span><span class=\"mtk1\">.</span><span class=\"mtk12\">sol</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">367</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">Claim</span><span class=\"mtk1\"> </span><span class=\"mtk12\">storage</span><span class=\"mtk1\"> </span><span class=\"mtk12\">usrClaim</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">claims</span><span class=\"mtk1\">[</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">()];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">371</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">uint112</span><span class=\"mtk1\"> </span><span class=\"mtk12\">allowance</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">vestedAmount</span><span class=\"mtk1\">(</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">(), </span><span class=\"mtk11\">uint40</span><span class=\"mtk1\">(</span><span class=\"mtk12\">block</span><span class=\"mtk1\">.</span><span class=\"mtk12\">timestamp</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">388</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">tokenAddress</span><span class=\"mtk1\">.</span><span class=\"mtk11\">safeTransfer</span><span class=\"mtk1\">(</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">(), </span><span class=\"mtk12\">amountRemaining</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">391</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Claimed</span><span class=\"mtk1\">(</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">(), </span><span class=\"mtk12\">amountRemaining</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">364</span><span class=\"mtk1\">:      </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">withdraw</span><span class=\"mtk1\">() </span><span class=\"mtk11\">hasActiveClaim</span><span class=\"mtk1\">(</span><span class=\"mtk12\">_msgSender</span><span class=\"mtk1\">()) </span><span class=\"mtk11\">external</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">407</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">tokenAddress</span><span class=\"mtk1\">.</span><span class=\"mtk11\">safeTransfer</span><span class=\"mtk1\">(</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">(), </span><span class=\"mtk12\">_amountRequested</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">410</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">emit</span><span class=\"mtk1\"> </span><span class=\"mtk11\">AdminWithdrawn</span><span class=\"mtk1\">(</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">(), </span><span class=\"mtk12\">_amountRequested</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">450</span><span class=\"mtk1\">:          </span><span class=\"mtk12\">_otherTokenAddress</span><span class=\"mtk1\">.</span><span class=\"mtk11\">safeTransfer</span><span class=\"mtk1\">(</span><span class=\"mtk11\">_msgSender</span><span class=\"mtk1\">(), </span><span class=\"mtk12\">bal</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p><a href=\"https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L367\">VTVLVesting.sol#L367</a><br></p>\n<hr>\n<h1 id=\"disclosures\" style=\"position:relative;\"><a href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Disclosures</h1>\n<p>C4 is an open organization governed by participants in the community.</p>\n<p>C4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.</p>\n<p>C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk10 { color: #4EC9B0; }\n  .dark-default-dark .mtk14 { color: #F44747; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>",
  "toc": "<ul>\n<li>\n<p><a href=\"#overview\">Overview</a></p>\n<ul>\n<li><a href=\"#about-c4\">About C4</a></li>\n<li><a href=\"#wardens\">Wardens</a></li>\n</ul>\n</li>\n<li><a href=\"#summary\">Summary</a></li>\n<li><a href=\"#scope\">Scope</a></li>\n<li><a href=\"#severity-criteria\">Severity Criteria</a></li>\n<li>\n<p><a href=\"#high-risk-findings-2\">High Risk Findings (2)</a></p>\n<ul>\n<li><a href=\"#h-01-loss-of-vested-amounts\">[H-01] Loss of vested amounts</a></li>\n<li><a href=\"#h-02-permanent-freeze-of-vested-tokens-due-to-overflow-in-_basevestedamount\">[H-02] Permanent freeze of vested tokens due to overflow in <code>_baseVestedAmount</code></a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#medium-risk-findings-10\">Medium Risk Findings (10)</a></p>\n<ul>\n<li><a href=\"#m-01-supply-cap-of-variablesupplyerc20token-is-not-properly-enforced\">[M-01] Supply cap of <code>VariableSupplyERC20Token</code> is not properly enforced</a></li>\n<li><a href=\"#m-02-_basevestedamount-and-vestedamount-return-incorrect-historical-values\">[M-02] <code>_baseVestedAmount()</code> and <code>vestedAmount()</code> Return Incorrect Historical Values</a></li>\n<li><a href=\"#m-03-possible-dos-on-vestingrecipients-due-to-lack-of-disposal-mechanism\">[M-03] Possible DoS on <code>vestingRecipients</code> due to lack of disposal mechanism</a></li>\n<li><a href=\"#m-04-not-able-to-create-claim\">[M-04] not able to create claim</a></li>\n<li><a href=\"#m-05-tokens-with-lower-number-of-decimals-can-result-in-postponed-linear-vesting-for-user\">[M-05] Tokens with lower number of decimals can result in postponed linear vesting for user</a></li>\n<li><a href=\"#m-06-variable-balance-token-causing-fund-lock-and-loss\">[M-06] Variable balance token causing fund lock and loss</a></li>\n<li><a href=\"#m-07-vesting-schedule-start-and-end-time-can-be-set-in-the-past-\">[M-07] Vesting Schedule Start and End Time can be Set in the Past </a></li>\n<li><a href=\"#m-08-two-address-tokens-can-be-withdrawn-by-the-admin-even-if-they-are-vested\">[M-08] Two address tokens can be withdrawn by the admin even if they are vested</a></li>\n<li><a href=\"#m-09-_releaseintervalsecs-is-not-validated\">[M-09] <code>_releaseIntervalSecs</code> is not validated</a></li>\n<li><a href=\"#m-10-reentrancy-may-allow-an-admin-to-steal-funds\">[M-10] Reentrancy may allow an admin to steal funds</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#low-risk-and-non-critical-issues\">Low Risk and Non-Critical Issues</a></p>\n<ul>\n<li><a href=\"#01\">01</a></li>\n<li><a href=\"#02\">02</a></li>\n<li><a href=\"#03\">03</a></li>\n<li><a href=\"#04\">04</a></li>\n<li><a href=\"#05\">05</a></li>\n<li><a href=\"#06\">06</a></li>\n<li><a href=\"#07\">07</a></li>\n<li><a href=\"#08\">08</a></li>\n<li><a href=\"#09\">09</a></li>\n<li><a href=\"#10\">10</a></li>\n<li><a href=\"#11\">11</a></li>\n<li><a href=\"#12\">12</a></li>\n<li><a href=\"#13\">13</a></li>\n<li><a href=\"#14\">14</a></li>\n<li><a href=\"#15\">15</a></li>\n<li><a href=\"#16\">16</a></li>\n<li><a href=\"#17\">17</a></li>\n<li><a href=\"#18\">18</a></li>\n<li><a href=\"#19\">19</a></li>\n<li><a href=\"#20\">20</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#gas-optimizations\">Gas Optimizations</a></p>\n<ul>\n<li><a href=\"#summary-1\">Summary</a></li>\n<li><a href=\"#g01--save-gas-by-not-requring-non-zero-interval-if-no-linear-amount\">G‑01  Save gas by not requring non-zero interval if no linear amount</a></li>\n<li><a href=\"#g02--results-of-calls-to-_msgsender-not-cached\">G‑02  Results of calls to <code>_msgSender()</code> not cached</a></li>\n<li><a href=\"#g03--using-calldata-instead-of-memory-for-read-only-arguments-in-external-functions-saves-gas\">G‑03  Using <code>calldata</code> instead of <code>memory</code> for read-only arguments in <code>external</code> functions saves gas</a></li>\n<li><a href=\"#g04--state-variables-should-be-cached-in-stack-variables-rather-than-re-reading-them-from-storage\">G‑04  State variables should be cached in stack variables rather than re-reading them from storage</a></li>\n<li><a href=\"#g05--x--y-costs-more-gas-than-x--x--y-for-state-variables\">G‑05  <code>&#x3C;x> += &#x3C;y></code> costs more gas than <code>&#x3C;x> = &#x3C;x> + &#x3C;y></code> for state variables</a></li>\n<li><a href=\"#g06--add-unchecked--for-subtractions-where-the-operands-cannot-underflow-because-of-a-previous-require-or-if-statement\">G‑06  Add <code>unchecked {}</code> for subtractions where the operands cannot underflow because of a previous <code>require()</code> or <code>if</code>-statement</a></li>\n<li><a href=\"#g07--ii-should-be-uncheckediuncheckedi-when-it-is-not-possible-for-them-to-overflow-as-is-the-case-when-used-in-for--and-while-loops\">G‑07  <code>++i</code>/<code>i++</code> should be <code>unchecked{++i}</code>/<code>unchecked{i++}</code> when it is not possible for them to overflow, as is the case when used in <code>for</code>- and <code>while</code>-loops</a></li>\n<li><a href=\"#g08--optimize-names-to-save-gas\">G‑08  Optimize names to save gas</a></li>\n<li><a href=\"#g09--using-bools-for-storage-incurs-overhead\">G‑09  Using <code>bool</code>s for storage incurs overhead</a></li>\n<li><a href=\"#g10--i-costs-less-gas-than-i-especially-when-its-used-in-for-loops---ii---too\">G‑10  <code>++i</code> costs less gas than <code>i++</code>, especially when it’s used in <code>for</code>-loops (<code>--i</code>/<code>i--</code> too)</a></li>\n<li><a href=\"#g11--splitting-require-statements-that-use--saves-gas\">G‑11  Splitting <code>require()</code> statements that use <code>&#x26;&#x26;</code> saves gas</a></li>\n<li><a href=\"#g12--dont-compare-boolean-expressions-to-boolean-literals\">G‑12  Don’t compare boolean expressions to boolean literals</a></li>\n<li><a href=\"#g13--use-custom-errors-rather-than-revertrequire-strings-to-save-gas\">G‑13  Use custom errors rather than <code>revert()</code>/<code>require()</code> strings to save gas</a></li>\n<li><a href=\"#g14--functions-guaranteed-to-revert-when-called-by-normal-users-can-be-marked-payable\">G‑14  Functions guaranteed to revert when called by normal users can be marked <code>payable</code></a></li>\n<li><a href=\"#g15--dont-use-_msgsender-if-not-supporting-eip-2771\">G‑15  Don’t use <code>_msgSender()</code> if not supporting EIP-2771</a></li>\n</ul>\n</li>\n<li><a href=\"#disclosures\">Disclosures</a></li>\n</ul>",
  "md": "\n# Overview\n\n## About C4\n\nCode4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.\n\nA C4 audit contest is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.\n\nDuring the audit contest outlined in this document, C4 conducted an analysis of the VTVL smart contract system written in Solidity. The audit contest took place between September 20—September 23 2022.\n\n## Wardens\n\n208 Wardens contributed reports to the VTVL contest:\n\n  1. pashov\n  1. sorrynotsorry\n  1. [Respx](https://twitter.com/RespxR)\n  1. [fatherOfBlocks](https://twitter.com/father0fBl0cks)\n  1. m9800\n  1. wagmi\n  1. CertoraInc (egjlmn1, [OriDabush](https://twitter.com/ori_dabush), ItayG, shakedwinder, and RoiEvenHaim)\n  1. [csanuragjain](https://twitter.com/csanuragjain)\n  1. [TomJ](https://mobile.twitter.com/tomj_bb)\n  1. [hansfriese](https://twitter.com/hansfriese)\n  1. ayeslick\n  1. Lambda\n  1. rbserver\n  1. KIntern\\_NA (TrungOre and duc)\n  1. neko\\_nyaa\n  1. [rokinot](twitter.com/rokinot)\n  1. 0xSky\n  1. neumo\n  1. [bin2chen](https://twitter.com/bin2chen)\n  1. [Trust](https://twitter.com/trust__90)\n  1. [wastewa](https://twitter.com/WahWaste)\n  1. datapunk\n  1. 0xhunter\n  1. dipp\n  1. [wuwe1](https://twitter.com/wuwe19)\n  1. IllIllI\n  1. [Ruhum](https://twitter.com/0xruhum)\n  1. [obront](https://twitter.com/zachobront)\n  1. RustyRabbit\n  1. [0xSmartContract](https://twitter.com/0xSmartContract)\n  1. 0xA5DF\n  1. [pedroais](https://twitter.com/Pedroais2/)\n  1. [pcarranzav](https://twitter.com/pcarranzav)\n  1. [ElKu](https://twitter.com/ElKu_crypto)\n  1. [Czar102](https://twitter.com/_Czar102)\n  1. sashik\\_eth\n  1. [pauliax](https://twitter.com/SolidityDev)\n  1. 0x52\n  1. [0xdapper](https://twitter.com/0xdapper_)\n  1. eierina\n  1. AkshaySrivastav\n  1. JohnSmith\n  1. \\_\\_141345\\_\\_\n  1. djxploit\n  1. [0xDecorativePineapple](https://decorativepineapple.github.io/)\n  1. zzzitron\n  1. [hyh](https://twitter.com/0xhyh)\n  1. [MiloTruck](https://milotruck.github.io/)\n  1. rotcivegaf\n  1. JLevick\n  1. [Aymen0909](https://github.com/Aymen1001)\n  1. [supernova](https://twitter.com/harshit16024263)\n  1. 0x4non\n  1. [Chom](https://chom.dev)\n  1. ak1\n  1. [0xNazgul](https://twitter.com/0xNazgul)\n  1. 0x1f8b\n  1. [rajatbeladiya](https://twitter.com/rajat_beladiya)\n  1. [joestakey](https://twitter.com/JoeStakey)\n  1. [berndartmueller](https://twitter.com/berndartmueller)\n  1. [c3phas](https://twitter.com/c3ph_)\n  1. lukris02\n  1. [pfapostol](https://t.me/pfahard)\n  1. ajtra\n  1. imare\n  1. cryptostellar5\n  1. [Deivitto](https://twitter.com/Deivitto)\n  1. [gogo](https://www.linkedin.com/in/georgi-nikolaev-georgiev-978253219)\n  1. Bnke0x0\n  1. [oyc\\_109](https://twitter.com/andyfeili)\n  1. [JC](https://twitter.com/sm4rtcontr4ct)\n  1. [durianSausage](https://github.com/lyciumlee)\n  1. Diana\n  1. brgltd\n  1. ladboy233\n  1. [Tomo](https://tom-sol.notion.site/Who-am-I-3b4dc28e77b647eb90794735a94dd38e)\n  1. Rolezn\n  1. [seyni](https://twitter.com/seynixyz)\n  1. 0xbepresent\n  1. peanuts\n  1. OptimismSec ([sseefried](http://seanseefried.org/blog) and [tofunmi](https://twitter.com/dediranTofunmi))\n  1. d3e4\n  1. RockingMiles (robee and pants)\n  1. Waze\n  1. tnevler\n  1. [Funen](https://instagram.com/vanensurya)\n  1. [a12jmx](https://twitter.com/a12jmx)\n  1. [prasantgupta52](https://twitter.com/prasantgupta52)\n  1. [Sm4rty](https://twitter.com/Sm4rty_)\n  1. [martin](https://github.com/martin-petrov03)\n  1. delfin454000\n  1. leosathya\n  1. RaymondFam\n  1. [Rohan16](https://twitter.com/ROHANJH56009256)\n  1. erictee\n  1. millersplanet\n  1. aysha\n  1. ChristianKuri\n  1. V\\_B (Barichek and vlad\\_bochok)\n  1. CodingNameKiki\n  1. karanctf\n  1. [ret2basic](https://twitter.com/ret2basic)\n  1. [medikko](https://twitter.com/mehmeddukov)\n  1. slowmoses\n  1. ReyAdmirado\n  1. B2\n  1. peiw\n  1. 0x040\n  1. carrotsmuggler\n  1. ikbkln\n  1. async\n  1. sach1r0\n  1. rvierdiiev\n  1. eighty\n  1. [ignacio](https://twitter.com/0xheynacho)\n  1. bobirichman\n  1. got\\_targ\n  1. nalus\n  1. cryptphi\n  1. SooYa\n  1. tibthecat\n  1. [natzuu](https://twitter.com/natzuu33)\n  1. [indijanc](https://twitter.com/krenkmet)\n  1. 2997ms\n  1. [exd0tpy](https://github.com/exd0tpy)\n  1. MasterCookie\n  1. StevenL\n  1. bulej93\n  1. Diraco\n  1. [0v3rf10w](https://twitter.com/_0v3rf10w)\n  1. 0x85102\n  1. Yiko\n  1. Bahurum\n  1. chatch\n  1. 0xmatt\n  1. cccz\n  1. [innertia](https://twitter.com/innertia_jp)\n  1. reassor\n  1. zzykxx\n  1. 0x5rings\n  1. ubermensch\n  1. 0xf15ers (remora and twojoy)\n  1. [Dravee](https://twitter.com/BowTiedDravee)\n  1. JohnnyTime\n  1. Aeros\n  1. yongskiws\n  1. romand\n  1. dic0de\n  1. peritoflores\n  1. sikorico\n  1. Margaret\n  1. pedr02b2\n  1. [ch13fd357r0y3r](https://twitter.com/ch13fd357r0y3r)\n  1. Junnon\n  1. Atarpara\n  1. jag\n  1. DimitarDimitrov\n  1. [adriro](https://github.com/romeroadrian)\n  1. [zishansami](https://zishansami102.github.io/)\n  1. ch0bu\n  1. SnowMan\n  1. Saintcode\\_\n  1. 0xsam\n  1. gianganhnguyen\n  1. [WilliamAmbrozic](https://twitter.com/WilliamAmbrozic)\n  1. [Tomio](https://twitter.com/meidhiwirara)\n  1. samruna\n  1. yaemsobak\n  1. emrekocak\n  1. [Tadashi](https://github.com/htadashi)\n  1. tgolding55\n  1. [Ocean\\_Sky](https://twitter.com/bluenights004)\n  1. caventa\n  1. beardofginger\n  1. [dharma09](https://twitter.com/im_Dharma09)\n  1. malinariy\n  1. lucacez\n  1. subtle77\n  1. [0xDanielC](https://twitter.com/DanielCawleyDev)\n  1. mics\n  1. w0Lfrum\n  1. hxzy\n  1. Amithuddar\n  1. Tagir2003\n  1. 0xc0ffEE\n  1. [Satyam\\_Sharma](https://twitter/@Satyam33sharma)\n  1. Noah3o6\n  1. jpserrat\n  1. Matin\n  1. Sta1400\n  1. [mrpathfindr](https://veranos.io)\n  1. francoHacker\n  1. cRat1st0s\n  1. cryptonue\n  1. [Franfran](https://franfran.dev/)\n  1. GimelSec ([rayn](https://twitter.com/rayn731) and sces60107)\n  1. JGcarv\n  1. Soosh\n\nThis contest was judged by [0xean](https://github.com/0xean).\n\nFinal report assembled by [liveactionllama](https://twitter.com/liveactionllama).\n\n# Summary\n\nThe C4 analysis yielded an aggregated total of 12 unique vulnerabilities. Of these vulnerabilities, 2 received a risk rating in the category of HIGH severity and 10 received a risk rating in the category of MEDIUM severity.\n\nAdditionally, C4 analysis included 135 reports detailing issues with a risk rating of LOW severity or non-critical. There were also 141 reports recommending gas optimizations.\n\nAll of the issues presented here are linked back to their original finding.\n\n# Scope\n\nThe code under review can be found within the [C4 VTVL contest repository](https://github.com/code-423n4/2022-09-vtvl), and is composed of 4 smart contracts written in the Solidity programming language and includes 239 lines of Solidity code.\n\n# Severity Criteria\n\nC4 assesses the severity of disclosed vulnerabilities according to a methodology based on [OWASP standards](https://owasp.org/www-community/OWASP_Risk_Rating_Methodology).\n\nVulnerabilities are divided into three primary risk categories: high, medium, and low/non-critical.\n\nHigh-level considerations for vulnerabilities span the following key areas when conducting assessments:\n\n- Malicious Input Handling\n- Escalation of privileges\n- Arithmetic\n- Gas use\n\nFurther information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on [the C4 website](https://code4rena.com).\n\n# High Risk Findings (2)\n## [[H-01] Loss of vested amounts](https://github.com/code-423n4/2022-09-vtvl-findings/issues/475)\n_Submitted by eierina, also found by 0x52, 0xA5DF, 0xdapper, ElKu, obront, pauliax, pcarranzav, pedroais, rbserver, Ruhum, RustyRabbit, and TomJ_\n\n[VTVLVesting.sol#L418](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L418)<br>\n[VTVLVesting.sol#L147-L151](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L147-L151)<br>\n[VTVLVesting.sol#L364](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L364)<br>\n\nVesting is a legal term that means the point in time where property is earned or gained by some person.<br>\nThe VTVLVesting contract defines:\n\n*   a start time (`Claim::startTimestamp`) and an end time (`Claim::endTimestamp`) at which vesting starts and ends for a entitled user\n*   the calculated points in time when the fractions of the total amount are released and therefore can be withdrawn (which are defined by `Claim::releaseIntervalSecs`).\n\nThe entitled user can either withdraw after each interval elapses, or after the whole vesting period is over or any variant of the two options.\n\nThe administrator of the contract can revoke the claim for a user at any time, which for vesting assets is expected. For example an employee with a vesting stock allocation of 1000 shares vesting at each quarter over a period of 4 years, may resign after 2 years and therefore the only half of the shares would be vested and therefore sold by the employee. The employee can either sell them at each quarter, or before, or after resigning, in any case the half of the shares have vested and are by legal right owned by the employee.\n\nThe VTVLContract revoke has the following defects:\n\n*   it ignores the amount already vested and now yet withdrawn\n*   if called, say half-way the total period, just after claimer withdraws the already vested amount, it revokes only the right to vest the remaining part in future.\n*   if called, say half-way the total period, right before the claimer withdraws the already vested amount, it revokes both the already vested amount and the right to vest the remaining part in future.\n\nRaising as high impact because it actually causes:\n\n*   loss of already vested amounts of a user with a valid claim that has already righteously vested a part but not withdrawn\n*   different outcomes depending on the order in which withdraw and revokeClaim functions are called which means that one of the two behavoiurs is certainly in conflict with the other causing a loss on one of the two sides, contract or claimer (by definition of Vesting rights, the claimer).\n*   lack of trust by the potential claimers/users whch can be at any time deprived of righteously vested amounts.\n\n### Proof of Concept\n\nThe following two tests prove the behaviour difference when the order by which revokeClaim vs withdraw are called, whch shows that the vesting right is not guaranteed.\n\n```solidity\n  // NOTE: USES ORIGINAL REVOKE BEHAVIOUR\n  it('sample revoke use case USER LOSE: employee withdraw immediately after resignation', async () => {\n    const {tokenContract, vestingContract} = await createPrefundedVestingContract({tokenName, tokenSymbol, initialSupplyTokens});\n\n    const startTimestamp = await getLastBlockTs() + 100;\n    const endTimestamp = startTimestamp + 2000;\n    const terminationTimestamp = startTimestamp + 1000 + 50; // half-way vesting, plus half release interval which shall be discarded\n    const releaseIntervalSecs = 100;\n\n    await vestingContract.createClaim(owner2.address, startTimestamp, endTimestamp, cliffReleaseTimestamp, releaseIntervalSecs, linearVestAmount, cliffAmount);\n\n    // move clock to termination timestamp (half-way the vesting period plus a bit, but less than release interval seconds)\n    await ethers.provider.send(\"evm_mine\", [terminationTimestamp]);\n    \n    let availableAmt = await vestingContract.claimableAmount(owner2.address)\n    // revoke the claim preserving the \"already vested but not yet withdrawn amount\"\n    await (await vestingContract.revokeClaim(owner2.address)).wait();\n    \n    let userBalanceBefore = await tokenContract.balanceOf(owner2.address);\n    await expect(vestingContract.connect(owner2).withdraw()).to.be.revertedWith('NO_ACTIVE_CLAIM');\n    let userBalanceAfter = await tokenContract.balanceOf(owner2.address);\n\n    // move the clock to the programmed end of vesting period\n    await ethers.provider.send(\"evm_mine\", [endTimestamp]);\n\n    // cliffTimestamp < startTimestamp < terminationTimestamp, hence expected cliffAmount + (1/2 * anlinearVestAmount)\n    let expectedVestedAmount = cliffAmount.add(linearVestAmount.div(2));\n\n    // RESIGNING EMPLOYEE LOSES HIS VESTED AMOUNT BECAUSE OF WITHDRAWING IMMEDIATELY AFTER RESIGNATION\n    expect(userBalanceAfter.sub(userBalanceBefore)).to.be.equal(0);\n    // VTVLVesting CONTRACT TOOK ALREADY VESTED AMOUNT FROM OWNER2\n    expect(await vestingContract.finalClaimableAmount(owner2.address)).to.be.equal(0);\n  });\n\n  // NOTE: USES ORIGINAL REVOKE BEHAVIOUR\n  it('sample revoke use case USER WIN: employee withdraw immediately before resignation', async () => {\n    const {tokenContract, vestingContract} = await createPrefundedVestingContract({tokenName, tokenSymbol, initialSupplyTokens});\n\n    const startTimestamp = await getLastBlockTs() + 100;\n    const endTimestamp = startTimestamp + 2000;\n    const terminationTimestamp = startTimestamp + 1000 + 50; // half-way vesting, plus half release interval which shall be discarded\n    const releaseIntervalSecs = 100;\n\n    await vestingContract.createClaim(owner2.address, startTimestamp, endTimestamp, cliffReleaseTimestamp, releaseIntervalSecs, linearVestAmount, cliffAmount);\n\n    // move clock to termination timestamp (half-way the vesting period plus a bit, but less than release interval seconds)\n    await ethers.provider.send(\"evm_mine\", [terminationTimestamp]);\n\n    let userBalanceBefore = await tokenContract.balanceOf(owner2.address);\n    await (await vestingContract.connect(owner2).withdraw()).wait();\n    let userBalanceAfter = await tokenContract.balanceOf(owner2.address);\n\n    // revoke the claim preserving the \"already vested but not yet withdrawn amount\"\n    await (await vestingContract.revokeClaim(owner2.address)).wait();\n    \n    // move the clock to the programmed end of vesting period\n    await ethers.provider.send(\"evm_mine\", [endTimestamp]);\n\n    console.log(userBalanceAfter.sub(userBalanceBefore));\n    // RESIGNING EMPLOYEE RECEIVES HIS VESTED AMOUNT BY WITHDRAWING IMMEDIATELY BEFORE RESIGNATION\n    expect(userBalanceAfter.sub(userBalanceBefore)).to.be.greaterThan(0);\n    expect(await vestingContract.finalClaimableAmount(owner2.address)).to.be.equal(0);\n  });\n```\n\n### Recommended Mitigation Steps\n\nBelow are, in order, a test and a diff/patch for a proposed fix. The proposed fix is just an idea at how to fix, or in other words, a way to preserve the already vested amount when claim is revoked.\n\nThe diff/patch add a deactivationTimestamp to claim, and a new revokeClaimProper that shall replace the revokeClaim function to correct the behaviour.\nThe deactivationTimestamp is used to track the deactivation time for the claim in order to preserve the amount vested so far and allow the user to withdraw the amount righteously earned so far. The _baseVestedAmount and hasActiveClaim have been updated to do proper math when isActive is false but deactivationTimestamp is greater than 0.\n\nThe finalVestedAmount has been update to show the \"what would be\" amount if the vesting would have reached the claim endTimestamp while the finalClaimableAmount takes into consideration the deactivationTimestamp if the claim has been revoked.\n\nThe test shows that the already vested amount (cliff + half way linear vesting) is preserved.\n\n```solidity\ndiff --git a/contracts/VTVLVesting.sol b/contracts/VTVLVesting.sol\nindex 133f19f..7ab955c 100644\n--- a/contracts/VTVLVesting.sol\n+++ b/contracts/VTVLVesting.sol\n@@ -34,6 +34,7 @@ contract VTVLVesting is Context, AccessProtected {\n         // Gives us a range from 1 Jan 1970 (Unix epoch) up to approximately 35 thousand years from then (2^40 / (365 * 24 * 60 * 60) ~= 35k)\n         uint40 startTimestamp; // When does the vesting start (40 bits is enough for TS)\n         uint40 endTimestamp; // When does the vesting end - the vesting goes linearly between the start and end timestamps\n+        uint40 deactivationTimestamp;\n         uint40 cliffReleaseTimestamp; // At which timestamp is the cliffAmount released. This must be <= startTimestamp\n         uint40 releaseIntervalSecs; // Every how many seconds does the vested amount increase. \n         \n@@ -108,7 +109,7 @@ contract VTVLVesting is Context, AccessProtected {\n \n         // We however still need the active check, since (due to the name of the function)\n         // we want to only allow active claims\n-        require(_claim.isActive == true, \"NO_ACTIVE_CLAIM\");\n+        require(_claim.isActive == true || _claim.deactivationTimestamp > 0, \"NO_ACTIVE_CLAIM\");\n \n         // Save gas, omit further checks\n         // require(_claim.linearVestAmount + _claim.cliffAmount > 0, \"INVALID_VESTED_AMOUNT\");\n@@ -144,20 +145,20 @@ contract VTVLVesting is Context, AccessProtected {\n     @param _claim The claim in question\n     @param _referenceTs Timestamp for which we're calculating\n      */\n-    function _baseVestedAmount(Claim memory _claim, uint40 _referenceTs) internal pure returns (uint112) {\n+    function _baseVestedAmount(Claim memory _claim, uint40 _referenceTs, uint40 vestEndTimestamp) internal pure returns (uint112) {\n         uint112 vestAmt = 0;\n-        \n-        // the condition to have anything vested is to be active\n-        if(_claim.isActive) {\n+            \n+        if(_claim.isActive || _claim.deactivationTimestamp > 0) {\n             // no point of looking past the endTimestamp as nothing should vest afterwards\n             // So if we're past the end, just get the ref frame back to the end\n-            if(_referenceTs > _claim.endTimestamp) {\n-                _referenceTs = _claim.endTimestamp;\n+            if(_referenceTs > vestEndTimestamp) {\n+                _referenceTs = vestEndTimestamp;\n             }\n \n             // If we're past the cliffReleaseTimestamp, we release the cliffAmount\n             // We don't check here that cliffReleaseTimestamp is after the startTimestamp \n-            if(_referenceTs >= _claim.cliffReleaseTimestamp) { // @audit is _claim.require(cliffReleaseTimestamp < _claim.endTimestamp) ?\n+            if(_referenceTs >= _claim.cliffReleaseTimestamp) {  // @audit note  cliffReleaseTimestamp cannot? be zero without cliffamoutn being zero\n+                // @audit NOTE: (cliffReleaseTimestamp is always <= _startTimestamp <= endTimestamp, or 0 if no vesting)\n                 vestAmt += _claim.cliffAmount;\n             }\n \n@@ -195,7 +196,8 @@ contract VTVLVesting is Context, AccessProtected {\n     */\n     function vestedAmount(address _recipient, uint40 _referenceTs) public view returns (uint112) {\n         Claim storage _claim = claims[_recipient];\n-        return _baseVestedAmount(_claim, _referenceTs);\n+        uint40 vestEndTimestamp = _claim.isActive ? _claim.endTimestamp : _claim.deactivationTimestamp;\n+        return _baseVestedAmount(_claim, _referenceTs, vestEndTimestamp);\n     }\n \n     /**\n@@ -205,7 +207,18 @@ contract VTVLVesting is Context, AccessProtected {\n      */\n     function finalVestedAmount(address _recipient) public view returns (uint112) {\n         Claim storage _claim = claims[_recipient];\n-        return _baseVestedAmount(_claim, _claim.endTimestamp);\n+        return _baseVestedAmount(_claim, _claim.endTimestamp, _claim.endTimestamp);\n+    }\n+\n+    /**\n+    @notice Calculates how much wil be possible to claim at the end of vesting date, by subtracting the already withdrawn\n+            amount from the vestedAmount at this moment. Vesting date is either the end timestamp or the deactivation timestamp.\n+    @param _recipient - The address for whom we're calculating\n+    */\n+    function finalClaimableAmount(address _recipient) external view returns (uint112) {\n+        Claim storage _claim = claims[_recipient];\n+        uint40 vestEndTimestamp = _claim.isActive ? _claim.endTimestamp : _claim.deactivationTimestamp;\n+        return _baseVestedAmount(_claim, vestEndTimestamp, vestEndTimestamp) - _claim.amountWithdrawn;\n     }\n     \n     /**\n@@ -214,7 +227,8 @@ contract VTVLVesting is Context, AccessProtected {\n     */\n     function claimableAmount(address _recipient) external view returns (uint112) {\n         Claim storage _claim = claims[_recipient];\n-        return _baseVestedAmount(_claim, uint40(block.timestamp)) - _claim.amountWithdrawn;\n+        uint40 vestEndTimestamp = _claim.isActive ? _claim.endTimestamp : _claim.deactivationTimestamp;\n+        return _baseVestedAmount(_claim, uint40(block.timestamp), vestEndTimestamp) - _claim.amountWithdrawn;\n     }\n     \n     /** \n@@ -280,6 +294,7 @@ contract VTVLVesting is Context, AccessProtected {\n         Claim memory _claim = Claim({\n             startTimestamp: _startTimestamp,\n             endTimestamp: _endTimestamp,\n+            deactivationTimestamp: 0,\n             cliffReleaseTimestamp: _cliffReleaseTimestamp,\n             releaseIntervalSecs: _releaseIntervalSecs,\n             cliffAmount: _cliffAmount,\n@@ -436,6 +451,30 @@ contract VTVLVesting is Context, AccessProtected {\n         emit ClaimRevoked(_recipient, amountRemaining, uint40(block.timestamp), _claim);\n     }\n \n+    function revokeClaimProper(address _recipient) external onlyAdmin hasActiveClaim(_recipient) {\n+        // Fetch the claim\n+        Claim storage _claim = claims[_recipient];\n+        // Calculate what the claim should finally vest to\n+        uint112 finalVestAmt = finalVestedAmount(_recipient);\n+\n+        // No point in revoking something that has been fully consumed\n+        // so require that there be unconsumed amount\n+        require( _claim.amountWithdrawn < finalVestAmt, \"NO_UNVESTED_AMOUNT\");\n+\n+        _claim.isActive = false;\n+        _claim.deactivationTimestamp = uint40(block.timestamp);\n+\n+        uint112 vestedSoFarAmt = vestedAmount(_recipient, uint40(block.timestamp));\n+        // The amount that is \"reclaimed\" is equal to the total allocation less what was already\n+        // vested without the part that was already withdrawn.\n+        uint112 amountRemaining = finalVestAmt - (vestedSoFarAmt - _claim.amountWithdrawn);\n+\n+        numTokensReservedForVesting -= amountRemaining; // Reduces the allocation\n+\n+        // Tell everyone a claim has been revoked.\n+        emit ClaimRevoked(_recipient, amountRemaining, uint40(block.timestamp), _claim);\n+    }\n+\n     /**\n     @notice Withdraw a token which isn't controlled by the vesting contract.\n     @dev This contract controls/vests token at \"tokenAddress\". However, someone might send a different token. \n\n```\n\n**[lawrencehui (VTVL) confirmed and commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/475#issuecomment-1271750623):**\n > Thank you warden for the findings. We did think about adding a grace withdrawing period to further strengthen the users' trust to the admin. I would argue that severity is medium in the case as in practical sense we would assume admin will inform the receivers upon revocation and therefore withdrawAdmin was designed to be separated from revokeClaim. \n> \n> I acknowledge that some malicious admin might abuse this right and to claimed the receiver's already earned token before they claimed (as described in the scenario in this findings) and therefore we will consider adding the grace period to restrict admin to act maliciously.\n\n**[0xean (judge) commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/475#issuecomment-1272152502):**\n > I am going to stick with High, even a non malicious admin would have no choice but to kindly ask a user to claim before they revoked all their other tokens. If the user didn't comply, the admin has no option but to either \"steal\" their tokens or allow them to keep vesting. \n\n\n\n***\n\n## [[H-02] Permanent freeze of vested tokens due to overflow in `_baseVestedAmount`](https://github.com/code-423n4/2022-09-vtvl-findings/issues/95)\n*Submitted by Trust, also found by 0xSky, bin2chen, CertoraInc, hansfriese, KIntern&#95;NA, neko&#95;nyaa, neumo, rokinot, and wastewa*\n\n[VTVLVesting.sol#L176](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L176)<br>\n\nThe \\_baseVestedAmount() function calculates vested amount for some (claim, timestamp) pair. It is wrapped by several functions, like vestedAmount, which is used in withdraw() to calculate how much a user can retrieve from their claim. Therefore, it is critical that this function will calculate correctly for users to receive their funds.\n\nBelow is the calculation of the linear vest amount:\n\n    uint112 linearVestAmount = _claim.linearVestAmount * truncatedCurrentVestingDurationSecs / finalVestingDurationSecs;\n\nImportantly, \\_claim.linearVestAmount is of type uint112 and truncatedCurrentVestingDurationSecs is of type uint40. Using compiler >= 0.8.0,  the product cannot exceed uint112 or else the function reverts due to overflow. In fact, we can show that uint112 is an inadequate size for this calculation.\n\nThe max value for uint112 is 5192296858534827628530496329220096.<br>\nSeconds in year = 3600 &ast; 24 &ast; 365 = 31536000<br>\nTokens that inherit from ERC20 like the ones used in VTVL have 18 decimal places -> 1000000000000000000<br>\nThis means the maximum number of tokens that are safe to vest for one year is 2&ast;&ast;112 / 10e18 / (3600 &ast; 24 &ast; 365) = just 16,464,665 tokens.\nThis is definitely not a very large amount and it is expected that some projects will mint a similar or larger amount for vesting for founders / early employees. For 4 year vesting, the safe amount drops to 4,116,166.<br>\nProjects that are not forewarned about this size limit are likely to suffer from freeze of funds of employees, which will require very patchy manual revocation and restructuring of the vesting to not overflow.\n\n### Impact\n\nEmployees/founders do not have access to their vested tokens.\n\n### Proof of Concept\n\nBelow is a test that demonstrates the overflow issue, 1 year after 17,000,000 tokens have matured.\n\n    describe('Long vest fail', async () => {\n      let vestingContract: VestingContractType;\n      // Default params\n      // linearly Vest 10000, every 1s, between TS 1000 and 2000\n      // additionally, cliff vests another 5000, at TS = 900\n      const recipientAddress = await randomAddress();\n      const startTimestamp = BigNumber.from(1000);\n      const endTimestamp = BigNumber.from(1000 + 3600 * 24 * 365);\n      const midTimestamp = BigNumber.from(1000 + (3600 * 24 * 365) / 2);\n      const cliffReleaseTimestamp = BigNumber.from(0);\n      const linearVestAmount = BigNumber.from('170000000000000000000000000');\n      const cliffAmount = BigNumber.from(0);\n      const releaseIntervalSecs = BigNumber.from(5);\n\n      before(async () => {\n        const {vestingContract: _vc} = await createPrefundedVestingContract({tokenName, tokenSymbol, initialSupplyTokens});\n        vestingContract = _vc;\n        await vestingContract.createClaim(recipientAddress, startTimestamp, endTimestamp, cliffReleaseTimestamp, releaseIntervalSecs, linearVestAmount, cliffAmount);\n      });\n\n      it('half term works', async() => {\n        expect(await vestingContract.vestedAmount(recipientAddress, midTimestamp)).to.be.equal('85000000000000000000000000');\n      });\n\n      it('full term fails', async() => {\n        // Note: at exactly the cliff time, linear vested amount won't yet come in play as we're only at second 0\n        await expect(vestingContract.vestedAmount(recipientAddress, endTimestamp)).to.be.revertedWithPanic(0x11\n        );\n      });\n    });\n\n### Tools Used\n\nManual audit, hardhat / chai.\n\n### Recommended Mitigation Steps\n\nPerform the intermediate calculation of linearVestAmount using the uint256 type.\n\n    uint112 linearVestAmount = uint112( uint256(_claim.linearVestAmount) * truncatedCurrentVestingDurationSecs / finalVestingDurationSecs);\n\n**[lawrencehui (VTVL) confirmed and commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/95#issuecomment-1271760558):**\n > This finding is very useful and appreciate all wardens that flagged the potential risk of overflowing.\n\n\n\n***\n \n# Medium Risk Findings (10)\n## [[M-01] Supply cap of `VariableSupplyERC20Token` is not properly enforced](https://github.com/code-423n4/2022-09-vtvl-findings/issues/3)\n*Submitted by Czar102, also found by &#95;&#95;141345&#95;&#95;, 0xbepresent, 0xDecorativePineapple, 0xmatt, 0xNazgul, 0xSky, adriro, ajtra, Atarpara, Bahurum, bin2chen, cccz, cRat1st0s, cryptonue, d3e4, DimitarDimitrov, Franfran, GimelSec, innertia, jag, JGcarv, JLevick, joestakey, Junnon, neumo, obront, OptimismSec, pashov, pauliax, pcarranzav, peanuts, rajatbeladiya, rbserver, reassor, Rolezn, Ruhum, seyni, Soosh, Tomo, Trust, wagmi, zzykxx, and zzzitron*\n\n[VariableSupplyERC20Token.sol#L36-L46](https://github.com/code-423n4/2022-09-vtvl/blob/main/contracts/token/VariableSupplyERC20Token.sol#L36-L46)<br>\n\nThe admin of the token is not constrained to minting `maxSupply_`, they can mint any number of tokens.\n\n### Proof of Concept\n\n```js\n// If we're using maxSupply, we need to make sure we respect it\n// mintableSupply = 0 means mint at will\nif(mintableSupply > 0) {\n\trequire(amount <= mintableSupply, \"INVALID_AMOUNT\");\n\t// We need to reduce the amount only if we're using the limit, if not just leave it be\n\tmintableSupply -= amount;\n}\n```\n\nThe logic is as follows: if the amount that can be minted is zero, treat this as an infinite mint. Else require that the minted amount is not larger than mintable supply.\n\nOne can note that it is possible to mint all mintable supply. Then the mintable supply will be `0` which will be interpreted as infinity and any number of tokens will be possible to be minted.\n\n### Recommended Mitigation Steps\n\nTreat `2 ** 256 - 1` as infinity instead of `0`.\n\n**[0xean (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/3#issuecomment-1256802394):**\n > The warden's logic is correct, but given that this is behind an admin only flag, there are some external factors that would need to come into play for this to be realized. Downgrading to Medium severity. \n\n**[lawrencehui (VTVL) confirmed](https://github.com/code-423n4/2022-09-vtvl-findings/issues/3)**\n\n\n\n***\n\n## [[M-02] `_baseVestedAmount()` and `vestedAmount()` Return Incorrect Historical Values](https://github.com/code-423n4/2022-09-vtvl-findings/issues/104)\n_Submitted by Respx, also found by m9800_\n\n[VTVLVesting.sol#L183-L187](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L183-L187)<br>\n[VTVLVesting.sol#L198](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L198)<br>\n\nAs the comments in `_baseVestedAmount()` explain, once there is any `_claim.amountWithdrawn`, it will be returned if it is greater than the calculated value `vestAmt`. However, `vestAmt` takes account of time, `_referenceTs`, whereas `_claim.amountWithdrawn` is always the amount withdrawn to date. Therefore, for all historical values below `_claim.amountWithdrawn`, including timestamps before `_claim.startTimestamp` and before `_claim.cliffReleaseTimestamp`, `_claim.amountWithdrawn` will be returned.\n\n### Impact\n\nGiven that VTVL is intended to be an accessible platform for use by a wide variety of users, this behaviour does create a security risk. Consider these scenarios:\n\n*   A protocol relies on VTVL as an off-the-shelf solution for vesting, but builds other systems (escrow, NFT grants, access, airdrops) that work by checking the value of `vestedAmount()`. Airdrops are especially likely to be interested in historical values. These values would be distorted by how much users have claimed and so would result in an undesirable distribution of resources.\n*   Even if the above does not occur, consider that VTVL might be passed over as a vesting solution precisely because its historical data is inaccurate.\n*   A contract could be built that inherits from `VTVLVesting` and attempts to use `_baseVestedAmount()` (which is `internal` and so can be used by inheriting contracts). The inheriting contract might apportion rewards based on historical usage.\n*   VTVL itself might wish to inherit from `VTVLVesting` in future.\n\n### Proof of Concept\n\n```diff\ndiff --git a/test/VTVLVesting.ts b/test/VTVLVestingPOC.ts\nindex bb609fb..073e53f 100644\n--- a/test/VTVLVesting.ts\n+++ b/test/VTVLVestingPOC.ts\n@@ -500,14 +500,37 @@ describe('Revoke Claim', async () => {\n   const recipientAddress = await randomAddress();\n   const [owner, owner2] = await ethers.getSigners();\n \n-  it('allows admin to revoke a valid claim', async () => {\n+  it('POC: WITHDRAWN DATA IS UNRELIABLE', async () => {\n     const {vestingContract} = await createPrefundedVestingContract({tokenName, tokenSymbol, initialSupplyTokens});\n-    await vestingContract.createClaim(recipientAddress, startTimestamp, endTimestamp, cliffReleaseTimestamp, releaseIntervalSecs, linearVestAmount, cliffAmount);\n+    const startTimestamp2 = startTimestamp.add(releaseIntervalSecs.mul(100));\n+    const endTimestamp2 = endTimestamp.add(releaseIntervalSecs.mul(100));\n+    const cliffReleaseTimestamp2 = cliffReleaseTimestamp.add(releaseIntervalSecs.mul(100));\n+    await vestingContract.createClaim(owner2.address, startTimestamp2, endTimestamp2, cliffReleaseTimestamp2, releaseIntervalSecs, linearVestAmount, cliffAmount);\n+\n+    // Fast forward to middle of claim\n+    const halfWay = startTimestamp2.toNumber() + (endTimestamp2.toNumber()-startTimestamp2.toNumber())/2;\n+    await ethers.provider.send(\"evm_mine\", [halfWay]);\n+\n+    let vestAmt = await vestingContract.vestedAmount(owner2.address, startTimestamp);\n+    console.log(\"NO WITHDRAWAL, BEFORE VEST START: \",vestAmt.toString());\n+    vestAmt = await vestingContract.vestedAmount(owner2.address, startTimestamp2);\n+    console.log(\"NO WITHDRAWAL, AT VEST START: \",vestAmt.toString());\n+    vestAmt = await vestingContract.vestedAmount(owner2.address, halfWay);\n+    console.log(\"NO WITHDRAWAL, HALF WAY THROUGH VEST: \",vestAmt.toString());\n+    vestAmt = await vestingContract.vestedAmount(owner2.address, endTimestamp2);\n+    console.log(\"NO WITHDRAWAL, AT VEST END: \",vestAmt.toString());\n+\n+    await (await vestingContract.connect(owner2).withdraw()).wait();\n \n-    (await vestingContract.revokeClaim(recipientAddress)).wait();\n+    vestAmt = await vestingContract.vestedAmount(owner2.address, startTimestamp);\n+    console.log(\"WITHDRAWAL, BEFORE VEST START: \",vestAmt.toString());\n+    vestAmt = await vestingContract.vestedAmount(owner2.address, startTimestamp2);\n+    console.log(\"WITHDRAWAL, AT VEST START: \",vestAmt.toString());\n+    vestAmt = await vestingContract.vestedAmount(owner2.address, halfWay);\n+    console.log(\"WITHDRAWAL, HALF WAY THROUGH VEST: \",vestAmt.toString());\n+    vestAmt = await vestingContract.vestedAmount(owner2.address, endTimestamp2);\n+    console.log(\"WITHDRAWAL, AT VEST END: \",vestAmt.toString());\n \n-    // Make sure it gets reverted\n-    expect(await (await vestingContract.getClaim(recipientAddress)).isActive).to.be.equal(false);\n   });\n \n   it('prohibits a random user from revoking a valid claim', async () => {\n```\n\n### Recommended Mitigation Steps\n\nFor active claims, there is no reason to consider `_claim.amountWithdrawn`, as it will always have been below or equal to `vestAmt` at any point in time. So only consider `vestAmt` for inactive claims. For them, return the lowest of `vestAmt` and  `_claim.amountWithdrawn`. This will keep the values monotonic with time without distorting the historical values. It will act as though `_claim.amountWithdrawn` was withdrawn and the claim was revoked in the block when `vestAmt` reached `_claim.amountWithdrawn`. That is a distortion,0xean but it is required to provide monotonicity.\n\n**[0xean (judge) commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/104#issuecomment-1257255246):**\n > Good find. \n\n**[lawrencehui (VTVL) confirmed](https://github.com/code-423n4/2022-09-vtvl-findings/issues/104)**\n\n\n\n***\n\n## [[M-03] Possible DoS on `vestingRecipients` due to lack of disposal mechanism](https://github.com/code-423n4/2022-09-vtvl-findings/issues/128)\n_Submitted by fatherOfBlocks, also found by wagmi_\n\n[VTVLVesting.sol#L224](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L224)<br>\n[VTVLVesting.sol#L245](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L245)<br>\n[VTVLVesting.sol#L302](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L302)<br>\n[VTVLVesting.sol#L317](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L317)<br>\n\nWhen the smart contracts start to be used, the variable in storage vestingRecipients will start to be filled with addresses, as there is no mechanism to eliminate elements, this will cause the `allVestingRecipients()` function to generate a DoS yes has many addressess.\n\n### Recommended Mitigation Steps\n\nIn the `withdraw()` function you could remove the element from `vestingRecipients` that no longer has vesting. This would make the variable not grow without reducing elements.\n\n**[0xean (judge) commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/128#issuecomment-1257069235):**\n > On the fence on this one.  I agree with the warden, but in the current implementation `allVestingRecipients` is unused and assumed to be for external, off chain uses so the impact is hard to determine. Going to leave as Medium, pending sponsor review.\n\n**[lawrencehui (VTVL) confirmed and commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/128#issuecomment-1270859394):**\n > I would agree with the warden on the lack of control for an ever-growing array size could be an issue. I will tag this as an enhancement. \n> \n> On the side, I want to check what is the allowed max size of the array in this case? `2**256 -1`? but theoretically calling a large array would exceed the the block gas limit when retrieving it?\n\n**[0xean (judge) commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/128#issuecomment-1272143412):**\n > @lawrencehui - Yes retrieval will eventually fail, long before you populate the array fully. You could pass in an index range to retrieve portions of the array to avoid this failure mode. \n>\n> And yes `2**256 -1` is my understanding of the theoretical limit. \n\n\n\n***\n\n## [[M-04] not able to create claim](https://github.com/code-423n4/2022-09-vtvl-findings/issues/140)\n*Submitted by rajatbeladiya, also found by 0x4non, ak1, berndartmueller, CertoraInc, Chom, imare, JLevick, joestakey, JohnSmith, KIntern&#95;NA, obront, rbserver, rotcivegaf, Ruhum, RustyRabbit, and supernova*\n\nIf admin revoked any recipient’s claim, admin can not create claim for the same recipient because `startTimestamp` is not updated to initial value on revoke claim.<br>\nThere will be a need to create a claim again for any reason like: 1) mistakenly revoked claim, 2) wrong info provided to claim, 3) new vesting period starts, etc.\n\n### Proof of Concept\n\n1.  Alice creates claim for Bob\n2.  Alice revokes claim of Bob\n    *   On `revokeClaim()`, claim's `isActive` will be false, but `startTimestamp` will remain as it is\n    *   [VTVLVesting.sol#L418-L437](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L418-L437)\n3.  Alice tries to create claim for Bob but claim will not create because it has modifier `hasNoClaim()` which is checked for claim should not active and it checks for `require(_claim.startTimestamp == 0, \"CLAIM_ALREADY_EXISTS\");`\n\n*   [VTVLVesting.sol#L245-L253](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L245-L253)\n*   [VTVLVesting.sol#L123-L140](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L123-L140)\n\n### Recommended Mitigation Steps\n\nUpdate `startTimestamp to 0` on `revokeClaim()`.\n\n**[0xean (judge) decreased severity to Low and commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/140#issuecomment-1257040023):**\n > Downgrading to low severity. While true, why wouldn't the employee just use a different address?  There is no residual benefit to using the old address (unless it was a smart contract, which the warden doesn't mention as part of their POC).  The sponsor may want to fix this, since the fix is simple, but it poses very little risk and certainly no direct loss of funds. \n\n**[0xean (judge) increased severity to Medium and commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/140#issuecomment-1257197630):**\n > Spent a bit more time thinking about this one and do think that it qualifies as Medium severity since it does affect the availability of the protocol in a number of ways. Going to go ahead and revise to Medium. \n\n**[lawrencehui (VTVL) acknowledged, but disagreed with severity and commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/140#issuecomment-1270868222):**\n > The vesting contract is designed to be created and used in a one-off manner and the revoke function is to prevent any mistakes made upon creation (wrong address / amount / timestamp etc.). In practical sense, if a claim (or the recipient address) is revoked, one (the admin) can always create a new vesting contract with the correct claim parameters. \n> \n> I therefore think that it is by design that the address is only able be claimable once per vesting contract, in all circumstance, the admin can re-create a new vesting contract to mitigate this issue and therefore this is a low risk / non-critical issue. \n\n**[0xean (judge) commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/140#issuecomment-1272144853):**\n > I don't think the tactic of deploying a new contract is the correct one here simply to be able to set up vesting for one botched person or someone whose vesting token amount changes for example. I am going to stick with the Medium severity on this one, but do appreciate the response and thoughts on possible mitigations.\n\n**[ak1 (warden) commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/140#issuecomment-1279883877):**\n > I have explained one of the real use case scenarios where this protocol will fail to serve many. Refer to [issue 384](https://github.com/code-423n4/2022-09-vtvl-findings/issues/384).<br>\n> It is not always contract address or EOA which will decide the identity of a person. Each one will have unique ID. That id is going to be used in all the places.\n\n\n\n***\n\n## [[M-05] Tokens with lower number of decimals can result in postponed linear vesting for user](https://github.com/code-423n4/2022-09-vtvl-findings/issues/191)\n_Submitted by pashov_\n\n[VTVLVesting.sol#L174](https://github.com/code-423n4/2022-09-vtvl/blob/69da6e96f94ff3e02b9bb6175e6de2b3e71d3eb0/contracts/VTVLVesting.sol#L174)<br>\n\nIn the `_baseVestedAmount` of `VTVLVesting.sol` we see the following code\n\n```solidity\nuint40 finalVestingDurationSecs = _claim.endTimestamp - _claim.startTimestamp; // length of the interval\nuint112 linearVestAmount = _claim.linearVestAmount * truncatedCurrentVestingDurationSecs / finalVestingDurationSecs;\n```\n\nLet’s look at `truncatedCurrentVestingDurationSecs` as just the duration passed from the start of the vesting period for the PoC (this doesn’t omit important data in this context).\n\nNow think of the following scenario:\n\nWe have a token `$TKN` that has 6 decimals (those are the decimals of both USDT & USDC). We want to distribute 10,000 of those tokens to a user vested over a 10 year period.\n\n10 years in seconds is 315360000 &ast;&ast;&ast;&ast;(this is `finalVestingDurationSecs`)\n\nThis means that we will distribute 10,000 &ast; 10^6 = 10 000 000 000 fractions of a token for 315360000 seconds, meaning we will distribute 310 fractions of a token each second - this is `linearVestAmount`\n\nNow, since `finalVestingDurationSecs` is so big (315360000) it will almost always round `linearVestAmount` to zero when dividing by it, up until\n\n`_claim.linearVestAmount * truncatedCurrentVestingDurationSecs` becomes a bigger number than 315360000, but since `_claim.linearVestAmount` is 310 we will need the current vesting duration to be at least 1 017 290 seconds which is **12** days postponed vesting. 12 days in a moving market can make a big difference if the user was expecting the tokens to start vesting from the first day.\n\n### Impact\n\nUnexpected postponing of vesting can result in waiting times for users to receive their must-be-vested tokens. This period can be used by other token holders to dump the token and decrease the price of it, resulting in a loss of capital for the vesting receiver.\n\n### Recommended Mitigation Steps\n\nEnforce the contract to work with only 18 decimal tokens with a `require` statement in the constructor.\n\n**[0xean (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/191#issuecomment-1257051653):**\n > Downgrading to Medium, there are a lot of external factors presented here by the warden to line up to a loss of funds.  \n\n**[lawrencehui (VTVL) acknowledged, but disagreed with severity and commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/191#issuecomment-1270955314):**\n > I acknowledge the warden's concern of the rounding, but I think the result of loss of funds is one of the extreme edge cases. I would suggest instead of restricting only to 18 decimal tokens (which is impractical as we would also want to include USDC and USDT for vesting too!), I would implement the rounding checking in the frontend UI and prompt user of potential delay caused by rounding / truncation as described in this issue.\n\n**[0xean (judge) commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/191#issuecomment-1272146188):**\n > Given that smart contracts can be interacted with in any number of ways (etherscan, programmatically, etc), I don't think the mitigation negates the risk entirely and am going to stick with the Medium severity here.  The wardens demonstrates clearly the way in which this can happen. While it may be a bit outside of the normal vesting schedule expected, I do think it's valuable to understand the bounds of the math you have employed here.\n\n\n\n***\n\n## [[M-06] Variable balance token causing fund lock and loss](https://github.com/code-423n4/2022-09-vtvl-findings/issues/278)\n*Submitted by &#95;&#95;141345&#95;&#95;, also found by 0xDecorativePineapple, CertoraInc, djxploit, hyh, IllIllI, JohnSmith, MiloTruck, rbserver, and zzzitron*\n\n[VTVLVesting.sol#L295](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L295)<br>\n[VTVLVesting.sol#L388](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L388)<br>\n\nSome ERC20 token's balance could change, one example is stETH. The balance could become insufficient at the time of `withdraw()`. User's fund will be locked due to DoS. The way to take the fund out is to send more token into the contract, causing fund loss to the protocol. And there is no guarantee that until the end time the balance would stay above the needed amount, the lock and loss issue persist.\n\n### Proof of Concept\n\nFor stETH like tokens, the `balanceOf()` value might go up or down, even without transfer.\n\n```solidity\n// stETH\n    function balanceOf(address who) external override view returns (uint256) {\n        return _shareBalances[who].div(_sharesPerToken);\n    }\n```\n\nIn `VTVLVesting`, the `require` check for the spot `balanceOf()` value will pass, but it is possible that as time goes on, the value become smaller and fail the transfer. As a result, the `withdraw()` call will revert, causing DoS, and lock user's fund.\n\n```solidity\n// contracts/VTVLVesting.sol\n    function _createClaimUnchecked() private  hasNoClaim(_recipient) {\n        // ...\n        require(tokenAddress.balanceOf(address(this)) >= numTokensReservedForVesting + allocatedAmount, \"INSUFFICIENT_BALANCE\");\n        // ...\n    }\n\n    function withdraw() hasActiveClaim(_msgSender()) external {\n        // ...\n        tokenAddress.safeTransfer(_msgSender(), amountRemaining);\n        // ...\n    }\n```\n\n### Reference\n\n<https://etherscan.io/address/0x312ca0592a39a5fa5c87bb4f1da7b77544a91b87#code>\n\n### Recommended Mitigation Steps\n\nDisallow such kind of variable balance token.\n\n**[0xean (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/278#issuecomment-1257053341):**\n > stETH only rebases up, not down.  So that is a poor example.\n> \n> The sponsor's README does say they will support any ERC20 token, so that could include Fee on Transfer or downward rebasing tokens which could lead to less tokens in the contract than expected and transfers to revert due to balances being lower than expected. \n> \n> Downgrading to Medium as the external requirement is using these contracts on tokens that are known to have variable supply.\n\n**[lawrencehui (VTVL) confirmed and commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/278#issuecomment-1270993220):**\n > Thanks for reporting this and I will add this as a feature enhancement to cater / avoid for tokens with rebasing supplies. \n> \n> Question: Is there a straight forward way to detect rebasing tokens? Or on the flip side, restricting erc20 tokens that do not exhibit rebasing behaviour?\n\n**[0xean (judge) commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/278#issuecomment-1272148124):**\n > @lawrencehui - Great question.  There isn't a great way to detect this functionality in any generic manner unfortunately. \n> \n> Most contracts that want to handle FOT tokens will do something like (in pseudocode)\n> \n> ```\n> uint256 balBefore = ERC20.balanceOf(address(this));\n> ERC20.transferFrom(...);\n> uint256 balAfter= ERC20.balanceOf(address(this));\n> uint256 actualBalChange = balAfter - balBefore;\n> ```\n> \n> Rebasing tokens are different again, and the easiest way to handle them is to create shares to track the internal math.  The shares track the % ownership of the entire balance of the contract.  Probably more than I can explain here, but would be happy to work with you if this is something you are interested in.\n\n\n\n***\n\n## [[M-07] Vesting Schedule Start and End Time can be Set in the Past ](https://github.com/code-423n4/2022-09-vtvl-findings/issues/292)\n_Submitted by TomJ, also found by ayeslick, csanuragjain, and pashov_\n\n[VTVLVesting.sol#L245-L304](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L245-L304)<br>\n\nThere is no check whether `_startTimestamp` and `_endTimestamp` is greater than `block.timestamp`\nat `VTVLVesting.sol` `_createClaimUnchecked` function. Therefore it is possible for administrators to accidentally create\nvesting schedule that starts and ends in the past without noticing it. When administrators does this and this transaction goes\nthrough, then the vesting recipients can withdraw their entire vest amount which is not what administrators intended to do.\nAdd require check that force `_startTimestamp` to be greater than `block.timestamp`.\n\nTeam comments as below on line 260\n\n    // -> Conclusion: we want to allow this, for founders that might have forgotten to add some users, or to avoid issues with \n    transactions not going through because of discoordination between block.timestamp and sender's local time\n\nHowever this is not an issue by adding `require(_startTimestamp > uint40(block.timestamp))` since this will revert\ntransaction if \\_startTimestamp is less than block.timestamp so administrators can simply try again with correct time.\nOn the other hand, it is more dangerous to not include this check because transaction will simply succeed even though\n\\_startTimestamp is set to past which means that there is a chance of administrators not noticing this.\n\n### Proof of Concept\n\n1. Admin creates new vesting schedule using `createClaim` function. However admin mistakenly set `_startTimestamp` and `_endTimestamp` in the past.\n2. Since there is no check of `require(_startTimestamp > uint40(block.timestamp))`, this transaction is valid and claim\nis created.\n3. Vesting recipients calls the `withdraw` function and receive entire vest amount.\n\n### Recommended Mitigation Steps\n\nAdd following check in `VTVLVesting.sol:_createClaimUnchecked` function.\n\n    require(_startTimestamp > uint40(block.timestamp), \"INVALID_START_TIMESTAMP\")\n\n**[0xean (judge) commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/292#issuecomment-1257257193):**\n > Going to use this issue for encompassing a few different reports that all revolve around adding some better validation around timestamps.  These include a few different potential fixes that the sponsor can review, but ultimately point to the same underlying issues.\n\n**[lawrencehui (VTVL) acknowledged, but disagreed with severity and commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/292#issuecomment-1270998197):**\n > As described in the documentation, this back dated (`startTimestamp < block.timestamp`) feature is indeed intended as there are many real life cases that founders want to reward their employees in the way the vesting period starts well before Token Generation Event (TGE). \n> \n> We appreciate wardens' feedback on additional checking (both start and end time) and in our actual application, we would include multiple layer of checking / approval processes in front and backend before the transaction signing happens and therefore the risk is low in our opinion. \n\n\n\n***\n\n## [[M-08] Two address tokens can be withdrawn by the admin even if they are vested](https://github.com/code-423n4/2022-09-vtvl-findings/issues/429)\n_Submitted by CertoraInc, also found by 0xhunter, datapunk, dipp, Lambda, and wuwe1_\n\n[VTVLVesting.sol#L446-L451](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L446-L451)<br>\n\nTwo address tokens exist in the blockchain. For example, Synthetix's `ProxyERC20` contract is such a token which exists in many forms (sUSD, sBTC...). Tokens as such can be vested, but the admin can withdraw them even if they are vested by providing the other address to the `withdrawOtherToken` function. The only check in this function is that `_otherTokenAddress != tokenAddress`, which is irrelevant in the case of two address tokens.\n\nThis can make the admin be able to withdraw the vested funds and break the system, because the balance of the contract can be less than the vested amount.\n\n### Proof of Concept\n\n1.  The `VTVLVesting` is deployed with the `sUSD` contract, using its main (proxy) address - `0x57Ab1ec28D129707052df4dF418D58a2D46d5f51`.\n2.  A claim is created for Alice, vesting 1000 sUSD in linear vesting. Assuming this is the only claim currently, the balance of the contract is 1000 sUSD and the value of `numTokensReservedForVesting` is `1000e18`.\n3.  The admin calls the `withdrawOtherToken` for 1000e18 sUSD, providing its second address - `0x57Ab1ec28D129707052df4dF418D58a2D46d5f51`. The value of `numTokensReservedForVesting` is still `1000e18`, but the balance of the contract is now 0 sUSD.\n4.  Alice waits for her vest to end, calls the withdraw function, but the function reverts on the call to `safeTransfer()` because there is insufficient balance of sUSD. Alice can't receive her funds.\n\n### Recommended Mitigation Steps\n\nReplace the address check with a balance check - record the vesting token balance of the contract before and after the transfer and assert that they are equal.\n\n**[0xean (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/429#issuecomment-1257055160):**\n > Downgrading to Medium. The fix is a good idea, but this is a pretty rare token implementation and definitely qualifies as an external factor. \n\n**[lawrencehui (VTVL) acknowledged and commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/429#issuecomment-1271301629):**\n > Yes, agreed with @0xean that this is very rare and appreciate warden's suggestion on the fix on balance checking.\n\n\n\n***\n\n## [[M-09] `_releaseIntervalSecs` is not validated](https://github.com/code-423n4/2022-09-vtvl-findings/issues/448)\n_Submitted by sorrynotsorry_\n\nVTVLVesting.sol has `_createClaimUnchecked` function to create the claims internally while validating parameters with the users' allocations.<br>\nHowever, `_releaseIntervalSecs` is not validated comparing to user's  `_linearVestAmount` and `_startTimestamp` `_endTimestamp`.\nTheoretically, `_linearVestAmount` should be equal to `((_endTimestamp - _startTimestamp) * _releaseIntervalSecs)` so the `_releaseIntervalSecs` = `_linearVestAmount / ((_endTimestamp - _startTimestamp)`.<br>\nBut this check was never done.\n\nIf the `_releaseIntervalSecs` is validated either to a higher or to a lower amount, it will create unfair distributions amongst the users during withdrawals due to being higher/lower than it should be. And also it may end up with the last withdrawals can be reverted due to the calculation board not matching.\n\n### Proof of Concept\n\n```solidity\n    function _createClaimUnchecked(\n            address _recipient, \n            uint40 _startTimestamp, \n            uint40 _endTimestamp, \n            uint40 _cliffReleaseTimestamp, \n            uint40 _releaseIntervalSecs, \n            uint112 _linearVestAmount, \n            uint112 _cliffAmount\n                ) private  hasNoClaim(_recipient) {\n\n\n        require(_recipient != address(0), \"INVALID_ADDRESS\");\n        require(_linearVestAmount + _cliffAmount > 0, \"INVALID_VESTED_AMOUNT\"); // Actually only one of linearvested/cliff amount must be 0, not necessarily both\n        require(_startTimestamp > 0, \"INVALID_START_TIMESTAMP\");\n        // Do we need to check whether _startTimestamp is greater than the current block.timestamp? \n        // Or do we allow schedules that started in the past? \n        // -> Conclusion: we want to allow this, for founders that might have forgotten to add some users, or to avoid issues with transactions not going through because of discoordination between block.timestamp and sender's local time\n        // require(_endTimestamp > 0, \"_endTimestamp must be valid\"); // not necessary because of the next condition (transitively)\n        require(_startTimestamp < _endTimestamp, \"INVALID_END_TIMESTAMP\"); // _endTimestamp must be after _startTimestamp\n        require(_releaseIntervalSecs > 0, \"INVALID_RELEASE_INTERVAL\");\n        require((_endTimestamp - _startTimestamp) % _releaseIntervalSecs == 0, \"INVALID_INTERVAL_LENGTH\");\n\n\n        // Potential TODO: sanity check, if _linearVestAmount == 0, should we perhaps force that start and end ts are the same?\n\n\n        // No point in allowing cliff TS without the cliff amount or vice versa.\n        // Both or neither of _cliffReleaseTimestamp and _cliffAmount must be set. If cliff is set, _cliffReleaseTimestamp must be before or at the _startTimestamp\n        require( \n            (\n                _cliffReleaseTimestamp > 0 && \n                _cliffAmount > 0 && \n                _cliffReleaseTimestamp <= _startTimestamp\n            ) || (\n                _cliffReleaseTimestamp == 0 && \n                _cliffAmount == 0\n        ), \"INVALID_CLIFF\");\n\n\n        Claim memory _claim = Claim({\n            startTimestamp: _startTimestamp,\n            endTimestamp: _endTimestamp,\n            cliffReleaseTimestamp: _cliffReleaseTimestamp,\n            releaseIntervalSecs: _releaseIntervalSecs,\n            cliffAmount: _cliffAmount,\n            linearVestAmount: _linearVestAmount,\n            amountWithdrawn: 0,\n            isActive: true\n        });\n        // Our total allocation is simply the full sum of the two amounts, _cliffAmount + _linearVestAmount\n        // Not necessary to use the more complex logic from _baseVestedAmount\n        uint112 allocatedAmount = _cliffAmount + _linearVestAmount;\n\n\n        // Still no effects up to this point (and tokenAddress is selected by contract deployer and is immutable), so no reentrancy risk \n        require(tokenAddress.balanceOf(address(this)) >= numTokensReservedForVesting + allocatedAmount, \"INSUFFICIENT_BALANCE\");\n\n\n        // Done with checks\n\n\n        // Effects limited to lines below\n        claims[_recipient] = _claim; // store the claim\n        numTokensReservedForVesting += allocatedAmount; // track the allocated amount\n        vestingRecipients.push(_recipient); // add the vesting recipient to the list\n        emit ClaimCreated(_recipient, _claim); // let everyone know\n    }\n```\n\n[Permalink](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L245-L304)\n\n### Recommended Mitigation Steps\n\nThe `_releaseIntervalSecs` should be validated comparing to user's  `_linearVestAmount` and `_startTimestamp` `_endTimestamp`.\n\n**[0xean (judge) decreased severity to Medium and commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/448#issuecomment-1257056265):**\n > This is fair, but due to it being behind only admin functionality and coming down to input sanitization, going to downgrade to Medium.  \n\n**[lawrencehui (VTVL) acknowledged, but disagreed with severity and commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/448#issuecomment-1271710784):**\n > I agree with @0xean that the risk in this case is low given the onlyAdmin modifier and the input will be validated from the frontend anyway. Appreciate the finding and we will take consideration of adding additional checking of `_releaseIntervalSecs`.\n\n\n\n***\n\n## [[M-10] Reentrancy may allow an admin to steal funds](https://github.com/code-423n4/2022-09-vtvl-findings/issues/6)\n*Submitted by Czar102, also found by 0xSmartContract, csanuragjain, hansfriese, Lambda, Respx, and sashik&#95;eth*\n\n[VTVLVesting.sol#L394-L411](https://github.com/code-423n4/2022-09-vtvl/blob/main/contracts/VTVLVesting.sol#L394-L411)<br>\n\nIf the token is reentrant, an admin can steal all tokens locked in the `VTVLVesting` contract while having active locks.\n\nIn other words, due to this exploit possibility, the contract may be insolvent with respect to *active* vestings. Note that revoking claim doesn't break this invariant since the vesting is closed in that case.\n\n### Proof of Concept\n\nThe reentrancy in the vested token can be used by an admin if the execution can be hijacked before the balance change occurs.\n\n```js\n/**\n@notice Admin withdrawal of the unallocated tokens.\n@param _amountRequested - the amount that we want to withdraw\n\t*/\nfunction withdrawAdmin(uint112 _amountRequested) public onlyAdmin {    \n\t// Allow the owner to withdraw any balance not currently tied up in contracts.\n\tuint256 amountRemaining = tokenAddress.balanceOf(address(this)) - numTokensReservedForVesting;\n\n\trequire(amountRemaining >= _amountRequested, \"INSUFFICIENT_BALANCE\");\n\n\t// Actually withdraw the tokens\n\t// Reentrancy note - this operation doesn't touch any of the internal vars, simply transfers\n\t// Also following Checks-effects-interactions pattern\n\ttokenAddress.safeTransfer(_msgSender(), _amountRequested);\n\n\t// Let the withdrawal known to everyone\n\temit AdminWithdrawn(_msgSender(), _amountRequested);\n}\n```\n\nLet's consider function `withdrawAdmin`. Firstly, the balance is checked and then if there is enough token surplus to withdraw, the withdrawal is allowed. The surplus is based on two values: `numTokensReservedForVesting` which isn't changed by this function and the balance of the contract.\n\nIf the owner hijacks the execution before the balance change in the token transfer (which is possible in, for example, ERC777), an admin can call this function again and it will allow for an invocation of another transfer since the token balance hasn't changed yet.\n\nFor example, if there is `$1m` in vestings in the contract, an admin can send `$100k` to it in tokens and recursively invoke `withdrawalAdmin` with the amount of `$100k` eleven times so that the whole contract balance will be drained.\n\n### Recommended Mitigation Steps\n\nAdd `ReentrancyGuard`'s `nonReentrant` to the `withdrawAdmin` function.\n\n**[0xean (judge) commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/6#issuecomment-1257063808):**\n > This would require a number of assumptions to be the case including a malicious admin which the sponsors called out of scope.  Because it is obviously not intended functionality, I am going to leave as Medium pending sponsor review. I think the non-reentrant modifier is worth adding. \n\n**[lawrencehui (VTVL) acknowledged and commented](https://github.com/code-423n4/2022-09-vtvl-findings/issues/6#issuecomment-1271726987):**\n > Will consider adding ReentrancyGuard as suggested.\n\n\n\n***\n\n# Low Risk and Non-Critical Issues\n\nFor this contest, 135 reports were submitted by wardens detailing low risk and non-critical issues. The [report highlighted below](https://github.com/code-423n4/2022-09-vtvl-findings/issues/277) by **AkshaySrivastav** received the top score from the judge.\n\n*The following wardens also submitted reports: [rbserver](https://github.com/code-423n4/2022-09-vtvl-findings/issues/273), [IllIllI](https://github.com/code-423n4/2022-09-vtvl-findings/issues/251), [0xNazgul](https://github.com/code-423n4/2022-09-vtvl-findings/issues/367), [0x1f8b](https://github.com/code-423n4/2022-09-vtvl-findings/issues/44), [lukris02](https://github.com/code-423n4/2022-09-vtvl-findings/issues/349), [rotcivegaf](https://github.com/code-423n4/2022-09-vtvl-findings/issues/189), [ajtra](https://github.com/code-423n4/2022-09-vtvl-findings/issues/358), [cryptostellar5](https://github.com/code-423n4/2022-09-vtvl-findings/issues/442), [0xSmartContract](https://github.com/code-423n4/2022-09-vtvl-findings/issues/270), [Deivitto](https://github.com/code-423n4/2022-09-vtvl-findings/issues/441), [Bahurum](https://github.com/code-423n4/2022-09-vtvl-findings/issues/76), [brgltd](https://github.com/code-423n4/2022-09-vtvl-findings/issues/359), [Diana](https://github.com/code-423n4/2022-09-vtvl-findings/issues/445), [c3phas](https://github.com/code-423n4/2022-09-vtvl-findings/issues/459), [chatch](https://github.com/code-423n4/2022-09-vtvl-findings/issues/303), [ladboy233](https://github.com/code-423n4/2022-09-vtvl-findings/issues/9), [supernova](https://github.com/code-423n4/2022-09-vtvl-findings/issues/34), [RockingMiles](https://github.com/code-423n4/2022-09-vtvl-findings/issues/32), [Waze](https://github.com/code-423n4/2022-09-vtvl-findings/issues/199), [tnevler](https://github.com/code-423n4/2022-09-vtvl-findings/issues/344), [a12jmx](https://github.com/code-423n4/2022-09-vtvl-findings/issues/375), [Funen](https://github.com/code-423n4/2022-09-vtvl-findings/issues/466), [pcarranzav](https://github.com/code-423n4/2022-09-vtvl-findings/issues/20), [0x4non](https://github.com/code-423n4/2022-09-vtvl-findings/issues/201), [KIntern\\_NA](https://github.com/code-423n4/2022-09-vtvl-findings/issues/212), [\\_\\_141345\\_\\_](https://github.com/code-423n4/2022-09-vtvl-findings/issues/151), [delfin454000](https://github.com/code-423n4/2022-09-vtvl-findings/issues/330), [0x5rings](https://github.com/code-423n4/2022-09-vtvl-findings/issues/341), [Aymen0909](https://github.com/code-423n4/2022-09-vtvl-findings/issues/436), [ubermensch](https://github.com/code-423n4/2022-09-vtvl-findings/issues/11), [Rolezn](https://github.com/code-423n4/2022-09-vtvl-findings/issues/268), [leosathya](https://github.com/code-423n4/2022-09-vtvl-findings/issues/326), [0xf15ers](https://github.com/code-423n4/2022-09-vtvl-findings/issues/376), [gogo](https://github.com/code-423n4/2022-09-vtvl-findings/issues/438), [CodingNameKiki](https://github.com/code-423n4/2022-09-vtvl-findings/issues/467), [V\\_B](https://github.com/code-423n4/2022-09-vtvl-findings/issues/471), [aysha](https://github.com/code-423n4/2022-09-vtvl-findings/issues/487), [seyni](https://github.com/code-423n4/2022-09-vtvl-findings/issues/216), [Dravee](https://github.com/code-423n4/2022-09-vtvl-findings/issues/25), [ChristianKuri](https://github.com/code-423n4/2022-09-vtvl-findings/issues/27), [JLevick](https://github.com/code-423n4/2022-09-vtvl-findings/issues/284), [CertoraInc](https://github.com/code-423n4/2022-09-vtvl-findings/issues/435), [JohnnyTime](https://github.com/code-423n4/2022-09-vtvl-findings/issues/93), [Bnke0x0](https://github.com/code-423n4/2022-09-vtvl-findings/issues/46), [Lambda](https://github.com/code-423n4/2022-09-vtvl-findings/issues/82), [Respx](https://github.com/code-423n4/2022-09-vtvl-findings/issues/102), [RaymondFam](https://github.com/code-423n4/2022-09-vtvl-findings/issues/118), [rajatbeladiya](https://github.com/code-423n4/2022-09-vtvl-findings/issues/141), [ikbkln](https://github.com/code-423n4/2022-09-vtvl-findings/issues/161), [neumo](https://github.com/code-423n4/2022-09-vtvl-findings/issues/171), [TomJ](https://github.com/code-423n4/2022-09-vtvl-findings/issues/337), [0xA5DF](https://github.com/code-423n4/2022-09-vtvl-findings/issues/347), [0xSky](https://github.com/code-423n4/2022-09-vtvl-findings/issues/377), [Aeros](https://github.com/code-423n4/2022-09-vtvl-findings/issues/423), [sorrynotsorry](https://github.com/code-423n4/2022-09-vtvl-findings/issues/446), [async](https://github.com/code-423n4/2022-09-vtvl-findings/issues/215), [prasantgupta52](https://github.com/code-423n4/2022-09-vtvl-findings/issues/324), [0xDecorativePineapple](https://github.com/code-423n4/2022-09-vtvl-findings/issues/395), [rvierdiiev](https://github.com/code-423n4/2022-09-vtvl-findings/issues/56), [sach1r0](https://github.com/code-423n4/2022-09-vtvl-findings/issues/131), [ElKu](https://github.com/code-423n4/2022-09-vtvl-findings/issues/158), [slowmoses](https://github.com/code-423n4/2022-09-vtvl-findings/issues/174), [neko\\_nyaa](https://github.com/code-423n4/2022-09-vtvl-findings/issues/203), [Tomo](https://github.com/code-423n4/2022-09-vtvl-findings/issues/116), [bin2chen](https://github.com/code-423n4/2022-09-vtvl-findings/issues/110), [innertia](https://github.com/code-423n4/2022-09-vtvl-findings/issues/165), [yongskiws](https://github.com/code-423n4/2022-09-vtvl-findings/issues/355), [ignacio](https://github.com/code-423n4/2022-09-vtvl-findings/issues/207), [djxploit](https://github.com/code-423n4/2022-09-vtvl-findings/issues/394), [JohnSmith](https://github.com/code-423n4/2022-09-vtvl-findings/issues/415), [got\\_targ](https://github.com/code-423n4/2022-09-vtvl-findings/issues/443), [joestakey](https://github.com/code-423n4/2022-09-vtvl-findings/issues/493), [csanuragjain](https://github.com/code-423n4/2022-09-vtvl-findings/issues/227), [rokinot](https://github.com/code-423n4/2022-09-vtvl-findings/issues/248), [cryptphi](https://github.com/code-423n4/2022-09-vtvl-findings/issues/255), [ayeslick](https://github.com/code-423n4/2022-09-vtvl-findings/issues/295), [romand](https://github.com/code-423n4/2022-09-vtvl-findings/issues/310), [peanuts](https://github.com/code-423n4/2022-09-vtvl-findings/issues/327), [RustyRabbit](https://github.com/code-423n4/2022-09-vtvl-findings/issues/340), [0xbepresent](https://github.com/code-423n4/2022-09-vtvl-findings/issues/348), [hansfriese](https://github.com/code-423n4/2022-09-vtvl-findings/issues/361), [Chom](https://github.com/code-423n4/2022-09-vtvl-findings/issues/380), [berndartmueller](https://github.com/code-423n4/2022-09-vtvl-findings/issues/398), [dic0de](https://github.com/code-423n4/2022-09-vtvl-findings/issues/401), [peritoflores](https://github.com/code-423n4/2022-09-vtvl-findings/issues/422), [zzzitron](https://github.com/code-423n4/2022-09-vtvl-findings/issues/58), [cccz](https://github.com/code-423n4/2022-09-vtvl-findings/issues/65), [obront](https://github.com/code-423n4/2022-09-vtvl-findings/issues/92), [reassor](https://github.com/code-423n4/2022-09-vtvl-findings/issues/99), [bobirichman](https://github.com/code-423n4/2022-09-vtvl-findings/issues/68), [sikorico](https://github.com/code-423n4/2022-09-vtvl-findings/issues/72), [Margaret](https://github.com/code-423n4/2022-09-vtvl-findings/issues/73), [datapunk](https://github.com/code-423n4/2022-09-vtvl-findings/issues/107), [karanctf](https://github.com/code-423n4/2022-09-vtvl-findings/issues/120), [fatherOfBlocks](https://github.com/code-423n4/2022-09-vtvl-findings/issues/127), [0xmatt](https://github.com/code-423n4/2022-09-vtvl-findings/issues/266), [nalus](https://github.com/code-423n4/2022-09-vtvl-findings/issues/294), [eighty](https://github.com/code-423n4/2022-09-vtvl-findings/issues/308), [ret2basic](https://github.com/code-423n4/2022-09-vtvl-findings/issues/313), [Ruhum](https://github.com/code-423n4/2022-09-vtvl-findings/issues/180), [Sm4rty](https://github.com/code-423n4/2022-09-vtvl-findings/issues/386), [Rohan16](https://github.com/code-423n4/2022-09-vtvl-findings/issues/492), [pedr02b2](https://github.com/code-423n4/2022-09-vtvl-findings/issues/193), [ReyAdmirado](https://github.com/code-423n4/2022-09-vtvl-findings/issues/354), [indijanc](https://github.com/code-423n4/2022-09-vtvl-findings/issues/399), [SooYa](https://github.com/code-423n4/2022-09-vtvl-findings/issues/412), [pedroais](https://github.com/code-423n4/2022-09-vtvl-findings/issues/483), [d3e4](https://github.com/code-423n4/2022-09-vtvl-findings/issues/485), [ak1](https://github.com/code-423n4/2022-09-vtvl-findings/issues/439), [zzykxx](https://github.com/code-423n4/2022-09-vtvl-findings/issues/97), [erictee](https://github.com/code-423n4/2022-09-vtvl-findings/issues/15), [oyc\\_109](https://github.com/code-423n4/2022-09-vtvl-findings/issues/63), [ch13fd357r0y3r](https://github.com/code-423n4/2022-09-vtvl-findings/issues/87), [millersplanet](https://github.com/code-423n4/2022-09-vtvl-findings/issues/100), [martin](https://github.com/code-423n4/2022-09-vtvl-findings/issues/177), [2997ms](https://github.com/code-423n4/2022-09-vtvl-findings/issues/181), [B2](https://github.com/code-423n4/2022-09-vtvl-findings/issues/242), [tibthecat](https://github.com/code-423n4/2022-09-vtvl-findings/issues/254), [OptimismSec](https://github.com/code-423n4/2022-09-vtvl-findings/issues/262), [exd0tpy](https://github.com/code-423n4/2022-09-vtvl-findings/issues/302), [medikko](https://github.com/code-423n4/2022-09-vtvl-findings/issues/306), [peiw](https://github.com/code-423n4/2022-09-vtvl-findings/issues/312), [JC](https://github.com/code-423n4/2022-09-vtvl-findings/issues/497), [StevenL](https://github.com/code-423n4/2022-09-vtvl-findings/issues/134), [durianSausage](https://github.com/code-423n4/2022-09-vtvl-findings/issues/147), [0v3rf10w](https://github.com/code-423n4/2022-09-vtvl-findings/issues/388), [0x040](https://github.com/code-423n4/2022-09-vtvl-findings/issues/405), [natzuu](https://github.com/code-423n4/2022-09-vtvl-findings/issues/488), [Yiko](https://github.com/code-423n4/2022-09-vtvl-findings/issues/49), [carrotsmuggler](https://github.com/code-423n4/2022-09-vtvl-findings/issues/111), [0x85102](https://github.com/code-423n4/2022-09-vtvl-findings/issues/133), [MasterCookie](https://github.com/code-423n4/2022-09-vtvl-findings/issues/143), [bulej93](https://github.com/code-423n4/2022-09-vtvl-findings/issues/168), and [Diraco](https://github.com/code-423n4/2022-09-vtvl-findings/issues/210).*\n\n## [01]\nThe `setAdmin()` function in AccessProtected.sol can be used to revoke all admins. This could be a feature to completely renounce ownership of the contract after all claims are set or could be a bug in which one admin either intentionally or unintentionally removes all admin (or all other admins except himself).\n\n## [02]\nLine 161 in `VTVLVesting._baseVestedAmount()` function should not get executed when `cliffAmount` is 0. In the case of no cliff amount, i.e. where `cliffReleaseTimestamp` and `cliffAmount` are both set as 0, the program execution should not enter the `if` block.<br>\n```\n160    if(_referenceTs >= _claim.cliffReleaseTimestamp) {\n161        vestAmt += _claim.cliffAmount;\n162    }\n```\n\n## [03]\nSolidity pragma versioning should be upgraded to latest available version. Currently the solidity version in contracts is ^0.8.14 which was found to possess some bugs.\n\n## [04]\nSolidity pragma versioning should be exactly same in all contracts. Currently some contracts use ^0.8.14 but some are fixed to 0.8.14.\n\n## [05]\nNo need to re-inherit Context contract in [VTVLVesting](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L11) smart contract as Context is already inherited by [AccessProtected](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/AccessProtected.sol#L11) contract.\n\n## [06]\nOwnable smart contract is unnecessarily imported in [AccessProtected.sol](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/AccessProtected.sol#L5) while it is never used. Unnecessary imports decreases the readability of smart contract code.\n\n## [07]\nUnnecessary imports are also present in [VTVLVesting.sol](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L5-L7). The compilation works completely fine with just importing SafeERC20.sol and AccessProtected.sol.\n\n## [08]\nAccessProtected - contract docs do not match implementaion. The implementation only has multiple equal rights admins and no `owner` field is present while the docs states something else.\n```javascript\n7    /** \n8        @title Access Limiter to multiple owner-specified accounts.\n9        @dev Exposes the onlyAdmin modifier, which will revert (ADMIN_ACCESS_REQUIRED) if the caller is not the owner nor the admin.\n10    */\n```\n\n## [09]\n`VariableSupplyERC20Token.constructor()` has an empty `@dev` tag.\n\n## [10]\nVariableSupplyERC20Token contract mentions an incorrect comment\n```javascript\n48    // We can't really have burn, because that could make our vesting contract not work.\n49    // Example: if the user can burn tokens already assigned to vesting schedules, it could be unable to pay its obligations.\n\n```\n\nToken can be made burnable in which users can be allowed to burn their own tokens.\n\n## [11]\nLine 159 in `VTVLVesting._baseVestedAmount()` contains a misleading comment\n```javascript\n159        // We don't check here that cliffReleaseTimestamp is after the startTimestamp \n160        if(_referenceTs >= _claim.cliffReleaseTimestamp) {\n161            vestAmt += _claim.cliffAmount;\n162        }\n```\n\n`cliffReleaseTimestamp` can never be after `startTimestamp` as per the [`require`](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L274) statements of `_createClaimUnchecked()`.\n\n## [12]\nAs per the implementation of vesting contract, Line 21 in VTVLVesting.sol should mention *greater than or equal* instead of just *greater than*.\n```javascript\n21    /// @dev Our balance of the token must always be greater than this amount.\n```\n\n## [13]\n`VTVLVesting.ClaimCreated` and `VTVLVesting.ClaimRevoked` events should also log the admin's address so it can be easily queried which admin created and revoked the claim.\n\n## [14]\nIn VTVLVesting contract, before revoking a claim the contract should transfer all the pending/partially vested rewards. Otherwise the entire vesting amount will get revoked.\n\n    It is at the discretion of protocol development team to decide whether the current behaviour is intended or not.\n\n## [15]\nAt [Line 82](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L82) of `VTVLVesting.constructor()`, a better check would be to do `_tokenAddress.totalSupply()`. As this will also ensure that the input address in indeed a token's address and perform the zero address check as well.\n```\n82    require(address(_tokenAddress) != address(0), \"INVALID_ADDRESS\");\n```\n\n## [16]\nThe `tokenAddress` state variable of VTVLVesting should be renamed to `token` as this variable represents an `IERC20` interface rather that just an address. Renaming it to `token` aligns better with its usage.\n```\n17    IERC20 public immutable tokenAddress;\n```\n\n## [17]\nThere should be a factory contract for VTVLVesting contract which can keep track of all vesting contracts deployed by different founders. The Factory contract aligns better with the business usecase of VTVL protocol owners.\n\n    From the spec, \"The core function of VTVL is to allow users to generate and deploy token vesting smart contracts through our platform.\"\n\n## [18]\nIn `VariableSupplyERC20Token.mint()` function, non-zero input validation check should be done similar to `FullPremintERC20Token.constructor()`.\n\n## [19]\nIn all solidity files, license keyword should be mentioned as `// SPDX-License-Identifier: UNLICENSED`.\n\n## [20]\nAll the actors interacting with a VTVLVesting contract need to fully trust all of its admins. Any one of the potentially infinite admins of VTVLVesting contract has the power to (either intentionally or unintentionally):\n    *   revoke claims of all recipients and withdraw all tokens, resulting in a rugpull attack.\n    *   give or take back the admin rights to or from any ethereum address.\n    *   withdraw any other ERC20 token from the vesting contract.\n\n\n\n***\n\n# Gas Optimizations\n\nFor this contest, 141 reports were submitted by wardens detailing gas optimizations. The [report highlighted below](https://github.com/code-423n4/2022-09-vtvl-findings/issues/253) by **IllIllI** received the top score from the judge.\n\n*The following wardens also submitted reports: [Aymen0909](https://github.com/code-423n4/2022-09-vtvl-findings/issues/383), [pfapostol](https://github.com/code-423n4/2022-09-vtvl-findings/issues/272), [c3phas](https://github.com/code-423n4/2022-09-vtvl-findings/issues/457), [JLevick](https://github.com/code-423n4/2022-09-vtvl-findings/issues/282), [Deivitto](https://github.com/code-423n4/2022-09-vtvl-findings/issues/432), [gogo](https://github.com/code-423n4/2022-09-vtvl-findings/issues/437), [CertoraInc](https://github.com/code-423n4/2022-09-vtvl-findings/issues/481), [JC](https://github.com/code-423n4/2022-09-vtvl-findings/issues/491), [Bnke0x0](https://github.com/code-423n4/2022-09-vtvl-findings/issues/43), [oyc\\_109](https://github.com/code-423n4/2022-09-vtvl-findings/issues/62), [durianSausage](https://github.com/code-423n4/2022-09-vtvl-findings/issues/146), [\\_\\_141345\\_\\_](https://github.com/code-423n4/2022-09-vtvl-findings/issues/150), [rotcivegaf](https://github.com/code-423n4/2022-09-vtvl-findings/issues/188), [0xSmartContract](https://github.com/code-423n4/2022-09-vtvl-findings/issues/274), [ajtra](https://github.com/code-423n4/2022-09-vtvl-findings/issues/299), [Sm4rty](https://github.com/code-423n4/2022-09-vtvl-findings/issues/385), [cryptostellar5](https://github.com/code-423n4/2022-09-vtvl-findings/issues/397), [Diana](https://github.com/code-423n4/2022-09-vtvl-findings/issues/407), [JohnSmith](https://github.com/code-423n4/2022-09-vtvl-findings/issues/414), [Tomo](https://github.com/code-423n4/2022-09-vtvl-findings/issues/115), [zishansami](https://github.com/code-423n4/2022-09-vtvl-findings/issues/170), [martin](https://github.com/code-423n4/2022-09-vtvl-findings/issues/176), [ch0bu](https://github.com/code-423n4/2022-09-vtvl-findings/issues/185), [SnowMan](https://github.com/code-423n4/2022-09-vtvl-findings/issues/305), [prasantgupta52](https://github.com/code-423n4/2022-09-vtvl-findings/issues/323), [erictee](https://github.com/code-423n4/2022-09-vtvl-findings/issues/13), [millersplanet](https://github.com/code-423n4/2022-09-vtvl-findings/issues/17), [djxploit](https://github.com/code-423n4/2022-09-vtvl-findings/issues/363), [Rohan16](https://github.com/code-423n4/2022-09-vtvl-findings/issues/484), [0x1f8b](https://github.com/code-423n4/2022-09-vtvl-findings/issues/42), [RaymondFam](https://github.com/code-423n4/2022-09-vtvl-findings/issues/114), [0x4non](https://github.com/code-423n4/2022-09-vtvl-findings/issues/202), [rbserver](https://github.com/code-423n4/2022-09-vtvl-findings/issues/259), [Rolezn](https://github.com/code-423n4/2022-09-vtvl-findings/issues/269), [TomJ](https://github.com/code-423n4/2022-09-vtvl-findings/issues/332), [brgltd](https://github.com/code-423n4/2022-09-vtvl-findings/issues/364), [0xNazgul](https://github.com/code-423n4/2022-09-vtvl-findings/issues/366), [Saintcode\\_](https://github.com/code-423n4/2022-09-vtvl-findings/issues/86), [karanctf](https://github.com/code-423n4/2022-09-vtvl-findings/issues/119), [medikko](https://github.com/code-423n4/2022-09-vtvl-findings/issues/301), [ret2basic](https://github.com/code-423n4/2022-09-vtvl-findings/issues/314), [0xsam](https://github.com/code-423n4/2022-09-vtvl-findings/issues/16), [ReyAdmirado](https://github.com/code-423n4/2022-09-vtvl-findings/issues/353), [seyni](https://github.com/code-423n4/2022-09-vtvl-findings/issues/356), [gianganhnguyen](https://github.com/code-423n4/2022-09-vtvl-findings/issues/36), [Ruhum](https://github.com/code-423n4/2022-09-vtvl-findings/issues/50), [carrotsmuggler](https://github.com/code-423n4/2022-09-vtvl-findings/issues/112), [slowmoses](https://github.com/code-423n4/2022-09-vtvl-findings/issues/173), [WilliamAmbrozic](https://github.com/code-423n4/2022-09-vtvl-findings/issues/182), [B2](https://github.com/code-423n4/2022-09-vtvl-findings/issues/240), [peiw](https://github.com/code-423n4/2022-09-vtvl-findings/issues/311), [0x040](https://github.com/code-423n4/2022-09-vtvl-findings/issues/318), [leosathya](https://github.com/code-423n4/2022-09-vtvl-findings/issues/321), [delfin454000](https://github.com/code-423n4/2022-09-vtvl-findings/issues/328), [Tomio](https://github.com/code-423n4/2022-09-vtvl-findings/issues/345), [samruna](https://github.com/code-423n4/2022-09-vtvl-findings/issues/2), [lukris02](https://github.com/code-423n4/2022-09-vtvl-findings/issues/351), [aysha](https://github.com/code-423n4/2022-09-vtvl-findings/issues/482), [yaemsobak](https://github.com/code-423n4/2022-09-vtvl-findings/issues/204), [Junnon](https://github.com/code-423n4/2022-09-vtvl-findings/issues/246), [imare](https://github.com/code-423n4/2022-09-vtvl-findings/issues/320), [eighty](https://github.com/code-423n4/2022-09-vtvl-findings/issues/309), [0xA5DF](https://github.com/code-423n4/2022-09-vtvl-findings/issues/329), [ladboy233](https://github.com/code-423n4/2022-09-vtvl-findings/issues/8), [emrekocak](https://github.com/code-423n4/2022-09-vtvl-findings/issues/22), [tnevler](https://github.com/code-423n4/2022-09-vtvl-findings/issues/346), [pauliax](https://github.com/code-423n4/2022-09-vtvl-findings/issues/461), [ikbkln](https://github.com/code-423n4/2022-09-vtvl-findings/issues/79), [neko\\_nyaa](https://github.com/code-423n4/2022-09-vtvl-findings/issues/152), [jag](https://github.com/code-423n4/2022-09-vtvl-findings/issues/223), [Tadashi](https://github.com/code-423n4/2022-09-vtvl-findings/issues/252), [Atarpara](https://github.com/code-423n4/2022-09-vtvl-findings/issues/260), [tgolding55](https://github.com/code-423n4/2022-09-vtvl-findings/issues/276), [0xbepresent](https://github.com/code-423n4/2022-09-vtvl-findings/issues/331), [Ocean\\_Sky](https://github.com/code-423n4/2022-09-vtvl-findings/issues/336), [peanuts](https://github.com/code-423n4/2022-09-vtvl-findings/issues/339), [caventa](https://github.com/code-423n4/2022-09-vtvl-findings/issues/258), [RockingMiles](https://github.com/code-423n4/2022-09-vtvl-findings/issues/31), [supernova](https://github.com/code-423n4/2022-09-vtvl-findings/issues/33), [SooYa](https://github.com/code-423n4/2022-09-vtvl-findings/issues/409), [beardofginger](https://github.com/code-423n4/2022-09-vtvl-findings/issues/410), [natzuu](https://github.com/code-423n4/2022-09-vtvl-findings/issues/468), [pedroais](https://github.com/code-423n4/2022-09-vtvl-findings/issues/479), [bobirichman](https://github.com/code-423n4/2022-09-vtvl-findings/issues/69), [dharma09](https://github.com/code-423n4/2022-09-vtvl-findings/issues/70), [DimitarDimitrov](https://github.com/code-423n4/2022-09-vtvl-findings/issues/117), [sach1r0](https://github.com/code-423n4/2022-09-vtvl-findings/issues/130), [Waze](https://github.com/code-423n4/2022-09-vtvl-findings/issues/198), [ignacio](https://github.com/code-423n4/2022-09-vtvl-findings/issues/205), [async](https://github.com/code-423n4/2022-09-vtvl-findings/issues/217), [tibthecat](https://github.com/code-423n4/2022-09-vtvl-findings/issues/257), [OptimismSec](https://github.com/code-423n4/2022-09-vtvl-findings/issues/263), [AkshaySrivastav](https://github.com/code-423n4/2022-09-vtvl-findings/issues/279), [malinariy](https://github.com/code-423n4/2022-09-vtvl-findings/issues/304), [lucacez](https://github.com/code-423n4/2022-09-vtvl-findings/issues/325), [ChristianKuri](https://github.com/code-423n4/2022-09-vtvl-findings/issues/26), [Chom](https://github.com/code-423n4/2022-09-vtvl-findings/issues/408), [Funen](https://github.com/code-423n4/2022-09-vtvl-findings/issues/465), [d3e4](https://github.com/code-423n4/2022-09-vtvl-findings/issues/489), [subtle77](https://github.com/code-423n4/2022-09-vtvl-findings/issues/496), [fatherOfBlocks](https://github.com/code-423n4/2022-09-vtvl-findings/issues/126), [0xDanielC](https://github.com/code-423n4/2022-09-vtvl-findings/issues/382), [indijanc](https://github.com/code-423n4/2022-09-vtvl-findings/issues/387), [ak1](https://github.com/code-423n4/2022-09-vtvl-findings/issues/425), [got\\_targ](https://github.com/code-423n4/2022-09-vtvl-findings/issues/440), [mics](https://github.com/code-423n4/2022-09-vtvl-findings/issues/71), [Lambda](https://github.com/code-423n4/2022-09-vtvl-findings/issues/81), [KIntern\\_NA](https://github.com/code-423n4/2022-09-vtvl-findings/issues/213), [w0Lfrum](https://github.com/code-423n4/2022-09-vtvl-findings/issues/281), [hxzy](https://github.com/code-423n4/2022-09-vtvl-findings/issues/19), [Amithuddar](https://github.com/code-423n4/2022-09-vtvl-findings/issues/391), [V\\_B](https://github.com/code-423n4/2022-09-vtvl-findings/issues/470), [Tagir2003](https://github.com/code-423n4/2022-09-vtvl-findings/issues/74), [0xc0ffEE](https://github.com/code-423n4/2022-09-vtvl-findings/issues/80), [Respx](https://github.com/code-423n4/2022-09-vtvl-findings/issues/101), [MasterCookie](https://github.com/code-423n4/2022-09-vtvl-findings/issues/142), [Satyam\\_Sharma](https://github.com/code-423n4/2022-09-vtvl-findings/issues/160), [Noah3o6](https://github.com/code-423n4/2022-09-vtvl-findings/issues/183), [rokinot](https://github.com/code-423n4/2022-09-vtvl-findings/issues/249), [nalus](https://github.com/code-423n4/2022-09-vtvl-findings/issues/293), [jpserrat](https://github.com/code-423n4/2022-09-vtvl-findings/issues/317), [CodingNameKiki](https://github.com/code-423n4/2022-09-vtvl-findings/issues/421), [Matin](https://github.com/code-423n4/2022-09-vtvl-findings/issues/37), [rvierdiiev](https://github.com/code-423n4/2022-09-vtvl-findings/issues/57), [adriro](https://github.com/code-423n4/2022-09-vtvl-findings/issues/75), [StevenL](https://github.com/code-423n4/2022-09-vtvl-findings/issues/136), [bulej93](https://github.com/code-423n4/2022-09-vtvl-findings/issues/167), [2997ms](https://github.com/code-423n4/2022-09-vtvl-findings/issues/178), [Diraco](https://github.com/code-423n4/2022-09-vtvl-findings/issues/211), [csanuragjain](https://github.com/code-423n4/2022-09-vtvl-findings/issues/234), [Sta1400](https://github.com/code-423n4/2022-09-vtvl-findings/issues/352), [0v3rf10w](https://github.com/code-423n4/2022-09-vtvl-findings/issues/389), [0x85102](https://github.com/code-423n4/2022-09-vtvl-findings/issues/132), [mrpathfindr](https://github.com/code-423n4/2022-09-vtvl-findings/issues/196), [exd0tpy](https://github.com/code-423n4/2022-09-vtvl-findings/issues/300), [cryptphi](https://github.com/code-423n4/2022-09-vtvl-findings/issues/357), [a12jmx](https://github.com/code-423n4/2022-09-vtvl-findings/issues/370), [francoHacker](https://github.com/code-423n4/2022-09-vtvl-findings/issues/378), [m9800](https://github.com/code-423n4/2022-09-vtvl-findings/issues/495), and [Yiko](https://github.com/code-423n4/2022-09-vtvl-findings/issues/48).*\n\n## Summary\n\n|        | Issue                                                                                                                                                      | Instances | Total Gas Saved |\n| ------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------: | :-------------: |\n| [G&#8209;01] | Save gas by not requring non-zero interval if no linear amount                                                                                             |     1     |      17100      |\n| [G‑02] | Results of calls to `_msgSender()` not cached                                                                                                              |     4     |        64       |\n| [G‑03] | Using `calldata` instead of `memory` for read-only arguments in `external` functions saves gas                                                             |     7     |       840       |\n| [G‑04] | State variables should be cached in stack variables rather than re-reading them from storage                                                               |     1     |        97       |\n| [G‑05] | `<x> += <y>` costs more gas than `<x> = <x> + <y>` for state variables                                                                                     |     4     |       452       |\n| [G‑06] | Add `unchecked {}` for subtractions where the operands cannot underflow because of a previous `require()` or `if`-statement                                |     4     |       340       |\n| [G‑07] | `++i`/`i++` should be `unchecked{++i}`/`unchecked{i++}` when it is not possible for them to overflow, as is the case when used in `for`- and `while`-loops |     1     |        60       |\n| [G‑08] | Optimize names to save gas                                                                                                                                 |     3     |        66       |\n| [G‑09] | Using `bool`s for storage incurs overhead                                                                                                                  |     1     |      20000      |\n| [G‑10] | `++i` costs less gas than `i++`, especially when it's used in `for`-loops (`--i`/`i--` too)                                                                |     1     |        10       |\n| [G‑11] | Splitting `require()` statements that use `&&` saves gas                                                                                                   |     1     |        3        |\n| [G‑12] | Don't compare boolean expressions to boolean literals                                                                                                      |     1     |        9        |\n| [G‑13] | Use custom errors rather than `revert()`/`require()` strings to save gas                                                                                   |     24    |        -        |\n| [G&#8209;14] | Functions guaranteed to revert when called by normal users can be marked `payable`                                                                         |     7     |       147       |\n| [G&#8209;15] | Don't use `_msgSender()` if not supporting EIP-2771                                                                                                        |     13    |       208       |\n\nTotal: 73 instances over 15 issues with **39396 gas** saved\n\nGas totals use lower bounds of ranges and count two iterations of each `for`-loop. All values above are runtime, not deployment, values.\n\n## [G‑01]  Save gas by not requring non-zero interval if no linear amount\n\nIf there is no linear amount, a Gsset for the claim's interval can be converted to a Gsreset, saving **17100 gas**.\n\n*There is 1 instance of this issue:*\n\n```solidity\nFile: /contracts/VTVLVesting.sol\n\n263          require(_releaseIntervalSecs > 0, \"INVALID_RELEASE_INTERVAL\");\n264:         require((_endTimestamp - _startTimestamp) % _releaseIntervalSecs == 0, \"INVALID_INTERVAL_LENGTH\");\n\n```\n\n[VTVLVesting.sol#L263-L264](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L263-L264)\n\n## [G‑02]  Results of calls to `_msgSender()` not cached\n\nSaves at least **16 gas** per call skipped.\n\n*There are 4 instances of this issue:*\n\n```solidity\nFile: /contracts/VTVLVesting.sol\n\n371:         uint112 allowance = vestedAmount(_msgSender(), uint40(block.timestamp));\n\n388:         tokenAddress.safeTransfer(_msgSender(), amountRemaining);\n\n391:         emit Claimed(_msgSender(), amountRemaining);\n\n410:         emit AdminWithdrawn(_msgSender(), _amountRequested);\n\n```\n\n[VTVLVesting.sol#L371](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L371)\n\n## [G‑03]  Using `calldata` instead of `memory` for read-only arguments in `external` functions saves gas\n\nWhen a function with a `memory` array is called externally, the `abi.decode()` step has to use a for-loop to copy each index of the `calldata` to the `memory` index. **Each iteration of this for-loop costs at least 60 gas** (i.e. `60 * <mem_array>.length`). Using `calldata` directly, obliviates the need for such a loop in the contract code and runtime execution. Note that even if an interface defines a function as having `memory` arguments, it's still valid for implementation contracs to use `calldata` arguments instead.\n\nIf the array is passed to an `internal` function which passes the array to another internal function where the array is modified and therefore `memory` is used in the `external` call, it's still more gass-efficient to use `calldata` when the `external` function uses modifiers, since the modifiers may prevent the internal functions from being called. Structs have the same overhead as an array of length one.\n\nNote that I've also flagged instances where the function is `public` but can be marked as `external` since it's not called by the contract, and cases where a constructor is involved.\n\n*There are 7 instances of this issue:*\n\n```solidity\nFile: contracts/VTVLVesting.sol\n\n/// @audit _recipients\n/// @audit _startTimestamps\n/// @audit _endTimestamps\n/// @audit _cliffReleaseTimestamps\n/// @audit _releaseIntervalsSecs\n/// @audit _linearVestAmounts\n/// @audit _cliffAmounts\n333       function createClaimsBatch(\n334           address[] memory _recipients, \n335           uint40[] memory _startTimestamps, \n336           uint40[] memory _endTimestamps, \n337           uint40[] memory _cliffReleaseTimestamps, \n338           uint40[] memory _releaseIntervalsSecs, \n339           uint112[] memory _linearVestAmounts, \n340           uint112[] memory _cliffAmounts) \n341:          external onlyAdmin {\n\n```\n\n[VTVLVesting.sol#L333-L341](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L333-L341)<br>\n\n## [G‑04]  State variables should be cached in stack variables rather than re-reading them from storage\n\nThe instances below point to the second+ access of a state variable within a function. Caching of a state variable replace each Gwarmaccess (**100 gas**) with a much cheaper stack read. Other less obvious fixes/optimizations include having local memory caches of state variable structs, or having local caches of state variable contracts/addresses.\n\n*There is 1 instance of this issue:*\n\n```solidity\nFile: contracts/token/VariableSupplyERC20Token.sol\n\n/// @audit mintableSupply on line 40\n41:               require(amount <= mintableSupply, \"INVALID_AMOUNT\");\n\n```\n\n[VariableSupplyERC20Token.sol#L41](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/token/VariableSupplyERC20Token.sol#L41)<br>\n\n## [G‑05]  `<x> += <y>` costs more gas than `<x> = <x> + <y>` for state variables\n\nUsing the addition operator instead of plus-equals saves **[113 gas](https://gist.github.com/IllIllI000/cbbfb267425b898e5be734d4008d4fe8)**.\n\n*There are 4 instances of this issue:*\n\n```solidity\nFile: contracts/token/VariableSupplyERC20Token.sol\n\n43:               mintableSupply -= amount;\n\n```\n\n[VariableSupplyERC20Token.sol#L43](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/token/VariableSupplyERC20Token.sol#L43)<br>\n\n```solidity\nFile: contracts/VTVLVesting.sol\n\n301:          numTokensReservedForVesting += allocatedAmount; // track the allocated amount\n\n383:          numTokensReservedForVesting -= amountRemaining;\n\n433:          numTokensReservedForVesting -= amountRemaining; // Reduces the allocation\n\n```\n\n[VTVLVesting.sol#L301](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L301)<br>\n\n## [G‑06]  Add `unchecked {}` for subtractions where the operands cannot underflow because of a previous `require()` or `if`-statement\n\n`require(a <= b); x = b - a` => `require(a <= b); unchecked { x = b - a }`\n\n*There are 4 instances of this issue:*\n\n```solidity\nFile: contracts/VTVLVesting.sol\n\n/// @audit require() on line 262\n264:          require((_endTimestamp - _startTimestamp) % _releaseIntervalSecs == 0, \"INVALID_INTERVAL_LENGTH\");\n\n/// @audit require() on line 374\n377:          uint112 amountRemaining = allowance - usrClaim.amountWithdrawn;\n\n/// @audit require() on line 426\n429:          uint112 amountRemaining = finalVestAmt - _claim.amountWithdrawn;\n\n/// @audit if-condition on line 166\n167:                  uint40 currentVestingDurationSecs = _referenceTs - _claim.startTimestamp; // How long since the start\n\n```\n\n[VTVLVesting.sol#L264](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L264)<br>\n\n## [G‑07]  `++i`/`i++` should be `unchecked{++i}`/`unchecked{i++}` when it is not possible for them to overflow, as is the case when used in `for`- and `while`-loops\n\nThe `unchecked` keyword is new in solidity version 0.8.0, so this only applies to that version or higher, which these instances are. This saves **30-40 gas [per loop](https://gist.github.com/hrkrshnn/ee8fabd532058307229d65dcd5836ddc#the-increment-in-for-loop-post-condition-can-be-made-unchecked)**.\n\n*There is 1 instance of this issue:*\n\n```solidity\nFile: contracts/VTVLVesting.sol\n\n353:          for (uint256 i = 0; i < length; i++) {\n\n```\n\n[VTVLVesting.sol#L353](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L353)<br>\n\n## [G‑08]  Optimize names to save gas\n\n`public`/`external` function names and `public` member variable names can be optimized to save gas. See [this](https://gist.github.com/IllIllI000/a5d8b486a8259f9f77891a919febd1a9) link for an example of how it works. Below are the interfaces/abstract contracts that can be optimized so that the most frequently-called functions use the least amount of gas possible during method lookup. Method IDs that have two leading zero bytes can save **128 gas** each during deployment, and renaming functions to have lower method IDs will save **22 gas** per call, [per sorted position shifted](https://medium.com/joyso/solidity-how-does-function-name-affect-gas-consumption-in-smart-contract-47d270d8ac92).\n\n*There are 3 instances of this issue:*\n\n```solidity\nFile: contracts/AccessProtected.sol\n\n/// @audit isAdmin(), setAdmin()\n11:   abstract contract AccessProtected is Context {\n\n```\n\n[AccessProtected.sol#L11](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/AccessProtected.sol#L11)<br>\n\n```solidity\nFile: contracts/token/VariableSupplyERC20Token.sol\n\n/// @audit mint()\n10:   contract VariableSupplyERC20Token is ERC20, AccessProtected {\n\n```\n\n[VariableSupplyERC20Token.sol#L10](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/token/VariableSupplyERC20Token.sol#L10)<br>\n\n```solidity\nFile: contracts/VTVLVesting.sol\n\n/// @audit getClaim(), vestedAmount(), finalVestedAmount(), claimableAmount(), allVestingRecipients(), numVestingRecipients(), createClaim(), createClaimsBatch(), withdraw(), withdrawAdmin(), revokeClaim(), withdrawOtherToken()\n11:   contract VTVLVesting is Context, AccessProtected {\n\n```\n\n[VTVLVesting.sol#L11](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L11)<br>\n\n## [G‑09]  Using `bool`s for storage incurs overhead\n\n```solidity\n    // Booleans are more expensive than uint256 or any type that takes up a full\n    // word because each write operation emits an extra SLOAD to first read the\n    // slot's contents, replace the bits taken up by the boolean, and then write\n    // back. This is the compiler's defense against contract upgrades and\n    // pointer aliasing, and it cannot be disabled.\n```\n\n[OpenZeppelin/ReentrancyGuard.sol#L23-L27](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/58f635312aa21f947cae5f8578638a85aa2519f5/contracts/security/ReentrancyGuard.sol#L23-L27)<br>\nUse `uint256(1)` and `uint256(2)` for true/false to avoid a Gwarmaccess (**[100 gas](https://gist.github.com/IllIllI000/1b70014db712f8572a72378321250058)**) for the extra SLOAD, and to avoid Gsset (**20000 gas**) when changing from `false` to `true`, after having been `true` in the past.\n\n*There is 1 instance of this issue:*\n\n```solidity\nFile: contracts/AccessProtected.sol\n\n12:       mapping(address => bool) private _admins; // user address => admin? mapping\n\n```\n\n[AccessProtected.sol#L12](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/AccessProtected.sol#L12)<br>\n\n## [G‑10]  `++i` costs less gas than `i++`, especially when it's used in `for`-loops (`--i`/`i--` too)\n\nSaves **5 gas per loop**.\n\n*There is 1 instance of this issue:*\n\n```solidity\nFile: contracts/VTVLVesting.sol\n\n353:          for (uint256 i = 0; i < length; i++) {\n\n```\n\n[VTVLVesting.sol#L353](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L353)<br>\n\n## [G‑11]  Splitting `require()` statements that use `&&` saves gas\n\nSee [this issue](https://github.com/code-423n4/2022-01-xdefi-findings/issues/128) which describes the fact that there is a larger deployment gas cost, but with enough runtime calls, the change ends up being cheaper by **3 gas**.\n\n*There is 1 instance of this issue:*\n\n```solidity\nFile: contracts/VTVLVesting.sol\n\n344           require(_startTimestamps.length == length &&\n345                   _endTimestamps.length == length &&\n346                   _cliffReleaseTimestamps.length == length &&\n347                   _releaseIntervalsSecs.length == length &&\n348                   _linearVestAmounts.length == length &&\n349                   _cliffAmounts.length == length, \n350                   \"ARRAY_LENGTH_MISMATCH\"\n351:          );\n\n```\n\n[VTVLVesting.sol#L344-L351](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L344-L351)<br>\n\n## [G‑12]  Don't compare boolean expressions to boolean literals\n\n`if (<x> == true)` => `if (<x>)`, `if (<x> == false)` => `if (!<x>)`\n\n*There is 1 instance of this issue:*\n\n```solidity\nFile: contracts/VTVLVesting.sol\n\n111:          require(_claim.isActive == true, \"NO_ACTIVE_CLAIM\");\n\n```\n\n[VTVLVesting.sol#L111](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L111)<br>\n\n## [G‑13]  Use custom errors rather than `revert()`/`require()` strings to save gas\n\nCustom errors are available from solidity version 0.8.4. Custom errors save [**\\~50 gas**](https://gist.github.com/IllIllI000/ad1bd0d29a0101b25e57c293b4b0c746) each time they're hit by [avoiding having to allocate and store the revert string](https://blog.soliditylang.org/2021/04/21/custom-errors/#errors-in-depth). Not defining the strings also save deployment gas.\n\n*There are 24 instances of this issue:*\n\n```solidity\nFile: contracts/AccessProtected.sol\n\n25:           require(_admins[_msgSender()], \"ADMIN_ACCESS_REQUIRED\");\n\n40:           require(admin != address(0), \"INVALID_ADDRESS\");\n\n```\n\n[AccessProtected.sol#L25](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/AccessProtected.sol#L25)<br>\n\n```solidity\nFile: contracts/token/FullPremintERC20Token.sol\n\n11:           require(supply_ > 0, \"NO_ZERO_MINT\");\n\n```\n\n[FullPremintERC20Token.sol#L11](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/token/FullPremintERC20Token.sol#L11)<br>\n\n```solidity\nFile: contracts/token/VariableSupplyERC20Token.sol\n\n27:           require(initialSupply_ > 0 || maxSupply_ > 0, \"INVALID_AMOUNT\");\n\n37:           require(account != address(0), \"INVALID_ADDRESS\");\n\n41:               require(amount <= mintableSupply, \"INVALID_AMOUNT\");\n\n```\n\n[VariableSupplyERC20Token.sol#L27](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/token/VariableSupplyERC20Token.sol#L27)<br>\n\n```solidity\nFile: contracts/VTVLVesting.sol\n\n82:           require(address(_tokenAddress) != address(0), \"INVALID_ADDRESS\");\n\n107:          require(_claim.startTimestamp > 0, \"NO_ACTIVE_CLAIM\");\n\n111:          require(_claim.isActive == true, \"NO_ACTIVE_CLAIM\");\n\n129:          require(_claim.startTimestamp == 0, \"CLAIM_ALREADY_EXISTS\");\n\n255:          require(_recipient != address(0), \"INVALID_ADDRESS\");\n\n256:          require(_linearVestAmount + _cliffAmount > 0, \"INVALID_VESTED_AMOUNT\"); // Actually only one of linearvested/cliff amount must be 0, not necessarily both\n\n257:          require(_startTimestamp > 0, \"INVALID_START_TIMESTAMP\");\n\n262:          require(_startTimestamp < _endTimestamp, \"INVALID_END_TIMESTAMP\"); // _endTimestamp must be after _startTimestamp\n\n263:          require(_releaseIntervalSecs > 0, \"INVALID_RELEASE_INTERVAL\");\n\n264:          require((_endTimestamp - _startTimestamp) % _releaseIntervalSecs == 0, \"INVALID_INTERVAL_LENGTH\");\n\n270           require( \n271               (\n272                   _cliffReleaseTimestamp > 0 && \n273                   _cliffAmount > 0 && \n274                   _cliffReleaseTimestamp <= _startTimestamp\n275               ) || (\n276                   _cliffReleaseTimestamp == 0 && \n277                   _cliffAmount == 0\n278:          ), \"INVALID_CLIFF\");\n\n295:          require(tokenAddress.balanceOf(address(this)) >= numTokensReservedForVesting + allocatedAmount, \"INSUFFICIENT_BALANCE\");\n\n344           require(_startTimestamps.length == length &&\n345                   _endTimestamps.length == length &&\n346                   _cliffReleaseTimestamps.length == length &&\n347                   _releaseIntervalsSecs.length == length &&\n348                   _linearVestAmounts.length == length &&\n349                   _cliffAmounts.length == length, \n350                   \"ARRAY_LENGTH_MISMATCH\"\n351:          );\n\n374:          require(allowance > usrClaim.amountWithdrawn, \"NOTHING_TO_WITHDRAW\");\n\n402:          require(amountRemaining >= _amountRequested, \"INSUFFICIENT_BALANCE\");\n\n426:          require( _claim.amountWithdrawn < finalVestAmt, \"NO_UNVESTED_AMOUNT\");\n\n447:          require(_otherTokenAddress != tokenAddress, \"INVALID_TOKEN\"); // tokenAddress address is already sure to be nonzero due to constructor\n\n449:          require(bal > 0, \"INSUFFICIENT_BALANCE\");\n\n```\n\n[VTVLVesting.sol#L82](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L82)<br>\n\n## [G‑14]  Functions guaranteed to revert when called by normal users can be marked `payable`\n\nIf a function modifier such as `onlyOwner` is used, the function will revert if a normal user tries to pay the function. Marking the function as `payable` will lower the gas cost for legitimate callers because the compiler will not include checks for whether a payment was provided. The extra opcodes avoided are `CALLVALUE`(2),`DUP1`(3),`ISZERO`(3),`PUSH2`(3),`JUMPI`(10),`PUSH1`(3),`DUP1`(3),`REVERT`(0),`JUMPDEST`(1),`POP`(2), which costs an average of about **21 gas per call** to the function, in addition to the extra deployment cost.\n\n*There are 7 instances of this issue:*\n\n```solidity\nFile: contracts/AccessProtected.sol\n\n39:       function setAdmin(address admin, bool isEnabled) public onlyAdmin {\n\n```\n\n[AccessProtected.sol#L39](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/AccessProtected.sol#L39)<br>\n\n```solidity\nFile: contracts/token/VariableSupplyERC20Token.sol\n\n36:       function mint(address account, uint256 amount) public onlyAdmin {\n\n```\n\n[VariableSupplyERC20Token.sol#L36](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/token/VariableSupplyERC20Token.sol#L36)<br>\n\n```solidity\nFile: contracts/VTVLVesting.sol\n\n317       function createClaim(\n318               address _recipient, \n319               uint40 _startTimestamp, \n320               uint40 _endTimestamp, \n321               uint40 _cliffReleaseTimestamp, \n322               uint40 _releaseIntervalSecs, \n323               uint112 _linearVestAmount, \n324               uint112 _cliffAmount\n325:                  ) external onlyAdmin {\n\n333       function createClaimsBatch(\n334           address[] memory _recipients, \n335           uint40[] memory _startTimestamps, \n336           uint40[] memory _endTimestamps, \n337           uint40[] memory _cliffReleaseTimestamps, \n338           uint40[] memory _releaseIntervalsSecs, \n339           uint112[] memory _linearVestAmounts, \n340           uint112[] memory _cliffAmounts) \n341:          external onlyAdmin {\n\n398:      function withdrawAdmin(uint112 _amountRequested) public onlyAdmin {    \n\n418:      function revokeClaim(address _recipient) external onlyAdmin hasActiveClaim(_recipient) {\n\n446:      function withdrawOtherToken(IERC20 _otherTokenAddress) external onlyAdmin {\n\n```\n\n[VTVLVesting.sol#L317-L325](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L317-L325)<br>\n\n## [G‑15]  Don't use `_msgSender()` if not supporting EIP-2771\n\nUse `msg.sender` if the code does not implement [EIP-2771 trusted forwarder](https://eips.ethereum.org/EIPS/eip-2771) support.\n\n*There are 13 instances of this issue:*\n\n```solidity\nFile: contracts/AccessProtected.sol\n\n17:           _admins[_msgSender()] = true;\n\n18:           emit AdminAccessSet(_msgSender(), true);\n\n25:           require(_admins[_msgSender()], \"ADMIN_ACCESS_REQUIRED\");\n\n```\n\n[AccessProtected.sol#L17](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/AccessProtected.sol#L17)<br>\n\n```solidity\nFile: contracts/token/FullPremintERC20Token.sol\n\n12:           _mint(_msgSender(), supply_);\n\n```\n\n[FullPremintERC20Token.sol#L12](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/token/FullPremintERC20Token.sol#L12)<br>\n\n```solidity\nFile: contracts/token/VariableSupplyERC20Token.sol\n\n32:               mint(_msgSender(), initialSupply_);\n\n```\n\n[VariableSupplyERC20Token.sol#L32](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/token/VariableSupplyERC20Token.sol#L32)<br>\n\n```solidity\nFile: contracts/VTVLVesting.sol\n\n367:          Claim storage usrClaim = claims[_msgSender()];\n\n371:          uint112 allowance = vestedAmount(_msgSender(), uint40(block.timestamp));\n\n388:          tokenAddress.safeTransfer(_msgSender(), amountRemaining);\n\n391:          emit Claimed(_msgSender(), amountRemaining);\n\n364:      function withdraw() hasActiveClaim(_msgSender()) external {\n\n407:          tokenAddress.safeTransfer(_msgSender(), _amountRequested);\n\n410:          emit AdminWithdrawn(_msgSender(), _amountRequested);\n\n450:          _otherTokenAddress.safeTransfer(_msgSender(), bal);\n\n```\n\n[VTVLVesting.sol#L367](https://github.com/code-423n4/2022-09-vtvl/blob/f68b7f3e61dad0d873b5b5a1e8126b839afeab5f/contracts/VTVLVesting.sol#L367)<br>\n\n\n\n***\n\n# Disclosures\n\nC4 is an open organization governed by participants in the community.\n\nC4 Contests incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Contest submissions are judged by a knowledgeable security researcher and solidity developer and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.\n\nC4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.\n"
}